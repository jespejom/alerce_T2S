{"id": "batch_req_6849f0d6d13c8190a9f5ab6e877b38bf", "custom_id": "13-0", "response": {"status_code": 200, "request_id": "98d02020a8d1e7e347c0cacd163ba107", "body": {"id": "chatcmpl-BhN05iOx0vzdK6JcVGNDaXXlSR4dp", "object": "chat.completion", "created": 1749676217, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define the date range in MJD for December 1, 2022 to September 1, 2023\nWITH date_range AS (\n    SELECT 59914.0 AS start_mjd, 60217.0 AS end_mjd\n),\n-- Select objects classified as SNe with first detection within the specified date range\nsne_objects AS (\n    SELECT o.oid, o.firstmjd, o.lastmjd\n    FROM object o\n    WHERE o.firstmjd BETWEEN (SELECT start_mjd FROM date_range) AND (SELECT end_mjd FROM date_range)\n),\n-- Retrieve the most probable class (ranking=1) for these objects, focusing on SNe classes\nsne_probabilities AS (\n    SELECT p.oid, p.class_name, p.probability\n    FROM probability p\n    WHERE p.oid IN (SELECT oid FROM sne_objects)\n      AND p.ranking = 1\n      AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n)\n-- Final selection: object OID, class probability, first detection, last detection\nSELECT\n    sp.class_name AS probability_class,\n    so.lastmjd,\n    so.firstmjd,\n    so.oid\nFROM sne_probabilities sp\nJOIN sne_objects so ON sp.oid = so.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1694, "completion_tokens": 284, "total_tokens": 1978, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d6ed5081908ef588f04c9aed7e", "custom_id": "13-1", "response": {"status_code": 200, "request_id": "eb379750f0433b8ae53375ffc69296e3", "body": {"id": "chatcmpl-BhN05ehzpZaVX8twrNVTqHEHXlaB3", "object": "chat.completion", "created": 1749676217, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define the date range in MJD for December 1, 2022 to September 1, 2023\nWITH date_range AS (\n    SELECT 59914.0 AS start_mjd, 60217.0 AS end_mjd\n),\n-- Select objects classified as SNe with first detection within the specified date range\nsne_objects AS (\n    SELECT o.oid, o.firstmjd, o.lastmjd\n    FROM object o\n    WHERE o.firstmjd BETWEEN (SELECT start_mjd FROM date_range) AND (SELECT end_mjd FROM date_range)\n),\n-- Retrieve the most probable class (ranking=1) for these objects, focusing on SNe\nsne_probabilities AS (\n    SELECT p.oid, p.class_name, p.probability\n    FROM probability p\n    WHERE p.ranking = 1\n      AND p.oid IN (SELECT oid FROM sne_objects)\n      AND (\n        p.class_name LIKE 'SN%'\n        AND (\n          p.class_name LIKE 'SNIa' OR\n          p.class_name LIKE 'SNIbc' OR\n          p.class_name LIKE 'SNII' OR\n          p.class_name LIKE 'SLSN'\n        )\n      )\n)\n-- Final selection with object OID, class probability, first and last detection dates\nSELECT \n    sp.class_name AS class_probability,\n    o.firstmjd AS first_detection_mjd,\n    o.lastmjd AS last_detection_mjd,\n    o.oid\nFROM sne_objects o\nJOIN sne_probabilities sp ON o.oid = sp.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1761, "completion_tokens": 331, "total_tokens": 2092, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d7066c8190aaeb67d26d35900b", "custom_id": "13-2", "response": {"status_code": 200, "request_id": "8bc8e960d4b8b6a88523ec341f70e2de", "body": {"id": "chatcmpl-BhN05Ve4so3FT5eakpNMsOLxKADfj", "object": "chat.completion", "created": 1749676217, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define the date range in MJD for December 1, 2022 to September 1, 2023\nWITH date_range AS (\n    SELECT 59914.0 AS start_mjd, 60217.0 AS end_mjd\n),\n-- Select objects classified as SNe with first detection within the specified date range\nsne_objects AS (\n    SELECT o.oid, o.firstmjd, o.lastmjd\n    FROM object o\n    WHERE o.firstmjd BETWEEN (SELECT start_mjd FROM date_range) AND (SELECT end_mjd FROM date_range)\n),\n-- Retrieve the most probable class (ranking=1) for these objects, focusing on SNe\nsne_probabilities AS (\n    SELECT p.oid, p.class_name, p.probability\n    FROM probability p\n    WHERE p.class_name LIKE 'SN%'            -- Focus on classes starting with 'SN'\n      AND p.class_name LIKE 'SNe%'           -- Ensure class is related to supernovae\n      AND p.ranking = 1                      -- Select the top-ranked (most probable) class\n      AND p.oid IN (SELECT oid FROM sne_objects) -- Only objects within the date range\n)\n-- Final selection: object id, class probability, first and last detection dates\nSELECT \n    sp.class_name AS class_probability,\n    o.firstmjd AS first_detection_mjd,\n    o.lastmjd AS last_detection_mjd,\n    o.oid\nFROM sne_probabilities sp\nJOIN object o ON o.oid = sp.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1695, "completion_tokens": 325, "total_tokens": 2020, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d71e30819088b2c895522bc2ba", "custom_id": "13-3", "response": {"status_code": 200, "request_id": "b8285f40ed43ce1a7a3a0b966c0e9473", "body": {"id": "chatcmpl-BhN0FMlcXW5SEbozV9cXM2bLBxmxj", "object": "chat.completion", "created": 1749676227, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define the date range in MJD for December 1, 2022 to September 1, 2023\nWITH date_range AS (\n    SELECT 59914.0 AS start_mjd, 60217.0 AS end_mjd\n),\n-- Select objects classified as SNe with first detection within the specified date range\nsne_objects AS (\n    SELECT o.oid, o.firstmjd, o.lastmjd\n    FROM object o\n    WHERE o.firstmjd BETWEEN (SELECT start_mjd FROM date_range) AND (SELECT end_mjd FROM date_range)\n),\n-- Retrieve the most probable class (ranking=1) for these objects, focusing on SNe classes\nsne_probabilities AS (\n    SELECT p.oid, p.class_name, p.probability\n    FROM probability p\n    WHERE p.oid IN (SELECT oid FROM sne_objects)\n      AND p.ranking = 1\n      AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n)\n-- Final selection: object OID, class probability, first detection, last detection\nSELECT\n    sp.class_name AS probability_class,\n    so.lastmjd,\n    so.firstmjd,\n    so.oid\nFROM sne_probabilities sp\nJOIN sne_objects so ON sp.oid = so.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1694, "completion_tokens": 284, "total_tokens": 1978, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d738d881909fed3570396f32d5", "custom_id": "10-0", "response": {"status_code": 200, "request_id": "7bebccddf88140ade6b9e73cf7699123", "body": {"id": "chatcmpl-BhN05CtpQLwgMHlmUK1jOFwuvwivz", "object": "chat.completion", "created": 1749676217, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects classified as SNIa with ranking=1 and CV/Nova with ranking=2, where the probability difference is less than 0.1\nWITH selected_objects AS (\n    -- Find objects with SNIa ranking=1\n    SELECT p1.oid\n    FROM probability p1\n    WHERE p1.class_name = 'SNIa'\n      AND p1.classifier_name = 'lc_classifier'\n      AND p1.ranking = 1\n    INTERSECT\n    -- Find objects with CV/Nova ranking=2\n    SELECT p2.oid\n    FROM probability p2\n    WHERE p2.class_name = 'CV/Nova'\n      AND p2.classifier_name = 'lc_classifier'\n      AND p2.ranking = 2\n),\nprobabilities AS (\n    -- Retrieve probabilities for selected objects\n    SELECT\n        o.oid,\n        -- Use DISTINCT ON to ensure only one row per object for each class\n        -- Get probability for SNIa with ranking=1\n        (SELECT p1.probability\n         FROM probability p1\n         WHERE p1.oid = o.oid\n           AND p1.class_name = 'SNIa'\n           AND p1.classifier_name = 'lc_classifier'\n           AND p1.ranking = 1\n         LIMIT 1) AS SN_prob,\n        -- Get probability for CV/Nova with ranking=2\n        (SELECT p2.probability\n         FROM probability p2\n         WHERE p2.oid = o.oid\n           AND p2.class_name = 'CV/Nova'\n           AND p2.classifier_name = 'lc_classifier'\n           AND p2.ranking = 2\n         LIMIT 1) AS CV_prob\n    FROM object o\n    WHERE o.oid IN (SELECT oid FROM selected_objects)\n),\nfiltered_objects AS (\n    -- Filter objects where the absolute difference between probabilities is less than 0.1\n    SELECT\n        oid,\n        SN_prob,\n        CV_prob\n    FROM probabilities\n    WHERE SN_prob IS NOT NULL\n      AND CV_prob IS NOT NULL\n      AND ABS(SN_prob - CV_prob) < 0.1\n)\n-- Return object IDs and probabilities with specified column names\nSELECT\n    oid,\n    SN_prob AS \"SN_prob\",\n    CV_prob AS \"CV_prob\"\nFROM filtered_objects;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1832, "completion_tokens": 494, "total_tokens": 2326, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d7537c8190b558e248fc8dee48", "custom_id": "10-1", "response": {"status_code": 200, "request_id": "29ccaa0f03a4ccd54d78c93110c0afcf", "body": {"id": "chatcmpl-BhN07W6eT6A9BJc8lkOyjyg8xD5oN", "object": "chat.completion", "created": 1749676219, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects that have both SNIa (ranking=1) and CV/Nova (ranking=2) classifications in the lc_classifier\nWITH selected_objects AS (\n    SELECT\n        p_oid.oid\n    FROM\n        (SELECT oid FROM probability WHERE class_name = 'SNIa' AND classifier_name = 'lc_classifier' AND ranking = 1) AS p_oid\n    JOIN\n        (SELECT oid FROM probability WHERE class_name = 'CV/Nova' AND classifier_name = 'lc_classifier' AND ranking = 2) AS p_cvn\n    ON p_oid.oid = p_cvn.oid\n),\n-- Retrieve probabilities for SNIa and CV/Nova for these objects\nprobabilities AS (\n    SELECT\n        o.oid,\n        -- Get probability for SNIa (ranking=1)\n        (SELECT probability FROM probability WHERE oid = o.oid AND class_name = 'SNIa' AND classifier_name = 'lc_classifier' AND ranking = 1) AS SN_prob,\n        -- Get probability for CV/Nova (ranking=2)\n        (SELECT probability FROM probability WHERE oid = o.oid AND class_name = 'CV/Nova' AND classifier_name = 'lc_classifier' AND ranking = 2) AS CV_prob\n    FROM\n        selected_objects o\n),\n-- Filter objects where the absolute difference between probabilities is less than 0.1\nfiltered AS (\n    SELECT\n        oid,\n        SN_prob,\n        CV_prob\n    FROM\n        probabilities\n    WHERE\n        ABS(SN_prob - CV_prob) < 0.1\n)\n-- Output object IDs with their respective probabilities\nSELECT\n    oid,\n    SN_prob AS \"SN_prob\",\n    CV_prob AS \"CV_prob\"\nFROM\n    filtered;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1825, "completion_tokens": 368, "total_tokens": 2193, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d76ed48190b6a5de171c4016e6", "custom_id": "10-3", "response": {"status_code": 200, "request_id": "b5074ea1297ca0474c60fe0485ad51d8", "body": {"id": "chatcmpl-BhN03lmx83hBwQTkMahjzOiLczmOE", "object": "chat.completion", "created": 1749676215, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with classifications 'SNIa' and 'CV/Nova' at rankings 1 and 2 respectively, for the latest classifier version\nWITH latest_classifier_version AS (\n    SELECT MAX(classifier_version) AS max_version\n    FROM probability\n    WHERE classifier_name = 'lc_classifier'\n),\nselected_objects AS (\n    SELECT p.oid\n    FROM probability p\n    JOIN latest_classifier_version lcv ON p.classifier_version = lcv.max_version\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.ranking IN (1, 2)\n      AND p.class_name IN ('SNIa', 'CV/Nova')\n),\n-- Retrieve probabilities for SNIa and CV/Nova for selected objects, ensuring the latest classifier version\nprobabilities AS (\n    SELECT p.oid,\n           MAX(CASE WHEN p.class_name = 'SNIa' THEN p.probability END) AS SN_prob,\n           MAX(CASE WHEN p.class_name = 'CV/Nova' THEN p.probability END) AS CV_prob\n    FROM probability p\n    JOIN latest_classifier_version lcv ON p.classifier_version = lcv.max_version\n    WHERE p.oid IN (SELECT oid FROM selected_objects)\n      AND p.class_name IN ('SNIa', 'CV/Nova')\n      AND p.classifier_name = 'lc_classifier'\n    GROUP BY p.oid\n)\n-- Final selection of objects where the difference between probabilities is less than 0.1\nSELECT o.oid,\n       p.SN_prob,\n       p.CV_prob\nFROM object o\nJOIN probabilities p ON o.oid = p.oid\nWHERE ABS(p.SN_prob - p.CV_prob) < 0.1;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1796, "completion_tokens": 360, "total_tokens": 2156, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d78e0c8190b57cd8c48cb70a61", "custom_id": "15-0", "response": {"status_code": 200, "request_id": "b7c98c941eb8a61b86b93e48e9e32cb5", "body": {"id": "chatcmpl-BhN04zsrZr5Xg2uxKG8M8cBEYlRep", "object": "chat.completion", "created": 1749676216, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object identifiers, highest stamp classifier probability for class 'SN', light curve detections, filter IDs, candid, magstat filter ID, and initial rise estimate\nWITH object_candidates AS (\n    SELECT\n        o.oid,\n        -- Get the top probability for stamp_classifier where class_name='SN' and ranking=1\n        (SELECT p.probability\n         FROM probability p\n         WHERE p.oid = o.oid\n           AND p.class_name = 'SN'\n           AND p.classifier_name = 'stamp_classifier'\n           AND p.ranking = 1\n         LIMIT 1) AS stamp_sn_prob,\n        -- Get the first detection in the first 2 days of September (mjd between 60188.0 and 60190.0)\n        (SELECT MIN(d.mjd)\n         FROM detection d\n         WHERE d.oid = o.oid\n           AND d.mjd BETWEEN 60188.0 AND 60190.0) AS first_detection_mjd\n    FROM object o\n),\nfast_risers AS (\n    SELECT\n        ac.oid,\n        ac.stamp_sn_prob,\n        ac.first_detection_mjd,\n        -- Get the filter ID of the first detection\n        (SELECT d.fid\n         FROM detection d\n         WHERE d.oid = ac.oid AND d.mjd = ac.first_detection_mjd\n         LIMIT 1) AS first_fid,\n        -- Get the last non-detection magnitude before the first detection in the same filter\n        (SELECT magstat.magmax_corr\n         FROM magstat\n         WHERE magstat.oid = ac.oid\n           AND magstat.firstmjd < ac.first_detection_mjd\n           AND magstat.ndet > 0\n           AND magstat.mjdendhist < ac.first_detection_mjd\n           AND magstat.fid = (SELECT d.fid FROM detection d WHERE d.oid = ac.oid AND d.mjd = ac.first_detection_mjd LIMIT 1)\n         ORDER BY magstat.mjdendhist DESC\n         LIMIT 1) AS last_non_detection_mag,\n        -- Get the last mjd of non-detections in the same filter before first detection\n        (SELECT magstat.lastmjd\n         FROM magstat\n         WHERE magstat.oid = ac.oid\n           AND magstat.ndet > 0\n           AND magstat.firstmjd < ac.first_detection_mjd\n           AND magstat.fid = (SELECT d.fid FROM detection d WHERE d.oid = ac.oid AND d.mjd = ac.first_detection_mjd LIMIT 1)\n         ORDER BY magstat.lastmjd DESC\n         LIMIT 1) AS last_mjd_non_detection\n    FROM object_candidates ac\n    WHERE ac.first_detection_mjd IS NOT NULL\n),\ninitial_rise AS (\n    SELECT\n        fr.oid,\n        -- Calculate the initial rise rate: (magmax_corr - last_non_detection_mag) / (first_detection_mjd - last_mjd_non_detection)\n        -- Ensure denominator is positive to avoid division by zero\n        CASE WHEN fr.last_mjd_non_detection IS NOT NULL AND (fr.first_detection_mjd - fr.last_mjd_non_detection) > 0\n             THEN (fr.magmax_corr - fr.last_non_detection_mag) / (fr.first_detection_mjd - fr.last_mjd_non_detection)\n             ELSE NULL\n        END AS initial_rise_rate\n    FROM fast_risers fr\n    WHERE fr.last_non_detection_mag IS NOT NULL\n      AND fr.last_mjd_non_detection IS NOT NULL\n      AND (fr.first_detection_mjd - fr.last_mjd_non_detection) > 0\n)\nSELECT\n    o.oid,\n    -- Get the maximum stamp classifier probability for class 'SN'\n    (SELECT p.probability\n     FROM probability p\n     WHERE p.oid = o.oid\n       AND p.class_name = 'SN'\n       AND p.classifier_name = 'stamp_classifier'\n     ORDER BY p.ranking\n     LIMIT 1) AS stamp_classifier_prob,\n    -- Get detections for the object\n    d.candid,\n    d.fid AS detection_fid,\n    -- Get the filter ID from magstat as 'magstat_fid'\n    ms.fid AS magstat_fid,\n    -- Initial rise rate\n    ir.initial_rise_rate\nFROM object o\nJOIN detection d ON d.oid = o.oid\nJOIN magstat ms ON ms.oid = o.oid AND ms.fid = d.fid\nJOIN object_candidates oc ON oc.oid = o.oid\nJOIN initial_rise ir ON ir.oid = o.oid\nWHERE\n    -- Highest probability in stamp classifier is for class 'SN' (probability > 0)\n    (SELECT p.probability\n     FROM probability p\n     WHERE p.oid = o.oid\n       AND p.class_name = 'SN'\n       AND p.classifier_name = 'stamp_classifier'\n     ORDER BY p.ranking\n     LIMIT 1) IS NOT NULL\n    AND -- First detection in the first 2 days of September\n    oc.first_detection_mjd BETWEEN 60188.0 AND 60190.0\n    AND -- Object qualifies as a fast riser (initial rise rate >= 0.25 mag/day)\n    ir.initial_rise_rate >= 0.25\nORDER BY o.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 4594, "completion_tokens": 1122, "total_tokens": 5716, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d7df6881909aea5e00cde87f56", "custom_id": "15-1", "response": {"status_code": 200, "request_id": "29b686e9c9d2f35ac4bed3e6f377ecf6", "body": {"id": "chatcmpl-BhN06iwIuuVAodmiRbUaiSOAxKPrt", "object": "chat.completion", "created": 1749676218, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object identifiers, probabilities for class SN in stamp classifier, light curve detections, and initial rise estimate\nWITH first_detections AS (\n    -- Select objects with first detection in the first 2 days of September 2023 (MJD 60188.0 to 60189.0)\n    SELECT\n        o.oid,\n        o.firstmjd,\n        o.ndet,\n        o.meanra,\n        o.meandec\n    FROM object o\n    WHERE o.firstmjd BETWEEN 60188.0 AND 60189.0\n),\nmax_stamp_prob AS (\n    -- Select objects with highest probability for class SN in stamp classifier (ranking=1)\n    SELECT\n        p.oid,\n        p.probability\n    FROM probability p\n    WHERE p.class_name = 'SN'\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.ranking = 1\n),\ndetections AS (\n    -- All detections for objects\n    SELECT\n        d.candid,\n        d.oid,\n        d.mjd,\n        d.fid,\n        d.magpsf,\n        d.sigmapsf,\n        d.ra,\n        d.dec\n    FROM detection d\n),\nmagstats AS (\n    -- Magstat info for objects, including magfirst and firstmjd per band\n    SELECT\n        m.oid,\n        m.fid AS magstat_fid,\n        m.magmean,\n        m.magfirst,\n        m.magsigma,\n        m.firstmjd\n    FROM magstat m\n),\ninitial_rise AS (\n    -- Calculate initial rise rate for detections at first detection epoch\n    SELECT\n        d.oid,\n        d.candid,\n        d.fid,\n        d.mjd,\n        d.magpsf,\n        d.sigmapsf,\n        m.magfirst,\n        m.firstmjd,\n        -- Compute rise rate: change in magnitude over time from first detection\n        (m.magfirst - d.magpsf) / NULLIF((m.firstmjd - d.mjd), 0) AS rise_rate\n    FROM detections d\n    JOIN magstats m ON d.oid = m.oid AND d.fid = m.fid\n    WHERE d.mjd = m.firstmjd\n),\nfast_risers AS (\n    -- Filter for objects with rise rate >= 0.25 mag/day\n    SELECT\n        ir.oid,\n        ir.candid,\n        ir.fid,\n        ir.mjd,\n        ir.magpsf,\n        ir.sigmapsf,\n        ir.rise_rate\n    FROM initial_rise ir\n    WHERE ir.rise_rate >= 0.25\n)\n-- Final selection combining all info\nSELECT\n    fd.oid,\n    mp.probability AS stamp_classifier_probability,\n    d.candid,\n    d.fid,\n    m.magstat_fid,\n    fr.rise_rate AS initial_rise_estimate\nFROM first_detections fd\nJOIN max_stamp_prob mp ON fd.oid = mp.oid\nJOIN detections d ON fd.oid = d.oid AND d.mjd = fd.firstmjd\nJOIN magstats m ON fd.oid = m.oid AND d.fid = m.fid\nJOIN fast_risers fr ON fd.oid = fr.oid\nORDER BY fd.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3483, "completion_tokens": 694, "total_tokens": 4177, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d7fb68819095c1730647c20f9b", "custom_id": "15-2", "response": {"status_code": 200, "request_id": "867ea64197982cc92877120aefdbeae2", "body": {"id": "chatcmpl-BhN08MEITPWxlfwzCUfhEddPqk4M5", "object": "chat.completion", "created": 1749676220, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object identifiers, highest stamp classifier probability for class 'SN', light curve detections, and initial rise estimate\nWITH stamp_probs AS (\n    SELECT\n        p.oid,\n        p.probability AS stamp_prob,\n        p.ranking\n    FROM\n        probability p\n    WHERE\n        p.class_name = 'SN'\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.ranking = 1\n),\nmax_stamp_probs AS (\n    SELECT\n        oid,\n        stamp_prob\n    FROM\n        stamp_probs\n),\nfirst_detection AS (\n    SELECT\n        o.oid,\n        o.firstmjd\n    FROM\n        object o\n    WHERE\n        o.firstmjd BETWEEN 60188.0 AND 60189.0\n),\ndetections AS (\n    SELECT\n        d.candid,\n        d.oid,\n        d.fid,\n        d.mjd,\n        d.magpsf,\n        d.sigmapsf,\n        d.ra,\n        d.dec\n    FROM\n        detection d\n    WHERE\n        d.oid IN (SELECT oid FROM first_detection)\n),\nmagstat_info AS (\n    SELECT\n        m.oid,\n        m.fid AS magstat_fid,\n        m.magmean,\n        m.magfirst,\n        m.magsigma,\n        m.firstmjd\n    FROM\n        magstat m\n),\ninitial_rise AS (\n    SELECT\n        d.oid,\n        d.candid,\n        d.fid,\n        d.mjd,\n        d.magpsf,\n        d.sigmapsf,\n        m.magfirst,\n        m.firstmjd,\n        -- Calculate the initial rise as the difference in magnitude divided by the time difference\n        CASE\n            WHEN\n                -- Find previous detection for the same object and candidate\n                (SELECT mjd FROM detection d2 WHERE d2.candid = d.candid AND d2.oid = d.oid AND d2.mjd < d.mjd ORDER BY d2.mjd DESC LIMIT 1) IS NOT NULL\n            THEN\n                -- Compute the difference in magnitude over the time difference\n                (d.magpsf - m.magfirst) / ((d.mjd) - (SELECT mjd FROM detection d2 WHERE d2.candid = d.candid AND d2.oid = d.oid AND d2.mjd < d.mjd ORDER BY d2.mjd DESC LIMIT 1))\n            ELSE NULL\n        END AS initial_rise_estimate\n    FROM\n        detections d\n    JOIN\n        magstat_info m ON d.oid = m.oid\n    WHERE\n        d.mjd = (\n            SELECT MIN(mjd)\n            FROM detection d2\n            WHERE d2.oid = d.oid AND d2.mjd >= 60188.0 AND d2.mjd <= 60189.0\n        )\n)\nSELECT\n    sp.oid,\n    sp.stamp_prob,\n    d.candid,\n    d.fid,\n    d.mjd,\n    d.magpsf,\n    d.sigmapsf,\n    m.magstat_fid,\n    ir.initial_rise_estimate\nFROM\n    max_stamp_probs sp\nJOIN\n    first_detection fd ON sp.oid = fd.oid\nJOIN\n    detection d ON sp.oid = d.oid\nJOIN\n    magstat m ON d.oid = m.oid AND d.fid = m.fid\nJOIN\n    initial_rise ir ON d.oid = ir.oid AND d.candid = ir.candid\nWHERE\n    sp.stamp_prob = (\n        SELECT MAX(stamp_prob) FROM max_stamp_probs WHERE oid = sp.oid\n    )\n    AND sp.oid IN (\n        SELECT oid FROM probability\n        WHERE class_name = 'SN'\n          AND classifier_name = 'stamp_classifier'\n          AND ranking = 1\n    )\n    AND fd.firstmjd BETWEEN 60188.0 AND 60189.0\n    -- Ensure the object qualifies as a fast riser: magnitude increase >= 25% of the time interval\n    AND (\n        (m.magfirst - (\n            SELECT magpsf FROM detection d2\n            WHERE d2.candid = d.candid AND d2.oid = d.oid AND d2.mjd < d.mjd\n            ORDER BY d2.mjd DESC LIMIT 1\n        )) >= 0.25 * (\n            d.mjd - (\n                SELECT mjd FROM detection d2\n                WHERE d2.candid = d.candid AND d2.oid = d.oid AND d2.mjd < d.mjd\n                ORDER BY d2.mjd DESC LIMIT 1\n            )\n        )\n    )\nORDER BY\n    sp.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 4174, "completion_tokens": 988, "total_tokens": 5162, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d812e88190b26097993867a046", "custom_id": "15-3", "response": {"status_code": 200, "request_id": "98421d0e8d9ce033b857d684cbc15c03", "body": {"id": "chatcmpl-BhN041kcoVWfkrCgye4q1ubHA9mZ4", "object": "chat.completion", "created": 1749676216, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object identifiers, highest stamp classifier probability for class 'SN', light curve detections, filter IDs, candid, magstat filter ID, and initial rise estimate\nWITH stamp_probs AS (\n    SELECT p.oid,\n           p.probability AS stamp_prob,\n           p.ranking\n    FROM probability p\n    WHERE p.class_name = 'SN'\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.ranking = 1\n),\nmax_stamp_probs AS (\n    SELECT oid,\n           stamp_prob\n    FROM stamp_probs\n),\nfirst_detections AS (\n    SELECT o.oid,\n           o.firstmjd\n    FROM object o\n    WHERE o.firstmjd BETWEEN 60188.0 AND 60189.0\n),\ndetections_in_time AS (\n    SELECT d.candid,\n           d.oid,\n           d.fid,\n           d.mjd,\n           d.magpsf,\n           d.sigmapsf,\n           d.ra,\n           d.dec\n    FROM detection d\n    JOIN first_detections fd ON d.oid = fd.oid\n    WHERE d.mjd = fd.firstmjd\n),\nmagstat_in_time AS (\n    SELECT m.oid,\n           m.fid AS magstat_fid,\n           m.magmean,\n           m.magfirst\n    FROM magstat m\n    WHERE m.oid IN (SELECT oid FROM first_detections)\n),\ninitial_rise AS (\n    SELECT d.oid,\n           d.fid,\n           d.candid,\n           d.mjd,\n           d.magpsf,\n           d.sigmapsf,\n           d.ra,\n           d.dec,\n           -- Calculate the initial rise as the difference between the first detection magnitude and the magfirst from magstat\n           (m.magfirst - d.magpsf) / NULLIF((d.mjd - fd.firstmjd), 0) AS initial_rise\n    FROM detections_in_time d\n    JOIN magstat_in_time m ON d.oid = m.oid AND d.fid = m.fid\n    JOIN first_detections fd ON d.oid = fd.oid\n),\nfast_risers AS (\n    SELECT o.oid,\n           sp.stamp_prob,\n           d.candid,\n           d.fid,\n           m.magstat_fid,\n           ir.initial_rise\n    FROM first_detections o\n    JOIN max_stamp_probs sp ON o.oid = sp.oid\n    JOIN detections_in_time d ON o.oid = d.oid\n    JOIN magstat_in_time m ON o.oid = m.oid AND d.fid = m.fid\n    JOIN initial_rise ir ON d.oid = ir.oid AND d.candid = ir.candid\n    WHERE sp.stamp_prob = (SELECT MAX(stamp_prob) FROM stamp_probs WHERE oid = o.oid)\n      AND sp.ranking = 1\n      AND ir.initial_rise >= 0.25\n)\nSELECT\n    oid,\n    stamp_prob,\n    candid,\n    fid,\n    magstat_fid,\n    initial_rise\nFROM fast_risers\nORDER BY oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3737, "completion_tokens": 650, "total_tokens": 4387, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d82c2c8190a6accfad089a3a79", "custom_id": "4-0", "response": {"status_code": 200, "request_id": "0549d1d972978b4d93027e966b077ab8", "body": {"id": "chatcmpl-BhN06t7nPming9Jjrt0KnE1qnuPog", "object": "chat.completion", "created": 1749676218, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object and detection details for SN II objects with specified conditions\nWITH sn2_objects AS (\n    SELECT o.oid\n    FROM object o\n    JOIN probability p ON o.oid = p.oid\n    WHERE p.class_name = 'SNIIn' -- SN II class\n      AND p.classifier_name = 'lc_classifier'\n      AND p.probability > 0.6\n      AND p.ranking = 1\n      AND o.firstmjd BETWEEN 2458600 AND 2459580 -- years 2019-2022 in MJD\n      AND o.ndet > 50\n),\nsn2_detections AS (\n    SELECT d.candid, d.oid, d.mjd, d.magpsf, d.sigmapsf, d.ra, d.dec, d.fid\n    FROM detection d\n    JOIN sn2_objects so ON d.oid = so.oid\n)\nSELECT\n    d.oid,\n    d.candid,\n    d.mjd,\n    d.magpsf,\n    d.sigmapsf,\n    -- Use window functions to get first detection time and magnitude per object\n    FIRST_VALUE(d.mjd) OVER (PARTITION BY d.oid ORDER BY d.mjd) AS first_mjd,\n    FIRST_VALUE(d.magpsf) OVER (PARTITION BY d.oid ORDER BY d.mjd) AS first_mag,\n    -- Calculate initial rise rate (mag/day) if at least two detections exist\n    CASE\n        WHEN COUNT(*) OVER (PARTITION BY d.oid) >= 2 THEN\n            (\n                LAST_VALUE(d.magpsf) OVER (PARTITION BY d.oid ORDER BY d.mjd) - FIRST_VALUE(d.magpsf) OVER (PARTITION BY d.oid ORDER BY d.mjd)\n            ) / (\n                LAST_VALUE(d.mjd) OVER (PARTITION BY d.oid ORDER BY d.mjd) - FIRST_VALUE(d.mjd) OVER (PARTITION BY d.oid ORDER BY d.mjd)\n            )\n        ELSE NULL\n    END AS initial_rise_rate,\n    d.fid\nFROM sn2_detections d\nWHERE\n    -- Filter for g (fid=1) and r (fid=2) bands\n    d.fid IN (1, 2)\n    -- Ensure initial rise rate exceeds 0.5 mag/day\n    AND (\n        CASE\n            WHEN COUNT(*) OVER (PARTITION BY d.oid) >= 2 THEN\n                (\n                    LAST_VALUE(d.magpsf) OVER (PARTITION BY d.oid ORDER BY d.mjd) - FIRST_VALUE(d.magpsf) OVER (PARTITION BY d.oid ORDER BY d.mjd)\n                ) / (\n                    LAST_VALUE(d.mjd) OVER (PARTITION BY d.oid ORDER BY d.mjd) - FIRST_VALUE(d.mjd) OVER (PARTITION BY d.oid ORDER BY d.mjd)\n                )\n            ELSE 0\n        END\n    ) > 0.5;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3500, "completion_tokens": 630, "total_tokens": 4130, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d84b008190873f453f6b311855", "custom_id": "4-2", "response": {"status_code": 200, "request_id": "beb7acf879503bba39565c9ac27ac0d6", "body": {"id": "chatcmpl-BhN055tCeKuSfsdtqdQ2ZvuujmipC", "object": "chat.completion", "created": 1749676217, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select relevant information for SN II objects with specified conditions\nWITH snii_objects AS (\n    SELECT o.oid\n    FROM object o\n    JOIN probability p ON o.oid = p.oid\n    WHERE p.class_name = 'SNII'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.probability > 0.6\n      AND p.ranking = 1\n      AND o.firstmjd BETWEEN 58484 AND 58824 -- Corresponds to years 2019-2022\n),\nsnii_candidates AS (\n    SELECT c.candid,\n           c.oid,\n           c.mjd,\n           c.ra,\n           c.dec,\n           c.magpsf,\n           c.sigmapsf,\n           c.fid\n    FROM detection c\n    WHERE c.oid IN (SELECT oid FROM snii_objects)\n),\nmag_stats AS (\n    SELECT m.oid,\n           m.fid,\n           m.magmean,\n           m.magmean_corr,\n           m.dmdt_first\n    FROM magstat m\n    WHERE m.oid IN (SELECT oid FROM snii_objects)\n),\ndetections_count AS (\n    SELECT oid,\n           COUNT(*) AS ndet\n    FROM detection\n    GROUP BY oid\n)\n-- Main query to retrieve desired info with filters\nSELECT \n    c.oid,\n    c.candid,\n    c.mjd,\n    c.magpsf,\n    c.sigmapsf,\n    c.fid AS band_id,\n    m.magmean,\n    m.magmean_corr,\n    m.dmdt_first AS initial_rise_rate,\n    d.ndet\nFROM snii_candidates c\nJOIN mag_stats m ON c.oid = m.oid AND c.fid = m.fid\nJOIN detections_count d ON c.oid = d.oid\nWHERE d.ndet > 50\n  AND c.mjd BETWEEN 58484 AND 58824\n  AND m.dmdt_first > 0.5\n  AND c.fid IN (1, 2); -- g and r bands\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3227, "completion_tokens": 430, "total_tokens": 3657, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d86ea081908b0ad5280a68afc8", "custom_id": "4-3", "response": {"status_code": 200, "request_id": "505439da5c68f3486bb9787721f0e3f5", "body": {"id": "chatcmpl-BhN08zLTER5xtkXGgsLI3PTWNweOJ", "object": "chat.completion", "created": 1749676220, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select relevant information for SN II objects with specified conditions, optimized for performance\nWITH snii_objects AS (\n    -- Get object OIDs with classification as SN II, probability > 0.6, and ranking=1, with additional probability conditions\n    SELECT p.oid\n    FROM probability p\n    WHERE p.class_name = 'SNIi'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.probability > 0.6\n      AND p.ranking = 1\n      AND p.probability IS NOT NULL -- ensure probability is not null\n),\nfiltered_objects AS (\n    -- Filter objects with more than 50 detections\n    SELECT o.oid\n    FROM object o\n    WHERE o.ndet > 50\n),\ncandidate_ids AS (\n    -- Get candidate IDs for objects in filtered_objects\n    SELECT d.candid, d.oid, d.mjd, d.fid, d.magpsf, d.sigmapsf, d.ra, d.dec\n    FROM detection d\n    WHERE d.oid IN (SELECT oid FROM filtered_objects)\n),\nlight_curve_stats AS (\n    -- Calculate first and last detection times and magnitudes per object and band\n    SELECT\n        c.oid,\n        c.candid,\n        c.mjd,\n        c.fid,\n        c.magpsf,\n        c.sigmapsf,\n        c.ra,\n        c.dec,\n        -- First detection time per object and band\n        FIRST_VALUE(c.mjd) OVER (PARTITION BY c.oid, c.fid ORDER BY c.mjd) AS first_mjd,\n        -- First detection magnitude per object and band\n        FIRST_VALUE(c.magpsf) OVER (PARTITION BY c.oid, c.fid ORDER BY c.mjd) AS first_mag,\n        -- Last detection time per object and band\n        LAST_VALUE(c.mjd) OVER (PARTITION BY c.oid, c.fid ORDER BY c.mjd ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS last_mjd,\n        -- Last detection magnitude per object and band\n        LAST_VALUE(c.magpsf) OVER (PARTITION BY c.oid, c.fid ORDER BY c.mjd ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS last_mag\n    FROM candidate_ids c\n),\nrise_rates AS (\n    -- Calculate initial rise rate (mag/day) for each object and band, avoiding division by zero\n    SELECT\n        oid,\n        candid,\n        first_mjd,\n        last_mjd,\n        first_mag,\n        last_mag,\n        CASE WHEN (last_mjd - first_mjd) > 0 THEN (last_mag - first_mag) / (last_mjd - first_mjd) ELSE NULL END AS rise_rate\n    FROM light_curve_stats\n),\nfinal_objects AS (\n    -- Filter objects with rise rate > 0.5 mag/day\n    SELECT DISTINCT o.oid\n    FROM rise_rates o\n    WHERE o.rise_rate > 0.5\n)\n-- Final selection of detection details for objects matching all criteria\nSELECT\n    d.oid,\n    d.candid,\n    d.mjd,\n    d.fid,\n    d.magpsf,\n    d.sigmapsf,\n    d.ra,\n    d.dec\nFROM detection d\nWHERE d.oid IN (SELECT oid FROM final_objects)\n  AND d.mjd BETWEEN 2019 AND 2022\n  AND d.fid IN (1, 2) -- g and r bands\n  AND EXISTS (\n      SELECT 1\n      FROM probability p\n      WHERE p.oid = d.oid\n        AND p.class_name = 'SNIi'\n        AND p.classifier_name = 'lc_classifier'\n        AND p.probability > 0.6\n        AND p.ranking = 1\n        AND p.probability IS NOT NULL -- ensure probability is valid\n  )\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3826, "completion_tokens": 826, "total_tokens": 4652, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d8890c8190b67bf817c033a873", "custom_id": "25-1", "response": {"status_code": 200, "request_id": "1564bede1fa2512a0a5e080e4ea95167", "body": {"id": "chatcmpl-BhN08Xyfv603QfXI2w6cp4essfVmt", "object": "chat.completion", "created": 1749676220, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Define source positions with their names, RA, and Dec\nWITH sources AS (\n    SELECT * FROM (VALUES\n        ('source_1', 160.18301441363647, 33.0164673528409),\n        ('source_2', 174.21524897555543, 44.83789535222221)\n    ) AS s(source_name, ra, dec)\n),\n-- Select objects with SN class probability > 0.4, ranking=1, and classifier 'stamp_classifier'\nobject_with_prob AS (\n    SELECT o.oid, p.class_name, p.probability, p.ranking, p.classifier_name\n    FROM object o\n    JOIN probability p ON o.oid = p.oid\n    WHERE p.classifier_name = 'stamp_classifier'\n      AND p.class_name = 'SN'\n      AND p.probability > 0.4\n      AND p.ranking = 1\n),\n-- Find objects within 10 degrees of each source position\nobjects_near_sources AS (\n    SELECT o.*\n    FROM object o\n    CROSS JOIN sources s\n    WHERE -- Use q3c_join for angular distance within 10 degrees\n        q3c_join(o.meanra, o.meandec, s.ra, s.dec, 10)\n),\n-- Filter objects whose first detection (firstmjd) is within the first 7 days of February 2023\nobjects_in_time_window AS (\n    SELECT o.*\n    FROM object o\n    WHERE o.firstmjd BETWEEN 59976.0 AND 59983.0\n)\n-- Final selection: objects near sources, with SN probability > 0.4, ranking=1, and first detection in the specified time window\nSELECT DISTINCT o.*\nFROM objects_near_sources o\nJOIN object_with_prob p ON o.oid = p.oid\nWHERE o.firstmjd BETWEEN 59976.0 AND 59983.0;", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1888, "completion_tokens": 401, "total_tokens": 2289, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d8a2808190a94c630ad5002320", "custom_id": "7-0", "response": {"status_code": 200, "request_id": "d43cfd6ac5e6e9442fdc464f720c3abd", "body": {"id": "chatcmpl-BhN082OGmahdgs8uPYgsKZ2qizGrt", "object": "chat.completion", "created": 1749676220, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object identifiers and probabilities for objects with most likely class 'SN' in stamp_classifier\nWITH stamp_objects AS (\n    SELECT\n        o.oid,\n        p.probability\n    FROM\n        object o\n    -- Join with probability table to find the top-ranked 'SN' classification for each object\n    JOIN\n        probability p ON o.oid = p.oid\n    WHERE\n        -- Filter objects with first detection in January 2023 (MJD between 59945.0 and 59975.0)\n        o.firstmjd BETWEEN 59945.0 AND 59975.0\n        -- Ensure the probability entry corresponds to class 'SN', classifier 'stamp_classifier', and top rank\n        AND p.class_name = 'SN'\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.ranking = 1\n)\n-- Select object IDs and their corresponding probabilities\nSELECT\n    so.oid,\n    so.probability\nFROM\n    stamp_objects so;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1523, "completion_tokens": 212, "total_tokens": 1735, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d8c3648190b0eb3a5da10a8815", "custom_id": "7-2", "response": {"status_code": 200, "request_id": "398d9afb38c67c89c2f4627a16b5ab12", "body": {"id": "chatcmpl-BhN0BFFSebo31txr2xqtmRaDaSkUB", "object": "chat.completion", "created": 1749676223, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object IDs with the most probable class as 'SN' in the stamp_classifier\nWITH stamp_sn_objects AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.class_name = 'SN'\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.ranking = 1\n      AND p.probability > 0.5 -- Additional condition to ensure high confidence in classification\n),\n-- Select objects with first detection in January 2023 (MJD between 59945.0 and 59975.0)\nobjects_january_2023 AS (\n    SELECT o.oid\n    FROM object o\n    WHERE o.firstmjd BETWEEN 59945.0 AND 59975.0\n)\n-- Main query to get object IDs and probabilities for objects meeting both conditions\nSELECT p.oid, p.probability\nFROM probability p\n-- Join with the subquery for SN objects to optimize filtering\nJOIN stamp_sn_objects sso ON p.oid = sso.oid\n-- Join with the subquery for objects with first detection in January 2023\nJOIN objects_january_2023 ojan ON p.oid = ojan.oid\nWHERE p.classifier_name = 'stamp_classifier'\n  AND p.class_name = 'SN'\n  AND p.ranking = 1;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1531, "completion_tokens": 278, "total_tokens": 1809, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d8df848190b5127b1ae27bdc0a", "custom_id": "7-3", "response": {"status_code": 200, "request_id": "e66ae53fee066207a7a0c06cc419a18e", "body": {"id": "chatcmpl-BhN07FXe4kYp4RzKHD9oEH0yEgAys", "object": "chat.completion", "created": 1749676219, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object IDs with the most probable class as 'SN' in the stamp_classifier\nWITH stamp_sn_objects AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.class_name = 'SN'\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.ranking = 1\n      AND p.probability > 0.5 -- Additional condition to ensure high confidence in classification\n),\n-- Select objects with first detection in January 2023 (MJD between 59945.0 and 59975.0)\nobjects_january_2023 AS (\n    SELECT o.oid\n    FROM object o\n    WHERE o.firstmjd BETWEEN 59945.0 AND 59975.0\n)\n-- Main query to get object IDs and probabilities for objects meeting both conditions\nSELECT p.oid, p.probability\nFROM probability p\nWHERE p.oid IN (SELECT oid FROM stamp_sn_objects)\n  AND p.oid IN (SELECT oid FROM objects_january_2023)\n  AND p.classifier_name = 'stamp_classifier'\n  AND p.class_name = 'SN'\n  AND p.ranking = 1\n  AND p.probability > 0.5; -- Ensuring the probability indicates a confident classification\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1531, "completion_tokens": 266, "total_tokens": 1797, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d8fb9881908d802e56112d830f", "custom_id": "23-0", "response": {"status_code": 200, "request_id": "10011f8956a6dfa661fc9e0677041374", "body": {"id": "chatcmpl-BhN05QqAKU5ivBmJdhEq5XNGCAWgj", "object": "chat.completion", "created": 1749676217, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with their classification probabilities for specified classes\nWITH object_probabilities AS (\n    SELECT\n        p.oid,\n        p.class_name,\n        p.probability,\n        p.ranking\n    FROM\n        probability p\n    WHERE\n        p.classifier_name = 'lc_classifier'\n        AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n        AND p.probability > 0.2\n        AND p.ranking = 1 -- Focus on the most probable classification per object\n)\n-- Retrieve all probabilities for these objects and classes\nSELECT\n    o.oid,\n    p.class_name,\n    p.probability,\n    p.ranking\nFROM\n    object o\nJOIN\n    probability p ON o.oid = p.oid\nWHERE\n    p.oid IN (\n        SELECT DISTINCT oid FROM object_probabilities\n    )\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN') -- Ensure class filter consistency\n    AND p.probability > 0.2 -- Maintain probability threshold\n    AND p.ranking = 1 -- Limit to top-ranked classification for efficiency\nORDER BY\n    o.oid,\n    p.class_name,\n    p.ranking;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1515, "completion_tokens": 275, "total_tokens": 1790, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d9148c81908029b96bd146db2b", "custom_id": "23-1", "response": {"status_code": 200, "request_id": "11f3d47984b5cb2952c8b177e96e19be", "body": {"id": "chatcmpl-BhN067ivFwiyWOFuKi7RQ7jqpMcyh", "object": "chat.completion", "created": 1749676218, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with their classification probabilities for specified classes, optimizing for performance\nWITH object_probabilities AS (\n    SELECT\n        p.oid,\n        p.class_name,\n        p.probability,\n        p.ranking\n    FROM\n        probability p\n    WHERE\n        p.classifier_name = 'lc_classifier'\n        AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n        AND p.probability > 0.2\n        AND p.ranking = 1 -- Focus on the most probable classification per object\n)\n-- Retrieve object details along with their classification probabilities\nSELECT\n    o.oid,\n    o.firstmjd,\n    o.lastmjd,\n    o.ndet,\n    o.g_r_max,\n    o.meanra,\n    o.meandec,\n    op.class_name,\n    op.probability,\n    op.ranking\nFROM\n    object o\nJOIN\n    object_probabilities op ON o.oid = op.oid\n-- Optional: filter objects based on date ranges or other criteria if needed\nORDER BY\n    o.oid, op.ranking;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1511, "completion_tokens": 241, "total_tokens": 1752, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d9370481908f7f58dbc5016d38", "custom_id": "23-2", "response": {"status_code": 200, "request_id": "133312b101d05b3989f072d0f3f4bf26", "body": {"id": "chatcmpl-BhN084aBWeotFxuAcThEC6SX0Jpvb", "object": "chat.completion", "created": 1749676220, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with their classification probabilities for specified classes\nWITH object_probabilities AS (\n    SELECT\n        p.oid,\n        p.class_name,\n        p.probability,\n        p.ranking\n    FROM\n        probability p\n    WHERE\n        p.classifier_name = 'lc_classifier'\n        AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n        AND p.probability > 0.2\n        AND p.ranking = 1 -- Focus on the most likely classification per object\n)\n-- Retrieve all probabilities for these objects and classes\nSELECT\n    o.oid,\n    p.class_name,\n    p.probability,\n    p.ranking\nFROM\n    object o\nJOIN\n    probability p ON o.oid = p.oid\nWHERE\n    p.oid IN (\n        SELECT DISTINCT oid FROM object_probabilities\n    )\n    AND p.classifier_name = 'lc_classifier' -- Ensure classifier consistency\n    AND p.probability > 0.2 -- Maintain probability threshold\n    AND p.ranking = 1 -- Focus on the top-ranked classification\nORDER BY\n    o.oid,\n    p.ranking;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1505, "completion_tokens": 254, "total_tokens": 1759, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d9552881909090c83b13e59439", "custom_id": "23-3", "response": {"status_code": 200, "request_id": "bcd75edaf5401922ca7e3faf91e3d53d", "body": {"id": "chatcmpl-BhN0CQgV60QjQotR5QVOyj5QzEd3C", "object": "chat.completion", "created": 1749676224, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with the highest probability (ranking=1) for classes 'SNIa', 'SNIbc', 'SNII', 'SLSN' in 'lc_classifier' with probability > 0.2\nWITH top_probabilities AS (\n    SELECT\n        p.oid\n    FROM\n        probability p\n    WHERE\n        p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN') -- Target classes\n        AND p.classifier_name = 'lc_classifier' -- Specific classifier\n        AND p.probability > 0.2 -- Probability threshold\n        AND p.ranking = 1 -- Highest probability class per object\n    GROUP BY p.oid -- Ensure unique objects\n)\n-- Retrieve all probability entries for these objects to get full classification info\nSELECT\n    p.*\nFROM\n    probability p\nWHERE\n    p.oid IN (SELECT oid FROM top_probabilities);\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1470, "completion_tokens": 199, "total_tokens": 1669, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d97204819089f899644db2f5f9", "custom_id": "18-0", "response": {"status_code": 200, "request_id": "70bf17cd69746a7f2f1370e23c28e13c", "body": {"id": "chatcmpl-BhN0861R1s1bpJjiQYrz37aExtQmh", "object": "chat.completion", "created": 1749676220, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Query for AGN classification probabilities\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd AS firstMJD,\n    o.deltajd,\n    'lc_classifier' AS classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON p.oid = o.oid\nWHERE \n    o.ndet >= 40\n    AND o.deltajd >= 200\n    AND p.class_name = 'AGN'\n    AND p.classifier_name = 'lc_classifier'\n    AND p.probability > 0.95\n    AND p.ranking = 1\n    AND EXISTS (\n        SELECT 1 FROM probability p2\n        WHERE p2.oid = o.oid\n          AND p2.class_name IN ('QSO', 'Blazar')\n          AND p2.classifier_name = 'lc_classifier'\n          AND p2.probability > 0.8\n          AND p2.ranking = 1\n    )\nUNION\n-- Query for QSO classification probabilities\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd AS firstMJD,\n    o.deltajd,\n    'lc_classifier' AS classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON p.oid = o.oid\nWHERE \n    o.ndet >= 40\n    AND o.deltajd >= 200\n    AND p.class_name = 'QSO'\n    AND p.classifier_name = 'lc_classifier'\n    AND p.probability > 0.95\n    AND p.ranking = 1\n    AND EXISTS (\n        SELECT 1 FROM probability p2\n        WHERE p2.oid = o.oid\n          AND p2.class_name IN ('AGN', 'Blazar')\n          AND p2.classifier_name = 'lc_classifier'\n          AND p2.probability > 0.8\n          AND p2.ranking = 1\n    )\nUNION\n-- Query for Blazar classification probabilities\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd AS firstMJD,\n    o.deltajd,\n    'lc_classifier' AS classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON p.oid = o.oid\nWHERE \n    o.ndet >= 40\n    AND o.deltajd >= 200\n    AND p.class_name = 'Blazar'\n    AND p.classifier_name = 'lc_classifier'\n    AND p.probability > 0.8\n    AND p.ranking = 1\n    AND EXISTS (\n        SELECT 1 FROM probability p2\n        WHERE p2.oid = o.oid\n          AND p2.class_name IN ('AGN', 'QSO')\n          AND p2.classifier_name = 'lc_classifier'\n          AND p2.probability > 0.95\n          AND p2.ranking = 1\n    );\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3040, "completion_tokens": 691, "total_tokens": 3731, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d991ac8190a8ffaad307971c88", "custom_id": "18-1", "response": {"status_code": 200, "request_id": "7e88afcec9b492c8dffb490d9cae2b1c", "body": {"id": "chatcmpl-BhN0FvTGzfMixZ32DNhGBFVAgqvcg", "object": "chat.completion", "created": 1749676227, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Query for AGN sources\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd AS firstMJD,\n    o.deltajd,\n    'lc_classifier' AS classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON p.oid = o.oid\nWHERE \n    o.ndet >= 40\n    AND o.mjdendhist - o.mjdstarthist >= 200\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name = 'AGN'\n    AND p.probability > 0.95\n    AND p.ranking = 1\n\nUNION\n\n-- Query for QSO sources\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd AS firstMJD,\n    o.deltajd,\n    'lc_classifier' AS classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON p.oid = o.oid\nWHERE \n    o.ndet >= 40\n    AND o.mjdendhist - o.mjdstarthist >= 200\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name = 'QSO'\n    AND p.probability > 0.95\n    AND p.ranking = 1\n\nUNION\n\n-- Query for Blazar sources\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd AS firstMJD,\n    o.deltajd,\n    'lc_classifier' AS classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON p.oid = o.oid\nWHERE \n    o.ndet >= 40\n    AND o.mjdendhist - o.mjdstarthist >= 200\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name = 'Blazar'\n    AND p.probability > 0.8\n    AND p.ranking = 1;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2678, "completion_tokens": 483, "total_tokens": 3161, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d9ad248190bfbe43f222942aa8", "custom_id": "18-2", "response": {"status_code": 200, "request_id": "504d1c64a840288f764fbe54934f3774", "body": {"id": "chatcmpl-BhN0EEGGYq3JiEPjq0Q8caHnH2mQA", "object": "chat.completion", "created": 1749676226, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Query for AGN sources\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    'lc_classifier' AS classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON o.oid = p.oid\nWHERE \n    o.ndet >= 40\n    AND o.deltajd >= 200\n    AND p.class_name = 'AGN'\n    AND p.classifier_name = 'lc_classifier'\n    AND p.probability > 0.95\n    AND p.ranking = 1\n\nUNION\n\n-- Query for QSO sources\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    'lc_classifier' AS classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON o.oid = p.oid\nWHERE \n    o.ndet >= 40\n    AND o.deltajd >= 200\n    AND p.class_name = 'QSO'\n    AND p.classifier_name = 'lc_classifier'\n    AND p.probability > 0.95\n    AND p.ranking = 1\n\nUNION\n\n-- Query for Blazar sources\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    'lc_classifier' AS classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON o.oid = p.oid\nWHERE \n    o.ndet >= 40\n    AND o.deltajd >= 200\n    AND p.class_name = 'Blazar'\n    AND p.classifier_name = 'lc_classifier'\n    AND p.probability > 0.8\n    AND p.ranking = 1;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2847, "completion_tokens": 450, "total_tokens": 3297, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_f12167b370"}}, "error": null}
{"id": "batch_req_6849f0d9c4b08190b2b132f11f409e5b", "custom_id": "18-3", "response": {"status_code": 200, "request_id": "98b404bff82e883a450ecf1b9bfdd224", "body": {"id": "chatcmpl-BhN07tMXuZnFBKpIqhV8xheeBGVoZ", "object": "chat.completion", "created": 1749676219, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Query for AGN classification probabilities\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd AS firstMJD,\n    o.deltajd,\n    'lc_classifier' AS classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON p.oid = o.oid\nWHERE \n    o.ndet >= 40\n    AND o.deltajd >= 200\n    AND p.class_name = 'AGN'\n    AND p.classifier_name = 'lc_classifier'\n    AND p.probability > 0.95\n    AND p.ranking = 1\n    AND EXISTS (\n        SELECT 1 FROM probability p2\n        WHERE p2.oid = o.oid\n          AND p2.class_name IN ('QSO', 'Blazar')\n          AND p2.classifier_name = 'lc_classifier'\n          AND p2.probability > 0.8\n          AND p2.ranking = 1\n    )\nUNION\n-- Query for QSO classification probabilities\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd AS firstMJD,\n    o.deltajd,\n    'lc_classifier' AS classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON p.oid = o.oid\nWHERE \n    o.ndet >= 40\n    AND o.deltajd >= 200\n    AND p.class_name = 'QSO'\n    AND p.classifier_name = 'lc_classifier'\n    AND p.probability > 0.95\n    AND p.ranking = 1\n    AND EXISTS (\n        SELECT 1 FROM probability p2\n        WHERE p2.oid = o.oid\n          AND p2.class_name IN ('AGN', 'Blazar')\n          AND p2.classifier_name = 'lc_classifier'\n          AND p2.probability > 0.8\n          AND p2.ranking = 1\n    )\nUNION\n-- Query for Blazar classification probabilities\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd AS firstMJD,\n    o.deltajd,\n    'lc_classifier' AS classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON p.oid = o.oid\nWHERE \n    o.ndet >= 40\n    AND o.deltajd >= 200\n    AND p.class_name = 'Blazar'\n    AND p.classifier_name = 'lc_classifier'\n    AND p.probability > 0.8\n    AND p.ranking = 1\n    AND EXISTS (\n        SELECT 1 FROM probability p2\n        WHERE p2.oid = o.oid\n          AND p2.class_name IN ('AGN', 'QSO')\n          AND p2.classifier_name = 'lc_classifier'\n          AND p2.probability > 0.95\n          AND p2.ranking = 1\n    );\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3040, "completion_tokens": 691, "total_tokens": 3731, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0d9de488190b918a95862b391cb", "custom_id": "11-0", "response": {"status_code": 200, "request_id": "c2d8360e09a1b890e8facbb380d4f6af", "body": {"id": "chatcmpl-BhN0CpTpgVvtRDF22Sj6qxHJ2az5S", "object": "chat.completion", "created": 1749676224, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Corrected SQL query based on provided schema and user conditions\nSELECT \n    o.oid,\n    -- Retrieve the maximum magnitude in the light curve for the object\n    f.magmax,\n    -- Retrieve the corrected maximum magnitude in the light curve for the object\n    f.magmax_corr,\n    -- Filter identifier (e.g., 'g-r_max_corr')\n    f.name AS filter_id\nFROM \n    object o\nJOIN \n    feature f ON o.oid = f.oid\nWHERE \n    -- Confirm the object is classified as SNIa with highest probability (ranking=1) in the 'lc_classifier'\n    EXISTS (\n        SELECT 1\n        FROM probability p\n        WHERE p.oid = o.oid\n          AND p.class_name = 'SNIa'\n          AND p.classifier_name = 'lc_classifier'\n          AND p.ranking = 1\n    )\n    -- First detection occurred last September (assuming 2023: mjd between 60188 and 60217)\n    AND o.firstmjd BETWEEN 60188 AND 60217\n    -- Peak magnitude in the light curve is brighter than 19\n    AND f.magmax < 19\n    -- Focus on the feature representing g-r color at maximum (corrected)\n    AND f.name = 'g-r_max_corr'\n    -- g-r color at maximum is below 1\n    AND f.value < 1;", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 5116, "completion_tokens": 293, "total_tokens": 5409, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0da02c0819081a164be92762e88", "custom_id": "11-1", "response": {"status_code": 200, "request_id": "077af2cc1105171bfb831eebcae7c6bb", "body": {"id": "chatcmpl-BhN098xOODR2fLet2b3vH4rgmTrQR", "object": "chat.completion", "created": 1749676221, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Corrected SQL query with proper table references and aliases, ensuring all columns are correctly referenced\n-- and subqueries are properly joined. Also, added comments for clarity.\n\n-- Select objects classified as SNe Ia with specific conditions\nWITH first_detection_september AS (\n    -- Find objects with first detection in r-band last September\n    SELECT o.oid\n    FROM object o\n    JOIN magstat m ON o.oid = m.oid\n    WHERE m.fid = 2 -- r-band\n      AND o.firstmjd BETWEEN 60188.0 AND 60217.0 -- last September date range\n),\nsn_classification AS (\n    -- Select objects classified as SNIa with top ranking\n    SELECT p.oid\n    FROM probability p\n    WHERE p.class_name = 'SNIa'\n      AND p.classifier_name IN ('lc_classifier', 'lc_classifier_top', 'lc_classifier_transient', 'lc_classifier_stochastic', 'lc_classifier_periodic')\n      AND p.ranking = 1\n),\npeak_magnitude AS (\n    -- Find objects with maximum magnitude (peak brightness) below 19\n    SELECT oid, magmax AS max_mag\n    FROM magstat\n    WHERE magmax < 19\n),\ng_r_color AS (\n    -- Select objects with g-r color at maximum less than 1\n    SELECT o.oid, o.g_r_max\n    FROM object o\n    WHERE o.g_r_max < 1\n)\n-- Main query: join all conditions to get desired objects\nSELECT o.oid, o.g_r_max, pm.max_mag, m.fid\nFROM object o\n-- Join with first detection in September\nJOIN first_detection_september fds ON o.oid = fds.oid\n-- Join with classification as SNIa\nJOIN sn_classification sc ON o.oid = sc.oid\n-- Join with peak magnitude condition\nJOIN peak_magnitude pm ON o.oid = pm.oid\n-- Join with g-r color condition\nJOIN g_r_color gr ON o.oid = gr.oid;\n", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 5202, "completion_tokens": 428, "total_tokens": 5630, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_f12167b370"}}, "error": null}
{"id": "batch_req_6849f0da208c81908b2b950909c6ba02", "custom_id": "11-2", "response": {"status_code": 200, "request_id": "c6b2e60bb82b1c023c2939a2abe31bc9", "body": {"id": "chatcmpl-BhN0BZeYEVkAB3U8tdDoatTQvQbch", "object": "chat.completion", "created": 1749676223, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Corrected SQL query based on provided schema and user conditions\nSELECT \n    o.oid,\n    -- Retrieve the maximum magnitude in the light curve for the object\n    f.magmax,\n    -- Retrieve the corrected maximum magnitude\n    f.magmax_corr,\n    -- Filter identifier (e.g., 'g-r_max_corr')\n    f.name AS filter_id\nFROM \n    object o\nJOIN \n    feature f ON o.oid = f.oid\nWHERE \n    -- Confirm the object is classified as Type Ia Supernova with highest probability\n    EXISTS (\n        SELECT 1\n        FROM probability p\n        WHERE p.oid = o.oid\n          AND p.class_name = 'SNIa'\n          AND p.classifier_name IN ('lc_classifier', 'lc_classifier_top', 'lc_classifier_transient', 'lc_classifier_stochastic', 'lc_classifier_periodic')\n          AND p.ranking = 1\n    )\n    -- First detection occurred last September (assuming MJD range 60188 to 60217)\n    AND o.firstmjd BETWEEN 60188 AND 60217\n    -- Peak magnitude above 19\n    AND f.magmax > 19\n    -- The feature name for g-r color at maximum is 'g-r_max_corr'\n    AND f.name = 'g-r_max_corr'\n    -- g-r color at maximum below 1\n    AND f.value < 1;\n", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 5138, "completion_tokens": 291, "total_tokens": 5429, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0da3ef08190a66f73a9e406d40b", "custom_id": "11-3", "response": {"status_code": 200, "request_id": "92a513eb4b3dfec8f70f8523bd6ce31a", "body": {"id": "chatcmpl-BhN0D8ebXepb1RJXIU1JIrbTZjz1p", "object": "chat.completion", "created": 1749676225, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Corrected SQL query based on provided schema and user requirements\nSELECT \n    o.oid,\n    -- Retrieve the maximum g-r difference at maximum brightness\n    o.g_r_max,\n    -- Retrieve the g-r color at maximum brightness (corrected)\n    o.g_r_max_corr,\n    -- Filter ID: the band in which the maximum magnitude was observed\n    -- Since feature table uses 'name' for feature names, and 'fid' for band, we join with feature table to get filter info\n    -- But as per schema, 'feature' table has 'name', 'value', 'fid', etc.\n    -- To get the filter ID for the maximum magnitude, we need to find the feature with name 'magmax' for the object\n    -- and then get its 'fid' (filter id)\n    -- So, we join with feature table again to get the filter id for 'magmax'\n    f_max_fid.fid AS filter_id\nFROM \n    object o\nJOIN \n    probability p ON o.oid = p.oid\nJOIN \n    feature f ON o.oid = f.oid AND f.name = 'magmax'\n-- Join to get the filter id corresponding to the maximum magnitude feature\nLEFT JOIN \n    (SELECT oid, fid FROM feature WHERE name = 'magmax') f_max_fid ON o.oid = f_max_fid.oid\nWHERE \n    -- Filter for objects classified as SNe Ia with highest probability (ranking=1)\n    p.class_name = 'SNIa'\n    AND p.ranking = 1\n    AND p.classifier_name IN ('lc_classifier', 'lc_classifier_top', 'lc_classifier_transient', 'lc_classifier_stochastic', 'lc_classifier_periodic', 'stamp_classifier')\n    -- First detection in September (mjd between 60188 and 60217)\n    AND o.firstmjd BETWEEN 60188 AND 60217\n    -- Peak magnitude below 19\n    f.value < 19\n    -- g-r color at maximum below 1\n    -- Since 'g-r_max' is a feature, join again to get its value\n    AND EXISTS (\n        SELECT 1\n        FROM feature fr\n        WHERE fr.oid = o.oid\n          AND fr.name = 'g-r_max'\n          AND fr.value < 1\n    )\n    -- Ensure the feature corresponds to the maximum magnitude (by matching 'magmax' feature)\n    AND f.name = 'magmax'\n    -- Optional: ensure the 'fid' (filter id) is not null\n    AND f_max_fid.fid IS NOT NULL;\n", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 5252, "completion_tokens": 544, "total_tokens": 5796, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0da5bb48190ad2cd9492750d84e", "custom_id": "9-0", "response": {"status_code": 200, "request_id": "05b700f071050505f7b7734287da3ff8", "body": {"id": "chatcmpl-BhN0Bmxz3TOa3ucW90VG3INLaGt5i", "object": "chat.completion", "created": 1749676223, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with their first detection in July 2023, within 1000 arcmin of Abell 370, with sgscore1<0.3,\n-- and exclude classes 'Asteroid' and 'Bogus' based on the highest stamp classifier probability.\nWITH selected_objects AS (\n    SELECT \n        o.oid,\n        o.meanra,\n        o.meandec,\n        -- Retrieve the highest probability in stamp_classifier that is not 'asteroid' or 'bogus'\n        (SELECT p.probability\n         FROM probability p\n         WHERE p.oid = o.oid\n           AND p.class_name = 'stamp_classifier'\n           AND p.classifier_name = 'stamp_classifier'\n           AND p.classifier_version = (\n               SELECT MAX(p2.classifier_version)\n               FROM probability p2\n               WHERE p2.oid = o.oid\n                 AND p2.class_name = 'stamp_classifier'\n           )\n           AND p.class_name NOT IN ('asteroid', 'bogus')\n         ORDER BY p.ranking\n         LIMIT 1\n        ) AS max_stamp_prob,\n        -- Retrieve the class name corresponding to the highest probability\n        (SELECT p2.class_name\n         FROM probability p2\n         WHERE p2.oid = o.oid\n           AND p2.classifier_name = 'stamp_classifier'\n           AND p2.classifier_version = (\n               SELECT MAX(p3.classifier_version)\n               FROM probability p3\n               WHERE p3.oid = o.oid\n                 AND p3.class_name = 'stamp_classifier'\n           )\n           AND p2.class_name NOT IN ('asteroid', 'bogus')\n         ORDER BY p2.ranking\n         LIMIT 1\n        ) AS class_name\n    FROM object o\n    WHERE \n        -- First detection in July 2023: MJD between 60126.0 and 60156.0\n        o.firstmjd BETWEEN 60126.0 AND 60156.0\n        -- Within 1000 arcmin (~16.6667 degrees) of Abell 370 at RA=39.97, Dec=-1.5768\n        AND q3c_radial_query(o.meanra, o.meandec, 39.97, -1.5768, 16.6667)\n        -- Sgscore1 less than 0.3\n        AND o.sgscore1 < 0.3\n)\nSELECT \n    so.oid,\n    so.max_stamp_prob AS value,\n    so.class_name AS name,\n    -- Retrieve the classifier version for the selected class\n    (SELECT p.classifier_version\n     FROM probability p\n     WHERE p.oid = so.oid\n       AND p.class_name = so.class_name\n       AND p.classifier_name = 'stamp_classifier'\n     ORDER BY p.ranking\n     LIMIT 1\n    ) AS version,\n    so.meanra,\n    so.meandec,\n    -- Calculate the distance from the object to the cluster center\n    q3c_dist(so.meanra, so.meandec, 39.97, -1.5768) AS dist\nFROM selected_objects so\n-- Filter out objects where no valid class probability was found\nWHERE \n    so.max_stamp_prob IS NOT NULL\n    -- Exclude classes 'Asteroid' and 'Bogus' (case-insensitive)\n    AND so.class_name NOT IN ('Asteroid', 'Bogus');\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2306, "completion_tokens": 715, "total_tokens": 3021, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0da74c081908fd0bef23c4b70ec", "custom_id": "9-1", "response": {"status_code": 200, "request_id": "909eff14f335b006431771e4c18a4e9d", "body": {"id": "chatcmpl-BhN0GfELuLap8SiQ2V4Qns00FSKcc", "object": "chat.completion", "created": 1749676228, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with their first detection in July 2023, within 1000 arcmin of Abell 370, with sgscore1<0.3,\n-- and exclude classes 'asteroid' and 'bogus' based on the highest probability in 'stamp_classifier'.\n\nWITH selected_objects AS (\n    SELECT \n        o.oid,\n        o.meanra,\n        o.meandec,\n        -- Retrieve the highest probability in 'stamp_classifier' for the object\n        p1.probability AS value,\n        -- Retrieve the class name corresponding to the highest probability\n        p1.class_name AS name,\n        -- Retrieve the classifier version for the highest probability\n        p1.classifier_version AS version,\n        -- Calculate the distance from the center of Abell 370\n        q3c_dist(39.97, -1.5768, o.meanra, o.meandec) AS dist\n    FROM object o\n    -- Join with probability table to get the top class for each object\n    JOIN (\n        SELECT \n            p.oid,\n            p.class_name,\n            p.classifier_version,\n            p.probability,\n            p.ranking,\n            ROW_NUMBER() OVER (PARTITION BY p.oid ORDER BY p.ranking) AS rn\n        FROM probability p\n        WHERE p.classifier_name = 'stamp_classifier'\n    ) p1 ON p1.oid = o.oid AND p1.rn = 1\n    WHERE \n        -- First detection in July 2023: MJD between 60126 and 60156\n        o.firstmjd BETWEEN 60126.0 AND 60156.0\n        -- Within 1000 arcmin radius of Abell 370\n        AND q3c_radial_query(o.meanra, o.meandec, 39.97, -1.5768, 1000.0)\n        -- At least one detection\n        AND o.ndet > 0\n        -- sgscore1 < 0.3 (assuming 'sigmara' or 'sigmadec' as proxy; since 'sigma1' does not exist)\n        AND o.sigmara < 0.3\n)\nSELECT \n    oid,\n    value,\n    name,\n    version,\n    meanra,\n    meandec,\n    -- Source identifier is the object id\n    oid AS source,\n    dist\nFROM selected_objects\n-- Exclude objects with highest probability class 'asteroid' or 'bogus'\nWHERE \n    LOWER(name) NOT IN ('asteroid', 'bogus');\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2147, "completion_tokens": 535, "total_tokens": 2682, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0da91c08190a4d7b509f7fb2d8b", "custom_id": "9-2", "response": {"status_code": 200, "request_id": "299e9e9ac2e2016f722b6a9e6a54c60e", "body": {"id": "chatcmpl-BhN0IT0F7tgXO3Gu1rWzsQXnqDRgH", "object": "chat.completion", "created": 1749676230, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with their first detection in July 2023, within 1000 arcmin of Abell 370, sgscore1<0.3,\n-- and with the highest stamp classifier probability not for 'Asteroid' or 'Bogus'.\nWITH selected_objects AS (\n    SELECT\n        o.oid,\n        o.meanra,\n        o.meandec,\n        -- Retrieve the highest probability in stamp_classifier that is not 'asteroid' or 'bogus'\n        (SELECT p.probability\n         FROM probability p\n         WHERE p.oid = o.oid\n           AND p.class_name = 'stamp_classifier'\n           AND p.classifier_name = 'stamp_classifier'\n           AND p.classifier_version = (\n               SELECT MAX(p2.classifier_version)\n               FROM probability p2\n               WHERE p2.oid = p.oid\n                 AND p2.classifier_name = p.classifier_name\n           )\n           AND p.class_name NOT IN ('asteroid', 'bogus')\n         ORDER BY p.ranking\n         LIMIT 1\n        ) AS max_stamp_prob,\n        -- Retrieve the class name corresponding to the max probability in stamp_classifier\n        (SELECT p2.class_name\n         FROM probability p2\n         WHERE p2.oid = o.oid\n           AND p2.classifier_name = 'stamp_classifier'\n           AND p2.classifier_version = (\n               SELECT MAX(p3.classifier_version)\n               FROM probability p3\n               WHERE p3.oid = p2.oid\n                 AND p3.classifier_name = p2.classifier_name\n           )\n           AND p2.class_name NOT IN ('asteroid', 'bogus')\n         ORDER BY p2.ranking\n         LIMIT 1\n        ) AS class_name\n    FROM object o\n    WHERE\n        o.firstmjd BETWEEN 60126.0 AND 60156.0 -- July 2023 in MJD\n        AND q3c_radial_query(o.meanra, o.meandec, 39.97, -1.5768, 1000.0) -- radius in arcmin\n        AND o.sgscore1 < 0.3\n)\nSELECT\n    so.oid,\n    so.max_stamp_prob AS value,\n    so.class_name AS name,\n    -- Retrieve the classifier version for the selected class\n    (SELECT p.classifier_version\n     FROM probability p\n     WHERE p.oid = so.oid\n       AND p.class_name = so.class_name\n       AND p.classifier_name = 'stamp_classifier'\n     ORDER BY p.ranking\n     LIMIT 1\n    ) AS version,\n    so.meanra,\n    so.meandec,\n    -- Calculate distance from the center of Abell 370\n    q3c_dist(so.meanra, so.meandec, 39.97, -1.5768) AS dist\nFROM selected_objects so\nWHERE\n    so.max_stamp_prob IS NOT NULL\n    AND so.class_name NOT IN ('Asteroid', 'Bogus');\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2337, "completion_tokens": 632, "total_tokens": 2969, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0daad948190b77eb09a6e8f0465", "custom_id": "9-3", "response": {"status_code": 200, "request_id": "6cc6516f34dcafb4cc4d8fa5baf11840", "body": {"id": "chatcmpl-BhN0CDq3qXZL3MkHxXazrM76ddc6B", "object": "chat.completion", "created": 1749676224, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with their first detection in July 2023, within 1000 arcmin of Abell 370, sgscore1<0.3,\n-- and with the highest stamp classifier probability not for 'Asteroid' or 'Bogus'.\nWITH selected_objects AS (\n    SELECT\n        o.oid,\n        o.meanra,\n        o.meandec,\n        -- Retrieve the highest probability in stamp_classifier that is not 'asteroid' or 'bogus'\n        (SELECT p.probability\n         FROM probability p\n         WHERE p.oid = o.oid\n           AND p.class_name = 'stamp_classifier'\n           AND p.classifier_name = 'stamp_classifier'\n           AND p.classifier_version = (\n               SELECT MAX(p2.classifier_version)\n               FROM probability p2\n               WHERE p2.oid = p.oid\n                 AND p2.classifier_name = p.classifier_name\n           )\n           AND p.class_name NOT IN ('asteroid', 'bogus')\n         ORDER BY p.ranking\n         LIMIT 1\n        ) AS max_stamp_prob,\n        -- Retrieve the class name corresponding to the max probability in stamp_classifier\n        (SELECT p2.class_name\n         FROM probability p2\n         WHERE p2.oid = o.oid\n           AND p2.class_name = 'stamp_classifier'\n           AND p2.classifier_name = 'stamp_classifier'\n           AND p2.classifier_version = (\n               SELECT MAX(p3.classifier_version)\n               FROM probability p3\n               WHERE p3.oid = p2.oid\n                 AND p3.classifier_name = p2.classifier_name\n           )\n           AND p2.class_name NOT IN ('asteroid', 'bogus')\n         ORDER BY p2.ranking\n         LIMIT 1\n        ) AS class_name\n    FROM object o\n    WHERE\n        o.firstmjd BETWEEN 60126.0 AND 60156.0\n        AND q3c_radial_query(o.meanra, o.meandec, 39.97, -1.5768, 16.16667)\n        AND o.sgscore1 < 0.3\n)\nSELECT\n    so.oid,\n    so.max_stamp_prob AS value,\n    so.class_name AS name,\n    -- Retrieve the classifier version for the class with highest probability\n    (SELECT p.classifier_version\n     FROM probability p\n     WHERE p.oid = so.oid\n       AND p.class_name = so.class_name\n       AND p.classifier_name = 'stamp_classifier'\n     ORDER BY p.ranking\n     LIMIT 1\n    ) AS version,\n    so.meanra,\n    so.meandec,\n    -- Calculate distance from the center of Abell 370 using q3c_dist\n    q3c_dist(so.meanra, so.meandec, 39.97, -1.5768) AS dist\nFROM selected_objects so\nWHERE\n    so.max_stamp_prob IS NOT NULL\n    AND so.class_name NOT IN ('Asteroid', 'Bogus');\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2337, "completion_tokens": 636, "total_tokens": 2973, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0dac6f88190bcc2ce753ea24437", "custom_id": "38-0", "response": {"status_code": 200, "request_id": "d93c2f60b04fff916d66e8a20339e983", "body": {"id": "chatcmpl-BhN0IdbawIRyGkqTRIRFE0qP8iEUK", "object": "chat.completion", "created": 1749676230, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select top 1000 AGN candidates with probability > 0.6, ordered by probability descending\nWITH agn_candidates AS (\n    SELECT p.oid, p.class_name, p.probability, p.ranking\n    FROM probability p\n    JOIN object o ON p.oid = o.oid\n    WHERE p.class_name = 'AGN'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.probability > 0.6\n      AND p.ranking = 1\n    ORDER BY p.probability DESC\n    LIMIT 1000\n),\n-- Select top 1000 QSO candidates with probability > 0.5, ordered by probability descending\nqso_candidates AS (\n    SELECT p.oid, p.class_name, p.probability, p.ranking\n    FROM probability p\n    JOIN object o ON p.oid = o.oid\n    WHERE p.class_name = 'QSO'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.probability > 0.5\n      AND p.ranking = 1\n    ORDER BY p.probability DESC\n    LIMIT 1000\n),\n-- Filter objects with detection counts between 30 and 200 and present in AGN candidates\nagn_filtered AS (\n    SELECT o.oid\n    FROM object o\n    WHERE o.ndet BETWEEN 30 AND 200\n      AND o.oid IN (SELECT oid FROM agn_candidates)\n),\n-- Filter objects with detection counts between 30 and 200 and present in QSO candidates\nqso_filtered AS (\n    SELECT o.oid\n    FROM object o\n    WHERE o.ndet BETWEEN 30 AND 200\n      AND o.oid IN (SELECT oid FROM qso_candidates)\n)\n-- Final selection: objects that are either AGN or QSO candidates with detection counts in range\nSELECT o.*\nFROM object o\nWHERE o.oid IN (SELECT oid FROM agn_filtered)\n   OR o.oid IN (SELECT oid FROM qso_filtered);\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2470, "completion_tokens": 425, "total_tokens": 2895, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_f12167b370"}}, "error": null}
{"id": "batch_req_6849f0dae79c81908db96eeee1e79fc7", "custom_id": "38-1", "response": {"status_code": 200, "request_id": "42fcf896b1b37e310bd1dd800af44821", "body": {"id": "chatcmpl-BhN0CfL59ECXbuGKPdrRoo4E5S9ZX", "object": "chat.completion", "created": 1749676224, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select top 1000 AGN candidates with probability > 0.6, ordered by probability descending\nWITH agn_candidates AS (\n    SELECT p.oid, p.class_name, p.probability, p.ranking\n    FROM probability p\n    JOIN object o ON p.oid = o.oid\n    WHERE p.class_name = 'AGN'\n      AND p.classifier_name IN ('lc_classifier', 'lc_classifier_top', 'lc_classifier_transient', 'lc_classifier_stochastic', 'lc_classifier_periodic')\n      AND p.probability > 0.6\n      AND p.ranking = 1\n      -- Additional conditions to refine selection, e.g., date range or other relevant filters can be added here\n    ORDER BY p.probability DESC\n    LIMIT 1000\n),\n-- Select top 1000 QSO candidates with probability > 0.5, ordered by probability descending\nqso_candidates AS (\n    SELECT p.oid, p.class_name, p.probability, p.ranking\n    FROM probability p\n    JOIN object o ON p.oid = o.oid\n    WHERE p.class_name = 'QSO'\n      AND p.classifier_name IN ('lc_classifier', 'lc_classifier_top', 'lc_classifier_transient', 'lc_classifier_stochastic', 'lc_classifier_periodic')\n      AND p.probability > 0.5\n      AND p.ranking = 1\n      -- Additional conditions to refine selection, e.g., date range or other relevant filters can be added here\n    ORDER BY p.probability DESC\n    LIMIT 1000\n),\n-- Filter AGN objects with detections between 30 and 200\nagn_filtered AS (\n    SELECT o.*\n    FROM object o\n    WHERE o.oid IN (SELECT oid FROM agn_candidates)\n      AND o.ndet BETWEEN 30 AND 200\n),\n-- Filter QSO objects with detections between 30 and 200\nqso_filtered AS (\n    SELECT o.*\n    FROM object o\n    WHERE o.oid IN (SELECT oid FROM qso_candidates)\n      AND o.ndet BETWEEN 30 AND 200\n)\n-- Final combined selection of AGN and QSO objects\nSELECT * FROM agn_filtered\nUNION\nSELECT * FROM qso_filtered;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2522, "completion_tokens": 478, "total_tokens": 3000, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0db03f8819090d5754cdfdc765e", "custom_id": "38-3", "response": {"status_code": 200, "request_id": "428aebc5af53b15960d7fca3f30d4750", "body": {"id": "chatcmpl-BhN0D2u9dNOJvrYZnNLFBM55cpAcR", "object": "chat.completion", "created": 1749676225, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select top 1000 AGN candidates with probability > 0.6, ordered by probability descending\nWITH agn_candidates AS (\n    SELECT p.oid, p.class_name, p.probability, p.ranking\n    FROM probability p\n    WHERE p.class_name = 'AGN'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.probability > 0.6\n      AND p.ranking = 1\n),\n-- Select top 1000 QSO candidates with probability > 0.5, ordered by probability descending\nqso_candidates AS (\n    SELECT p.oid, p.class_name, p.probability, p.ranking\n    FROM probability p\n    WHERE p.class_name = 'QSO'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.probability > 0.5\n      AND p.ranking = 1\n),\n-- Filter objects with detection counts between 30 and 200 for AGN candidates\nagn_filtered AS (\n    SELECT o.oid\n    FROM object o\n    WHERE o.oid IN (SELECT oid FROM agn_candidates)\n      AND o.ndet BETWEEN 30 AND 200\n),\n-- Filter objects with detection counts between 30 and 200 for QSO candidates\nqso_filtered AS (\n    SELECT o.oid\n    FROM object o\n    WHERE o.oid IN (SELECT oid FROM qso_candidates)\n      AND o.ndet BETWEEN 30 AND 200\n)\n-- Final selection of objects that meet all criteria\nSELECT o.*\nFROM object o\nWHERE o.oid IN (SELECT oid FROM agn_filtered)\n   OR o.oid IN (SELECT oid FROM qso_filtered);\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2416, "completion_tokens": 355, "total_tokens": 2771, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0db1f188190a63e5ccee400a8f6", "custom_id": "24-1", "response": {"status_code": 200, "request_id": "8a02526b355223827f523b2fd4ff54ff", "body": {"id": "chatcmpl-BhN0JFEozGe6bnKFz5kD6VWBCEC59", "object": "chat.completion", "created": 1749676231, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Define the source positions with their names, right ascension, and declination\nWITH sources AS (\n    SELECT * FROM (VALUES\n        ('source_1', 160.18301441363647, 33.0164673528409),\n        ('source_2', 174.21524897555543, 44.83789535222221)\n    ) AS t(source_name, ra, dec)\n),\n-- Calculate the time window for the first 7 days of February 2023 in MJD\ntime_window AS (\n    SELECT\n        -- MJD for 1st February 2023 00:00:00 UTC\n        EXTRACT(JULIAN FROM TIMESTAMP '2023-02-01 00:00:00') AS mjd_start,\n        -- MJD for 8th February 2023 00:00:00 UTC (exclusive upper bound)\n        EXTRACT(JULIAN FROM TIMESTAMP '2023-02-08 00:00:00') AS mjd_end\n)\nSELECT o.*, p.*, d.*\nFROM object o\nJOIN probability p ON o.oid = p.oid\nJOIN detection d ON o.oid = d.oid\nJOIN sources s ON TRUE\nCROSS JOIN time_window tw\nWHERE\n    -- Use q3c_join to find objects within 10 degrees of source positions\n    q3c_join(s.ra, s.dec, o.meanra, o.meandec, 10)\n    -- Filter detections to those within the first 7 days of February 2023\n    AND d.mjd >= tw.mjd_start\n    AND d.mjd < tw.mjd_end\n    -- Ensure detection is after the object's first detection\n    AND d.mjd >= o.firstmjd\n    -- Limit to detections within 7 days after first detection\n    AND d.mjd <= o.firstmjd + 7\n    -- Filter for class 'Transient' and classifier 'lc_classifier_top' with top ranking\n    AND p.class_name = 'Transient'\n    AND p.classifier_name = 'lc_classifier_top'\n    AND p.ranking = 1;", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2153, "completion_tokens": 447, "total_tokens": 2600, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0db3a34819089b4366ec75d327b", "custom_id": "6-2", "response": {"status_code": 200, "request_id": "160050c66b790fe9e89025512c31e030", "body": {"id": "chatcmpl-BhN0D9sGdZdTDueZ9Vmp39Doi64Sy", "object": "chat.completion", "created": 1749676225, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object and detection details for objects classified as SN II in 2019-2022\nWITH sn_ii_objects AS (\n    SELECT o.oid\n    FROM object o\n    JOIN probability p ON o.oid = p.oid\n    WHERE p.class_name = 'SNII'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.probability > 0.6\n      AND p.ranking = 1\n      AND o.firstmjd BETWEEN 58484.0 AND 59944.0\n),\ndetection_filtered AS (\n    SELECT d.candid, d.oid, d.mjd, d.ra, d.dec, d.magpsf, d.sigmapsf, d.fid AS f_id\n    FROM detection d\n    WHERE d.oid IN (SELECT oid FROM sn_ii_objects)\n      AND d.mjd BETWEEN 58484.0 AND 59944.0\n),\nmagstat_r AS (\n    SELECT ms.oid, ms.ndet, ms.magmean, ms.sigmadm_first, ms.dmdt_first, ms.fid\n    FROM magstat ms\n    WHERE ms.oid IN (SELECT oid FROM sn_ii_objects)\n      AND ms.fid IN (1, 2) -- g and r bands\n),\nrise_rates AS (\n    SELECT\n        m.oid,\n        m.fid AS f_id,\n        -- Calculate initial rise rate: change in magnitude over time\n        CASE\n            WHEN d1.mjd IS NOT NULL AND d2.mjd IS NOT NULL AND (d2.mjd - d1.mjd) > 0\n                THEN (d2.magpsf - d1.magpsf) / (d2.mjd - d1.mjd)\n            ELSE NULL\n        END AS rise_rate\n    FROM\n        (SELECT DISTINCT oid, f_id FROM magstat_r) m\n        LEFT JOIN detection_filtered d1 ON m.oid = d1.oid AND m.f_id = d1.f_id\n        LEFT JOIN detection_filtered d2 ON m.oid = d2.oid AND m.f_id = d2.f_id AND d2.mjd > d1.mjd\n    WHERE\n        d1.mjd IS NOT NULL AND d2.mjd IS NOT NULL\n),\nobjects_with_rise AS (\n    SELECT DISTINCT oid\n    FROM rise_rates\n    WHERE rise_rate > 0.5\n),\ndetection_final AS (\n    SELECT d.candid, d.oid, d.mjd, d.magpsf, d.sigmapsf, d.f_id\n    FROM detection_filtered d\n    WHERE d.oid IN (SELECT oid FROM objects_with_rise)\n),\nmagstat_r_days AS (\n    SELECT ms.oid, ms.ndet, ms.magmean, ms.fid\n    FROM magstat ms\n    WHERE ms.oid IN (SELECT oid FROM objects_with_rise)\n),\nobservation_days AS (\n    SELECT\n        oid,\n        MAX(CASE WHEN f_id = 2 THEN lastmjd END) AS last_mjd_r,\n        MIN(CASE WHEN f_id = 2 THEN firstmjd END) AS first_mjd_r\n    FROM magstat_r_days\n    GROUP BY oid\n),\nobjects_with_observations AS (\n    SELECT oid\n    FROM observation_days\n    WHERE (last_mjd_r - first_mjd_r) >= 100\n),\ndetection_counts AS (\n    SELECT oid, COUNT(*) AS ndet_r\n    FROM detection_filtered\n    WHERE f_id = 2\n    GROUP BY oid\n),\nfinal_objects AS (\n    SELECT o.oid\n    FROM objects_with_rise o\n    JOIN objects_with_observations ob ON o.oid = ob.oid\n    JOIN detection_counts dc ON o.oid = dc.oid\n    WHERE dc.ndet_r > 30\n)\n-- Final selection of detection data with required filters\nSELECT\n    d.oid,\n    d.candid,\n    d.magpsf,\n    d.sigmapsf,\n    d.f_id\nFROM detection_final d\nWHERE d.oid IN (SELECT oid FROM final_objects)\nORDER BY d.oid, d.mjd;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 4134, "completion_tokens": 871, "total_tokens": 5005, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0db54988190ac3da0060f7fb201", "custom_id": "93-0", "response": {"status_code": 200, "request_id": "d57db453dcf616ef79cd7a2e7c935040", "body": {"id": "chatcmpl-BhN0HOq2BRgRZp9FHSskPj6662N6c", "object": "chat.completion", "created": 1749676229, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select all columns from probability and magstat tables for objects that meet the specified conditions\nSELECT p.*, m.*\nFROM (\n    -- Subquery to find object IDs where 'asteroid' is ranked 1 in the stamp_classifier with specific probability conditions\n    SELECT oid\n    FROM probability\n    WHERE class_name = 'asteroid'\n      AND classifier_name = 'stamp_classifier'\n      AND ranking = 1\n      AND probability >= 0.8 -- Ensuring high confidence in classification\n      AND classifier_version = '2023' -- Specify the classifier version if known, or remove if not applicable\n) AS sub\nJOIN probability p ON p.oid = sub.oid\nJOIN magstat m ON m.oid = sub.oid\nWHERE m.corrected = TRUE\n  AND p.class_name = 'asteroid'\n  AND p.classifier_name = 'stamp_classifier'\n  AND p.ranking = 1\n  AND p.probability >= 0.8 -- Consistent probability threshold\n  AND p.classifier_version = '2023' -- Match classifier version for consistency\n  AND m.ndet > 0 -- Ensure the object has detections\n  AND m.ndubious = 0 -- Filter out dubious points for cleaner data\nORDER BY p.oid\nLIMIT 10;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1570, "completion_tokens": 272, "total_tokens": 1842, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0db736c819099522b9642694025", "custom_id": "95-0", "response": {"status_code": 200, "request_id": "1aa37092b3ce2bb78574467dc28f7d1f", "body": {"id": "chatcmpl-BhN0Kd0LBGVRo83ckclD5Y6GKDP6b", "object": "chat.completion", "created": 1749676232, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define a temporary table with the specified ZTF object identifiers\nWITH ztf_objects AS (\n    SELECT unnest(ARRAY['ZTF19aazhdoy', 'ZTF17aaaqqtd']) AS oid\n),\n-- Retrieve matches for the specified ZTF objects\nmatches AS (\n    SELECT \n        o.oid AS ztf_oid,\n        xm.catid AS catalog_id,\n        xm.oid_catalog,\n        xm.dist\n    FROM \n        ztf_objects z\n    JOIN \n        object o ON o.oid = z.oid\n    JOIN \n        xmatch xm ON xm.oid = o.oid\n),\n-- Retrieve features 'W1-W2', 'g-W2', 'r-W2' for the specified objects and features, version 'lc_classifier_1.2.1-P'\nfeatures AS (\n    SELECT \n        o.oid AS ztf_oid,\n        f.name AS feature_name,\n        f.value\n    FROM \n        ztf_objects z\n    JOIN \n        object o ON o.oid = z.oid\n    JOIN \n        feature f ON f.oid = o.oid\n    WHERE \n        f.version = 'lc_classifier_1.2.1-P'\n        AND f.name IN ('W1-W2', 'g-W2', 'r-W2')\n)\n-- Join matches and features on object identifier, then order the results\nSELECT \n    m.ztf_oid AS ztf_identifier,\n    m.oid_catalog AS catalog_identifier,\n    m.dist AS distance_arcsec,\n    f.feature_name,\n    f.value\nFROM \n    matches m\nLEFT JOIN \n    features f ON m.ztf_oid = f.ztf_oid\nORDER BY \n    m.oid_catalog, f.feature_name;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 4390, "completion_tokens": 368, "total_tokens": 4758, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0db8f8c8190aabbc5b67935f72d", "custom_id": "95-2", "response": {"status_code": 200, "request_id": "1527199702df4d4a7dc5160c62b90b74", "body": {"id": "chatcmpl-BhN0Hz78sOnxy8VNQaE5cJwEbXqR0", "object": "chat.completion", "created": 1749676229, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define a temporary table with the specified ZTF object identifiers\nWITH ztf_objects AS (\n    VALUES \n        ('ZTF19aazhdoy'),\n        ('ZTF17aaaqqtd')\n),\nztf_ids AS (\n    SELECT * FROM ztf_objects\n),\n-- Retrieve matches for the specified ZTF objects\nmatches AS (\n    SELECT \n        o.oid AS ztf_oid,\n        xm.catid AS catalog_id,\n        xm.oid_catalog,\n        xm.dist\n    FROM \n        object o\n    JOIN \n        xmatch xm ON o.oid = xm.oid\n    WHERE \n        o.oid IN (SELECT * FROM ztf_ids)\n),\n-- Retrieve features 'W1-W2', 'g-W2', 'r-W2' for the specified objects and classifier version\nfeatures AS (\n    SELECT \n        f.oid AS ztf_oid,\n        f.name AS feature_name,\n        f.value\n    FROM \n        feature f\n    WHERE \n        f.oid IN (SELECT * FROM ztf_ids)\n        AND f.version = 'lc_classifier_1.2.1-P'\n        AND f.name IN ('W1-W2', 'g-W2', 'r-W2')\n)\n-- Join matches and features on object identifier, and prepare final output\nSELECT \n    m.ztf_oid AS ztf_identifier,\n    m.oid_catalog AS catalog_identifier,\n    m.dist AS distance_arcsec,\n    f.feature_name,\n    f.value\nFROM \n    matches m\nJOIN \n    features f ON m.ztf_oid = f.oid\nORDER BY \n    m.oid_catalog, f.feature_name;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 4336, "completion_tokens": 345, "total_tokens": 4681, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0dbab248190b9322e5e64da617f", "custom_id": "95-3", "response": {"status_code": 200, "request_id": "805e27ee5fe97ea1a6617d427b7703f4", "body": {"id": "chatcmpl-BhN0E8xJkCFknFvmrpRQMUWyX5Plv", "object": "chat.completion", "created": 1749676226, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define a temporary table with the specified ZTF object identifiers\nWITH ztf_objects AS (\n    VALUES \n        ('ZTF19aazhdoy'),\n        ('ZTF17aaaqqtd')\n),\n-- Retrieve object details for the specified ZTF objects\nobjects_cte AS (\n    SELECT o.oid\n    FROM object o\n    JOIN ztf_objects z ON o.oid = z.column1\n),\n-- Retrieve matches for the specified objects\nmatches AS (\n    SELECT \n        o.oid AS ztf_oid,\n        x.catid,\n        x.oid_catalog,\n        x.dist\n    FROM \n        objects_cte o\n    JOIN \n        xmatch x ON x.oid = o.oid\n),\n-- Retrieve features 'W1-W2', 'g-W2', 'r-W2' for the specified objects and feature version\nfeatures AS (\n    SELECT \n        o.oid AS ztf_oid,\n        f.name,\n        f.value,\n        f.oid\n    FROM \n        objects_cte o\n    JOIN \n        feature f ON f.oid = o.oid\n    WHERE \n        f.name IN ('W1-W2', 'g-W2', 'r-W2')\n        AND f.version = 'lc_classifier_1.2.1-P'\n)\n-- Final join to combine matches and features, ordered as requested\nSELECT \n    m.ztf_oid AS ztf_identifier,\n    m.catid AS catalog_identifier,\n    m.oid_catalog AS catalog_object_id,\n    m.dist AS distance_arcsec,\n    f.name AS feature_name,\n    f.value AS feature_value\nFROM \n    matches m\nLEFT JOIN \n    features f ON f.oid = m.oid_catalog\nORDER BY \n    m.oid_catalog, f.name;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 4360, "completion_tokens": 372, "total_tokens": 4732, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0dbc6c08190aac4fecbb589c520", "custom_id": "64-1", "response": {"status_code": 200, "request_id": "0e38fa4627aa72c7936192d868a72579", "body": {"id": "chatcmpl-BhN0Lr4goE06ZY0Sgpw1FVAQJSSvB", "object": "chat.completion", "created": 1749676233, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select up to 1000 entries from the probability table where the probability exceeds 0.95\n-- in either 'lc_classifier_top' or 'stamp_classifier' classifiers, with additional filtering\n-- to optimize query performance and ensure relevant conditions are met.\n\nSELECT \n    p.oid AS \"ZTF identifier\",\n    p.classifier_name AS \"classifier name\",\n    p.classifier_version AS \"classifier version\",\n    p.class_name AS \"class name\",\n    p.probability AS \"probability\"\nFROM (\n    -- Subquery to filter relevant classifier entries with probability > 0.95\n    SELECT *\n    FROM probability\n    WHERE \n        -- Filter for specific classifiers\n        classifier_name IN ('lc_classifier_top', 'stamp_classifier')\n        -- Filter for high probability\n        AND probability > 0.95\n        -- Additional condition: focus on top-ranked classes to improve relevance and performance\n        AND ranking = 1\n) p\n-- Order by probability descending to prioritize higher probabilities\nORDER BY p.probability DESC\n-- Limit to 1000 rows to prevent timeout and manage result size\nLIMIT 1000;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1039, "completion_tokens": 236, "total_tokens": 1275, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0dbe4b4819080382143d0b0d9ce", "custom_id": "64-2", "response": {"status_code": 200, "request_id": "dbe47cf71d49b1d85e87b7f9d68249fb", "body": {"id": "chatcmpl-BhN0PV2UOmcoIZA2Q7Fq5ZLiJITNI", "object": "chat.completion", "created": 1749676237, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select up to 1000 entries from the probability table with probability > 0.95\n-- and classifier_name in ('lc_classifier_top', 'stamp_classifier')\n-- Only include entries with the top ranking (ranking=1) to ensure the most relevant class per object and classifier\n-- Use a subquery to filter for the maximum ranking per object, classifier, and class to optimize performance\nSELECT \n    p.oid AS \"ZTF identifier\",\n    p.classifier_name AS \"classifier name\",\n    p.classifier_version AS \"classifier version\",\n    p.class_name AS \"class name\",\n    p.probability AS \"probability\"\nFROM \n    probability p\nWHERE \n    p.probability > 0.95\n    AND p.classifier_name IN ('lc_classifier_top', 'stamp_classifier')\n    AND p.ranking = 1 -- Ensure only the top-ranked class per object and classifier\n    AND p.oid IN (\n        -- Subquery to limit to objects with at least one class probability > 0.95 in the specified classifiers\n        SELECT oid FROM probability\n        WHERE \n            probability > 0.95\n            AND classifier_name IN ('lc_classifier_top', 'stamp_classifier')\n            AND ranking = 1\n        LIMIT 1000 -- Limit to 1000 objects to optimize query\n    )\nORDER BY \n    p.probability DESC\nLIMIT 1000; -- Final limit to ensure no more than 1000 rows are returned\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 980, "completion_tokens": 307, "total_tokens": 1287, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_f12167b370"}}, "error": null}
{"id": "batch_req_6849f0dc08448190aa3eabbf18f8ef87", "custom_id": "88-0", "response": {"status_code": 200, "request_id": "b4147e6a1548b6e1854a7b6f14fef570", "body": {"id": "chatcmpl-BhN0H0qsr4J6VhKu5Bbpk3b4bx0Ox", "object": "chat.completion", "created": 1749676229, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects classified as 'bogus' with ranking 1 in the stamp_classifier, with at least 20 detections\nWITH bogus_objects AS (\n    SELECT p.oid, p.class_name, p.classifier_name, p.classifier_version, p.probability, p.ranking\n    FROM probability p\n    WHERE p.class_name = 'bogus'\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.ranking = 1\n      -- Additional conditions to ensure query efficiency and relevance\n      AND p.probability > 0.5 -- optional: filter for higher confidence, adjust as needed\n),\n-- Filter objects with at least 20 detections\nfiltered_objects AS (\n    SELECT o.oid, o.ndet, o.meanra, o.meandec, bo.classifier_version, bo.probability\n    FROM object o\n    JOIN bogus_objects bo ON o.oid = bo.oid\n    WHERE o.ndet >= 20\n)\n-- Final selection with limited rows\nSELECT\n    o.oid AS \"ZTF Identifier\",\n    o.ndet AS \"Number of Detections\",\n    -- Format mean RA and Dec as a string\n    (o.meanra::TEXT || ', ' || o.meandec::TEXT) AS \"Mean RA, Dec\",\n    bo.classifier_version AS \"Classifier Version\",\n    bo.probability AS \"Probability\"\nFROM filtered_objects o\nJOIN bogus_objects bo ON o.oid = bo.oid\nLIMIT 50;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2189, "completion_tokens": 315, "total_tokens": 2504, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0dc21bc819094d3cfc4342a55d6", "custom_id": "88-1", "response": {"status_code": 200, "request_id": "bb9f785f0429e2b440af06954fef36b1", "body": {"id": "chatcmpl-BhN0FAvMK8kvNGNGSoxqQnln7S045", "object": "chat.completion", "created": 1749676227, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with 'bogus' class as ranking 1 in stamp_classifier, at least 20 detections, limit to 50 results\nWITH bogus_objects AS (\n    -- Filter probability table for 'bogus' class, classifier 'stamp_classifier', ranking 1, and probability > 0.5 for relevance\n    SELECT p.oid, p.class_name, p.classifier_name, p.classifier_version, p.probability, p.ranking\n    FROM probability p\n    WHERE p.class_name = 'bogus'\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.ranking = 1\n      AND p.probability > 0.5 -- optional: filter for higher confidence\n),\nobject_counts AS (\n    -- Count detections per object and compute mean RA/Dec\n    SELECT o.oid,\n           COUNT(d.candid) AS detection_count,\n           AVG(o.meanra) AS mean_ra,\n           AVG(o.meandec) AS mean_dec\n    FROM object o\n    JOIN detection d ON o.oid = d.oid\n    GROUP BY o.oid\n)\n-- Join to get object info, classification info, and filter by detection count\nSELECT o.oid AS ztf_id,\n       oc.detection_count,\n       o.meanra,\n       o.meandec,\n       p.classifier_version,\n       p.probability\nFROM object_counts oc\nJOIN object o ON oc.oid = o.oid\nJOIN bogus_objects p ON o.oid = p.oid\nWHERE oc.detection_count >= 20\n-- Limit to 50 results for performance\nLIMIT 50;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2173, "completion_tokens": 341, "total_tokens": 2514, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0dc3d408190a8b57452c53c2f6d", "custom_id": "88-3", "response": {"status_code": 200, "request_id": "d0574dbf056230b00bc83ba79dc6b8e7", "body": {"id": "chatcmpl-BhN0G9mektaCTwZP4yYN3hKPLE8v1", "object": "chat.completion", "created": 1749676228, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with 'bogus' class as ranking 1 in stamp_classifier, at least 20 detections, and limit to 50 results\n\nWITH bogus_objects AS (\n    SELECT p.oid, p.class_name, p.classifier_name, p.classifier_version, p.probability, p.ranking\n    FROM probability p\n    WHERE p.class_name = 'bogus'\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.ranking = 1\n),\nobject_counts AS (\n    SELECT o.oid, COUNT(d.candid) AS detection_count, AVG(o.meanra) AS mean_ra, AVG(o.meandec) AS mean_dec\n    FROM object o\n    JOIN detection d ON o.oid = d.oid\n    GROUP BY o.oid\n)\nSELECT \n    o.oid AS ztf_id,\n    oc.detection_count,\n    -- Create a point with mean RA and Dec\n    ST_MakePoint(oc.mean_ra, oc.mean_dec) AS mean_ra_dec,\n    p.classifier_version,\n    p.probability\nFROM object_counts oc\nJOIN bogus_objects p ON oc.oid = p.oid\n-- Filter objects with at least 20 detections\nWHERE oc.detection_count >= 20\nLIMIT 50;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2124, "completion_tokens": 270, "total_tokens": 2394, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0dc59e08190b665680dedec33fd", "custom_id": "77-1", "response": {"status_code": 200, "request_id": "d6d70d814ed3e285e02b5877578c7b15", "body": {"id": "chatcmpl-BhN0MwK6z8piAEiVZE63KbnCfensx", "object": "chat.completion", "created": 1749676234, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select all columns from ss_ztf where the object oid matches either of the specified Solar System identifiers\nSELECT *\nFROM ss_ztf\nWHERE oid IN (\n    -- Subquery to find oids with zero distance to the specified Solar System identifiers\n    SELECT s1.oid\n    FROM ss_ztf s1\n    JOIN ss_ztf s2 ON s1.oid = s2.oid\n    WHERE s2.ssnamenr IN ('213673', '49894')\n      AND s1.ssdistnr = 0\n)\nORDER BY candid, oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1166, "completion_tokens": 127, "total_tokens": 1293, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0dc7bd88190b687ac1d83a8cbc5", "custom_id": "105-0", "response": {"status_code": 200, "request_id": "fe748ae5a147b122b263d2ce72d1858d", "body": {"id": "chatcmpl-BhN0RKCD2Io56s3VlY8d46JZ5a4cw", "object": "chat.completion", "created": 1749676239, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select at most 50 objects with specified conditions\nWITH selected_objects AS (\n    SELECT o.oid, p.probability\n    FROM object o\n    -- Filter objects with probability > 0.7 of being AGN in the specified classifier\n    JOIN probability p ON o.oid = p.oid\n    WHERE p.class_name = 'AGN'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.classifier_version = 'hierarchical_rf_1.1.0'\n      AND p.probability > 0.7\n      -- Ensure the object has a nearest PS1 source within 2 arcsec\n      AND EXISTS (\n        SELECT 1\n        FROM ps1_ztf p1\n        WHERE p1.oid = o.oid\n          AND p1.distpsnr1 < 2\n    )\n    -- Check the star/galaxy score difference condition\n    AND EXISTS (\n        SELECT 1\n        FROM ps1_ztf p1\n        WHERE p1.oid = o.oid\n          AND ABS(p1.sgscore1 - p1.sgscore2) < 0.5\n    )\n    LIMIT 50\n)\nSELECT\n    o.oid AS ztf_object_id,\n    p.probability,\n    d.candid,\n    d.filterid,\n    d.chi2red,\n    d.sgscore,\n    d.candid AS epoch_id,\n    d.filterid AS filter_id,\n    d.chi2red AS reduced_chi2,\n    d.sgscore AS sextractor_sgscore,\n    p1.candid AS nearest_ps1_source_id,\n    p1.sgscore1 AS ps1_sgscore,\n    p1.distpsnr1 AS distance_ps1\nFROM selected_objects so\nJOIN object o ON so.oid = o.oid\nJOIN detection d ON o.oid = d.oid\nJOIN ps1_ztf p1 ON o.oid = p1.oid\nWHERE p1.distpsnr1 < 2\n  AND ABS(p1.sgscore1 - p1.sgscore2) < 0.5\nORDER BY p.probability DESC\nLIMIT 50;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3009, "completion_tokens": 458, "total_tokens": 3467, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0dc9ed88190acff2886e8556355", "custom_id": "105-1", "response": {"status_code": 200, "request_id": "b71e2e1a95d75439e4a5d454059772ec", "body": {"id": "chatcmpl-BhN0MobaTBKVLsZqT2Xkv6ZtvnzFD", "object": "chat.completion", "created": 1749676234, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select at most 50 objects with specified conditions\nWITH selected_objects AS (\n    SELECT o.oid, p.probability\n    FROM object o\n    -- Join with probability table to filter objects with probability > 0.7 of being AGN\n    JOIN probability p ON o.oid = p.oid\n    WHERE p.class_name = 'AGN'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.classifier_version = 'hierarchical_rf_1.1.0'\n      AND p.probability > 0.7\n      -- Ensure the nearest PS1 source is within 2 arcsec\n      AND EXISTS (\n        SELECT 1\n        FROM ps1_ztf ps\n        WHERE ps.oid = o.oid\n          AND q3c_join(o.meanra, o.meandec, ps.objectidps1, ps.objectidps1, 2.0)\n      )\n      -- Check the star/galaxy score difference condition\n      AND EXISTS (\n        SELECT 1\n        FROM ps1_ztf ps\n        WHERE ps.oid = o.oid\n          AND ps.nmtchps > 0\n          AND ABS(ps.sgscore1 - \n            -- Use the sgscore1 from ps1_ztf as per schema\n            ps.sgscore1\n          ) < 0.5\n      )\n    LIMIT 50\n)\n-- Retrieve candidate detections and associated information for selected objects\nSELECT\n    o.oid AS ztf_object_id,\n    p.probability,\n    d.candid,\n    d.filterid,\n    d.chi2red,\n    d.sgscore,\n    d.candid AS epoch_id,\n    d.filterid AS filter_id,\n    d.chi2red AS reduced_chi2,\n    d.sgscore AS sextractor_sgscore,\n    ps.objectidps1 AS nearest_ps1_id,\n    ps.sgscore1 AS ps1_sgscore,\n    ps.distpsnr1 AS distance_ps1\nFROM selected_objects so\nJOIN object o ON so.oid = o.oid\nJOIN probability p ON o.oid = p.oid\nJOIN detection d ON o.oid = d.oid\nLEFT JOIN ps1_ztf ps ON o.oid = ps.oid\nWHERE p.class_name = 'AGN'\n  AND p.classifier_name = 'lc_classifier'\n  AND p.classifier_version = 'hierarchical_rf_1.1.0'\n  AND p.probability > 0.7\n  -- Ensure the nearest PS1 source is within 2 arcsec\n  AND q3c_join(o.meanra, o.meandec, ps.objectidps1, ps.objectidps1, 2.0)\n  -- Check the star/galaxy score difference condition\n  AND ABS(ps.sgscore1 - ps.sgscore1) < 0.5\nLIMIT 50;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3222, "completion_tokens": 611, "total_tokens": 3833, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0dcc1b08190becd0361573ae3e1", "custom_id": "105-2", "response": {"status_code": 200, "request_id": "206c13de86a3b916657ac9383d1ae286", "body": {"id": "chatcmpl-BhN0LuR6SIY5GohHk8Vcbd5Nryrxu", "object": "chat.completion", "created": 1749676233, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select at most 50 objects with specified conditions\nWITH selected_objects AS (\n    -- Get objects with probability > 0.7 of being AGN from the specified classifier\n    SELECT o.oid, p.probability\n    FROM object o\n    JOIN (\n        SELECT oid, probability\n        FROM probability\n        WHERE class_name = 'AGN'\n          AND classifier_name = 'lc_classifier'\n          AND classifier_version = 'hierarchical_rf_1.1.0'\n        ORDER BY ranking ASC\n        LIMIT 1\n    ) p ON o.oid = p.oid\n    WHERE p.probability > 0.7\n),\nps1_sources AS (\n    -- Get PS1 source info for objects\n    SELECT oid, objectidps1, sgscore1, distpsnr1\n    FROM ps1_ztf\n),\n-- Filter objects based on PS1 proximity and star/galaxy score difference\nfiltered_objects AS (\n    SELECT so.oid, so.probability\n    FROM selected_objects so\n    JOIN ps1_sources ps ON so.oid = ps.oid\n    -- Ensure nearest PS1 source is within 2 arcsec\n    WHERE ps.distpsnr1 < 2\n      -- Compare PS1 star/galaxy score with the score from object table\n      AND ABS(ps.sgscore1 - (\n            -- Retrieve the star/galaxy score from object table for the object\n            SELECT sgscore\n            FROM object\n            WHERE oid = so.oid\n        )) < 0.5\n),\n-- Retrieve detection details for the selected objects\ndetections AS (\n    SELECT d.oid, d.candid, d.fid, d.chi, d.sgscore\n    FROM detection d\n    WHERE d.oid IN (SELECT oid FROM filtered_objects)\n),\n-- Retrieve object info for the selected objects\nobjects_info AS (\n    SELECT o.oid, o.firstmjd\n    FROM object o\n    WHERE o.oid IN (SELECT oid FROM filtered_objects)\n)\n-- Final selection with all required columns\nSELECT\n    o.oid AS ztf_object_id,\n    p.probability,\n    d.candid,\n    d.fid,\n    d.chi AS reduced_chi_square,\n    d.sgscore AS sextractor_sgscore,\n    ps.objectidps1,\n    ps.sgscore1 AS ps1_sgscore,\n    ps.distpsnr1 AS ps1_distance\nFROM filtered_objects fo\nJOIN probability p ON fo.oid = p.oid\n  AND p.class_name = 'AGN'\n  AND p.classifier_name = 'lc_classifier'\n  AND p.classifier_version = 'hierarchical_rf_1.1.0'\nJOIN objects_info o ON fo.oid = o.oid\nLEFT JOIN detections d ON o.oid = d.oid\nLEFT JOIN ps1_sources ps ON o.oid = ps.oid\nLIMIT 50;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3543, "completion_tokens": 610, "total_tokens": 4153, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_f12167b370"}}, "error": null}
{"id": "batch_req_6849f0dce54c8190a5d646041d31a2f4", "custom_id": "105-3", "response": {"status_code": 200, "request_id": "19fe17940535cb953ca9e365d2eb8ac1", "body": {"id": "chatcmpl-BhN0JqN8XfUVWQxhAL8alDOijjsSh", "object": "chat.completion", "created": 1749676231, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select at most 50 objects satisfying the specified conditions\nWITH selected_objects AS (\n    SELECT o.oid, p.probability\n    FROM object o\n    -- Subquery to get the top probability of being an AGN in the hierarchical_rf_1.1.0 classifier\n    JOIN (\n        SELECT oid, probability\n        FROM probability\n        WHERE class_name = 'AGN'\n          AND classifier_name = 'lc_classifier'\n          AND classifier_version = 'hierarchical_rf_1.1.0'\n        -- Use ROW_NUMBER() with a window function to rank probabilities per object\n        -- Note: PostgreSQL uses ROW_NUMBER() OVER (...) instead of QUALIFY\n        WINDOW rn AS (PARTITION BY oid ORDER BY probability DESC)\n    ) p ON o.oid = p.oid\n    WHERE p.probability > 0.7\n),\nranked_probs AS (\n    SELECT\n        oid,\n        probability,\n        ROW_NUMBER() OVER (PARTITION BY oid ORDER BY probability DESC) AS rn\n    FROM probability\n    WHERE class_name = 'AGN'\n      AND classifier_name = 'lc_classifier'\n      AND classifier_version = 'hierarchical_rf_1.1.0'\n),\ntop_prob AS (\n    SELECT oid, probability\n    FROM ranked_probs\n    WHERE rn = 1\n),\nnearest_ps1 AS (\n    SELECT\n        xm.oid,\n        xm.objectidps1,\n        xm.sgscore1,\n        xm.dist\n    FROM xmatch xm\n    WHERE xm.catid = 'PS1'\n      AND xm.dist < 2\n),\n-- Assuming 'sgscore1' from PS1 is stored in ps1_ztf\n-- For SExtractor score, assuming it's stored in feature table with name 'sgscore1' and fid=1\nfeature_ps1 AS (\n    SELECT o.oid, f.value AS sgscore_ps1\n    FROM object o\n    LEFT JOIN feature f ON o.oid = f.oid AND f.name = 'sgscore1' AND f.fid = 1\n    WHERE f.version = 'ps1_version_placeholder' -- replace with actual version if known\n),\nfeature_sextractor AS (\n    SELECT o.oid, f.value AS sgscore_sextractor\n    FROM object o\n    LEFT JOIN feature f ON o.oid = f.oid AND f.name = 'sgscore1' AND f.fid = 1\n    WHERE f.version = 'sextractor_version_placeholder' -- replace with actual version if known\n)\nSELECT\n    o.oid AS ztf_object_id,\n    tp.probability,\n    -- Epoch info: candidate, filterid, reduced chi-square\n    -- Assuming detection table exists; if not, replace or remove\n    d.candid,\n    d.filterid,\n    d.chi2red,\n    -- sgscore from SExtractor\n    f_sex.value AS sgscore_sextractor,\n    -- PS1 nearest source info\n    np.objectidps1,\n    np.sgscore1 AS ps1_sgscore,\n    np.dist AS ps1_distance\nFROM selected_objects so\nJOIN top_prob tp ON so.oid = tp.oid\nLEFT JOIN object o ON o.oid = so.oid\nLEFT JOIN detection d ON o.oid = d.oid\nLEFT JOIN feature f_sex ON o.oid = f_sex.oid AND f_sex.name = 'sgscore1' AND f_sex.fid = 1\nLEFT JOIN nearest_ps1 np ON o.oid = np.oid\nLEFT JOIN feature f_ps1 ON o.oid = f_ps1.oid AND f_ps1.name = 'sgscore1' AND f_ps1.fid = 1\nLEFT JOIN feature_ps1 fp ON o.oid = fp.oid\nWHERE\n    -- Conditions for star/galaxy score difference\n    (f_ps1.sgscore_ps1 - f_sex.value) < 0.5\nORDER BY tp.probability DESC\nLIMIT 50;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 6003, "completion_tokens": 834, "total_tokens": 6837, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0dd041c8190b8bc8248b964ccb8", "custom_id": "86-1", "response": {"status_code": 200, "request_id": "e0334e75d6c604df723818e8143a48d5", "body": {"id": "chatcmpl-BhN0JA4BlT1VawQBhOrIk7kPew1Lo", "object": "chat.completion", "created": 1749676231, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select all columns from probability and ps1_ztf tables for objects meeting the specified conditions\nSELECT p.*, ps.*\nFROM (\n    -- Subquery to select object IDs with probability > 0.6 for any of the specified classes in the hierarchical_rf_1.1.0 classifier\n    SELECT oid\n    FROM probability\n    WHERE classifier_name = 'lc_classifier'\n      AND classifier_version = 'hierarchical_rf_1.1.0'\n      AND class_name IN ('Cepheid', 'DSCT', 'RRL')\n      AND probability > 0.6\n      AND ranking = 1 -- Ensure selecting the top-ranked class per object for clarity and efficiency\n) AS filtered_probs\nJOIN object o ON o.oid = filtered_probs.oid\nJOIN probability p ON p.oid = o.oid\n  AND p.class_name IN ('Cepheid', 'DSCT', 'RRL')\n  AND p.classifier_name = 'lc_classifier'\n  AND p.classifier_version = 'hierarchical_rf_1.1.0'\n  AND p.probability > 0.6\n  AND p.ranking = 1 -- Consistent with subquery to focus on top class per object\nJOIN ps1_ztf ps ON ps.oid = o.oid\nWHERE ps.sgscore1 > 0.8\nLIMIT 100;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2406, "completion_tokens": 285, "total_tokens": 2691, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0dd1e7c8190931db5483b821fa4", "custom_id": "74-0", "response": {"status_code": 200, "request_id": "dd2389710f9a444f358409dc0221835e", "body": {"id": "chatcmpl-BhN0PVuIuPsHXiTqMNAE6x9D9LwiS", "object": "chat.completion", "created": 1749676237, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define a Common Table Expression (CTE) with the specified ZTF objects\nWITH ztf_ids AS (\n    VALUES \n        ('ZTF20abmaqeh', 'ZTF20abmaqeh'),\n        ('ZTF18abwxduj', 'ZTF18abwxduj'),\n        ('ZTF19aactlln', 'ZTF19aactlln')\n)\n-- Select relevant data from ss_ztf, joining with the ztf_ids CTE\nSELECT \n    ztf_ids.column2 AS ztf_object_id, -- ZTF identifier\n    sss.ssnamenr AS mpc_object_id,   -- MPC object identifier\n    sss.ssmagnr AS mpc_magnitude    -- MPC magnitude\nFROM \n    ztf_ids\nJOIN \n    ss_ztf sss ON sss.oid = ztf_ids.column1 -- Match by ZTF object OID\nWHERE \n    sss.ssmagnr < 19.2 -- Brightness condition\nORDER BY \n    sss.ssmagnr DESC; -- Sort by magnitude descending\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1157, "completion_tokens": 233, "total_tokens": 1390, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0dd406081909839ccbcc60d1dcb", "custom_id": "74-1", "response": {"status_code": 200, "request_id": "173c98d309551cb83314b92f051e2918", "body": {"id": "chatcmpl-BhN0NKugkebTdF3XUNpgXSMrG1Ndm", "object": "chat.completion", "created": 1749676235, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define a temporary table with the specified ZTF objects\nWITH ztf_ids AS (\n    VALUES \n        ('ZTF20abmaqeh', 'ZTF20abmaqeh'),\n        ('ZTF18abwxduj', 'ZTF18abwxduj'),\n        ('ZTF19aactlln', 'ZTF19aactlln')\n)\n-- Select relevant data by joining with ss_ztf\nSELECT \n    ztf_ids.column2 AS ztf_object_id,        -- ZTF object identifier\n    ss.ssnamnr AS mpc_object_id,             -- MPC object identifier\n    ss.ssmagnr AS mpc_magnitude             -- MPC magnitude\nFROM \n    ztf_ids\nJOIN \n    ss_ztf ss ON ss.oid = ztf_ids.column1   -- Join on ZTF object OID\nWHERE \n    ss.ssmagnr < 19.2                        -- Brightness condition\nORDER BY \n    ss.ssmagnr DESC;                        -- Sort by magnitude descending\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1139, "completion_tokens": 219, "total_tokens": 1358, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0dd5e2881908159dc87ed093504", "custom_id": "74-2", "response": {"status_code": 200, "request_id": "0e028b0d3badce0b65be7aaeada859df", "body": {"id": "chatcmpl-BhN0KsZmbkA9k9FbpqEoc7mjWqXO9", "object": "chat.completion", "created": 1749676232, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define a temporary table with the specified ZTF objects using VALUES and aliasing correctly\nWITH ztf_objects (ztf_oid, ztf_identifier) AS (\n    VALUES \n        ('ZTF20abmaqeh', 'ZTF20abmaqeh'),\n        ('ZTF18abwxduj', 'ZTF18abwxduj'),\n        ('ZTF19aactlln', 'ZTF19aactlln')\n)\n\n-- Select ZTF object identifiers, corresponding MPC object IDs, and MPC magnitudes\nSELECT \n    ztf_identifier AS ztf_object_id,\n    sss.ssnamenr AS mpc_object_id,\n    sss.ssmagnr AS mpc_magnitude\nFROM \n    ztf_objects\nJOIN \n    ss_ztf sss ON sss.oid = ztf_objects.ztf_oid\nWHERE \n    sss.ssmagnr < 19.2\nORDER BY \n    sss.ssmagnr DESC;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1157, "completion_tokens": 208, "total_tokens": 1365, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_f12167b370"}}, "error": null}
{"id": "batch_req_6849f0dd77f48190bf13db4d7b901b1b", "custom_id": "74-3", "response": {"status_code": 200, "request_id": "551386ca1b3afdc3d2b2fc7164f032c4", "body": {"id": "chatcmpl-BhN0LxFXuuStEbmkcTlgnwfqN9EVJ", "object": "chat.completion", "created": 1749676233, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define a temporary table with the specified ZTF objects using VALUES and aliasing correctly\nWITH ztf_objects (ztf_oid, ztf_identifier) AS (\n    VALUES \n        ('ZTF20abmaqeh', 'ZTF20abmaqeh'),\n        ('ZTF18abwxduj', 'ZTF18abwxduj'),\n        ('ZTF19aactlln', 'ZTF19aactlln')\n)\n\n-- Select ZTF object identifiers, corresponding MPC object IDs, and MPC magnitudes\nSELECT \n    ztf_identifier AS ztf_object_id,\n    sss.ssnamenr AS mpc_object_id,\n    sss.ssmagnr AS mpc_magnitude\nFROM \n    ztf_objects\nJOIN \n    ss_ztf sss ON sss.oid = ztf_objects.ztf_oid\nWHERE \n    sss.ssmagnr < 19.2\nORDER BY \n    sss.ssmagnr DESC;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1157, "completion_tokens": 208, "total_tokens": 1365, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_f12167b370"}}, "error": null}
{"id": "batch_req_6849f0dd92a081908818a5daa8ceb88f", "custom_id": "66-1", "response": {"status_code": 200, "request_id": "3da902f02ebafef4678e8ebe59edba95", "body": {"id": "chatcmpl-BhN0PQyNu9HilYYEM4QUNC43ojYIh", "object": "chat.completion", "created": 1749676237, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Retrieve the object with the specified ID to get its meanra and meandec\nWITH ztf_object AS (\n    SELECT oid, meanra, meandec\n    FROM object\n    WHERE oid = 'ZTF22abftjko'\n),\n-- Find the nearest Gaia object based on angular distance\nnearest_gaia AS (\n    SELECT \n        g.oid AS ztf_oid,\n        g.candid,\n        g.neargaia,\n        g.maggaiabright,\n        -- Calculate angular distance using the provided Gaia source distance in arcseconds\n        g.neargaia AS distance_arcsec\n    FROM gaia_ztf g\n    CROSS JOIN ztf_object z\n    -- Order by the Gaia source distance to find the closest\n    ORDER BY g.neargaia\n    LIMIT 1\n)\n-- Select the ZTF object ID, the distance to the nearest Gaia source, and the Gaia magnitude\nSELECT \n    ztf_oid,\n    distance_arcsec AS distance,\n    maggaiabright AS mag_gaia\nFROM nearest_gaia;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1614, "completion_tokens": 224, "total_tokens": 1838, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0ddaf4481909d9b4c51ad94783e", "custom_id": "66-2", "response": {"status_code": 200, "request_id": "1a5955b98bd6f951d57c23f9d93be3ea", "body": {"id": "chatcmpl-BhN0Lo9S5WwJWwGlewiUgOBnw65os", "object": "chat.completion", "created": 1749676233, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Retrieve the nearest Gaia object to the specified ZTF object along with the distance and Gaia magnitude\nWITH ztf_object AS (\n    SELECT oid, meanra, meandec\n    FROM object\n    WHERE oid = 'ZTF22abftjko'\n),\n-- Calculate the angular distance between the ZTF object and all Gaia sources\ngaia_distances AS (\n    SELECT \n        g.oid AS gaia_oid,\n        g.candid,\n        g.neargaia,\n        g.maggaia,\n        -- Use q3c_dist to compute the angular separation in degrees\n        q3c_dist(z.meanra, z.meandec, g.neargaia, g.maggaia) AS distance_deg\n    FROM gaia_ztf g\n    JOIN ztf_object z ON TRUE\n)\n-- Select the closest Gaia source based on the computed distance\nSELECT \n    gaia_oid AS gaia_object_id,\n    distance_deg AS distance_in_degrees,\n    maggaia AS Gaia_magnitude\nFROM gaia_distances\nORDER BY distance_deg\nLIMIT 1;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1547, "completion_tokens": 228, "total_tokens": 1775, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0ddd0ec81909c1532b3a6928204", "custom_id": "66-3", "response": {"status_code": 200, "request_id": "b4ff563512b4009b7272f9c2aeee2543", "body": {"id": "chatcmpl-BhN0Kr1g5o1lMaZW6HmVoKwaXBqya", "object": "chat.completion", "created": 1749676232, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Retrieve the nearest Gaia object to the specified ZTF object along with the distance and Gaia magnitude\nWITH ztf_object AS (\n    SELECT oid, meanra, meandec\n    FROM object\n    WHERE oid = 'ZTF22abftjko'\n),\n-- Calculate the angular distance between the ZTF object and all Gaia objects\ngaia_distances AS (\n    SELECT \n        g.oid AS gaia_oid,\n        g.candid,\n        g.neargaia,\n        g.maggaia,\n        -- Use q3c_dist to compute the angular distance in degrees\n        q3c_dist(z.meanra, z.meandec, g.neargaia, g.maggaia) AS distance_deg\n    FROM gaia_ztf g\n    JOIN ztf_object z ON TRUE\n)\n-- Select the Gaia object with the minimum distance\nSELECT \n    gaia_oid AS ztf_oid,\n    distance_deg AS distance_in_degrees,\n    maggaia AS Gaia_magnitude\nFROM gaia_distances\nORDER BY distance_deg\nLIMIT 1;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1547, "completion_tokens": 225, "total_tokens": 1772, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0ddea0881909f8289ee40542c78", "custom_id": "91-0", "response": {"status_code": 200, "request_id": "ebacf0d1672de41bedff6344de49713a", "body": {"id": "chatcmpl-BhN0L08C6uV31jU1yrVMSWH0T17i5", "object": "chat.completion", "created": 1749676233, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select ZTF object identifier, number of detections, difference between min g-r and r-band difference magnitudes, W1-W2 color, and feature version\nSELECT \n    o.oid AS ztf_identifier,\n    o.ndet AS number_of_detections,\n    (f_g_r_max.value - f_r_max.value) AS mag_diff,\n    f_w1_w2.value AS w1_w2,\n    f_w1_w2.version AS feature_version\nFROM \n    object o\n-- Join with feature table to get the maximum g-r difference magnitude\nJOIN \n    feature f_g_r_max ON o.oid = f_g_r_max.oid \n    AND f_g_r_max.name = 'g-r_max' \n    AND f_g_r_max.fid = 13\n-- Join with feature table to get the maximum r-band magnitude\nJOIN \n    feature f_r_max ON o.oid = f_r_max.oid \n    AND f_r_max.name = 'max_mag' \n    AND f_r_max.fid = 2\n-- Join with feature table to get the W1-W2 color\nJOIN \n    feature f_w1_w2 ON o.oid = f_w1_w2.oid \n    AND f_w1_w2.name = 'W1-W2' \n    AND f_w1_w2.fid = 1\n-- Filter for objects with W1-W2 color less than 1\nWHERE \n    f_w1_w2.value < 1\n-- Limit the result to 100 rows for performance\nLIMIT 100;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 4011, "completion_tokens": 329, "total_tokens": 4340, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0de066c81909b6cf56e65dafc24", "custom_id": "91-2", "response": {"status_code": 200, "request_id": "bf5e0b84e6874b258f6ad10f248e6513", "body": {"id": "chatcmpl-BhN0P408xNBC2uRMh3ixVZKeTXG4L", "object": "chat.completion", "created": 1749676237, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select ZTF object identifier, number of detections, difference between min g-r and r-g magnitudes, W1-W2 feature value, and feature version\nSELECT \n    o.oid AS ztf_identifier,\n    o.ndet AS number_of_detections,\n    (f_g_r_min.value - f_r_g_min.value) AS mag_diff,\n    f_w1_w2.value AS w1_w2,\n    f_w1_w2.version AS feature_version\nFROM \n    object o\n-- Join with feature table to get g-r_min, r-g_min, and W1-W2 features\nJOIN \n    feature f_g_r_min ON o.oid = f_g_r_min.oid AND f_g_r_min.name = 'g-r_min'\nJOIN \n    feature f_r_g_min ON o.oid = f_r_g_min.oid AND f_r_g_min.name = 'r-g_min'\nJOIN \n    feature f_w1_w2 ON o.oid = f_w1_w2.oid AND f_w1_w2.name = 'W1-W2'\n-- Filter for W1-W2 feature value less than 1\nWHERE \n    f_w1_w2.value < 1\n-- Limit to 100 results\nLIMIT 100;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3956, "completion_tokens": 265, "total_tokens": 4221, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0de21c08190a5586b8428128adf", "custom_id": "91-3", "response": {"status_code": 200, "request_id": "a887a38cb9d8492ebb100384c78065ce", "body": {"id": "chatcmpl-BhN0Mf9UwuaVnqDN7w2bZeVWpWRQD", "object": "chat.completion", "created": 1749676234, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select ZTF object identifier, number of detections, difference between min g-r and r-g magnitudes, W1-W2 feature value, and feature version\nSELECT \n    o.oid AS ztf_identifier,\n    o.ndet AS number_of_detections,\n    (f_g_r_min.value - f_r_g_min.value) AS mag_diff,\n    f_w1_w2.value AS w1_w2,\n    f_w1_w2.version AS feature_version\nFROM \n    object o\n-- Join with feature table to get g-r_min, r-g_min, and W1-W2 features\nJOIN \n    feature f_g_r_min ON o.oid = f_g_r_min.oid AND f_g_r_min.name = 'g-r_min'\nJOIN \n    feature f_r_g_min ON o.oid = f_r_g_min.oid AND f_r_g_min.name = 'r-g_min'\nJOIN \n    feature f_w1_w2 ON o.oid = f_w1_w2.oid AND f_w1_w2.name = 'W1-W2'\n-- Filter for W1-W2 color less than 1\nWHERE \n    f_w1_w2.value < 1\n-- Limit to 100 results\nLIMIT 100;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3954, "completion_tokens": 264, "total_tokens": 4218, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0de3c7c8190932b4ebffdefea85", "custom_id": "68-1", "response": {"status_code": 200, "request_id": "1e074c7174db972895d285ac300da5a4", "body": {"id": "chatcmpl-BhN0P0DOYWPATgTuRKBV2yfPpL9AN", "object": "chat.completion", "created": 1749676237, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Retrieve the PS1 source information for the closest PS1 source to the specified ZTF object\nWITH ztf_object AS (\n    SELECT oid, meanra, meandec\n    FROM object\n    WHERE oid = 'ZTF21abfrbnm'\n),\nnearest_ps1 AS (\n    SELECT \n        p.objectidps1,\n        p.sgmag1,\n        p.sgscore1,\n        -- Calculate angular distance between the ZTF object and PS1 source\n        -- Using the haversine formula or similar approximation for small angles\n        -- Since the schema does not specify a function, we compute the angular separation manually\n        -- Convert degrees to radians for calculation\n        (\n            -- Difference in RA in radians\n            radians(p.objectidps1) - radians(o.meanra)\n        ) AS delta_ra_rad,\n        (\n            -- Difference in Dec in radians\n            radians(p.objectidps1) - radians(o.meandec)\n        ) AS delta_dec_rad,\n        -- Approximate angular distance in radians\n        sqrt(\n            power(sin((radians(p.objectidps1) - radians(o.meanra)) / 2), 2) +\n            cos(radians(o.meanra)) * cos(radians(p.objectidps1)) *\n            power(sin((radians(p.objectidps1) - radians(o.meandec)) / 2), 2)\n        ) AS distance_rad\n    FROM \n        ps1_ztf p,\n        ztf_object o\n    ORDER BY \n        -- Order by the calculated angular distance\n        sqrt(\n            power(sin((radians(p.objectidps1) - radians(o.meanra)) / 2), 2) +\n            cos(radians(o.meanra)) * cos(radians(p.objectidps1)) *\n            power(sin((radians(p.objectidps1) - radians(o.meandec)) / 2), 2)\n        )\n    LIMIT 1\n)\nSELECT \n    objectidps1 AS ps1_identifier,\n    sgmag1 AS g_band_magnitude,\n    sgscore1 AS star_galaxy_score,\n    -- Convert distance from radians to degrees\n    degrees(distance_rad) AS distance_to_ztf_object_deg\nFROM nearest_ps1;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2240, "completion_tokens": 472, "total_tokens": 2712, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0de581c8190ab5e6e0aace1a019", "custom_id": "68-2", "response": {"status_code": 200, "request_id": "bb90db059c6136c986b1d5934bcaab59", "body": {"id": "chatcmpl-BhN0Re6OuYC2DBZGKVJiM8sWlkJTE", "object": "chat.completion", "created": 1749676239, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Retrieve the PS1 source information for the closest PS1 source to the specified ZTF object\nWITH ztf_object AS (\n    SELECT oid, meanra, meandec\n    FROM object\n    WHERE oid = 'ZTF21abfrbnm'\n),\nnearest_ps1 AS (\n    SELECT \n        p.objectidps1,\n        p.sgmag1,\n        p.sgscore1,\n        -- Calculate angular distance using the haversine formula or similar approximation\n        -- Since the schema does not specify a function like q3c_dist, we compute the distance manually\n        -- Convert degrees to radians for calculation\n        6371 * acos(\n            cos(radians(o.meanra)) * cos(radians(p.objectidps1)) * cos(radians(p.objectidps1) - radians(o.meandec))\n            + sin(radians(o.meanra)) * sin(radians(p.objectidps1))\n        ) AS distance_deg\n    FROM \n        ps1_ztf p,\n        ztf_object o\n    ORDER BY \n        -- Order by the calculated distance to find the nearest source\n        6371 * acos(\n            cos(radians(o.meanra)) * cos(radians(p.objectidps1)) * cos(radians(p.objectidps1) - radians(o.meandec))\n            + sin(radians(o.meanra)) * sin(radians(p.objectidps1))\n        )\n    LIMIT 1\n)\nSELECT \n    objectidps1 AS ps1_identifier,\n    sgmag1 AS g_band_magnitude,\n    sgscore1 AS star_galaxy_score,\n    distance_deg AS distance_to_ztf_object_deg\nFROM nearest_ps1;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2240, "completion_tokens": 352, "total_tokens": 2592, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0de73948190a2b190494f1a7b09", "custom_id": "68-3", "response": {"status_code": 200, "request_id": "bfb04b452497448009c3fd477c5fc09a", "body": {"id": "chatcmpl-BhN0M2n29fOS11w2hLOyqPkfpuENP", "object": "chat.completion", "created": 1749676234, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Retrieve the PS1 source information for the closest source to the specified ZTF object\nWITH ztf_object AS (\n    SELECT oid, meanra, meandec\n    FROM object\n    WHERE oid = 'ZTF21abfrbnm'\n),\nnearest_ps1 AS (\n    SELECT \n        p.objectidps1,\n        p.sgmag1,\n        p.sgscore1,\n        -- Calculate angular distance using the haversine formula or similar approximation\n        -- Since the schema does not specify a function, we compute the distance manually\n        -- Convert degrees to radians for calculation\n        (\n            acos(\n                sin(radians(o.meanra)) * sin(radians(p.objectidps1)) +\n                cos(radians(o.meanra)) * cos(radians(p.objectidps1)) * cos(radians(o.meandec) - radians(p.sgmag1))\n            )\n        ) AS distance_rad\n    FROM \n        ps1_ztf p,\n        ztf_object o\n    ORDER BY \n        -- Order by the calculated angular distance\n        distance_rad\n    LIMIT 1\n)\nSELECT \n    objectidps1 AS ps1_identifier,\n    sgmag1 AS g_band_magnitude,\n    sgscore1 AS star_galaxy_score,\n    -- Convert distance from radians to degrees\n    degrees(distance_rad) AS distance_to_ztf_object_deg\nFROM nearest_ps1;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2236, "completion_tokens": 292, "total_tokens": 2528, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_f12167b370"}}, "error": null}
{"id": "batch_req_6849f0de92bc81909dd5e7d49e521e5c", "custom_id": "76-0", "response": {"status_code": 200, "request_id": "4701eb007fa1a67a37b1e84a3b9454ea", "body": {"id": "chatcmpl-BhN0SaS7Y1dcN8GSMF9w5ZwrxTuLI", "object": "chat.completion", "created": 1749676240, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Corrected SQL query to find ZTF objects within 1.5 arcsec of the MPC object '115185'\nWITH mpc_object AS (\n    SELECT \n        ssmagnr, -- magnitude of the MPC object\n        meanra,  -- right ascension of the MPC object\n        meandec  -- declination of the MPC object\n    FROM ss_ztf\n    WHERE oid = '115185'\n)\nSELECT \n    o.oid AS ztf_object_id,\n    o.g_r_max AS mpc_magnitude,\n    -- Calculate angular distance between ZTF object and MPC object using q3c_dist\n    q3c_dist(o.meanra, o.meandec, c.meanra, c.meandec) AS distance_arcsec\nFROM \n    object o,\n    mpc_object c\nWHERE \n    -- Filter ZTF objects within 1.5 arcsec of the MPC object\n    q3c_join(o.meanra, o.meandec, c.meanra, c.meandec, 1.5/3600)\nORDER BY \n    distance_arcsec;", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1582, "completion_tokens": 230, "total_tokens": 1812, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0deacbc8190af882a3034116ef0", "custom_id": "76-1", "response": {"status_code": 200, "request_id": "98c56d43f72a66753b6b8a72491a3e4c", "body": {"id": "chatcmpl-BhN0OHHWNjuLBiY1wbuWhniI1wDDt", "object": "chat.completion", "created": 1749676236, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Corrected SQL query to find ZTF objects within 1.5 arcsec of the MPC object '115185'\nWITH mpc_object AS (\n    SELECT \n        ssmagnr, -- magnitude of the MPC object\n        meanra,  -- right ascension of the MPC object\n        meandec  -- declination of the MPC object\n    FROM ss_ztf\n    WHERE oid = '115185'\n)\nSELECT \n    o.oid AS ztf_object_id,\n    o.g_r_max AS mpc_magnitude,\n    -- Calculate angular distance between ZTF object and MPC object using q3c_dist\n    q3c_dist(o.meanra, o.meandec, c.meanra, c.meandec) AS distance_arcsec\nFROM \n    object o,\n    mpc_object c\nWHERE \n    -- Filter ZTF objects within 1.5 arcsec of the MPC object\n    q3c_join(o.meanra, o.meandec, c.meanra, c.meandec, 1.5/3600)\nORDER BY \n    distance_arcsec;", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1582, "completion_tokens": 230, "total_tokens": 1812, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0decadc8190ab9ea2f84a79992f", "custom_id": "76-2", "response": {"status_code": 200, "request_id": "6313ddaf6780a61a71ec63261744eca1", "body": {"id": "chatcmpl-BhN0QN309aydGJf1c3X2SWXM3n1ga", "object": "chat.completion", "created": 1749676238, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define the object for the Solar System object with oid '115185' from ss_ztf\nWITH mpc_object AS (\n    SELECT oid, ssmagnr, meanra, meandec\n    FROM ss_ztf\n    WHERE oid = '115185'\n),\n-- Select all ZTF objects that are within 1.5 arcsec of the MPC object\nzft_objects_with_distance AS (\n    SELECT \n        o.oid AS ztf_oid,\n        o.meanra,\n        o.meandec,\n        -- Calculate the angular distance in degrees between the object and the MPC object\n        q3c_dist(o.meanra, o.meandec, m.meanra, m.meandec) AS distance_deg\n    FROM object o\n    CROSS JOIN mpc_object m\n    -- Filter objects within 1.5 arcsec (convert arcsec to degrees: 1.5/3600)\n    WHERE q3c_dist(o.meanra, o.meandec, m.meanra, m.meandec) <= (1.5/3600)\n)\n-- Select the ZTF object ID, MPC magnitude, and distance, ordered by distance\nSELECT \n    ztf_oid,\n    ssmagnr,\n    -- Convert distance from degrees to arcseconds for clarity\n    q3c_dist(meanra, meandec, (SELECT meanra FROM mpc_object), (SELECT meandec FROM mpc_object)) * 3600 AS distance_arcsec\nFROM zft_objects_with_distance\nJOIN ss_ztf ON ss_ztf.oid = ztf_oid\nORDER BY distance_arcsec;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1790, "completion_tokens": 342, "total_tokens": 2132, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6849f0def0108190b3396ba047a78f09", "custom_id": "76-3", "response": {"status_code": 200, "request_id": "424188ca1191abf18b2029a2731bcda9", "body": {"id": "chatcmpl-BhN0QodCdIeJGQwgm8jc28UhYDnGX", "object": "chat.completion", "created": 1749676238, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define a temporary table with the MPC object coordinates for '115185'\nWITH mpc_object AS (\n    SELECT \n        ssmagnr AS ra,        -- Use ssmagnr as RA (Right Ascension)\n        ssnamenr AS dec       -- Use ssnamenr as Dec (Declination)\n    FROM ss_ztf\n    WHERE oid = '115185'\n    LIMIT 1\n),\n-- Select ZTF objects within 1.5 arcsec of the MPC object\nztf_near_mpc AS (\n    SELECT \n        o.oid AS ztf_id,\n        s.ssmagnr AS mpc_magnitude,\n        -- Calculate angular distance in degrees between object and MPC object\n        q3c_dist(o.meanra, o.meandec, m.ra, m.dec) AS distance_deg\n    FROM \n        object o\n        CROSS JOIN mpc_object m\n        JOIN ss_ztf s ON s.oid = o.oid\n    WHERE \n        -- Filter objects within 1.5 arcsec (convert to degrees)\n        q3c_dist(o.meanra, o.meandec, m.ra, m.dec) <= 1.5 / 3600.0\n)\n-- Select and sort by distance in arcseconds\nSELECT \n    ztf_id,\n    mpc_magnitude,\n    distance_deg * 3600 AS distance_arcsec -- convert degrees to arcseconds\nFROM \n    ztf_near_mpc\nORDER BY \n    distance_deg;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1785, "completion_tokens": 316, "total_tokens": 2101, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
