{"id": "batch_req_6866b746ff7c8190bc87d1fd46c0701f", "custom_id": "8-0", "response": {"status_code": 200, "request_id": "b52ff1cc0ebfee94fac36c516ee7a53c", "body": {"id": "chatcmpl-BpHUt4D4KGvD3iC6a6WpSttzqAAIz", "object": "chat.completion", "created": 1751561687, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects first classified as 'SN' by the stamp classifier between August 17 and August 21\nSELECT o.*\nFROM object o\n-- Join with probability table to filter for 'SN' class with probability > 0.5 and ranking=1\nINNER JOIN probability p ON o.oid = p.oid\nWHERE p.class_name = 'SN'\n  AND p.classifier_name = 'stamp_classifier'\n  AND p.ranking = 1\n  AND p.probability > 0.5\n-- Join with classification info to ensure this is the first classification as SN within the date range\nAND o.firstmjd >= 60173.0\nAND o.firstmjd <= 60177.0\n-- Filter objects with at least two detections\nAND o.ndet >= 2\n-- Ensure the classification as SN is the first for the object\nAND o.firstmjd = (\n    SELECT MIN(o2.firstmjd)\n    FROM object o2\n    INNER JOIN probability p2 ON o2.oid = p2.oid\n    WHERE p2.class_name = 'SN'\n      AND p2.classifier_name = 'stamp_classifier'\n      AND p2.ranking = 1\n      AND p2.probability > 0.5\n      AND o2.oid = o.oid\n)\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3181, "completion_tokens": 280, "total_tokens": 3461, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b74786f0819081ef202c2dbc3181", "custom_id": "8-1", "response": {"status_code": 200, "request_id": "0f7fffeb26aa4b3427149748ebbc3847", "body": {"id": "chatcmpl-BpHV3NYJuEJxDatsPYUJyJZdbHkAS", "object": "chat.completion", "created": 1751561697, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects that meet the classification and detection criteria\nSELECT o.*\nFROM object o\n-- Join with probability table to filter for SN classification with high probability\nINNER JOIN probability p ON o.oid = p.oid\n-- Join with detection table to count detections per object\nINNER JOIN (\n    SELECT oid, COUNT(*) AS detection_count, MIN(mjd) AS first_detection_mjd\n    FROM detection\n    GROUP BY oid\n) d ON o.oid = d.oid\nWHERE\n    -- Filter for objects classified as 'SN' by 'stamp_classifier' with probability > 0.5 and ranking 1\n    p.class_name = 'SN'\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.probability > 0.5\n    AND p.ranking = 1\n    -- Ensure the first detection date is between August 17 and August 21\n    AND d.first_detection_mjd BETWEEN 60173.0 AND 60177.0\n    -- Ensure the object has at least two detections\n    AND d.detection_count >= 2;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3145, "completion_tokens": 232, "total_tokens": 3377, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b748c96081909717d4811618c4a5", "custom_id": "27-0", "response": {"status_code": 200, "request_id": "666d36987e0ba3f6f5ef9ea1df3bdab0", "body": {"id": "chatcmpl-BpHUvYKtiPi6oVzRszczmyqogiKxD", "object": "chat.completion", "created": 1751561689, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select main object information\nSELECT \n    o.oid, \n    o.meanra, \n    o.meandec, \n    o.ndet, \n    o.firstmjd, \n    o.deltajd, \n    o.g_r_max,\n    -- Classifier name\n    p_classifier.classifier_name,\n    -- Class name (most probable class, should be 'CEP')\n    p_classifier.class_name,\n    -- Ranking (should be 1 for most probable class)\n    p_classifier.ranking,\n    -- Probabilities for each class, joined separately\n    sniap.probability AS \"SNIa\",\n    snibc.probability AS \"SNIbc\",\n    snii.probability AS \"SNII\",\n    slsn.probability AS \"SLSN\",\n    qso.probability AS \"QSO\",\n    agn.probability AS \"AGN\",\n    blazar.probability AS \"Blazar\",\n    cvnova.probability AS \"CV/Nova\",\n    yso.probability AS \"YSO\",\n    lpv.probability AS \"LPV\",\n    e.probability AS \"E\",\n    dsc.probability AS \"DSCT\",\n    rrl.probability AS \"RRL\",\n    cep.probability AS \"CEP\",\n    periodic_other.probability AS \"Periodic-Other\"\nFROM object o\n-- Join with the probability table for the classifier 'lc_classifier' and ranking=1\nINNER JOIN probability p_classifier ON o.oid = p_classifier.oid\n    AND p_classifier.classifier_name = 'lc_classifier'\n    AND p_classifier.ranking = 1\n-- Join with probability entries for each class to get their probabilities\nLEFT JOIN probability sniap ON o.oid = sniap.oid AND sniap.class_name = 'SNIa' AND sniap.classifier_name='lc_classifier'\nLEFT JOIN probability snibc ON o.oid = snibc.oid AND snibc.class_name = 'SNIbc' AND snibc.classifier_name='lc_classifier'\nLEFT JOIN probability snii ON o.oid = snii.oid AND snii.class_name = 'SNII' AND snii.classifier_name='lc_classifier'\nLEFT JOIN probability slsn ON o.oid = slsn.oid AND slsn.class_name = 'SLSN' AND slsn.classifier_name='lc_classifier'\nLEFT JOIN probability qso ON o.oid = qso.oid AND qso.class_name = 'QSO' AND qso.classifier_name='lc_classifier'\nLEFT JOIN probability agn ON o.oid = agn.oid AND agn.class_name = 'AGN' AND agn.classifier_name='lc_classifier'\nLEFT JOIN probability blazar ON o.oid = blazar.oid AND blazar.class_name = 'Blazar' AND blazar.classifier_name='lc_classifier'\nLEFT JOIN probability cvnova ON o.oid = cvnova.oid AND cvnova.class_name = 'CV/Nova' AND cvnova.classifier_name='lc_classifier'\nLEFT JOIN probability yso ON o.oid = yso.oid AND yso.class_name = 'YSO' AND yso.classifier_name='lc_classifier'\nLEFT JOIN probability lpv ON o.oid = lpv.oid AND lpv.class_name = 'LPV' AND lpv.classifier_name='lc_classifier'\nLEFT JOIN probability e ON o.oid = e.oid AND e.class_name = 'E' AND e.classifier_name='lc_classifier'\nLEFT JOIN probability dsc ON o.oid = dsc.oid AND dsc.class_name = 'DSCT' AND dsc.classifier_name='lc_classifier'\nLEFT JOIN probability rrl ON o.oid = rrl.oid AND rrl.class_name = 'RRL' AND rrl.classifier_name='lc_classifier'\nLEFT JOIN probability cep ON o.oid = cep.oid AND cep.class_name = 'CEP' AND cep.classifier_name='lc_classifier'\nLEFT JOIN probability periodic_other ON o.oid = periodic_other.oid AND periodic_other.class_name = 'Periodic-Other' AND periodic_other.classifier_name='lc_classifier'\nWHERE \n    o.ndet >= 100\n    AND -- Filter for most likely class being 'CEP' with probability > 0.76\n    cep.probability > 0.76\nORDER BY \n    cep.probability DESC;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3229, "completion_tokens": 923, "total_tokens": 4152, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b7495cc88190b42920fb6726640a", "custom_id": "27-1", "response": {"status_code": 200, "request_id": "5b477236fa08942236bf749c842028f7", "body": {"id": "chatcmpl-BpHVoUZf29vtOS5EoLKjwrPwSlhIl", "object": "chat.completion", "created": 1751561744, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object information along with classification probabilities for each class\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    p.class_name,\n    p.classifier_name,\n    p.ranking,\n    p.probability,\n    -- Probabilities for each class of interest\n    -- Join for each class to get their probabilities\n    -- Using LEFT JOINs to include objects even if some class probabilities are missing\n    p_snia.probability AS snia_probability,\n    p_snia.ranking AS snia_ranking,\n    p_snia.class_name AS snia_class,\n    p_snia.classifier_name AS snia_classifier,\n    p_snia.class_name AS snia_class_name,\n    p_snia.classifier_name AS snia_classifier_name,\n    p_snia.ranking AS snia_ranking,\n    p_snia.probability AS snia_probability,\n    p_snia.class_name AS snia_class,\n    p_snia.classifier_name AS snia_classifier,\n    p_snia.ranking AS snia_ranking,\n    p_snia.probability AS snia_probability,\n    p_snia.class_name AS snia_class,\n    p_snia.classifier_name AS snia_classifier,\n    p_snia.ranking AS snia_ranking,\n    p_snia.probability AS snia_probability,\n    -- Repeat for each class\n    -- For brevity, only including 'SNIa' and 'CEP' as example; add others similarly\n    -- For all classes, join multiple times\n    -- SNIa\n    (SELECT probability FROM probability p2 WHERE p2.oid = o.oid AND p2.class_name = 'SNIa' AND p2.classifier_name='lc_classifier' AND p2.ranking=1) AS snia_prob,\n    -- SNIbc\n    (SELECT probability FROM probability p3 WHERE p3.oid = o.oid AND p3.class_name = 'SNIbc' AND p3.classifier_name='lc_classifier' AND p3.ranking=1) AS snibc_prob,\n    -- SNII\n    (SELECT probability FROM probability p4 WHERE p4.oid = o.oid AND p4.class_name = 'SNII' AND p4.classifier_name='lc_classifier' AND p4.ranking=1) AS snii_prob,\n    -- SLSN\n    (SELECT probability FROM probability p5 WHERE p5.oid = o.oid AND p5.class_name = 'SLSN' AND p5.classifier_name='lc_classifier' AND p5.ranking=1) AS slsn_prob,\n    -- QSO\n    (SELECT probability FROM probability p6 WHERE p6.oid = o.oid AND p6.class_name = 'QSO' AND p6.classifier_name='lc_classifier' AND p6.ranking=1) AS qso_prob,\n    -- AGN\n    (SELECT probability FROM probability p7 WHERE p7.oid = o.oid AND p7.class_name = 'AGN' AND p7.classifier_name='lc_classifier' AND p7.ranking=1) AS agn_prob,\n    -- Blazar\n    (SELECT probability FROM probability p8 WHERE p8.oid = o.oid AND p8.class_name = 'Blazar' AND p8.classifier_name='lc_classifier' AND p8.ranking=1) AS blazar_prob,\n    -- CV/Nova\n    (SELECT probability FROM probability p9 WHERE p9.oid = o.oid AND p9.class_name = 'CV/Nova' AND p9.classifier_name='lc_classifier' AND p9.ranking=1) AS cvnova_prob,\n    -- YSO\n    (SELECT probability FROM probability p10 WHERE p10.oid = o.oid AND p10.class_name = 'YSO' AND p10.classifier_name='lc_classifier' AND p10.ranking=1) AS yso_prob,\n    -- LPV\n    (SELECT probability FROM probability p11 WHERE p11.oid = o.oid AND p11.class_name = 'LPV' AND p11.classifier_name='lc_classifier' AND p11.ranking=1) AS lpv_prob,\n    -- E\n    (SELECT probability FROM probability p12 WHERE p12.oid = o.oid AND p12.class_name = 'E' AND p12.classifier_name='lc_classifier' AND p12.ranking=1) AS e_prob,\n    -- DSCT\n    (SELECT probability FROM probability p13 WHERE p13.oid = o.oid AND p13.class_name = 'DSCT' AND p13.classifier_name='lc_classifier' AND p13.ranking=1) AS dsct_prob,\n    -- RRL\n    (SELECT probability FROM probability p14 WHERE p14.oid = o.oid AND p14.class_name = 'RRL' AND p14.classifier_name='lc_classifier' AND p14.ranking=1) AS rrl_prob,\n    -- CEP\n    (SELECT probability FROM probability p15 WHERE p15.oid = o.oid AND p15.class_name = 'CEP' AND p15.classifier_name='lc_classifier' AND p15.ranking=1) AS cep_prob\nFROM \n    object o\n-- Join to filter objects with at least 100 detections\nWHERE \n    o.ndet >= 100\n-- Join to filter for objects with the most probable class 'CEP' with probability > 0.76\nAND \n    (SELECT probability FROM probability p WHERE p.oid = o.oid AND p.class_name='CEP' AND p.classifier_name='lc_classifier' AND p.ranking=1) > 0.76\n-- Order by the probability of 'CEP' in descending order\nORDER BY \n    cep_prob DESC;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3205, "completion_tokens": 1240, "total_tokens": 4445, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b749e7b48190a17cae2f9d263bbf", "custom_id": "17-0", "response": {"status_code": 200, "request_id": "813f9495a149f959a50a3f0bd80884f6", "body": {"id": "chatcmpl-BpHUzOOJg4WpqyBqEUZBd7n26RvbG", "object": "chat.completion", "created": 1751561693, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Sub-query to select objects classified as AGN with highest confidence\nWITH agn_objects AS (\n    SELECT o.oid\n    FROM object o\n    INNER JOIN probability p ON o.oid = p.oid\n    WHERE p.class_name = 'AGN'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n),\n-- Sub-query to find objects with variability in the r band\nr_band_variability AS (\n    SELECT o.oid\n    FROM object o\n    INNER JOIN magstat m ON o.oid = m.oid\n    WHERE m.fid = 2 -- r band\n      AND m.magsigma > 0.1 -- variability threshold, adjust as needed\n),\n-- Sub-query to find objects with no detections or no variability in the g band\ng_band_no_variability AS (\n    SELECT o.oid\n    FROM object o\n    LEFT JOIN magstat m ON o.oid = m.oid AND m.fid = 1 -- g band\n    WHERE (m.ndet IS NULL OR m.ndet = 0 OR m.magsigma < 0.1) -- no detections or no variability\n),\n-- Final set of objects satisfying all conditions\nfinal_objects AS (\n    SELECT o.oid\n    FROM agn_objects o\n    INNER JOIN r_band_variability r ON o.oid = r.oid\n    INNER JOIN g_band_no_variability g ON o.oid = g.oid\n)\n-- Retrieve features for these objects ordered by feature value\nSELECT f.*\nFROM feature f\nWHERE f.oid IN (SELECT oid FROM final_objects)\nORDER BY f.value ASC, f.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3383, "completion_tokens": 354, "total_tokens": 3737, "prompt_tokens_details": {"cached_tokens": 2176, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b74a88948190aba0a43b85cca17c", "custom_id": "17-1", "response": {"status_code": 200, "request_id": "41afb0a86cd03b6ef55fb7b1dcc5b7aa", "body": {"id": "chatcmpl-BpHUz2eO8tCff66CYhLPdEqaeY82u", "object": "chat.completion", "created": 1751561693, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH agn_high_confidence AS (\n    SELECT o.oid\n    FROM object o\n    INNER JOIN probability p ON o.oid = p.oid\n    WHERE p.class_name = 'AGN'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n),\nr_band_variability AS (\n    SELECT o.oid\n    FROM object o\n    WHERE o.ndet > 0\n),\ng_band_no_detection AS (\n    SELECT o.oid\n    FROM object o\n    WHERE o.ndet = 0\n)\n-- Final selection: objects classified as AGN with high confidence, showing variability in r band,\n-- and no detections in g band\nSELECT f.*\nFROM feature f\nWHERE f.oid IN (\n    SELECT o.oid\n    FROM agn_high_confidence o\n    INNER JOIN r_band_variability r ON o.oid = r.oid\n    LEFT JOIN g_band_no_detection g ON o.oid = g.oid\n    WHERE g.oid IS NOT NULL OR g.oid IS NULL -- includes objects with no g detections\n)\nORDER BY f.value ASC, f.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3468, "completion_tokens": 245, "total_tokens": 3713, "prompt_tokens_details": {"cached_tokens": 1664, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b74b0f908190a0037901da4aff87", "custom_id": "1-0", "response": {"status_code": 200, "request_id": "5dba1c5d73915687269d53fbf110a359", "body": {"id": "chatcmpl-BpHXQ8oMKKtpt5lub0RK5961LesPD", "object": "chat.completion", "created": 1751561844, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Step 1: Filter objects with probability > 0.6, class 'AGN', classifier 'lc_classifier', ranking 1\nWITH classified_objects AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.class_name='AGN'\n      AND p.probability > 0.6\n      AND p.classifier_name='lc_classifier'\n      AND p.ranking=1\n),\n-- Step 2: Join with object table to get object info and filter by time coverage and detection count\nobjects_filtered AS (\n    SELECT o.*\n    FROM object o\n    INNER JOIN classified_objects co ON o.oid=co.oid\n    WHERE (o.mjdendhist - o.mjdstarthist) >= 365\n      AND o.ndet >= 20\n),\n-- Step 3: Count detections per object per filter to ensure at least 20 detections in one band\ndetections_count AS (\n    SELECT d.oid, d.fid, COUNT(*) AS count_detections\n    FROM detection d\n    GROUP BY d.oid, d.fid\n),\nobjects_with_detections AS (\n    SELECT o.*\n    FROM objects_filtered o\n    INNER JOIN detections_count dc ON o.oid=dc.oid\n    WHERE dc.count_detections >= 20 AND dc.fid IN (1,2)\n),\n-- Step 4: Retrieve features for max and min magnitudes in g and r bands\nfeatures_max_g AS (\n    SELECT f.oid, f.value AS max_mag_g, f.name, f.version, f.fid AS features_g_fid\n    FROM feature f\n    WHERE f.name='max_mag' AND f.fid=1\n),\nfeatures_min_g AS (\n    SELECT f.oid, f.value AS min_mag_g\n    FROM feature f\n    WHERE f.name='min_mag' AND f.fid=1\n),\nfeatures_max_r AS (\n    SELECT f.oid, f.value AS max_mag_r\n    FROM feature f\n    WHERE f.name='max_mag' AND f.fid=2\n),\nfeatures_min_r AS (\n    SELECT f.oid, f.value AS min_mag_r\n    FROM feature f\n    WHERE f.name='min_mag' AND f.fid=2\n),\n-- Step 5: Calculate magnitude variations\nmag_variations AS (\n    SELECT\n        o.oid,\n        o.meanra,\n        o.meandec,\n        o.ndet,\n        -- Get max and min magnitudes\n        mg.max_mag_g,\n        mg.min_mag_g,\n        mr.max_mag_r,\n        mr.min_mag_r,\n        -- Calculate delta magnitudes\n        (mg.max_mag_g - mg.min_mag_g) AS delta_mag_g,\n        (mr.max_mag_r - mr.min_mag_r) AS delta_mag_r\n    FROM objects_with_detections o\n    LEFT JOIN features_max_g mg ON o.oid=mg.oid\n    LEFT JOIN features_min_g mg2 ON o.oid=mg2.oid\n    LEFT JOIN features_max_r mr ON o.oid=mr.oid\n    LEFT JOIN features_min_r mr2 ON o.oid=mr2.oid\n    WHERE\n        (mg.max_mag_g - mg.min_mag_g) > 1\n        AND (mr.max_mag_r - mr.min_mag_r) > 0.5\n)\n-- Final selection: join all info and filter by magnitude variations\nSELECT\n    mv.oid,\n    mv.max_mag_g,\n    mv.min_mag_g,\n    mv.max_mag_r,\n    mv.min_mag_r,\n    mv.delta_mag_g,\n    mv.delta_mag_r,\n    mv.meanra,\n    mv.meandec,\n    mv.ndet,\n    -- Retrieve feature details for max_mag in g\n    fmg.value AS max_mag_value,\n    fmg.name AS max_mag_name,\n    fmg.version AS max_mag_version,\n    fmg.fid AS features_g_fid\nFROM mag_variations mv\nLEFT JOIN feature fmg ON mv.oid=fmg.oid AND fmg.name='max_mag' AND fmg.fid=1\nLEFT JOIN feature fming ON mv.oid=fming.oid AND fming.name='min_mag' AND fming.fid=1\nLEFT JOIN feature fmr ON mv.oid=fmr.oid AND fmr.name='max_mag' AND fmr.fid=2\nLEFT JOIN feature fminr ON mv.oid=fminr.oid AND fminr.name='min_mag' AND fminr.fid=2\nORDER BY mv.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3676, "completion_tokens": 960, "total_tokens": 4636, "prompt_tokens_details": {"cached_tokens": 2304, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b74ba250819081457d52d9564da1", "custom_id": "1-1", "response": {"status_code": 200, "request_id": "e151a16b3671c93090d03fa761a1fce3", "body": {"id": "chatcmpl-BpHWCnlHSdwFjvy7P6ZVEqgiCKsL1", "object": "chat.completion", "created": 1751561768, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH classified_objects AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.class_name = 'AGN'\n      AND p.probability > 0.6\n      AND p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n),\nduration_filter AS (\n    SELECT o.oid\n    FROM object o\n    JOIN classified_objects c ON o.oid = c.oid\n    WHERE (o.lastmjd - o.firstmjd) >= 365\n),\ndetection_counts AS (\n    SELECT d.oid, d.fid, COUNT(*) AS count_detections\n    FROM detection d\n    WHERE d.oid IN (SELECT oid FROM duration_filter)\n    GROUP BY d.oid, d.fid\n),\nmax_detections AS (\n    SELECT oid, MAX(count_detections) AS max_count\n    FROM detection_counts\n    GROUP BY oid\n),\nobjects_with_enough_detections AS (\n    SELECT o.oid\n    FROM object o\n    JOIN max_detections m ON o.oid = m.oid\n    WHERE m.max_count >= 20\n),\nfeatures_g AS (\n    SELECT f.oid, f.value, f.name, f.version, f.fid AS features_gfid\n    FROM feature f\n    WHERE f.name = 'max_mag_corr' AND f.fid = 1\n),\nfeatures_r AS (\n    SELECT f.oid, f.value, f.name, f.version, f.fid AS features_rfid\n    FROM feature f\n    WHERE f.name = 'max_mag_corr' AND f.fid = 2\n),\nmin_features_g AS (\n    SELECT f.oid, f.value AS min_value\n    FROM feature f\n    WHERE f.name = 'min_mag_corr' AND f.fid = 1\n),\nmin_features_r AS (\n    SELECT f.oid, f.value AS min_value\n    FROM feature f\n    WHERE f.name = 'min_mag_corr' AND f.fid = 2\n),\ndelta_features AS (\n    SELECT\n        g.oid,\n        g.value AS max_g,\n        r.value AS max_r,\n        min_g.min_value AS min_g,\n        min_r.min_value AS min_r\n    FROM features_g g\n    JOIN features_r r ON g.oid = r.oid\n    JOIN min_features_g min_g ON g.oid = min_g.oid\n    JOIN min_features_r min_r ON g.oid = min_r.oid\n),\nmagnitude_variations AS (\n    SELECT\n        oid,\n        (max_g - min_g) AS delta_mag_g,\n        (max_r - min_r) AS delta_mag_r\n    FROM delta_features\n),\nobjects_meeting_variation AS (\n    SELECT o.oid\n    FROM object o\n    JOIN magnitude_variations v ON o.oid = v.oid\n    WHERE v.delta_mag_g > 1 AND v.delta_mag_r > 0.5\n),\nfinal_objects AS (\n    SELECT o.*\n    FROM object o\n    WHERE o.oid IN (\n        SELECT oid FROM objects_with_enough_detections\n        INTERSECT\n        SELECT oid FROM objects_meeting_variation\n    )\n),\nfeatures_final AS (\n    SELECT f.oid, f.value, f.name, f.version, f.fid AS features_gfid\n    FROM feature f\n    WHERE f.name IN ('max_mag_corr', 'min_mag_corr') AND f.fid = 1\n    UNION ALL\n    SELECT f.oid, f.value, f.name, f.version, f.fid AS features_rfid\n    FROM feature f\n    WHERE f.name IN ('max_mag_corr', 'min_mag_corr') AND f.fid = 2\n),\nmax_min_mags AS (\n    SELECT\n        oid,\n        MAX(CASE WHEN name = 'max_mag_corr' AND fid = 1 THEN value END) AS max_g,\n        MIN(CASE WHEN name = 'min_mag_corr' AND fid = 1 THEN value END) AS min_g,\n        MAX(CASE WHEN name = 'max_mag_corr' AND fid = 2 THEN value END) AS max_r,\n        MIN(CASE WHEN name = 'min_mag_corr' AND fid = 2 THEN value END) AS min_r\n    FROM features_final\n    GROUP BY oid\n),\ndelta_mags AS (\n    SELECT\n        oid,\n        (max_g - min_g) AS delta_mag_g,\n        (max_r - min_r) AS delta_mag_r\n    FROM max_min_mags\n)\nSELECT\n    o.oid,\n    f.value,\n    f.name,\n    f.version,\n    f.features_gfid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    dm.max_g,\n    dm.min_g,\n    dm.max_r,\n    dm.min_r,\n    dm.delta_mag_g,\n    dm.delta_mag_r\nFROM final_objects o\nJOIN features_final f ON o.oid = f.oid\nJOIN delta_mags dm ON o.oid = dm.oid\nWHERE\n    (f.name = 'max_mag_corr' AND f.fid = 1)\n    OR (f.name = 'max_mag_corr' AND f.fid = 2)\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3618, "completion_tokens": 1093, "total_tokens": 4711, "prompt_tokens_details": {"cached_tokens": 2304, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b74c32d8819094e781e8ef8f50cf", "custom_id": "16-0", "response": {"status_code": 200, "request_id": "a14650a37984d2e0bc9bb6306ca9e189", "body": {"id": "chatcmpl-BpHV4yJ74jAcUYqRAAMOgfDqwds6J", "object": "chat.completion", "created": 1751561698, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH stamp_probs AS (\n    SELECT\n        p.oid,\n        p.class_name,\n        p.probability,\n        p.ranking,\n        p.classifier_name\n    FROM\n        probability p\n    WHERE\n        p.classifier_name = 'lc_classifier'\n        AND p.ranking = 1\n),\nmax_prob AS (\n    SELECT\n        sp.oid,\n        MAX(sp.probability) AS max_probability\n    FROM\n        stamp_probs sp\n    WHERE\n        sp.class_name = 'SN'\n    GROUP BY\n        sp.oid\n),\nobjects_filtered AS (\n    SELECT\n        o.*\n    FROM\n        object o\n        INNER JOIN max_prob mp ON o.oid = mp.oid\n    WHERE\n        mp.max_probability = (\n            SELECT MAX(p.probability)\n            FROM probability p\n            WHERE p.oid = o.oid\n              AND p.class_name = 'SN'\n              AND p.classifier_name = 'lc_classifier'\n              AND p.ranking = 1\n        )\n        AND o.firstmjd BETWEEN 60188.0 AND 60190.0\n),\nfirst_detection AS (\n    SELECT\n        d.oid,\n        MIN(d.mjd) AS first_mjd,\n        MIN(d.magpsf) AS first_mag,\n        MIN(d.candid) AS first_candid,\n        MIN(d.fid) AS first_fid\n    FROM\n        detection d\n    GROUP BY\n        d.oid\n),\nlast_non_detection AS (\n    SELECT\n        d.oid,\n        MAX(d.mjd) AS last_non_det_mjd,\n        d.magpsf AS last_non_det_mag,\n        d.candid AS last_non_det_candid,\n        d.fid AS last_non_det_fid\n    FROM\n        detection d\n    WHERE\n        d.isdiffpos = 0\n    GROUP BY\n        d.oid\n),\nrise_rates AS (\n    SELECT\n        f.oid,\n        f.first_mjd,\n        f.first_mag,\n        f.first_candid,\n        f.first_fid,\n        lnd.last_non_det_mjd,\n        lnd.last_non_det_mag,\n        lnd.last_non_det_candid,\n        lnd.last_non_det_fid,\n        -- Calculate magnitude difference\n        (f.first_mag - lnd.last_non_det_mag) AS mag_diff,\n        -- Calculate time difference\n        (f.first_mjd - lnd.last_non_det_mjd) AS time_diff,\n        -- Calculate initial rise rate\n        CASE WHEN (f.first_mjd - lnd.last_non_det_mjd) > 0 THEN\n            (f.first_mag - lnd.last_non_det_mag) / (f.first_mjd - lnd.last_non_det_mjd)\n        ELSE\n            NULL\n        END AS rise_rate\n    FROM\n        first_detection f\n        INNER JOIN last_non_detection lnd ON f.oid = lnd.oid\n),\nqualified_objects AS (\n    SELECT\n        r.oid,\n        r.mag_diff,\n        r.time_diff,\n        r.rise_rate,\n        r.first_candid,\n        r.first_fid,\n        r.last_non_det_candid,\n        r.last_non_det_fid\n    FROM\n        rise_rates r\n    WHERE\n        r.rise_rate >= 0.25\n),\nnon_detections AS (\n    SELECT\n        d.oid,\n        d.candid,\n        d.magpsf,\n        d.fid,\n        d.diffmaglim,\n        d.step_id_corr\n    FROM\n        detection d\n    WHERE\n        d.isdiffpos = 0\n        AND d.oid IN (SELECT oid FROM qualified_objects)\n),\nmagstat_info AS (\n    SELECT\n        m.oid,\n        m.fid AS magstat_fid,\n        m.magstat_fid\n    FROM\n        magstat m\n),\nfinal_results AS (\n    SELECT\n        o.oid,\n        mp.max_probability,\n        nd.candid,\n        nd.magpsf,\n        nd.fid,\n        ms.magstat_fid,\n        -- Calculate initial rise estimate\n        (o.g_r_max_corr) / NULLIF((o.firstmjd - (SELECT mjd FROM detection WHERE oid = o.oid AND isdiffpos = 0 ORDER BY mjd DESC LIMIT 1)), 0) AS initial_rise_estimate\n    FROM\n        objects_filtered o\n        INNER JOIN max_prob mp ON o.oid = mp.oid\n        INNER JOIN non_detections nd ON o.oid = nd.oid\n        LEFT JOIN magstat_info ms ON o.oid = ms.oid AND nd.fid = ms.fid\n    ORDER BY\n        o.oid\n    LIMIT 100\n)\nSELECT * FROM final_results;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3788, "completion_tokens": 991, "total_tokens": 4779, "prompt_tokens_details": {"cached_tokens": 2304, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b74cf22481908f61cd121692b78d", "custom_id": "16-1", "response": {"status_code": 200, "request_id": "b1b23e767aa934c03ca4dc9a515a598f", "body": {"id": "chatcmpl-BpHVOLqPDXJ1FboyjiWA0JpwdGJeG", "object": "chat.completion", "created": 1751561718, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH sn_prob AS (\n    SELECT p.oid, p.probability\n    FROM probability p\n    WHERE p.class_name = 'SN'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n),\nmax_sn_prob AS (\n    SELECT oid, MAX(probability) AS max_prob\n    FROM sn_prob\n    GROUP BY oid\n),\nfirst_detection AS (\n    SELECT d.oid, MIN(d.mjd) AS first_mjd, d.fid AS first_fid, d.magpsf AS mag_first, d.mjd AS mjd_first\n    FROM detection d\n    GROUP BY d.oid, d.fid, d.magpsf, d.mjd\n),\nlast_non_detection AS (\n    SELECT d1.oid, MAX(d1.mjd) AS last_mjd, d1.fid AS last_fid, d1.magpsf AS mag_last\n    FROM detection d1\n    WHERE d1.isdiffpos = 0\n    GROUP BY d1.oid, d1.fid, d1.magpsf\n),\nrise_rates AS (\n    SELECT\n        fd.oid,\n        fd.first_fid,\n        fd.mag_first,\n        fd.mjd_first,\n        lnd.last_mjd,\n        lnd.mag_last,\n        (fd.mag_first - lnd.mag_last) / (fd.mjd_first - lnd.last_mjd) AS initial_rise\n    FROM first_detection fd\n    INNER JOIN last_non_detection lnd\n        ON fd.oid = lnd.oid AND fd.first_fid = lnd.last_fid\n    WHERE (fd.mjd_first - lnd.last_mjd) > 0\n),\nqualified_objects AS (\n    SELECT r.oid\n    FROM rise_rates r\n    WHERE r.initial_rise >= 0.25\n),\nobjects_in_time_window AS (\n    SELECT o.*\n    FROM object o\n    WHERE o.firstmjd BETWEEN 60188.0 AND 60190.0\n),\nfinal_objects AS (\n    SELECT qo.oid, sp.max_prob, r.first_fid, r.mag_first, r.mjd_first, r.mag_last, r.last_mjd, r.initial_rise\n    FROM objects_in_time_window qo\n    INNER JOIN max_sn_prob sp ON qo.oid = sp.oid\n    INNER JOIN rise_rates r ON qo.oid = r.oid\n    WHERE qo.oid IN (SELECT oid FROM qualified_objects)\n)\nSELECT\n    fo.oid,\n    fo.max_prob AS probability,\n    fo.first_fid AS filter_id,\n    fo.mag_first AS magpsf,\n    fo.first_mjd AS mjd,\n    fo.mag_last,\n    fo.last_mjd,\n    fo.initial_rise\nFROM final_objects fo\nORDER BY fo.oid\nLIMIT 100;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3653, "completion_tokens": 590, "total_tokens": 4243, "prompt_tokens_details": {"cached_tokens": 2304, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b74d946881909bb40ba9a49d26c0", "custom_id": "19-0", "response": {"status_code": 200, "request_id": "1ac4f722a73ac5f15b73fd30eccaebda", "body": {"id": "chatcmpl-BpHVQKtvn9vz7AJilIXMxHivTwjj0", "object": "chat.completion", "created": 1751561720, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects that appeared between March 1st and April 1st, 2021\n-- with at most one detection, classified as 'SN' (asteroids) by the stamp classifier\n-- with probability > 0.7 and ranking = 1 (most likely classification)\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object o\nINNER JOIN probability p ON o.oid = p.oid\nWHERE \n    o.firstmjd BETWEEN 59274.0 AND 59305.0\n    AND o.ndet <= 1\n    AND p.class_name = 'SN'\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.probability > 0.7\n    AND p.ranking = 1;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3065, "completion_tokens": 190, "total_tokens": 3255, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b74e210c8190b3e02c71cb657ebd", "custom_id": "19-1", "response": {"status_code": 200, "request_id": "eb9a5d0c340f27f1ec57b89382859243", "body": {"id": "chatcmpl-BpHV8BMCgIWfexmL0rNdRR9Q7izTl", "object": "chat.completion", "created": 1751561702, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects that appeared between March 1st and April 1st, 2021\n-- with at most one detection, classified as 'asteroid' by the stamp classifier\n-- with probability > 0.7, returning specified columns\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object o\nJOIN probability p ON o.oid = p.oid\nWHERE \n    o.firstmjd BETWEEN 59274.0 AND 59305.0\n    AND o.ndet <= 1\n    AND p.class_name = 'asteroid'\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.probability > 0.7\n    AND p.ranking = 1; -- ensure the most probable classification\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3109, "completion_tokens": 189, "total_tokens": 3298, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b74eeadc81909d86e4191fbc4018", "custom_id": "14-0", "response": {"status_code": 200, "request_id": "3e9d507725093d70b94a55ab4580fd38", "body": {"id": "chatcmpl-BpHVPUjDyHKXjkC4pnDy5c6FIgikT", "object": "chat.completion", "created": 1751561719, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH target_oids AS (\n    SELECT unnest(ARRAY['ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni', 'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi', 'ZTF22aawasao', 'ZTF23aaxgvnt']) AS oid\n),\nprobability_filtered AS (\n    SELECT p.oid, p.probability\n    FROM probability p\n    WHERE p.classifier_name='lc_classifier' AND p.ranking=1 AND p.probability > 0.5\n),\nobject_filtered AS (\n    SELECT o.oid, o.ndet, o.meanra, o.meandec\n    FROM object o\n    INNER JOIN target_oids t ON o.oid = t.oid\n),\ndetection_filtered AS (\n    SELECT d.candid, d.oid, d.fid, d.mjd, d.magpsf, d.sigmapsf, d.has_stamp\n    FROM detection d\n    INNER JOIN target_oids t ON d.oid = t.oid\n),\nprob_obj AS (\n    SELECT o.oid, p.probability\n    FROM object_filtered o\n    INNER JOIN probability_filtered p ON o.oid = p.oid\n),\nstar_galaxy_dist AS (\n    SELECT x.oid, x.dist, x.class_catalog\n    FROM xmatch x\n    INNER JOIN target_oids t ON x.oid = t.oid\n),\nfinal_objects AS (\n    SELECT o.oid, p.probability, sg.dist, sg.class_catalog\n    FROM object_filtered o\n    INNER JOIN prob_obj p ON o.oid = p.oid\n    LEFT JOIN star_galaxy_dist sg ON o.oid = sg.oid\n    WHERE (sg.class_catalog < 0.5 OR sg.dist < 1)\n)\nSELECT DISTINCT\n    o.oid,\n    d.candid,\n    d.fid,\n    d.mjd,\n    d.magpsf,\n    d.sigmapsf,\n    d.has_stamp,\n    p.probability,\n    sg.class_catalog,\n    sg.dist\nFROM final_objects fo\nINNER JOIN detection_filtered d ON fo.oid = d.oid\nINNER JOIN probability_filtered p ON fo.oid = p.oid\nLEFT JOIN star_galaxy_dist sg ON fo.oid = sg.oid\nORDER BY o.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3594, "completion_tokens": 531, "total_tokens": 4125, "prompt_tokens_details": {"cached_tokens": 2304, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b74f80f88190bce38d9e56f8ff40", "custom_id": "14-1", "response": {"status_code": 200, "request_id": "9139cffcf91f845a2df29d2e6d6cb2e7", "body": {"id": "chatcmpl-BpHVHXmWVvML64yQTi0BOYcTpZc2W", "object": "chat.completion", "created": 1751561711, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH target_oids AS (\n    SELECT unnest(ARRAY['ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni', 'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi', 'ZTF22aawasao', 'ZTF23aaxgvnt']) AS oid\n),\nlatest_detection AS (\n    SELECT DISTINCT ON (d.oid) d.oid, d.candid, d.fid, d.mjd, d.magpsf, d.sigmapsf, d.has_stamp\n    FROM detection d\n    JOIN target_oids t ON d.oid = t.oid\n    ORDER BY d.oid, d.mjd DESC\n),\nprob AS (\n    SELECT p.oid, p.probability AS drb\n    FROM probability p\n    WHERE p.classifier_name='lc_classifier' AND p.ranking=1\n),\nxmatch_ps AS (\n    SELECT x.oid, x.dist\n    FROM xmatch x\n    WHERE x.oid IN (SELECT oid FROM target_oids)\n      AND x.class_catalog='ps' -- assuming class_catalog indicates Pan-STARRS\n),\nxmatch_sg AS (\n    SELECT x.oid, x.class_score\n    FROM xmatch x\n    WHERE x.oid IN (SELECT oid FROM target_oids)\n      AND x.class_catalog='star_galaxy' -- assuming class_catalog indicates star/galaxy score\n)\nSELECT DISTINCT\n    t.oid,\n    t.candid,\n    t.fid,\n    t.mjd,\n    t.magpsf,\n    t.sigmapsf,\n    t.has_stamp,\n    p.drb,\n    sg.class_score AS star_galaxy_score,\n    pm.dist AS panstarrs_dist\nFROM latest_detection t\nJOIN prob p ON t.oid = p.oid\nLEFT JOIN xmatch_ps pm ON t.oid = pm.oid\nLEFT JOIN xmatch_sg sg ON t.oid = sg.oid\nWHERE p.drb > 0.5\n  AND (\n    sg.class_score < 0.5\n    OR pm.dist < 1\n  )\nORDER BY t.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3531, "completion_tokens": 488, "total_tokens": 4019, "prompt_tokens_details": {"cached_tokens": 2176, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b7501b288190915db123ce2366fa", "custom_id": "22-0", "response": {"status_code": 200, "request_id": "baa716cddc1f08529dadd197e53057e8", "body": {"id": "chatcmpl-BpHV1Tj83f4qesg0etfAJNkbOhuKr", "object": "chat.completion", "created": 1751561695, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select all object data for objects detected within the specified date range\nSELECT o.*\nFROM object o\n-- Join with probability table to filter by classifier and ranking\nINNER JOIN probability p ON o.oid = p.oid\nWHERE\n  -- Filter for objects detected during the date range\n  o.firstmjd <= 58270.0 AND\n  o.lastmjd >= 58239.0 AND\n  -- Filter for the light curve classifier with top probability ranking\n  p.classifier_name = 'lc_classifier' AND\n  p.ranking = 1;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2958, "completion_tokens": 122, "total_tokens": 3080, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b750b9008190af12b070cb532eb4", "custom_id": "22-1", "response": {"status_code": 200, "request_id": "1e624d3ad394c639478de49afb9a087e", "body": {"id": "chatcmpl-BpHV62xkhZoRAM2COkCblIQtyWniR", "object": "chat.completion", "created": 1751561700, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects detected between June 1st and July 1st, 2018, classified by the light curve classifier with ranking 1\nSELECT o.*\nFROM object o\nINNER JOIN probability p ON o.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n  AND (o.firstmjd BETWEEN 58239.0 AND 58270.0 OR o.lastmjd BETWEEN 58239.0 AND 58270.0);\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3047, "completion_tokens": 110, "total_tokens": 3157, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b7516c088190a36475243db4ad62", "custom_id": "12-0", "response": {"status_code": 200, "request_id": "0dcc17aedf560127a2801e5d97eb0c43", "body": {"id": "chatcmpl-BpHVNa0ElggLpsMcdknBc15tOWLzx", "object": "chat.completion", "created": 1751561717, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT o.oid, o.meanra, o.meandec\nFROM object o\nINNER JOIN probability p ON o.oid = p.oid\nWHERE o.firstmjd >= 59988.0\n  AND o.firstmjd <= 60197.0\n  AND p.class_name = 'SN'\n  AND p.classifier_name = 'stamp_classifier'\n  AND p.ranking = 1\n  AND q3c_poly_query(o.meanra, o.meandec, '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon);\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3174, "completion_tokens": 134, "total_tokens": 3308, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b751f01c8190885dc2da2eca529c", "custom_id": "12-1", "response": {"status_code": 200, "request_id": "d435df64ad24b9673293a358be4520ae", "body": {"id": "chatcmpl-BpHVAsH6PcxfeawWrDFaDsBej6ks1", "object": "chat.completion", "created": 1751561704, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT o.oid, o.meanra, o.meandec\nFROM object o\nJOIN probability p ON o.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n  AND p.class_name = 'SN'\n  AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n  AND q3c_poly_query(o.meanra, o.meandec, '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon);\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3023, "completion_tokens": 126, "total_tokens": 3149, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b7527f848190818ac34dd22db530", "custom_id": "57-0", "response": {"status_code": 200, "request_id": "63a137b64711f3c6cbaa3e2ea6fcfc57", "body": {"id": "chatcmpl-BpHVFQiuFtlDs2SrdUajOFK0jWYxX", "object": "chat.completion", "created": 1751561709, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH ref_objects AS (\n    -- Define reference object id_1 with its coordinates and search radius in degrees\n    SELECT 'id_1' AS ref_id, 354.67 AS ra, 15.954 AS dec, 0.008333333 AS radius\n    UNION ALL\n    -- Define reference object id_2 with its coordinates and search radius in degrees\n    SELECT 'id_2' AS ref_id, 20.7993 AS ra, 1.00331 AS dec, 0.005555556 AS radius\n),\nmatched_objects AS (\n    SELECT\n        ro.ref_id,\n        ro.ra AS ref_ra,\n        ro.dec AS ref_dec,\n        ro.radius AS search_radius,\n        o.oid,\n        o.ndet,\n        o.meandec,\n        o.meanra,\n        o.firstmjd,\n        -- Find the maximum detection date for each object\n        MAX(d.mjd) AS max_mjd\n    FROM\n        ref_objects ro\n    JOIN\n        object o ON (\n            -- Spatial join: objects within the specified radius of reference object\n            q3c_join(o.meanra, o.meandec, ro.ra, ro.dec, ro.radius)\n        )\n    LEFT JOIN\n        detection d ON o.oid = d.oid\n    GROUP BY\n        ro.ref_id, ro.ra, ro.dec, ro.radius, o.oid, o.ndet, o.meandec, o.meanra, o.firstmjd\n)\nSELECT\n    ref_id,\n    ref_ra,\n    ref_dec,\n    search_radius,\n    oid AS \"ZTF identifier\",\n    ndet AS \"number of detections\",\n    meanra AS \"mean RA\",\n    meandec AS \"mean Dec\",\n    firstmjd AS \"first detection date\"\nFROM\n    matched_objects\nORDER BY\n    max_mjd DESC;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3171, "completion_tokens": 390, "total_tokens": 3561, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b7530f288190afee02592f3296d8", "custom_id": "57-1", "response": {"status_code": 200, "request_id": "78212e731a984564c1c179d4718f28e5", "body": {"id": "chatcmpl-BpHVFGiHah9xKMDMrk1S7i5FzdgW9", "object": "chat.completion", "created": 1751561709, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH ref_objects AS (\n    -- Define the reference objects with their coordinates and search radii in degrees\n    SELECT\n        'id_1' AS identifier,\n        354.67 AS ra,\n        15.954 AS dec,\n        0.0083333 AS radius_deg -- 30 arcsec in degrees\n    UNION ALL\n    SELECT\n        'id_2' AS identifier,\n        20.7993 AS ra,\n        1.00331 AS dec,\n        0.0055556 AS radius_deg -- 20 arcsec in degrees\n)\nSELECT\n    ro.identifier AS input_object_id,\n    ro.ra AS input_object_ra,\n    ro.dec AS input_object_dec,\n    ro.radius_deg AS search_radius_deg,\n    o.oid AS ztf_object_id,\n    COUNT(d.candid) AS ndet,\n    AVG(d.ra) AS mean_ra,\n    AVG(d.dec) AS mean_dec,\n    MIN(d.mjd) AS first_detection_mjd\nFROM\n    ref_objects ro\nJOIN\n    object o ON (\n        -- Check if object is within the radius of either reference object\n        q3c_radial_query(o.meanra, o.meandec, ro.ra, ro.dec, ro.radius_deg)\n    )\nLEFT JOIN\n    detection d ON o.oid = d.oid\nGROUP BY\n    ro.identifier, ro.ra, ro.dec, ro.radius_deg, o.oid\nORDER BY\n    first_detection_mjd DESC;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3253, "completion_tokens": 311, "total_tokens": 3564, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b7539dd88190b6a032f223179998", "custom_id": "43-1", "response": {"status_code": 200, "request_id": "9f2dfb4170ce5f4387e70d65c2a4322b", "body": {"id": "chatcmpl-BpHV4jJKsTyilw07Hvu99KoO4o8Yf", "object": "chat.completion", "created": 1751561698, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT \n    object.oid AS ztf_identifier,\n    dataquality.candid AS candidate_identifier,\n    dataquality.xpos,\n    dataquality.ypos,\n    dataquality.ssnrms\nFROM \n    object\nINNER JOIN \n    dataquality ON object.oid = dataquality.oid\nWHERE \n    object.oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\n    AND dataquality.fid = 2; -- filter for r-band epochs\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2912, "completion_tokens": 106, "total_tokens": 3018, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b754569c81908624d9dd7d23a3e7", "custom_id": "103-0", "response": {"status_code": 200, "request_id": "f32377366c46e5ccd031ab52c2a25341", "body": {"id": "chatcmpl-BpHV4E4qal0Yv1Ol3NFehhLrpdEBq", "object": "chat.completion", "created": 1751561698, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select all columns from object, probability, and ps1_ztf tables\nSELECT o.*, p.*, pzt.*\nFROM object o\n-- Join with probability table to get classification probabilities\nINNER JOIN probability p ON o.oid = p.oid\n-- Join with ps1_ztf table to get nearest PS1 source information\nINNER JOIN ps1_ztf pzt ON o.oid = pzt.oid\n-- Filter for most likely class (ranking=1), classifier 'lc_classifier', and probability > 0.7\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n  AND p.probability > 0.7\n  -- Filter for objects with nearest PS1 source distance greater than 5 arcsec\n  AND pzt.distpsnr1 > 5\n  -- Filter for classes other than supernova classes\n  AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n-- Order by the nearest PS1 source distance\nORDER BY pzt.distpsnr1\n-- Limit to at most 200 objects\nLIMIT 200;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3172, "completion_tokens": 246, "total_tokens": 3418, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b75569c48190bf2c8098bf8acd6b", "custom_id": "103-1", "response": {"status_code": 200, "request_id": "ba80a36d5ad37d7d71e03e1beba7ad91", "body": {"id": "chatcmpl-BpHVGZ44acjhE1aD8q9g7ozOSFl30", "object": "chat.completion", "created": 1751561710, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select all columns from object, probability, and ps1_ztf tables\nSELECT o.*, p.*, pz.*\nFROM object o\n-- Join with probability table to get classification probabilities\nINNER JOIN probability p ON o.oid = p.oid\n-- Join with ps1_ztf table to get PS1 source proximity data\nINNER JOIN ps1_ztf pz ON o.oid = pz.oid\nWHERE\n    -- Filter for objects with nearest PS1 source more than 5 arcsec away\n    pz.distpsnr1 > 5\n    -- Filter for objects where the highest probability among non-supernova classes exceeds 0.7\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND p.probability > 0.7\n    -- Ensure the probability corresponds to the most likely class (ranking=1) and classifier is 'lc_classifier'\n    AND p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\nORDER BY pz.distpsnr1 ASC\nLIMIT 200;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2962, "completion_tokens": 237, "total_tokens": 3199, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b755e8488190bdf52e2a9852a2d2", "custom_id": "99-0", "response": {"status_code": 200, "request_id": "ce429ec8af957a8b25631d883465435a", "body": {"id": "chatcmpl-BpHV63WhcC1M0LkKnLxakfO9g6p58", "object": "chat.completion", "created": 1751561700, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with first detection after mjd 60310, classified as 'asteroid' with probability 1 and ranking 1\nWITH selected_objects AS (\n    SELECT o.oid\n    FROM object o\n    INNER JOIN probability p ON o.oid = p.oid\n    INNER JOIN stamp_classifier sc ON o.oid = sc.oid\n    WHERE o.firstmjd > 60310\n      AND p.class_name = 'asteroid'\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.probability = 1\n      AND p.ranking = 1\n    ORDER BY o.firstmjd\n    LIMIT 10\n)\n-- Retrieve all columns from forced_photometry for the selected objects\nSELECT fp.*\nFROM forced_photometry fp\nWHERE fp.oid IN (SELECT oid FROM selected_objects);\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2978, "completion_tokens": 178, "total_tokens": 3156, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b7566b7c8190b850720b7414acf0", "custom_id": "99-1", "response": {"status_code": 200, "request_id": "37927952558136ebd8c21a713dd28875", "body": {"id": "chatcmpl-BpHV6MnxOoCKe2Y3vzwQabi4CnbE9", "object": "chat.completion", "created": 1751561700, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH filtered_objects AS (\n    SELECT o.oid\n    FROM object o\n    INNER JOIN probability p ON o.oid = p.oid\n    WHERE o.firstmjd > 60310\n      AND p.ranking = 1\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.class_name = 'asteroid'\n      AND p.probability = 1\n    ORDER BY o.firstmjd\n    LIMIT 10\n)\nSELECT fp.*\nFROM forced_photometry fp\nWHERE fp.oid IN (SELECT oid FROM filtered_objects);\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3057, "completion_tokens": 121, "total_tokens": 3178, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b756fdfc81909edc6fe80a601208", "custom_id": "63-0", "response": {"status_code": 200, "request_id": "4d37493ad768bdc1cf896d3fba7d5a72", "body": {"id": "chatcmpl-BpHVNPZNJ48zWrJUvC9ZkzfFjYOoq", "object": "chat.completion", "created": 1751561717, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT * \nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND ranking IN (1, 2)\n  AND classifier_name = 'lc_classifier'\nORDER BY ranking;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3043, "completion_tokens": 53, "total_tokens": 3096, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b75798408190875064121ce2e3c8", "custom_id": "92-0", "response": {"status_code": 200, "request_id": "d541f8a78e6e59f3184d93d28675d70b", "body": {"id": "chatcmpl-BpHV9XKTcENKrihwFv78NloV6qvFu", "object": "chat.completion", "created": 1751561703, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with at least 10 detections in g band, no dubious corrections, and most probable classification\nWITH filtered_objects AS (\n    SELECT o.oid\n    FROM object o\n    INNER JOIN detection d ON o.oid = d.oid\n    WHERE d.fid = 1 -- g band\n      AND o.ndet >= 10\n      AND o.corrected = TRUE\n    GROUP BY o.oid\n)\nSELECT \n    fo.oid AS \"ZTF identifier\",\n    p.classifier_version,\n    p.class_name,\n    p.probability\nFROM filtered_objects fo\nINNER JOIN probability p ON fo.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\nORDER BY fo.oid\nLIMIT 500;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3164, "completion_tokens": 170, "total_tokens": 3334, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b75845cc81909237d9e6101d590a", "custom_id": "92-1", "response": {"status_code": 200, "request_id": "7b79cba6acfa0c1620a5c31ec0e63252", "body": {"id": "chatcmpl-BpHV9aV8YcBShsJfJZKs0lMXagN6u", "object": "chat.completion", "created": 1751561703, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with at least 10 g-band detections and no dubious corrections\nWITH g_band_detections AS (\n    SELECT\n        d.oid,\n        COUNT(*) AS g_detections_count\n    FROM detection d\n    WHERE d.fid = 1 -- g band\n      AND d.corrected = TRUE\n      AND d.dubious = FALSE\n    GROUP BY d.oid\n    HAVING COUNT(*) >= 10\n)\n-- Join with probability table to get classification info for objects meeting criteria\nSELECT\n    o.oid AS \"ZTF identifier\",\n    p.classifier_version,\n    p.class_name,\n    p.probability\nFROM g_band_detections g\nJOIN object o ON o.oid = g.oid\nJOIN probability p ON p.oid = o.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\nORDER BY o.oid\nLIMIT 500;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3100, "completion_tokens": 202, "total_tokens": 3302, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b758d5f081909cb4693e9359ae99", "custom_id": "102-0", "response": {"status_code": 200, "request_id": "204a3e8055a50f3dc521c686174f6095", "body": {"id": "chatcmpl-BpHVPhs30Rb8qrGW9k3w97GEIRH5D", "object": "chat.completion", "created": 1751561719, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select all columns from magstat for objects with specified conditions\nSELECT magstat.*\nFROM magstat\nINNER JOIN (\n    -- Subquery to find objects with AGN probability > 0.6 and top ranking\n    SELECT p.oid\n    FROM probability p\n    INNER JOIN object o ON p.oid = o.oid\n    WHERE p.class_name = 'AGN'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.probability > 0.6\n      AND p.ranking = 1\n) AS filtered_objects ON magstat.oid = filtered_objects.oid\nINNER JOIN object o ON magstat.oid = o.oid\nWHERE magstat.magmean_corr BETWEEN 12 AND 13\nLIMIT 50;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3054, "completion_tokens": 160, "total_tokens": 3214, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b75967388190aabe1babb8ad13ed", "custom_id": "102-1", "response": {"status_code": 200, "request_id": "5b46aa70cb51096adad4e776bce929a2", "body": {"id": "chatcmpl-BpHVMe2a2iD81onL2VmSH0VvuEvRp", "object": "chat.completion", "created": 1751561716, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select all columns from magstat for objects classified as AGN with high probability and WISE W1 magnitude between 12 and 13\nSELECT magstat.*\nFROM object\nINNER JOIN probability ON probability.oid = object.oid\nINNER JOIN magstat ON magstat.oid = object.oid\nWHERE probability.class_name = 'AGN'\n  AND probability.classifier_name = 'lc_classifier'\n  AND probability.ranking = 1\n  AND probability.probability > 0.6\n  AND magstat.fid = -- WISE W1 band identifier, replace with actual fid value if known, e.g., 4\n  AND magstat.magmean BETWEEN 12 AND 13\nLIMIT 50;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3128, "completion_tokens": 152, "total_tokens": 3280, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b759e6b88190b58e6a1360596996", "custom_id": "69-0", "response": {"status_code": 200, "request_id": "3f7e0fd02a6a9588ead456c00d61babe", "body": {"id": "chatcmpl-BpHWzFvQCNDk2JYWBKuezfb6YtLIP", "object": "chat.completion", "created": 1751561817, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH target_objects AS (\n    -- Select the objects with specified ZTF identifiers and their mean coordinates\n    SELECT o.oid, o.meanra, o.meandec\n    FROM object o\n    WHERE o.oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n),\nnearest_sources AS (\n    -- For each target object, find the nearest source in ps1_ztf within 1 degree\n    SELECT\n        tobj.oid AS target_oid,\n        p.oid AS source_oid,\n        p.sgscore1,\n        q3c_dist(tobj.meanra, tobj.meandec, p.ra, p.dec) AS dist\n    FROM target_objects tobj\n    JOIN ps1_ztf p ON q3c_dist(tobj.meanra, tobj.meandec, p.ra, p.dec) < 1.0\n    -- For each target object, select the source with the minimum distance\n    WHERE NOT EXISTS (\n        SELECT 1 FROM ps1_ztf p2\n        WHERE q3c_dist(tobj.meanra, tobj.meandec, p2.ra, p2.dec) < q3c_dist(tobj.meanra, tobj.meandec, p.ra, p.dec)\n        AND p2.oid = p.oid\n    )\n)\n-- Retrieve all ps1_ztf rows where the source is the nearest source with sgscore1 < 0.2\nSELECT pz.*\nFROM ps1_ztf pz\nJOIN nearest_sources ns ON pz.oid = ns.source_oid\nWHERE ns.sgscore1 < 0.2;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3045, "completion_tokens": 355, "total_tokens": 3400, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b75a89588190a5eb379ace976ecb", "custom_id": "69-1", "response": {"status_code": 200, "request_id": "7ec3bcc7733901100503cc1327a0252a", "body": {"id": "chatcmpl-BpHVmOML1zWjFU9g1VoQz89hCqPEf", "object": "chat.completion", "created": 1751561742, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH target_objects AS (\n    -- List of specified ZTF identifiers\n    SELECT oid, meanra, meandec\n    FROM object\n    WHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n),\nnearest_sources AS (\n    SELECT\n        t.oid,\n        p.oid AS source_oid,\n        p.sgscore1,\n        q3c_dist(t.meanra, t.meandec, p.ra, p.dec) AS distance\n    FROM target_objects t\n    JOIN ps1_ztf p ON true\n    WHERE p.oid IN (SELECT oid FROM ps1_ztf)\n    -- Find the nearest source for each target object\n), min_dist AS (\n    SELECT DISTINCT ON (oid) oid, source_oid, sgscore1\n    FROM (\n        SELECT\n            ns.oid,\n            ns.source_oid,\n            ns.sgscore1,\n            ns.distance,\n            ROW_NUMBER() OVER (PARTITION BY ns.oid ORDER BY ns.distance) AS rn\n        FROM nearest_sources ns\n    ) sub\n    WHERE rn = 1\n)\n-- Select all rows from ps1_ztf where the source is the nearest source with sgscore1 < 0.2\nSELECT p.*\nFROM ps1_ztf p\nJOIN min_dist md ON p.oid = md.source_oid\nWHERE md.sgscore1 < 0.2;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3033, "completion_tokens": 304, "total_tokens": 3337, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b75b1b408190b4fc351a8fee9c7a", "custom_id": "104-0", "response": {"status_code": 200, "request_id": "ecd5446f3f1332e765a37b9008cf7fad", "body": {"id": "chatcmpl-BpHVYPC09kr1civXEgvDPVIdJQbrG", "object": "chat.completion", "created": 1751561728, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select up to 30 ZTF objects with high probability of being an asteroid according to the stamp classifier\nSELECT \n    o.oid, -- ZTF object identifier\n    r.candid, -- candidate identifier\n    ss.ssdistnr, -- distance from nearest Solar System object\n    r.magnr, -- MPC archive magnitude\n    ss.ssnamenr, -- name of the nearest Solar System object\n    d.fid, -- filter identifier\n    d.fwhm, -- FWHM from SExtractor (assuming 'fwhm' exists in detection table; if not, replace with correct column)\n    ps.nmtchps, -- number of PS1 calibrators used\n    d.pid -- exposure time\nFROM \n    probability p\nINNER JOIN \n    object o ON p.oid = o.oid\nINNER JOIN \n    ss_ztf ss ON o.oid = ss.oid\nINNER JOIN \n    reference r ON o.oid = r.oid AND r.candid = p.oid -- assuming 'candid' matches 'p.oid' or adjust if needed\nINNER JOIN \n    detection d ON o.oid = d.oid\nLEFT JOIN \n    ps1_ztf ps ON o.oid = ps.oid\nWHERE \n    p.class_name = 'asteroid'\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.classifier_version = 'stamp_classifier_1.0.4'\n    AND p.ranking = 1\n    AND p.probability > 0.9\nORDER BY \n    p.probability DESC\nLIMIT 30;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3430, "completion_tokens": 341, "total_tokens": 3771, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b75ba4d88190939efe8a5c399c48", "custom_id": "104-1", "response": {"status_code": 200, "request_id": "4a7e67e868a480101dbf08c0d0ed4b83", "body": {"id": "chatcmpl-BpHV9S4ybUq5ZXPMzp43uduqQ8e7A", "object": "chat.completion", "created": 1751561703, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select up to 30 ZTF objects with high probability (>0.9) of being an asteroid according to the stamp_classifier_1.0.4\nSELECT \n    o.oid, -- ZTF object identifier\n    r.candid, -- candidate ID\n    ss.ssdistnr, -- distance to nearest Solar System object\n    ss.magnr, -- MPC archive magnitude\n    ss.ssnamenr, -- name of the nearest Solar System object\n    d.fid, -- filter identifier\n    d.fwhm, -- FWHM from SExtractor (assumed stored in detection table)\n    p.nmtchps, -- number of PS1 calibrators used\n    d.exptime -- exposure time\nFROM object o\nINNER JOIN probability p ON o.oid = p.oid\nINNER JOIN reference r ON o.oid = r.oid AND r.candid = r.candid\nINNER JOIN ss_ztf ss ON o.oid = ss.oid\nINNER JOIN detection d ON r.candid = d.candid\nLEFT JOIN ps1_ztf pz ON o.oid = pz.oid\nWHERE \n    p.ranking = 1\n    AND p.class_name = 'asteroid'\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.probability > 0.9\nORDER BY p.probability DESC\nLIMIT 30;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3366, "completion_tokens": 296, "total_tokens": 3662, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b75c226c8190bdcce499083fb662", "custom_id": "107-0", "response": {"status_code": 200, "request_id": "e6359d7a221139344de12a1b1edeb116", "body": {"id": "chatcmpl-BpHVA6RBKhUtDnnn0EybKUu46aboe", "object": "chat.completion", "created": 1751561704, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT \n    o.oid, \n    o.ndet, \n    o.firstmjd, \n    o.lastmjd, \n    p.probability, \n    xm.candid, \n    xm.dist, \n    xm.catid, \n    d.mjd, \n    d.fid\nFROM object o\nINNER JOIN probability p ON o.oid = p.oid\nINNER JOIN xmatch xm ON o.oid = xm.oid\nINNER JOIN detection d ON o.oid = d.oid\nWHERE \n    o.ndet > 500\n    AND p.ranking = 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.classifier_version = 'stamp_classifier_1.0.4'\n    AND p.probability > 0.5\n    AND xm.dist < 2\nORDER BY o.firstmjd\nLIMIT 10;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3161, "completion_tokens": 189, "total_tokens": 3350, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b75ca9e08190b134a2c73557a428", "custom_id": "107-1", "response": {"status_code": 200, "request_id": "05384baa51f5c223a2db8db57400ec27", "body": {"id": "chatcmpl-BpHWGCsMbffmKStubEzG60UoEpxZL", "object": "chat.completion", "created": 1751561772, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select at most 10 ZTF objects meeting specified conditions\nSELECT\n    o.oid AS ztf_identifier,\n    o.ndet AS number_of_detections,\n    o.firstmjd AS first_detection_date,\n    o.lastmjd AS last_detection_date,\n    p.probability AS asteroid_probability,\n    d.candid AS candidate_identifier,\n    x.dist AS distance_to_mpc,\n    x.catid AS mpc_name,\n    d.mjd AS detection_date,\n    d.fid AS filter_identifier\nFROM\n    object o\n-- Join with probability table for classification info\nINNER JOIN\n    probability p ON o.oid = p.oid\n-- Join with xmatch table for MPC proximity\nINNER JOIN\n    xmatch x ON o.oid = x.oid\n-- Join with detection table for detection details\nINNER JOIN\n    detection d ON o.oid = d.oid\nWHERE\n    -- Filter objects with more than 500 detections\n    o.ndet > 500\n    -- Classification: asteroid with high probability and top ranking\n    AND p.class_name = 'asteroid'\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.classifier_version = 'stamp_classifier_1.0.4'\n    AND p.probability > 0.5\n    AND p.ranking = 1\n    -- Proximity to Solar System objects within 2 arcsec\n    AND x.catid = 'MPC'\n    AND x.dist < 2\nORDER BY\n    o.firstmjd\nLIMIT 10;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3264, "completion_tokens": 328, "total_tokens": 3592, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b75d38d481909084c56a028fc835", "custom_id": "84-0", "response": {"status_code": 200, "request_id": "712858221910c2734192dd67857dd3a2", "body": {"id": "chatcmpl-BpHVGPvP51LTmIH0lRIPWunvTev5b", "object": "chat.completion", "created": 1751561710, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Retrieve the object information for 'ZTF19aascdol'\nWITH ztf_object AS (\n    SELECT oid, meanra, meandec\n    FROM object\n    WHERE oid = 'ZTF19aascdol'\n)\n-- Find all ALLWISE sources within 1 arcsecond (~0.0167 degrees) of the ZTF object\nSELECT\n    'ZTF19aascdol' AS ztf_oid,\n    allwise.oid_catalog,\n    q3c_dist(ztf_object.meanra, ztf_object.meandec, allwise.ra, allwise.decnr) AS distance_deg,\n    allwise.w1mpro,\n    allwise.w2mpro,\n    allwise.w3mpro,\n    allwise.w4mpro\nFROM\n    allwise,\n    ztf_object\nWHERE\n    q3c_join(ztf_object.meanra, ztf_object.meandec, allwise.ra, allwise.decnr, 0.0167)\nORDER BY\n    distance_deg ASC;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3041, "completion_tokens": 220, "total_tokens": 3261, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b75e372c8190bce068a81de55f33", "custom_id": "84-1", "response": {"status_code": 200, "request_id": "7663f0e2c328380e6f2e4bf40191d7f1", "body": {"id": "chatcmpl-BpHVT2EpTT7eK4Oc4jkZMe3RwN4qx", "object": "chat.completion", "created": 1751561723, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Retrieve all ALLWISE counterparts for the specified ZTF object 'ZTF19aascdol'\nSELECT\n    'ZTF19aascdol' AS ztf_object_id,\n    aw.oid_catalog,\n    q3c_dist(ztf.meanra, ztf.meandec, aw.ra, aw.decnr) AS distance_deg,\n    aw.w1mpro,\n    aw.w2mpro,\n    aw.w3mpro,\n    aw.w4mpro\nFROM\n    object ztf\nJOIN\n    allwise aw ON q3c_radial_query(ztf.meanra, ztf.meandec, 0.0005) -- radius ~1.8 arcsec (~0.0005 degrees)\nWHERE\n    ztf.oid = 'ZTF19aascdol'\n  AND\n    q3c_join(ztf.meanra, ztf.meandec, aw.ra, aw.decnr, 0.0005); -- match within ~1.8 arcsec\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3008, "completion_tokens": 217, "total_tokens": 3225, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b75ee4d08190b87ab96812392dbc", "custom_id": "96-0", "response": {"status_code": 200, "request_id": "49386ea2ae9da31222bc4faafbcda6a8", "body": {"id": "chatcmpl-BpHWGVY4EGw4VOndL53KVdjHCnkQr", "object": "chat.completion", "created": 1751561772, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define the radius in degrees (2 arcseconds)\nWITH sso_coords AS (\n    SELECT\n        ss.oid,\n        ss.ssnamenr,\n        obj.meanra,\n        obj.meandec\n    FROM ss_ztf ss\n    JOIN object obj ON ss.oid = obj.oid\n    WHERE ss.ssnamenr IN ('2003FP134', '2009UK56')\n),\ndetections_near_sso AS (\n    SELECT\n        d.*\n    FROM detection d\n    JOIN sso_coords s ON\n        q3c_radial_query(d.ra, d.dec, s.meanra, s.meandec, 2.0/3600.0)\n)\nSELECT\n    ss.*,\n    d.mjd AS detection_date,\n    d.fid AS filter_id,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf AS diff_magnitude,\n    d.sigmapsf AS mag_error\nFROM detections_near_sso d\nJOIN ss_ztf ss ON d.oid = ss.oid\nORDER BY ss.ssnamenr, d.mjd;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3179, "completion_tokens": 240, "total_tokens": 3419, "prompt_tokens_details": {"cached_tokens": 1664, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b75f8d9c8190a1d46e05f1f013c8", "custom_id": "96-1", "response": {"status_code": 200, "request_id": "6575c839ebf96420ded997926f677322", "body": {"id": "chatcmpl-BpHVC8Nx3mmdSnVljtawqNfkGfUXF", "object": "chat.completion", "created": 1751561706, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Retrieve all detections for objects within 2 arcseconds of specified SSOs '2003FP134' and '2009UK56'\nWITH sso_coords AS (\n    -- Get the coordinates of the SSOs from ss_ztf for the given ssnamenr\n    SELECT\n        ss.oid,\n        ss.ssnamenr,\n        ss.ranr AS ra,\n        ss.decnr AS dec\n    FROM\n        ss_ztf ss\n    WHERE\n        ss.ssnamenr IN ('2003FP134', '2009UK56')\n)\nSELECT\n    ss.*,\n    d.mjd,\n    d.fid,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf\nFROM\n    sso_coords sso\nJOIN\n    detection d\n    ON q3c_dist(\n        q3c_point(d.ra, d.dec),\n        q3c_point(sso.ra, sso.dec)\n    ) <= 2.0 / 3600.0 -- 2 arcseconds in degrees\nORDER BY\n    sso.ssnamenr,\n    d.mjd;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3145, "completion_tokens": 249, "total_tokens": 3394, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b76022b481908042fa92b19f7f26", "custom_id": "47-0", "response": {"status_code": 200, "request_id": "3c048b1c303725306854695fc73e3b87", "body": {"id": "chatcmpl-BpHVDuX5KyDiWRz96SGX04sQ7ItBl", "object": "chat.completion", "created": 1751561707, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select detections for specified objects with probability > 0.7 and classifier 'lc_classifier'\nSELECT \n    o.oid AS \"ZTF\", \n    d.candid AS \"candidate\", \n    d.fid AS \"filter\", \n    d.mjd AS \"detection_date\", \n    d.isdiffpos, \n    d.ra, \n    d.dec, \n    d.magpsf AS \"diff_magnitude\", \n    d.sigmapsf AS \"uncertainty\", \n    p.probability AS \"real_bogus_score\"\nFROM \n    object o\nINNER JOIN \n    detection d ON o.oid = d.oid\nINNER JOIN \n    probability p ON o.oid = p.oid\nWHERE \n    o.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n    AND p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.probability > 0.7\nORDER BY \n    o.oid, \n    d.mjd;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3044, "completion_tokens": 225, "total_tokens": 3269, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b760b61c8190bf1abc47723fafaa", "custom_id": "47-1", "response": {"status_code": 200, "request_id": "76633a97d3fdff105e697bca63e688ba", "body": {"id": "chatcmpl-BpHVN32co1BhaFVv9ZdXIDJH9R4ol", "object": "chat.completion", "created": 1751561717, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT \n    o.oid AS ZTF,\n    d.candid AS candidate,\n    d.fid AS filter,\n    d.mjd AS detection_date,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf AS difference_magnitude,\n    d.sigmapsf AS magnitude_uncertainty,\n    d.drb AS real_bogus_score\nFROM \n    object o\nINNER JOIN \n    detection d ON o.oid = d.oid\nWHERE \n    o.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n    AND d.drb > 0.7\nORDER BY \n    o.oid, d.mjd;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2920, "completion_tokens": 150, "total_tokens": 3070, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b7614eb48190add4cae8dcb9bb0d", "custom_id": "94-0", "response": {"status_code": 200, "request_id": "bfd0be649a89017b10db6abf98b29a6d", "body": {"id": "chatcmpl-BpHVEFLbKZVee0Nku2KAFgLzK7BSF", "object": "chat.completion", "created": 1751561708, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Retrieve all columns from 'object' and 'reference' tables for objects with reference change\nSELECT *\nFROM object\nINNER JOIN reference ON object.oid = reference.oid\nWHERE object.reference_change = TRUE\nLIMIT 50;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2855, "completion_tokens": 51, "total_tokens": 2906, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b761f1e08190871146c891b7d1a7", "custom_id": "90-0", "response": {"status_code": 200, "request_id": "0b63fed025f3acaa834ed06ba9139ff5", "body": {"id": "chatcmpl-BpHVERGt0171cj4FbTtqbqBbcWOlz", "object": "chat.completion", "created": 1751561708, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with a multiband period less than 5 days from the feature table\nWITH multiband_objects AS (\n    SELECT DISTINCT f.oid\n    FROM feature f\n    WHERE f.name = 'Multiband_period'\n      AND f.value < 5\n)\n\n-- Join with probability table to get classification probabilities for the specified classifier and rankings\nSELECT p.*\nFROM probability p\nINNER JOIN multiband_objects mo ON p.oid = mo.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.classifier_version = 'lc_classifier_1.2.1-P'\n  AND p.ranking IN (1, 2)\nLIMIT 100;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3028, "completion_tokens": 145, "total_tokens": 3173, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b76278bc81909db940b3847193c5", "custom_id": "90-1", "response": {"status_code": 200, "request_id": "823d77f59ce848df23c5bb74cf0bd423", "body": {"id": "chatcmpl-BpHVMHA36tOSsnImYM4FqM7EYfn9A", "object": "chat.completion", "created": 1751561716, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select probability data for objects with multiband period < 5 days\nSELECT p.*\nFROM probability p\nINNER JOIN object o ON p.oid = o.oid\nINNER JOIN feature f ON o.oid = f.oid\nINNER JOIN feature_version fv ON f.version = fv.version AND f.step_id_feature = fv.step_id_feature\nWHERE f.name = 'Multiband_period'\n  AND f.value < 5\n  AND fv.version = 'P'\n  AND fv.step_id_feature = 'lc_classifier_1.2.1-P'\n  AND p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nLIMIT 100;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3074, "completion_tokens": 146, "total_tokens": 3220, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b7631adc81909c2e1d2695757ec5", "custom_id": "100-0", "response": {"status_code": 200, "request_id": "fc1d75be36e5b96c5f0e37c65c71071b", "body": {"id": "chatcmpl-BpHVFVrNfZECVhmBDo08Qz7toVhHW", "object": "chat.completion", "created": 1751561709, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Retrieve object oid for the specified ZTF object\nWITH target_object AS (\n    SELECT oid\n    FROM object\n    WHERE oid = 'ZTF24aamtvxb'\n),\n-- Select detection data for the object\ndetections AS (\n    SELECT\n        candid AS ztf_id,\n        mjd AS epoch_date,\n        fid AS filter_id,\n        isdiffpos,\n        magpsf AS mag_diff,\n        sigmapsf AS mag_diff_err,\n        NULL AS maglim,\n        NULL AS mag_forced,\n        NULL AS e_mag_forced,\n        'detection' AS table_name\n    FROM detection\n    WHERE oid = (SELECT oid FROM target_object)\n),\n-- Select non-detection data for the object\nnon_detections AS (\n    SELECT\n        NULL AS ztf_id,\n        mjd AS epoch_date,\n        fid AS filter_id,\n        NULL AS isdiffpos,\n        NULL AS mag_diff,\n        NULL AS mag_diff_err,\n        diffmaglim AS maglim,\n        NULL AS mag_forced,\n        NULL AS e_mag_forced,\n        'non_detection' AS table_name\n    FROM non_detection\n    WHERE oid = (SELECT oid FROM target_object)\n),\n-- Select forced photometry data for the object\nforced_photometry AS (\n    SELECT\n        pid AS ztf_id,\n        mjd AS epoch_date,\n        fid AS filter_id,\n        NULL AS isdiffpos,\n        NULL AS mag_diff,\n        NULL AS mag_diff_err,\n        NULL AS maglim,\n        mag AS mag_forced,\n        e_mag AS e_mag_forced,\n        'forced_photometry' AS table_name\n    FROM forced_photometry\n    WHERE oid = (SELECT oid FROM target_object)\n)\n-- Combine all data into one result set\nSELECT * FROM detections\nUNION ALL\nSELECT * FROM non_detections\nUNION ALL\nSELECT * FROM forced_photometry\nORDER BY epoch_date;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3188, "completion_tokens": 408, "total_tokens": 3596, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b763ceb88190b192370ac1cb735f", "custom_id": "100-1", "response": {"status_code": 200, "request_id": "6645469c040c12b9ae05a8d5fb035bf0", "body": {"id": "chatcmpl-BpHVg9cEX3CJEOyjTEuDOV9UXcoiU", "object": "chat.completion", "created": 1751561736, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Retrieve detection data for the specified object\nSELECT \n    candid AS ztf_identifier,\n    mjd AS epoch_date,\n    fid AS filter_id,\n    isdiffpos,\n    magpsf AS diff_magnitude,\n    sigmapsf AS diff_magnitude_uncertainty,\n    NULL AS magpsf_lim,\n    NULL AS forced_diff_magnitude,\n    NULL AS forced_magnitude_uncertainty,\n    'detection' AS table_name\nFROM detection\nWHERE oid = (SELECT oid FROM object WHERE oid = 'ZTF24aamtvxb')\n\nUNION ALL\n\n-- Retrieve non-detection data for the specified object\nSELECT \n    NULL AS ztf_identifier,\n    mjd AS epoch_date,\n    fid AS filter_id,\n    NULL AS isdiffpos,\n    NULL AS diff_magnitude,\n    NULL AS diff_magnitude_uncertainty,\n    diffmaglim AS magpsf_lim,\n    NULL AS forced_diff_magnitude,\n    NULL AS forced_magnitude_uncertainty,\n    'non_detection' AS table_name\nFROM non_detection\nWHERE oid = (SELECT oid FROM object WHERE oid = 'ZTF24aamtvxb')\n\nUNION ALL\n\n-- Retrieve forced photometry data for the specified object\nSELECT \n    pid AS ztf_identifier,\n    mjd AS epoch_date,\n    fid AS filter_id,\n    NULL AS isdiffpos,\n    NULL AS diff_magnitude,\n    NULL AS diff_magnitude_uncertainty,\n    NULL AS magpsf_lim,\n    mag AS forced_diff_magnitude,\n    e_mag AS forced_magnitude_uncertainty,\n    'forced_photometry' AS table_name\nFROM forced_photometry\nWHERE oid = (SELECT oid FROM object WHERE oid = 'ZTF24aamtvxb')\n\n-- Order all results by epoch date\nORDER BY epoch_date ASC;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3308, "completion_tokens": 380, "total_tokens": 3688, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b76451e08190bba2c61d9ae59329", "custom_id": "106-0", "response": {"status_code": 200, "request_id": "0df3f52d2792b0e888e99e6d8536166c", "body": {"id": "chatcmpl-BpHVNTqmB6pr5YqxHHWIxjyJe9ykD", "object": "chat.completion", "created": 1751561717, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT \n    o.oid AS \"ZTF identifier\",\n    o.ndet AS \"number of detections\",\n    o.firstmjd AS \"first detection date\",\n    p_bogus.probability AS \"prob_stamp_bogus\",\n    p_transient.probability AS \"prob_lc_transient\"\nFROM object o\n-- Join with probability table for bogus classification\nINNER JOIN probability p_bogus ON o.oid = p_bogus.oid\n  AND p_bogus.classifier_name = 'stamp_classifier'\n  AND p_bogus.classifier_version = 'stamp_classifier_1.0.4'\n  AND p_bogus.class_name = 'bogus'\n  AND p_bogus.ranking = 1\n-- Join with probability table for transient classification\nINNER JOIN probability p_transient ON o.oid = p_transient.oid\n  AND p_transient.classifier_name = 'lc_classifier_top'\n  AND p_transient.class_name = 'Transient'\n  AND p_transient.ranking = 1\nWHERE \n    o.ndet > 10\n    AND p_bogus.probability > 0.7\n    AND p_transient.probability > 0.9\nORDER BY o.oid\nLIMIT 30;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3245, "completion_tokens": 271, "total_tokens": 3516, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b76501f48190bc26a2e52dbd20d6", "custom_id": "106-1", "response": {"status_code": 200, "request_id": "ad2bc6074f1f2ee39c34fb428ff0a1d9", "body": {"id": "chatcmpl-BpHVLcVzJpzKejjMt5SKcy4TI9NV9", "object": "chat.completion", "created": 1751561715, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT \n    o.oid AS \"ZTF identifier\",\n    o.ndet AS \"number of detections\",\n    o.firstmjd AS \"first detection date\",\n    p_bogus.probability AS \"prob_stamp_bogus\",\n    p_transient.probability AS \"prob_lc_transient\"\nFROM object o\n-- Join with probability for bogus classification from stamp_classifier_1.0.4\nINNER JOIN probability p_bogus ON o.oid = p_bogus.oid\n  AND p_bogus.classifier_name = 'stamp_classifier'\n  AND p_bogus.classifier_version = 'stamp_classifier_1.0.4'\n  AND p_bogus.class_name = 'bogus'\n  AND p_bogus.probability > 0.7\n-- Join with probability for transient classification from lc_classifier_top\nINNER JOIN probability p_transient ON o.oid = p_transient.oid\n  AND p_transient.classifier_name = 'lc_classifier_top'\n  AND p_transient.class_name = 'Transient'\n  AND p_transient.probability > 0.9\nWHERE o.ndet > 10\nORDER BY o.oid\nLIMIT 30;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3300, "completion_tokens": 257, "total_tokens": 3557, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b76686ec8190a2dc7648f2b1e1b4", "custom_id": "56-0", "response": {"status_code": 200, "request_id": "059b8670657abc432bc6130a04ebb198", "body": {"id": "chatcmpl-BpHVR1q3rWg6cAjO6453NIdqVXPQT", "object": "chat.completion", "created": 1751561721, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT \n    oid, \n    ndet, \n    meanra, \n    meandec, \n    firstmjd, \n    lastmjd, \n    g_r_mean - g_r_mean_corr AS diff_g_r, \n    g_r_max - g_r_max_corr AS diff_g_r_max\nFROM object\nWHERE \n    oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n    AND corrected = FALSE\nORDER BY firstmjd;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2944, "completion_tokens": 113, "total_tokens": 3057, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b7675de081909ee937f1ff5350f4", "custom_id": "58-0", "response": {"status_code": 200, "request_id": "6bb17e54ba4a65f96af3850cd72f2acb", "body": {"id": "chatcmpl-BpHVHqTonF5WvMWjPFlgG47xFNvbI", "object": "chat.completion", "created": 1751561711, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select all columns from the 'object' table for objects meeting the specified conditions\nSELECT o.*\nFROM object o\n-- Join with magstat to access magnitude statistics for g-band (fid=1) and r-band (fid=2)\nINNER JOIN magstat mg ON o.oid = mg.oid\nWHERE\n    -- Filter for g-band (fid=1)\n    (mg.fid = 1 AND mg.magmin_corr IS NOT NULL)\n    -- Join again for r-band (fid=2)\n    AND EXISTS (\n        SELECT 1 FROM magstat mg_r\n        WHERE mg_r.oid = o.oid AND mg_r.fid = 2 AND mg_r.magmin_corr IS NOT NULL\n    )\n    -- Ensure the object has at least 30 detections\n    AND o.ndet >= 30\n    -- Calculate the magnitude difference between g and r bands\n    AND (\n        -- Subquery to get magmin_corr for g-band\n        (SELECT magmin_corr FROM magstat WHERE oid = o.oid AND fid = 1) \n        - \n        (SELECT magmin_corr FROM magstat WHERE oid = o.oid AND fid = 2)\n    ) > 3.5\n    -- Check that the time span between last and first detection exceeds 20 days\n    AND (o.lastmjd - o.firstmjd) > 20\nLIMIT 20;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3100, "completion_tokens": 295, "total_tokens": 3395, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b767fc1881909163937677801898", "custom_id": "58-1", "response": {"status_code": 200, "request_id": "f7f1177d832438dee7269619d7bd6c21", "body": {"id": "chatcmpl-BpHVIGHw6MIRIoQHXDCF2QMJG5VXJ", "object": "chat.completion", "created": 1751561712, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT * FROM object\nWHERE ndet >= 30\n  AND (g_r_max_corr - g_r_mean_corr) > 3.5\n  AND (lastmjd - firstmjd) > 20\nLIMIT 20;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2897, "completion_tokens": 54, "total_tokens": 2951, "prompt_tokens_details": {"cached_tokens": 2048, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b76887bc81908ba602bc6f449184", "custom_id": "39-0", "response": {"status_code": 200, "request_id": "001386932920961d67164cfcb7e95b97", "body": {"id": "chatcmpl-BpHVYibtKcFuDsGsxzMAFoHYQEer3", "object": "chat.completion", "created": 1751561728, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Step 1: Filter objects with highest probability class 'CV/Nova' by stochastic classifier\nWITH classified_objects AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.classifier_name='lc_classifier_stochastic'\n      AND p.ranking=1\n      AND p.class_name='CV/Nova'\n),\n-- Step 2: Filter objects with at most 50 detections\ndetection_counts AS (\n    SELECT d.oid, COUNT(*) AS det_count\n    FROM detection d\n    GROUP BY d.oid\n),\nobjects_with_detection_limit AS (\n    SELECT c.oid\n    FROM classified_objects c\n    JOIN object o ON c.oid = o.oid\n    JOIN detection_counts dc ON c.oid = dc.oid\n    WHERE dc.det_count <= 50\n),\n-- Step 3: Select detections in 'r' filter (fid=2) for filtered objects\nfiltered_detections AS (\n    SELECT d.candid, d.oid, d.fid AS f_id, o.meanra, o.meandec, d.magpsf_corr AS mag, d.sigmapsf_corr AS mag_err\n    FROM detection d\n    JOIN objects_with_detection_limit o ON d.oid = o.oid\n    WHERE d.fid=2\n),\n-- Step 4: Calculate max rise (max mag - min mag) per object\nmag_stats AS (\n    SELECT\n        oid,\n        MAX(mag) AS max_mag,\n        MIN(mag) AS min_mag\n    FROM filtered_detections\n    GROUP BY oid\n),\nmax_rise AS (\n    SELECT\n        oid,\n        (max_mag - min_mag) AS max_rise\n    FROM mag_stats\n),\n-- Step 5: Find PSF-corrected magnitude in r-band (max mag per object)\nmax_mag_per_object AS (\n    SELECT DISTINCT ON (d.oid) d.oid, d.mag, d.candid\n    FROM filtered_detections d\n    ORDER BY d.oid, d.mag DESC\n)\n-- Final selection: object id, candidate id, filter id, coordinates, magnitude, mag error, max rise, PSF mag\nSELECT\n    o.oid,\n    d.candid,\n    d.f_id,\n    o.meanra,\n    o.meandec,\n    d.mag,\n    d.mag_err,\n    mr.max_rise,\n    m.max_mag AS psf_mag\nFROM objects_with_detection_limit o\nJOIN filtered_detections d ON o.oid = d.oid\nJOIN max_rise mr ON o.oid = mr.oid\nJOIN max_mag_per_object m ON o.oid = m.oid\nORDER BY o.oid\nLIMIT 1000;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3536, "completion_tokens": 569, "total_tokens": 4105, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_6866b76916a48190ab0cb700f846995e", "custom_id": "39-1", "response": {"status_code": 200, "request_id": "79b35bced9218d0aa757862994a349ce", "body": {"id": "chatcmpl-BpHVJEvACEsYRyZ3btC79hC9Q9lrS", "object": "chat.completion", "created": 1751561713, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH classified_objects AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.classifier_name='lc_classifier_stochastic'\n      AND p.class_name='CV/Nova'\n      AND p.ranking=1\n),\ndetection_counts AS (\n    SELECT d.oid, COUNT(*) AS ndet\n    FROM detection d\n    GROUP BY d.oid\n),\nfiltered_objects AS (\n    SELECT o.oid, o.firstmjd, o.lastmjd, o.meanra, o.meandec\n    FROM object o\n    INNER JOIN classified_objects c ON o.oid = c.oid\n    INNER JOIN detection_counts dc ON o.oid = dc.oid\n    WHERE dc.ndet <= 50\n),\nr_band_detections AS (\n    SELECT d.oid, d.candid, d.fid, d.ra, d.dec, d.magpsf_corr, d.sigmapsf_corr\n    FROM detection d\n    WHERE d.fid=2 -- r-band filter\n      AND d.oid IN (SELECT oid FROM filtered_objects)\n),\nmax_rise_per_object AS (\n    SELECT\n        oid,\n        MAX(magpsf_corr) - MIN(magpsf_corr) AS max_rise\n    FROM r_band_detections\n    GROUP BY oid\n)\nSELECT\n    fo.oid,\n    d.candid,\n    'f_id' AS f_id,\n    fo.meanra,\n    fo.meandec,\n    d.magpsf_corr AS mag,\n    d.sigmapsf_corr AS mag_err,\n    mr.max_rise\nFROM filtered_objects fo\nINNER JOIN r_band_detections d ON fo.oid = d.oid\nINNER JOIN max_rise_per_object mr ON fo.oid = mr.oid\nORDER BY fo.oid\nLIMIT 1000;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3526, "completion_tokens": 380, "total_tokens": 3906, "prompt_tokens_details": {"cached_tokens": 2176, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
