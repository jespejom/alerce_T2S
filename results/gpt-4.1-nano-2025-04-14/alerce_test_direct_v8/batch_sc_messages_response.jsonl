{"id": "batch_req_685086b2790c819093abfee0b780483c", "custom_id": "8-1", "response": {"status_code": 200, "request_id": "6b5cf65820e599196b1feced66da2876", "body": {"id": "chatcmpl-BjBHDTIREEe491zfqtzm4jpHFQg0o", "object": "chat.completion", "created": 1750107807, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects first classified as SN by the stamp classifier between August 17 and August 21\nWITH sn_objects AS (\n    SELECT o.oid\n    FROM object o\n    -- Filter objects based on first detection date within the specified range\n    WHERE o.firstmjd BETWEEN 60173.0 AND 60177.0\n    -- Ensure the object has either a high probability of being SN or at least two detections\n    AND (\n        -- Check for probability of SN > 0.5 from the stamp classifier\n        EXISTS (\n            SELECT 1\n            FROM probability p\n            WHERE p.oid = o.oid\n              AND p.class_name = 'SN'\n              AND p.classifier_name = 'stamp_classifier'\n              AND p.probability > 0.5\n              AND p.ranking = 1 -- Ensure the classification is the top-ranked class\n        )\n        OR o.ndet >= 2\n    )\n)\nSELECT o.*\nFROM object o\nWHERE o.oid IN (SELECT oid FROM sn_objects);\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1932, "completion_tokens": 219, "total_tokens": 2151, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_f12167b370"}}, "error": null}
{"id": "batch_req_685086b293908190bcd64a6fb73beee9", "custom_id": "37-0", "response": {"status_code": 200, "request_id": "383887c0b2177809ba799c17cf7d363d", "body": {"id": "chatcmpl-BjBGGqhDmVOeyvFY94AjJ5VzLSQnt", "object": "chat.completion", "created": 1750107748, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select the top 200 objects classified as SNIa by the lc_classifier, ordered by probability descending\nWITH top_snia AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.class_name = 'SNIa'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.classifier_version IS NOT NULL\n      -- Ensure the probability is for the most confident classification (ranking=1)\n      AND p.ranking = 1\n      -- Optional: add a minimum probability threshold to filter out low-confidence classifications\n      AND p.probability > 0.5\n    ORDER BY p.probability DESC\n    LIMIT 200\n)\n-- Retrieve all object details for the top SNIa objects\nSELECT o.*\nFROM object o\nWHERE o.oid IN (SELECT oid FROM top_snia)\n-- Order the final results by the probability of being SNIa in descending order\nORDER BY (\n    SELECT p.probability\n    FROM probability p\n    WHERE p.oid = o.oid\n      AND p.class_name = 'SNIa'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n    LIMIT 1\n) DESC;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1488, "completion_tokens": 257, "total_tokens": 1745, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086da89108190ac84a0ded920d9e1", "custom_id": "16-0", "response": {"status_code": 200, "request_id": "eae6d776b3c409280bd2530f81b3c725", "body": {"id": "chatcmpl-BjBGH4VRjjjD5xP9mEVEZt2kEv99G", "object": "chat.completion", "created": 1750107749, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with specific criteria: highest SN probability, first detection early September, and fast rise\nWITH stamp_max_sn AS (\n    SELECT\n        p.oid,\n        p.probability AS stamp_prob,\n        p.class_name,\n        p.ranking\n    FROM\n        probability p\n    WHERE\n        p.classifier_name = 'stamp_classifier'\n        AND p.ranking = 1\n        AND p.class_name = 'SN'\n),\nfirst_detections AS (\n    SELECT\n        o.oid,\n        o.firstmjd,\n        o.meanra,\n        o.meandec\n    FROM\n        object o\n    WHERE\n        o.firstmjd BETWEEN 60188.0 AND 60189.0\n),\nlight_curve_stats AS (\n    SELECT\n        m.oid,\n        m.fid AS magstat_fid,\n        m.magfirst,\n        m.maglast,\n        m.dmdt_first\n    FROM\n        magstat m\n),\ndetections AS (\n    SELECT\n        d.oid,\n        d.candid,\n        d.mjd,\n        d.ra,\n        d.dec,\n        d.magpsf,\n        d.isdiffpos\n    FROM\n        detection d\n),\n-- Calculate the initial rise rate for objects qualifying as fast risers\ninitial_rise AS (\n    SELECT\n        lc.oid,\n        lc.magfirst,\n        lc.maglast,\n        lc.dmdt_first,\n        -- Compute the rate of magnitude change over time between first detection and last detection\n        (lc.magfirst - lc.maglast) / NULLIF(\n            -- Find the mjd of the last non-detection before the first detection\n            (SELECT d2.mjd\n             FROM detection d2\n             WHERE d2.oid = lc.oid AND d2.isdiffpos = 0\n             AND d2.mjd < (SELECT MIN(d3.mjd) FROM detection d3 WHERE d3.oid = lc.oid AND d3.isdiffpos = 1)\n             ORDER BY d2.mjd DESC\n             LIMIT 1),\n            1\n        ) AS rise_rate\n    FROM\n        light_curve_stats lc\n    JOIN\n        first_detections fd ON lc.oid = fd.oid\n    WHERE\n        -- Ensure the first detection is within the first 2 days of September\n        fd.firstmjd BETWEEN 60188.0 AND 60190.0\n        -- Calculate the rate of magnitude change and check if it qualifies as a fast riser\n        AND (lc.magfirst - lc.maglast) / NULLIF(\n            (SELECT d2.mjd\n             FROM detection d2\n             WHERE d2.oid = lc.oid AND d2.isdiffpos = 0\n             AND d2.mjd < (SELECT MIN(d3.mjd) FROM detection d3 WHERE d3.oid = lc.oid AND d3.isdiffpos = 1)\n             ORDER BY d2.mjd DESC\n             LIMIT 1),\n            1\n        ) >= 0.25\n)\n-- Final selection combining all criteria\nSELECT\n    o.oid,\n    p.stamp_prob,\n    d.fid AS filter_id,\n    d.magpsf AS diffmag,\n    lc.magstat_fid,\n    ir.dmdt_first AS initial_rise_estimate\nFROM\n    object o\nJOIN\n    stamp_max_sn p ON o.oid = p.oid\nJOIN\n    first_detections fd ON o.oid = fd.oid\nJOIN\n    light_curve_stats lc ON o.oid = lc.oid\nJOIN\n    detections d ON o.oid = d.oid\nJOIN\n    initial_rise ir ON o.oid = ir.oid\nWHERE\n    -- Confirm the object has the highest SN probability\n    p.ranking = 1\n    AND p.class_name = 'SN'\n    -- First detection within the first 2 days of September\n    AND fd.firstmjd BETWEEN 60188.0 AND 60189.0\n    -- Fast riser condition based on initial rise rate\n    AND (ir.magfirst - ir.maglast) / NULLIF(\n        (SELECT d2.mjd\n         FROM detection d2\n         WHERE d2.oid = o.oid AND d2.isdiffpos = 0\n         AND d2.mjd < (SELECT MIN(d3.mjd) FROM detection d3 WHERE d3.oid = o.oid AND d3.isdiffpos = 1)\n         ORDER BY d2.mjd DESC\n         LIMIT 1),\n        1\n    ) >= 0.25\nORDER BY\n    o.oid\nLIMIT 100;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3854, "completion_tokens": 982, "total_tokens": 4836, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086daaa08819093ddfa84852f18ee", "custom_id": "16-1", "response": {"status_code": 200, "request_id": "9b910be0f2b313fd996f04b2811083b4", "body": {"id": "chatcmpl-BjBHE256WBUOthuWFxzpuU3yZ6k61", "object": "chat.completion", "created": 1750107808, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with highest stamp classifier probability for 'SN', first detection within first 2 days of September, and qualifying as fast risers\nWITH stamp_max_prob AS (\n    SELECT\n        p.oid,\n        p.probability AS stamp_probability,\n        p.class_name,\n        p.classifier_name,\n        p.ranking\n    FROM\n        probability p\n    WHERE\n        p.classifier_name = 'stamp_classifier'\n        AND p.ranking = 1\n        AND p.class_name = 'SN'\n        AND p.probability >= 0.5 -- Additional condition to ensure meaningful probability (adjust as needed)\n),\nfirst_detections AS (\n    SELECT\n        d.oid,\n        MIN(d.mjd) AS first_mjd\n    FROM\n        detection d\n    GROUP BY\n        d.oid\n),\ncandidate_objects AS (\n    SELECT\n        s.oid\n    FROM\n        stamp_max_prob s\n        JOIN first_detections f ON s.oid = f.oid\n    WHERE\n        f.first_mjd BETWEEN 60188.0 AND 60189.0 -- First 2 days of September (assuming MJD 60188 = Sept 1, 2023)\n),\nrise_estimates AS (\n    SELECT\n        d.oid,\n        d.fid AS magstat_fid,\n        d.magpsf AS mag_last,\n        d.mjd AS last_mjd,\n        ms.magfirst AS mag_first,\n        ms.firstmjd AS first_mjd,\n        -- Calculate the initial rise rate: (mag_first - mag_last) / (first_mjd - last_mjd)\n        CASE\n            WHEN (ms.firstmjd - d.mjd) != 0 THEN\n                (ms.magfirst - d.magpsf) / (ms.firstmjd - d.mjd)\n            ELSE\n                NULL\n        END AS initial_rise_rate\n    FROM\n        detection d\n        JOIN magstat ms ON d.oid = ms.oid AND d.fid = ms.fid\n    WHERE\n        d.oid IN (SELECT oid FROM candidate_objects)\n        AND d.mjd = (\n            SELECT MIN(m.mjd)\n            FROM detection m\n            WHERE m.oid = d.oid AND m.mjd >= ms.firstmjd\n        )\n),\nfast_risers AS (\n    SELECT\n        r.oid,\n        r.magstat_fid,\n        r.mag_last,\n        r.mag_first,\n        r.first_mjd,\n        r.last_mjd,\n        r.initial_rise_rate\n    FROM\n        rise_estimates r\n    WHERE\n        r.initial_rise_rate >= 0.25 -- Threshold for fast risers, adjust as needed\n)\nSELECT\n    c.oid,\n    s.stamp_probability,\n    d.fid AS magstat_fid,\n    d.magpsf AS magdiff,\n    d.mjd AS detection_mjd,\n    r.initial_rise_rate\nFROM\n    candidate_objects c\n    JOIN stamp_max_prob s ON c.oid = s.oid\n    JOIN detection d ON c.oid = d.oid\n    JOIN magstat ms ON c.oid = ms.oid AND d.fid = ms.fid\n    JOIN fast_risers r ON c.oid = r.oid AND d.fid = r.magstat_fid\nWHERE\n    d.mjd = (\n        SELECT MIN(m.mjd)\n        FROM detection m\n        WHERE m.oid = d.oid AND m.mjd >= ms.firstmjd\n    )\nORDER BY\n    c.oid\nLIMIT 100;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3613, "completion_tokens": 749, "total_tokens": 4362, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dac99881909fc85246199a1347", "custom_id": "19-0", "response": {"status_code": 200, "request_id": "9b2a9a8e099f9a74c684b291f3fda4fb", "body": {"id": "chatcmpl-BjBGGtsqH8KJUmC5iwG5hiYLyhAm2", "object": "chat.completion", "created": 1750107748, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define the date range for the observations\nWITH date_range AS (\n    SELECT 59274.0 AS start_mjd, 59305.0 AS end_mjd\n),\n-- Select objects that have detections within the date range\nobjects_in_date AS (\n    SELECT DISTINCT d.oid\n    FROM detection d\n    JOIN date_range dr ON d.mjd BETWEEN dr.start_mjd AND dr.end_mjd\n),\n-- Filter objects with at most one detection\nobjects_with_one_or_less_detections AS (\n    SELECT o.oid\n    FROM object o\n    WHERE o.ndet <= 1\n),\n-- Select objects that satisfy all previous conditions\ncandidate_objects AS (\n    SELECT o.oid, o.meanra, o.meandec, o.ndet, o.firstmjd\n    FROM object o\n    WHERE o.oid IN (SELECT oid FROM objects_in_date)\n      AND o.oid IN (SELECT oid FROM objects_with_one_or_less_detections)\n),\n-- Get classification probabilities for objects classified as 'asteroid' by 'stamp_classifier' with probability > 0.7\nclassification AS (\n    SELECT p.oid, p.class_name, p.probability\n    FROM probability p\n    WHERE p.classifier_name = 'stamp_classifier'\n      AND p.class_name = 'asteroid'\n      AND p.probability > 0.7\n      AND p.ranking = 1 -- Ensure the top-ranked classification\n),\n-- Join all conditions to get final result\nfinal_result AS (\n    SELECT c.oid, c.meanra, c.meandec, c.ndet, c.firstmjd, p.class_name, p.probability\n    FROM candidate_objects c\n    JOIN classification p ON c.oid = p.oid\n)\n-- Return the desired columns\nSELECT oid, meanra, meandec, ndet, firstmjd, class_name, probability\nFROM final_result;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2463, "completion_tokens": 402, "total_tokens": 2865, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086daeb0081909cb43e899ea81e26", "custom_id": "19-1", "response": {"status_code": 200, "request_id": "e16d2daedd606e7aa311e67a6bd072ca", "body": {"id": "chatcmpl-BjBGQ00pdpsi4MzY6hoRoFXpCtDe4", "object": "chat.completion", "created": 1750107758, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define the date range for observations between March 1st and April 1st, 2021\nWITH date_range AS (\n    SELECT 59274.0 AS start_mjd, 59305.0 AS end_mjd\n),\n-- Select objects that have detections within the specified date range\nobjects_in_date AS (\n    SELECT DISTINCT d.oid\n    FROM detection d\n    JOIN date_range dr ON d.mjd BETWEEN dr.start_mjd AND dr.end_mjd\n),\n-- Filter objects that have at most one detection in total\nobjects_with_one_or_none_detection AS (\n    SELECT o.oid\n    FROM object o\n    WHERE o.ndet <= 1\n)\n-- Select objects that satisfy all conditions:\n-- 1. Have detections in the date range\n-- 2. Have at most one detection overall\n-- 3. Are classified as 'asteroid' by the stamp classifier with probability > 0.7\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object o\nJOIN objects_in_date oid_in_date ON o.oid = oid_in_date.oid\nJOIN objects_with_one_or_none_detection oid_one ON o.oid = oid_one.oid\nJOIN probability p ON o.oid = p.oid\nWHERE p.class_name = 'asteroid'\n  AND p.classifier_name = 'stamp_classifier'\n  AND p.probability > 0.7\n  AND p.ranking = 1; -- ensure the class is the most probable\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2323, "completion_tokens": 343, "total_tokens": 2666, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086db145c8190881bea83be71a3ff", "custom_id": "14-0", "response": {"status_code": 200, "request_id": "1612e85aa564ff03394222b6c17683f2", "body": {"id": "chatcmpl-BjBGG8q3dgPU0aOIoBxUiqZl5z4Sz", "object": "chat.completion", "created": 1750107748, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select relevant information for specified oids with given conditions\nWITH selected_oids AS (\n    SELECT oid\n    FROM object\n    WHERE oid IN ('ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni', 'ZTF23aavsdtc', \n                  'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi', 'ZTF22aawasao', 'ZTF23aaxgvnt')\n)\nSELECT\n    d.oid,\n    d.candid,\n    d.rfid AS filter_id,\n    d.mjd,\n    d.magpsf AS magnitude,\n    d.sigmapsf AS magnitude_error,\n    d.has_stamp,\n    d.drb AS deep_learning_real_bogus_score,\n    -- Retrieve the star_galaxy score from the xmatch table where catid='panstarrs' and class_catalog='star_galaxy'\n    xm.class_catalog_score AS star_galaxy_score,\n    xm.dist AS distance_to_nearest_panstarrs\nFROM\n    detection d\nJOIN\n    selected_oids s ON d.oid = s.oid\nLEFT JOIN\n    -- Join with xmatch table filtered for panstarrs catalog\n    (\n        SELECT\n            oid,\n            class_catalog_score,\n            dist\n        FROM\n            xmatch\n        WHERE\n            catid = 'panstarrs'\n    ) xm ON d.oid = xm.oid\nWHERE\n    d.oid IN (SELECT oid FROM selected_oids)\n    AND d.drb > 0.5\n    AND (\n        -- Condition: star_galaxy score less than 0.5\n        (xm.class_catalog_score IS NOT NULL AND xm.class_catalog_score < 0.5)\n        OR\n        -- Condition: distance to nearest panstarrs source less than 1 arcsec\n        (xm.dist IS NOT NULL AND xm.dist < 1)\n    );\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2653, "completion_tokens": 432, "total_tokens": 3085, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086db343081909dba9ec1904ac120", "custom_id": "30-0", "response": {"status_code": 200, "request_id": "12461eabe7a6eba58e25e18e9ff40888", "body": {"id": "chatcmpl-BjBGFD1cFkYxmVWSdfkoNzhFiexqY", "object": "chat.completion", "created": 1750107747, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select the object ID, class name, and probability for each object based on the top-ranked class from the light curve classifier\nSELECT\n    o.oid,\n    p.class_name,\n    p.probability\nFROM\n    object o\n-- Join with a subquery that retrieves the highest-ranked class (ranking=1) for each object from the probability table\nJOIN (\n    SELECT\n        oid,\n        class_name,\n        probability\n    FROM\n        probability\n    WHERE\n        classifier_name = 'lc_classifier'\n        AND ranking = 1  -- Ensure only the top-ranked class per object is selected\n        AND probability IS NOT NULL  -- Exclude entries with null probability\n        AND class_name IS NOT NULL  -- Exclude entries with null class name\n) p ON o.oid = p.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1401, "completion_tokens": 173, "total_tokens": 1574, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086db5ebc8190b66341d2f8b559b8", "custom_id": "30-1", "response": {"status_code": 200, "request_id": "3c00c9edbfbc5e826f7e2292ece23214", "body": {"id": "chatcmpl-BjBGG9sxsIwzjhx1y7xcPi4SL6ULO", "object": "chat.completion", "created": 1750107748, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select the object ID, class name, and probability for the most probable class from the light curve classifier\nSELECT\n    o.oid,\n    p.class_name,\n    p.probability\nFROM\n    object o\nJOIN\n    (\n        -- Subquery to get the top-ranked class and its probability for each object\n        SELECT\n            p1.oid,\n            p1.class_name,\n            p1.probability\n        FROM\n            probability p1\n        WHERE\n            p1.classifier_name = 'lc_classifier'\n            AND p1.classifier_version = (\n                -- Get the latest version of the classifier\n                SELECT MAX(p2.classifier_version)\n                FROM probability p2\n                WHERE p2.classifier_name = 'lc_classifier'\n            )\n        -- Use window function to rank classes per object based on ranking\n        -- and select only the top-ranked class\n        QUALIFY ROW_NUMBER() OVER (PARTITION BY p1.oid ORDER BY p1.ranking) = 1\n    ) p ON o.oid = p.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1382, "completion_tokens": 225, "total_tokens": 1607, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086db795c81908e3084877feed22d", "custom_id": "12-0", "response": {"status_code": 200, "request_id": "2812634ced594262e1eaf123be34bd37", "body": {"id": "chatcmpl-BjBGKJrbR8XeqzbKTQ7O3SM7WpZTC", "object": "chat.completion", "created": 1750107752, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define the polygon with the given coordinates as a polygon type\nWITH polygon_coords AS (\n    SELECT ST_SetSRID(ST_MakePolygon(ST_MakeLine(ARRAY[\n        ST_MakePoint(-20, -20),\n        ST_MakePoint(-2, -20),\n        ST_MakePoint(20, 1),\n        ST_MakePoint(10, 10),\n        ST_MakePoint(-20, -20) -- close the polygon\n    ])), 4326) AS poly\n),\n-- Select objects with first detection between Feb 13 and Sep 10\nobjects_in_time AS (\n    SELECT oid, meanra, meandec\n    FROM object\n    WHERE firstmjd BETWEEN 59988.0 AND 60197.0\n),\n-- Filter objects that are classified as SNe (Supernovae)\nsne_objects AS (\n    SELECT o.oid, o.meanra, o.meandec\n    FROM objects_in_time o\n    WHERE EXISTS (\n        SELECT 1\n        FROM probability p\n        WHERE p.oid = o.oid\n          AND p.class_name LIKE 'SNI%'\n          AND p.classifier_name IN ('lc_classifier', 'lc_classifier_top', 'lc_classifier_transient', 'lc_classifier_stochastic', 'lc_classifier_periodic', 'stamp_classifier')\n          AND p.ranking = 1\n    )\n),\n-- Perform spatial filtering using Q3C to check if objects are within the polygon\nfiltered_objects AS (\n    SELECT s.oid, s.meanra, s.meandec\n    FROM sne_objects s, polygon_coords pc\n    WHERE q3c_poly_query(s.meanra, s.meandec, ST_AsText(pc.poly))\n)\n-- Final selection of object IDs, mean RA, and Dec\nSELECT oid, meanra, meandec\nFROM filtered_objects;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1792, "completion_tokens": 385, "total_tokens": 2177, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086db98a4819082eb7841c935be1f", "custom_id": "12-1", "response": {"status_code": 200, "request_id": "0a920d4d2dffcd8a86247c7c3a1dc999", "body": {"id": "chatcmpl-BjBGTlMdBzFLSY3y8JAww3FUGPh9K", "object": "chat.completion", "created": 1750107761, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define the polygon with the given coordinates as a polygon type\nWITH polygon_coords AS (\n    SELECT ST_SetSRID(ST_MakePolygon(ST_MakeLine(ARRAY[\n        ST_MakePoint(-20, -20),\n        ST_MakePoint(-2, -20),\n        ST_MakePoint(20, 1),\n        ST_MakePoint(10, 10),\n        ST_MakePoint(-20, -20) -- close the polygon\n    ])), 4326) AS poly\n),\n-- Select objects with first detection between Feb 13 (MJD 59988.0) and Sep 10 (MJD 60197.0)\nobjects_in_time AS (\n    SELECT oid, meanra, meandec\n    FROM object\n    WHERE firstmjd BETWEEN 59988.0 AND 60197.0\n),\n-- Filter objects within the polygon using q3c_poly_query\nobjects_in_polygon AS (\n    SELECT o.oid, o.meanra, o.meandec\n    FROM objects_in_time o\n    WHERE q3c_poly_query(o.meanra, o.meandec, (SELECT poly FROM polygon_coords))\n),\n-- Retrieve the highest-ranked probability for class 'SNe' (Supernovae)\nsupernova_prob AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.class_name ILIKE 'SNe%'\n      AND p.ranking = 1\n)\n-- Final selection of objects classified as SNe within time and polygon constraints\nSELECT o.oid, o.meanra, o.meandec\nFROM objects_in_polygon o\nJOIN supernova_prob sp ON o.oid = sp.oid\nWHERE sp.oid IS NOT NULL;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1798, "completion_tokens": 356, "total_tokens": 2154, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dbba288190956a9b6b3a994de3", "custom_id": "57-0", "response": {"status_code": 200, "request_id": "38b6a34a3d809924d0f72c92b9de3bc6", "body": {"id": "chatcmpl-BjBGV6GDLr7WakLOmwVsMKIYt3I5O", "object": "chat.completion", "created": 1750107763, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Corrected and optimized query with nested subqueries to improve performance and ensure proper filtering\nWITH input_objects AS (\n    -- Define the input objects with their coordinates and search radii in degrees\n    SELECT\n        'id_1' AS identifier,\n        354.67 AS ra,\n        15.954 AS dec,\n        30.0 / 3600 AS radius_deg -- 30 arcsec converted to degrees\n    UNION ALL\n    SELECT\n        'id_2' AS identifier,\n        20.7993 AS ra,\n        1.00331 AS dec,\n        20.0 / 3600 AS radius_deg -- 20 arcsec converted to degrees\n),\ncandidate_objects AS (\n    -- Select objects that have at least one detection within the specified radius\n    SELECT\n        io.identifier AS input_id,\n        io.ra AS input_ra,\n        io.dec AS input_dec,\n        io.radius_deg,\n        o.oid AS ztf_oid\n    FROM\n        input_objects io\n    -- Cross join with object table to evaluate all possible pairs\n    JOIN\n        object o ON TRUE\n    -- Join with detection table to find detections within the radius\n    JOIN\n        detection d ON o.oid = d.oid\n    -- Use q3c_join to filter detections within the specified radius\n    WHERE\n        q3c_join(d.ra, d.dec, io.ra, io.dec, io.radius_deg)\n),\ndetection_stats AS (\n    -- Aggregate detection data for each matched object\n    SELECT\n        ci.input_id,\n        ci.input_ra,\n        ci.input_dec,\n        ci.radius_deg,\n        ci.ztf_oid,\n        COUNT(d.candid) AS detection_count,\n        AVG(d.ra) AS mean_ra,\n        AVG(d.dec) AS mean_dec,\n        MIN(d.mjd) AS first_detection_mjd\n    FROM\n        candidate_objects ci\n    JOIN\n        detection d ON ci.ztf_oid = d.oid\n    GROUP BY\n        ci.input_id,\n        ci.input_ra,\n        ci.input_dec,\n        ci.radius_deg,\n        ci.ztf_oid\n)\n-- Final selection with ordering by the most recent detection date\nSELECT\n    input_id,\n    input_ra,\n    input_dec,\n    radius_deg,\n    ztf_oid,\n    detection_count,\n    mean_ra,\n    mean_dec,\n    first_detection_mjd\nFROM\n    detection_stats\nORDER BY\n    first_detection_mjd DESC;\n", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2378, "completion_tokens": 512, "total_tokens": 2890, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dbdce8819095e59c3d3abd54d9", "custom_id": "57-1", "response": {"status_code": 200, "request_id": "6b8e1cf0e7f58f54496eafcb01329d54", "body": {"id": "chatcmpl-BjBGGFwIbU978mZ2UzBxdMl1xzR2n", "object": "chat.completion", "created": 1750107748, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define input objects with their coordinates and search radii in degrees\nWITH input_objects AS (\n    SELECT\n        'id_1' AS identifier,\n        354.67 AS ra,\n        15.954 AS dec,\n        30.0 / 3600 AS radius_deg -- 30 arcsec converted to degrees\n    UNION ALL\n    SELECT\n        'id_2' AS identifier,\n        20.7993 AS ra,\n        1.00331 AS dec,\n        20.0 / 3600 AS radius_deg -- 20 arcsec converted to degrees\n),\n-- Select objects within the specified radius of each input object\ncandidate_objects AS (\n    SELECT\n        io.identifier AS input_id,\n        io.ra AS input_ra,\n        io.dec AS input_dec,\n        io.radius_deg,\n        o.oid AS ztf_oid\n    FROM\n        input_objects io\n    JOIN\n        object o ON TRUE\n    WHERE\n        -- Use q3c_join for efficient spatial query within the specified radius\n        q3c_join(o.ra, o.dec, io.ra, io.dec, io.radius_deg)\n),\n-- For each candidate object, find detections and compute statistics\nmatched_objects AS (\n    SELECT\n        co.input_id,\n        co.input_ra,\n        co.input_dec,\n        co.radius_deg,\n        co.ztf_oid,\n        COUNT(d.candid) AS detection_count,\n        AVG(d.ra) AS mean_ra,\n        AVG(d.dec) AS mean_dec,\n        MIN(d.mjd) AS first_detection_mjd\n    FROM\n        candidate_objects co\n    JOIN\n        detection d ON co.ztf_oid = d.oid\n    GROUP BY\n        co.input_id,\n        co.input_ra,\n        co.input_dec,\n        co.radius_deg,\n        co.ztf_oid\n)\n-- Final selection with ordering by last detection date\nSELECT\n    io.identifier AS input_object_id,\n    io.ra AS input_object_ra,\n    io.dec AS input_object_dec,\n    io.radius_deg AS search_radius_deg,\n    mo.ztf_oid AS ztf_object_id,\n    mo.detection_count,\n    mo.mean_ra,\n    mo.mean_dec,\n    mo.first_detection_mjd\nFROM\n    input_objects io\nLEFT JOIN\n    matched_objects mo ON io.identifier = mo.input_id\nORDER BY\n    mo.first_detection_mjd DESC NULLS LAST;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2474, "completion_tokens": 500, "total_tokens": 2974, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dbfa508190a97007567f4b2b62", "custom_id": "89-0", "response": {"status_code": 200, "request_id": "7fcdf1ecac17b9da7cd02a5c289c5571", "body": {"id": "chatcmpl-BjBGHULoUpRflQGyII4ykcJTt4vu4", "object": "chat.completion", "created": 1750107749, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select up to 50 objects with probability > 0.7 of being supernovae (SN) in the stamp_classifier\nWITH sn_objects AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.class_name = 'SN'\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.probability > 0.7\n      AND p.ranking = 1 -- Ensure selecting the most probable classification\n    ORDER BY p.probability DESC\n    LIMIT 50\n)\n-- Retrieve all data quality details for these objects\nSELECT dq.*\nFROM dataquality dq\nWHERE dq.oid IN (SELECT oid FROM sn_objects);\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2134, "completion_tokens": 140, "total_tokens": 2274, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dc1f9081908aa1d25492cc702f", "custom_id": "89-1", "response": {"status_code": 200, "request_id": "548b9b2d81f6e3373669653045651b1f", "body": {"id": "chatcmpl-BjBGHPIODPy1E82xZXbym85cZoFsz", "object": "chat.completion", "created": 1750107749, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select up to 50 objects with probability > 0.7 of being supernovae ('SN') in the stamp_classifier\nWITH sn_objects AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.class_name = 'SN'\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.probability > 0.7\n      AND p.ranking = 1 -- ensure selecting the most probable classification\n    ORDER BY p.ranking -- prioritize highest probability ranking\n    LIMIT 50\n)\nSELECT dq.*\nFROM dataquality dq\nWHERE dq.oid IN (SELECT oid FROM sn_objects);\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2146, "completion_tokens": 133, "total_tokens": 2279, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dc391c81909ea4fce9ca62bf85", "custom_id": "63-0", "response": {"status_code": 200, "request_id": "abc52557d6f2ab6a76fe546d0e996f8c", "body": {"id": "chatcmpl-BjBGH7tO871FRL7EZ6oWS3NEYxtiv", "object": "chat.completion", "created": 1750107749, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Retrieve all rows from 'probability' for specified objects with ranking 1 or 2, sorted by ranking\n-- Also include related data from 'light_curve_classifier' (assuming such a table exists; if not, this part should be omitted)\n-- The original query had ambiguous 'oid' references; explicitly specify table aliases to resolve ambiguity\n\nWITH target_objects AS (\n    SELECT oid\n    FROM object\n    WHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n)\nSELECT p.*\nFROM probability p\nJOIN object o ON p.oid = o.oid\nWHERE o.oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND p.ranking IN (1, 2)\nORDER BY p.ranking;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1354, "completion_tokens": 168, "total_tokens": 1522, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dc56c48190909fb813dffa1afa", "custom_id": "92-0", "response": {"status_code": 200, "request_id": "a4da81ea01b12177724c7a8e942f33cd", "body": {"id": "chatcmpl-BjBGHXkt7Wul10TmGUreVLiz2pSwf", "object": "chat.completion", "created": 1750107749, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Optimized query with nested subqueries to improve performance and include additional probability conditions\nWITH g_band_detections AS (\n    SELECT\n        d.oid,\n        COUNT(*) AS n_detections\n    FROM\n        detection d\n    WHERE\n        d.fid = 1 -- g band\n        AND d.dubious = FALSE -- exclude dubious detections\n    GROUP BY\n        d.oid\n),\nqualified_objects AS (\n    SELECT\n        o.oid,\n        o.reference_change,\n        gbd.n_detections\n    FROM\n        object o\n    JOIN\n        g_band_detections gbd ON o.oid = gbd.oid\n    WHERE\n        gbd.n_detections >= 10 -- at least 10 detections in g band\n        AND o.reference_change = FALSE -- no dubious corrections\n)\nSELECT\n    q.oid AS \"ZTF identifier\",\n    p.classifier_version,\n    p.class_name,\n    p.probability\nFROM\n    qualified_objects q\nJOIN\n    probability p ON q.oid = p.oid\nWHERE\n    p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1 -- top-ranked probability\n    AND p.probability > 0.5 -- additional condition to filter for meaningful probabilities\n    AND p.class_name IN ('SN', 'AGN', 'Variable') -- example classes, adjust as needed\nORDER BY\n    q.oid\nLIMIT 500;", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 4556, "completion_tokens": 307, "total_tokens": 4863, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dc72088190b6b79fe787b6142b", "custom_id": "92-1", "response": {"status_code": 200, "request_id": "7305bdf89f84b604330d72028d3c72eb", "body": {"id": "chatcmpl-BjBGHnXvCyKQi5wGN5KaiTqN8mcVO", "object": "chat.completion", "created": 1750107749, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects with at least 10 detections in the g band (fid=1) and no dubious corrections\nWITH g_band_detections AS (\n    SELECT\n        d.oid,\n        COUNT(*) AS detection_count\n    FROM detection d\n    WHERE d.fid = 1\n      AND d.dubious = FALSE\n    GROUP BY d.oid\n),\nfiltered_objects AS (\n    SELECT\n        o.oid\n    FROM object o\n    JOIN g_band_detections g ON o.oid = g.oid\n    WHERE g.detection_count >= 10\n)\n-- Retrieve the object info along with the top-ranked probability for the light curve classifier\nSELECT\n    fo.oid AS ztf_id,\n    p.classifier_version,\n    p.class_name,\n    p.probability\nFROM filtered_objects fo\nJOIN probability p ON fo.oid = p.oid\n-- Filter for the specific classifier and top ranking\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n-- Order by object ID and limit to 500 results\nORDER BY fo.oid\nLIMIT 500;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2098, "completion_tokens": 240, "total_tokens": 2338, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dc94a48190954ce98909631bdb", "custom_id": "104-0", "response": {"status_code": 200, "request_id": "5279687db678a71c2d2fe81135c035cc", "body": {"id": "chatcmpl-BjBGHm91q3AypKJfe9ucwG8OXkmOh", "object": "chat.completion", "created": 1750107749, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Corrected SQL query based on provided schema and user request\n-- Objective: Find up to 30 ZTF objects with probability > 0.9 of being an asteroid in 'stamp_classifier_1.0.4'\n-- Return specified columns including object ID, candidate ID, distance to Solar System object, MPC magnitude and name,\n-- plus filter ID, FWHM (approximated by sigmapsf), number of PS1 calibrators (approximated by count of matches), and exposure time (set as NULL)\n\nWITH selected_objects AS (\n    SELECT \n        o.oid, \n        s.candid, \n        s.ssdistnr, \n        s.ssnamenr, \n        r.magnr,\n        -- Count of PS1 matches as number of calibrators\n        ps1.nmtchps\n    FROM object o\n    JOIN ss_ztf s ON o.oid = s.oid\n    LEFT JOIN reference r ON o.oid = r.oid AND r.candid = s.candid\n    LEFT JOIN ps1_ztf ps1 ON o.oid = ps1.oid AND ps1.candid = s.candid\n    WHERE EXISTS (\n        SELECT 1\n        FROM probability p\n        WHERE p.oid = o.oid\n          AND p.class_name = 'asteroid'\n          AND p.classifier_name = 'stamp_classifier'\n          AND p.classifier_version = 'stamp_classifier_1.0.4'\n          AND p.probability > 0.9\n    )\n    LIMIT 30\n)\nSELECT\n    so.oid,\n    so.candid,\n    so.ssdistnr,\n    so.ssnamenr,\n    r.magnr,\n    d.fid,\n    d.sigmapsf AS fwhm, -- Using sigmapsf as a proxy for FWHM\n    so.nmtchps, -- Number of PS1 calibrators (matches)\n    NULL AS exposure_time -- Exposure time not available in schema, set as NULL\nFROM selected_objects so\nJOIN detection d ON so.candid = d.candid\nLEFT JOIN reference r ON so.oid = r.oid AND so.candid = r.candid\nORDER BY so.oid\nLIMIT 30;\n", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 4299, "completion_tokens": 467, "total_tokens": 4766, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dcb0988190a3b7facb028b8e13", "custom_id": "104-1", "response": {"status_code": 200, "request_id": "e7520b75b979d545033dfd1b57bb8863", "body": {"id": "chatcmpl-BjBGIr09ao3UG5v9frH45qMJyGrM9", "object": "chat.completion", "created": 1750107750, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select up to 30 ZTF objects with probability > 0.9 of being an asteroid in stamp_classifier version 'stamp_classifier_1.0.4'\nWITH selected_objects AS (\n    SELECT o.oid, s.candid, s.ssdistnr, s.ssnamenr\n    FROM object o\n    JOIN ss_ztf s ON o.oid = s.oid\n    WHERE o.oid IN (\n        SELECT p.oid\n        FROM probability p\n        WHERE p.class_name = 'asteroid'\n          AND p.classifier_name = 'stamp_classifier'\n          AND p.classifier_version = 'stamp_classifier_1.0.4'\n          AND p.probability > 0.9\n        ORDER BY p.probability DESC\n        LIMIT 30\n    )\n)\nSELECT\n    so.oid,\n    so.candid,\n    so.ssdistnr,\n    so.ssnamenr,\n    r.magnr,\n    r.candid AS r_candid,\n    -- Filter identifier, FWHM, number of PS1 calibrators, and exposure time\n    d.fid,\n    -- Placeholder for FWHM, replace with actual column if available\n    NULL AS fwhm,\n    -- Number of PS1 calibrators used\n    ps.nmtchps,\n    -- Placeholder for exposure time, replace with actual column if available\n    NULL AS exptime\nFROM selected_objects so\nLEFT JOIN reference r ON so.oid = r.oid\nLEFT JOIN detection d ON so.candid = d.candid\nLEFT JOIN ps1_ztf ps ON so.oid = ps.oid\nLIMIT 30;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 4368, "completion_tokens": 348, "total_tokens": 4716, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dccdf0819089c815912caa518b", "custom_id": "96-0", "response": {"status_code": 200, "request_id": "6d86aa958bdb34d170c49dd3e126c708", "body": {"id": "chatcmpl-BjBGI2maqqu0SWh1YOtx2AjuQgOh4", "object": "chat.completion", "created": 1750107750, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define the specific solar system objects with their identifiers\nWITH ss_objects AS (\n    SELECT oid, ssnamnr\n    FROM ss_ztf\n    WHERE ssnamnr IN ('2003FP134', '2009UK56')\n),\n-- Use the object identifiers to get their RA and Dec from the object table\nobject_coords AS (\n    SELECT o.oid, o.ra, o.dec\n    FROM object o\n    JOIN ss_objects s ON o.oid = s.oid\n),\n-- Find detections within 2 arcseconds (~0.0005556 degrees) of each solar system object\ndetections_nearby AS (\n    SELECT d.*\n    FROM detection d\n    JOIN object_coords o ON d.oid = o.oid\n    WHERE\n        -- Calculate angular separation using the haversine formula approximation for small angles\n        -- or simple Pythagorean approximation since angles are small\n        POWER(d.ra - o.ra, 2) + POWER(d.dec - o.dec, 2) <= POWER(0.0005556, 2)\n)\n-- Final select: all columns from ss_ztf for the objects, plus detection info\nSELECT\n    ss.*,\n    d.mjd AS detection_date,\n    d.fid AS filter_id,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf AS diff_magnitude,\n    d.sigmapsf AS mag_uncertainty\nFROM ss_objects ss\nJOIN object_coords o ON ss.oid = o.oid\nJOIN detections_nearby d ON d.oid = o.oid\nORDER BY ss.ssnamnr, d.mjd;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2076, "completion_tokens": 348, "total_tokens": 2424, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dcff6c819087b325b2af87b021", "custom_id": "96-1", "response": {"status_code": 200, "request_id": "a5f3bf41fd9c13ecfd8d4ab9d942ae29", "body": {"id": "chatcmpl-BjBGMXX0dDAI4PZVw9b4PP1ilSigL", "object": "chat.completion", "created": 1750107754, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Define the solar system objects with their coordinates (replace placeholder coordinates with actual values if available)\nWITH ss_objects AS (\n    SELECT '2003FP134' AS mpc_name, 0.0 AS ra, 0.0 AS dec -- Placeholder coordinates for 2003FP134\n    UNION ALL\n    SELECT '2009UK56', 0.0, 0.0 -- Placeholder coordinates for 2009UK56\n),\n-- Calculate the angular distance between each detection and the solar system objects\nnear_detections AS (\n    SELECT\n        d.*\n    FROM\n        detection d\n    JOIN\n        ss_objects s ON\n        -- Use the q3c_join function to efficiently find detections within 2 arcsec (~0.0005556 degrees)\n        q3c_join(d.ra, d.dec, s.ra, s.dec, 2.0/3600.0)\n)\n-- Select required columns from ss_ztf and detection, sorted by MPC name and detection date\nSELECT\n    s.*,\n    d.mjd AS detection_date,\n    d.fid AS filter_id,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf AS diff_magnitude,\n    d.sigmapsf AS mag_uncertainty\nFROM\n    ss_ztf s\nJOIN\n    near_detections d ON s.oid = d.oid\nORDER BY\n    s.ssnamenr, d.mjd;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1853, "completion_tokens": 310, "total_tokens": 2163, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dd1e1c819099a85f282c953706", "custom_id": "94-0", "response": {"status_code": 200, "request_id": "1c7202e3bfe3a1c49210f67d6e754ab5", "body": {"id": "chatcmpl-BjBGP3RADr7Ggswo6faQKjf878WU8", "object": "chat.completion", "created": 1750107757, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- The 'reference' table does not have a 'reference_change' column.\n-- Based on the user request, we need to find objects that had a change in their reference.\n-- The 'object' table has a 'reference_change' boolean column indicating if the reference changed.\n-- Therefore, we should filter objects where 'reference_change' is TRUE.\n-- Then, join with 'reference' to get all columns for those objects.\n-- Limit the result to 50 rows as requested.\n\nSELECT o.*, r.*\nFROM object o\nJOIN reference r ON o.oid = r.oid\nWHERE o.reference_change = TRUE\nLIMIT 50;", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1547, "completion_tokens": 130, "total_tokens": 1677, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dd38b48190830d9f26ff8240d4", "custom_id": "94-1", "response": {"status_code": 200, "request_id": "f82547886858c25143622d4495917f02", "body": {"id": "chatcmpl-BjBGJo3dmkmHnJqxD0i7tsV7A6lC9", "object": "chat.completion", "created": 1750107751, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- The 'reference' table does not have a 'reference_change' column.\n-- Based on the user request, we need to find objects that had a change in their reference.\n-- The 'object' table has a 'reference_change' boolean column indicating if the reference changed.\n-- Therefore, we should filter objects where 'reference_change' is TRUE.\n-- Then, join with 'reference' to get all related reference entries for those objects.\n-- Limit the result to 50 rows.\n\nSELECT o.*, r.*\nFROM object o\nJOIN reference r ON o.oid = r.oid\nWHERE o.reference_change = TRUE\nLIMIT 50;", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1547, "completion_tokens": 130, "total_tokens": 1677, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dd589881909adf1d9144762eaf", "custom_id": "90-0", "response": {"status_code": 200, "request_id": "85fa1b6bbae4d831c735b98ebe249d03", "body": {"id": "chatcmpl-BjBGJLn67FROZ8YyjP3fkvjXm1bB9", "object": "chat.completion", "created": 1750107751, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Optimize the query by replacing the CTE with a direct subquery for object selection, adding explicit conditions on probability table, and ensuring proper filtering.\n-- Also, limit the number of objects early to reduce the dataset size and improve performance.\n\nSELECT p.*\nFROM probability p\n-- Filter for classifier 'lc_classifier' and rankings 1 or 2\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\n  -- Limit to objects with multiband period < 5 days and restrict to 100 objects\n  AND p.oid IN (\n      SELECT o.oid\n      FROM object o\n      -- Join with feature table to filter by 'Multiband_period' feature\n      JOIN feature f ON f.oid = o.oid\n      WHERE f.name = 'Multiband_period'\n        AND f.value < 5\n        AND f.version = '1.2.1-P'\n      LIMIT 100\n  );\n", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3929, "completion_tokens": 201, "total_tokens": 4130, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dd748881908df0e6903204d8d6", "custom_id": "90-1", "response": {"status_code": 200, "request_id": "e84fffed53a6b63e4f02ffadfe5a1ed9", "body": {"id": "chatcmpl-BjBGJiUFYRZ7PO2XWPFj8jv4OcHNr", "object": "chat.completion", "created": 1750107751, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select probability data for objects with multiband period < 5 days, optimized with nested subqueries\n-- and including necessary conditions on the probability table to prevent timeout\n\n-- Step 1: Identify objects with multiband period < 5 days and version '1.2.1-P'\nWITH selected_objects AS (\n    SELECT o.oid\n    FROM object o\n    JOIN feature f ON o.oid = f.oid\n    WHERE f.name = 'Multiband_period'\n      AND f.value < 5\n      AND f.version = '1.2.1-P'\n)\n\n-- Step 2: Retrieve probability entries for these objects, with additional conditions\nSELECT p.*\nFROM probability p\nWHERE p.oid IN (SELECT oid FROM selected_objects)\n  AND p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\n  -- Additional filtering to reduce result set size and improve performance\n  AND p.class_name = 'classification' -- assuming class_name indicates the classification type\n  AND p.probability > 0.5 -- optional: focus on higher probability objects\n  AND p.classifier_version = '1.2.1-P' -- ensure version consistency\nORDER BY p.oid, p.ranking\nLIMIT 100;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3862, "completion_tokens": 270, "total_tokens": 4132, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086dd90f08190b205b235c1ad84b6", "custom_id": "100-0", "response": {"status_code": 200, "request_id": "f7b22351ba077b7122b76e9756fe18e1", "body": {"id": "chatcmpl-BjBGJI4xilVPHxfVSdDgrU3HA6wq0", "object": "chat.completion", "created": 1750107751, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Corrected SQL query to match schema and resolve datatype mismatch\nWITH object_oid AS (\n    SELECT oid FROM object WHERE oid = 'ZTF24aamtvxb'\n),\ndetections AS (\n    SELECT\n        'detection' AS table_name, -- Renamed column to avoid conflict with SQL keyword\n        candid AS ztf_id,\n        mjd AS epoch_date,\n        fid AS filter_id,\n        isdiffpos,\n        magpsf AS diffmag,\n        sigmapsf AS diffmag_unc,\n        magap AS mag_limit,\n        NULL AS magpsf_corr,\n        NULL AS magpsf_corr_unc\n    FROM detection\n    WHERE oid = (SELECT oid FROM object_oid)\n),\nnon_detections AS (\n    SELECT\n        'non_detection' AS table_name,\n        NULL AS ztf_id,\n        mjd AS epoch_date,\n        fid AS filter_id,\n        NULL AS isdiffpos,\n        NULL AS diffmag,\n        NULL AS diffmag_unc,\n        diffmaglim AS mag_limit,\n        NULL AS magpsf_corr,\n        NULL AS magpsf_corr_unc\n    FROM non_detection\n    WHERE oid = (SELECT oid FROM object_oid)\n),\nforced_photometry AS (\n    SELECT\n        'forced_photometry' AS table_name,\n        pid AS ztf_id,\n        mjd AS epoch_date,\n        fid AS filter_id,\n        NULL AS isdiffpos,\n        mag AS diffmag,\n        e_mag AS diffmag_unc,\n        NULL AS mag_limit,\n        mag_corr AS magpsf_corr,\n        e_mag_corr AS magpsf_corr_unc\n    FROM forced_photometry\n    WHERE oid = (SELECT oid FROM object_oid)\n)\n-- Combine all epochs from detections, non-detections, and forced photometry\nSELECT * FROM detections\nUNION ALL\nSELECT * FROM non_detections\nUNION ALL\nSELECT * FROM forced_photometry\nORDER BY epoch_date;\n", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2686, "completion_tokens": 404, "total_tokens": 3090, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086ddaf448190bec2444eed55290d", "custom_id": "100-1", "response": {"status_code": 200, "request_id": "88893e0b4fd4dacc643fab4c177073e4", "body": {"id": "chatcmpl-BjBGJmwcqb3UYZtXuL2611LI0UEBg", "object": "chat.completion", "created": 1750107751, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Corrected SQL query to match the schema and fix datatype mismatch issues\nWITH object_oid AS (\n    SELECT oid FROM object WHERE oid = 'ZTF24aamtvxb'\n),\ndetections AS (\n    SELECT\n        'detection' AS table_name, -- Use consistent column name for source table\n        candid AS ztf_id,\n        mjd AS epoch_date,\n        fid AS filter_id,\n        isdiffpos,\n        magpsf AS diffmag,\n        sigmapsf AS diffmag_unc,\n        magap AS mag_limit,\n        NULL AS magpsf_corr,\n        NULL AS magpsf_corr_unc\n    FROM detection\n    WHERE oid = (SELECT oid FROM object_oid)\n),\nnon_detections AS (\n    SELECT\n        'non_detection' AS table_name,\n        NULL AS ztf_id,\n        mjd AS epoch_date,\n        fid AS filter_id,\n        NULL AS isdiffpos,\n        NULL AS diffmag,\n        NULL AS diffmag_unc,\n        diffmaglim AS mag_limit,\n        NULL AS magpsf_corr,\n        NULL AS magpsf_corr_unc\n    FROM non_detection\n    WHERE oid = (SELECT oid FROM object_oid)\n),\nforced_photometry AS (\n    SELECT\n        'forced_photometry' AS table_name,\n        pid AS ztf_id,\n        mjd AS epoch_date,\n        fid AS filter_id,\n        NULL AS isdiffpos,\n        mag AS diffmag,\n        e_mag AS diffmag_unc,\n        NULL AS mag_limit,\n        mag_corr AS magpsf_corr,\n        e_mag_corr AS magpsf_corr_unc\n    FROM forced_photometry\n    WHERE oid = (SELECT oid FROM object_oid)\n)\n-- Combine all epochs from detections, non-detections, and forced photometry\nSELECT * FROM detections\nUNION ALL\nSELECT * FROM non_detections\nUNION ALL\nSELECT * FROM forced_photometry\nORDER BY epoch_date;\n", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2686, "completion_tokens": 404, "total_tokens": 3090, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086ddd4c081909d95098d32b1fbf8", "custom_id": "58-1", "response": {"status_code": 200, "request_id": "ecacf3dad68fdd9832e596c39c0300be", "body": {"id": "chatcmpl-BjBGKIzWUR2Z5rmc21MVIqB0WWSVD", "object": "chat.completion", "created": 1750107752, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select up to 20 objects satisfying the specified conditions\nSELECT o.*\nFROM object o\nWHERE\n    -- Ensure the object has at least 30 detections in total\n    (SELECT COALESCE(SUM(ndet), 0) FROM magstat m WHERE m.oid = o.oid) >= 30\n    AND\n    -- Calculate the difference between the minimum g-band corrected mag and maximum r-band corrected mag\n    (\n        -- Get the minimum magmin_corr for g-band (fid=1)\n        (SELECT COALESCE(MIN(magmin_corr), 0) FROM magstat m WHERE m.oid = o.oid AND m.fid = 1)\n        - \n        -- Get the maximum magmax_corr for r-band (fid=2)\n        (SELECT COALESCE(MAX(magmax_corr), 0) FROM magstat m WHERE m.oid = o.oid AND m.fid = 2)\n    ) > 3.5\n    AND\n    -- Ensure the time span between last and first detection exceeds 20 days\n    o.lastmjd - o.firstmjd > 20\n-- Limit the result to at most 20 objects\nLIMIT 20;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2448, "completion_tokens": 257, "total_tokens": 2705, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086ddf31c81908f8a4d85158acccf", "custom_id": "39-0", "response": {"status_code": 200, "request_id": "57f5ca8e8324c6a1dcaa7262bccaaa5a", "body": {"id": "chatcmpl-BjBGKewYbHTfhWoqOixskyA4R4Nef", "object": "chat.completion", "created": 1750107752, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select specified columns: object identifier, candidate identifier, filter id as 'f_id', coordinates, magnitude, and magnitude errors\nSELECT\n    d.oid AS object_id,\n    d.candid AS candidate_id,\n    d.fid AS f_id,\n    d.ra,\n    d.dec,\n    d.magpsf AS magnitude,\n    d.sigmapsf AS mag_error,\n    -- Corrected difference magnitude in the r-band filter\n    d.magpsf_corr AS mag_corr_r,\n    -- PSF corrected magnitude in the r-filter\n    d.magpsf AS psf_mag_r,\n    -- Maximum rise from minimum in each detection\n    (MAX(d.magpsf) OVER (PARTITION BY d.oid) - MIN(d.magpsf) OVER (PARTITION BY d.oid)) AS max_rise\nFROM\n    detection d\nWHERE\n    -- Filter objects with the highest probability class as CV/Nova by the stochastic light curve classifier\n    -- Subquery to get object ids with CV/Nova as top class (ranking=1) for the specified classifier\n    d.oid IN (\n        SELECT p.oid\n        FROM probability p\n        WHERE\n            p.class_name = 'CV/Nova'\n            AND p.classifier_name = 'lc_classifier_stochastic'\n            AND p.ranking = 1\n    )\n    -- Ensure the object has at most 50 detections from first to last detection\n    AND (\n        SELECT COUNT(*) FROM detection d2 WHERE d2.oid = d.oid\n    ) <= 50\n    -- Filter detections within the date range from first to last detection for each object\n    AND d.mjd BETWEEN (\n        SELECT MIN(mjd) FROM detection d2 WHERE d2.oid = d.oid\n    ) AND (\n        SELECT MAX(mjd) FROM detection d2 WHERE d2.oid = d.oid\n    )\nORDER BY\n    d.oid\nLIMIT 1000;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3237, "completion_tokens": 410, "total_tokens": 3647, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
{"id": "batch_req_685086de2d348190874b936685afdd62", "custom_id": "39-1", "response": {"status_code": 200, "request_id": "f998fb50503101278f61a91daa192fe5", "body": {"id": "chatcmpl-BjBGKzLLUIGLiSEUJ5jZ49YjpJHEx", "object": "chat.completion", "created": 1750107752, "model": "gpt-4.1-nano-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select specified columns from detection, object, and probability tables with optimized nested queries\nWITH object_detection_stats AS (\n    -- Aggregate detection info per object to filter by detection count and date range\n    SELECT\n        o.oid,\n        -- Select one representative detection per object (e.g., earliest detection)\n        MIN(d.candid) AS candid,\n        -- Use the detection with the maximum ra and dec for coordinate info\n        (ARRAY_AGG(d.ra ORDER BY d.mjd))[1] AS ra,\n        (ARRAY_AGG(d.dec ORDER BY d.mjd))[1] AS dec,\n        -- Calculate maximum rise in magpsf for the object\n        MAX(d.magpsf) - MIN(d.magpsf) AS max_rise,\n        -- Get the first detection date\n        o.firstmjd,\n        -- Get the last detection date\n        o.lastmjd,\n        -- Get the object ID\n        o.oid\n    FROM\n        object o\n    JOIN\n        detection d ON d.oid = o.oid\n    WHERE\n        -- Filter for objects with at most 50 detections\n        (SELECT COUNT(*) FROM detection d2 WHERE d2.oid = o.oid) <= 50\n        -- Filter detections within the object's detection date range\n        AND d.mjd BETWEEN o.firstmjd AND o.lastmjd\n        -- Filter for corrected difference magnitude in r-band (fid=2)\n        AND d.corrected = TRUE\n        AND d.fid = 2\n    GROUP BY\n        o.oid, o.firstmjd, o.lastmjd\n),\nprobability_filter AS (\n    -- Select objects classified as CV/Nova with highest probability (ranking=1)\n    SELECT\n        p.oid\n    FROM\n        probability p\n    WHERE\n        p.classifier_name = 'lc_classifier_stochastic'\n        AND p.class_name = 'CV/Nova'\n        AND p.ranking = 1\n        AND p.probability >= 0.5 -- Optional: set a probability threshold if desired\n),\ndetection_filtered AS (\n    -- Filter detections for the selected objects and specific conditions\n    SELECT\n        d.candid,\n        d.oid,\n        d.rfid AS f_id,\n        d.ra,\n        d.dec,\n        d.magpsf AS mag,\n        d.sigmapsf AS mag_err,\n        d.magpsf_corr AS mag_corr,\n        d.magap AS mag_ap,\n        d.sigmagap AS mag_ap_err,\n        -- Calculate maximum rise from minimum magpsf per detection\n        -- Since max_rise is per object, join with object_detection_stats\n        NULL AS max_rise -- placeholder, will join later\n    FROM\n        detection d\n    WHERE\n        -- Only detections for objects classified as CV/Nova\n        d.oid IN (SELECT oid FROM probability_filter)\n        -- Filter for detections in r-band (fid=2)\n        AND d.fid = 2\n        -- Filter for corrected detections\n        AND d.corrected = TRUE\n),\ndetection_with_rise AS (\n    -- Join detection with object detection stats to get max_rise\n    SELECT\n        d.*,\n        ods.max_rise\n    FROM\n        detection_filtered d\n    JOIN\n        object_detection_stats ods ON d.oid = ods.oid\n),\n-- Final selection of columns, ordered by object ID\nSELECT\n    oid,\n    candid,\n    f_id,\n    ra,\n    dec,\n    mag,\n    mag_err,\n    mag_corr,\n    mag_ap,\n    mag_ap_err,\n    max_rise\nFROM\n    detection_with_rise\nORDER BY\n    oid\nLIMIT 1000;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2974, "completion_tokens": 775, "total_tokens": 3749, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_38343a2f8f"}}, "error": null}
