{"id": "batch_req_6848c291453c8190a6d95eb0e15a9f14", "custom_id": "15-0", "response": {"status_code": 200, "request_id": "3f222c2e532fe0cf2927e88e4dbff882", "body": {"id": "chatcmpl-Bh2sOB8lPKMeicfVAq9jWaaGdj47x", "object": "chat.completion", "created": 1749598860, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects classified as 'SN' by the stamp_classifier with highest probability (ranking=1)\n-- Filter objects with first detection in first two days of September (MJD 60188.0 to 60189.0)\n-- Filter fast risers: dmag_first / dt_first >= 0.25 in magstat for the same filter as detection\n-- Return oid, probability, candid, detection fid, magstat fid as magstat_fid, and dmag_first\n-- Order by oid\n\nWITH sn_objects AS (\n    SELECT p.oid, p.probability\n    FROM probability p\n    WHERE p.classifier_name = 'stamp_classifier'\n      AND p.class_name = 'SN'\n      AND p.ranking = 1\n),\nfirst_detect AS (\n    SELECT o.oid, o.firstmjd\n    FROM object o\n    WHERE o.firstmjd BETWEEN 60188.0 AND 60189.0\n),\nfast_risers AS (\n    SELECT m.oid, m.fid AS magstat_fid, m.dmag_first, m.dt_first\n    FROM magstat m\n    WHERE m.dt_first > 0\n      AND (m.dmag_first / m.dt_first) >= 0.25\n)\n\nSELECT \n    d.oid,\n    s.probability,\n    d.candid,\n    d.fid,\n    f.magstat_fid,\n    f.dmag_first\nFROM sn_objects s\nINNER JOIN first_detect fd ON s.oid = fd.oid\nINNER JOIN fast_risers f ON s.oid = f.oid\nINNER JOIN detection d ON s.oid = d.oid\n-- Ensure detection filter matches magstat filter for initial rise estimate\nWHERE d.fid = f.magstat_fid\nORDER BY d.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2966, "completion_tokens": 375, "total_tokens": 3341, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848c29154b881908ede80f12df603cb", "custom_id": "15-1", "response": {"status_code": 200, "request_id": "3d440f6997031172f429060508bc191f", "body": {"id": "chatcmpl-Bh2sPHkLltPHNJ15co19ENDrwQHt5", "object": "chat.completion", "created": 1749598861, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT \n    p.oid,\n    p.probability,\n    d.candid,\n    d.fid,\n    m.fid AS magstat_fid,\n    m.dmag_first\nFROM \n    probability p\nINNER JOIN \n    object o ON p.oid = o.oid\nINNER JOIN \n    magstat m ON p.oid = m.oid\nINNER JOIN \n    detection d ON p.oid = d.oid\nWHERE \n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd >= 60188.0\n    AND o.firstmjd < 60190.0\n    AND m.dmag_first >= 0.25\nORDER BY \n    p.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2840, "completion_tokens": 171, "total_tokens": 3011, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848c29163e88190b5f8c3bc66076729", "custom_id": "4-0", "response": {"status_code": 200, "request_id": "af3bc03b8af14ef3e1c4f1fb19788d7f", "body": {"id": "chatcmpl-Bh2sPYOeZBLf4PyeG7pwt1twbG04c", "object": "chat.completion", "created": 1749598861, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT \n    o.oid,\n    d.candid,\n    d.magpsf,\n    d.sigmapsf,\n    m.dmdt_first,\n    d.fid,\n    d.mjd\nFROM \n    probability p\n    INNER JOIN object o ON p.oid = o.oid\n    INNER JOIN magstat m ON o.oid = m.oid AND m.fid IN (1, 2)\n    INNER JOIN detection d ON o.oid = d.oid\nWHERE \n    p.class_name = 'SNII'\n    AND p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.probability > 0.6\n    AND o.ndet > 50\n    AND m.dmdt_first > 0.5\n    AND d.fid IN (1, 2)\n    AND d.mjd BETWEEN 58484 AND 59926\nORDER BY \n    o.oid,\n    d.mjd;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2690, "completion_tokens": 208, "total_tokens": 2898, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848c29171e88190b88c8f67c807e20b", "custom_id": "4-1", "response": {"status_code": 200, "request_id": "8e685cb00969b85d96d96d2177545d81", "body": {"id": "chatcmpl-Bh2hr7YtpcIkKbxRDdU4B1Yq3iMiH", "object": "chat.completion", "created": 1749598207, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT \n    o.oid,\n    d.candid,\n    d.magpsf,\n    d.sigmapsf,\n    m.dmdt_first,\n    d.fid,\n    d.mjd\nFROM \n    probability p\n    INNER JOIN object o ON p.oid = o.oid\n    INNER JOIN magstat m ON o.oid = m.oid AND m.fid IN (1, 2)\n    INNER JOIN detection d ON o.oid = d.oid\nWHERE \n    p.class_name = 'SNII'\n    AND p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.probability > 0.6\n    AND o.ndet > 50\n    AND m.dmdt_first > 0.5\n    AND d.fid IN (1, 2)\n    AND d.mjd BETWEEN 58484 AND 59927\nORDER BY \n    o.oid,\n    d.mjd;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2822, "completion_tokens": 208, "total_tokens": 3030, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848c2918300819086c5eb974c97b3e3", "custom_id": "25-0", "response": {"status_code": 200, "request_id": "fcf0d07a827aaac0d31127bb299afb4d", "body": {"id": "chatcmpl-Bh2hshGzjpJbwCNdHaMR9CLM8hWG2", "object": "chat.completion", "created": 1749598208, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH catalog AS (\n    SELECT 'source_1' AS source_id, 160.18301441363647 AS ra, 33.0164673528409 AS dec\n    UNION ALL\n    SELECT 'source_2', 174.21524897555543, 44.83789535222221\n)\nSELECT object.*, probability.*, catalog.source_id\nFROM object\nINNER JOIN catalog\n    ON q3c_join(object.meanra, object.meandec, catalog.ra, catalog.dec, 10)\nINNER JOIN probability\n    ON object.oid = probability.oid\n    AND probability.ranking = 1\n    AND probability.classifier_name = 'stamp_classifier'\n    AND probability.class_name = 'SN'\n    AND probability.probability > 0.4\nWHERE object.firstmjd BETWEEN 59976.0 AND 59982.0;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2420, "completion_tokens": 184, "total_tokens": 2604, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848c291946c8190b79ab6e9a679fb74", "custom_id": "9-0", "response": {"status_code": 200, "request_id": "54c66ecfd8ffa3d178b59bfc028be93f", "body": {"id": "chatcmpl-Bh2hrIGyCDMUDReXf79Ysa8N6gQT8", "object": "chat.completion", "created": 1749598207, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT \n    o.oid,\n    p.probability AS value,\n    s.name,\n    s.version,\n    o.meanra,\n    o.meandec,\n    p.classifier_version AS source_identifier,\n    q3c_dist(o.meanra, o.meandec, 39.97, -1.5768) AS dist\nFROM \n    object o\nINNER JOIN \n    probability p ON o.oid = p.oid\nINNER JOIN \n    step s ON p.classifier_version = s.step_id\nWHERE \n    o.firstmjd BETWEEN 60126.0 AND 60156.0\n    AND q3c_radial_query(o.meanra, o.meandec, 39.97, -1.5768, 16.16667)\n    AND o.sgscore1 < 0.3\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.ranking = 1\n    AND p.class_name NOT IN ('asteroid', 'bogus');\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3005, "completion_tokens": 213, "total_tokens": 3218, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848c291a53881908a27b82aa6b8c52e", "custom_id": "9-1", "response": {"status_code": 200, "request_id": "459884b8d74d930db2f4bd85c8d96dcf", "body": {"id": "chatcmpl-Bh2hrItspv3ueOIhuZ3HeNyzw5khv", "object": "chat.completion", "created": 1749598207, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT \n    o.oid,\n    p.value,\n    s.name,\n    s.version,\n    o.meanra,\n    o.meandec,\n    o.oid AS source_identifier,\n    q3c_dist(o.meanra, o.meandec, 39.97, -1.5768) AS dist\nFROM \n    object o\nINNER JOIN \n    probability p ON o.oid = p.oid\nINNER JOIN \n    step s ON o.step_id_corr = s.step_id\nWHERE \n    o.firstmjd BETWEEN 60126.0 AND 60156.0\n    AND q3c_radial_query(o.meanra, o.meandec, 39.97, -1.5768, 16.16667)\n    AND o.sgscore1 < 0.3\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.ranking = 1\n    AND p.class_name NOT IN ('asteroid', 'bogus');\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3009, "completion_tokens": 208, "total_tokens": 3217, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848c291b3a0819090b4bfb132921a7e", "custom_id": "5-0", "response": {"status_code": 200, "request_id": "8727f0f7fe3c8b8ebc433551d7a7e2da", "body": {"id": "chatcmpl-Bh2hrb5DIapmMDOe53gfmbiG9ZjFr", "object": "chat.completion", "created": 1749598207, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nSELECT \n    o.oid,\n    d.candid,\n    f.name,\n    f.value,\n    d.magpsf,\n    d.sigmapsf,\n    d.fid,\n    f.fid AS feature_fid,\n    d.mjd\nFROM \n    object o\nINNER JOIN \n    probability p ON o.oid = p.oid\nINNER JOIN \n    magstat m ON o.oid = m.oid\nINNER JOIN \n    feature f ON o.oid = f.oid\nINNER JOIN \n    detection d ON o.oid = d.oid\nWHERE \n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name = 'SNII'\n    AND p.probability > 0.6\n    AND o.ndet > 50\n    AND m.fid = 1\n    AND (m.magmax - m.magmin) > 2\nORDER BY \n    o.oid,\n    d.mjd;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2482, "completion_tokens": 211, "total_tokens": 2693, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848c291c3ac8190ac741ab36e194004", "custom_id": "5-1", "response": {"status_code": 200, "request_id": "d93016aafbdba71c930afda112b9fea9", "body": {"id": "chatcmpl-Bh2hrPc5SDgMEJ4UWcDbFhClPgQWT", "object": "chat.completion", "created": 1749598207, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH filtered_objects AS (\n    SELECT p.oid\n    FROM probability p\n    INNER JOIN object o ON p.oid = o.oid\n    INNER JOIN magstat m ON p.oid = m.oid\n    WHERE p.class_name = 'SNII'\n      AND p.probability > 0.6\n      AND p.ranking = 1\n      AND p.classifier_name = 'lc_classifier'\n      AND o.ndet > 50\n      AND m.fid = 1\n      AND (m.magmax - m.magmin) > 2\n)\nSELECT \n    d.oid,\n    d.candid,\n    f.name,\n    f.value,\n    d.magpsf,\n    d.sigmapsf,\n    f.fid AS feature_fid,\n    d.mjd\nFROM filtered_objects fo\nINNER JOIN feature f ON fo.oid = f.oid\nINNER JOIN detection d ON fo.oid = d.oid\nORDER BY d.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3197, "completion_tokens": 208, "total_tokens": 3405, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848c291ddc4819097e5ff833e9a4787", "custom_id": "31-0", "response": {"status_code": 200, "request_id": "5eb10b9af9aa2084503be97a8279e333", "body": {"id": "chatcmpl-Bh2hryrgnvl3csIWoxPNsW8sEhUgD", "object": "chat.completion", "created": 1749598207, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH features_pivot AS (\n  SELECT\n    oid,\n    jsonb_object_agg(feature_name, feature_value) AS features_json\n  FROM feature\n  GROUP BY oid\n)\nSELECT\n  o.oid,\n  o.gal_l,\n  o.gal_b,\n  p.class_name,\n  f.features_json\nFROM object o\nINNER JOIN probability p ON o.oid = p.oid\n  AND p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\nLEFT JOIN features_pivot f ON o.oid = f.oid\nWHERE o.firstmjd >= 59976.0\n  AND o.firstmjd < 59978.0;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2521, "completion_tokens": 148, "total_tokens": 2669, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848c291ee24819088f14ada26a9b69d", "custom_id": "31-1", "response": {"status_code": 200, "request_id": "14b4f077826e6637b6c2ff93ee724459", "body": {"id": "chatcmpl-Bh2hs2Y3VQaR0IIJP4AydPhmLW9Tt", "object": "chat.completion", "created": 1749598208, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Query to get galactic coordinates, features, class name, and object IDs for objects first detected between Feb 1 and 2, 2023,\n-- classified by the light curve classifier with ranking=1, pivoting features into columns.\n\nWITH filtered_objects AS (\n    SELECT oid, gal_l, gal_b\n    FROM object\n    WHERE firstmjd >= 59976.0 AND firstmjd < 59978.0\n),\nclassified_objects AS (\n    SELECT p.oid, p.class_name\n    FROM probability p\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n),\nfeatures_pivot AS (\n    SELECT\n        f.oid,\n        MAX(CASE WHEN f.name = 'amplitude' THEN f.value END) AS amplitude,\n        MAX(CASE WHEN f.name = 'period' THEN f.value END) AS period,\n        MAX(CASE WHEN f.name = 'skewness' THEN f.value END) AS skewness,\n        MAX(CASE WHEN f.name = 'kurtosis' THEN f.value END) AS kurtosis,\n        MAX(CASE WHEN f.name = 'median_mag' THEN f.value END) AS median_mag,\n        MAX(CASE WHEN f.name = 'std_dev' THEN f.value END) AS std_dev\n    FROM feature f\n    GROUP BY f.oid\n)\n\nSELECT \n    fo.oid,\n    fo.gal_l,\n    fo.gal_b,\n    co.class_name,\n    fp.amplitude,\n    fp.period,\n    fp.skewness,\n    fp.kurtosis,\n    fp.median_mag,\n    fp.std_dev\nFROM filtered_objects fo\nINNER JOIN classified_objects co ON fo.oid = co.oid\nLEFT JOIN features_pivot fp ON fo.oid = fp.oid\nORDER BY fo.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2554, "completion_tokens": 383, "total_tokens": 2937, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848c291fed081909e91c6cc17432548", "custom_id": "6-0", "response": {"status_code": 200, "request_id": "92f93bfd2f3226b477dafcc517ee0050", "body": {"id": "chatcmpl-Bh2hrhksusXIS3tsY4wjMk5TImLnQ", "object": "chat.completion", "created": 1749598207, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH prob_snII AS (\n    SELECT oid\n    FROM probability\n    WHERE class_name = 'SNII'\n      AND classifier_name = 'lc_classifier'\n      AND ranking = 1\n      AND probability > 0.6\n),\nobj_time_filtered AS (\n    SELECT oid\n    FROM object\n    WHERE firstmjd <= 59944.0\n      AND lastmjd >= 58484.0\n      AND oid IN (SELECT oid FROM prob_snII)\n),\nmagstat_g AS (\n    SELECT oid\n    FROM magstat\n    WHERE fid = 1\n      AND dmdt_first > 0.5\n      AND ndet > 30\n      AND oid IN (SELECT oid FROM obj_time_filtered)\n),\nmagstat_r AS (\n    SELECT oid\n    FROM magstat\n    WHERE fid = 2\n      AND dmdt_first > 0.5\n      AND ndet > 30\n      AND (lastmjd - firstmjd) >= 100\n      AND oid IN (SELECT oid FROM obj_time_filtered)\n),\nmagstat_filtered AS (\n    SELECT oid\n    FROM magstat_g\n    INTERSECT\n    SELECT oid\n    FROM magstat_r\n),\nfinal_oids AS (\n    SELECT oid\n    FROM prob_snII\n    WHERE oid IN (SELECT oid FROM magstat_filtered)\n)\nSELECT d.oid,\n       d.candid,\n       d.magpsf,\n       d.sigmapsf,\n       d.fid AS f_id,\n       d.mjd\nFROM detection d\nWHERE d.oid IN (SELECT oid FROM final_oids)\n  AND d.mjd BETWEEN 58484.0 AND 59944.0\nORDER BY d.oid, d.mjd;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3185, "completion_tokens": 365, "total_tokens": 3550, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848c2920fe4819099a9927257db62d0", "custom_id": "6-1", "response": {"status_code": 200, "request_id": "7f9b113e14f280ea990993f2595a1de8", "body": {"id": "chatcmpl-Bh2hupET9m0r6iUqXbNM7U3Up06b9", "object": "chat.completion", "created": 1749598210, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH prob_snII AS (\n    SELECT oid\n    FROM probability\n    WHERE class_name = 'SNII'\n      AND classifier_name = 'lc_classifier'\n      AND ranking = 1\n      AND probability > 0.6\n),\nmagstat_r AS (\n    SELECT oid\n    FROM magstat\n    WHERE fid = 2\n      AND (lastmjd - firstmjd) >= 100\n),\nmagstat_g_rise AS (\n    SELECT oid\n    FROM magstat\n    WHERE fid = 1\n      AND dmdt_first > 0.5\n),\nmagstat_r_rise AS (\n    SELECT oid\n    FROM magstat\n    WHERE fid = 2\n      AND dmdt_first > 0.5\n),\nmagstat_rise_both AS (\n    SELECT oid\n    FROM magstat_g_rise\n    INTERSECT\n    SELECT oid\n    FROM magstat_r_rise\n),\nobjects_filtered AS (\n    SELECT o.oid\n    FROM object o\n    INNER JOIN prob_snII p ON o.oid = p.oid\n    INNER JOIN magstat_r mr ON o.oid = mr.oid\n    INNER JOIN magstat_rise_both rb ON o.oid = rb.oid\n    WHERE o.ndet > 30\n      AND o.firstmjd <= 59944.0\n      AND o.lastmjd >= 58484.0\n)\nSELECT d.oid,\n       d.candid,\n       d.magpsf,\n       d.sigmapsf,\n       d.fid AS f_id,\n       d.mjd\nFROM detection d\nINNER JOIN objects_filtered ofil ON d.oid = ofil.oid\nORDER BY d.oid, d.mjd;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3054, "completion_tokens": 367, "total_tokens": 3421, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848c2921fd88190b814bf28684d7f28", "custom_id": "105-0", "response": {"status_code": 200, "request_id": "dd45848ca2628d907bbd2357a5e96b71", "body": {"id": "chatcmpl-Bh2hrk1xhUIUuWe5PSesGg8woJCrG", "object": "chat.completion", "created": 1749598207, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH selected_oids AS (\n    SELECT p.oid, p.probability\n    FROM probability p\n    INNER JOIN ps1_ztf ps1 ON p.oid = ps1.oid\n    INNER JOIN detection d ON p.oid = d.oid\n    WHERE p.class_name = 'AGN'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.classifier_version = 'hierarchical_rf_1.1.0'\n      AND p.ranking = 1\n      AND p.probability > 0.7\n      AND ps1.distpsnr1 < 2\n      AND ABS(ps1.sgscore1 - d.rb) < 0.5\n    GROUP BY p.oid, p.probability\n    LIMIT 50\n)\nSELECT \n    so.oid,\n    so.probability,\n    d.candid,\n    d.fid,\n    dq.chisq AS reduced_chisq,  -- Assuming reduced chi-square is stored in dataquality.chipsf or similar; no explicit reduced chi-square column in detection, so using chipsf from dataquality as proxy\n    d.rb AS sgscore_sextractor,\n    ps1.objectidps1,\n    ps1.sgscore1,\n    ps1.distpsnr1\nFROM selected_oids so\nINNER JOIN detection d ON so.oid = d.oid\nLEFT JOIN dataquality dq ON d.candid = dq.candid AND d.oid = dq.oid\nINNER JOIN ps1_ztf ps1 ON so.oid = ps1.oid\nORDER BY so.oid, d.candid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3020, "completion_tokens": 340, "total_tokens": 3360, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848c29233bc8190934f64400822cbef", "custom_id": "105-1", "response": {"status_code": 200, "request_id": "d7f33895e193d9880e94dc91fa5ca812", "body": {"id": "chatcmpl-Bh2hukzOaeeyaKjpnOwmGfbLJWql7", "object": "chat.completion", "created": 1749598210, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH filtered_oids AS (\n    SELECT p.oid\n    FROM probability p\n    INNER JOIN ps1_ztf ps1 ON p.oid = ps1.oid\n    INNER JOIN detection d ON p.oid = d.oid\n    WHERE p.class_name = 'AGN'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.classifier_version = 'hierarchical_rf_1.1.0'\n      AND p.ranking = 1\n      AND p.probability > 0.7\n      AND ps1.distpsnr1 < 2\n      AND ABS(ps1.sgscore1 - d.classtar) < 0.5\n    GROUP BY p.oid\n    LIMIT 50\n)\nSELECT \n    p.oid,\n    p.probability,\n    d.candid,\n    d.fid,\n    d.chipsf,\n    d.classtar,\n    ps1.objectidps1,\n    ps1.sgscore1,\n    ps1.distpsnr1\nFROM filtered_oids fo\nINNER JOIN probability p ON fo.oid = p.oid\nINNER JOIN detection d ON fo.oid = d.oid\nINNER JOIN ps1_ztf ps1 ON fo.oid = ps1.oid\nWHERE p.class_name = 'AGN'\n  AND p.classifier_name = 'lc_classifier'\n  AND p.classifier_version = 'hierarchical_rf_1.1.0'\n  AND p.ranking = 1\n  AND p.probability > 0.7\n  AND ps1.distpsnr1 < 2\n  AND ABS(ps1.sgscore1 - d.classtar) < 0.5\nORDER BY p.probability DESC, p.oid, d.candid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3029, "completion_tokens": 374, "total_tokens": 3403, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
