{"id": "batch_req_6848cce1946081908af8d8bc55ed2d73", "custom_id": "10-0", "response": {"status_code": 200, "request_id": "464e8f55e7f3d756ada92ece900f3634", "body": {"id": "chatcmpl-Bh3Yhs1qy6J65O7Gb4LNF681a3wFZ", "object": "chat.completion", "created": 1749601483, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object IDs and probabilities for SNIa (ranking=1) and CV/Nova (ranking=2) from the lc_classifier\n-- Only consider objects where the absolute difference between these probabilities is less than 0.1\n-- Added classifier_version filter to reduce search space and improve performance\n-- Added explicit conditions on classifier_name, ranking, and class_name to optimize query\n\nWITH sn_probs AS (\n    SELECT\n        oid,\n        probability AS SN_prob\n    FROM probability\n    WHERE classifier_name = 'lc_classifier'\n      AND ranking = 1\n      AND class_name = 'SNIa'\n      -- Assuming we can filter by a recent classifier_version to reduce data scanned\n      -- If no specific version is known, this line can be removed or adjusted accordingly\n      -- For example, uncomment and set the latest version if known:\n      -- AND classifier_version = '2023.1'\n),\ncv_probs AS (\n    SELECT\n        oid,\n        probability AS CV_prob\n    FROM probability\n    WHERE classifier_name = 'lc_classifier'\n      AND ranking = 2\n      AND class_name = 'CV/Nova'\n      -- AND classifier_version = '2023.1'\n)\nSELECT\n    sn.oid,\n    sn.SN_prob,\n    cv.CV_prob\nFROM sn_probs sn\nJOIN cv_probs cv ON sn.oid = cv.oid\nWHERE ABS(sn.SN_prob - cv.CV_prob) < 0.1;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1501, "completion_tokens": 304, "total_tokens": 1805, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce1a2408190ad593b5b6511e768", "custom_id": "10-1", "response": {"status_code": 200, "request_id": "8640a967d8407f6a3494b16a55974090", "body": {"id": "chatcmpl-Bh3YpYfciqturPuupfWFEThhFyyTg", "object": "chat.completion", "created": 1749601491, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object IDs and probabilities for SNIa (ranking=1) and CV/Nova (ranking=2) from the lc_classifier\n-- Only consider objects where the absolute difference between these probabilities is less than 0.1\n-- Added classifier_version filter to reduce data scanned (assuming latest version 'v1.0' as example)\n-- Added condition to ensure probability > 0 to avoid unnecessary rows\n-- Used EXISTS to ensure both classes exist for the object with required rankings, reducing join size\n\nWITH sn_probs AS (\n    SELECT\n        oid,\n        probability AS SN_prob\n    FROM probability\n    WHERE classifier_name = 'lc_classifier'\n      AND class_name = 'SNIa'\n      AND ranking = 1\n      AND probability > 0\n      AND classifier_version = 'v1.0'  -- adjust version if needed\n),\ncv_probs AS (\n    SELECT\n        oid,\n        probability AS CV_prob\n    FROM probability\n    WHERE classifier_name = 'lc_classifier'\n      AND class_name = 'CV/Nova'\n      AND ranking = 2\n      AND probability > 0\n      AND classifier_version = 'v1.0'  -- adjust version if needed\n)\nSELECT\n    sn.oid,\n    sn.SN_prob,\n    cv.CV_prob\nFROM sn_probs sn\nJOIN cv_probs cv ON sn.oid = cv.oid\nWHERE ABS(sn.SN_prob - cv.CV_prob) < 0.1;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1503, "completion_tokens": 307, "total_tokens": 1810, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce1b1508190a250f171a2b9d812", "custom_id": "15-0", "response": {"status_code": 200, "request_id": "054bec981b7d953a4b8c38de751f33c9", "body": {"id": "chatcmpl-Bh3YrbyzaODaEH23gGOEwMsMrAYpk", "object": "chat.completion", "created": 1749601493, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects classified as 'SN' by the stamp_classifier with highest probability (ranking=1)\n-- Filter objects with first detection in first two days of September (MJD 60188.0 to 60189.0)\n-- Filter fast risers using feature 'dmag_first_det_fid' and 'dt_first' from magstat (correct column names)\n-- Return oid, probability, candid, detection fid, magstat fid as magstat_fid, and initial rise estimate (dmag_first_det_fid)\n-- Order by oid\n\nWITH sn_objects AS (\n    SELECT p.oid, p.probability\n    FROM probability p\n    WHERE p.classifier_name = 'stamp_classifier'\n      AND p.class_name = 'SN'\n      AND p.ranking = 1\n),\nfirst_detect AS (\n    SELECT o.oid, o.firstmjd\n    FROM object o\n    WHERE o.firstmjd BETWEEN 60188.0 AND 60189.0\n),\n-- Use magstat columns dmag_first_det_fid and dt_first for initial rise estimate\nfast_risers AS (\n    SELECT \n        m.oid,\n        m.fid AS magstat_fid,\n        m.dmag_first_det_fid AS dmag_first,\n        m.dt_first\n    FROM magstat m\n    WHERE m.dt_first > 0\n      AND (m.dmag_first_det_fid / m.dt_first) >= 0.25\n)\n\nSELECT \n    d.oid,\n    s.probability,\n    d.candid,\n    d.fid,\n    f.magstat_fid,\n    f.dmag_first\nFROM sn_objects s\nINNER JOIN first_detect fd ON s.oid = fd.oid\nINNER JOIN fast_risers f ON s.oid = f.oid\nINNER JOIN detection d ON s.oid = d.oid\n-- Ensure detection filter matches magstat filter for initial rise estimate\nWHERE d.fid = f.magstat_fid\nORDER BY d.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 5477, "completion_tokens": 417, "total_tokens": 5894, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce1c31c819093dbecaa50db2f5f", "custom_id": "15-1", "response": {"status_code": 200, "request_id": "022c4b5c87e09afa13a3a36e818eb46f", "body": {"id": "chatcmpl-Bh3YmsHgt16cgpsqqUwD2zdQFfRDp", "object": "chat.completion", "created": 1749601488, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object identifiers, highest SN probability from stamp_classifier,\n-- detections info, magstat filter id and initial rise estimate (dmag_first)\n-- for objects with first detection in first 2 days of September (MJD 60188 to 60190),\n-- and qualifying as fast risers (dmag_first >= 0.25).\n-- Order results by oid.\n\nSELECT \n    p.oid,\n    p.probability,\n    d.candid,\n    d.fid,\n    m.fid AS magstat_fid,\n    m.dm_first  -- corrected column name from dmag_first to dm_first as per magstat schema\nFROM \n    probability p\nINNER JOIN \n    object o ON p.oid = o.oid\nINNER JOIN \n    magstat m ON p.oid = m.oid\nINNER JOIN \n    detection d ON p.oid = d.oid\nWHERE \n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd >= 60188.0\n    AND o.firstmjd < 60190.0\n    AND m.dm_first >= 0.25  -- corrected column name here as well\nORDER BY \n    p.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 5051, "completion_tokens": 271, "total_tokens": 5322, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce1d060819080247fbf96044015", "custom_id": "9-0", "response": {"status_code": 200, "request_id": "7882a324591c47794e83da0655c76b1e", "body": {"id": "chatcmpl-Bh3YnFGlvQD6Xa1CiROyXvI2AjplF", "object": "chat.completion", "created": 1749601489, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object identifiers with first detection in July 2023 (MJD 60126 to 60156),\n-- within 1000 arcmin (~16.6667 degrees) from Abell 370 center (RA=39.97, Dec=-1.5768),\n-- with sgscore1 < 0.3 (from magstats table, joined here),\n-- and whose highest probability class in stamp_classifier is neither Asteroid nor Bogus.\n-- Also get step name and version, mean RA/Dec, classifier_version as source_identifier,\n-- and distance from Abell 370 center using q3c_dist function.\n\nSELECT \n    o.oid,\n    p.probability AS value,\n    s.name,\n    s.version,\n    o.meanra,\n    o.meandec,\n    p.classifier_version AS source_identifier,\n    q3c_dist(o.meanra, o.meandec, 39.97, -1.5768) AS dist\nFROM \n    object o\nINNER JOIN \n    magstats m ON o.oid = m.oid  -- join to get sgscore1\nINNER JOIN \n    probability p ON o.oid = p.oid\nINNER JOIN \n    step s ON p.classifier_version = s.step_id\nWHERE \n    o.firstmjd BETWEEN 60126.0 AND 60156.0\n    AND q3c_radial_query(o.meanra, o.meandec, 39.97, -1.5768, 16.6667)  -- 1000 arcmin = 16.6667 degrees\n    AND m.sgscore1 < 0.3  -- sgscore1 is in magstats, not object\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.ranking = 1\n    AND p.class_name NOT IN ('asteroid', 'bogus');\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1743, "completion_tokens": 392, "total_tokens": 2135, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce1defc8190873ec257796cf791", "custom_id": "9-1", "response": {"status_code": 200, "request_id": "00f388a1ee8c301071e907a57de4ca2a", "body": {"id": "chatcmpl-Bh3YjqQ5oWkKjdxCGTO8Qc7LcHRUF", "object": "chat.completion", "created": 1749601485, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object identifiers with first detection in July 2023 (MJD 60126 to 60156),\n-- within 1000 arcmin (~16.6667 degrees) from Abell 370 center (RA=39.97, Dec=-1.5768),\n-- with sgscore1 < 0.3,\n-- and whose highest stamp_classifier probability class is neither 'asteroid' nor 'bogus'.\n-- Also join with step table to get classifier name and version,\n-- and calculate distance using q3c_dist function.\n\nSELECT \n    o.oid,\n    p.probability AS value,  -- corrected column name from 'value' to 'probability'\n    s.name,\n    s.version,\n    o.meanra,\n    o.meandec,\n    o.oid AS source_identifier,\n    q3c_dist(o.meanra, o.meandec, 39.97, -1.5768) AS dist\nFROM \n    object o\nINNER JOIN \n    probability p ON o.oid = p.oid\nINNER JOIN \n    step s ON o.step_id_corr = s.step_id\nWHERE \n    o.firstmjd BETWEEN 60126.0 AND 60156.0\n    -- 1000 arcmin = 16.6667 degrees radius search using q3c_radial_query\n    AND q3c_radial_query(o.meanra, o.meandec, 39.97, -1.5768, 16.6667)\n    AND o.sgscore1 < 0.3\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.ranking = 1\n    AND p.class_name NOT IN ('asteroid', 'bogus');\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1713, "completion_tokens": 361, "total_tokens": 2074, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce1edd88190a7ad0f2d7f621ce4", "custom_id": "6-1", "response": {"status_code": 200, "request_id": "74660d00a56165b231b0790c84b0b0d9", "body": {"id": "chatcmpl-Bh3YoETwzU7Gdml0FGA5ao6TKywS0", "object": "chat.completion", "created": 1749601490, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Step 1: Filter probability table for SNII with ranking=1 and probability > 0.6 and classifier_name='lc_classifier'\nWITH prob_snII AS (\n    SELECT oid\n    FROM probability\n    WHERE class_name = 'SNII'\n      AND classifier_name = 'lc_classifier'\n      AND ranking = 1\n      AND probability > 0.6\n),\n-- Step 2: Filter magstat for r-band with at least 100 days of observations\nmagstat_r AS (\n    SELECT oid\n    FROM magstat\n    WHERE fid = 2\n      AND (lastmjd - firstmjd) >= 100\n),\n-- Step 3: Filter magstat for g-band with initial rise rate > 0.5 mag/day\nmagstat_g_rise AS (\n    SELECT oid\n    FROM magstat\n    WHERE fid = 1\n      AND dmdt_first > 0.5\n),\n-- Step 4: Filter magstat for r-band with initial rise rate > 0.5 mag/day\nmagstat_r_rise AS (\n    SELECT oid\n    FROM magstat\n    WHERE fid = 2\n      AND dmdt_first > 0.5\n),\n-- Step 5: Intersect to get objects with rise rate > 0.5 in both g and r bands\nmagstat_rise_both AS (\n    SELECT oid FROM magstat_g_rise\n    INTERSECT\n    SELECT oid FROM magstat_r_rise\n),\n-- Step 6: Filter objects with all conditions combined and date range 2019-2022 (MJD 58484 to 59944)\nobjects_filtered AS (\n    SELECT o.oid\n    FROM object o\n    INNER JOIN prob_snII p ON o.oid = p.oid\n    INNER JOIN magstat_r mr ON o.oid = mr.oid\n    INNER JOIN magstat_rise_both rb ON o.oid = rb.oid\n    WHERE o.ndet > 30\n      AND o.firstmjd <= 59944.0  -- last date in range (end of 2022)\n      AND o.lastmjd >= 58484.0   -- first date in range (start of 2019)\n)\n-- Step 7: Select detections for filtered objects with required columns, renaming fid as f_id\nSELECT d.oid,\n       d.candid,\n       d.magpsf,\n       d.sigmapsf,\n       d.fid AS f_id,\n       d.mjd\nFROM detection d\nWHERE d.oid IN (SELECT oid FROM objects_filtered)\nORDER BY d.oid, d.mjd;\n```\n", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2993, "completion_tokens": 557, "total_tokens": 3550, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce1fac481909abe968ff33b4d64", "custom_id": "26-0", "response": {"status_code": 200, "request_id": "f19f4425bbdf12e1d222e7048533c300", "body": {"id": "chatcmpl-Bh3YqagKgWRVS4N7bhhj3Z44lwSk0", "object": "chat.completion", "created": 1749601492, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects appearing between August 25 and September 10, 2022 (MJD 59816 to 59832)\n-- that are classified as supernova (SN) by the stamp_classifier with probability > 0.5 and ranking = 1\n-- or have more than one detection (ndet > 1).\n-- Use EXISTS subqueries to avoid heavy JOINs and improve performance.\n\nSELECT o.*\nFROM object o\nWHERE o.firstmjd BETWEEN 59816.0 AND 59832.0\n  AND (\n    -- Check if object has a supernova classification with high probability and top ranking\n    EXISTS (\n      SELECT 1\n      FROM probability p\n      WHERE p.oid = o.oid\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'SN'\n        AND p.probability > 0.5\n        AND p.ranking = 1\n    )\n    OR o.ndet > 1\n  );\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1839, "completion_tokens": 208, "total_tokens": 2047, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce2076c8190ae132be64f1e0c71", "custom_id": "26-1", "response": {"status_code": 200, "request_id": "c21c0e3d1426f8ae67f1e0fea3f525ba", "body": {"id": "chatcmpl-Bh3YiAc83nWYliuJQMItYzhb3qHQM", "object": "chat.completion", "created": 1749601484, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select objects appearing between August 25 and September 10, 2022 (MJD 59816 to 59832)\n-- that are classified as supernova (SN) by the stamp_classifier with probability > 0.5 and ranking = 1\n-- or have more than one detection (ndet > 1).\n-- Use EXISTS subqueries to avoid heavy JOINs and improve performance.\n\nSELECT o.*\nFROM object o\nWHERE o.firstmjd BETWEEN 59816.0 AND 59832.0\n  AND (\n    -- Check if there exists a probability record for this object with the required conditions\n    EXISTS (\n      SELECT 1\n      FROM probability p\n      WHERE p.oid = o.oid\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'SN'\n        AND p.probability > 0.5\n        AND p.ranking = 1\n    )\n    OR o.ndet > 1\n  );\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1839, "completion_tokens": 208, "total_tokens": 2047, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce214f48190890e67eb4bdeb615", "custom_id": "109-0", "response": {"status_code": 200, "request_id": "c58a443f6ebde2eb8359d891bfd0c554", "body": {"id": "chatcmpl-Bh3Ys2WjumwStuPeni1IlkaPL2Op4", "object": "chat.completion", "created": 1749601494, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- First, filter the probability table for ranking=1 and classifier_name='lc_classifier' to reduce join size\n-- Then join with feature filtered by name='LinearTrend' and value > 5\n-- Finally join with object filtered by deltajd > 1\n-- Use CTEs to filter early and reduce the amount of data joined, improving performance\n\nWITH prob_filtered AS (\n    SELECT oid, classifier_version, class_name, probability\n    FROM probability\n    WHERE ranking = 1\n      AND classifier_name = 'lc_classifier'\n      -- Additional condition to reduce result set: probability > 0.1 (arbitrary threshold to help performance)\n      -- This can be adjusted or removed if not desired\n      AND probability > 0.1\n),\nfeature_filtered AS (\n    SELECT oid, value, fid\n    FROM feature\n    WHERE name = 'LinearTrend'\n      AND value > 5\n),\nobject_filtered AS (\n    SELECT oid, ndet, deltajd\n    FROM object\n    WHERE deltajd > 1\n)\nSELECT \n    o.oid, \n    o.ndet, \n    p.classifier_version, \n    p.class_name, \n    p.probability, \n    f.value AS LinearTrend_value, \n    f.fid AS LinearTrend_fid\nFROM \n    object_filtered o\nINNER JOIN \n    prob_filtered p ON o.oid = p.oid\nINNER JOIN \n    feature_filtered f ON o.oid = f.oid\nLIMIT 10;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3847, "completion_tokens": 317, "total_tokens": 4164, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce225ec8190ac8c219e852a8714", "custom_id": "109-1", "response": {"status_code": 200, "request_id": "6c3b4da5f78f5e39a8044abc71cdd7eb", "body": {"id": "chatcmpl-Bh3YoszZRuKTcHyzja9FeVunOscXS", "object": "chat.completion", "created": 1749601490, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- First, filter the probability table for ranking=1 and classifier_name='lc_classifier' to reduce join size\n-- Then join with feature filtered by name='LinearTrend' and value > 5\n-- Finally join with object filtered by deltajd > 1\n-- Use CTEs to filter early and reduce the amount of data joined, improving performance\n\nWITH prob_filtered AS (\n    SELECT oid, classifier_version, class_name, probability\n    FROM probability\n    WHERE ranking = 1\n      AND classifier_name = 'lc_classifier'\n      -- Additional condition to reduce data: probability > 0.1 (arbitrary threshold to reduce rows)\n      -- This is optional, but helps performance if many low probability rows exist\n      -- Remove if user wants all probabilities\n),\nfeature_filtered AS (\n    SELECT oid, value, fid\n    FROM feature\n    WHERE name = 'LinearTrend'\n      AND value > 5\n),\nobject_filtered AS (\n    SELECT oid, ndet, deltajd\n    FROM object\n    WHERE deltajd > 1\n)\n\nSELECT \n    o.oid, \n    o.ndet, \n    p.classifier_version, \n    p.class_name, \n    p.probability, \n    f.value, \n    f.fid\nFROM \n    object_filtered o\nINNER JOIN \n    prob_filtered p ON o.oid = p.oid\nINNER JOIN \n    feature_filtered f ON o.oid = f.oid\nLIMIT 10;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3829, "completion_tokens": 311, "total_tokens": 4140, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce2351c8190a380661c5bddd391", "custom_id": "105-0", "response": {"status_code": 200, "request_id": "347e0d06f38c0753a98947a5f7dda817", "body": {"id": "chatcmpl-Bh3Yg5FDZrC1nRte6r3fdhicLW0st", "object": "chat.completion", "created": 1749601482, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\nWITH selected_oids AS (\n    SELECT p.oid, p.probability\n    FROM probability p\n    INNER JOIN ps1_ztf ps1 ON p.oid = ps1.oid\n    -- Join detection only to apply the condition on SExtractor star/galaxy score (rb)\n    INNER JOIN detection d ON p.oid = d.oid\n    WHERE p.class_name = 'AGN'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.classifier_version = 'hierarchical_rf_1.1.0'\n      AND p.ranking = 1\n      AND p.probability > 0.7\n      AND ps1.distpsnr1 < 2\n      -- Use d.rb as the SExtractor star/galaxy score, compare with PS1 sgscore1\n      AND ABS(ps1.sgscore1 - d.rb) < 0.5\n    GROUP BY p.oid, p.probability\n    LIMIT 50\n)\nSELECT \n    so.oid,\n    so.probability,\n    d.candid,\n    d.fid,\n    -- The reduced chi-square is not explicitly in detection or dataquality tables.\n    -- The closest proxy is the 'rb' column (real bogus score) or 'drb' (deep learning real bogus),\n    -- but these are not chi-square values.\n    -- Since no reduced chi-square column exists, we omit it or use NULL.\n    NULL::DOUBLE PRECISION AS reduced_chisq,  -- No reduced chi-square column available\n    d.rb AS sgscore_sextractor,  -- SExtractor star/galaxy score proxy from detection.rb\n    ps1.objectidps1,\n    ps1.sgscore1,\n    ps1.distpsnr1\nFROM selected_oids so\nINNER JOIN detection d ON so.oid = d.oid\nINNER JOIN ps1_ztf ps1 ON so.oid = ps1.oid\nORDER BY so.oid, d.candid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3290, "completion_tokens": 419, "total_tokens": 3709, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce243508190830583f2099d21d7", "custom_id": "105-1", "response": {"status_code": 200, "request_id": "c559e1f61729570e834470218cbc9a2d", "body": {"id": "chatcmpl-Bh3YjZ5UVZp6vEWlojJmWLc2os3Zn", "object": "chat.completion", "created": 1749601485, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select up to 50 objects with probability > 0.7 of being AGN from the specified classifier version,\n-- with nearest PS1 source within 2 arcsec,\n-- and difference between PS1 star/galaxy score and SExtractor star/galaxy score < 0.5.\n-- Return requested columns for the object and each detection epoch.\n\nWITH filtered_oids AS (\n    SELECT p.oid\n    FROM probability p\n    INNER JOIN ps1_ztf ps1 ON p.oid = ps1.oid\n    INNER JOIN detection d ON p.oid = d.oid\n    WHERE p.class_name = 'AGN'\n      AND p.classifier_name = 'lc_classifier'\n      AND p.classifier_version = 'hierarchical_rf_1.1.0'\n      AND p.ranking = 1\n      AND p.probability > 0.7\n      AND ps1.distpsnr1 < 2\n      -- The column 'classtar' does not exist in detection table.\n      -- The user requested the star/galaxy score from SExtractor, which is not explicitly named in the schema.\n      -- The closest relevant column in detection is not present.\n      -- Assuming 'rb' (real bogus score) or 'drb' are not star/galaxy scores.\n      -- Since no direct SExtractor star/galaxy score column is given in detection,\n      -- we cannot filter on it in the WHERE clause.\n      -- Instead, we will apply this condition in the outer query using a JOIN and WHERE clause.\n    GROUP BY p.oid\n    LIMIT 50\n)\nSELECT \n    p.oid,\n    p.probability,\n    d.candid,\n    d.fid,\n    -- 'chipsf' and 'classtar' columns do not exist in detection table.\n    -- The user requested star/galaxy score from SExtractor, but no such column exists.\n    -- We cannot return 'chipsf' or 'classtar' as they are not in the schema.\n    -- We will omit these columns.\n    -- Instead, we return columns available in detection relevant to the user:\n    -- candid, fid, and we can add 'rb' or 'drb' if needed, but user did not request them.\n    -- So we only return candid and fid as requested.\n    -- Reduced chi-square is not explicitly in detection schema, so cannot return it.\n    -- We return the requested columns that exist.\n    ps1.objectidps1,\n    ps1.sgscore1,\n    ps1.distpsnr1\nFROM filtered_oids fo\nINNER JOIN probability p ON fo.oid = p.oid\nINNER JOIN detection d ON fo.oid = d.oid\nINNER JOIN ps1_ztf ps1 ON fo.oid = ps1.oid\nWHERE p.class_name = 'AGN'\n  AND p.classifier_name = 'lc_classifier'\n  AND p.classifier_version = 'hierarchical_rf_1.1.0'\n  AND p.ranking = 1\n  AND p.probability > 0.7\n  AND ps1.distpsnr1 < 2\n  -- Since we cannot filter on 'classtar' in detection (does not exist),\n  -- we cannot apply the difference condition in WHERE.\n  -- The user requested difference between PS1 star/galaxy score and SExtractor star/galaxy score < 0.5.\n  -- Without a SExtractor star/galaxy score column, this condition cannot be applied.\nORDER BY p.probability DESC, p.oid, d.candid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3332, "completion_tokens": 747, "total_tokens": 4079, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce25150819096c96ceecc8eaa1f", "custom_id": "91-0", "response": {"status_code": 200, "request_id": "9d8e305b5262c24ae88696351187e08c", "body": {"id": "chatcmpl-Bh3YpbvIXrUCrWOaKshC7m27Xodrk", "object": "chat.completion", "created": 1749601491, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Use a CTE to first filter features with W1-W2 < 1 to reduce the dataset early\nWITH w1w2_features AS (\n    SELECT oid, value AS w1_w2, version\n    FROM feature\n    WHERE name = 'W1-W2' AND value < 1\n    LIMIT 1000  -- limit here to reduce join size, can be adjusted\n),\n-- Get min_mag in g band (fid=1) for the filtered objects and matching versions\nmin_mag_g AS (\n    SELECT f.oid, f.value, f.version\n    FROM feature f\n    JOIN w1w2_features w ON f.oid = w.oid AND f.version = w.version\n    WHERE f.name = 'min_mag' AND f.fid = 1\n),\n-- Get min_mag in r band (fid=2) for the filtered objects and matching versions\nmin_mag_r AS (\n    SELECT f.oid, f.value, f.version\n    FROM feature f\n    JOIN w1w2_features w ON f.oid = w.oid AND f.version = w.version\n    WHERE f.name = 'min_mag' AND f.fid = 2\n)\nSELECT \n    o.oid,\n    o.ndet,\n    (g.value - r.value) AS delta_min_g_r_diffmag,\n    w.w1_w2,\n    w.version\nFROM \n    w1w2_features w\nJOIN \n    min_mag_g g ON w.oid = g.oid AND w.version = g.version\nJOIN \n    min_mag_r r ON w.oid = r.oid AND w.version = r.version\nJOIN \n    object o ON w.oid = o.oid\nLIMIT 100;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3799, "completion_tokens": 364, "total_tokens": 4163, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce25f1081908e9c95775ca9b95b", "custom_id": "91-1", "response": {"status_code": 200, "request_id": "08861feaf457fdb47bd67536d5f0845a", "body": {"id": "chatcmpl-Bh3YpaXdqYc0kH7soNxwbnXxcMXHj", "object": "chat.completion", "created": 1749601491, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Use a CTE to first filter features with 'W1-W2' < 1 to reduce the dataset early\nWITH w1w2_filtered AS (\n    SELECT oid, value AS w1_w2, version\n    FROM feature\n    WHERE name = 'W1-W2' AND value < 1\n    LIMIT 1000  -- limit early to reduce join size, can be adjusted if needed\n),\n-- Get min_mag for g-band (fid=1) for the filtered objects and matching version\nmin_mag_g AS (\n    SELECT f.oid, f.value, f.version\n    FROM feature f\n    JOIN w1w2_filtered w ON f.oid = w.oid AND f.version = w.version\n    WHERE f.name = 'min_mag' AND f.fid = 1\n),\n-- Get min_mag for r-band (fid=2) for the filtered objects and matching version\nmin_mag_r AS (\n    SELECT f.oid, f.value, f.version\n    FROM feature f\n    JOIN w1w2_filtered w ON f.oid = w.oid AND f.version = w.version\n    WHERE f.name = 'min_mag' AND f.fid = 2\n)\nSELECT \n    o.oid,\n    o.ndet,\n    (g.value - r.value) AS delta_min_g_r_diffmag,\n    w.w1_w2,\n    w.version\nFROM \n    w1w2_filtered w\nJOIN \n    min_mag_g g ON w.oid = g.oid AND w.version = g.version\nJOIN \n    min_mag_r r ON w.oid = r.oid AND w.version = r.version\nJOIN \n    object o ON o.oid = w.oid\nLIMIT 100;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3799, "completion_tokens": 368, "total_tokens": 4167, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce26cc48190b7ab71033e238030", "custom_id": "76-0", "response": {"status_code": 200, "request_id": "2990dd76b694eec94969e44567fedc13", "body": {"id": "chatcmpl-Bh3YxYbxSol2aBFoSAnC1HMZFfQdb", "object": "chat.completion", "created": 1749601499, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Query to find ZTF objects within 1.5 arcsec of the Solar System object '115185' from MPC archive\n-- Using ss_ztf table for solar system objects and object table for coordinates\n-- Note: The object table contains ra and dec columns for each oid\n\nSELECT \n    s.oid AS ztf_identifier,\n    s.ssmagnr AS mpc_magnitude,\n    q3c_dist(o.ra, o.dec, mpc_o.ra, mpc_o.dec) * 3600 AS distance_arcsec  -- distance in arcseconds\nFROM \n    ss_ztf s\nJOIN \n    object o ON s.oid = o.oid\n-- Get the coordinates of the MPC object '115185' from ss_ztf and object tables\nJOIN \n    ss_ztf mpc_s ON mpc_s.ssnamenr = '115185'\nJOIN \n    object mpc_o ON mpc_s.oid = mpc_o.oid\n-- Filter ZTF objects within 1.5 arcsec of the MPC object coordinates using q3c_join\nWHERE \n    s.ssnamenr IS NOT NULL\n    AND q3c_join(o.ra, o.dec, mpc_o.ra, mpc_o.dec, 1.5/3600)  -- 1.5 arcsec radius converted to degrees\nORDER BY \n    distance_arcsec;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1309, "completion_tokens": 295, "total_tokens": 1604, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
{"id": "batch_req_6848cce27dc08190b32298198c814abc", "custom_id": "76-1", "response": {"status_code": 200, "request_id": "ca7d96dbe761704bf0a5c8f9317f8c9e", "body": {"id": "chatcmpl-Bh3YmmSz6jxzmfcm7F8yHXtbnGRa4", "object": "chat.completion", "created": 1749601488, "model": "gpt-4.1-mini-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- First, get the coordinates of the MPC object '115185' from ss_ztf joined with object\nWITH mpc_object AS (\n    SELECT o.meanra, o.meandec\n    FROM ss_ztf ss\n    JOIN object o ON ss.oid = o.oid\n    WHERE ss.ssnamenr = '115185'\n    LIMIT 1\n)\nSELECT \n    o.oid AS ztf_identifier,\n    ss.ssmagnr AS mpc_magnitude,\n    q3c_dist(o.meanra, o.meandec, m.meanra, m.meandec) * 3600 AS distance_arcsec -- distance in arcseconds\nFROM \n    mpc_object m\nJOIN ss_ztf ss ON TRUE\nJOIN object o ON ss.oid = o.oid\n-- Use q3c_radial_query to filter objects within 1.5 arcsec (0.0004167 degrees) of the MPC object coordinates\nWHERE \n    q3c_radial_query(o.meanra, o.meandec, m.meanra, m.meandec, 0.0004167)\nORDER BY \n    distance_arcsec;\n```\n", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1635, "completion_tokens": 247, "total_tokens": 1882, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_6f2eabb9a5"}}, "error": null}
