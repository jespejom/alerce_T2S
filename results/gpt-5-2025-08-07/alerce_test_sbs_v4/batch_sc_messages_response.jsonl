{"id": "batch_req_68f72a9c4ec481909661844a4ae48af8", "custom_id": "16-0", "response": {"status_code": 200, "request_id": "da1f76f5e1f3edff09271444bbdf7a9d", "body": {"id": "chatcmpl-CSzxx7UKcBghsOrmENn5PMF8b6NJB", "object": "chat.completion", "created": 1761027417, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "", "refusal": null, "annotations": []}, "finish_reason": "length"}], "usage": {"prompt_tokens": 2330, "completion_tokens": 4000, "total_tokens": 6330, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 4000, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c508c819084548a42573dd8e8", "custom_id": "16-1", "response": {"status_code": 200, "request_id": "ff5a1d7abadd0d725fc9af1b2c90fb5f", "body": {"id": "chatcmpl-CT04n9qebbL3bHXIYB3fkAzn6clnY", "object": "chat.completion", "created": 1761027841, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "", "refusal": null, "annotations": []}, "finish_reason": "length"}], "usage": {"prompt_tokens": 2330, "completion_tokens": 4000, "total_tokens": 6330, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 4000, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c4c8881909d791ce316b159f0", "custom_id": "16-2", "response": {"status_code": 200, "request_id": "1879c033e95342e6bfbc5fe1cd3fee5b", "body": {"id": "chatcmpl-CSzxywrFvUBuKl3GNZLEkdVSXZi5p", "object": "chat.completion", "created": 1761027418, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "", "refusal": null, "annotations": []}, "finish_reason": "length"}], "usage": {"prompt_tokens": 1795, "completion_tokens": 4000, "total_tokens": 5795, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 4000, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c4f34819082cc417f125bf3a0", "custom_id": "16-3", "response": {"status_code": 200, "request_id": "f02cd8019967f34b4ebdc34cd3e882cc", "body": {"id": "chatcmpl-CSzyXWq1b3dFwWiV3nzde2EyoeSKu", "object": "chat.completion", "created": 1761027453, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Objects with highest-probability SN class in the stamp classifier,\n-- first detection during Sep 1\u20132 (any year; converted from MJD),\n-- and \"fast risers\" as indicated by a high initial rise rate (dmdt_first).\n-- Returns: oid, stamp-classifier probability, non-detection filter (fid) and diffmaglim,\n-- magstat filter as magstat_fid, and initial rise estimate (dmdt_first).\n-- Note:\n-- - Assumes stamp classifier is identified as classifier_name = 'stamp_classifier'.\n-- - \"Fast riser\" is approximated as dmdt_first >= 1.0 mag/day (adjust as needed).\n-- - \"Image difference\" is interpreted as the non-detection 5-sigma limit (diffmaglim).\n\nWITH stamp_best AS (\n  SELECT DISTINCT ON (p.oid)\n    p.oid,\n    p.probability AS stamp_probability\n  FROM probability p\n  WHERE p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n  ORDER BY p.oid, p.probability DESC\n)\nSELECT\n  o.oid,\n  sb.stamp_probability,\n  nd.fid AS fid,\n  nd.diffmaglim AS diffmaglim,\n  m.fid AS magstat_fid,\n  m.dmdt_first AS initial_rise_estimate\nFROM object o\nJOIN stamp_best sb ON sb.oid = o.oid\nJOIN magstat m ON m.oid = o.oid\nJOIN non_detection nd ON nd.oid = o.oid\nWHERE\n  EXTRACT(MONTH FROM (timestamp '1970-01-01' + (o.firstmjd - 40587) * interval '1 day')) = 9\n  AND EXTRACT(DAY FROM (timestamp '1970-01-01' + (o.firstmjd - 40587) * interval '1 day')) BETWEEN 1 AND 2\n  AND m.dmdt_first IS NOT NULL\n  AND m.dmdt_first >= 1.0\nORDER BY o.oid\nLIMIT 100;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1795, "completion_tokens": 3468, "total_tokens": 5263, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 3008, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c5bdc8190a1528c6cd2571d95", "custom_id": "16-4", "response": {"status_code": 200, "request_id": "22e0e95038c7c153099f737d4b91e4e9", "body": {"id": "chatcmpl-CSzyq2MMy3ZuiGRao30HgqMMPc9Y8", "object": "chat.completion", "created": 1761027472, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Get objects whose top-ranked (ranking=1) stamp_classifier class is SN,\n-- whose first detection occurred on Sep 1st or 2nd (any year; firstmjd converted from MJD),\n-- and that qualify as \"fast risers\" (here approximated as magstat.dmdt_first >= 1.0 mag/day).\n-- Return: oid, stamp-classifier probability, non-detection light-curve points (fid, mjd, diffmaglim),\n-- magstat fid (as magstat_fid) and the initial rise estimate (dmdt_first).\n-- Note: For non-detections there is no isdiffpos; we include diffmaglim (5-sigma limit in the difference image)\n-- as the \"image difference\" metric relevant to non-detection epochs.\n\nWITH stamp_sn AS (\n  SELECT\n    p.oid,\n    p.probability\n  FROM probability AS p\n  WHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n)\nSELECT\n  o.oid,\n  s.probability AS stamp_sn_probability,\n  nd.fid AS non_det_fid,\n  nd.mjd AS non_det_mjd,\n  nd.diffmaglim AS image_diff_limit,\n  ms.fid AS magstat_fid,\n  ms.dmdt_first AS initial_rise_estimate\nFROM object AS o\nJOIN stamp_sn AS s\n  ON s.oid = o.oid\nJOIN magstat AS ms\n  ON ms.oid = o.oid\nJOIN non_detection AS nd\n  ON nd.oid = o.oid\nWHERE\n  -- Convert MJD to timestamp: TS = '1858-11-17' + firstmjd days\n  EXTRACT(MONTH FROM (TIMESTAMP '1858-11-17' + (o.firstmjd::text || ' days')::interval)) = 9\n  AND EXTRACT(DAY FROM (TIMESTAMP '1858-11-17' + (o.firstmjd::text || ' days')::interval)) IN (1, 2)\n  -- Fast-riser criterion using magstat's initial rise rate estimate\n  AND ms.dmdt_first IS NOT NULL\n  AND ms.dmdt_first >= 1.0\nORDER BY o.oid\nLIMIT 100;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2330, "completion_tokens": 3387, "total_tokens": 5717, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2880, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c4bd881908c71ec29f36290c4", "custom_id": "19-0", "response": {"status_code": 200, "request_id": "f1ce0dae6ae5430702544e0b607cce1c", "body": {"id": "chatcmpl-CSzzNEdm8AZFjoRqLwT9JZPsORcNP", "object": "chat.completion", "created": 1761027505, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Objects that first appeared between 2021-03-01 and 2021-04-01 (MJD in [59274.0, 59305.0))\n-- With at most one detection (ndet <= 1)\n-- Classified as 'asteroid' by the stamp classifier with probability > 0.7\n-- Optimizations:\n-- 1) Filter objects first to reduce the working set.\n-- 2) Use a LATERAL subquery keyed by oid so PostgreSQL can leverage the probability PK (starting with oid).\n-- 3) Enforce ranking = 1 on probability to reduce rows and follow ALeRCE best practices.\n-- 4) LIMIT 1 per oid to avoid duplicates across classifier versions and pick the highest probability.\n\nWITH objs AS (\n  SELECT\n    oid,\n    meanra,\n    meandec,\n    ndet,\n    firstmjd\n  FROM object\n  WHERE\n    firstmjd >= 59274.0\n    AND firstmjd < 59305.0\n    AND ndet <= 1\n)\nSELECT\n  o.oid,\n  o.meanra,\n  o.meandec,\n  o.ndet,\n  o.firstmjd,\n  p.class_name,\n  p.probability\nFROM objs AS o\nJOIN LATERAL (\n  SELECT\n    pr.class_name,\n    pr.probability\n  FROM probability AS pr\n  WHERE\n    pr.oid = o.oid\n    AND pr.classifier_name = 'stamp_classifier'\n    AND pr.class_name = 'asteroid'\n    AND pr.ranking = 1\n    AND pr.probability > 0.7\n  ORDER BY pr.probability DESC\n  LIMIT 1\n) AS p ON TRUE;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1586, "completion_tokens": 2554, "total_tokens": 4140, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2176, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c4e1c819091c36c26f06c155f", "custom_id": "57-0", "response": {"status_code": 200, "request_id": "0de0df74698e5941ee668114d79329f9", "body": {"id": "chatcmpl-CSzzaUQ7MrnwnCktrBmcosXKR7gTe", "object": "chat.completion", "created": 1761027518, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Optimized query: run two independent Q3C cone searches and UNION ALL the results\n-- This avoids the lateral join against a CTE that may inhibit index usage and cause timeouts.\n-- It returns, for each matched ZTF object, the requested input info (identifier, coordinates, search radius in degrees)\n-- and the output object info (ZTF oid, number of detections, mean RA/Dec, first detection date),\n-- sorted by the last detection date in descending order.\n\nSELECT\n    s.identifier,      -- input object identifier\n    s.ra,              -- input RA (deg)\n    s.dec,             -- input Dec (deg)\n    s.radius_deg,      -- search radius used (deg)\n    s.oid,             -- matched ZTF object identifier\n    s.ndet,            -- number of detections\n    s.meanra,          -- mean RA (deg)\n    s.meandec,         -- mean Dec (deg)\n    s.firstmjd         -- first detection date (MJD)\nFROM (\n    -- Cone search around id_1: 30 arcsec = 30/3600 deg\n    SELECT\n        'id_1'::text AS identifier,\n        354.67::double precision AS ra,\n        15.954::double precision AS dec,\n        (30.0/3600.0)::double precision AS radius_deg,\n        o.oid,\n        o.ndet,\n        o.meanra,\n        o.meandec,\n        o.firstmjd,\n        o.lastmjd\n    FROM object o\n    WHERE q3c_radial_query(\n        o.meanra, o.meandec,\n        354.67::double precision, 15.954::double precision,\n        (30.0/3600.0)::double precision\n    )\n\n    UNION ALL\n\n    -- Cone search around id_2: 20 arcsec = 20/3600 deg\n    SELECT\n        'id_2'::text AS identifier,\n        20.7993::double precision AS ra,\n        1.00331::double precision AS dec,\n        (20.0/3600.0)::double precision AS radius_deg,\n        o.oid,\n        o.ndet,\n        o.meanra,\n        o.meandec,\n        o.firstmjd,\n        o.lastmjd\n    FROM object o\n    WHERE q3c_radial_query(\n        o.meanra, o.meandec,\n        20.7993::double precision, 1.00331::double precision,\n        (20.0/3600.0)::double precision\n    )\n) s\nORDER BY s.lastmjd DESC;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1544, "completion_tokens": 2425, "total_tokens": 3969, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 1856, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c4a2881908ad0957de36afa35", "custom_id": "57-1", "response": {"status_code": 200, "request_id": "c6a4b3a7832b3a24da5e3a14ec4ec965", "body": {"id": "chatcmpl-CSzzoTQEY4OPSjFsHpfGtnLPndLwa", "object": "chat.completion", "created": 1761027532, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Optimized spatial search using two constant-radius queries so Q3C can leverage its spatial index.\n-- Each region is computed separately (constants in q3c_radial_query), then combined and sorted by last detection date.\nWITH region1 AS (\n    SELECT\n        'id_1'::text AS identifier,                 -- input object identifier\n        354.67::double precision AS ra,             -- input RA (deg)\n        15.954::double precision AS dec,            -- input Dec (deg)\n        (30.0/3600.0)::double precision AS radius_deg, -- search radius (deg)\n        o.oid,\n        o.ndet,\n        o.meanra,\n        o.meandec,\n        o.firstmjd,\n        o.lastmjd\n    FROM object o\n    WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n),\nregion2 AS (\n    SELECT\n        'id_2'::text AS identifier,                 -- input object identifier\n        20.7993::double precision AS ra,            -- input RA (deg)\n        1.00331::double precision AS dec,           -- input Dec (deg)\n        (20.0/3600.0)::double precision AS radius_deg, -- search radius (deg)\n        o.oid,\n        o.ndet,\n        o.meanra,\n        o.meandec,\n        o.firstmjd,\n        o.lastmjd\n    FROM object o\n    WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0)\n)\nSELECT\n    u.identifier,       -- input object id (id_1 or id_2)\n    u.ra,               -- input RA (deg)\n    u.dec,              -- input Dec (deg)\n    u.radius_deg,       -- search radius used (deg)\n    u.oid,              -- ZTF object identifier\n    u.ndet,             -- number of detections\n    u.meanra,           -- mean RA (deg)\n    u.meandec,          -- mean Dec (deg)\n    u.firstmjd          -- first detection date (MJD)\nFROM (\n    SELECT * FROM region1\n    UNION ALL\n    SELECT * FROM region2\n) AS u\nORDER BY u.lastmjd DESC;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1535, "completion_tokens": 2639, "total_tokens": 4174, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2112, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c4da48190820ef2345c6b88c4", "custom_id": "57-2", "response": {"status_code": 200, "request_id": "cd209b1fe3c34a36cc2b0fde0f216694", "body": {"id": "chatcmpl-CSzzvE3KV8ebxqRabupr68JPxpmIo", "object": "chat.completion", "created": 1761027539, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "/* Optimized cone search using two separate Q3C predicates to help the planner use spatial indexes.\n   We UNION ALL the two small result sets and sort by last detection date (lastmjd) descending.\n   We return the requested input metadata and matched ZTF object info, excluding lastmjd from the output but using it for ordering. */\n\nWITH s1 AS (\n    SELECT\n        'id_1'::text AS identifier,                    -- input identifier\n        354.67::double precision AS ra,               -- input RA (deg)\n        15.954::double precision AS dec,              -- input Dec (deg)\n        (30.0/3600.0)::double precision AS radius_deg, -- 30 arcsec in degrees\n        o.oid,\n        o.ndet,\n        o.meanra,\n        o.meandec,\n        o.firstmjd,\n        o.lastmjd\n    FROM object o\n    WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n),\ns2 AS (\n    SELECT\n        'id_2'::text AS identifier,                    -- input identifier\n        20.7993::double precision AS ra,              -- input RA (deg)\n        1.00331::double precision AS dec,             -- input Dec (deg)\n        (20.0/3600.0)::double precision AS radius_deg, -- 20 arcsec in degrees\n        o.oid,\n        o.ndet,\n        o.meanra,\n        o.meandec,\n        o.firstmjd,\n        o.lastmjd\n    FROM object o\n    WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0)\n),\nall_matches AS (\n    SELECT * FROM s1\n    UNION ALL\n    SELECT * FROM s2\n)\nSELECT\n    identifier,\n    ra,\n    dec,\n    radius_deg,\n    oid,\n    ndet,\n    meanra,\n    meandec,\n    firstmjd\nFROM all_matches\nORDER BY lastmjd DESC;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1503, "completion_tokens": 2523, "total_tokens": 4026, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2048, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c6064819095d9fe7f9fe170ed", "custom_id": "57-3", "response": {"status_code": 200, "request_id": "b595b25738467d538b7e1fa5e38ff20a", "body": {"id": "chatcmpl-CT00CSh72bAjFjcjGPUHWYjHSkKWr", "object": "chat.completion", "created": 1761027556, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Optimized query: use two indexed q3c radial searches with constants (avoids a broad join on VALUES)\n-- Returns, per match: input identifier, input coordinates, search radius (deg),\n-- and matched ZTF object info. Results sorted by last detection date (lastmjd) desc.\n\nWITH matches AS (\n    -- Cone around id_1: (RA, Dec) = (354.67, 15.954) deg, radius = 30\"\n    SELECT\n        'id_1'::text AS identifier,\n        354.67::double precision AS ra,\n        15.954::double precision AS dec,\n        (30.0/3600.0)::double precision AS radius_deg,\n        o.oid,\n        o.ndet,\n        o.meanra,\n        o.meandec,\n        o.firstmjd,\n        o.lastmjd\n    FROM object o\n    WHERE q3c_radial_query(o.meanra, o.meandec, 354.67::double precision, 15.954::double precision, (30.0/3600.0)::double precision)\n\n    UNION ALL\n\n    -- Cone around id_2: (RA, Dec) = (20.7993, 1.00331) deg, radius = 20\"\n    SELECT\n        'id_2'::text AS identifier,\n        20.7993::double precision AS ra,\n        1.00331::double precision AS dec,\n        (20.0/3600.0)::double precision AS radius_deg,\n        o.oid,\n        o.ndet,\n        o.meanra,\n        o.meandec,\n        o.firstmjd,\n        o.lastmjd\n    FROM object o\n    WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993::double precision, 1.00331::double precision, (20.0/3600.0)::double precision)\n)\n\nSELECT\n    m.identifier,\n    m.ra,\n    m.dec,\n    m.radius_deg,\n    m.oid,\n    m.ndet,\n    m.meanra,\n    m.meandec,\n    m.firstmjd\nFROM matches m\nORDER BY m.lastmjd DESC;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1580, "completion_tokens": 2016, "total_tokens": 3596, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 1536, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c84dc819087a3e1dbcf3ecfb9", "custom_id": "57-4", "response": {"status_code": 200, "request_id": "ce6ab1149c4ccbdfb10390794db7af5f", "body": {"id": "chatcmpl-CT00TYfLhJywrZoLzHC00n9hCj9kt", "object": "chat.completion", "created": 1761027573, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Optimized cone search using two separate Q3C-index-friendly WHERE clauses and a UNION ALL.\n-- This avoids an optimization fence and ensures the spatial index on object(meanra, meandec) is used.\n-- Returns, per input object: identifier, input coordinates, search radius (deg),\n-- and per matched ZTF object: oid, ndet, meanra, meandec, firstmjd.\n-- Sorted by the ZTF object's last detection date (lastmjd) in descending order.\n\nSELECT\n  r.identifier,       -- input object identifier\n  r.ra,               -- input RA (deg)\n  r.dec,              -- input Dec (deg)\n  r.radius_deg,       -- search radius used (deg)\n  r.oid AS ztf_oid,   -- ZTF object identifier\n  r.ndet,             -- number of detections\n  r.meanra,           -- mean RA (deg)\n  r.meandec,          -- mean Dec (deg)\n  r.firstmjd          -- first detection date (MJD)\nFROM (\n  SELECT\n    'id_1'::text AS identifier,\n    354.67::double precision AS ra,\n    15.954::double precision AS dec,\n    (30.0/3600.0)::double precision AS radius_deg,\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd,\n    o.lastmjd\n  FROM object AS o\n  WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n\n  UNION ALL\n\n  SELECT\n    'id_2'::text AS identifier,\n    20.7993::double precision AS ra,\n    1.00331::double precision AS dec,\n    (20.0/3600.0)::double precision AS radius_deg,\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd,\n    o.lastmjd\n  FROM object AS o\n  WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0)\n) AS r\nORDER BY r.lastmjd DESC;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1496, "completion_tokens": 3322, "total_tokens": 4818, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2816, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c81f081909c0d8c1c89dbb246", "custom_id": "89-0", "response": {"status_code": 200, "request_id": "7578c9cedea175a48a43c6b36c6fea59", "body": {"id": "chatcmpl-CT00hMDdvA0d64SsOMoCSDUXjUCvi", "object": "chat.completion", "created": 1761027587, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Get the top 50 ZTF oids (by highest probability) that the stamp classifier ranked as SN with probability > 0.7\n-- Materialize the small list of oids first to avoid scanning/joining the large dataquality table unnecessarily\nWITH top_oids AS MATERIALIZED (\n  SELECT\n    p.oid\n  FROM probability AS p\n  WHERE\n    p.classifier_name = 'stamp_classifier'  -- use the stamp classifier\n    AND p.class_name = 'SN'                 -- supernova class\n    AND p.ranking = 1                       -- most likely class per classifier\n    AND p.probability > 0.7                 -- probability threshold\n    AND p.oid LIKE 'ZTF%'                   -- ensure ZTF objects\n  GROUP BY p.oid\n  ORDER BY MAX(p.probability) DESC, p.oid\n  LIMIT 50\n)\n-- Return all columns from dataquality for those oids\nSELECT dq.*\nFROM dataquality AS dq\nJOIN top_oids AS t\n  ON dq.oid = t.oid;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2073, "completion_tokens": 3242, "total_tokens": 5315, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 3008, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c7cf88190b353c2e5e30f434c", "custom_id": "89-1", "response": {"status_code": 200, "request_id": "c936313b0a0c262cbd98efbb68071feb", "body": {"id": "chatcmpl-CT00zhnAlufgLIqWk1y9ZhNAabQR0", "object": "chat.completion", "created": 1761027605, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Get all columns from dataquality for at most 50 distinct ZTF objects\n-- whose most likely class (ranking = 1) in the stamp classifier is SN with probability > 0.7.\n-- Optimize by:\n--  1) Selecting the best (highest-probability) SN row per oid using DISTINCT ON,\n--  2) Ordering those per-oid maxima by probability and limiting to 50 oids,\n--  3) Joining the small list of oids to dataquality.\nSELECT dq.*\nFROM dataquality AS dq\nJOIN (\n  SELECT oid\n  FROM (\n    SELECT DISTINCT ON (p.oid)\n           p.oid,\n           p.probability AS prob_sn\n    FROM probability AS p\n    WHERE p.classifier_name = 'stamp_classifier'  -- classifier constraint\n      AND p.class_name = 'SN'                      -- class constraint\n      AND p.ranking = 1                            -- most likely class\n      AND p.probability > 0.7                      -- probability threshold\n      AND p.oid LIKE 'ZTF%'                        -- restrict to ZTF objects\n    ORDER BY p.oid, p.probability DESC             -- keep highest prob per oid\n  ) AS per_oid_max\n  ORDER BY prob_sn DESC\n  LIMIT 50\n) AS top50\n  ON dq.oid = top50.oid;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1940, "completion_tokens": 2278, "total_tokens": 4218, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 1984, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c86d0819097ad65381682b0ea", "custom_id": "89-2", "response": {"status_code": 200, "request_id": "23c2441ea850777c29de616abe4068f0", "body": {"id": "chatcmpl-CT01Fh9IYRNRzYKW3FZpFlXjhAyj5", "object": "chat.completion", "created": 1761027621, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Goal: Return all rows from dataquality for up to 50 ZTF objects\n-- whose stamp classifier assigns class 'SN' with probability > 0.7 and ranking=1.\n-- Optimization:\n--  - Restrict to ZTF objects (oid LIKE 'ZTF%') as requested.\n--  - Use DISTINCT ON to pick the highest-probability version per oid efficiently.\n--  - Order by that probability and limit to 50 oids before joining to dataquality.\n\nWITH best_per_oid AS (\n  SELECT DISTINCT ON (p.oid)\n         p.oid,\n         p.probability\n  FROM probability p\n  WHERE p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND p.probability > 0.7\n    AND p.oid LIKE 'ZTF%'         -- only ZTF objects\n  ORDER BY p.oid, p.probability DESC\n),\ntop_oids AS (\n  SELECT b.oid\n  FROM best_per_oid b\n  ORDER BY b.probability DESC\n  LIMIT 50\n)\nSELECT d.*\nFROM dataquality d\nJOIN top_oids t\n  ON d.oid = t.oid;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1881, "completion_tokens": 1549, "total_tokens": 3430, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 1280, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c8f2081909d2b0ab70512a228", "custom_id": "89-3", "response": {"status_code": 200, "request_id": "729e5b16a03cf4e1cc48ee31e5957186", "body": {"id": "chatcmpl-CT01QazHI9wDhHLpFP6LF7waLwnfF", "object": "chat.completion", "created": 1761027632, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Return all dataquality rows for up to 50 ZTF objects with P(SN | stamp_classifier, ranking=1) > 0.7\n-- Optimization notes:\n--  - Use a deduplicated list of oids via GROUP BY (hash aggregate) without ORDER BY to avoid large sorts.\n--  - Apply LIMIT 50 on the oid list before joining, to restrict the join to a small set.\nSELECT dq.*\nFROM dataquality dq\nWHERE dq.oid IN (\n  SELECT p.oid\n  FROM probability p\n  WHERE p.classifier_name = 'stamp_classifier'  -- classifier constraint\n    AND p.class_name = 'SN'                      -- supernova class\n    AND p.ranking = 1                            -- only the top-ranked class per classifier/version\n    AND p.probability > 0.7                      -- probability threshold\n    AND p.oid LIKE 'ZTF%'                        -- only ZTF objects\n  GROUP BY p.oid\n  LIMIT 50\n);", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1968, "completion_tokens": 2968, "total_tokens": 4936, "prompt_tokens_details": {"cached_tokens": 1152, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2752, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c896481909ff58c9e28cc93b5", "custom_id": "89-4", "response": {"status_code": 200, "request_id": "d72d5d5381487345cda65728a87278e0", "body": {"id": "chatcmpl-CT01U07Oag9U5WPNCm4SDQ0huxdLG", "object": "chat.completion", "created": 1761027636, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "WITH top_oids AS MATERIALIZED (\n    -- 1) Early-filter OIDs in the probability table using strict conditions (including ranking=1)\n    --    and limit to at most 50 ZTF objects to avoid scanning large tables unnecessarily.\n    SELECT DISTINCT p.oid\n    FROM probability p\n    WHERE p.classifier_name = 'stamp_classifier'  -- stamp classifier\n      AND p.class_name = 'SN'                     -- supernovae class\n      AND p.ranking = 1                           -- best-ranked class per classifier/version\n      AND p.probability > 0.7                     -- P(SN) > 0.7\n      AND p.oid LIKE 'ZTF%'                       -- ZTF objects only\n    LIMIT 50\n)\n-- 2) Return all per-detection dataquality rows for the selected objects.\n--    No ORDER BY to avoid unnecessary sorts.\nSELECT dq.*\nFROM dataquality dq\nJOIN top_oids t\n  ON t.oid = dq.oid;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2131, "completion_tokens": 3289, "total_tokens": 5420, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 3072, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c82cc81908ddda1e791556093", "custom_id": "92-0", "response": {"status_code": 200, "request_id": "cbdd0871838dffde0689e372d11df3d1", "body": {"id": "chatcmpl-CT027E3SOGEjO1ZSqJDnCLZmfnJ31", "object": "chat.completion", "created": 1761027675, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Find up to 500 ZTF objects (ordered by oid) with >=10 detections in g band (fid=1)\n-- and no dubious points in that filter (ndubious=0). Then, for each oid, fetch\n-- only the ranking=1 probability from the light curve classifier, preferring one\n-- row per oid via a LATERAL subquery to avoid scanning the whole probability table.\n-- This pre-limits eligible oids before joining to probability to prevent timeouts.\n\nWITH eligible AS (\n  SELECT DISTINCT m.oid\n  FROM magstat m\n  WHERE m.fid = 1\n    AND m.ndet >= 10\n    AND m.ndubious = 0\n),\nfirst500 AS (\n  SELECT e.oid\n  FROM eligible e\n  ORDER BY e.oid\n  LIMIT 500\n)\nSELECT\n  p.oid,\n  p.classifier_version,\n  p.class_name,\n  p.probability\nFROM first500 f\nJOIN LATERAL (\n  SELECT\n    pr.oid,\n    pr.classifier_version,\n    pr.class_name,\n    pr.probability\n  FROM probability pr\n  WHERE pr.oid = f.oid\n    AND pr.classifier_name = 'lc_classifier'  -- 1) restrict to light curve classifier\n    AND pr.ranking = 1                        -- 2) only top-ranked class\n    AND pr.classifier_version IS NOT NULL     -- 3) ensure version is present\n  ORDER BY pr.classifier_version DESC\n  LIMIT 1\n) p ON TRUE\nORDER BY p.oid;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3099, "completion_tokens": 3032, "total_tokens": 6131, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2688, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c90888190aa5f37a96f72053f", "custom_id": "92-3", "response": {"status_code": 200, "request_id": "74134624a9e65f40be8f667686fb76cc", "body": {"id": "chatcmpl-CT02QnkPF6NXMz20K7UqsS4HSm5oF", "object": "chat.completion", "created": 1761027694, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "", "refusal": null, "annotations": []}, "finish_reason": "length"}], "usage": {"prompt_tokens": 2138, "completion_tokens": 4000, "total_tokens": 6138, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 4000, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9ca1948190a10fcd628e92507e", "custom_id": "102-0", "response": {"status_code": 200, "request_id": "ceca7db2c6bda16d1d83e3424055ba3c", "body": {"id": "chatcmpl-CT02qClhM5tsJQUA4x3xHIGgyFPMV", "object": "chat.completion", "created": 1761027720, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Find up to 50 ZTF objects whose most likely lc_classifier class is AGN with probability > 0.6\n-- and with WISE W1 magnitude (allwise.w1mpro) between 12 and 13.\n-- Return all columns from the 'magstat' table for those objects.\n-- Note: W1 magnitude is not in magstat; use the allwise table (w1mpro), joining via the object id.\nWITH selected_oids AS (\n    SELECT DISTINCT p.oid\n    FROM probability p\n    JOIN allwise aw\n      ON aw.oid_catalog = p.oid  -- join using the object identifier\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.class_name = 'AGN'\n      AND p.ranking = 1\n      AND p.probability > 0.6\n      AND aw.w1mpro BETWEEN 12 AND 13\n    LIMIT 50  -- at most 50 objects\n)\nSELECT ms.*\nFROM magstat ms\nJOIN selected_oids s\n  ON s.oid = ms.oid;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2449, "completion_tokens": 2412, "total_tokens": 4861, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2176, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9c9830819086c2f3b703424f36", "custom_id": "102-1", "response": {"status_code": 200, "request_id": "672320548497e239697d2479413c971a", "body": {"id": "chatcmpl-CT03KiOek6qb2Gl7mt5osfP84JNXG", "object": "chat.completion", "created": 1761027750, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Return all columns from magstat for up to 50 objects that:\n-- (1) have lc_classifier rank-1 class 'AGN' with probability > 0.6, and\n-- (2) have WISE W1 magnitude between 12 and 13.\n-- Fixes:\n-- - Use the correct table name 'magstat' (not 'magstats').\n-- - Apply the W1 magnitude filter using the 'allwise' table (w1mpro), not magstat.\nWITH selected_oids AS (\n  SELECT DISTINCT p.oid\n  FROM probability p\n  WHERE p.classifier_name = 'lc_classifier'\n    AND p.class_name = 'AGN'\n    AND p.ranking = 1\n    AND p.probability > 0.6\n    AND EXISTS (\n      SELECT 1\n      FROM allwise aw\n      WHERE aw.oid_catalog = p.oid\n        AND aw.w1mpro BETWEEN 12 AND 13\n    )\n  LIMIT 50\n)\nSELECT ms.*\nFROM magstat ms\nJOIN selected_oids so ON so.oid = ms.oid;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2453, "completion_tokens": 3568, "total_tokens": 6021, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 3328, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cb69081908dc60bfebd9a4625", "custom_id": "102-2", "response": {"status_code": 200, "request_id": "71a842707f22f3634ea026fbc4166d81", "body": {"id": "chatcmpl-CSzyO1nF2fa5wAu1DDNHoAzuyqNyD", "object": "chat.completion", "created": 1761027444, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Corrected query using the provided schema:\n-- - Replaced non-existent table xmatch_allwise with allwise.\n-- - Corrected table name from magstats to magstat.\n-- - Used allwise.w1mpro for W1 magnitude filter.\n-- - Aggregated probabilities per oid to avoid duplicates across classifier versions.\n-- - Assumed linkage between ZTF oid and AllWISE via allwise.oid_catalog (most common sense with given schema).\n-- - Returns all magstat rows (per band) for up to 50 objects meeting the criteria.\n\nWITH per_oid AS (\n    SELECT\n        p.oid,\n        MAX(p.probability) AS agn_prob\n    FROM probability p\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.class_name = 'AGN'\n    GROUP BY p.oid\n),\nselected AS (\n    SELECT o.oid\n    FROM per_oid o\n    INNER JOIN allwise w ON w.oid_catalog = o.oid\n    WHERE o.agn_prob > 0.6\n      AND w.w1mpro BETWEEN 12 AND 13\n    ORDER BY o.agn_prob DESC\n    LIMIT 50\n)\nSELECT m.*\nFROM magstat m\nINNER JOIN selected s ON s.oid = m.oid;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2581, "completion_tokens": 3153, "total_tokens": 5734, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2880, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cbb388190a81acb2f59be97be", "custom_id": "102-3", "response": {"status_code": 200, "request_id": "e9f0b55c95421c7132b173254d85e41a", "body": {"id": "chatcmpl-CSzyOuEAMOeizOh2SM1zkE3dgEckj", "object": "chat.completion", "created": 1761027444, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Find up to 50 ZTF objects (by oid) with:\n--  - lc_classifier AGN probability > 0.6\n--  - WISE W1 magnitude between 12 and 13 (column is allwise.w1mpro)\n-- Then return ALL columns from magstat for those objects.\n-- Note: The original error was due to referencing m.w1, which does not exist in magstat.\n--       W1 magnitudes live in the allwise table as w1mpro, so we join to allwise to filter.\nWITH candidate_oids AS (\n  SELECT DISTINCT p.oid\n  FROM probability AS p\n  JOIN allwise AS a\n    ON a.oid_catalog = p.oid  -- using provided tables; join key chosen to access W1 mag\n  WHERE p.classifier_name = 'lc_classifier'\n    AND p.class_name = 'AGN'\n    AND p.probability > 0.6\n    AND a.w1mpro BETWEEN 12 AND 13\n  LIMIT 50  -- at most 50 objects\n)\nSELECT m.*\nFROM magstat AS m\nJOIN candidate_oids AS c\n  ON c.oid = m.oid;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2356, "completion_tokens": 2179, "total_tokens": 4535, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 1920, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cb868819087d820863f659bb6", "custom_id": "102-4", "response": {"status_code": 200, "request_id": "efab15264c570f444f0f6238c14af93a", "body": {"id": "chatcmpl-CSzyO3BJdfX5hGH36Bv0LtaUGRsJQ", "object": "chat.completion", "created": 1761027444, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Corrected query:\n-- - Uses the correct table name 'magstat' (not 'magstats').\n-- - Joins to 'probability' on oid to filter AGN with probability > 0.6 from the 'lc_classifier'.\n-- - Uses 'allwise.w1mpro' for the WISE W1 magnitude constraint (12 to 13).\n-- - Selects up to 50 distinct objects (by oid) first, then returns all magstat rows (all bands) for those objects.\n-- - Assumes the join key between ZTF objects and ALLWISE is the oid matching allwise.oid_catalog, per the provided schema constraints.\n\nWITH candidates AS (\n  SELECT p.oid\n  FROM probability AS p\n  WHERE p.classifier_name = 'lc_classifier'\n    AND p.class_name = 'AGN'\n    AND p.probability > 0.6\n    AND EXISTS (\n      SELECT 1\n      FROM allwise AS aw\n      WHERE aw.oid_catalog = p.oid\n        AND aw.w1mpro BETWEEN 12 AND 13\n    )\n  GROUP BY p.oid\n  LIMIT 50\n)\nSELECT ms.*\nFROM magstat AS ms\nJOIN candidates AS c\n  ON c.oid = ms.oid;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2377, "completion_tokens": 2192, "total_tokens": 4569, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 1920, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cbbb88190a6caa6013c92e20d", "custom_id": "104-0", "response": {"status_code": 200, "request_id": "ac6f5fb0f64a9399855cf34cc6854485", "body": {"id": "chatcmpl-CSzyOmiqMpRw5yR5pfZdAOcBmCTVi", "object": "chat.completion", "created": 1761027444, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Find up to 30 ZTF objects with asteroid probability > 0.9 for stamp_classifier v1.0.4\n-- Return: ZTF oid, candidate id, nearest SS object distance/magnitude/name (from ss_ztf),\n-- and candidate-level fields: filter id (fid). The FWHM, ncalib, and exptime fields are\n-- not present in the provided detection schema, so they are returned as NULL placeholders.\n\nWITH top_asteroids AS (\n    SELECT p.oid, p.probability\n    FROM probability p\n    WHERE p.classifier_name = 'stamp_classifier'\n      AND p.classifier_version = 'stamp_classifier_1.0.4'\n      AND p.class_name = 'asteroid'\n      AND p.probability > 0.9\n    ORDER BY p.probability DESC\n    LIMIT 30\n),\nlatest_det AS (\n    -- Pick the latest detection (by mjd) per object\n    SELECT DISTINCT ON (d.oid) d.*\n    FROM detection d\n    INNER JOIN top_asteroids ta ON ta.oid = d.oid\n    ORDER BY d.oid, d.mjd DESC\n)\nSELECT\n    ld.oid,               -- ZTF object identifier\n    ld.candid,            -- candidate identifier\n    ssz.ssdistnr,         -- distance to nearest known Solar System object\n    ssz.ssmagnr,          -- MPC archive magnitude\n    ssz.ssnamenr,         -- MPC name\n    ld.fid,               -- filter identifier (1=g; 2=r; 3=i)\n    NULL::DOUBLE PRECISION AS fwhm,     -- not available in provided detection schema\n    NULL::INTEGER          AS ncalib,   -- not available in provided detection schema\n    NULL::DOUBLE PRECISION AS exptime   -- not available in provided detection schema\nFROM latest_det ld\nINNER JOIN top_asteroids ta ON ta.oid = ld.oid\nLEFT JOIN ss_ztf ssz ON ssz.oid = ld.oid\nORDER BY ta.probability DESC, ld.oid;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2278, "completion_tokens": 2437, "total_tokens": 4715, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 1984, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cba7c8190b7b8b3f17c0a02d7", "custom_id": "104-1", "response": {"status_code": 200, "request_id": "c61d6516236a944c030d945fc87753f6", "body": {"id": "chatcmpl-CSzyOL5GRTHxmSvI2sF7tUbzbGWOQ", "object": "chat.completion", "created": 1761027444, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Find up to 30 ZTF objects classified as 'asteroid' with probability > 0.9 by the stamp classifier v1.0.4\n-- Optimization: limit to top 30 oids first (using probability table filters and ranking=1), then join to ss_ztf (PK on oid),\n-- and finally lookup the detection row via candid (PK on detection). This avoids scanning the full detection table.\n-- Note: The requested columns FWHM (SExtractor), number of PS1 calibrators, and exposure time are not present\n-- in the provided tables (probability, detection, ss_ztf), so they cannot be returned here.\nWITH top_objs AS (\n    SELECT\n        p.oid,\n        p.probability\n    FROM probability p\n    WHERE p.class_name = 'asteroid'\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.classifier_version = 'stamp_classifier_1.0.4'\n      AND p.probability > 0.9\n      AND p.ranking = 1\n    ORDER BY p.probability DESC\n    LIMIT 30\n)\nSELECT\n    t.oid AS oid,              -- ZTF object identifier\n    s.candid AS candid,        -- candidate identifier\n    s.ssdistnr AS ssdistnr,    -- distance to nearest Solar System object\n    s.ssmagnr AS ssmagnr,      -- MPC archive magnitude\n    s.ssnamenr AS ssnamenr,    -- MPC archive name\n    d.fid AS fid               -- filter identifier (1=g; 2=r; 3=i)\nFROM top_objs t\nJOIN ss_ztf s\n  ON s.oid = t.oid\nLEFT JOIN detection d\n  ON d.candid = s.candid\nORDER BY t.probability DESC, t.oid;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2228, "completion_tokens": 2704, "total_tokens": 4932, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2304, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cc5b4819092ea3098dc6387bc", "custom_id": "104-2", "response": {"status_code": 200, "request_id": "9572cbf098f75938e9390c783354cd17", "body": {"id": "chatcmpl-CSzyqsvUEhC1nevv6FtMxChRv6mm9", "object": "chat.completion", "created": 1761027472, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Top 30 ZTF objects with 'stamp_classifier_1.0.4' asteroid probability > 0.9\nWITH top_asteroids AS (\n    SELECT\n        p.oid,\n        p.probability\n    FROM probability p\n    WHERE\n        p.classifier_name = 'stamp_classifier' AND         -- use stamp classifier\n        p.classifier_version = 'stamp_classifier_1.0.4' AND-- requested version\n        p.class_name = 'asteroid' AND                      -- asteroid class\n        p.probability > 0.9                                -- probability threshold\n    ORDER BY p.probability DESC\n    LIMIT 30                                               -- at most 30 objects\n),\nlatest_det AS (\n    -- Pick one candidate (latest by mjd) per selected object to report candidate-level columns\n    SELECT DISTINCT ON (d.oid)\n        d.oid,\n        d.candid,\n        d.fid,\n        d.mjd\n    FROM detection d\n    INNER JOIN top_asteroids ta ON ta.oid = d.oid\n    ORDER BY d.oid, d.mjd DESC\n)\nSELECT\n    ld.oid,                 -- ZTF object identifier\n    ld.candid,              -- candidate identifier\n    s.ssdistnr,             -- distance to nearest Solar System object\n    s.ssmagnr,              -- MPC archive magnitude\n    s.ssnamenr,             -- MPC object name\n    ld.fid,                 -- filter identifier\n    dq.fwhm,                -- FWHM from SExtractor (dataquality)\n    dq.nmatches,            -- number of PS1 calibrators used (dataquality)\n    dq.exptime              -- exposure time (dataquality)\nFROM latest_det ld\nLEFT JOIN ss_ztf s ON s.oid = ld.oid                         -- Solar System nearest object info (per oid)\nLEFT JOIN dataquality dq ON dq.candid = ld.candid AND dq.oid = ld.oid  -- candidate-level quality info\nORDER BY ld.oid;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3275, "completion_tokens": 3183, "total_tokens": 6458, "prompt_tokens_details": {"cached_tokens": 1024, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2752, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cc1bc8190bf9b48945c795302", "custom_id": "104-3", "response": {"status_code": 200, "request_id": "3c4322d70811ec35bef94321e8f96363", "body": {"id": "chatcmpl-CSzytR4YL7qC7nEi2Z1afzRDEdbbF", "object": "chat.completion", "created": 1761027475, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Goal: Up to 30 ZTF objects with asteroid probability > 0.9 from stamp_classifier v1.0.4.\n-- Optimization:\n--  - Apply strict filters on probability, including ranking=1 (common best-practice for ALeRCE).\n--  - Limit early (in a subquery) to 30 OIDs ordered by probability.\n--  - Join to detection via ss_ztf.candid (d.candid is a PRIMARY KEY) to avoid scanning detection by oid.\n--  - ss_ztf provides Solar System info (distance, magnitude, name) per object.\n-- Note: FWHM, number of PS1 calibrators, and exposure time are not available in the provided schema,\n--       so they are returned as NULL placeholders with appropriate aliases.\n\nWITH selected_oids AS (\n    SELECT\n        p.oid\n    FROM probability AS p\n    WHERE p.classifier_name = 'stamp_classifier'\n      AND p.classifier_version = 'stamp_classifier_1.0.4'\n      AND p.class_name = 'asteroid'\n      AND p.ranking = 1\n      AND p.probability > 0.9\n    ORDER BY p.probability DESC\n    LIMIT 30\n)\nSELECT\n    s.oid,                           -- ZTF object identifier\n    ssz.candid,                      -- candidate identifier (from Solar System match)\n    ssz.ssdistnr,                    -- distance to nearest Solar System object\n    ssz.ssmagnr,                     -- MPC archive magnitude\n    ssz.ssnamenr,                    -- MPC object name\n    d.fid,                           -- filter identifier\n    NULL::double precision AS fwhm,  -- FWHM from SExtractor (not in provided schema)\n    NULL::integer AS nps1_calibrators, -- number of PS1 calibrators (not in provided schema)\n    NULL::double precision AS exptime  -- exposure time (not in provided schema)\nFROM selected_oids AS s\nINNER JOIN ss_ztf AS ssz\n    ON ssz.oid = s.oid\nLEFT JOIN detection AS d\n    ON d.candid = ssz.candid;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2229, "completion_tokens": 3279, "total_tokens": 5508, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2816, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cc14881909251cf22a67f448e", "custom_id": "104-4", "response": {"status_code": 200, "request_id": "f5bffc5bf28f4b6ecaee4a85e2759e9a", "body": {"id": "chatcmpl-CSzyuptcbuDOxVy5V36TBPxCnvjnZ", "object": "chat.completion", "created": 1761027476, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "/* Find up to 30 ZTF objects with P(asteroid) > 0.9 from the stamp classifier (version 1.0.4).\n   Return object and candidate IDs, nearest Solar System object distance, MPC magnitude, and SS name.\n   Also return candidate-related fields: filter id, and placeholders for FWHM, PS1 calibrators, and exposure time\n   (these fields are not present in the provided schema, so returned as NULLs). */\nSELECT\n    o.oid AS ztf_oid,\n    d.candid AS candid,\n    s.ssdistnr AS ss_nearest_distance,\n    s.ssmagnr AS mpc_magnitude,\n    s.ssnamenr AS ss_name,\n    d.fid AS filter_id,\n    /* The following fields are not available in the provided tables; returned as NULL placeholders */\n    NULL::DOUBLE PRECISION AS fwhm_sextractor,\n    NULL::INTEGER AS ps1_calibrators_used,\n    NULL::DOUBLE PRECISION AS exposure_time\nFROM probability AS p\nJOIN object AS o\n  ON o.oid = p.oid\nJOIN ss_ztf AS s\n  ON s.oid = o.oid\nJOIN detection AS d\n  ON d.oid = o.oid\n AND d.candid = s.candid  /* use the candidate linked in ss_ztf to fetch candidate-level fields */\nWHERE p.class_name = 'asteroid'\n  AND p.classifier_name = 'stamp_classifier'\n  /* Accept either plain version '1.0.4' or concatenated label 'stamp_classifier_1.0.4' */\n  AND p.classifier_version IN ('1.0.4', 'stamp_classifier_1.0.4')\n  AND p.probability > 0.9\nORDER BY p.probability DESC\nLIMIT 30;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1848, "completion_tokens": 2508, "total_tokens": 4356, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2112, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9ccec8819088df9a0d93ee0a4c", "custom_id": "83-0", "response": {"status_code": 200, "request_id": "0cf9328f4a8cdaab9d80d6368dde0dee", "body": {"id": "chatcmpl-CSzyyWNSh1uP9T9X2fCkZykfQvEII", "object": "chat.completion", "created": 1761027480, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- The error occurs because the 'allwise' table does not have a column named 'oid'.\n-- The correct primary key column in 'allwise' is 'oid_catalog' (the AllWISE identifier).\n-- Note: 'oid_catalog' is NOT the ZTF object id. To map a ZTF object (e.g., 'ZTF21aazqwxv') to an AllWISE entry,\n-- you would need to join via the crossmatch table (not provided in the current schema).\n-- This query fixes the undefined column error; replace the value with the appropriate AllWISE oid_catalog if known.\n\nSELECT *\nFROM allwise\nWHERE oid_catalog = 'ZTF21aazqwxv';", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1401, "completion_tokens": 1497, "total_tokens": 2898, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 1344, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cdd14819085b9dd61eec10ae7", "custom_id": "83-1", "response": {"status_code": 200, "request_id": "753ef155a53893e2953f3bf7cdf51bd0", "body": {"id": "chatcmpl-CSzz32TTrXgKNaPKWf2uohSuHXWB6", "object": "chat.completion", "created": 1761027485, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Get all columns from the ALLWISE catalog for ZTF object 'ZTF21aazqwxv'\n-- Fix: The previous query failed because xmatch does not have a \"catalog\" column.\n-- We remove that filter; the INNER JOIN to the ALLWISE table inherently restricts\n-- results to the ALLWISE catalog via matching oid_catalog.\nSELECT a.*\nFROM allwise a\nJOIN xmatch x\n  ON x.oid_catalog = a.oid_catalog\nWHERE x.oid = 'ZTF21aazqwxv';", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1965, "completion_tokens": 2489, "total_tokens": 4454, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2368, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cef848190b426b84cda252d68", "custom_id": "96-1", "response": {"status_code": 200, "request_id": "7a0015b46cde8083e81d1fab5807293f", "body": {"id": "chatcmpl-CSzzBz0h5RV6Euqi12EO0D00eQ1ii", "object": "chat.completion", "created": 1761027493, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "/* Get all detections for ZTF objects whose nearest Solar System object is either\n   '2003FP134' or '2009UK56' and is within 2 arcseconds.\n   - ss_ztf.ssnamenr: name of the nearest Solar System object (MPC name)\n   - ss_ztf.ssdistnr: distance to that Solar System object (assumed arcseconds)\n   - Join to detection via oid to retrieve ALL detections of those objects\n   - Return all ss_ztf columns plus requested detection fields\n   - Sort by MPC name (ssnamenr) and detection date (mjd)\n*/\nWITH filtered_ss AS (\n  SELECT *\n  FROM ss_ztf\n  WHERE ssnamenr IN ('2003FP134', '2009UK56')\n    AND ssdistnr <= 2.0  -- 2 arcseconds\n)\nSELECT\n  ss.*,\n  d.mjd,\n  d.fid,\n  d.isdiffpos,\n  d.ra,\n  d.dec,\n  d.magpsf,\n  d.sigmapsf\nFROM filtered_ss AS ss\nJOIN detection AS d\n  ON d.oid = ss.oid\nORDER BY ss.ssnamenr, d.mjd;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1797, "completion_tokens": 2511, "total_tokens": 4308, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2240, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cecb081908ce04ee6fef7aa91", "custom_id": "90-2", "response": {"status_code": 200, "request_id": "347370be63ecfb810faf6c2cf03b2849", "body": {"id": "chatcmpl-CSzzHUR188DNNc3G9uWIlGCz8B5Z0", "object": "chat.completion", "created": 1761027499, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Find up to 100 ZTF objects with Multiband_period < 5 days in feature version 'lc_classifier_1.2.1-P'\n-- Then return all probability rows for those objects, restricted to the light curve classifier\n-- and rankings 1 or 2.\n-- Fix: Avoid ORDER BY on columns not in the SELECT DISTINCT list by aggregating first,\n-- ordering by the aggregated value (min period), and then limiting.\nWITH eligible_oids AS (\n    SELECT x.oid\n    FROM (\n        SELECT f.oid, MIN(f.value) AS min_period\n        FROM feature f\n        WHERE f.name = 'Multiband_period'\n          AND f.version = 'lc_classifier_1.2.1-P'\n          AND f.value < 5\n          AND f.oid LIKE 'ZTF%'\n        GROUP BY f.oid\n    ) AS x\n    ORDER BY x.min_period ASC, x.oid ASC\n    LIMIT 100\n)\nSELECT p.*\nFROM probability p\nJOIN eligible_oids e ON p.oid = e.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nORDER BY p.oid ASC, p.ranking ASC;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3597, "completion_tokens": 2505, "total_tokens": 6102, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2240, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cee708190b19a998482826286", "custom_id": "90-4", "response": {"status_code": 200, "request_id": "22013ce050a5092e57237b1b203b6437", "body": {"id": "chatcmpl-CSzzPTTSHkd39vMvtD0Yftm9pZxTn", "object": "chat.completion", "created": 1761027507, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Find up to 100 ZTF objects whose Multiband_period < 5 days in feature version 'lc_classifier_1.2.1-P'\n-- Then return all probability rows (all columns) for the light curve classifier with ranking 1 or 2 for those objects\nWITH objs AS (\n  SELECT DISTINCT f.oid\n  FROM feature f\n  WHERE f.name = 'Multiband_period'            -- multiband period feature\n    AND f.version = 'lc_classifier_1.2.1-P'    -- feature version filter\n    AND f.value < 5                            -- period < 5 days\n    AND f.fid IN (12, 13, 23, 123)             -- multiband fids: gr, gi, ri, gri\n    AND f.oid LIKE 'ZTF%'                      -- ensure ZTF objects\n  LIMIT 100\n)\nSELECT p.*\nFROM probability p\nJOIN objs o ON o.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'      -- only light curve classifier\n  AND p.ranking IN (1, 2);                     -- rankings either 1 or 2", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3626, "completion_tokens": 3005, "total_tokens": 6631, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2752, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cf268819094e1e48ba85a4dad", "custom_id": "58-0", "response": {"status_code": 200, "request_id": "a21a661f4cbc4a372727bb0b10b9ecdb", "body": {"id": "chatcmpl-CSzzXPNGBDkeRFEWFoM4Ul0s0x0EW", "object": "chat.completion", "created": 1761027515, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Optimized query using a LATERAL subquery to avoid scanning the entire detection table.\n-- It first filters objects by ndet and deltajd, then computes per-object minima for corrected g and r bands.\n-- This leverages the index on detection(oid) and should avoid timeouts.\n\nSELECT o.*\nFROM object AS o\nJOIN LATERAL (\n    SELECT\n        MIN(d.magpsf_corr) FILTER (WHERE d.fid = 1 AND d.corrected = TRUE) AS min_g_corr, -- g-band min corrected mag\n        MIN(d.magpsf_corr) FILTER (WHERE d.fid = 2 AND d.corrected = TRUE) AS min_r_corr  -- r-band min corrected mag\n    FROM detection AS d\n    WHERE d.oid = o.oid\n) AS mins ON TRUE\nWHERE\n    o.ndet >= 30\n    AND o.deltajd > 20\n    AND mins.min_g_corr IS NOT NULL\n    AND mins.min_r_corr IS NOT NULL\n    AND (mins.min_g_corr - mins.min_r_corr) > 3.5\nLIMIT 20;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2143, "completion_tokens": 2036, "total_tokens": 4179, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 1792, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cf674819084f8f48125978f5b", "custom_id": "58-4", "response": {"status_code": 200, "request_id": "8b081dbe5ac91f59de6cd2c7cfa05be2", "body": {"id": "chatcmpl-CSzzbFi7MXol2N1Wk2dNDXqN1kVQ7", "object": "chat.completion", "created": 1761027519, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "/* Optimized approach:\n   - First filter candidate objects by ndet and deltajd (cheap on the object table).\n   - For each candidate object, use LATERAL subqueries that scan detections restricted by oid\n     (leveraging the index on detection.oid), and pick the minimum corrected magnitude per band\n     via ORDER BY ... LIMIT 1.\n   - This avoids a large GROUP BY over the entire detection table and returns at most 20 objects.\n*/\nSELECT o.*\nFROM object o\n/* Require: ndet >= 30 and deltajd > 20 */\nWHERE o.ndet >= 30\n  AND o.deltajd > 20\n/* Get minimum corrected g-band magnitude for this oid */\nJOIN LATERAL (\n  SELECT d.magpsf_corr AS g_min_corr\n  FROM detection d\n  WHERE d.oid = o.oid             -- restrict detection scan by oid (most selective)\n    AND d.corrected = TRUE        -- only corrected magnitudes\n    AND d.fid = 1                 -- g-band\n    AND d.magpsf_corr IS NOT NULL\n  ORDER BY d.magpsf_corr ASC\n  LIMIT 1\n) g ON TRUE\n/* Get minimum corrected r-band magnitude for this oid */\nJOIN LATERAL (\n  SELECT d.magpsf_corr AS r_min_corr\n  FROM detection d\n  WHERE d.oid = o.oid             -- restrict detection scan by oid\n    AND d.corrected = TRUE        -- only corrected magnitudes\n    AND d.fid = 2                 -- r-band\n    AND d.magpsf_corr IS NOT NULL\n  ORDER BY d.magpsf_corr ASC\n  LIMIT 1\n) r ON TRUE\n/* Keep objects where |g_min_corr - r_min_corr| > 3.5 */\nAND ABS(g.g_min_corr - r.r_min_corr) > 3.5\nLIMIT 20;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2248, "completion_tokens": 2521, "total_tokens": 4769, "prompt_tokens_details": {"cached_tokens": 1152, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2112, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cf6208190b93d5d2437c18b19", "custom_id": "39-0", "response": {"status_code": 200, "request_id": "6f8a93b62d9d8d5a13036e92e37a0d03", "body": {"id": "chatcmpl-CSzzhsyPYU9tv00hgwr5FCZF7DjXQ", "object": "chat.completion", "created": 1761027525, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "/* \nGet detections for objects whose highest-probability class (ranking=1) by the stochastic light curve classifier is CV/Nova,\nrestrict to objects with at most 50 detections, and collect their r-band (fid=2) corrected PSF magnitudes.\nAlso compute, per detection, the rise from the object's minimum corrected magnitude and the maximum rise per object.\nReturn first 1000 rows ordered by object identifier (and mjd for stability).\n*/\nWITH cvnova AS (\n    /* OIDs classified as CV/Nova with highest probability by the stochastic light curve classifier */\n    SELECT DISTINCT p.oid\n    FROM probability AS p\n    WHERE p.class_name = 'CV/Nova'\n      AND p.classifier_name = 'stochastic'\n      AND p.ranking = 1\n),\nlimited_objects AS (\n    /* Objects with at most 50 detections */\n    SELECT o.oid\n    FROM object AS o\n    JOIN cvnova AS c ON c.oid = o.oid\n    WHERE o.ndet <= 50\n),\nr_detections AS (\n    /* r-band detections (fid=2) with available corrected PSF magnitudes */\n    SELECT d.*\n    FROM detection AS d\n    JOIN limited_objects AS lo ON lo.oid = d.oid\n    WHERE d.fid = 2\n      AND d.magpsf_corr IS NOT NULL\n)\nSELECT\n    d.oid,                                    -- object identifier\n    d.candid,                                 -- candidate identifier\n    d.fid AS f_id,                            -- filter id\n    d.ra, d.dec,                              -- coordinates\n    d.magpsf_corr AS mag_r_corr,              -- corrected (apparent) PSF magnitude in r-band\n    d.sigmapsf_corr AS mag_r_corr_err,        -- error of corrected PSF magnitude\n    /* Rise from object-wise minimum corrected magnitude (window over OID) */\n    d.magpsf_corr - MIN(d.magpsf_corr) OVER (PARTITION BY d.oid) AS rise_from_min,\n    /* Maximum rise (amplitude) per object in r-band */\n    MAX(d.magpsf_corr) OVER (PARTITION BY d.oid) - MIN(d.magpsf_corr) OVER (PARTITION BY d.oid) AS max_rise_from_min\nFROM r_detections AS d\nORDER BY d.oid, d.mjd\nLIMIT 1000;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1635, "completion_tokens": 3327, "total_tokens": 4962, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 2816, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cff7c8190b774d73abacc1fa1", "custom_id": "39-2", "response": {"status_code": 200, "request_id": "c674ad1426707afc85e7ddd58ff2718b", "body": {"id": "chatcmpl-CSzzreY6ooHTsfIvNOj5Zo66EH6JH", "object": "chat.completion", "created": 1761027535, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "-- Select CV/Nova objects (highest-probability class by the stochastic light curve classifier) \n-- with at most 50 detections, then collect r-band detections and compute requested metrics.\nWITH selected_objects AS (\n    SELECT o.oid\n    FROM object o\n    JOIN probability p\n      ON p.oid = o.oid\n    WHERE p.classifier_name = 'lc_classifier'  -- stochastic light curve classifier\n      AND p.class_name = 'CV/Nova'             -- target class\n      AND p.ranking = 1                        -- highest probability class\n      AND o.ndet <= 50                         -- at most 50 detections between first and last detection\n),\nrband AS (\n    SELECT d.*\n    FROM detection d\n    JOIN selected_objects so\n      ON so.oid = d.oid\n    WHERE d.fid = 2                -- r-band\n      AND d.magpsf_corr IS NOT NULL -- ensure corrected PSF magnitude is available\n)\nSELECT\n    r.oid,                         -- object identifier\n    r.candid,                      -- candidate identifier\n    r.fid AS f_id,                 -- filter id as requested\n    r.ra, r.dec,                   -- coordinates per detection\n    r.magpsf AS diff_mag_psf,      -- PSF difference magnitude\n    r.sigmapsf AS diff_mag_psf_err,-- PSF difference magnitude error\n    r.magpsf_corr AS mag_psf_corr_r,       -- PSF corrected magnitude (r-band)\n    r.sigmapsf_corr AS mag_psf_corr_err_r, -- error of PSF corrected magnitude (r-band)\n    -- Per-object min/max corrected PSF magnitude in r-band and the maximum rise from minimum (amplitude)\n    MIN(r.magpsf_corr) OVER (PARTITION BY r.oid) AS min_mag_psf_corr_r,\n    MAX(r.magpsf_corr) OVER (PARTITION BY r.oid) AS max_mag_psf_corr_r,\n    MAX(r.magpsf_corr) OVER (PARTITION BY r.oid)\n      - MIN(r.magpsf_corr) OVER (PARTITION BY r.oid) AS max_rise_from_min_r\nFROM rband r\nORDER BY r.oid\nLIMIT 1000;", "refusal": null, "annotations": []}, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1680, "completion_tokens": 3487, "total_tokens": 5167, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 3008, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
{"id": "batch_req_68f72a9cf79081909c3296c1183bbb53", "custom_id": "39-3", "response": {"status_code": 200, "request_id": "6fed6b1e57211969bb3097c28695c366", "body": {"id": "chatcmpl-CT000KiPHcju9Qzoieccleb62Q196", "object": "chat.completion", "created": 1761027544, "model": "gpt-5-2025-08-07", "choices": [{"index": 0, "message": {"role": "assistant", "content": "", "refusal": null, "annotations": []}, "finish_reason": "length"}], "usage": {"prompt_tokens": 1680, "completion_tokens": 4000, "total_tokens": 5680, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 4000, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": null}}, "error": null}
