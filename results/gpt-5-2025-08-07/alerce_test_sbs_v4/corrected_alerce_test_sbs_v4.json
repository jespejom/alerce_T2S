{
    "8": {
        "0": {
            "req_id": "8",
            "experiment_id": "run_0",
            "pred_tables": [
                "probability",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'object']",
                    "1": "['probability', 'taxonomy', 'detection']"
                },
                "in_toks": 622,
                "out_toks": 2020,
                "id": "chatcmpl-CSnQ1UuU1sSlI3jThIPXTOshwvU6p",
                "created": 1760979185,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1099,
                "out_toks": 591,
                "id": "chatcmpl-CSndCqboAkfQfmGkXzMXNePJ9eT5r",
                "created": 1760980002,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects whose first detection is between 2023-08-17 (MJD 60173.0) and 2023-08-21 (MJD 60177.0),\n-- with top-ranked 'SN' class from the stamp classifier, and either probability > 0.5 or at least 2 detections.\n-- Note: Using object.firstmjd as a proxy for the time window of the first classification.\nSELECT\n    o.*,\n    p.*\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND (p.probability > 0.5 OR o.ndet >= 2);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects whose first detection is between 2023-08-17 (MJD 60173.0) and 2023-08-21 (MJD 60177.0),\n-- with top-ranked 'SN' class from the stamp classifier, and either probability > 0.5 or at least 2 detections.\n-- Note: Using object.firstmjd as a proxy for the time window of the first classification.\nSELECT\n    o.*,\n    p.*\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND (p.probability > 0.5 OR o.ndet >= 2);\n```"
                },
                "in_toks": 2444,
                "out_toks": 1927,
                "id": "chatcmpl-CSquS9G77ahhtW6yGG4cczQvLzr25",
                "created": 1760992604,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "8",
            "experiment_id": "run_1",
            "pred_tables": [
                "probability",
                "taxonomy",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'object']",
                    "1": "['probability', 'taxonomy', 'detection']"
                },
                "in_toks": 622,
                "out_toks": 2020,
                "id": "chatcmpl-CSnQ1UuU1sSlI3jThIPXTOshwvU6p",
                "created": 1760979185,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1210,
                "out_toks": 1679,
                "id": "chatcmpl-CSndLmTWRH36rLuqMZvIQ17osNC7q",
                "created": 1760980011,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\nGoal\nRetrieve objects that (a) were first classified as 'SN' by the stamp classifier between MJD 60173.0 (Aug 17) and 60177.0 (Aug 21), and (b) either have a stamp-classifier probability greater than 0.5 or have at least two detections. Return all available columns from the involved datasets.\n\nAssumptions and constraints\n- \u201cFirst classified\u201d by the stamp classifier is proxied by the object\u2019s first detection time (MIN(detection.mjd)), since probability records do not store timestamps. The stamp classifier runs at alert time for new objects, so the first detection approximates the first stamp classification time.\n- We must use the stamp classifier explicitly, overriding the default lc_classifier for probability.\n- Use probability.ranking = 1 to get the top class per object per classifier/version.\n- Avoid filtering on detection columns directly (as per guidance); aggregate detections by oid and filter on the aggregated min_mjd in an outer step.\n- No spatial filtering is requested; Q3C is not used here.\n\nInputs\n- Start MJD: 60173.0 (Aug 17)\n- End MJD: 60177.0 (Aug 21)\n\nTables and columns used\n- probability:\n  - oid, class_name, classifier_name, classifier_version, probability, ranking\n- detection:\n  - oid, mjd\n  - Note: Other detection columns exist, but only oid and mjd are needed for aggregation.\n\nStep-by-step plan\n\n1) Build a subquery of stamp-classifier \u201cSN\u201d top-1 classifications\n- From table probability.\n- Filters:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.ranking = 1\n  - probability.class_name = 'SN'\n- Do not filter on probability.probability here, since we will apply the OR condition later with detection counts.\n- Columns to select:\n  - probability.oid\n  - probability.class_name\n  - probability.classifier_name\n  - probability.classifier_version\n  - probability.probability\n  - probability.ranking\n- This subquery benefits from the partial index ix_classification_rank1 (ranking = 1).\n\n2) Build a subquery aggregating detections per object\n- From table detection.\n- No WHERE filter on detection columns (to respect the guidance).\n- Group by detection.oid.\n- Compute:\n  - min_mjd = MIN(detection.mjd) as the first detection time (proxy for first stamp classification time).\n  - det_count = COUNT(*) as number of detections for the object.\n- Columns to select:\n  - detection.oid\n  - min_mjd (MIN(mjd))\n  - det_count (COUNT(*))\n- This uses the ix_ndetection_oid index (hash on oid) effectively during grouping.\n\n3) Join the two subqueries\n- INNER JOIN on oid to retain only objects that both:\n  - Are top-1 'SN' in the stamp classifier, and\n  - Have detections aggregated (min_mjd, det_count).\n\n4) Apply the final filters on the joined result\n- First-classified (proxied by first detection) date window:\n  - min_mjd BETWEEN 60173.0 AND 60177.0 (inclusive).\n- Probability/detection logic:\n  - (probability.probability > 0.5) OR (det_count >= 2).\n- The probability threshold applies to the stamp-classifier probability in the joined probability record.\n\n5) Select columns to return\n- The user did not request specific columns; by default, return all columns from the involved datasets:\n  - All selected columns from the probability subquery (including oid, class_name, classifier_name, classifier_version, probability, ranking).\n  - All selected columns from the detection aggregation subquery (min_mjd, det_count).\n\n6) Optional ordering (if desired)\n- To list earliest first-classification times first:\n  - ORDER BY min_mjd ASC.\n- Alternatively, order by probability.probability DESC to see most confident first.\n\n7) Notes on potential duplicates and versions\n- The primary key of probability includes classifier_version; if multiple versions exist for the same oid, this plan will return one row per version that satisfies the filters. If only one row per oid is desired, you would need an extra step to pick a single classifier_version (e.g., the most recent), but no \u201cmost recent\u201d policy is specified here. Keep all versions by default.\n\n8) Performance considerations\n- Using probability.ranking = 1 leverages ix_classification_rank1.\n- Aggregation over detection grouped by oid avoids filtering on detection columns directly and aligns with the provided guidance.\n- The final filters apply to aggregated min_mjd and det_count, not directly on detection rows.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nRetrieve objects that (a) were first classified as 'SN' by the stamp classifier between MJD 60173.0 (Aug 17) and 60177.0 (Aug 21), and (b) either have a stamp-classifier probability greater than 0.5 or have at least two detections. Return all available columns from the involved datasets.\n\nAssumptions and constraints\n- \u201cFirst classified\u201d by the stamp classifier is proxied by the object\u2019s first detection time (MIN(detection.mjd)), since probability records do not store timestamps. The stamp classifier runs at alert time for new objects, so the first detection approximates the first stamp classification time.\n- We must use the stamp classifier explicitly, overriding the default lc_classifier for probability.\n- Use probability.ranking = 1 to get the top class per object per classifier/version.\n- Avoid filtering on detection columns directly (as per guidance); aggregate detections by oid and filter on the aggregated min_mjd in an outer step.\n- No spatial filtering is requested; Q3C is not used here.\n\nInputs\n- Start MJD: 60173.0 (Aug 17)\n- End MJD: 60177.0 (Aug 21)\n\nTables and columns used\n- probability:\n  - oid, class_name, classifier_name, classifier_version, probability, ranking\n- detection:\n  - oid, mjd\n  - Note: Other detection columns exist, but only oid and mjd are needed for aggregation.\n\nStep-by-step plan\n\n1) Build a subquery of stamp-classifier \u201cSN\u201d top-1 classifications\n- From table probability.\n- Filters:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.ranking = 1\n  - probability.class_name = 'SN'\n- Do not filter on probability.probability here, since we will apply the OR condition later with detection counts.\n- Columns to select:\n  - probability.oid\n  - probability.class_name\n  - probability.classifier_name\n  - probability.classifier_version\n  - probability.probability\n  - probability.ranking\n- This subquery benefits from the partial index ix_classification_rank1 (ranking = 1).\n\n2) Build a subquery aggregating detections per object\n- From table detection.\n- No WHERE filter on detection columns (to respect the guidance).\n- Group by detection.oid.\n- Compute:\n  - min_mjd = MIN(detection.mjd) as the first detection time (proxy for first stamp classification time).\n  - det_count = COUNT(*) as number of detections for the object.\n- Columns to select:\n  - detection.oid\n  - min_mjd (MIN(mjd))\n  - det_count (COUNT(*))\n- This uses the ix_ndetection_oid index (hash on oid) effectively during grouping.\n\n3) Join the two subqueries\n- INNER JOIN on oid to retain only objects that both:\n  - Are top-1 'SN' in the stamp classifier, and\n  - Have detections aggregated (min_mjd, det_count).\n\n4) Apply the final filters on the joined result\n- First-classified (proxied by first detection) date window:\n  - min_mjd BETWEEN 60173.0 AND 60177.0 (inclusive).\n- Probability/detection logic:\n  - (probability.probability > 0.5) OR (det_count >= 2).\n- The probability threshold applies to the stamp-classifier probability in the joined probability record.\n\n5) Select columns to return\n- The user did not request specific columns; by default, return all columns from the involved datasets:\n  - All selected columns from the probability subquery (including oid, class_name, classifier_name, classifier_version, probability, ranking).\n  - All selected columns from the detection aggregation subquery (min_mjd, det_count).\n\n6) Optional ordering (if desired)\n- To list earliest first-classification times first:\n  - ORDER BY min_mjd ASC.\n- Alternatively, order by probability.probability DESC to see most confident first.\n\n7) Notes on potential duplicates and versions\n- The primary key of probability includes classifier_version; if multiple versions exist for the same oid, this plan will return one row per version that satisfies the filters. If only one row per oid is desired, you would need an extra step to pick a single classifier_version (e.g., the most recent), but no \u201cmost recent\u201d policy is specified here. Keep all versions by default.\n\n8) Performance considerations\n- Using probability.ranking = 1 leverages ix_classification_rank1.\n- Aggregation over detection grouped by oid avoids filtering on detection columns directly and aligns with the provided guidance.\n- The final filters apply to aggregated min_mjd and det_count, not directly on detection rows."
                },
                "in_toks": 2845,
                "out_toks": 3888,
                "id": "chatcmpl-CSquSCvL3PZRqUxR9j3YrpZN9nPql",
                "created": 1760992604,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Objects first classified as 'SN' by the stamp classifier between MJD 60173.0 and 60177.0\n-- Keep only top-1 (ranking = 1) per classifier/version and enforce the probability or detection-count condition\nSELECT\n  p.*,\n  o.*\nFROM probability AS p\nINNER JOIN object AS o\n  ON o.oid = p.oid\nWHERE\n  p.classifier_name = 'stamp_classifier' -- override default lc_classifier\n  AND p.ranking = 1                      -- top-1 class per classifier/version\n  AND p.class_name = 'SN'                -- exact class name\n  AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n  AND (p.probability > 0.5 OR o.ndet >= 2)\nORDER BY\n  o.firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects first classified as 'SN' by the stamp classifier between MJD 60173.0 and 60177.0\n-- Keep only top-1 (ranking = 1) per classifier/version and enforce the probability or detection-count condition\nSELECT\n  p.*,\n  o.*\nFROM probability AS p\nINNER JOIN object AS o\n  ON o.oid = p.oid\nWHERE\n  p.classifier_name = 'stamp_classifier' -- override default lc_classifier\n  AND p.ranking = 1                      -- top-1 class per classifier/version\n  AND p.class_name = 'SN'                -- exact class name\n  AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n  AND (p.probability > 0.5 OR o.ndet >= 2)\nORDER BY\n  o.firstmjd ASC;\n```"
                },
                "in_toks": 3054,
                "out_toks": 2498,
                "id": "chatcmpl-CSr8eXWg9A3iwH0jjHWvoCUJamqDC",
                "created": 1760993484,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "8",
            "experiment_id": "run_2",
            "pred_tables": [
                "probability",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'detection']"
                },
                "in_toks": 622,
                "out_toks": 977,
                "id": "chatcmpl-CSsRLWJbVXHQ2DA7KEu4WjCIYtyGB",
                "created": 1760998487,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1165,
                "out_toks": 1295,
                "id": "chatcmpl-CSxOdNoELZ9QPYS2KrZQJnuxIKWEi",
                "created": 1761017539,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 2800,
                "out_toks": 4000,
                "id": "chatcmpl-CSxyQ0RVO8Zl87pTKogcR3DascEHr",
                "created": 1761019758,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Objects first detected between 2023-08-17 (MJD 60173.0) and 2023-08-21 (MJD 60177.0)\n-- and classified as 'SN' by the stamp classifier (ranking=1),\n-- with either probability > 0.5 OR at least 2 detections.\nSELECT\n    o.*,\n    p.*\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND (p.probability > 0.5 OR o.ndet >= 2);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects first detected between 2023-08-17 (MJD 60173.0) and 2023-08-21 (MJD 60177.0)\n-- and classified as 'SN' by the stamp classifier (ranking=1),\n-- with either probability > 0.5 OR at least 2 detections.\nSELECT\n    o.*,\n    p.*\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND (p.probability > 0.5 OR o.ndet >= 2);\n```"
                },
                "in_toks": 3037,
                "out_toks": 1845,
                "id": "chatcmpl-CSyK3L6mVMswA4zYR0M5qnTPz2hr7",
                "created": 1761021099,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "8",
            "experiment_id": "run_3",
            "pred_tables": [
                "probability",
                "taxonomy",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'detection']"
                },
                "in_toks": 622,
                "out_toks": 1364,
                "id": "chatcmpl-CSsRXqLOSbYoxgUtgKkUFiQ5MVIl9",
                "created": 1760998499,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1210,
                "out_toks": 1423,
                "id": "chatcmpl-CSxOr3WC0wuyRGOwEGtXyXanDzkLL",
                "created": 1761017553,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and date window\n- Objective: Return all objects whose first stamp-based classification is SN within Aug 17\u2013Aug 21, where either the stamp-classifier SN probability > 0.5 OR the object has at least two detections.\n- Time window (MJD): inclusive range [60173.0, 60177.0].\n- Important assumption (due to available schema): The \u201cfirst classified by the stamp classifier\u201d event coincides with the object\u2019s first alert/detection (the stamp classifier runs on alerts for new objects). Therefore, we will operationalize \u201cfirst classified\u201d as the object\u2019s first detection time (MIN(detection.mjd)).\n\n2) Identify relevant tables and columns\n- detection\n  - oid (join key)\n  - mjd (use MIN(mjd) to represent the first alert/classification time)\n  - Use COUNT(*) per oid to compute number of detections\n- probability\n  - oid (join key)\n  - classifier_name = 'stamp_classifier' (explicitly set; overrides the default lc_classifier)\n  - class_name = 'SN'\n  - ranking = 1 (use default ranking=1 constraint, applied to stamp classifier)\n  - probability (numeric threshold > 0.5 used in OR condition)\n\n3) Build an aggregated subquery over detection to avoid filtering on raw detection rows\n- Create a subquery (or CTE) that groups by detection.oid and computes:\n  - first_mjd = MIN(detection.mjd)\n  - n_det = COUNT(*)\n- Do not apply any WHERE filter inside the detection table beyond grouping by oid (to respect the \u201cavoid filters on detection except by oid\u201d guidance). Filtering by date window will be applied in an outer query that consumes this aggregated subquery.\n\n4) Build a filtered subquery over probability for the stamp classifier SN class\n- Select from probability with these constraints:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.class_name = 'SN'\n  - probability.ranking = 1\n- Retain probability.probability to apply the > 0.5 threshold later (in conjunction with the detection count condition).\n\n5) Join the aggregation with the classification\n- INNER JOIN the aggregated detection subquery (by oid) to the filtered probability subquery (by oid).\n- This ensures we only consider objects that:\n  - Have detections (so we can compute first_mjd and n_det),\n  - Are currently top-ranked as SN by the stamp classifier.\n\n6) Apply the time window filter on first detection time\n- In the outer query, filter the aggregated field:\n  - first_mjd BETWEEN 60173.0 AND 60177.0 (inclusive)\n\n7) Apply the probability/number-of-detections disjunction\n- In the same outer query, apply the OR condition:\n  - (probability.probability > 0.5) OR (n_det >= 2)\n\n8) Columns to return (since user did not request specific columns)\n- Return all columns from involved sources according to the rule \u201cselect all columns if not specified\u201d:\n  - All columns from the filtered probability subquery (i.e., from probability), including: oid, class_name, classifier_name, classifier_version, probability, ranking\n  - All columns from the aggregated detection subquery: oid, first_mjd, n_det\n- If needed, alias duplicate oid fields or select a single oid column to avoid ambiguity in downstream processing.\n\n9) Optional ordering\n- If desired, ORDER BY first_mjd ASC to list objects in chronological order of first detection/classification within the window.\n\n10) Index and performance considerations\n- probability table:\n  - Use ix_classification_rank1 (WHERE ranking = 1) and btree on probability (ix_probabilities_probability) as applicable.\n  - Filter on classifier_name and class_name to reduce rows early.\n- detection table:\n  - Use ix_ndetection_oid (hash on oid) to speed up the join back from the aggregated subquery to probability. The aggregation will scan detection and group by oid; no additional filters on detection fields are used pre-aggregation.\n- The design avoids applying WHERE filters directly on detection other than via oid and post-aggregation filters, per guidance.\n\n11) Summary of logical flow\n- S1: Aggregate detection by oid to compute first_mjd and n_det.\n- S2: Filter probability to stamp-classifier SN with ranking=1.\n- Join S1 and S2 on oid.\n- Apply filters: first_mjd in [60173.0, 60177.0] AND (probability > 0.5 OR n_det >= 2).\n- Select all relevant columns from both sides (probability.*, aggregated fields).",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and date window\n- Objective: Return all objects whose first stamp-based classification is SN within Aug 17\u2013Aug 21, where either the stamp-classifier SN probability > 0.5 OR the object has at least two detections.\n- Time window (MJD): inclusive range [60173.0, 60177.0].\n- Important assumption (due to available schema): The \u201cfirst classified by the stamp classifier\u201d event coincides with the object\u2019s first alert/detection (the stamp classifier runs on alerts for new objects). Therefore, we will operationalize \u201cfirst classified\u201d as the object\u2019s first detection time (MIN(detection.mjd)).\n\n2) Identify relevant tables and columns\n- detection\n  - oid (join key)\n  - mjd (use MIN(mjd) to represent the first alert/classification time)\n  - Use COUNT(*) per oid to compute number of detections\n- probability\n  - oid (join key)\n  - classifier_name = 'stamp_classifier' (explicitly set; overrides the default lc_classifier)\n  - class_name = 'SN'\n  - ranking = 1 (use default ranking=1 constraint, applied to stamp classifier)\n  - probability (numeric threshold > 0.5 used in OR condition)\n\n3) Build an aggregated subquery over detection to avoid filtering on raw detection rows\n- Create a subquery (or CTE) that groups by detection.oid and computes:\n  - first_mjd = MIN(detection.mjd)\n  - n_det = COUNT(*)\n- Do not apply any WHERE filter inside the detection table beyond grouping by oid (to respect the \u201cavoid filters on detection except by oid\u201d guidance). Filtering by date window will be applied in an outer query that consumes this aggregated subquery.\n\n4) Build a filtered subquery over probability for the stamp classifier SN class\n- Select from probability with these constraints:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.class_name = 'SN'\n  - probability.ranking = 1\n- Retain probability.probability to apply the > 0.5 threshold later (in conjunction with the detection count condition).\n\n5) Join the aggregation with the classification\n- INNER JOIN the aggregated detection subquery (by oid) to the filtered probability subquery (by oid).\n- This ensures we only consider objects that:\n  - Have detections (so we can compute first_mjd and n_det),\n  - Are currently top-ranked as SN by the stamp classifier.\n\n6) Apply the time window filter on first detection time\n- In the outer query, filter the aggregated field:\n  - first_mjd BETWEEN 60173.0 AND 60177.0 (inclusive)\n\n7) Apply the probability/number-of-detections disjunction\n- In the same outer query, apply the OR condition:\n  - (probability.probability > 0.5) OR (n_det >= 2)\n\n8) Columns to return (since user did not request specific columns)\n- Return all columns from involved sources according to the rule \u201cselect all columns if not specified\u201d:\n  - All columns from the filtered probability subquery (i.e., from probability), including: oid, class_name, classifier_name, classifier_version, probability, ranking\n  - All columns from the aggregated detection subquery: oid, first_mjd, n_det\n- If needed, alias duplicate oid fields or select a single oid column to avoid ambiguity in downstream processing.\n\n9) Optional ordering\n- If desired, ORDER BY first_mjd ASC to list objects in chronological order of first detection/classification within the window.\n\n10) Index and performance considerations\n- probability table:\n  - Use ix_classification_rank1 (WHERE ranking = 1) and btree on probability (ix_probabilities_probability) as applicable.\n  - Filter on classifier_name and class_name to reduce rows early.\n- detection table:\n  - Use ix_ndetection_oid (hash on oid) to speed up the join back from the aggregated subquery to probability. The aggregation will scan detection and group by oid; no additional filters on detection fields are used pre-aggregation.\n- The design avoids applying WHERE filters directly on detection other than via oid and post-aggregation filters, per guidance.\n\n11) Summary of logical flow\n- S1: Aggregate detection by oid to compute first_mjd and n_det.\n- S2: Filter probability to stamp-classifier SN with ranking=1.\n- Join S1 and S2 on oid.\n- Apply filters: first_mjd in [60173.0, 60177.0] AND (probability > 0.5 OR n_det >= 2).\n- Select all relevant columns from both sides (probability.*, aggregated fields)."
                },
                "in_toks": 2845,
                "out_toks": 3173,
                "id": "chatcmpl-CSxz9tQJC4TvkqIbcIiJupsr77ber",
                "created": 1761019803,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Objects whose first detection (proxy for \"first classified by stamp\") is between 2023-08-17 and 2023-08-21 (MJD 60173.0\u201360177.0, inclusive)\n-- Keep only 'SN' from the 'stamp_classifier' with top rank, and require probability > 0.5 OR at least two detections\nSELECT\n    p.*,\n    o.*\nFROM probability AS p\nINNER JOIN object AS o ON o.oid = p.oid\nWHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND (p.probability > 0.5 OR o.ndet >= 2)\nORDER BY o.firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects whose first detection (proxy for \"first classified by stamp\") is between 2023-08-17 and 2023-08-21 (MJD 60173.0\u201360177.0, inclusive)\n-- Keep only 'SN' from the 'stamp_classifier' with top rank, and require probability > 0.5 OR at least two detections\nSELECT\n    p.*,\n    o.*\nFROM probability AS p\nINNER JOIN object AS o ON o.oid = p.oid\nWHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND (p.probability > 0.5 OR o.ndet >= 2)\nORDER BY o.firstmjd ASC;\n```"
                },
                "in_toks": 3043,
                "out_toks": 2884,
                "id": "chatcmpl-CSyKN5UdRNN1nBRTOBFRFUGnT9WMW",
                "created": 1761021119,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "8",
            "experiment_id": "run_4",
            "pred_tables": [
                "probability",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'object']"
                },
                "in_toks": 622,
                "out_toks": 1104,
                "id": "chatcmpl-CSsRoMius3zFqrowXoQb3wiPUVblW",
                "created": 1760998516,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1099,
                "out_toks": 655,
                "id": "chatcmpl-CSxP7Vpi9nP85vo3B1viqwTdIbsVd",
                "created": 1761017569,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Query objects first detected (firstmjd) between 2023-08-17 and 2023-08-21 (MJD 60173.0 to 60177.0)\n-- that are classified as 'SN' by the stamp classifier (ranking=1),\n-- and either have stamp probability > 0.5 OR at least two detections (ndet >= 2).\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND (p.probability > 0.5 OR o.ndet >= 2);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Query objects first detected (firstmjd) between 2023-08-17 and 2023-08-21 (MJD 60173.0 to 60177.0)\n-- that are classified as 'SN' by the stamp classifier (ranking=1),\n-- and either have stamp probability > 0.5 OR at least two detections (ndet >= 2).\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND (p.probability > 0.5 OR o.ndet >= 2);\n```"
                },
                "in_toks": 2444,
                "out_toks": 1410,
                "id": "chatcmpl-CSxznYp78bb0ZA3D0gqWFbzUHRD9P",
                "created": 1761019843,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "8",
            "experiment_id": "run_5",
            "pred_tables": [
                "probability",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'detection']"
                },
                "in_toks": 622,
                "out_toks": 1297,
                "id": "chatcmpl-CZM0qtkFj1zGul08RIRfb6p1hEWhP",
                "created": 1762542132,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1165,
                "out_toks": 975,
                "id": "chatcmpl-CZY4T67fBrsrdpn8qvRingpZ8rAOP",
                "created": 1762588485,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 2800,
                "out_toks": 4000,
                "id": "chatcmpl-CZaJyqVS47YcNUhUJHmKo4BEs7b9J",
                "created": 1762597134,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Objects first detected (and thus first stamp-classified) between 2023-08-17 (MJD 60173.0) and 2023-08-21 (MJD 60177.0)\n-- Classified as 'SN' by the stamp classifier (ranking=1), with probability > 0.5 OR at least 2 detections\nSELECT\n    *\nFROM\n    object o\nINNER JOIN\n    probability p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND (p.probability > 0.5 OR o.ndet >= 2);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects first detected (and thus first stamp-classified) between 2023-08-17 (MJD 60173.0) and 2023-08-21 (MJD 60177.0)\n-- Classified as 'SN' by the stamp classifier (ranking=1), with probability > 0.5 OR at least 2 detections\nSELECT\n    *\nFROM\n    object o\nINNER JOIN\n    probability p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND (p.probability > 0.5 OR o.ndet >= 2);\n```"
                },
                "in_toks": 3037,
                "out_toks": 2169,
                "id": "chatcmpl-CZawcs9vFktoX4gDLd3k6KSYWhEev",
                "created": 1762599530,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "8",
            "experiment_id": "run_6",
            "pred_tables": [
                "probability",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'object']"
                },
                "in_toks": 622,
                "out_toks": 1616,
                "id": "chatcmpl-CZM1GQ0arLw9rnGersJcaeYgPuf5H",
                "created": 1762542158,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1099,
                "out_toks": 399,
                "id": "chatcmpl-CZY4hAYBd0jaGWgg4BGm09ErpN1sG",
                "created": 1762588499,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects first detected between 2023-08-17 (MJD 60173.0) and 2023-08-21 (MJD 60177.0)\n-- Classified as 'SN' by the stamp classifier (top-ranked), with probability > 0.5 OR at least 2 detections\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND (p.probability > 0.5 OR o.ndet >= 2);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects first detected between 2023-08-17 (MJD 60173.0) and 2023-08-21 (MJD 60177.0)\n-- Classified as 'SN' by the stamp classifier (top-ranked), with probability > 0.5 OR at least 2 detections\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND (p.probability > 0.5 OR o.ndet >= 2);\n```"
                },
                "in_toks": 2444,
                "out_toks": 1715,
                "id": "chatcmpl-CZamTl2Ay21SRkd9p6C3BZSr2c3ju",
                "created": 1762598901,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "8",
            "experiment_id": "run_7",
            "pred_tables": [
                "probability",
                "taxonomy",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'object']"
                },
                "in_toks": 622,
                "out_toks": 1171,
                "id": "chatcmpl-CZM1cmW38mMJKZaN4dEFaGyTrozQ0",
                "created": 1762542180,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1144,
                "out_toks": 463,
                "id": "chatcmpl-CZY4nI0GJO9wxKERqaS1j7fVOXodI",
                "created": 1762588505,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects first detected between Aug 17 (MJD 60173.0) and Aug 21 (MJD 60177.0)\n-- that have the top-ranked ('ranking' = 1) stamp classifier class 'SN'\n-- and satisfy: probability > 0.5 OR at least two detections (ndet >= 2)\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND (p.probability > 0.5 OR o.ndet >= 2);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects first detected between Aug 17 (MJD 60173.0) and Aug 21 (MJD 60177.0)\n-- that have the top-ranked ('ranking' = 1) stamp classifier class 'SN'\n-- and satisfy: probability > 0.5 OR at least two detections (ndet >= 2)\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND (p.probability > 0.5 OR o.ndet >= 2);\n```"
                },
                "in_toks": 2489,
                "out_toks": 1464,
                "id": "chatcmpl-CZaHAFSRtUK2a1yO2hYn8ELAHkIsW",
                "created": 1762596960,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "8",
            "experiment_id": "run_8",
            "pred_tables": [
                "probability",
                "taxonomy",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'object']"
                },
                "in_toks": 622,
                "out_toks": 1171,
                "id": "chatcmpl-CZM208ZOgDiJGGawB3nQhhIphNnLL",
                "created": 1762542204,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1144,
                "out_toks": 591,
                "id": "chatcmpl-CZY4uiOFyQJoTHO919fslykMl419q",
                "created": 1762588512,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects first detected between 2023-08-17 (MJD 60173.0) and 2023-08-21 (MJD 60177.0)\n-- Top-ranked ('ranking' = 1) 'SN' class from the stamp classifier\n-- Include if stamp SN probability > 0.5 OR object has at least 2 detections\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND (p.probability > 0.5 OR o.ndet >= 2);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects first detected between 2023-08-17 (MJD 60173.0) and 2023-08-21 (MJD 60177.0)\n-- Top-ranked ('ranking' = 1) 'SN' class from the stamp classifier\n-- Include if stamp SN probability > 0.5 OR object has at least 2 detections\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd BETWEEN 60173.0 AND 60177.0\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND (p.probability > 0.5 OR o.ndet >= 2);\n```"
                },
                "in_toks": 2489,
                "out_toks": 1470,
                "id": "chatcmpl-CZaHkTNgDzn8wgZDLlIXKhWgJo7RS",
                "created": 1762596996,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "8",
            "experiment_id": "run_9",
            "pred_tables": [
                "probability",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'detection']"
                },
                "in_toks": 622,
                "out_toks": 1681,
                "id": "chatcmpl-CZM2ONXptF6uB1aJ3hv3ykgc1nQMg",
                "created": 1762542228,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1165,
                "out_toks": 3023,
                "id": "chatcmpl-CZY5319RA8GvIumeLjk3QOJMF0HhP",
                "created": 1762588521,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Clarify and fix the business logic and defaults\n- Classifier and class to use: The user explicitly asks for the stamp classifier and its SN class. Therefore override the default lc_classifier condition and use:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.class_name = 'SN'\n- Ranking policy: Keep the default of selecting only the top-ranked class:\n  - probability.ranking = 1\n- Time window: \u201cbetween August 17 and August 21\u201d (inclusive) is provided as MJD in the prompt:\n  - Lower bound MJD = 60173.0\n  - Upper bound MJD = 60177.0\n- \u201cFirst classified as SN by the stamp classifier\u201d: Since the probability table has no timestamp and the stamp classifier is run when an object is first alerted as a new object, use the object\u2019s first detection time as a proxy for the first stamp classification time:\n  - For each oid, define first_mjd = MIN(detection.mjd)\n  - Filter objects whose first_mjd is in [60173.0, 60177.0]\n- Quality/eligibility condition: Include objects that satisfy either:\n  - probability.probability > 0.5\n  - OR number of detections for the object \u2265 2\n- Columns to return: The user did not request specific columns. Following the instructions, return all columns from the involved sources (i.e., all columns from the matching probability rows plus the computed aggregate columns from detection).\n\n2) Identify required tables, columns, and relationships\n- probability table:\n  - Columns needed: oid, class_name, classifier_name, classifier_version, probability, ranking\n  - Filters:\n    - class_name = 'SN'\n    - classifier_name = 'stamp_classifier'\n    - ranking = 1\n- detection table:\n  - Columns needed: oid, mjd (for first_mjd), and also counting rows per oid for number of detections\n  - Aggregations:\n    - MIN(mjd) AS first_mjd\n    - COUNT(*) AS n_detections\n- Relationship:\n  - detection.oid and probability.oid should be joined on equality.\n\n3) Performance-conscious subquery design on detection (respecting guidance to filter detection using oid)\n- First, isolate candidate objects from probability to a compact set:\n  - Subquery S (stamp_sn): select from probability where classifier_name = 'stamp_classifier', class_name = 'SN', ranking = 1. Return at least oid, probability, classifier_version, plus other columns from probability as the instructions require selecting all columns when unspecified.\n- Then aggregate detection only for these candidate oids:\n  - Subquery D (det_agg): join detection to S on detection.oid = S.oid, group by detection.oid to compute:\n    - first_mjd = MIN(detection.mjd)\n    - n_detections = COUNT(*)\n  - This approach ensures detection is filtered by oid only, leveraging ix_ndetection_oid, and avoids broad filters on detection columns.\n\n4) Apply the time-window filter using the aggregated first detection time\n- On D (det_agg), apply:\n  - first_mjd BETWEEN 60173.0 AND 60177.0 (inclusive)\n\n5) Apply the eligibility condition combining probability and detection aggregates\n- Apply the logical condition:\n  - (S.probability > 0.5) OR (D.n_detections >= 2)\n\n6) Join structure and final selection\n- Inner join S (stamp_sn) with D (det_agg) on oid to ensure we only retain objects with both the desired stamp-classification and computed detection aggregates.\n- Select all available columns:\n  - All columns from S (i.e., all probability columns for the matching rows)\n  - The computed D.first_mjd and D.n_detections\n- Optionally, you may alias first_mjd and n_detections clearly in the final output for readability.\n\n7) Optional ordering (not required by the user)\n- If desired, add ORDER BY D.first_mjd ASC to list objects in chronological order of first detection/classification.\n\n8) Notes, assumptions, and edge cases\n- Multiple classifier versions: The probability table\u2019s PK includes classifier_version; this plan returns one row per matching (oid, classifier_version). If you want only one version per object (e.g., latest), you would need a policy to select a single classifier_version per oid; the user did not request this, so return all.\n- Inclusive time bounds: The interval is treated as inclusive of both 60173.0 and 60177.0.\n- Rationale for using first_mjd: The stamp classifier is run on new-object alerts, so the first detection is a practical proxy for \u201cfirst classified\u201d time given the available schema.\n- Index usage:\n  - probability: ix_classification_rank1 (ranking = 1) plus predicates on classifier_name and class_name will efficiently prune rows.\n  - detection: ix_ndetection_oid will be used since detection is joined and grouped by oid only.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Clarify and fix the business logic and defaults\n- Classifier and class to use: The user explicitly asks for the stamp classifier and its SN class. Therefore override the default lc_classifier condition and use:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.class_name = 'SN'\n- Ranking policy: Keep the default of selecting only the top-ranked class:\n  - probability.ranking = 1\n- Time window: \u201cbetween August 17 and August 21\u201d (inclusive) is provided as MJD in the prompt:\n  - Lower bound MJD = 60173.0\n  - Upper bound MJD = 60177.0\n- \u201cFirst classified as SN by the stamp classifier\u201d: Since the probability table has no timestamp and the stamp classifier is run when an object is first alerted as a new object, use the object\u2019s first detection time as a proxy for the first stamp classification time:\n  - For each oid, define first_mjd = MIN(detection.mjd)\n  - Filter objects whose first_mjd is in [60173.0, 60177.0]\n- Quality/eligibility condition: Include objects that satisfy either:\n  - probability.probability > 0.5\n  - OR number of detections for the object \u2265 2\n- Columns to return: The user did not request specific columns. Following the instructions, return all columns from the involved sources (i.e., all columns from the matching probability rows plus the computed aggregate columns from detection).\n\n2) Identify required tables, columns, and relationships\n- probability table:\n  - Columns needed: oid, class_name, classifier_name, classifier_version, probability, ranking\n  - Filters:\n    - class_name = 'SN'\n    - classifier_name = 'stamp_classifier'\n    - ranking = 1\n- detection table:\n  - Columns needed: oid, mjd (for first_mjd), and also counting rows per oid for number of detections\n  - Aggregations:\n    - MIN(mjd) AS first_mjd\n    - COUNT(*) AS n_detections\n- Relationship:\n  - detection.oid and probability.oid should be joined on equality.\n\n3) Performance-conscious subquery design on detection (respecting guidance to filter detection using oid)\n- First, isolate candidate objects from probability to a compact set:\n  - Subquery S (stamp_sn): select from probability where classifier_name = 'stamp_classifier', class_name = 'SN', ranking = 1. Return at least oid, probability, classifier_version, plus other columns from probability as the instructions require selecting all columns when unspecified.\n- Then aggregate detection only for these candidate oids:\n  - Subquery D (det_agg): join detection to S on detection.oid = S.oid, group by detection.oid to compute:\n    - first_mjd = MIN(detection.mjd)\n    - n_detections = COUNT(*)\n  - This approach ensures detection is filtered by oid only, leveraging ix_ndetection_oid, and avoids broad filters on detection columns.\n\n4) Apply the time-window filter using the aggregated first detection time\n- On D (det_agg), apply:\n  - first_mjd BETWEEN 60173.0 AND 60177.0 (inclusive)\n\n5) Apply the eligibility condition combining probability and detection aggregates\n- Apply the logical condition:\n  - (S.probability > 0.5) OR (D.n_detections >= 2)\n\n6) Join structure and final selection\n- Inner join S (stamp_sn) with D (det_agg) on oid to ensure we only retain objects with both the desired stamp-classification and computed detection aggregates.\n- Select all available columns:\n  - All columns from S (i.e., all probability columns for the matching rows)\n  - The computed D.first_mjd and D.n_detections\n- Optionally, you may alias first_mjd and n_detections clearly in the final output for readability.\n\n7) Optional ordering (not required by the user)\n- If desired, add ORDER BY D.first_mjd ASC to list objects in chronological order of first detection/classification.\n\n8) Notes, assumptions, and edge cases\n- Multiple classifier versions: The probability table\u2019s PK includes classifier_version; this plan returns one row per matching (oid, classifier_version). If you want only one version per object (e.g., latest), you would need a policy to select a single classifier_version per oid; the user did not request this, so return all.\n- Inclusive time bounds: The interval is treated as inclusive of both 60173.0 and 60177.0.\n- Rationale for using first_mjd: The stamp classifier is run on new-object alerts, so the first detection is a practical proxy for \u201cfirst classified\u201d time given the available schema.\n- Index usage:\n  - probability: ix_classification_rank1 (ranking = 1) plus predicates on classifier_name and class_name will efficiently prune rows.\n  - detection: ix_ndetection_oid will be used since detection is joined and grouped by oid only."
                },
                "in_toks": 2800,
                "out_toks": 3561,
                "id": "chatcmpl-CZaILHXSFj6AoPTd6d9vMH0ID5l96",
                "created": 1762597033,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Objects first classified as SN by the stamp classifier between 2023-08-17 (MJD 60173.0) and 2023-08-21 (MJD 60177.0)\n-- Include if probability > 0.5 OR at least two detections\nSELECT\n  p.*,\n  o.*\nFROM probability AS p\nINNER JOIN object AS o\n  ON o.oid = p.oid\nWHERE\n  p.classifier_name = 'stamp_classifier' -- override default lc_classifier\n  AND p.class_name = 'SN'\n  AND p.ranking = 1 -- keep only the top-ranked class\n  AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n  AND (p.probability > 0.5 OR o.ndet >= 2);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects first classified as SN by the stamp classifier between 2023-08-17 (MJD 60173.0) and 2023-08-21 (MJD 60177.0)\n-- Include if probability > 0.5 OR at least two detections\nSELECT\n  p.*,\n  o.*\nFROM probability AS p\nINNER JOIN object AS o\n  ON o.oid = p.oid\nWHERE\n  p.classifier_name = 'stamp_classifier' -- override default lc_classifier\n  AND p.class_name = 'SN'\n  AND p.ranking = 1 -- keep only the top-ranked class\n  AND o.firstmjd BETWEEN 60173.0 AND 60177.0\n  AND (p.probability > 0.5 OR o.ndet >= 2);\n```"
                },
                "in_toks": 3111,
                "out_toks": 1593,
                "id": "chatcmpl-CZb4PRHjRaurSed0lWa31kKiYQcTV",
                "created": 1762600013,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "27": {
        "0": {
            "req_id": "27",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "probability",
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'feature']",
                    "1": "['object', 'probability']"
                },
                "in_toks": 661,
                "out_toks": 3043,
                "id": "chatcmpl-CSnQJ7a0dL9yoLji7XUSpWvCUqx4j",
                "created": 1760979203,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 3569,
                "out_toks": 1551,
                "id": "chatcmpl-CSndl5yqz2kTI7xObkDyIcO2V8eCR",
                "created": 1760980037,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the required output columns and their tables\n- From object:\n  - object.oid\n  - object.meanra\n  - object.meandec\n  - object.ndet\n  - object.firstmjd\n  - object.deltajd\n  - object.g_r_max\n- From probability:\n  - probability.classifier_name\n  - probability.class_name\n  - probability.ranking\n  - probability.probability\n\n2) Identify the tables to use and their relationships\n- object is the main table with one row per source (key: object.oid).\n- probability contains classification results for each object and classifier (joined on probability.oid = object.oid).\n- We will use INNER JOINs to restrict to objects meeting the selection criteria.\n\n3) Define the selection criteria based on the user request\n- Objects must be classified by the light curve classifier:\n  - probability.classifier_name = 'lc_classifier'\n- Objects must be \u201cmost likely to be Cepheid\u201d:\n  - Use the ranking of the lc_classifier to identify the most likely class: probability.ranking = 1\n  - Enforce the class to be Cepheid: probability.class_name = 'CEP'\n  - Enforce the top-class probability threshold: probability.probability > 0.76\n- Objects must have 100 or more detections:\n  - object.ndet >= 100\n\n4) Plan the query structure using a subquery to select qualifying objects\n- Create a subquery (e.g., top_cep) that selects only the oids of objects whose most likely class from lc_classifier is 'CEP' with probability > 0.76:\n  - From probability\n  - WHERE classifier_name = 'lc_classifier'\n  - AND ranking = 1\n  - AND class_name = 'CEP'\n  - AND probability > 0.76\n  - SELECT DISTINCT oid\n- This subquery will leverage the existing partial index ix_classification_rank1 (ranking = 1) and then filter by classifier_name and class_name.\n\n5) Join the qualifying objects with object to enforce ndet criterion and fetch object columns\n- INNER JOIN object o with top_cep t on o.oid = t.oid\n- Apply object.ndet >= 100 (either in the JOIN or in a WHERE clause after joining).\n\n6) Join the probability table again to fetch all class probabilities for the qualifying objects\n- INNER JOIN probability p on p.oid = o.oid\n- Restrict to p.classifier_name = 'lc_classifier' to return only the light curve classifier\u2019s classes.\n- Do not restrict by p.ranking in this join, because the user wants \u201cthe ranking and the probability columns for each class of each object\u201d (i.e., include all classes\u2019 rows for the lc_classifier for those objects).\n\n7) Select the required columns\n- From object: o.oid, o.meanra, o.meandec, o.ndet, o.firstmjd, o.deltajd, o.g_r_max\n- From probability: p.classifier_name, p.class_name, p.ranking, p.probability\n\n8) Order the results for readability\n- ORDER BY o.oid ASC, p.ranking ASC (so each object\u2019s classes are listed from most likely to least likely).\n\n9) Optional handling of classifier_version\n- If multiple classifier versions exist in probability, the plan above will return multiple rows per class per object (one per version). If you want a single version:\n  - Either specify a fixed version in both the subquery and the main join (p.classifier_version = '...'), or\n  - Add logic to select one version (e.g., the latest) in a preliminary subquery per classifier_name; otherwise accept all versions as the user did not specify a version constraint.\n\n10) Performance and indexing considerations\n- The subquery filtering by ranking = 1 should use the partial index ix_classification_rank1 and then filter by classifier_name = 'lc_classifier' and class_name = 'CEP'.\n- The join p.oid = o.oid should use:\n  - object primary key on oid\n  - probability hash index ix_probabilities_oid on oid\n- The ndet filter can use ix_object_ndet.\n- Apply the strictest filters as early as possible (in the subquery and in the object join) to minimize the number of rows joined to the full probability table.\n\n11) Summary of the logical flow\n- Build subquery top_cep: probability filtered to lc_classifier, ranking = 1, class_name = 'CEP', probability > 0.76 \u2192 select oids.\n- Join object with top_cep and filter object.ndet >= 100 to get qualifying objects and their static attributes.\n- Join probability again (restricted to lc_classifier only, no ranking filter) to retrieve all class probabilities per qualifying object.\n- Select the requested columns and order by oid, ranking.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the required output columns and their tables\n- From object:\n  - object.oid\n  - object.meanra\n  - object.meandec\n  - object.ndet\n  - object.firstmjd\n  - object.deltajd\n  - object.g_r_max\n- From probability:\n  - probability.classifier_name\n  - probability.class_name\n  - probability.ranking\n  - probability.probability\n\n2) Identify the tables to use and their relationships\n- object is the main table with one row per source (key: object.oid).\n- probability contains classification results for each object and classifier (joined on probability.oid = object.oid).\n- We will use INNER JOINs to restrict to objects meeting the selection criteria.\n\n3) Define the selection criteria based on the user request\n- Objects must be classified by the light curve classifier:\n  - probability.classifier_name = 'lc_classifier'\n- Objects must be \u201cmost likely to be Cepheid\u201d:\n  - Use the ranking of the lc_classifier to identify the most likely class: probability.ranking = 1\n  - Enforce the class to be Cepheid: probability.class_name = 'CEP'\n  - Enforce the top-class probability threshold: probability.probability > 0.76\n- Objects must have 100 or more detections:\n  - object.ndet >= 100\n\n4) Plan the query structure using a subquery to select qualifying objects\n- Create a subquery (e.g., top_cep) that selects only the oids of objects whose most likely class from lc_classifier is 'CEP' with probability > 0.76:\n  - From probability\n  - WHERE classifier_name = 'lc_classifier'\n  - AND ranking = 1\n  - AND class_name = 'CEP'\n  - AND probability > 0.76\n  - SELECT DISTINCT oid\n- This subquery will leverage the existing partial index ix_classification_rank1 (ranking = 1) and then filter by classifier_name and class_name.\n\n5) Join the qualifying objects with object to enforce ndet criterion and fetch object columns\n- INNER JOIN object o with top_cep t on o.oid = t.oid\n- Apply object.ndet >= 100 (either in the JOIN or in a WHERE clause after joining).\n\n6) Join the probability table again to fetch all class probabilities for the qualifying objects\n- INNER JOIN probability p on p.oid = o.oid\n- Restrict to p.classifier_name = 'lc_classifier' to return only the light curve classifier\u2019s classes.\n- Do not restrict by p.ranking in this join, because the user wants \u201cthe ranking and the probability columns for each class of each object\u201d (i.e., include all classes\u2019 rows for the lc_classifier for those objects).\n\n7) Select the required columns\n- From object: o.oid, o.meanra, o.meandec, o.ndet, o.firstmjd, o.deltajd, o.g_r_max\n- From probability: p.classifier_name, p.class_name, p.ranking, p.probability\n\n8) Order the results for readability\n- ORDER BY o.oid ASC, p.ranking ASC (so each object\u2019s classes are listed from most likely to least likely).\n\n9) Optional handling of classifier_version\n- If multiple classifier versions exist in probability, the plan above will return multiple rows per class per object (one per version). If you want a single version:\n  - Either specify a fixed version in both the subquery and the main join (p.classifier_version = '...'), or\n  - Add logic to select one version (e.g., the latest) in a preliminary subquery per classifier_name; otherwise accept all versions as the user did not specify a version constraint.\n\n10) Performance and indexing considerations\n- The subquery filtering by ranking = 1 should use the partial index ix_classification_rank1 and then filter by classifier_name = 'lc_classifier' and class_name = 'CEP'.\n- The join p.oid = o.oid should use:\n  - object primary key on oid\n  - probability hash index ix_probabilities_oid on oid\n- The ndet filter can use ix_object_ndet.\n- Apply the strictest filters as early as possible (in the subquery and in the object join) to minimize the number of rows joined to the full probability table.\n\n11) Summary of the logical flow\n- Build subquery top_cep: probability filtered to lc_classifier, ranking = 1, class_name = 'CEP', probability > 0.76 \u2192 select oids.\n- Join object with top_cep and filter object.ndet >= 100 to get qualifying objects and their static attributes.\n- Join probability again (restricted to lc_classifier only, no ranking filter) to retrieve all class probabilities per qualifying object.\n- Select the requested columns and order by oid, ranking."
                },
                "in_toks": 5177,
                "out_toks": 2760,
                "id": "chatcmpl-CSqs1yMNsZHNoF5wzSxodeOneDC22",
                "created": 1760992453,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Objects whose top lc_classifier class is 'CEP' with probability > 0.76,\n-- having at least 100 detections; then return all lc_classifier class probabilities for those objects.\nWITH top_cep AS (\n    SELECT DISTINCT p1.oid\n    FROM probability p1\n    WHERE p1.classifier_name = 'lc_classifier'\n      AND p1.ranking = 1\n      AND p1.class_name = 'CEP'\n      AND p1.probability > 0.76\n)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    p.classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM top_cep t\nINNER JOIN object o\n    ON o.oid = t.oid\nINNER JOIN probability p\n    ON p.oid = o.oid\nWHERE o.ndet >= 100\n  AND p.classifier_name = 'lc_classifier'\nORDER BY o.oid ASC, p.ranking ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects whose top lc_classifier class is 'CEP' with probability > 0.76,\n-- having at least 100 detections; then return all lc_classifier class probabilities for those objects.\nWITH top_cep AS (\n    SELECT DISTINCT p1.oid\n    FROM probability p1\n    WHERE p1.classifier_name = 'lc_classifier'\n      AND p1.ranking = 1\n      AND p1.class_name = 'CEP'\n      AND p1.probability > 0.76\n)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    p.classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM top_cep t\nINNER JOIN object o\n    ON o.oid = t.oid\nINNER JOIN probability p\n    ON p.oid = o.oid\nWHERE o.ndet >= 100\n  AND p.classifier_name = 'lc_classifier'\nORDER BY o.oid ASC, p.ranking ASC;\n```"
                },
                "in_toks": 3089,
                "out_toks": 2169,
                "id": "chatcmpl-CSr8e0Bf3eNHWnBW9UrqcE5jhacVP",
                "created": 1760993484,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "27",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'feature']",
                    "1": "['object', 'probability']"
                },
                "in_toks": 661,
                "out_toks": 3043,
                "id": "chatcmpl-CSnQJ7a0dL9yoLji7XUSpWvCUqx4j",
                "created": 1760979203,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1138,
                "out_toks": 975,
                "id": "chatcmpl-CSneOPZZegDgJ46C4l2l3HVbDmw3h",
                "created": 1760980076,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Identify required tables and columns\n- Tables:\n  - object: main per-object attributes.\n  - probability: per-class classification outputs.\n- Columns to return:\n  - From object: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max.\n  - From probability: classifier_name, class_name, ranking, probability.\n- Join key: probability.oid = object.oid.\n\n2) Interpret the selection criteria\n- Objects \u201cmost likely to be cepheid\u201d by the lc_classifier:\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1 (most likely class)\n  - probability.class_name = 'CEP'\n  - probability.probability > 0.76\n- Objects with at least 100 detections:\n  - object.ndet >= 100\n- Return \u201cfor each class of each object classified by the lc_classifier\u201d:\n  - For the selected objects, return all probability rows for classifier_name = 'lc_classifier' (i.e., do not restrict ranking to 1 in the output; include all classes).\n- Classifier version consistency:\n  - To avoid mixing versions, use the same classifier_version of the row that satisfies the rank-1 CEP condition when retrieving \u201ceach class\u201d per object.\n\n3) Build a subquery (candidate selection) to capture qualifying objects and classifier_version\n- From probability, filter:\n  - classifier_name = 'lc_classifier'\n  - ranking = 1\n  - class_name = 'CEP'\n  - probability > 0.76\n- Select the columns needed for joining later:\n  - oid, classifier_name, classifier_version\n- This subquery defines the set of objects that are rank-1 CEP with probability > 0.76 for a specific classifier_version.\n\n4) Join candidates to object and apply ndet filter\n- INNER JOIN candidate subquery to object on oid.\n- Filter: object.ndet >= 100.\n- Keep all object columns needed for output.\n\n5) Retrieve \u201ceach class\u201d probabilities for the lc_classifier using the same version\n- INNER JOIN probability (alias p_all) to the previous result on:\n  - p_all.oid = candidate.oid\n  - p_all.classifier_name = 'lc_classifier'\n  - p_all.classifier_version = candidate.classifier_version\n- Do not restrict p_all.ranking to 1 here (the user explicitly asked for each class). This overrides the default \u201cranking = 1\u201d output condition while still using ranking = 1 in the candidate subquery.\n\n6) Select the final output columns\n- From object: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max.\n- From p_all (probability): classifier_name, class_name, ranking, probability.\n\n7) Optional sorting for readability\n- ORDER BY object.oid ASC, p_all.ranking ASC to list classes per object by descending likelihood (ranking 1, 2, 3, ...).\n\n8) Performance and indexing considerations\n- The candidate subquery leverages:\n  - probability partial index on ranking = 1 (ix_classification_rank1).\n  - Filtering by classifier_name and class_name allows efficient narrowing when combined with the ranking = 1 predicate.\n- Joins use:\n  - probability.oid hash index (ix_probabilities_oid) for joining to object and p_all.\n- Filtering object.ndet >= 100 can use ix_object_ndet.\n- Keeping the candidate set small (by applying rank-1, class_name = 'CEP', probability > 0.76 early) reduces join costs.\n\n9) Summary of logical flow\n- Subquery: select oids and the associated lc_classifier version where the lc_classifier\u2019s rank-1 class is 'CEP' with probability > 0.76.\n- Join to object to ensure ndet >= 100 and to fetch object attributes.\n- Join to probability again to fetch all classes for lc_classifier for those oids in the same classifier_version.\n- Return the specified object columns plus per-class classifier_name, class_name, ranking, and probability.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Identify required tables and columns\n- Tables:\n  - object: main per-object attributes.\n  - probability: per-class classification outputs.\n- Columns to return:\n  - From object: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max.\n  - From probability: classifier_name, class_name, ranking, probability.\n- Join key: probability.oid = object.oid.\n\n2) Interpret the selection criteria\n- Objects \u201cmost likely to be cepheid\u201d by the lc_classifier:\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1 (most likely class)\n  - probability.class_name = 'CEP'\n  - probability.probability > 0.76\n- Objects with at least 100 detections:\n  - object.ndet >= 100\n- Return \u201cfor each class of each object classified by the lc_classifier\u201d:\n  - For the selected objects, return all probability rows for classifier_name = 'lc_classifier' (i.e., do not restrict ranking to 1 in the output; include all classes).\n- Classifier version consistency:\n  - To avoid mixing versions, use the same classifier_version of the row that satisfies the rank-1 CEP condition when retrieving \u201ceach class\u201d per object.\n\n3) Build a subquery (candidate selection) to capture qualifying objects and classifier_version\n- From probability, filter:\n  - classifier_name = 'lc_classifier'\n  - ranking = 1\n  - class_name = 'CEP'\n  - probability > 0.76\n- Select the columns needed for joining later:\n  - oid, classifier_name, classifier_version\n- This subquery defines the set of objects that are rank-1 CEP with probability > 0.76 for a specific classifier_version.\n\n4) Join candidates to object and apply ndet filter\n- INNER JOIN candidate subquery to object on oid.\n- Filter: object.ndet >= 100.\n- Keep all object columns needed for output.\n\n5) Retrieve \u201ceach class\u201d probabilities for the lc_classifier using the same version\n- INNER JOIN probability (alias p_all) to the previous result on:\n  - p_all.oid = candidate.oid\n  - p_all.classifier_name = 'lc_classifier'\n  - p_all.classifier_version = candidate.classifier_version\n- Do not restrict p_all.ranking to 1 here (the user explicitly asked for each class). This overrides the default \u201cranking = 1\u201d output condition while still using ranking = 1 in the candidate subquery.\n\n6) Select the final output columns\n- From object: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max.\n- From p_all (probability): classifier_name, class_name, ranking, probability.\n\n7) Optional sorting for readability\n- ORDER BY object.oid ASC, p_all.ranking ASC to list classes per object by descending likelihood (ranking 1, 2, 3, ...).\n\n8) Performance and indexing considerations\n- The candidate subquery leverages:\n  - probability partial index on ranking = 1 (ix_classification_rank1).\n  - Filtering by classifier_name and class_name allows efficient narrowing when combined with the ranking = 1 predicate.\n- Joins use:\n  - probability.oid hash index (ix_probabilities_oid) for joining to object and p_all.\n- Filtering object.ndet >= 100 can use ix_object_ndet.\n- Keeping the candidate set small (by applying rank-1, class_name = 'CEP', probability > 0.76 early) reduces join costs.\n\n9) Summary of logical flow\n- Subquery: select oids and the associated lc_classifier version where the lc_classifier\u2019s rank-1 class is 'CEP' with probability > 0.76.\n- Join to object to ensure ndet >= 100 and to fetch object attributes.\n- Join to probability again to fetch all classes for lc_classifier for those oids in the same classifier_version.\n- Return the specified object columns plus per-class classifier_name, class_name, ranking, and probability."
                },
                "in_toks": 2745,
                "out_toks": 2852,
                "id": "chatcmpl-CSquRgC3k31CRhDIlz5osumzOt7a9",
                "created": 1760992603,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Objects with ndet >= 100 whose lc_classifier rank-1 class is 'CEP' with probability > 0.76,\n-- returning all lc_classifier classes (same classifier_version) per qualifying object.\nWITH cep_rank1 AS (\n    SELECT\n        p.oid,\n        p.classifier_version\n    FROM probability AS p\n    WHERE\n        p.classifier_name = 'lc_classifier'\n        AND p.ranking = 1\n        AND p.class_name = 'CEP'\n        AND p.probability > 0.76\n)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    p_all.classifier_name,\n    p_all.class_name,\n    p_all.ranking,\n    p_all.probability\nFROM cep_rank1 AS c\nINNER JOIN object AS o\n    ON o.oid = c.oid\nINNER JOIN probability AS p_all\n    ON p_all.oid = c.oid\n    AND p_all.classifier_name = 'lc_classifier'\n    AND p_all.classifier_version = c.classifier_version\nWHERE\n    o.ndet >= 100\nORDER BY\n    o.oid ASC,\n    p_all.ranking ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with ndet >= 100 whose lc_classifier rank-1 class is 'CEP' with probability > 0.76,\n-- returning all lc_classifier classes (same classifier_version) per qualifying object.\nWITH cep_rank1 AS (\n    SELECT\n        p.oid,\n        p.classifier_version\n    FROM probability AS p\n    WHERE\n        p.classifier_name = 'lc_classifier'\n        AND p.ranking = 1\n        AND p.class_name = 'CEP'\n        AND p.probability > 0.76\n)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    p_all.classifier_name,\n    p_all.class_name,\n    p_all.ranking,\n    p_all.probability\nFROM cep_rank1 AS c\nINNER JOIN object AS o\n    ON o.oid = c.oid\nINNER JOIN probability AS p_all\n    ON p_all.oid = c.oid\n    AND p_all.classifier_name = 'lc_classifier'\n    AND p_all.classifier_version = c.classifier_version\nWHERE\n    o.ndet >= 100\nORDER BY\n    o.oid ASC,\n    p_all.ranking ASC;\n```"
                },
                "in_toks": 2925,
                "out_toks": 1437,
                "id": "chatcmpl-CSr8eK5eOpSlDgVhWVWzzPjcirkxt",
                "created": 1760993484,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "27",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 661,
                "out_toks": 1811,
                "id": "chatcmpl-CSsS15jpkW38D70xuXe6tdrT8Z3AA",
                "created": 1760998529,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1183,
                "out_toks": 591,
                "id": "chatcmpl-CSxPEEhbxyS2AyaXw2F8DkigYpnkb",
                "created": 1761017576,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects with ndet >= 100 whose top-ranked lc_classifier class is 'CEP' with probability > 0.76,\n-- returning, for those objects, all lc_classifier class probabilities (same classifier_version).\nWITH p_top AS (\n    SELECT\n        p.oid,\n        p.classifier_version\n    FROM probability p\n    WHERE\n        p.classifier_name = 'lc_classifier'\n        AND p.ranking = 1\n        AND p.class_name = 'CEP'\n        AND p.probability > 0.76\n)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    p.classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM p_top t\nINNER JOIN object o\n    ON o.oid = t.oid\nINNER JOIN probability p\n    ON p.oid = o.oid\n    AND p.classifier_name = 'lc_classifier'\n    AND p.classifier_version = t.classifier_version\nWHERE o.ndet >= 100\nORDER BY o.oid, p.ranking;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with ndet >= 100 whose top-ranked lc_classifier class is 'CEP' with probability > 0.76,\n-- returning, for those objects, all lc_classifier class probabilities (same classifier_version).\nWITH p_top AS (\n    SELECT\n        p.oid,\n        p.classifier_version\n    FROM probability p\n    WHERE\n        p.classifier_name = 'lc_classifier'\n        AND p.ranking = 1\n        AND p.class_name = 'CEP'\n        AND p.probability > 0.76\n)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    p.classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM p_top t\nINNER JOIN object o\n    ON o.oid = t.oid\nINNER JOIN probability p\n    ON p.oid = o.oid\n    AND p.classifier_name = 'lc_classifier'\n    AND p.classifier_version = t.classifier_version\nWHERE o.ndet >= 100\nORDER BY o.oid, p.ranking;\n```"
                },
                "in_toks": 2500,
                "out_toks": 1928,
                "id": "chatcmpl-CSy05dkl7I6lLROpcD6biezS9HDi4",
                "created": 1761019861,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "27",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 661,
                "out_toks": 915,
                "id": "chatcmpl-CSsSNuOmKoLQRTzxK9AxUVJjK6Kqt",
                "created": 1760998551,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1183,
                "out_toks": 975,
                "id": "chatcmpl-CSxPMZlNGHeuYhnpCfFiMuVrZejwN",
                "created": 1761017584,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Identify relevant tables and columns\n- Tables:\n  - object: holds per-object summary attributes.\n  - probability: holds per-class probabilities per object, classifier, and version.\n- Columns to return (as requested):\n  - From object: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n  - From probability: classifier_name, class_name, ranking, probability\n- Join key: object.oid = probability.oid\n\n2) Interpret the selection criteria\n- Objects \u201cclassified by the lc_classifier\u201d:\n  - probability.classifier_name = 'lc_classifier'\n- \u201cmost likely to be Cepheid\u201d:\n  - probability.ranking = 1\n  - probability.class_name = 'CEP'\n- \u201cwith a probability larger than 0.76\u201d for that top class:\n  - probability.probability > 0.76\n- \u201cwith 100 or more detections\u201d:\n  - object.ndet >= 100\n- Return \u201ceach class of each object classified by the lc_classifier\u201d:\n  - After selecting objects that satisfy the top-class CEP condition, return all lc_classifier class rows for those same objects (i.e., all class_name entries and their ranking/probability), ideally for the same classifier_version used by the top-class selection.\n\n3) Structure the query using a subquery for filtering on top-CEP objects\n- Create a subquery (alias pr_top) selecting oids that meet the top-class CEP condition:\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n  - probability.class_name = 'CEP'\n  - probability.probability > 0.76\n- Columns to project from pr_top:\n  - oid, classifier_name, classifier_version (keep classifier_version to ensure consistency of probabilities across versions when joining to all-classes later)\n\n4) Join pr_top to object to enforce the detection count\n- INNER JOIN object on object.oid = pr_top.oid\n- Filter: object.ndet >= 100\n- This identifies the set of objects that are:\n  - lc_classifier top-ranked as 'CEP' with prob > 0.76, and\n  - have ndet >= 100\n\n5) Join in all classes (for lc_classifier) for the selected objects\n- Join the probability table again (alias pr_all) to retrieve each class row for those objects:\n  - pr_all.oid = pr_top.oid\n  - pr_all.classifier_name = 'lc_classifier'\n  - To keep results consistent within a single classifier version, also join on:\n    - pr_all.classifier_version = pr_top.classifier_version\n- This returns one row per class for each selected object, covering all class_name values and their ranking/probability for that same classifier version of lc_classifier.\n\n6) Select the requested columns\n- From object: object.oid, object.meanra, object.meandec, object.ndet, object.firstmjd, object.deltajd, object.g_r_max\n- From pr_all (probability): pr_all.classifier_name, pr_all.class_name, pr_all.ranking, pr_all.probability\n\n7) Optional ordering for readability (not required by the user)\n- Suggested ORDER BY:\n  - pr_all.oid (or object.oid) to group rows by object,\n  - pr_all.ranking ASC to list classes from highest to lowest probability per object,\n  - Optionally, order objects by the top-class probability using pr_top.probability DESC.\n\n8) Performance and indexing considerations\n- The filter probability.ranking = 1 uses the partial index ix_classification_rank1.\n- The join on probability.oid uses ix_probabilities_oid (hash) and the primary key on object.oid.\n- The filter object.ndet >= 100 uses ix_object_ndet.\n- Keeping the pr_all join constrained to the same classifier_version as pr_top prevents mixing versions and reduces row multiplicity.\n\n9) Notes and assumptions\n- Class name for Cepheid is exactly 'CEP' (as defined for lc_classifier).\n- The default conditions requiring ranking = 1 and classifier_name = 'lc_classifier' are applied only in pr_top (the selection step). For pr_all (the return step), ranking is not restricted so that \u201ceach class\u201d is returned; classifier_name remains 'lc_classifier'.\n- If multiple classifier_version values exist for the same object, each version that meets the top-CEP constraint will produce its own set of per-class rows. If only a single version is desired, an additional constraint on classifier_version would be needed (not specified by the user).",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Identify relevant tables and columns\n- Tables:\n  - object: holds per-object summary attributes.\n  - probability: holds per-class probabilities per object, classifier, and version.\n- Columns to return (as requested):\n  - From object: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n  - From probability: classifier_name, class_name, ranking, probability\n- Join key: object.oid = probability.oid\n\n2) Interpret the selection criteria\n- Objects \u201cclassified by the lc_classifier\u201d:\n  - probability.classifier_name = 'lc_classifier'\n- \u201cmost likely to be Cepheid\u201d:\n  - probability.ranking = 1\n  - probability.class_name = 'CEP'\n- \u201cwith a probability larger than 0.76\u201d for that top class:\n  - probability.probability > 0.76\n- \u201cwith 100 or more detections\u201d:\n  - object.ndet >= 100\n- Return \u201ceach class of each object classified by the lc_classifier\u201d:\n  - After selecting objects that satisfy the top-class CEP condition, return all lc_classifier class rows for those same objects (i.e., all class_name entries and their ranking/probability), ideally for the same classifier_version used by the top-class selection.\n\n3) Structure the query using a subquery for filtering on top-CEP objects\n- Create a subquery (alias pr_top) selecting oids that meet the top-class CEP condition:\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n  - probability.class_name = 'CEP'\n  - probability.probability > 0.76\n- Columns to project from pr_top:\n  - oid, classifier_name, classifier_version (keep classifier_version to ensure consistency of probabilities across versions when joining to all-classes later)\n\n4) Join pr_top to object to enforce the detection count\n- INNER JOIN object on object.oid = pr_top.oid\n- Filter: object.ndet >= 100\n- This identifies the set of objects that are:\n  - lc_classifier top-ranked as 'CEP' with prob > 0.76, and\n  - have ndet >= 100\n\n5) Join in all classes (for lc_classifier) for the selected objects\n- Join the probability table again (alias pr_all) to retrieve each class row for those objects:\n  - pr_all.oid = pr_top.oid\n  - pr_all.classifier_name = 'lc_classifier'\n  - To keep results consistent within a single classifier version, also join on:\n    - pr_all.classifier_version = pr_top.classifier_version\n- This returns one row per class for each selected object, covering all class_name values and their ranking/probability for that same classifier version of lc_classifier.\n\n6) Select the requested columns\n- From object: object.oid, object.meanra, object.meandec, object.ndet, object.firstmjd, object.deltajd, object.g_r_max\n- From pr_all (probability): pr_all.classifier_name, pr_all.class_name, pr_all.ranking, pr_all.probability\n\n7) Optional ordering for readability (not required by the user)\n- Suggested ORDER BY:\n  - pr_all.oid (or object.oid) to group rows by object,\n  - pr_all.ranking ASC to list classes from highest to lowest probability per object,\n  - Optionally, order objects by the top-class probability using pr_top.probability DESC.\n\n8) Performance and indexing considerations\n- The filter probability.ranking = 1 uses the partial index ix_classification_rank1.\n- The join on probability.oid uses ix_probabilities_oid (hash) and the primary key on object.oid.\n- The filter object.ndet >= 100 uses ix_object_ndet.\n- Keeping the pr_all join constrained to the same classifier_version as pr_top prevents mixing versions and reduces row multiplicity.\n\n9) Notes and assumptions\n- Class name for Cepheid is exactly 'CEP' (as defined for lc_classifier).\n- The default conditions requiring ranking = 1 and classifier_name = 'lc_classifier' are applied only in pr_top (the selection step). For pr_all (the return step), ranking is not restricted so that \u201ceach class\u201d is returned; classifier_name remains 'lc_classifier'.\n- If multiple classifier_version values exist for the same object, each version that meets the top-CEP constraint will produce its own set of per-class rows. If only a single version is desired, an additional constraint on classifier_version would be needed (not specified by the user)."
                },
                "in_toks": 2790,
                "out_toks": 2960,
                "id": "chatcmpl-CSy0OvrLeKVlTW4e0BrYd91Wl8C24",
                "created": 1761019880,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Objects whose top-ranked lc_classifier class is 'CEP' with probability > 0.76\n-- Return all lc_classifier classes (same classifier_version) for those objects\n-- Restrict to objects with ndet >= 100 and return requested columns\nWITH pr_top AS (\n    SELECT\n        p.oid,\n        p.classifier_name,\n        p.classifier_version,\n        p.probability\n    FROM probability p\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n      AND p.class_name = 'CEP'\n      AND p.probability > 0.76\n)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    pr_all.classifier_name,\n    pr_all.class_name,\n    pr_all.ranking,\n    pr_all.probability\nFROM pr_top\nINNER JOIN object o\n    ON o.oid = pr_top.oid\nINNER JOIN probability pr_all\n    ON pr_all.oid = pr_top.oid\n   AND pr_all.classifier_name = pr_top.classifier_name\n   AND pr_all.classifier_version = pr_top.classifier_version\nWHERE o.ndet >= 100\nORDER BY o.oid, pr_all.ranking;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects whose top-ranked lc_classifier class is 'CEP' with probability > 0.76\n-- Return all lc_classifier classes (same classifier_version) for those objects\n-- Restrict to objects with ndet >= 100 and return requested columns\nWITH pr_top AS (\n    SELECT\n        p.oid,\n        p.classifier_name,\n        p.classifier_version,\n        p.probability\n    FROM probability p\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n      AND p.class_name = 'CEP'\n      AND p.probability > 0.76\n)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    pr_all.classifier_name,\n    pr_all.class_name,\n    pr_all.ranking,\n    pr_all.probability\nFROM pr_top\nINNER JOIN object o\n    ON o.oid = pr_top.oid\nINNER JOIN probability pr_all\n    ON pr_all.oid = pr_top.oid\n   AND pr_all.classifier_name = pr_top.classifier_name\n   AND pr_all.classifier_version = pr_top.classifier_version\nWHERE o.ndet >= 100\nORDER BY o.oid, pr_all.ranking;\n```"
                },
                "in_toks": 3033,
                "out_toks": 1447,
                "id": "chatcmpl-CSyL4Gf76VwaIxtU9mLUFjQunlQbo",
                "created": 1761021162,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "27",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 661,
                "out_toks": 1107,
                "id": "chatcmpl-CSsSa9powxoSVht4RKMmB8YJVs3gy",
                "created": 1760998564,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1183,
                "out_toks": 975,
                "id": "chatcmpl-CSxPWn0Z6gnWKgbiFyHenbPWexdYK",
                "created": 1761017594,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects with ndet >= 100 whose most likely lc_classifier class is 'CEP' with probability > 0.76\n-- For those objects, return all lc_classifier class probabilities (one row per class)\nWITH selected_oids AS (\n    SELECT DISTINCT p.oid\n    FROM probability p\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n      AND p.class_name = 'CEP'\n      AND p.probability > 0.76\n)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    p_all.classifier_name,\n    p_all.class_name,\n    p_all.ranking,\n    p_all.probability\nFROM object o\nINNER JOIN selected_oids s ON s.oid = o.oid\nINNER JOIN probability p_all\n    ON p_all.oid = o.oid\n   AND p_all.classifier_name = 'lc_classifier'\nWHERE o.ndet >= 100\nORDER BY o.oid, p_all.ranking;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with ndet >= 100 whose most likely lc_classifier class is 'CEP' with probability > 0.76\n-- For those objects, return all lc_classifier class probabilities (one row per class)\nWITH selected_oids AS (\n    SELECT DISTINCT p.oid\n    FROM probability p\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n      AND p.class_name = 'CEP'\n      AND p.probability > 0.76\n)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    p_all.classifier_name,\n    p_all.class_name,\n    p_all.ranking,\n    p_all.probability\nFROM object o\nINNER JOIN selected_oids s ON s.oid = o.oid\nINNER JOIN probability p_all\n    ON p_all.oid = o.oid\n   AND p_all.classifier_name = 'lc_classifier'\nWHERE o.ndet >= 100\nORDER BY o.oid, p_all.ranking;\n```"
                },
                "in_toks": 2500,
                "out_toks": 2235,
                "id": "chatcmpl-CSy0pkveLYq9rY0tLjSZcSKOjLrTF",
                "created": 1761019907,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "27",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 661,
                "out_toks": 1491,
                "id": "chatcmpl-CZM2tYuxRXaG1hpsrAh7F26DtVplW",
                "created": 1762542259,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1183,
                "out_toks": 911,
                "id": "chatcmpl-CZY5YGwHUh1kXRVixHSRBZrfkZUI8",
                "created": 1762588552,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n/* Return all lc_classifier class probabilities for objects with ndet >= 100\n   whose most likely (ranking=1) lc_classifier class is 'CEP' with probability > 0.76 */\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    p.classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\n   AND p.classifier_name = 'lc_classifier'\nWHERE\n    o.ndet >= 100\n    AND EXISTS (\n        SELECT 1\n        FROM probability pr1\n        WHERE pr1.oid = o.oid\n          AND pr1.classifier_name = 'lc_classifier'\n          AND pr1.ranking = 1\n          AND pr1.class_name = 'CEP'\n          AND pr1.probability > 0.76\n    );\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* Return all lc_classifier class probabilities for objects with ndet >= 100\n   whose most likely (ranking=1) lc_classifier class is 'CEP' with probability > 0.76 */\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    p.classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\n   AND p.classifier_name = 'lc_classifier'\nWHERE\n    o.ndet >= 100\n    AND EXISTS (\n        SELECT 1\n        FROM probability pr1\n        WHERE pr1.oid = o.oid\n          AND pr1.classifier_name = 'lc_classifier'\n          AND pr1.ranking = 1\n          AND pr1.class_name = 'CEP'\n          AND pr1.probability > 0.76\n    );\n```"
                },
                "in_toks": 2500,
                "out_toks": 2342,
                "id": "chatcmpl-CZaJbyY2yMqn8fMviT68j95TmKw3K",
                "created": 1762597111,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "27",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "probability",
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'feature']"
                },
                "in_toks": 661,
                "out_toks": 2131,
                "id": "chatcmpl-CZM3T8jFrymdeV6oMnUPkykS7dVYv",
                "created": 1762542295,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 3569,
                "out_toks": 975,
                "id": "chatcmpl-CZY5hyh3N9HjLzy8rQyOK5km6XTzU",
                "created": 1762588561,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Return, for each selected object:\n  - From object: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n  - From probability: classifier_name, class_name, ranking, probability\n- Selection criteria:\n  - Objects must have ndet >= 100\n  - Objects must be most likely Cepheid (CEP) under lc_classifier\n  - The top-ranked lc_classifier class probability must be > 0.76\n  - For each selected object, return the probabilities for all lc_classifier classes (i.e., all rankings), not only the top one\n\nTables and columns to use\n- object\n  - Columns needed: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n  - Indexes useful: ix_object_ndet (ndet)\n- probability\n  - Columns needed: oid, class_name, classifier_name, classifier_version, probability, ranking\n  - Default conditions for this table (unless overridden by the user):\n    - classifier_name = 'lc_classifier'\n    - ranking = 1 only when selecting \u201cmost likely\u201d class; otherwise include all rankings when returning \u201ceach class\u201d rows\n  - Indexes useful:\n    - ix_probabilities_oid (oid)\n    - ix_probabilities_ranking (ranking)\n    - ix_classification_rank1 partial index on ranking = 1 (useful for the top-class filter subquery)\n\nClarify class label\n- Cepheid corresponds to class_name = 'CEP' in the lc_classifier.\n\nVersion handling (classifier_version)\n- The probability table can contain multiple classifier_version values. To avoid duplicate rows per class/version and ensure consistency, restrict to the latest version of lc_classifier.\n- If a \u201clatest\u201d version is needed but not explicitly specified by the user:\n  - Compute the latest classifier_version for classifier_name = 'lc_classifier' as the maximum classifier_version (lexicographically) available in the probability table.\n  - Use that version to filter both the \u201ctop-CEP\u201d selection and the \u201call classes\u201d expansion.\n- If version filtering is not desired, drop the version restriction, understanding that multiple versions may produce duplicate rows per object/class.\n\nLogical breakdown and subqueries\n\n1) Subquery to determine the latest lc_classifier version (optional but recommended)\n- Build a subquery (or CTE) V_latest as:\n  - From probability\n  - Filter classifier_name = 'lc_classifier'\n  - Select the maximum classifier_version (e.g., max(classifier_version)) as latest_version\n- This will provide a single-row result with the latest_version to be used in subsequent filters.\n- If you cannot or do not want to fix a version, skip this step and remove version-based filters in the next steps.\n\n2) Subquery to select OIDs that are most likely CEP with probability > 0.76\n- Build a subquery (or CTE) S_topcep as:\n  - From probability\n  - Filters:\n    - classifier_name = 'lc_classifier'\n    - ranking = 1  (to use the most likely class; leverages ix_classification_rank1)\n    - class_name = 'CEP'\n    - probability > 0.76\n    - If using version filtering: classifier_version = V_latest.latest_version\n  - Output: distinct oid (only the object identifier is needed)\n\n3) Join to object to enforce ndet >= 100 and pick desired object-level columns\n- Inner join object O with S_topcep on O.oid = S_topcep.oid\n- Filter on O.ndet >= 100\n- After this step, you have the set of objects that satisfy:\n  - have at least 100 detections\n  - whose top lc_classifier class is CEP with probability > 0.76\n- Columns retained at this stage (from object): oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n\n4) Expand to \u201ceach class\u201d probabilities for the selected objects\n- Inner join the result of step 3 with probability P_all on O.oid = P_all.oid\n- Filters on P_all:\n  - classifier_name = 'lc_classifier'\n  - If using version filtering: classifier_version = V_latest.latest_version\n  - Do not filter by ranking (include all rankings 1..N) so that you return one row per lc_classifier class for each selected object\n- Columns needed from probability: classifier_name, class_name, ranking, probability\n\n5) Final column selection\n- Select the following columns from the joined result:\n  - object.oid\n  - object.meanra\n  - object.meandec\n  - object.ndet\n  - object.firstmjd\n  - object.deltajd\n  - object.g_r_max\n  - probability.classifier_name\n  - probability.class_name\n  - probability.ranking\n  - probability.probability\n\n6) Ordering\n- Order results to be readable and to group class rows by object and by ranking:\n  - ORDER BY object.oid ASC, probability.ranking ASC\n- This presents, for each object, classes sorted from most to least likely.\n\n7) Performance considerations\n- The filter ranking = 1 in S_topcep will use the partial index ix_classification_rank1 and btree on ranking.\n- Joining on oid will use ix_probabilities_oid (hash) and object primary key and/or oid join path.\n- The ndet >= 100 condition will use ix_object_ndet.\n- If the probability table is large and multiple classifier_versions exist, restricting to a single latest version will reduce row counts and improve performance.\n\n8) Edge cases and correctness notes\n- Ensure class_name is exactly 'CEP' (case-sensitive string, single quotes).\n- If you skip the version filter and multiple classifier_version values exist, the output will include multiple rows per object/class (one per version). If this is not desired, apply the version filter from step 1.\n- No spatial filtering or Q3C functions are needed for this request.\n\nSummary of the flow\n- V_latest: get latest lc_classifier version (optional but recommended)\n- S_topcep: from probability, select oids with lc_classifier, ranking = 1, class_name = 'CEP', probability > 0.76, and optionally the latest version\n- Join S_topcep with object and filter ndet >= 100; keep object columns\n- Join to probability (same classifier and version) without ranking filter to return per-class rows\n- Select required columns and order by oid, ranking",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Return, for each selected object:\n  - From object: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n  - From probability: classifier_name, class_name, ranking, probability\n- Selection criteria:\n  - Objects must have ndet >= 100\n  - Objects must be most likely Cepheid (CEP) under lc_classifier\n  - The top-ranked lc_classifier class probability must be > 0.76\n  - For each selected object, return the probabilities for all lc_classifier classes (i.e., all rankings), not only the top one\n\nTables and columns to use\n- object\n  - Columns needed: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n  - Indexes useful: ix_object_ndet (ndet)\n- probability\n  - Columns needed: oid, class_name, classifier_name, classifier_version, probability, ranking\n  - Default conditions for this table (unless overridden by the user):\n    - classifier_name = 'lc_classifier'\n    - ranking = 1 only when selecting \u201cmost likely\u201d class; otherwise include all rankings when returning \u201ceach class\u201d rows\n  - Indexes useful:\n    - ix_probabilities_oid (oid)\n    - ix_probabilities_ranking (ranking)\n    - ix_classification_rank1 partial index on ranking = 1 (useful for the top-class filter subquery)\n\nClarify class label\n- Cepheid corresponds to class_name = 'CEP' in the lc_classifier.\n\nVersion handling (classifier_version)\n- The probability table can contain multiple classifier_version values. To avoid duplicate rows per class/version and ensure consistency, restrict to the latest version of lc_classifier.\n- If a \u201clatest\u201d version is needed but not explicitly specified by the user:\n  - Compute the latest classifier_version for classifier_name = 'lc_classifier' as the maximum classifier_version (lexicographically) available in the probability table.\n  - Use that version to filter both the \u201ctop-CEP\u201d selection and the \u201call classes\u201d expansion.\n- If version filtering is not desired, drop the version restriction, understanding that multiple versions may produce duplicate rows per object/class.\n\nLogical breakdown and subqueries\n\n1) Subquery to determine the latest lc_classifier version (optional but recommended)\n- Build a subquery (or CTE) V_latest as:\n  - From probability\n  - Filter classifier_name = 'lc_classifier'\n  - Select the maximum classifier_version (e.g., max(classifier_version)) as latest_version\n- This will provide a single-row result with the latest_version to be used in subsequent filters.\n- If you cannot or do not want to fix a version, skip this step and remove version-based filters in the next steps.\n\n2) Subquery to select OIDs that are most likely CEP with probability > 0.76\n- Build a subquery (or CTE) S_topcep as:\n  - From probability\n  - Filters:\n    - classifier_name = 'lc_classifier'\n    - ranking = 1  (to use the most likely class; leverages ix_classification_rank1)\n    - class_name = 'CEP'\n    - probability > 0.76\n    - If using version filtering: classifier_version = V_latest.latest_version\n  - Output: distinct oid (only the object identifier is needed)\n\n3) Join to object to enforce ndet >= 100 and pick desired object-level columns\n- Inner join object O with S_topcep on O.oid = S_topcep.oid\n- Filter on O.ndet >= 100\n- After this step, you have the set of objects that satisfy:\n  - have at least 100 detections\n  - whose top lc_classifier class is CEP with probability > 0.76\n- Columns retained at this stage (from object): oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n\n4) Expand to \u201ceach class\u201d probabilities for the selected objects\n- Inner join the result of step 3 with probability P_all on O.oid = P_all.oid\n- Filters on P_all:\n  - classifier_name = 'lc_classifier'\n  - If using version filtering: classifier_version = V_latest.latest_version\n  - Do not filter by ranking (include all rankings 1..N) so that you return one row per lc_classifier class for each selected object\n- Columns needed from probability: classifier_name, class_name, ranking, probability\n\n5) Final column selection\n- Select the following columns from the joined result:\n  - object.oid\n  - object.meanra\n  - object.meandec\n  - object.ndet\n  - object.firstmjd\n  - object.deltajd\n  - object.g_r_max\n  - probability.classifier_name\n  - probability.class_name\n  - probability.ranking\n  - probability.probability\n\n6) Ordering\n- Order results to be readable and to group class rows by object and by ranking:\n  - ORDER BY object.oid ASC, probability.ranking ASC\n- This presents, for each object, classes sorted from most to least likely.\n\n7) Performance considerations\n- The filter ranking = 1 in S_topcep will use the partial index ix_classification_rank1 and btree on ranking.\n- Joining on oid will use ix_probabilities_oid (hash) and object primary key and/or oid join path.\n- The ndet >= 100 condition will use ix_object_ndet.\n- If the probability table is large and multiple classifier_versions exist, restricting to a single latest version will reduce row counts and improve performance.\n\n8) Edge cases and correctness notes\n- Ensure class_name is exactly 'CEP' (case-sensitive string, single quotes).\n- If you skip the version filter and multiple classifier_version values exist, the output will include multiple rows per object/class (one per version). If this is not desired, apply the version filter from step 1.\n- No spatial filtering or Q3C functions are needed for this request.\n\nSummary of the flow\n- V_latest: get latest lc_classifier version (optional but recommended)\n- S_topcep: from probability, select oids with lc_classifier, ranking = 1, class_name = 'CEP', probability > 0.76, and optionally the latest version\n- Join S_topcep with object and filter ndet >= 100; keep object columns\n- Join to probability (same classifier and version) without ranking filter to return per-class rows\n- Select required columns and order by oid, ranking"
                },
                "in_toks": 5177,
                "out_toks": 3429,
                "id": "chatcmpl-CZaTDNV1jVWJ5ooOtxFCeOy2FbM60",
                "created": 1762597707,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Objects with ndet >= 100 whose top lc_classifier class is 'CEP' with probability > 0.76,\n-- and return all lc_classifier class probabilities for those objects (latest classifier_version).\nWITH latest AS (\n    SELECT MAX(classifier_version) AS latest_version\n    FROM probability\n    WHERE classifier_name = 'lc_classifier'\n),\ntopcep AS (\n    SELECT p.oid\n    FROM probability p\n    JOIN latest v ON p.classifier_version = v.latest_version\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n      AND p.class_name = 'CEP'\n      AND p.probability > 0.76\n)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    pr.classifier_name,\n    pr.class_name,\n    pr.ranking,\n    pr.probability\nFROM topcep t\nJOIN object o ON o.oid = t.oid\nJOIN probability pr ON pr.oid = o.oid\nJOIN latest v ON pr.classifier_version = v.latest_version\nWHERE o.ndet >= 100\n  AND pr.classifier_name = 'lc_classifier'\nORDER BY o.oid ASC, pr.ranking ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with ndet >= 100 whose top lc_classifier class is 'CEP' with probability > 0.76,\n-- and return all lc_classifier class probabilities for those objects (latest classifier_version).\nWITH latest AS (\n    SELECT MAX(classifier_version) AS latest_version\n    FROM probability\n    WHERE classifier_name = 'lc_classifier'\n),\ntopcep AS (\n    SELECT p.oid\n    FROM probability p\n    JOIN latest v ON p.classifier_version = v.latest_version\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n      AND p.class_name = 'CEP'\n      AND p.probability > 0.76\n)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    pr.classifier_name,\n    pr.class_name,\n    pr.ranking,\n    pr.probability\nFROM topcep t\nJOIN object o ON o.oid = t.oid\nJOIN probability pr ON pr.oid = o.oid\nJOIN latest v ON pr.classifier_version = v.latest_version\nWHERE o.ndet >= 100\n  AND pr.classifier_name = 'lc_classifier'\nORDER BY o.oid ASC, pr.ranking ASC;\n```"
                },
                "in_toks": 3439,
                "out_toks": 2403,
                "id": "chatcmpl-CZb31NJmVaHoNyaveacsa5BMj4wAB",
                "created": 1762599927,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "27",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 661,
                "out_toks": 979,
                "id": "chatcmpl-CZM4ALXEJRY1EBGCMYlffkgfxGPUw",
                "created": 1762542338,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1183,
                "out_toks": 2063,
                "id": "chatcmpl-CZY5uq1t45gjs5l6gHIxnHIWgeh3l",
                "created": 1762588574,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and returned columns\n- You need, for each object that is most likely a Cepheid (CEP) according to the lc_classifier with probability > 0.76 and has ndet \u2265 100:\n  - From object: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n  - From probability (for lc_classifier): classifier_name, class_name, ranking, probability\n- \u201cFor each class of each object classified by the lc_classifier\u201d means: once the qualifying objects are selected, return all lc_classifier class probability rows for those objects (i.e., not only ranking=1 but all rankings for lc_classifier), so multiple rows per object (one per class) are expected.\n\n2) Identify involved tables and relevant columns\n- object (o):\n  - Required columns: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n  - Filter: ndet \u2265 100\n- probability (p):\n  - Required columns in output: classifier_name, class_name, ranking, probability\n  - Filters:\n    - Selection filter (top-class filter): ranking = 1, classifier_name = 'lc_classifier', class_name = 'CEP', probability > 0.76\n    - Output rows: classifier_name = 'lc_classifier' for all classes (no ranking filter, to get all classes)\n  - Also use classifier_version to ensure consistency across joins so that all classes returned correspond to the same classifier version that yielded CEP as rank-1.\n\n3) Outline the join strategy\n- Start from object o.\n- Inner-join a filtered probability subquery p_top that selects qualifying objects (rank-1 CEP with prob > 0.76 for lc_classifier). This leverages the default ranking=1 condition but narrows to CEP and prob > 0.76.\n- Inner-join another probability alias p_all to return all classes for the same classifier and the same classifier_version as p_top. This ensures you get \u201ceach class\u201d rows for the exact lc_classifier model version that produced the top CEP classification.\n- Apply the object constraint ndet \u2265 100.\n- This yields one row per object per lc_classifier class (i.e., up to 15 rows per object), limited to objects whose rank-1 lc_classifier class is CEP with prob > 0.76.\n\n4) Define the subquery (or inline derived table) to pick CEP rank-1 objects\n- Build a subquery (p_top) over probability:\n  - Columns needed in the join: oid, classifier_version (and optionally probability if you want to sort by it later).\n  - Filters:\n    - classifier_name = 'lc_classifier'\n    - ranking = 1\n    - class_name = 'CEP'\n    - probability > 0.76\n- This subquery ensures the selection uses the lc_classifier and rank-1 constraint as per defaults and user requirement.\n\n5) Join p_all to get all lc_classifier classes for those objects\n- Join probability as p_all to o and p_top using:\n  - p_all.oid = o.oid\n  - p_all.classifier_name = 'lc_classifier'\n  - p_all.classifier_version = p_top.classifier_version\n- Do not filter p_all by ranking, because you need \u201ceach class\u201d rows.\n\n6) Apply object-level detection count filter\n- In the WHERE clause add: o.ndet >= 100.\n\n7) Select the requested columns\n- From object (o): oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n- From p_all (probability): classifier_name, class_name, ranking, probability\n- No need to select classifier_version unless you want to expose it; the user did not request it.\n\n8) Optional ordering for readability\n- To group results meaningfully:\n  - ORDER BY o.oid ASC, p_all.ranking ASC\n- Alternatively, if you also want to prioritize objects with higher CEP probability:\n  - ORDER BY p_top.probability DESC, o.oid ASC, p_all.ranking ASC\n\n9) Index and performance considerations\n- The join and filters will benefit from existing indexes:\n  - probability: partial index on ranking = 1 (ix_classification_rank1) for p_top.\n  - probability: hash index on oid (ix_probabilities_oid) to join p_top and p_all to object.\n  - object: btree index on ndet (ix_object_ndet) for ndet \u2265 100 filter.\n- Keep classifier_name filter on 'lc_classifier' to reduce rows early.\n\n10) Notes and edge cases\n- Multiple classifier versions: If the same object has multiple lc_classifier versions where CEP is rank-1 with prob > 0.76, the query will return rows for each such version (since p_top may include multiple rows per oid). If you want only one version per object (e.g., the latest), add logic to pick a single classifier_version per oid (e.g., by joining to a per-oid max-version subquery if versioning is sortable/meaningful) and then join p_all on that version.\n- No spatial selection is requested; Q3C functions are not needed.\n- Default probability conditions: We intentionally override the default \u201cranking = 1\u201d only for the p_all join in order to retrieve all classes; the ranking=1 condition remains enforced in p_top for selecting the objects.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and returned columns\n- You need, for each object that is most likely a Cepheid (CEP) according to the lc_classifier with probability > 0.76 and has ndet \u2265 100:\n  - From object: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n  - From probability (for lc_classifier): classifier_name, class_name, ranking, probability\n- \u201cFor each class of each object classified by the lc_classifier\u201d means: once the qualifying objects are selected, return all lc_classifier class probability rows for those objects (i.e., not only ranking=1 but all rankings for lc_classifier), so multiple rows per object (one per class) are expected.\n\n2) Identify involved tables and relevant columns\n- object (o):\n  - Required columns: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n  - Filter: ndet \u2265 100\n- probability (p):\n  - Required columns in output: classifier_name, class_name, ranking, probability\n  - Filters:\n    - Selection filter (top-class filter): ranking = 1, classifier_name = 'lc_classifier', class_name = 'CEP', probability > 0.76\n    - Output rows: classifier_name = 'lc_classifier' for all classes (no ranking filter, to get all classes)\n  - Also use classifier_version to ensure consistency across joins so that all classes returned correspond to the same classifier version that yielded CEP as rank-1.\n\n3) Outline the join strategy\n- Start from object o.\n- Inner-join a filtered probability subquery p_top that selects qualifying objects (rank-1 CEP with prob > 0.76 for lc_classifier). This leverages the default ranking=1 condition but narrows to CEP and prob > 0.76.\n- Inner-join another probability alias p_all to return all classes for the same classifier and the same classifier_version as p_top. This ensures you get \u201ceach class\u201d rows for the exact lc_classifier model version that produced the top CEP classification.\n- Apply the object constraint ndet \u2265 100.\n- This yields one row per object per lc_classifier class (i.e., up to 15 rows per object), limited to objects whose rank-1 lc_classifier class is CEP with prob > 0.76.\n\n4) Define the subquery (or inline derived table) to pick CEP rank-1 objects\n- Build a subquery (p_top) over probability:\n  - Columns needed in the join: oid, classifier_version (and optionally probability if you want to sort by it later).\n  - Filters:\n    - classifier_name = 'lc_classifier'\n    - ranking = 1\n    - class_name = 'CEP'\n    - probability > 0.76\n- This subquery ensures the selection uses the lc_classifier and rank-1 constraint as per defaults and user requirement.\n\n5) Join p_all to get all lc_classifier classes for those objects\n- Join probability as p_all to o and p_top using:\n  - p_all.oid = o.oid\n  - p_all.classifier_name = 'lc_classifier'\n  - p_all.classifier_version = p_top.classifier_version\n- Do not filter p_all by ranking, because you need \u201ceach class\u201d rows.\n\n6) Apply object-level detection count filter\n- In the WHERE clause add: o.ndet >= 100.\n\n7) Select the requested columns\n- From object (o): oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n- From p_all (probability): classifier_name, class_name, ranking, probability\n- No need to select classifier_version unless you want to expose it; the user did not request it.\n\n8) Optional ordering for readability\n- To group results meaningfully:\n  - ORDER BY o.oid ASC, p_all.ranking ASC\n- Alternatively, if you also want to prioritize objects with higher CEP probability:\n  - ORDER BY p_top.probability DESC, o.oid ASC, p_all.ranking ASC\n\n9) Index and performance considerations\n- The join and filters will benefit from existing indexes:\n  - probability: partial index on ranking = 1 (ix_classification_rank1) for p_top.\n  - probability: hash index on oid (ix_probabilities_oid) to join p_top and p_all to object.\n  - object: btree index on ndet (ix_object_ndet) for ndet \u2265 100 filter.\n- Keep classifier_name filter on 'lc_classifier' to reduce rows early.\n\n10) Notes and edge cases\n- Multiple classifier versions: If the same object has multiple lc_classifier versions where CEP is rank-1 with prob > 0.76, the query will return rows for each such version (since p_top may include multiple rows per oid). If you want only one version per object (e.g., the latest), add logic to pick a single classifier_version per oid (e.g., by joining to a per-oid max-version subquery if versioning is sortable/meaningful) and then join p_all on that version.\n- No spatial selection is requested; Q3C functions are not needed.\n- Default probability conditions: We intentionally override the default \u201cranking = 1\u201d only for the p_all join in order to retrieve all classes; the ranking=1 condition remains enforced in p_top for selecting the objects."
                },
                "in_toks": 2790,
                "out_toks": 3713,
                "id": "chatcmpl-CZaKO7zlzvJatS4f57pcEbiYUpPKU",
                "created": 1762597160,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all lc_classifier class probabilities for objects whose rank-1 lc_classifier class is 'CEP' with probability > 0.76\n-- and have at least 100 detections. Include specified columns from object and probability.\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    p_all.classifier_name,\n    p_all.class_name,\n    p_all.ranking,\n    p_all.probability\nFROM object AS o\nINNER JOIN (\n    SELECT\n        oid,\n        classifier_version,\n        probability\n    FROM probability\n    WHERE\n        classifier_name = 'lc_classifier'\n        AND ranking = 1\n        AND class_name = 'CEP'\n        AND probability > 0.76\n) AS p_top\n    ON p_top.oid = o.oid\nINNER JOIN probability AS p_all\n    ON p_all.oid = o.oid\n    AND p_all.classifier_name = 'lc_classifier'\n    AND p_all.classifier_version = p_top.classifier_version\nWHERE\n    o.ndet >= 100\nORDER BY\n    p_top.probability DESC,\n    o.oid ASC,\n    p_all.ranking ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all lc_classifier class probabilities for objects whose rank-1 lc_classifier class is 'CEP' with probability > 0.76\n-- and have at least 100 detections. Include specified columns from object and probability.\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    p_all.classifier_name,\n    p_all.class_name,\n    p_all.ranking,\n    p_all.probability\nFROM object AS o\nINNER JOIN (\n    SELECT\n        oid,\n        classifier_version,\n        probability\n    FROM probability\n    WHERE\n        classifier_name = 'lc_classifier'\n        AND ranking = 1\n        AND class_name = 'CEP'\n        AND probability > 0.76\n) AS p_top\n    ON p_top.oid = o.oid\nINNER JOIN probability AS p_all\n    ON p_all.oid = o.oid\n    AND p_all.classifier_name = 'lc_classifier'\n    AND p_all.classifier_version = p_top.classifier_version\nWHERE\n    o.ndet >= 100\nORDER BY\n    p_top.probability DESC,\n    o.oid ASC,\n    p_all.ranking ASC;\n```"
                },
                "in_toks": 3210,
                "out_toks": 1369,
                "id": "chatcmpl-CZazWLlJIIo1WX5GtODyByv9G6gGL",
                "created": 1762599710,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "27",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 661,
                "out_toks": 1363,
                "id": "chatcmpl-CZM58TRLnantHtAn9BF7Uuy0Z4fSI",
                "created": 1762542398,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1183,
                "out_toks": 1423,
                "id": "chatcmpl-CZY6VKJbwNYCwpfZKm8FUSKdz6I82",
                "created": 1762588611,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Interpret the user request and translate to database terms\n- Goal: Return, for each qualifying object, all lc_classifier class-probability rows, together with basic object properties.\n- Qualifying objects: \n  - Have ndet \u2265 100 (object.ndet).\n  - Are \u201cmost likely\u201d to be Cepheid: in probability, the top-ranked (ranking = 1) row for classifier_name = 'lc_classifier' has class_name = 'CEP' and probability > 0.76.\n- Returned columns:\n  - From object: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max.\n  - From probability: classifier_name, class_name, ranking, probability.\n- Classifier scope: Only rows from classifier_name = 'lc_classifier' are needed.\n\n2) Identify tables and columns to use\n- object table:\n  - Required columns: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max.\n  - Filter: ndet \u2265 100.\n- probability table:\n  - Required columns: oid (for join), classifier_name, class_name, ranking, probability, (optionally classifier_version if disambiguation is needed).\n  - Filters:\n    - Selection (to define the set of objects): classifier_name = 'lc_classifier' AND ranking = 1 AND class_name = 'CEP' AND probability > 0.76.\n    - Output rows: classifier_name = 'lc_classifier' (no ranking filter; we need \u201ceach class\u201d for lc_classifier).\n\n3) Define the logical subqueries and joins\n- Subquery S (selector subquery):\n  - Purpose: Select the oids of objects whose most-likely (ranking = 1) lc_classifier class is 'CEP' with probability > 0.76.\n  - Source: probability.\n  - Filters in S:\n    - probability.classifier_name = 'lc_classifier'\n    - probability.ranking = 1\n    - probability.class_name = 'CEP'\n    - probability.probability > 0.76\n  - Output: distinct oid (SELECT DISTINCT oid) to avoid duplicates if multiple versions exist; optionally include classifier_version handling if necessary (see step 7).\n- Join 1:\n  - Join object o to subquery S on o.oid = S.oid.\n  - Also filter o.ndet \u2265 100.\n- Join 2:\n  - Join probability p to the result of Join 1 on p.oid = o.oid AND p.classifier_name = 'lc_classifier' to retrieve all classes for each qualifying object.\n  - Do not constrain p.ranking here, because the user wants \u201cfor each class.\u201d\n\n4) Specify the output columns\n- From object (alias o):\n  - o.oid\n  - o.meanra\n  - o.meandec\n  - o.ndet\n  - o.firstmjd\n  - o.deltajd\n  - o.g_r_max\n- From probability (alias p):\n  - p.classifier_name\n  - p.class_name\n  - p.ranking\n  - p.probability\n\n5) Apply necessary filters and rationale\n- In subquery S:\n  - Use classifier_name = 'lc_classifier', ranking = 1 to implement \u201cmost likely.\u201d\n  - Use class_name = 'CEP' to target Cepheids.\n  - Use probability > 0.76 as requested.\n- In Join 1 (object filter):\n  - Use ndet \u2265 100 to match \u201cwith 100 or more detections.\u201d\n- In Join 2 (probability for output):\n  - Restrict to classifier_name = 'lc_classifier' to return only lc_classifier classes.\n  - Do not apply ranking filter so that all classes are returned for each qualifying object.\n\n6) Ordering of results (optional but recommended)\n- For readability, order by:\n  - o.oid ASC, then p.ranking ASC (so class rows are shown from most likely to least likely per object).\n- Alternatively, order by p.probability DESC within each oid.\n\n7) Handling classifier_version (optional consideration)\n- The request does not ask for classifier_version. If multiple classifier versions exist in the probability table, subquery S might pick multiple rows per oid unless constrained. To avoid ambiguity:\n  - Option A: Add a constraint to target a specific classifier_version if known.\n  - Option B: Include classifier_version in the SELECT list to make version explicit.\n  - Option C: If needed, restrict to a single version via an additional step that selects the desired version per classifier (e.g., the latest), then join on that. If not specified by the user, omit and accept that multiple versions may produce multiple rows.\n\n8) Performance and index usage\n- Subquery S benefits from:\n  - probability partial index on ranking = 1 (ix_classification_rank1).\n  - probability btree index on probability (ix_probabilities_probability) and hash index on oid (ix_probabilities_oid).\n- object filtering by ndet uses ix_object_ndet.\n- Joining on oid uses primary key on object.oid and ix_probabilities_oid on probability.\n- Ensure DISTINCT in S to reduce duplicate oids early if multiple versions match; this reduces join output size.\n\n9) Final selection logic summary\n- Build S: qualifying oids where lc_classifier top class is CEP with probability > 0.76.\n- Join S to object and apply ndet \u2265 100.\n- Join to probability (lc_classifier only) to retrieve all class rows per qualifying object.\n- Select the requested columns and optionally order results by oid and ranking.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Interpret the user request and translate to database terms\n- Goal: Return, for each qualifying object, all lc_classifier class-probability rows, together with basic object properties.\n- Qualifying objects: \n  - Have ndet \u2265 100 (object.ndet).\n  - Are \u201cmost likely\u201d to be Cepheid: in probability, the top-ranked (ranking = 1) row for classifier_name = 'lc_classifier' has class_name = 'CEP' and probability > 0.76.\n- Returned columns:\n  - From object: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max.\n  - From probability: classifier_name, class_name, ranking, probability.\n- Classifier scope: Only rows from classifier_name = 'lc_classifier' are needed.\n\n2) Identify tables and columns to use\n- object table:\n  - Required columns: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max.\n  - Filter: ndet \u2265 100.\n- probability table:\n  - Required columns: oid (for join), classifier_name, class_name, ranking, probability, (optionally classifier_version if disambiguation is needed).\n  - Filters:\n    - Selection (to define the set of objects): classifier_name = 'lc_classifier' AND ranking = 1 AND class_name = 'CEP' AND probability > 0.76.\n    - Output rows: classifier_name = 'lc_classifier' (no ranking filter; we need \u201ceach class\u201d for lc_classifier).\n\n3) Define the logical subqueries and joins\n- Subquery S (selector subquery):\n  - Purpose: Select the oids of objects whose most-likely (ranking = 1) lc_classifier class is 'CEP' with probability > 0.76.\n  - Source: probability.\n  - Filters in S:\n    - probability.classifier_name = 'lc_classifier'\n    - probability.ranking = 1\n    - probability.class_name = 'CEP'\n    - probability.probability > 0.76\n  - Output: distinct oid (SELECT DISTINCT oid) to avoid duplicates if multiple versions exist; optionally include classifier_version handling if necessary (see step 7).\n- Join 1:\n  - Join object o to subquery S on o.oid = S.oid.\n  - Also filter o.ndet \u2265 100.\n- Join 2:\n  - Join probability p to the result of Join 1 on p.oid = o.oid AND p.classifier_name = 'lc_classifier' to retrieve all classes for each qualifying object.\n  - Do not constrain p.ranking here, because the user wants \u201cfor each class.\u201d\n\n4) Specify the output columns\n- From object (alias o):\n  - o.oid\n  - o.meanra\n  - o.meandec\n  - o.ndet\n  - o.firstmjd\n  - o.deltajd\n  - o.g_r_max\n- From probability (alias p):\n  - p.classifier_name\n  - p.class_name\n  - p.ranking\n  - p.probability\n\n5) Apply necessary filters and rationale\n- In subquery S:\n  - Use classifier_name = 'lc_classifier', ranking = 1 to implement \u201cmost likely.\u201d\n  - Use class_name = 'CEP' to target Cepheids.\n  - Use probability > 0.76 as requested.\n- In Join 1 (object filter):\n  - Use ndet \u2265 100 to match \u201cwith 100 or more detections.\u201d\n- In Join 2 (probability for output):\n  - Restrict to classifier_name = 'lc_classifier' to return only lc_classifier classes.\n  - Do not apply ranking filter so that all classes are returned for each qualifying object.\n\n6) Ordering of results (optional but recommended)\n- For readability, order by:\n  - o.oid ASC, then p.ranking ASC (so class rows are shown from most likely to least likely per object).\n- Alternatively, order by p.probability DESC within each oid.\n\n7) Handling classifier_version (optional consideration)\n- The request does not ask for classifier_version. If multiple classifier versions exist in the probability table, subquery S might pick multiple rows per oid unless constrained. To avoid ambiguity:\n  - Option A: Add a constraint to target a specific classifier_version if known.\n  - Option B: Include classifier_version in the SELECT list to make version explicit.\n  - Option C: If needed, restrict to a single version via an additional step that selects the desired version per classifier (e.g., the latest), then join on that. If not specified by the user, omit and accept that multiple versions may produce multiple rows.\n\n8) Performance and index usage\n- Subquery S benefits from:\n  - probability partial index on ranking = 1 (ix_classification_rank1).\n  - probability btree index on probability (ix_probabilities_probability) and hash index on oid (ix_probabilities_oid).\n- object filtering by ndet uses ix_object_ndet.\n- Joining on oid uses primary key on object.oid and ix_probabilities_oid on probability.\n- Ensure DISTINCT in S to reduce duplicate oids early if multiple versions match; this reduces join output size.\n\n9) Final selection logic summary\n- Build S: qualifying oids where lc_classifier top class is CEP with probability > 0.76.\n- Join S to object and apply ndet \u2265 100.\n- Join to probability (lc_classifier only) to retrieve all class rows per qualifying object.\n- Select the requested columns and optionally order results by oid and ranking."
                },
                "in_toks": 2790,
                "out_toks": 3363,
                "id": "chatcmpl-CZaUFNUKsQxhoaj6uWRNlvAGKx6Ht",
                "created": 1762597771,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Objects with ndet >= 100 whose top lc_classifier class is 'CEP' with probability > 0.76,\n-- returning all lc_classifier class probabilities per qualifying object.\nSELECT\n  o.oid,\n  o.meanra,\n  o.meandec,\n  o.ndet,\n  o.firstmjd,\n  o.deltajd,\n  o.g_r_max,\n  p.classifier_name,\n  p.class_name,\n  p.ranking,\n  p.probability\nFROM object AS o\nINNER JOIN probability AS p\n  ON p.oid = o.oid\nWHERE\n  o.ndet >= 100\n  AND p.classifier_name = 'lc_classifier'\n  AND EXISTS (\n    SELECT 1\n    FROM probability AS pr\n    WHERE\n      pr.oid = o.oid\n      AND pr.classifier_name = 'lc_classifier'\n      AND pr.ranking = 1\n      AND pr.class_name = 'CEP'\n      AND pr.probability > 0.76\n  )\nORDER BY o.oid ASC, p.ranking ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with ndet >= 100 whose top lc_classifier class is 'CEP' with probability > 0.76,\n-- returning all lc_classifier class probabilities per qualifying object.\nSELECT\n  o.oid,\n  o.meanra,\n  o.meandec,\n  o.ndet,\n  o.firstmjd,\n  o.deltajd,\n  o.g_r_max,\n  p.classifier_name,\n  p.class_name,\n  p.ranking,\n  p.probability\nFROM object AS o\nINNER JOIN probability AS p\n  ON p.oid = o.oid\nWHERE\n  o.ndet >= 100\n  AND p.classifier_name = 'lc_classifier'\n  AND EXISTS (\n    SELECT 1\n    FROM probability AS pr\n    WHERE\n      pr.oid = o.oid\n      AND pr.classifier_name = 'lc_classifier'\n      AND pr.ranking = 1\n      AND pr.class_name = 'CEP'\n      AND pr.probability > 0.76\n  )\nORDER BY o.oid ASC, p.ranking ASC;\n```"
                },
                "in_toks": 3244,
                "out_toks": 1773,
                "id": "chatcmpl-CZb8d4IpqxUEWrbwqQSjiVqWOHK63",
                "created": 1762600275,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "27",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']"
                },
                "in_toks": 661,
                "out_toks": 1744,
                "id": "chatcmpl-CZM5rECGOOjPrLkdRcZcoOUTKny6Z",
                "created": 1762542443,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1138,
                "out_toks": 1871,
                "id": "chatcmpl-CZY6qdJV1gaHkvabJEd2hYxkf5oDD",
                "created": 1762588632,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\nGoal\n- Return, for each object that is most likely a Cepheid with probability > 0.76 under the lc_classifier and has \u2265 100 detections, the following:\n  - From object: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n  - From probability (for each class, not only the top class): classifier_name, class_name, ranking, probability\n- Important: the selection criterion \u201cmost likely to be Cepheid with probability > 0.76\u201d must use probability.ranking = 1 and probability.class_name = 'CEP' for classifier_name = 'lc_classifier'. After selecting those oids, retrieve all lc_classifier classes for those objects (i.e., do not restrict to ranking = 1 in the final listing).\n\nTables and columns involved\n- object:\n  - oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n- probability:\n  - oid, class_name, classifier_name, classifier_version, probability, ranking\n\nFilters and conditions to apply\n- Base selection of objects (most likely Cepheid):\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n  - probability.class_name = 'CEP'\n  - probability.probability > 0.76\n- Detection count constraint:\n  - object.ndet >= 100\n- Final per-class listing for selected objects:\n  - probability.classifier_name = 'lc_classifier'\n  - No restriction on probability.ranking for this step (explicitly include all classes and rankings for the lc_classifier)\n\nJoin strategy\n1) Build a subquery or CTE (e.g., cep_candidates) from probability that selects the set of oid that satisfy:\n   - classifier_name = 'lc_classifier'\n   - ranking = 1\n   - class_name = 'CEP'\n   - probability > 0.76\n   Columns: cep_candidates.oid\n   Notes:\n   - This subquery will leverage the partial index on probability.ranking where ranking = 1 (ix_classification_rank1) and the btree index on probability.probability (ix_probabilities_probability), as well as the hash index on oid (ix_probabilities_oid) if used in joins.\n\n2) Join cep_candidates with object to enforce ndet >= 100 and fetch object columns:\n   - INNER JOIN object o ON o.oid = cep_candidates.oid\n   - WHERE o.ndet >= 100\n   Columns to retain from object: o.oid, o.meanra, o.meandec, o.ndet, o.firstmjd, o.deltajd, o.g_r_max\n   Notes:\n   - The btree index on object.ndet (ix_object_ndet) helps the ndet filter.\n   - This step yields the final set of objects that meet both the classification and detection constraints.\n\n3) Join the resulting objects to probability again to retrieve all classes for lc_classifier:\n   - INNER JOIN probability p_all ON p_all.oid = o.oid\n   - WHERE p_all.classifier_name = 'lc_classifier'\n   Columns to retrieve from probability: p_all.classifier_name, p_all.class_name, p_all.ranking, p_all.probability\n   Notes:\n   - Do not filter by p_all.ranking = 1 here (the user asked for \u201ceach class\u201d).\n   - The hash index on probability.oid (ix_probabilities_oid) will optimize the join on oid.\n\nFinal projection (columns to SELECT)\n- o.oid\n- o.meanra\n- o.meandec\n- o.ndet\n- o.firstmjd\n- o.deltajd\n- o.g_r_max\n- p_all.classifier_name\n- p_all.class_name\n- p_all.ranking\n- p_all.probability\n\nRow ordering\n- ORDER BY o.oid ASC, p_all.ranking ASC\n  - This groups results by object and lists classes by descending likelihood (ranking 1 is highest).\n\nAssumptions and optional refinements\n- The selection of \u201cmost likely Cepheid\u201d uses ranking = 1 with class_name = 'CEP' and probability > 0.76 under lc_classifier, as required.\n- For the per-class listing, multiple classifier_version rows might exist in probability for the same object/class. If you want to restrict to a specific version (e.g., the latest), add an explicit filter on probability.classifier_version. Otherwise, results will include all versions present.\n- No spatial filtering is required; Q3C functions are not used.\n- No need to SELECT * since the user specified exact columns.\n\nPerformance considerations\n- The base filter on probability.ranking = 1 and probability.probability > 0.76 is selective and will leverage:\n  - ix_classification_rank1 (partial index where ranking = 1)\n  - ix_probabilities_probability (btree on probability)\n- Joining on oid uses:\n  - ix_probabilities_oid (hash index on probability.oid)\n- Filtering on object.ndet uses:\n  - ix_object_ndet (btree on ndet)\n- Ensure statistics are up to date (ANALYZE) for optimal plans.\n\nSummary of construction\n- Create a subquery/CTE cep_candidates that returns oids where (classifier_name = 'lc_classifier' AND ranking = 1 AND class_name = 'CEP' AND probability > 0.76).\n- INNER JOIN cep_candidates to object with ndet >= 100, selecting the object columns requested.\n- INNER JOIN the resulting objects to probability filtered by classifier_name = 'lc_classifier' (no ranking filter) to retrieve class_name, ranking, and probability for every class per object.\n- Project the requested columns and order by oid, ranking.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\nGoal\n- Return, for each object that is most likely a Cepheid with probability > 0.76 under the lc_classifier and has \u2265 100 detections, the following:\n  - From object: oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n  - From probability (for each class, not only the top class): classifier_name, class_name, ranking, probability\n- Important: the selection criterion \u201cmost likely to be Cepheid with probability > 0.76\u201d must use probability.ranking = 1 and probability.class_name = 'CEP' for classifier_name = 'lc_classifier'. After selecting those oids, retrieve all lc_classifier classes for those objects (i.e., do not restrict to ranking = 1 in the final listing).\n\nTables and columns involved\n- object:\n  - oid, meanra, meandec, ndet, firstmjd, deltajd, g_r_max\n- probability:\n  - oid, class_name, classifier_name, classifier_version, probability, ranking\n\nFilters and conditions to apply\n- Base selection of objects (most likely Cepheid):\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n  - probability.class_name = 'CEP'\n  - probability.probability > 0.76\n- Detection count constraint:\n  - object.ndet >= 100\n- Final per-class listing for selected objects:\n  - probability.classifier_name = 'lc_classifier'\n  - No restriction on probability.ranking for this step (explicitly include all classes and rankings for the lc_classifier)\n\nJoin strategy\n1) Build a subquery or CTE (e.g., cep_candidates) from probability that selects the set of oid that satisfy:\n   - classifier_name = 'lc_classifier'\n   - ranking = 1\n   - class_name = 'CEP'\n   - probability > 0.76\n   Columns: cep_candidates.oid\n   Notes:\n   - This subquery will leverage the partial index on probability.ranking where ranking = 1 (ix_classification_rank1) and the btree index on probability.probability (ix_probabilities_probability), as well as the hash index on oid (ix_probabilities_oid) if used in joins.\n\n2) Join cep_candidates with object to enforce ndet >= 100 and fetch object columns:\n   - INNER JOIN object o ON o.oid = cep_candidates.oid\n   - WHERE o.ndet >= 100\n   Columns to retain from object: o.oid, o.meanra, o.meandec, o.ndet, o.firstmjd, o.deltajd, o.g_r_max\n   Notes:\n   - The btree index on object.ndet (ix_object_ndet) helps the ndet filter.\n   - This step yields the final set of objects that meet both the classification and detection constraints.\n\n3) Join the resulting objects to probability again to retrieve all classes for lc_classifier:\n   - INNER JOIN probability p_all ON p_all.oid = o.oid\n   - WHERE p_all.classifier_name = 'lc_classifier'\n   Columns to retrieve from probability: p_all.classifier_name, p_all.class_name, p_all.ranking, p_all.probability\n   Notes:\n   - Do not filter by p_all.ranking = 1 here (the user asked for \u201ceach class\u201d).\n   - The hash index on probability.oid (ix_probabilities_oid) will optimize the join on oid.\n\nFinal projection (columns to SELECT)\n- o.oid\n- o.meanra\n- o.meandec\n- o.ndet\n- o.firstmjd\n- o.deltajd\n- o.g_r_max\n- p_all.classifier_name\n- p_all.class_name\n- p_all.ranking\n- p_all.probability\n\nRow ordering\n- ORDER BY o.oid ASC, p_all.ranking ASC\n  - This groups results by object and lists classes by descending likelihood (ranking 1 is highest).\n\nAssumptions and optional refinements\n- The selection of \u201cmost likely Cepheid\u201d uses ranking = 1 with class_name = 'CEP' and probability > 0.76 under lc_classifier, as required.\n- For the per-class listing, multiple classifier_version rows might exist in probability for the same object/class. If you want to restrict to a specific version (e.g., the latest), add an explicit filter on probability.classifier_version. Otherwise, results will include all versions present.\n- No spatial filtering is required; Q3C functions are not used.\n- No need to SELECT * since the user specified exact columns.\n\nPerformance considerations\n- The base filter on probability.ranking = 1 and probability.probability > 0.76 is selective and will leverage:\n  - ix_classification_rank1 (partial index where ranking = 1)\n  - ix_probabilities_probability (btree on probability)\n- Joining on oid uses:\n  - ix_probabilities_oid (hash index on probability.oid)\n- Filtering on object.ndet uses:\n  - ix_object_ndet (btree on ndet)\n- Ensure statistics are up to date (ANALYZE) for optimal plans.\n\nSummary of construction\n- Create a subquery/CTE cep_candidates that returns oids where (classifier_name = 'lc_classifier' AND ranking = 1 AND class_name = 'CEP' AND probability > 0.76).\n- INNER JOIN cep_candidates to object with ndet >= 100, selecting the object columns requested.\n- INNER JOIN the resulting objects to probability filtered by classifier_name = 'lc_classifier' (no ranking filter) to retrieve class_name, ranking, and probability for every class per object.\n- Project the requested columns and order by oid, ranking."
                },
                "in_toks": 2745,
                "out_toks": 3647,
                "id": "chatcmpl-CZaLbMf3HGiMRCgkEQIOiuTAQaHYq",
                "created": 1762597235,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Objects most likely classified as Cepheid (CEP) by lc_classifier with probability > 0.76 and ndet >= 100,\n-- listing all lc_classifier classes (all rankings) per selected object.\nWITH cep_candidates AS (\n    SELECT p.oid\n    FROM probability AS p\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n      AND p.class_name = 'CEP'\n      AND p.probability > 0.76\n)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    p_all.classifier_name,\n    p_all.class_name,\n    p_all.ranking,\n    p_all.probability\nFROM cep_candidates AS c\nINNER JOIN object AS o\n    ON o.oid = c.oid\nINNER JOIN probability AS p_all\n    ON p_all.oid = o.oid\nWHERE o.ndet >= 100\n  AND p_all.classifier_name = 'lc_classifier'\nORDER BY o.oid ASC, p_all.ranking ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects most likely classified as Cepheid (CEP) by lc_classifier with probability > 0.76 and ndet >= 100,\n-- listing all lc_classifier classes (all rankings) per selected object.\nWITH cep_candidates AS (\n    SELECT p.oid\n    FROM probability AS p\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n      AND p.class_name = 'CEP'\n      AND p.probability > 0.76\n)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_max,\n    p_all.classifier_name,\n    p_all.class_name,\n    p_all.ranking,\n    p_all.probability\nFROM cep_candidates AS c\nINNER JOIN object AS o\n    ON o.oid = c.oid\nINNER JOIN probability AS p_all\n    ON p_all.oid = o.oid\nWHERE o.ndet >= 100\n  AND p_all.classifier_name = 'lc_classifier'\nORDER BY o.oid ASC, p_all.ranking ASC;\n```"
                },
                "in_toks": 3272,
                "out_toks": 1215,
                "id": "chatcmpl-CZb4P36HI4wWyVoUbvPohsU6xaike",
                "created": 1762600013,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "17": {
        "0": {
            "req_id": "17",
            "experiment_id": "run_0",
            "pred_tables": [
                "probability",
                "taxonomy",
                "magstat",
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'magstat', 'feature']",
                    "1": "['object', 'probability', 'taxonomy', 'magstat', 'feature']"
                },
                "in_toks": 629,
                "out_toks": 2353,
                "id": "chatcmpl-CSnQghlCZSCyxi02PHl2bE903Mx5M",
                "created": 1760979226,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 3817,
                "out_toks": 1615,
                "id": "chatcmpl-CSnec3Oc6jCXVaR96WyPBFBXhXviU",
                "created": 1760980090,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 5696,
                "out_toks": 4000,
                "id": "chatcmpl-CSquS8tuJWkk0Gk6uSceMFCE9JqQ2",
                "created": 1760992604,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* AGN objects (lc_classifier, rank=1) that vary in r band but have no detections or no variability in g band.\n   Variability metric used: amplitude = max(magpsf_corr) - min(magpsf_corr) per band.\n   - r band variability: amplitude_r > 0\n   - g band no detections or no variability: COALESCE(amplitude_g, 0) = 0\n   Returned columns: all (*) from probability, object, and both band stats subqueries.\n   Ordering: features (amplitude_r) ascending, then by oid.\n*/\nWITH r_stats AS (\n    SELECT\n        d.oid,\n        COUNT(*) AS n_r,\n        MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS amplitude_r,\n        STDDEV_POP(d.magpsf_corr) AS stddev_r\n    FROM detection d\n    WHERE d.fid = 2\n      AND d.corrected = TRUE\n      AND d.dubious = FALSE\n      AND d.magpsf_corr IS NOT NULL\n    GROUP BY d.oid\n),\ng_stats AS (\n    SELECT\n        d.oid,\n        COUNT(*) AS n_g,\n        MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS amplitude_g,\n        STDDEV_POP(d.magpsf_corr) AS stddev_g\n    FROM detection d\n    WHERE d.fid = 1\n      AND d.corrected = TRUE\n      AND d.dubious = FALSE\n      AND d.magpsf_corr IS NOT NULL\n    GROUP BY d.oid\n)\nSELECT\n    p.*,\n    o.*,\n    r_stats.*,\n    g_stats.*\nFROM probability p\nINNER JOIN object o ON o.oid = p.oid\nINNER JOIN r_stats ON r_stats.oid = p.oid\nLEFT JOIN g_stats ON g_stats.oid = p.oid\nWHERE p.class_name = 'AGN'\n  AND p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n  AND r_stats.amplitude_r > 0\n  AND COALESCE(g_stats.amplitude_g, 0) = 0\nORDER BY r_stats.amplitude_r ASC, p.oid ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* AGN objects (lc_classifier, rank=1) that vary in r band but have no detections or no variability in g band.\n   Variability metric used: amplitude = max(magpsf_corr) - min(magpsf_corr) per band.\n   - r band variability: amplitude_r > 0\n   - g band no detections or no variability: COALESCE(amplitude_g, 0) = 0\n   Returned columns: all (*) from probability, object, and both band stats subqueries.\n   Ordering: features (amplitude_r) ascending, then by oid.\n*/\nWITH r_stats AS (\n    SELECT\n        d.oid,\n        COUNT(*) AS n_r,\n        MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS amplitude_r,\n        STDDEV_POP(d.magpsf_corr) AS stddev_r\n    FROM detection d\n    WHERE d.fid = 2\n      AND d.corrected = TRUE\n      AND d.dubious = FALSE\n      AND d.magpsf_corr IS NOT NULL\n    GROUP BY d.oid\n),\ng_stats AS (\n    SELECT\n        d.oid,\n        COUNT(*) AS n_g,\n        MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS amplitude_g,\n        STDDEV_POP(d.magpsf_corr) AS stddev_g\n    FROM detection d\n    WHERE d.fid = 1\n      AND d.corrected = TRUE\n      AND d.dubious = FALSE\n      AND d.magpsf_corr IS NOT NULL\n    GROUP BY d.oid\n)\nSELECT\n    p.*,\n    o.*,\n    r_stats.*,\n    g_stats.*\nFROM probability p\nINNER JOIN object o ON o.oid = p.oid\nINNER JOIN r_stats ON r_stats.oid = p.oid\nLEFT JOIN g_stats ON g_stats.oid = p.oid\nWHERE p.class_name = 'AGN'\n  AND p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n  AND r_stats.amplitude_r > 0\n  AND COALESCE(g_stats.amplitude_g, 0) = 0\nORDER BY r_stats.amplitude_r ASC, p.oid ASC;\n```"
                },
                "in_toks": 3016,
                "out_toks": 3683,
                "id": "chatcmpl-CSr8etOCsdmXisEo6GRuA9QyT7On2",
                "created": 1760993484,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "17",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "magstat",
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'magstat', 'feature']",
                    "1": "['object', 'probability', 'taxonomy', 'magstat', 'feature']"
                },
                "in_toks": 629,
                "out_toks": 2353,
                "id": "chatcmpl-CSnQghlCZSCyxi02PHl2bE903Mx5M",
                "created": 1760979226,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 4299,
                "out_toks": 2127,
                "id": "chatcmpl-CSnfFZSemM329XzdphUX3XDeSWNQk",
                "created": 1760980129,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Return AGN objects (lc_classifier, top-1) that are variable in r band AND (no detections in g OR no variability in g).\n-- Return all columns and order by oid ASC and feature.value ASC.\n WITH p AS\n  (SELECT DISTINCT probability.oid\n   FROM probability\n   WHERE probability.class_name = 'AGN'\n     AND probability.classifier_name = 'lc_classifier'\n     AND probability.ranking = 1),\n      r_var AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN p ON p.oid = f.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 2 -- r band\n\n     AND f.value > 0),\n      g_no_det AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN p ON p.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.fid = 1 -- g band\n\n     AND f.value = 0),\n      g_no_var AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN p ON p.oid = f.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 1 -- g band\n\n     AND f.value <= 0),\n      g_cond AS\n  (SELECT oid\n   FROM g_no_det\n   UNION SELECT oid\n   FROM g_no_var),\n      cand AS\n  (SELECT oid\n   FROM r_var INTERSECT SELECT oid\n   FROM g_cond)\nSELECT pr.*,\n       o.*,\n       f.*,\n       cand.*\nFROM cand\nINNER JOIN OBJECT o ON o.oid = cand.oid\nINNER JOIN probability pr ON pr.oid = cand.oid\nAND pr.class_name = 'AGN'\nAND pr.classifier_name = 'lc_classifier'\nAND pr.ranking = 1\nINNER JOIN feature f ON f.oid = cand.oid\nORDER BY o.oid ASC,\n         f.value ASC;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\n- Return all objects classified as AGN (using the lc_classifier top-1 class) that:\n  - show variability in the r band, and\n  - either have no detections in the g band or show no variability in the g band.\n- Return all columns available (SELECT *) from the joined tables.\n- Order features by their value in ascending order within each object, and order the final result by oid.\n\nKey schema details to use\n- probability: (oid, class_name, classifier_name, classifier_version, probability, ranking)\n  - Default constraints: classifier_name = 'lc_classifier' AND ranking = 1\n  - Class for this request: class_name = 'AGN'\n- feature: (oid, name, value, fid, version)\n  - fid: 1 = g band; 2 = r band\n  - Features to use:\n    - 'ExcessVar' > 0 indicates variability; <= 0 indicates no variability\n    - 'n_det' = 0 indicates no detections in a given band\n- object: (oid, ... all object-level columns)\n- Sorting: final ORDER BY object.oid ASC, feature.value ASC\n\nHigh-level strategy\n- Build a base set of AGN oids from probability with default conditions.\n- From feature, construct:\n  - r-band variability set: 'ExcessVar' with fid = 2 and value > 0.\n  - g-band no-detections set: 'n_det' with fid = 1 and value = 0.\n  - g-band no-variability set: 'ExcessVar' with fid = 1 and value <= 0.\n- Combine the two g-band conditions with UNION (OR logic).\n- INTERSECT the r-band variability set with the g-band UNION set (AND logic).\n- Use the resulting oid set to retrieve the final rows from object, probability, and feature.\n- Order by oid (final query) and by feature.value ascending (features within each oid).\n\nDetailed steps and subqueries\n\n1) Base AGN classification subquery (P)\n- Purpose: Restrict to objects classified as AGN by lc_classifier with top-1 class.\n- Table: probability\n- Columns: probability.oid (and optionally all columns if needed later)\n- Filters:\n  - probability.class_name = 'AGN'\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n- Output: DISTINCT oid (deduplicate across classifier_version if present)\n- Index use: ix_classification_rank1 (ranking = 1), ix_probabilities_oid, ix_probabilities_probability\n\n2) r-band variability subquery (R_var)\n- Purpose: Select AGN oids whose r band shows variability.\n- Tables: feature INNER JOIN P on feature.oid = P.oid\n- Filters:\n  - feature.name = 'ExcessVar'\n  - feature.fid = 2  (r band)\n  - feature.value > 0\n- Output: DISTINCT oid\n- Note: Do not constrain feature.version (return any version available).\n\n3) g-band no-detections subquery (G_no_det)\n- Purpose: Select AGN oids with zero detections in g band.\n- Tables: feature INNER JOIN P on feature.oid = P.oid\n- Filters:\n  - feature.name = 'n_det'\n  - feature.fid = 1  (g band)\n  - feature.value = 0\n- Output: DISTINCT oid\n\n4) g-band no-variability subquery (G_no_var)\n- Purpose: Select AGN oids with no variability in g band.\n- Tables: feature INNER JOIN P on feature.oid = P.oid\n- Filters:\n  - feature.name = 'ExcessVar'\n  - feature.fid = 1  (g band)\n  - feature.value <= 0\n- Output: DISTINCT oid\n\n5) g-band condition (OR) via UNION (G_cond)\n- Purpose: Build the set of oids that satisfy \u201cno detections OR no variability\u201d in g band.\n- Operation: UNION (not UNION ALL) of subqueries G_no_det and G_no_var\n- Output: DISTINCT oid\n\n6) Final candidate oids via INTERSECT (C_final)\n- Purpose: Apply the AND condition \u201cr-band variable AND (g-band no detections OR g-band no variability)\u201d.\n- Operation: INTERSECT between R_var and G_cond\n- Output: DISTINCT oid\n\n7) Final data retrieval with full details and ordering\n- Purpose: Return all columns for the selected objects, including object properties, classification metadata, and all features; order features by value ascending and final query by oid.\n- Base set: C_final (DISTINCT oid)\n- Joins:\n  - INNER JOIN object o ON o.oid = C_final.oid (to return object-level columns)\n  - INNER JOIN probability p ON p.oid = o.oid with filters:\n    - p.class_name = 'AGN'\n    - p.classifier_name = 'lc_classifier'\n    - p.ranking = 1\n    (Include p.classifier_version and p.probability if desired; select all columns per instruction)\n  - INNER JOIN feature f ON f.oid = o.oid\n    (No filter on f.name/fid here, so you list all features for each selected object; this lets you order features by value)\n- Selection:\n  - SELECT * (from object, probability, and feature), as the user did not specify specific columns.\n- Ordering:\n  - ORDER BY o.oid ASC, f.value ASC\n    - This ensures the final query is ordered by oid, and features for each oid are ordered by their value in ascending order.\n\nOptional performance/robustness notes (if needed)\n- Use SELECT DISTINCT in subqueries P, R_var, G_no_det, G_no_var to prevent duplicate oids due to multiple feature versions or repeated rows.\n- If your deployment lacks feature rows for 'n_det' with value 0 when there are no g-band detections, you can augment G_no_det by also considering magstat (fid = 1) with ndet = 0, UNIONed into G_no_det; keep the rest of the plan unchanged.\n- Ensure fid mappings are respected: 1 = g, 2 = r.\n\nThis plan uses:\n- JOINs (feature with probability; final joins with object, probability, feature),\n- UNION (to implement the OR condition in g band),\n- INTERSECT (to combine r-band variability with the g-band OR condition),\n- Nested subqueries chaining these operations."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\n- Return all objects classified as AGN (using the lc_classifier top-1 class) that:\n  - show variability in the r band, and\n  - either have no detections in the g band or show no variability in the g band.\n- Return all columns available (SELECT *) from the joined tables.\n- Order features by their value in ascending order within each object, and order the final result by oid.\n\nKey schema details to use\n- probability: (oid, class_name, classifier_name, classifier_version, probability, ranking)\n  - Default constraints: classifier_name = 'lc_classifier' AND ranking = 1\n  - Class for this request: class_name = 'AGN'\n- feature: (oid, name, value, fid, version)\n  - fid: 1 = g band; 2 = r band\n  - Features to use:\n    - 'ExcessVar' > 0 indicates variability; <= 0 indicates no variability\n    - 'n_det' = 0 indicates no detections in a given band\n- object: (oid, ... all object-level columns)\n- Sorting: final ORDER BY object.oid ASC, feature.value ASC\n\nHigh-level strategy\n- Build a base set of AGN oids from probability with default conditions.\n- From feature, construct:\n  - r-band variability set: 'ExcessVar' with fid = 2 and value > 0.\n  - g-band no-detections set: 'n_det' with fid = 1 and value = 0.\n  - g-band no-variability set: 'ExcessVar' with fid = 1 and value <= 0.\n- Combine the two g-band conditions with UNION (OR logic).\n- INTERSECT the r-band variability set with the g-band UNION set (AND logic).\n- Use the resulting oid set to retrieve the final rows from object, probability, and feature.\n- Order by oid (final query) and by feature.value ascending (features within each oid).\n\nDetailed steps and subqueries\n\n1) Base AGN classification subquery (P)\n- Purpose: Restrict to objects classified as AGN by lc_classifier with top-1 class.\n- Table: probability\n- Columns: probability.oid (and optionally all columns if needed later)\n- Filters:\n  - probability.class_name = 'AGN'\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n- Output: DISTINCT oid (deduplicate across classifier_version if present)\n- Index use: ix_classification_rank1 (ranking = 1), ix_probabilities_oid, ix_probabilities_probability\n\n2) r-band variability subquery (R_var)\n- Purpose: Select AGN oids whose r band shows variability.\n- Tables: feature INNER JOIN P on feature.oid = P.oid\n- Filters:\n  - feature.name = 'ExcessVar'\n  - feature.fid = 2  (r band)\n  - feature.value > 0\n- Output: DISTINCT oid\n- Note: Do not constrain feature.version (return any version available).\n\n3) g-band no-detections subquery (G_no_det)\n- Purpose: Select AGN oids with zero detections in g band.\n- Tables: feature INNER JOIN P on feature.oid = P.oid\n- Filters:\n  - feature.name = 'n_det'\n  - feature.fid = 1  (g band)\n  - feature.value = 0\n- Output: DISTINCT oid\n\n4) g-band no-variability subquery (G_no_var)\n- Purpose: Select AGN oids with no variability in g band.\n- Tables: feature INNER JOIN P on feature.oid = P.oid\n- Filters:\n  - feature.name = 'ExcessVar'\n  - feature.fid = 1  (g band)\n  - feature.value <= 0\n- Output: DISTINCT oid\n\n5) g-band condition (OR) via UNION (G_cond)\n- Purpose: Build the set of oids that satisfy \u201cno detections OR no variability\u201d in g band.\n- Operation: UNION (not UNION ALL) of subqueries G_no_det and G_no_var\n- Output: DISTINCT oid\n\n6) Final candidate oids via INTERSECT (C_final)\n- Purpose: Apply the AND condition \u201cr-band variable AND (g-band no detections OR g-band no variability)\u201d.\n- Operation: INTERSECT between R_var and G_cond\n- Output: DISTINCT oid\n\n7) Final data retrieval with full details and ordering\n- Purpose: Return all columns for the selected objects, including object properties, classification metadata, and all features; order features by value ascending and final query by oid.\n- Base set: C_final (DISTINCT oid)\n- Joins:\n  - INNER JOIN object o ON o.oid = C_final.oid (to return object-level columns)\n  - INNER JOIN probability p ON p.oid = o.oid with filters:\n    - p.class_name = 'AGN'\n    - p.classifier_name = 'lc_classifier'\n    - p.ranking = 1\n    (Include p.classifier_version and p.probability if desired; select all columns per instruction)\n  - INNER JOIN feature f ON f.oid = o.oid\n    (No filter on f.name/fid here, so you list all features for each selected object; this lets you order features by value)\n- Selection:\n  - SELECT * (from object, probability, and feature), as the user did not specify specific columns.\n- Ordering:\n  - ORDER BY o.oid ASC, f.value ASC\n    - This ensures the final query is ordered by oid, and features for each oid are ordered by their value in ascending order.\n\nOptional performance/robustness notes (if needed)\n- Use SELECT DISTINCT in subqueries P, R_var, G_no_det, G_no_var to prevent duplicate oids due to multiple feature versions or repeated rows.\n- If your deployment lacks feature rows for 'n_det' with value 0 when there are no g-band detections, you can augment G_no_det by also considering magstat (fid = 1) with ndet = 0, UNIONed into G_no_det; keep the rest of the plan unchanged.\n- Ensure fid mappings are respected: 1 = g, 2 = r.\n\nThis plan uses:\n- JOINs (feature with probability; final joins with object, probability, feature),\n- UNION (to implement the OR condition in g band),\n- INTERSECT (to combine r-band variability with the g-band OR condition),\n- Nested subqueries chaining these operations."
                    },
                    "in_toks": 6178,
                    "out_toks": 5812,
                    "id": "chatcmpl-Cb53pB7NHBbjNLilyNYaiNBbprcaI",
                    "created": 1762953625,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Return AGN objects (lc_classifier, top-1) that are variable in r band AND (no detections in g OR no variability in g).\n-- Return all columns and order by oid ASC and feature.value ASC.\n WITH p AS\n  (SELECT DISTINCT probability.oid\n   FROM probability\n   WHERE probability.class_name = 'AGN'\n     AND probability.classifier_name = 'lc_classifier'\n     AND probability.ranking = 1),\n      r_var AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN p ON p.oid = f.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 2 -- r band\n\n     AND f.value > 0),\n      g_no_det AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN p ON p.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.fid = 1 -- g band\n\n     AND f.value = 0),\n      g_no_var AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN p ON p.oid = f.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 1 -- g band\n\n     AND f.value <= 0),\n      g_cond AS\n  (SELECT oid\n   FROM g_no_det\n   UNION SELECT oid\n   FROM g_no_var),\n      cand AS\n  (SELECT oid\n   FROM r_var INTERSECT SELECT oid\n   FROM g_cond)\nSELECT pr.*,\n       o.*,\n       f.*,\n       cand.*\nFROM cand\nINNER JOIN OBJECT o ON o.oid = cand.oid\nINNER JOIN probability pr ON pr.oid = cand.oid\nAND pr.class_name = 'AGN'\nAND pr.classifier_name = 'lc_classifier'\nAND pr.ranking = 1\nINNER JOIN feature f ON f.oid = cand.oid\nORDER BY o.oid ASC,\n         f.value ASC;"
                        },
                        "in_toks": 6225,
                        "out_toks": 3449,
                        "id": "chatcmpl-Cb55oMWRXG2tks21jDIO0qfQzrNLF",
                        "created": 1762953748,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "17",
            "experiment_id": "run_2",
            "pred_tables": [
                "probability",
                "taxonomy",
                "magstat",
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'magstat', 'feature']"
                },
                "in_toks": 629,
                "out_toks": 1175,
                "id": "chatcmpl-CSsSpk65ez952Be3nzdS0jZba5OYN",
                "created": 1760998579,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 3817,
                "out_toks": 2127,
                "id": "chatcmpl-CSxPhEt9FH5huJFlz4vTFjWZlrzwd",
                "created": 1761017605,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "/* Return AGN (lc_classifier, rank=1) with r-band variability (ExcessVar>0, fid=2) and either:\n   - g-band non-variability (ExcessVar<=0, fid=1), or\n   - no detections in g (magstat fid=1 missing or ndet=0).\n   Order features by value asc, and final result by oid. */ WITH p AS\n  (SELECT *\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND ranking = 1\n     AND class_name = 'AGN'),\n                                                                 fr AS\n  (/* r-band variable features */  SELECT f.*,\n                                          p.*\n   FROM feature f\n   INNER JOIN p ON f.oid = p.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 2\n     AND f.value > 0),\n                                                                 fg AS\n  (/* g-band non-variable features */  SELECT f.*,\n                                              p.*\n   FROM feature f\n   INNER JOIN p ON f.oid = p.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 1\n     AND f.value <= 0),\n                                                                 mg AS\n  (/* no detections in g band */  SELECT p.*,\n                                         ms.*\n   FROM p\n   LEFT JOIN magstat ms ON ms.oid = p.oid\n   AND ms.fid = 1\n   WHERE ms.oid IS NULL\n     OR ms.ndet = 0),\n                                                                 feat_union_oids AS\n  (SELECT oid\n   FROM fr\n   UNION SELECT oid\n   FROM fg),\n                                                                 feat_intersect_oids AS\n  (SELECT oid\n   FROM fr INTERSECT SELECT oid\n   FROM fg),\n                                                                 var_and_g_nonvar_oids AS\n  (/* r variable AND g non-variable */  SELECT u.oid\n   FROM feat_union_oids u\n   WHERE u.oid IN\n       (SELECT oid\n        FROM feat_intersect_oids)),\n                                                                 rvar_and_g_nodet_oids AS\n  (/* r variable AND g no-detections */  SELECT fr.oid\n   FROM fr INTERSECT SELECT mg.oid\n   FROM mg),\n                                                                 final_oids AS\n  (SELECT oid\n   FROM var_and_g_nonvar_oids\n   UNION SELECT oid\n   FROM rvar_and_g_nodet_oids)\nSELECT final_oids.*,\n       p.*,\n       fr.*,\n       fg.*,\n       mg.*,\n       fuo.*,\n       fio.*,\n       vang.*,\n       rng.*,\n       f_out.*,\n       ms_g.*,\n       ms_r.*\nFROM final_oids\nINNER JOIN p ON p.oid = final_oids.oid\nLEFT JOIN fr ON fr.oid = final_oids.oid\nLEFT JOIN fg ON fg.oid = final_oids.oid\nLEFT JOIN mg ON mg.oid = final_oids.oid\nLEFT JOIN feat_union_oids fuo ON fuo.oid = final_oids.oid\nLEFT JOIN feat_intersect_oids fio ON fio.oid = final_oids.oid\nLEFT JOIN var_and_g_nonvar_oids vang ON vang.oid = final_oids.oid\nLEFT JOIN rvar_and_g_nodet_oids rng ON rng.oid = final_oids.oid\nLEFT JOIN feature f_out ON f_out.oid = final_oids.oid\nAND f_out.name = 'ExcessVar'\nAND f_out.fid IN (1,\n                  2)\nLEFT JOIN magstat ms_g ON ms_g.oid = final_oids.oid\nAND ms_g.fid = 1\nLEFT JOIN magstat ms_r ON ms_r.oid = final_oids.oid\nAND ms_r.fid = 2\nORDER BY final_oids.oid ASC,\n         f_out.value ASC;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Return all objects (oids) classified as AGN (from lc_classifier, rank 1).\n- These objects must:\n  - Show variability in the r band, and\n  - Either have no detections in the g band, or show no variability in the g band.\n- Order the features by their value in ascending order, and order the final query by oid.\n- Select all columns since the user did not specify explicit columns.\n\nConventions and field details\n- Bands: fid=1 (g), fid=2 (r).\n- Use the feature named 'ExcessVar' to quantify variability (positive values indicate variability).\n- Tables and columns used:\n  - probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n  - feature(oid, name, value, fid, version)\n  - magstat(oid, fid, ndet, \u2026)\n- Default probability table filters (must be applied unless user says otherwise):\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n- Since multiple features are used, follow the specified multi-feature workflow (I to VI).\n\nStep-by-step subqueries and set logic\n\n1) Base AGN objects (subquery p)\n- FROM probability\n- WHERE\n  - class_name = 'AGN'\n  - classifier_name = 'lc_classifier'\n  - ranking = 1\n- SELECT p.oid (and keep all probability columns, i.e., SELECT * if desired).\n- This is the anchor set for all subsequent joins.\n\n2) r-band variability via features (subquery fr)\n- Purpose: oids that are variable in r.\n- FROM feature f\n- INNER JOIN p ON f.oid = p.oid\n- WHERE\n  - f.name = 'ExcessVar'\n  - f.fid = 2  (r band)\n  - f.value > 0  (shows variability)\n- SELECT f.* (include oid, name, value, fid, version) and optionally p.* if needed.\n- ORDER BY f.value ASC (order features by value as requested; ordering here does not change final set logic but honors the instruction to order features).\n\n3) g-band non-variability via features (subquery fg)\n- Purpose: oids that show no variability in g.\n- FROM feature f\n- INNER JOIN p ON f.oid = p.oid\n- WHERE\n  - f.name = 'ExcessVar'\n  - f.fid = 1  (g band)\n  - f.value <= 0  (no variability)\n- SELECT f.* (include oid, name, value, fid, version) and optionally p.* if needed.\n- ORDER BY f.value ASC (order features by value as requested).\n\n4) g-band \u201cno detections\u201d via magstat (subquery mg)\n- Purpose: oids that have no detections in g (either ndet = 0 or no magstat row at fid=1).\n- FROM p\n- LEFT JOIN magstat ms ON ms.oid = p.oid AND ms.fid = 1\n- WHERE\n  - ms.oid IS NULL OR ms.ndet = 0\n  - (This captures both no magstat row for g and ndet=0 explicitly.)\n- SELECT p.oid (and optionally ms.* for inspection).\n\n5) Multi-feature combination required by the rules (on feature subqueries only)\n- UNION of feature subqueries (step III):\n  - feat_union_oids = (SELECT oid FROM fr) UNION (SELECT oid FROM fg)\n- INTERSECT of feature subqueries (step IV):\n  - feat_intersect_oids = (SELECT oid FROM fr) INTERSECT (SELECT oid FROM fg)\n- Filter the UNION by INTERSECT (step V):\n  - var_and_g_nonvar_oids = SELECT oid FROM feat_union_oids WHERE oid IN (SELECT oid FROM feat_intersect_oids)\n  - This yields oids that have both: r variable feature and g non-variable feature.\n\n6) Add the \u201cno detections in g\u201d alternative to the final logic\n- Build the set for \u201cr variable AND g no-detections\u201d:\n  - rvar_and_g_nodet_oids = (SELECT oid FROM fr) INTERSECT (SELECT oid FROM mg)\n- Final set of oids that satisfy the full condition:\n  - final_oids = (SELECT oid FROM var_and_g_nonvar_oids) UNION (SELECT oid FROM rvar_and_g_nodet_oids)\n\n7) Final result selection (return all relevant rows, ordered appropriately)\n- Since the user did not specify columns, use SELECT * for completeness. Join back to include all relevant details:\n  - Start from final_oids.\n  - INNER JOIN p (to keep probability info for AGN objects).\n  - LEFT JOIN feature f_out ON f_out.oid = final_oids.oid AND f_out.name = 'ExcessVar' AND f_out.fid IN (1, 2)\n    - This exposes the variability features in both bands, satisfying \u201corder the features by their value.\u201d\n  - LEFT JOIN magstat ms_g ON ms_g.oid = final_oids.oid AND ms_g.fid = 1\n    - Include g-band ndet to document the \u201cno detections\u201d case.\n  - LEFT JOIN magstat ms_r ON ms_r.oid = final_oids.oid AND ms_r.fid = 2\n    - Optional: include r-band stats for context (e.g., ndet, magsigma).\n- Ordering:\n  - Ensure feature-level subqueries (fr, fg) include ORDER BY f.value ASC to \u201corder the features by their value.\u201d\n  - Final outer query ORDER BY final_oids.oid ASC (as requested: \u201cfinal query by oid\u201d).\n  - If you want stable per-oid feature ordering in the final output, you can add a secondary sort key by feature value: ORDER BY final_oids.oid ASC, f_out.value ASC.\n\nNotes and implementation details\n- Fid mapping: g=1, r=2 must be used exactly as above.\n- The feature table is transposed; we followed the required multi-feature procedure:\n  - Subqueries per feature (fr for r-band ExcessVar > 0, fg for g-band ExcessVar <= 0).\n  - UNION and INTERSECT on these feature subqueries.\n  - Filter the UNION by the INTERSECT.\n  - Added the magstat-based alternative (mg) by intersecting with the r-variable set and unioning with the previous result to incorporate the \u201cno detections in g\u201d case.\n- All class names and classifier_name must match exactly the given strings:\n  - 'AGN' and 'lc_classifier'.\n- Performance hints:\n  - The probability filters (ranking=1 and classifier_name='lc_classifier') leverage ix_classification_rank1 and should be selective; consider also filtering by class_name in the WHERE.\n  - For magstat, the anti-join pattern (LEFT JOIN ... WHERE ms.oid IS NULL OR ms.ndet = 0) or a NOT EXISTS subquery are both efficient given ix_magstats_ndet and ix_magstats_oid.\n- If multiple feature versions exist, the plan does not restrict feature.version; if you need a specific version, add a WHERE filter on feature.version consistently across fr, fg, and the final feature output join."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Return all objects (oids) classified as AGN (from lc_classifier, rank 1).\n- These objects must:\n  - Show variability in the r band, and\n  - Either have no detections in the g band, or show no variability in the g band.\n- Order the features by their value in ascending order, and order the final query by oid.\n- Select all columns since the user did not specify explicit columns.\n\nConventions and field details\n- Bands: fid=1 (g), fid=2 (r).\n- Use the feature named 'ExcessVar' to quantify variability (positive values indicate variability).\n- Tables and columns used:\n  - probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n  - feature(oid, name, value, fid, version)\n  - magstat(oid, fid, ndet, \u2026)\n- Default probability table filters (must be applied unless user says otherwise):\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n- Since multiple features are used, follow the specified multi-feature workflow (I to VI).\n\nStep-by-step subqueries and set logic\n\n1) Base AGN objects (subquery p)\n- FROM probability\n- WHERE\n  - class_name = 'AGN'\n  - classifier_name = 'lc_classifier'\n  - ranking = 1\n- SELECT p.oid (and keep all probability columns, i.e., SELECT * if desired).\n- This is the anchor set for all subsequent joins.\n\n2) r-band variability via features (subquery fr)\n- Purpose: oids that are variable in r.\n- FROM feature f\n- INNER JOIN p ON f.oid = p.oid\n- WHERE\n  - f.name = 'ExcessVar'\n  - f.fid = 2  (r band)\n  - f.value > 0  (shows variability)\n- SELECT f.* (include oid, name, value, fid, version) and optionally p.* if needed.\n- ORDER BY f.value ASC (order features by value as requested; ordering here does not change final set logic but honors the instruction to order features).\n\n3) g-band non-variability via features (subquery fg)\n- Purpose: oids that show no variability in g.\n- FROM feature f\n- INNER JOIN p ON f.oid = p.oid\n- WHERE\n  - f.name = 'ExcessVar'\n  - f.fid = 1  (g band)\n  - f.value <= 0  (no variability)\n- SELECT f.* (include oid, name, value, fid, version) and optionally p.* if needed.\n- ORDER BY f.value ASC (order features by value as requested).\n\n4) g-band \u201cno detections\u201d via magstat (subquery mg)\n- Purpose: oids that have no detections in g (either ndet = 0 or no magstat row at fid=1).\n- FROM p\n- LEFT JOIN magstat ms ON ms.oid = p.oid AND ms.fid = 1\n- WHERE\n  - ms.oid IS NULL OR ms.ndet = 0\n  - (This captures both no magstat row for g and ndet=0 explicitly.)\n- SELECT p.oid (and optionally ms.* for inspection).\n\n5) Multi-feature combination required by the rules (on feature subqueries only)\n- UNION of feature subqueries (step III):\n  - feat_union_oids = (SELECT oid FROM fr) UNION (SELECT oid FROM fg)\n- INTERSECT of feature subqueries (step IV):\n  - feat_intersect_oids = (SELECT oid FROM fr) INTERSECT (SELECT oid FROM fg)\n- Filter the UNION by INTERSECT (step V):\n  - var_and_g_nonvar_oids = SELECT oid FROM feat_union_oids WHERE oid IN (SELECT oid FROM feat_intersect_oids)\n  - This yields oids that have both: r variable feature and g non-variable feature.\n\n6) Add the \u201cno detections in g\u201d alternative to the final logic\n- Build the set for \u201cr variable AND g no-detections\u201d:\n  - rvar_and_g_nodet_oids = (SELECT oid FROM fr) INTERSECT (SELECT oid FROM mg)\n- Final set of oids that satisfy the full condition:\n  - final_oids = (SELECT oid FROM var_and_g_nonvar_oids) UNION (SELECT oid FROM rvar_and_g_nodet_oids)\n\n7) Final result selection (return all relevant rows, ordered appropriately)\n- Since the user did not specify columns, use SELECT * for completeness. Join back to include all relevant details:\n  - Start from final_oids.\n  - INNER JOIN p (to keep probability info for AGN objects).\n  - LEFT JOIN feature f_out ON f_out.oid = final_oids.oid AND f_out.name = 'ExcessVar' AND f_out.fid IN (1, 2)\n    - This exposes the variability features in both bands, satisfying \u201corder the features by their value.\u201d\n  - LEFT JOIN magstat ms_g ON ms_g.oid = final_oids.oid AND ms_g.fid = 1\n    - Include g-band ndet to document the \u201cno detections\u201d case.\n  - LEFT JOIN magstat ms_r ON ms_r.oid = final_oids.oid AND ms_r.fid = 2\n    - Optional: include r-band stats for context (e.g., ndet, magsigma).\n- Ordering:\n  - Ensure feature-level subqueries (fr, fg) include ORDER BY f.value ASC to \u201corder the features by their value.\u201d\n  - Final outer query ORDER BY final_oids.oid ASC (as requested: \u201cfinal query by oid\u201d).\n  - If you want stable per-oid feature ordering in the final output, you can add a secondary sort key by feature value: ORDER BY final_oids.oid ASC, f_out.value ASC.\n\nNotes and implementation details\n- Fid mapping: g=1, r=2 must be used exactly as above.\n- The feature table is transposed; we followed the required multi-feature procedure:\n  - Subqueries per feature (fr for r-band ExcessVar > 0, fg for g-band ExcessVar <= 0).\n  - UNION and INTERSECT on these feature subqueries.\n  - Filter the UNION by the INTERSECT.\n  - Added the magstat-based alternative (mg) by intersecting with the r-variable set and unioning with the previous result to incorporate the \u201cno detections in g\u201d case.\n- All class names and classifier_name must match exactly the given strings:\n  - 'AGN' and 'lc_classifier'.\n- Performance hints:\n  - The probability filters (ranking=1 and classifier_name='lc_classifier') leverage ix_classification_rank1 and should be selective; consider also filtering by class_name in the WHERE.\n  - For magstat, the anti-join pattern (LEFT JOIN ... WHERE ms.oid IS NULL OR ms.ndet = 0) or a NOT EXISTS subquery are both efficient given ix_magstats_ndet and ix_magstats_oid.\n- If multiple feature versions exist, the plan does not restrict feature.version; if you need a specific version, add a WHERE filter on feature.version consistently across fr, fg, and the final feature output join."
                    },
                    "in_toks": 5696,
                    "out_toks": 7823,
                    "id": "chatcmpl-Cb571UQqwrNHNqzyN1LaQj1cXXAek",
                    "created": 1762953823,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "/* Return AGN (lc_classifier, rank=1) with r-band variability (ExcessVar>0, fid=2) and either:\n   - g-band non-variability (ExcessVar<=0, fid=1), or\n   - no detections in g (magstat fid=1 missing or ndet=0).\n   Order features by value asc, and final result by oid. */ WITH p AS\n  (SELECT *\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND ranking = 1\n     AND class_name = 'AGN'),\n                                                                 fr AS\n  (/* r-band variable features */  SELECT f.*,\n                                          p.*\n   FROM feature f\n   INNER JOIN p ON f.oid = p.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 2\n     AND f.value > 0),\n                                                                 fg AS\n  (/* g-band non-variable features */  SELECT f.*,\n                                              p.*\n   FROM feature f\n   INNER JOIN p ON f.oid = p.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 1\n     AND f.value <= 0),\n                                                                 mg AS\n  (/* no detections in g band */  SELECT p.*,\n                                         ms.*\n   FROM p\n   LEFT JOIN magstat ms ON ms.oid = p.oid\n   AND ms.fid = 1\n   WHERE ms.oid IS NULL\n     OR ms.ndet = 0),\n                                                                 feat_union_oids AS\n  (SELECT oid\n   FROM fr\n   UNION SELECT oid\n   FROM fg),\n                                                                 feat_intersect_oids AS\n  (SELECT oid\n   FROM fr INTERSECT SELECT oid\n   FROM fg),\n                                                                 var_and_g_nonvar_oids AS\n  (/* r variable AND g non-variable */  SELECT u.oid\n   FROM feat_union_oids u\n   WHERE u.oid IN\n       (SELECT oid\n        FROM feat_intersect_oids)),\n                                                                 rvar_and_g_nodet_oids AS\n  (/* r variable AND g no-detections */  SELECT fr.oid\n   FROM fr INTERSECT SELECT mg.oid\n   FROM mg),\n                                                                 final_oids AS\n  (SELECT oid\n   FROM var_and_g_nonvar_oids\n   UNION SELECT oid\n   FROM rvar_and_g_nodet_oids)\nSELECT final_oids.*,\n       p.*,\n       fr.*,\n       fg.*,\n       mg.*,\n       fuo.*,\n       fio.*,\n       vang.*,\n       rng.*,\n       f_out.*,\n       ms_g.*,\n       ms_r.*\nFROM final_oids\nINNER JOIN p ON p.oid = final_oids.oid\nLEFT JOIN fr ON fr.oid = final_oids.oid\nLEFT JOIN fg ON fg.oid = final_oids.oid\nLEFT JOIN mg ON mg.oid = final_oids.oid\nLEFT JOIN feat_union_oids fuo ON fuo.oid = final_oids.oid\nLEFT JOIN feat_intersect_oids fio ON fio.oid = final_oids.oid\nLEFT JOIN var_and_g_nonvar_oids vang ON vang.oid = final_oids.oid\nLEFT JOIN rvar_and_g_nodet_oids rng ON rng.oid = final_oids.oid\nLEFT JOIN feature f_out ON f_out.oid = final_oids.oid\nAND f_out.name = 'ExcessVar'\nAND f_out.fid IN (1,\n                  2)\nLEFT JOIN magstat ms_g ON ms_g.oid = final_oids.oid\nAND ms_g.fid = 1\nLEFT JOIN magstat ms_r ON ms_r.oid = final_oids.oid\nAND ms_r.fid = 2\nORDER BY final_oids.oid ASC,\n         f_out.value ASC;"
                        },
                        "in_toks": 5898,
                        "out_toks": 3876,
                        "id": "chatcmpl-Cb59OAVHIghOesqq3z4Ee5PQkV2Ki",
                        "created": 1762953970,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "17",
            "experiment_id": "run_3",
            "pred_tables": [
                "probability",
                "taxonomy",
                "magstat",
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'magstat', 'feature']"
                },
                "in_toks": 629,
                "out_toks": 1367,
                "id": "chatcmpl-CSsTGVxOXtrkJNIGvShvNxm99QUmL",
                "created": 1760998606,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 3817,
                "out_toks": 1103,
                "id": "chatcmpl-CSxQD2gzAc8iaSvPweotYBsQQix8c",
                "created": 1761017637,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- AGN objects (most likely class) per lc_classifier, ranking=1\nWITH p AS\n  (SELECT *\n   FROM probability\n   WHERE class_name = 'AGN'\n     AND classifier_name = 'lc_classifier'\n     AND ranking = 1), -- r band variability: ExcessVar (fid=2) > 0\nf_r_var AS\n  (SELECT f.*\n   FROM feature f\n   INNER JOIN p ON f.oid = p.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 2\n     AND f.value > 0), -- g band no detections: n_det (fid=1) = 0\nf_g_nodet AS\n  (SELECT f.*\n   FROM feature f\n   INNER JOIN p ON f.oid = p.oid\n   WHERE f.name = 'n_det'\n     AND f.fid = 1\n     AND f.value = 0), -- g band no variability: ExcessVar (fid=1) <= 0\nf_g_novar AS\n  (SELECT f.*\n   FROM feature f\n   INNER JOIN p ON f.oid = p.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 1\n     AND f.value <= 0), -- UNION of matched feature rows (r-var OR g-nodet OR g-novar)\nu AS\n  (SELECT *\n   FROM f_r_var\n   UNION SELECT *\n   FROM f_g_nodet\n   UNION SELECT *\n   FROM f_g_novar), -- INTERSECTION of oid sets: r-var AND (g-nodet OR g-novar)\ni AS\n  (SELECT oid\n   FROM\n     (SELECT oid\n      FROM f_r_var) r INTERSECT\n     (SELECT oid\n      FROM f_g_nodet\n      UNION SELECT oid\n      FROM f_g_novar)) -- Return all columns from matched feature rows and probability rows, ordered by oid then feature value\n\nSELECT u.*,\n       p.*\nFROM u\nINNER JOIN i ON u.oid = i.oid\nINNER JOIN p ON u.oid = p.oid\nORDER BY u.oid ASC,\n         u.value ASC;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nReturn objects whose most likely light-curve classification is AGN, that:\n- show variability in the r band, and\n- in the g band either have no detections or show no variability.\nReturn all columns (SELECT *) for the matched feature rows, order features by value ascending, and order the final result by oid.\n\nTables and columns to use\n- probability: oid, class_name, classifier_name, classifier_version, probability, ranking\n- feature: oid, name, value, fid, version\n  - fid: 1=g, 2=r, 3=i\n  - Relevant feature names: 'ExcessVar' (variability indicator), 'n_det' (number of detections)\n- (Optional fallback) magstat: oid, fid, ndet, magsigma, etc. (only if you need a robust \u201cno-detections\u201d condition when feature n_det is unavailable)\n\nMandatory default conditions\n- Always restrict probability with:\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n- Exact class name: probability.class_name = 'AGN'\n\nLogical specification\n- r-band variability: feature.name = 'ExcessVar' AND feature.fid = 2 AND feature.value > 0\n- g-band no detections: feature.name = 'n_det' AND feature.fid = 1 AND feature.value = 0\n- g-band no variability: feature.name = 'ExcessVar' AND feature.fid = 1 AND feature.value <= 0\n- g-band condition: (no detections) OR (no variability)\n- Overall condition: r-band variability AND (g-band no detections OR g-band no variability)\n\nQuery construction steps (use CTEs or nested subqueries)\n\n1) Base AGN objects (probability filter)\n- Build a subquery P selecting only the oids of AGN per the defaults:\n  - FROM probability\n  - WHERE\n    - class_name = 'AGN'\n    - classifier_name = 'lc_classifier'\n    - ranking = 1\n  - SELECT DISTINCT oid (you may keep all columns for debugging, but oid must be available)\n- This subquery will be INNER JOINed by all feature subqueries to restrict to the desired objects.\n\n2) r-band variability feature subquery (R_var)\n- Create a subquery R_var over feature:\n  - INNER JOIN P ON feature.oid = P.oid\n  - WHERE feature.name = 'ExcessVar' AND feature.fid = 2 AND feature.value > 0\n  - SELECT DISTINCT feature.oid\n- This returns the oids of AGN with r-band variability.\n\n3) g-band \u201cno detections\u201d feature subquery (G_nodet)\n- Create a subquery G_nodet over feature:\n  - INNER JOIN P ON feature.oid = P.oid\n  - WHERE feature.name = 'n_det' AND feature.fid = 1 AND feature.value = 0\n  - SELECT DISTINCT feature.oid\n\n4) g-band \u201cno variability\u201d feature subquery (G_novar)\n- Create a subquery G_novar over feature:\n  - INNER JOIN P ON feature.oid = P.oid\n  - WHERE feature.name = 'ExcessVar' AND feature.fid = 1 AND feature.value <= 0\n  - SELECT DISTINCT feature.oid\n\n5) g-band condition union (G_cond)\n- Build a union of G_nodet and G_novar to implement the OR logic:\n  - G_cond = (SELECT oid FROM G_nodet) UNION (SELECT oid FROM G_novar)\n- G_cond contains all oids satisfying \u201cno detections in g OR no variability in g\u201d.\n\n6) Final oid set via intersection\n- Intersect the r-band variability set with the g-band condition:\n  - Selected_oids = (SELECT oid FROM R_var) INTERSECT (SELECT oid FROM G_cond)\n- This enforces: r-band variable AND (g no detections OR g not variable).\n\n7) Final result rows and ordering\n- To return the feature rows for these objects and sort features by their value ascending:\n  - FROM feature f\n  - INNER JOIN Selected_oids S ON f.oid = S.oid\n  - (Optionally INNER JOIN P to include probability columns; if not needed, omit.)\n  - Restrict to only the relevant features to keep the output focused:\n    - f.name IN ('ExcessVar','n_det')\n    - f.fid IN (1, 2)\n  - SELECT *  (as the user did not specify explicit columns)\n  - ORDER BY f.oid ASC, f.value ASC\n    - This satisfies \u201corder the features by their value in ascending order\u201d and \u201cfinal query by oid.\u201d The primary sort by oid ensures the final list is grouped by object; the secondary sort orders the features by value within each oid group.\n\n8) Optional robustness for \u201cno detections in g\u201d (if features lack n_det)\n- If some AGN lack a feature row for g-band n_det, you can augment G_nodet with a magstat-based alternative:\n  - LEFT JOIN magstat mg on mg.oid = P.oid AND mg.fid = 1\n  - Treat \u201cno detections\u201d as (mg.ndet = 0) OR (mg.oid IS NULL)\n  - Convert this into an oid set and UNION it into G_cond\n- Note: prefer the feature-based approach first to adhere to the multi-feature transposed-table method; only add this if needed.\n\n9) Performance and correctness notes\n- Ensure all joins to feature use INNER JOIN with P as specified in the multi-feature rule.\n- Use UNION (not UNION ALL) for G_cond to deduplicate oids from the two g-band subqueries.\n- Use INTERSECT (not INTERSECT ALL) to compute Selected_oids.\n- Keep exact table and column names:\n  - probability.class_name = 'AGN'\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n  - feature.name IN ('ExcessVar','n_det'); feature.fid 1=g, 2=r\n- Return all columns (SELECT *) from the final FROM clause so the output contains the relevant feature rows (and probability columns if joined)."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nReturn objects whose most likely light-curve classification is AGN, that:\n- show variability in the r band, and\n- in the g band either have no detections or show no variability.\nReturn all columns (SELECT *) for the matched feature rows, order features by value ascending, and order the final result by oid.\n\nTables and columns to use\n- probability: oid, class_name, classifier_name, classifier_version, probability, ranking\n- feature: oid, name, value, fid, version\n  - fid: 1=g, 2=r, 3=i\n  - Relevant feature names: 'ExcessVar' (variability indicator), 'n_det' (number of detections)\n- (Optional fallback) magstat: oid, fid, ndet, magsigma, etc. (only if you need a robust \u201cno-detections\u201d condition when feature n_det is unavailable)\n\nMandatory default conditions\n- Always restrict probability with:\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n- Exact class name: probability.class_name = 'AGN'\n\nLogical specification\n- r-band variability: feature.name = 'ExcessVar' AND feature.fid = 2 AND feature.value > 0\n- g-band no detections: feature.name = 'n_det' AND feature.fid = 1 AND feature.value = 0\n- g-band no variability: feature.name = 'ExcessVar' AND feature.fid = 1 AND feature.value <= 0\n- g-band condition: (no detections) OR (no variability)\n- Overall condition: r-band variability AND (g-band no detections OR g-band no variability)\n\nQuery construction steps (use CTEs or nested subqueries)\n\n1) Base AGN objects (probability filter)\n- Build a subquery P selecting only the oids of AGN per the defaults:\n  - FROM probability\n  - WHERE\n    - class_name = 'AGN'\n    - classifier_name = 'lc_classifier'\n    - ranking = 1\n  - SELECT DISTINCT oid (you may keep all columns for debugging, but oid must be available)\n- This subquery will be INNER JOINed by all feature subqueries to restrict to the desired objects.\n\n2) r-band variability feature subquery (R_var)\n- Create a subquery R_var over feature:\n  - INNER JOIN P ON feature.oid = P.oid\n  - WHERE feature.name = 'ExcessVar' AND feature.fid = 2 AND feature.value > 0\n  - SELECT DISTINCT feature.oid\n- This returns the oids of AGN with r-band variability.\n\n3) g-band \u201cno detections\u201d feature subquery (G_nodet)\n- Create a subquery G_nodet over feature:\n  - INNER JOIN P ON feature.oid = P.oid\n  - WHERE feature.name = 'n_det' AND feature.fid = 1 AND feature.value = 0\n  - SELECT DISTINCT feature.oid\n\n4) g-band \u201cno variability\u201d feature subquery (G_novar)\n- Create a subquery G_novar over feature:\n  - INNER JOIN P ON feature.oid = P.oid\n  - WHERE feature.name = 'ExcessVar' AND feature.fid = 1 AND feature.value <= 0\n  - SELECT DISTINCT feature.oid\n\n5) g-band condition union (G_cond)\n- Build a union of G_nodet and G_novar to implement the OR logic:\n  - G_cond = (SELECT oid FROM G_nodet) UNION (SELECT oid FROM G_novar)\n- G_cond contains all oids satisfying \u201cno detections in g OR no variability in g\u201d.\n\n6) Final oid set via intersection\n- Intersect the r-band variability set with the g-band condition:\n  - Selected_oids = (SELECT oid FROM R_var) INTERSECT (SELECT oid FROM G_cond)\n- This enforces: r-band variable AND (g no detections OR g not variable).\n\n7) Final result rows and ordering\n- To return the feature rows for these objects and sort features by their value ascending:\n  - FROM feature f\n  - INNER JOIN Selected_oids S ON f.oid = S.oid\n  - (Optionally INNER JOIN P to include probability columns; if not needed, omit.)\n  - Restrict to only the relevant features to keep the output focused:\n    - f.name IN ('ExcessVar','n_det')\n    - f.fid IN (1, 2)\n  - SELECT *  (as the user did not specify explicit columns)\n  - ORDER BY f.oid ASC, f.value ASC\n    - This satisfies \u201corder the features by their value in ascending order\u201d and \u201cfinal query by oid.\u201d The primary sort by oid ensures the final list is grouped by object; the secondary sort orders the features by value within each oid group.\n\n8) Optional robustness for \u201cno detections in g\u201d (if features lack n_det)\n- If some AGN lack a feature row for g-band n_det, you can augment G_nodet with a magstat-based alternative:\n  - LEFT JOIN magstat mg on mg.oid = P.oid AND mg.fid = 1\n  - Treat \u201cno detections\u201d as (mg.ndet = 0) OR (mg.oid IS NULL)\n  - Convert this into an oid set and UNION it into G_cond\n- Note: prefer the feature-based approach first to adhere to the multi-feature transposed-table method; only add this if needed.\n\n9) Performance and correctness notes\n- Ensure all joins to feature use INNER JOIN with P as specified in the multi-feature rule.\n- Use UNION (not UNION ALL) for G_cond to deduplicate oids from the two g-band subqueries.\n- Use INTERSECT (not INTERSECT ALL) to compute Selected_oids.\n- Keep exact table and column names:\n  - probability.class_name = 'AGN'\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n  - feature.name IN ('ExcessVar','n_det'); feature.fid 1=g, 2=r\n- Return all columns (SELECT *) from the final FROM clause so the output contains the relevant feature rows (and probability columns if joined)."
                    },
                    "in_toks": 5696,
                    "out_toks": 5748,
                    "id": "chatcmpl-Cb5AMr5K0ITgGNkQfmYibdlOryZYR",
                    "created": 1762954030,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- AGN objects (most likely class) per lc_classifier, ranking=1\nWITH p AS\n  (SELECT *\n   FROM probability\n   WHERE class_name = 'AGN'\n     AND classifier_name = 'lc_classifier'\n     AND ranking = 1), -- r band variability: ExcessVar (fid=2) > 0\nf_r_var AS\n  (SELECT f.*\n   FROM feature f\n   INNER JOIN p ON f.oid = p.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 2\n     AND f.value > 0), -- g band no detections: n_det (fid=1) = 0\nf_g_nodet AS\n  (SELECT f.*\n   FROM feature f\n   INNER JOIN p ON f.oid = p.oid\n   WHERE f.name = 'n_det'\n     AND f.fid = 1\n     AND f.value = 0), -- g band no variability: ExcessVar (fid=1) <= 0\nf_g_novar AS\n  (SELECT f.*\n   FROM feature f\n   INNER JOIN p ON f.oid = p.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 1\n     AND f.value <= 0), -- UNION of matched feature rows (r-var OR g-nodet OR g-novar)\nu AS\n  (SELECT *\n   FROM f_r_var\n   UNION SELECT *\n   FROM f_g_nodet\n   UNION SELECT *\n   FROM f_g_novar), -- INTERSECTION of oid sets: r-var AND (g-nodet OR g-novar)\ni AS\n  (SELECT oid\n   FROM\n     (SELECT oid\n      FROM f_r_var) r INTERSECT\n     (SELECT oid\n      FROM f_g_nodet\n      UNION SELECT oid\n      FROM f_g_novar)) -- Return all columns from matched feature rows and probability rows, ordered by oid then feature value\n\nSELECT u.*,\n       p.*\nFROM u\nINNER JOIN i ON u.oid = i.oid\nINNER JOIN p ON u.oid = p.oid\nORDER BY u.oid ASC,\n         u.value ASC;"
                        },
                        "in_toks": 5679,
                        "out_toks": 2967,
                        "id": "chatcmpl-Cb5CsVKgYLYj3jbgjKurLGA1nvnPk",
                        "created": 1762954186,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "17",
            "experiment_id": "run_4",
            "pred_tables": [
                "probability",
                "taxonomy",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'magstat']"
                },
                "in_toks": 629,
                "out_toks": 1940,
                "id": "chatcmpl-CSsTX3PiUhFoVOWg5lEA9gDpfZ1A7",
                "created": 1760998623,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1386,
                "out_toks": 1103,
                "id": "chatcmpl-CSxQPsWER98pmtBO6RFnJV6AsXVCs",
                "created": 1761017649,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 2993,
                "out_toks": 4000,
                "id": "chatcmpl-CSxh17nHNJd7dvdu9Iz3g6pMFAE89",
                "created": 1761018679,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Objects classified as AGN (lc_classifier, ranking=1)\n-- Show variability in r band (fid=2) measured by amplitude > 0\n-- Have no detections in g band (fid=1) OR show no variability in g (amplitude = 0)\n-- Order results by the variability feature (r_amp) ascending, then by oid\n\nWITH r AS (\n    SELECT\n        d.oid,\n        COUNT(*) AS r_cnt,\n        MIN(d.magpsf_corr) AS r_min_magpsf_corr,\n        MAX(d.magpsf_corr) AS r_max_magpsf_corr,\n        MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS r_amp,\n        stddev_samp(d.magpsf_corr) AS r_std\n    FROM detection d\n    WHERE d.fid = 2\n      AND d.magpsf_corr IS NOT NULL\n    GROUP BY d.oid\n),\ng AS (\n    SELECT\n        d.oid,\n        COUNT(*) AS g_cnt,\n        MIN(d.magpsf_corr) AS g_min_magpsf_corr,\n        MAX(d.magpsf_corr) AS g_max_magpsf_corr,\n        MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS g_amp,\n        stddev_samp(d.magpsf_corr) AS g_std\n    FROM detection d\n    WHERE d.fid = 1\n      AND d.magpsf_corr IS NOT NULL\n    GROUP BY d.oid\n)\nSELECT\n    o.*,\n    p.*,\n    r.*,\n    g.*\nFROM probability p\nINNER JOIN object o USING (oid)\nINNER JOIN r ON r.oid = o.oid\nLEFT JOIN g ON g.oid = o.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n  AND p.class_name = 'AGN'\n  AND r.r_amp > 0\n  AND (\n        COALESCE(g.g_cnt, 0) = 0\n        OR COALESCE(g.g_amp, 0) = 0\n      )\nORDER BY r.r_amp ASC, o.oid ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects classified as AGN (lc_classifier, ranking=1)\n-- Show variability in r band (fid=2) measured by amplitude > 0\n-- Have no detections in g band (fid=1) OR show no variability in g (amplitude = 0)\n-- Order results by the variability feature (r_amp) ascending, then by oid\n\nWITH r AS (\n    SELECT\n        d.oid,\n        COUNT(*) AS r_cnt,\n        MIN(d.magpsf_corr) AS r_min_magpsf_corr,\n        MAX(d.magpsf_corr) AS r_max_magpsf_corr,\n        MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS r_amp,\n        stddev_samp(d.magpsf_corr) AS r_std\n    FROM detection d\n    WHERE d.fid = 2\n      AND d.magpsf_corr IS NOT NULL\n    GROUP BY d.oid\n),\ng AS (\n    SELECT\n        d.oid,\n        COUNT(*) AS g_cnt,\n        MIN(d.magpsf_corr) AS g_min_magpsf_corr,\n        MAX(d.magpsf_corr) AS g_max_magpsf_corr,\n        MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS g_amp,\n        stddev_samp(d.magpsf_corr) AS g_std\n    FROM detection d\n    WHERE d.fid = 1\n      AND d.magpsf_corr IS NOT NULL\n    GROUP BY d.oid\n)\nSELECT\n    o.*,\n    p.*,\n    r.*,\n    g.*\nFROM probability p\nINNER JOIN object o USING (oid)\nINNER JOIN r ON r.oid = o.oid\nLEFT JOIN g ON g.oid = o.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n  AND p.class_name = 'AGN'\n  AND r.r_amp > 0\n  AND (\n        COALESCE(g.g_cnt, 0) = 0\n        OR COALESCE(g.g_amp, 0) = 0\n      )\nORDER BY r.r_amp ASC, o.oid ASC;\n```"
                },
                "in_toks": 3016,
                "out_toks": 2959,
                "id": "chatcmpl-CSyMsCnll2w3lm9LOeUnc6Z5pBw5R",
                "created": 1761021274,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "17",
            "experiment_id": "run_5",
            "pred_tables": [
                "probability",
                "magstat",
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'magstat', 'feature']"
                },
                "in_toks": 629,
                "out_toks": 1812,
                "id": "chatcmpl-CZM6UVCscqIGLPxOBq7LaFLwRKz5N",
                "created": 1762542482,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 3772,
                "out_toks": 1679,
                "id": "chatcmpl-CZY7Al8568Kp9bLjZA0P7k7Na0mZE",
                "created": 1762588652,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "/* AGN (most likely class) with r-band variability and either no g detections or no g variability.\n   Variability proxy: magsigma (dispersion of the difference magnitude).\n   Returns all feature rows for matched oids, along with their probability and magstat (g and r) rows.\n*/ WITH prob_agn AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'AGN'),\n        r_var AS\n  (SELECT DISTINCT pa.oid\n   FROM prob_agn pa\n   INNER JOIN magstat mr ON mr.oid = pa.oid\n   AND mr.fid = 2 -- r band\n\n   WHERE mr.ndet > 0\n     AND COALESCE(mr.magsigma, 0) > 0),\n        g_no_dets AS\n  (SELECT DISTINCT pa.oid\n   FROM prob_agn pa\n   WHERE NOT EXISTS\n       (SELECT 1\n        FROM magstat mg\n        WHERE mg.oid = pa.oid\n          AND mg.fid = 1 -- g band\n\n          AND mg.ndet > 0)),\n        g_no_var AS\n  (SELECT DISTINCT pa.oid\n   FROM prob_agn pa\n   INNER JOIN magstat mg ON mg.oid = pa.oid\n   AND mg.fid = 1 -- g band\n\n   WHERE mg.ndet > 0\n     AND COALESCE(mg.magsigma, 0) = 0),\n        g_ok AS\n  (SELECT oid\n   FROM g_no_dets\n   UNION SELECT oid\n   FROM g_no_var),\n        final_oids AS\n  (SELECT oid\n   FROM r_var INTERSECT SELECT oid\n   FROM g_ok)\nSELECT p.*,\n       mg_r.*,\n       mg_g.*,\n       f.*\nFROM final_oids fo\nINNER JOIN probability p ON p.oid = fo.oid\nAND p.classifier_name = 'lc_classifier'\nAND p.ranking = 1\nAND p.class_name = 'AGN'\nLEFT JOIN magstat mg_r ON mg_r.oid = fo.oid\nAND mg_r.fid = 2 -- r band row\nLEFT JOIN magstat mg_g ON mg_g.oid = fo.oid\nAND mg_g.fid = 1 -- g band row\nINNER JOIN feature f ON f.oid = fo.oid\nORDER BY f.oid ASC,\n         f.value ASC;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\nReturn all features (feature table rows) for objects whose most likely lc_classifier class is 'AGN', that show variability in the r band (fid=2), and either have no detections in the g band (fid=1) or show no variability in g. Order features by value ascending, and the final result by oid.\n\nKey schema elements and defaults to apply\n- probability: (oid, class_name, classifier_name, classifier_version, probability, ranking)\n  - Default filters: probability.ranking = 1 AND probability.classifier_name = 'lc_classifier'\n  - Target class: probability.class_name = 'AGN'\n- magstat: (oid, fid, stellar, corrected, ndet, magsigma, magsigma_corr, \u2026)\n  - Band mapping: fid = 1 (g), 2 (r), 3 (i)\n  - Use ndet for detections per band\n  - Use magsigma (or magsigma_corr) as a variability proxy per band\n- feature: (oid, name, value, fid, version)\n  - Each row is a single feature; we will not filter on features, only return feature rows for matched oids, hence no UNION/INTERSECT requirement for feature filtering applies here\n- No spatial constraints; Q3C not needed\n\nHigh-level structure\n- Use CTEs (WITH) to structure the logic.\n- Create:\n  1) AGN candidates (probability table with defaults)\n  2) Set of oids variable in r (magstat fid=2)\n  3) Set of oids with no detections in g\n  4) Set of oids with detections but no variability in g\n  5) Union of the two g-band sets\n  6) Intersect r-variable set with the g-band union to obtain final oids\n  7) Join final oids to feature to return all feature rows\n- Use UNION and INTERSECT to combine sets as required.\n- Final ORDER BY: first by oid, then by feature.value ascending.\n\nDetailed steps\n\nStep 1: Base AGN objects (prob_agn)\n- Build a CTE selecting only the oid from probability applying default conditions:\n  - WHERE\n    - probability.classifier_name = 'lc_classifier'\n    - probability.ranking = 1\n    - probability.class_name = 'AGN'\n- Select list: DISTINCT oid\n- This defines the working population of AGN objects.\n- Indexes used: ix_probabilities_oid, ix_classification_rank1\n\nStep 2: Objects showing variability in r band (r_var)\n- Inner join prob_agn to magstat as mr on (mr.oid = prob_agn.oid AND mr.fid = 2)\n- Variability condition in r (choose a clear, minimal, schema-backed proxy):\n  - mr.ndet > 0 (ensure detections exist in r)\n  - COALESCE(mr.magsigma, 0) > 0 (nonzero dispersion in the r band difference light curve)\n  - Optionally, if you prefer corrected magnitudes as variability proxy, use COALESCE(mr.magsigma_corr, 0) > 0 instead; pick one consistently.\n- Select list: DISTINCT prob_agn.oid\n- This yields the set R of AGN oids variable in r.\n\nStep 3: Objects with no detections in g band (g_no_dets)\n- From prob_agn, select oids that do not have any magstat row with fid = 1 and ndet > 0.\n- Implement as anti-existence:\n  - WHERE NOT EXISTS (\n      SELECT 1\n      FROM magstat mg\n      WHERE mg.oid = prob_agn.oid\n        AND mg.fid = 1\n        AND mg.ndet > 0\n    )\n- Select list: DISTINCT prob_agn.oid\n- This captures both cases where there is no g-band magstat row at all or it exists but ndet = 0.\n\nStep 4: Objects with detections in g but no variability (g_no_var)\n- Inner join prob_agn to magstat as mg on (mg.oid = prob_agn.oid AND mg.fid = 1)\n- Require detections but no variability:\n  - mg.ndet > 0\n  - COALESCE(mg.magsigma, 0) = 0 (or choose magsigma_corr consistently if you used magsigma_corr in Step 2)\n- Select list: DISTINCT prob_agn.oid\n\nStep 5: Union the two g-band conditions (g_ok)\n- Combine g_no_dets and g_no_var with UNION (distinct) to obtain the set G of oids that either:\n  - have no detections in g, OR\n  - have detections but show no variability in g.\n\nStep 6: Intersect r-variable AGN with g-condition set (final_oids)\n- Use INTERSECT between r_var (Step 2) and g_ok (Step 5) to enforce:\n  - AGN most likely class (from prob_agn)\n  - variable in r band\n  - and either no detections or no variability in g band\n- Select list: DISTINCT oid\n- This is the definitive list of oids satisfying the scientific constraints.\n\nStep 7: Return all features for the matched objects (final_features)\n- Join final_oids to feature f on f.oid = final_oids.oid\n- Select: f.* (all feature columns), since the user did not specify explicit feature columns.\n- Note: Do not filter by feature.name or feature.fid unless the user specifies; include all features available for the matched oids.\n\nStep 8: Ordering\n- Order feature rows primarily by oid to satisfy \u201cfinal query by oid\u201d, and secondarily by feature.value ascending to satisfy \u201corder the features by their value in ascending order.\u201d\n- ORDER BY f.oid ASC, f.value ASC\n\nStep 9: Notes and implementation choices\n- Variability proxies:\n  - magsigma vs magsigma_corr: pick one and use it consistently in both r and g conditions. If you want dispersion in the corrected light curve, use magsigma_corr; otherwise use magsigma. State your choice in the query comments.\n- Duplicates:\n  - UNION and INTERSECT remove duplicates by default, producing clean oid sets.\n- Performance:\n  - All set operations (UNION/INTERSECT) operate on small oid lists derived from prob_agn; joins to magstat are supported by ix_magstats_oid.\n  - Ensure the SELECT lists in set operations only contain oid to keep them efficient.\n- No spatial constraints; Q3C functions are not involved.\n- Class name must be exactly 'AGN'; classifier_name must be exactly 'lc_classifier'; ranking must equal 1.\n\nResult\nA single SQL statement using CTEs performing:\n- prob_agn (AGN selection with defaults)\n- r_var (r-band variability)\n- g_no_dets (no g detections)\n- g_no_var (g detections but non-variable)\n- g_ok = g_no_dets UNION g_no_var\n- final_oids = r_var INTERSECT g_ok\n- final_features = feature rows for final_oids\nOrdered by f.oid ASC, f.value ASC."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\nReturn all features (feature table rows) for objects whose most likely lc_classifier class is 'AGN', that show variability in the r band (fid=2), and either have no detections in the g band (fid=1) or show no variability in g. Order features by value ascending, and the final result by oid.\n\nKey schema elements and defaults to apply\n- probability: (oid, class_name, classifier_name, classifier_version, probability, ranking)\n  - Default filters: probability.ranking = 1 AND probability.classifier_name = 'lc_classifier'\n  - Target class: probability.class_name = 'AGN'\n- magstat: (oid, fid, stellar, corrected, ndet, magsigma, magsigma_corr, \u2026)\n  - Band mapping: fid = 1 (g), 2 (r), 3 (i)\n  - Use ndet for detections per band\n  - Use magsigma (or magsigma_corr) as a variability proxy per band\n- feature: (oid, name, value, fid, version)\n  - Each row is a single feature; we will not filter on features, only return feature rows for matched oids, hence no UNION/INTERSECT requirement for feature filtering applies here\n- No spatial constraints; Q3C not needed\n\nHigh-level structure\n- Use CTEs (WITH) to structure the logic.\n- Create:\n  1) AGN candidates (probability table with defaults)\n  2) Set of oids variable in r (magstat fid=2)\n  3) Set of oids with no detections in g\n  4) Set of oids with detections but no variability in g\n  5) Union of the two g-band sets\n  6) Intersect r-variable set with the g-band union to obtain final oids\n  7) Join final oids to feature to return all feature rows\n- Use UNION and INTERSECT to combine sets as required.\n- Final ORDER BY: first by oid, then by feature.value ascending.\n\nDetailed steps\n\nStep 1: Base AGN objects (prob_agn)\n- Build a CTE selecting only the oid from probability applying default conditions:\n  - WHERE\n    - probability.classifier_name = 'lc_classifier'\n    - probability.ranking = 1\n    - probability.class_name = 'AGN'\n- Select list: DISTINCT oid\n- This defines the working population of AGN objects.\n- Indexes used: ix_probabilities_oid, ix_classification_rank1\n\nStep 2: Objects showing variability in r band (r_var)\n- Inner join prob_agn to magstat as mr on (mr.oid = prob_agn.oid AND mr.fid = 2)\n- Variability condition in r (choose a clear, minimal, schema-backed proxy):\n  - mr.ndet > 0 (ensure detections exist in r)\n  - COALESCE(mr.magsigma, 0) > 0 (nonzero dispersion in the r band difference light curve)\n  - Optionally, if you prefer corrected magnitudes as variability proxy, use COALESCE(mr.magsigma_corr, 0) > 0 instead; pick one consistently.\n- Select list: DISTINCT prob_agn.oid\n- This yields the set R of AGN oids variable in r.\n\nStep 3: Objects with no detections in g band (g_no_dets)\n- From prob_agn, select oids that do not have any magstat row with fid = 1 and ndet > 0.\n- Implement as anti-existence:\n  - WHERE NOT EXISTS (\n      SELECT 1\n      FROM magstat mg\n      WHERE mg.oid = prob_agn.oid\n        AND mg.fid = 1\n        AND mg.ndet > 0\n    )\n- Select list: DISTINCT prob_agn.oid\n- This captures both cases where there is no g-band magstat row at all or it exists but ndet = 0.\n\nStep 4: Objects with detections in g but no variability (g_no_var)\n- Inner join prob_agn to magstat as mg on (mg.oid = prob_agn.oid AND mg.fid = 1)\n- Require detections but no variability:\n  - mg.ndet > 0\n  - COALESCE(mg.magsigma, 0) = 0 (or choose magsigma_corr consistently if you used magsigma_corr in Step 2)\n- Select list: DISTINCT prob_agn.oid\n\nStep 5: Union the two g-band conditions (g_ok)\n- Combine g_no_dets and g_no_var with UNION (distinct) to obtain the set G of oids that either:\n  - have no detections in g, OR\n  - have detections but show no variability in g.\n\nStep 6: Intersect r-variable AGN with g-condition set (final_oids)\n- Use INTERSECT between r_var (Step 2) and g_ok (Step 5) to enforce:\n  - AGN most likely class (from prob_agn)\n  - variable in r band\n  - and either no detections or no variability in g band\n- Select list: DISTINCT oid\n- This is the definitive list of oids satisfying the scientific constraints.\n\nStep 7: Return all features for the matched objects (final_features)\n- Join final_oids to feature f on f.oid = final_oids.oid\n- Select: f.* (all feature columns), since the user did not specify explicit feature columns.\n- Note: Do not filter by feature.name or feature.fid unless the user specifies; include all features available for the matched oids.\n\nStep 8: Ordering\n- Order feature rows primarily by oid to satisfy \u201cfinal query by oid\u201d, and secondarily by feature.value ascending to satisfy \u201corder the features by their value in ascending order.\u201d\n- ORDER BY f.oid ASC, f.value ASC\n\nStep 9: Notes and implementation choices\n- Variability proxies:\n  - magsigma vs magsigma_corr: pick one and use it consistently in both r and g conditions. If you want dispersion in the corrected light curve, use magsigma_corr; otherwise use magsigma. State your choice in the query comments.\n- Duplicates:\n  - UNION and INTERSECT remove duplicates by default, producing clean oid sets.\n- Performance:\n  - All set operations (UNION/INTERSECT) operate on small oid lists derived from prob_agn; joins to magstat are supported by ix_magstats_oid.\n  - Ensure the SELECT lists in set operations only contain oid to keep them efficient.\n- No spatial constraints; Q3C functions are not involved.\n- Class name must be exactly 'AGN'; classifier_name must be exactly 'lc_classifier'; ranking must equal 1.\n\nResult\nA single SQL statement using CTEs performing:\n- prob_agn (AGN selection with defaults)\n- r_var (r-band variability)\n- g_no_dets (no g detections)\n- g_no_var (g detections but non-variable)\n- g_ok = g_no_dets UNION g_no_var\n- final_oids = r_var INTERSECT g_ok\n- final_features = feature rows for final_oids\nOrdered by f.oid ASC, f.value ASC."
                    },
                    "in_toks": 5651,
                    "out_toks": 5452,
                    "id": "chatcmpl-Cb5DwIx3s3i5ES4pTcZGIBiz1BdiZ",
                    "created": 1762954252,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "/* AGN (most likely class) with r-band variability and either no g detections or no g variability.\n   Variability proxy: magsigma (dispersion of the difference magnitude).\n   Returns all feature rows for matched oids, along with their probability and magstat (g and r) rows.\n*/ WITH prob_agn AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'AGN'),\n        r_var AS\n  (SELECT DISTINCT pa.oid\n   FROM prob_agn pa\n   INNER JOIN magstat mr ON mr.oid = pa.oid\n   AND mr.fid = 2 -- r band\n\n   WHERE mr.ndet > 0\n     AND COALESCE(mr.magsigma, 0) > 0),\n        g_no_dets AS\n  (SELECT DISTINCT pa.oid\n   FROM prob_agn pa\n   WHERE NOT EXISTS\n       (SELECT 1\n        FROM magstat mg\n        WHERE mg.oid = pa.oid\n          AND mg.fid = 1 -- g band\n\n          AND mg.ndet > 0)),\n        g_no_var AS\n  (SELECT DISTINCT pa.oid\n   FROM prob_agn pa\n   INNER JOIN magstat mg ON mg.oid = pa.oid\n   AND mg.fid = 1 -- g band\n\n   WHERE mg.ndet > 0\n     AND COALESCE(mg.magsigma, 0) = 0),\n        g_ok AS\n  (SELECT oid\n   FROM g_no_dets\n   UNION SELECT oid\n   FROM g_no_var),\n        final_oids AS\n  (SELECT oid\n   FROM r_var INTERSECT SELECT oid\n   FROM g_ok)\nSELECT p.*,\n       mg_r.*,\n       mg_g.*,\n       f.*\nFROM final_oids fo\nINNER JOIN probability p ON p.oid = fo.oid\nAND p.classifier_name = 'lc_classifier'\nAND p.ranking = 1\nAND p.class_name = 'AGN'\nLEFT JOIN magstat mg_r ON mg_r.oid = fo.oid\nAND mg_r.fid = 2 -- r band row\nLEFT JOIN magstat mg_g ON mg_g.oid = fo.oid\nAND mg_g.fid = 1 -- g band row\nINNER JOIN feature f ON f.oid = fo.oid\nORDER BY f.oid ASC,\n         f.value ASC;"
                        },
                        "in_toks": 5850,
                        "out_toks": 3311,
                        "id": "chatcmpl-Cb5FwnGK78J8p3MgrXktsriK7FbTA",
                        "created": 1762954376,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "17",
            "experiment_id": "run_6",
            "pred_tables": [
                "probability",
                "taxonomy",
                "magstat",
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'magstat', 'feature']"
                },
                "in_toks": 629,
                "out_toks": 1431,
                "id": "chatcmpl-CZM7CU01sbUzWRRI3QItJrdnaWlVx",
                "created": 1762542526,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 3817,
                "out_toks": 1295,
                "id": "chatcmpl-CZY7T8b0ApyUQNzKpv2iJI4QOztKJ",
                "created": 1762588671,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 5696,
                "out_toks": 4000,
                "id": "chatcmpl-CZaMhp9TVidsC5GmNyxkLmhx7eLH5",
                "created": 1762597303,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* AGN objects with variability in r band and no detections or no variability in g band */\n/* Default conditions for probability: ranking=1 and classifier_name='lc_classifier' */\n\nWITH agn AS (\n    SELECT o.*, p.*\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE p.ranking = 1\n      AND p.classifier_name = 'lc_classifier'\n      AND p.class_name = 'AGN'\n),\ndet_stats AS (\n    SELECT\n        d.oid,\n        COUNT(d.magpsf_corr) FILTER (WHERE d.fid = 2 AND d.corrected AND NOT d.dubious) AS r_n,\n        VAR_SAMP(d.magpsf_corr) FILTER (WHERE d.fid = 2 AND d.corrected AND NOT d.dubious) AS r_var,\n        COUNT(d.magpsf_corr) FILTER (WHERE d.fid = 1 AND d.corrected AND NOT d.dubious) AS g_n,\n        VAR_SAMP(d.magpsf_corr) FILTER (WHERE d.fid = 1 AND d.corrected AND NOT d.dubious) AS g_var\n    FROM detection d\n    INNER JOIN agn a ON a.oid = d.oid  -- restrict aggregation to AGN objects only\n    GROUP BY d.oid\n)\nSELECT\n    a.*,\n    ds.*\nFROM agn a\nLEFT JOIN det_stats ds ON ds.oid = a.oid\nWHERE\n    /* Variability in r band: at least 2 corrected, non-dubious detections and variance > 0 */\n    COALESCE(ds.r_n, 0) >= 2\n    AND COALESCE(ds.r_var, 0) > 0\n    /* No detections in g or no variability in g (variance = 0 or only 1 detection -> NULL) */\n    AND (\n        COALESCE(ds.g_n, 0) = 0\n        OR COALESCE(ds.g_var, 0) = 0\n    )\n/* Order \"features\" (r_var) by ascending value, and then by oid */\nORDER BY ds.r_var ASC, a.oid ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* AGN objects with variability in r band and no detections or no variability in g band */\n/* Default conditions for probability: ranking=1 and classifier_name='lc_classifier' */\n\nWITH agn AS (\n    SELECT o.*, p.*\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE p.ranking = 1\n      AND p.classifier_name = 'lc_classifier'\n      AND p.class_name = 'AGN'\n),\ndet_stats AS (\n    SELECT\n        d.oid,\n        COUNT(d.magpsf_corr) FILTER (WHERE d.fid = 2 AND d.corrected AND NOT d.dubious) AS r_n,\n        VAR_SAMP(d.magpsf_corr) FILTER (WHERE d.fid = 2 AND d.corrected AND NOT d.dubious) AS r_var,\n        COUNT(d.magpsf_corr) FILTER (WHERE d.fid = 1 AND d.corrected AND NOT d.dubious) AS g_n,\n        VAR_SAMP(d.magpsf_corr) FILTER (WHERE d.fid = 1 AND d.corrected AND NOT d.dubious) AS g_var\n    FROM detection d\n    INNER JOIN agn a ON a.oid = d.oid  -- restrict aggregation to AGN objects only\n    GROUP BY d.oid\n)\nSELECT\n    a.*,\n    ds.*\nFROM agn a\nLEFT JOIN det_stats ds ON ds.oid = a.oid\nWHERE\n    /* Variability in r band: at least 2 corrected, non-dubious detections and variance > 0 */\n    COALESCE(ds.r_n, 0) >= 2\n    AND COALESCE(ds.r_var, 0) > 0\n    /* No detections in g or no variability in g (variance = 0 or only 1 detection -> NULL) */\n    AND (\n        COALESCE(ds.g_n, 0) = 0\n        OR COALESCE(ds.g_var, 0) = 0\n    )\n/* Order \"features\" (r_var) by ascending value, and then by oid */\nORDER BY ds.r_var ASC, a.oid ASC;\n```"
                },
                "in_toks": 3016,
                "out_toks": 3929,
                "id": "chatcmpl-CZb1WtndQPH4MtYYUWnMtrVDPGJy0",
                "created": 1762599834,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "17",
            "experiment_id": "run_7",
            "pred_tables": [
                "probability",
                "taxonomy",
                "magstat",
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'magstat', 'feature']"
                },
                "in_toks": 629,
                "out_toks": 1943,
                "id": "chatcmpl-CZM7vAi9ekxqaDCxkOnS2BTCu2Ng5",
                "created": 1762542571,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 3817,
                "out_toks": 1935,
                "id": "chatcmpl-CZY7ie7RqDrtw0xA0XZSw7yxGOcFw",
                "created": 1762588686,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 5696,
                "out_toks": 4000,
                "id": "chatcmpl-CZaWVYoxl4bP7aEIghRfO6hnJ83Uk",
                "created": 1762597911,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Objects classified as AGN (lc_classifier, rank=1)\n-- Variable in r band (fid=2): at least 2 corrected, non-dubious detections with non-zero scatter\n-- No detections or no variability in g band (fid=1): zero or <2 valid detections, or zero scatter\nWITH agn AS (\n    SELECT o.oid\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE p.ranking = 1\n      AND p.classifier_name = 'lc_classifier'\n      AND p.class_name = 'AGN'\n),\nr_stats AS (\n    SELECT\n        d.oid,\n        COUNT(d.magpsf_corr) AS r_n,\n        stddev_samp(d.magpsf_corr) AS r_std,\n        MAX(d.magpsf_corr) AS r_max,\n        MIN(d.magpsf_corr) AS r_min\n    FROM detection d\n    INNER JOIN agn a ON a.oid = d.oid\n    WHERE d.fid = 2\n      AND d.corrected = TRUE\n      AND d.dubious = FALSE\n      AND d.magpsf_corr IS NOT NULL\n    GROUP BY d.oid\n),\ng_stats AS (\n    SELECT\n        d.oid,\n        COUNT(d.magpsf_corr) AS g_n,\n        stddev_samp(d.magpsf_corr) AS g_std,\n        MAX(d.magpsf_corr) AS g_max,\n        MIN(d.magpsf_corr) AS g_min\n    FROM detection d\n    INNER JOIN agn a ON a.oid = d.oid\n    WHERE d.fid = 1\n      AND d.corrected = TRUE\n      AND d.dubious = FALSE\n      AND d.magpsf_corr IS NOT NULL\n    GROUP BY d.oid\n)\nSELECT\n    o.*,\n    p.*,\n    r_stats.*,\n    g_stats.*\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\nINNER JOIN r_stats\n    ON r_stats.oid = o.oid\nLEFT JOIN g_stats\n    ON g_stats.oid = o.oid\nWHERE p.ranking = 1\n  AND p.classifier_name = 'lc_classifier'\n  AND p.class_name = 'AGN'\n  AND r_stats.r_n >= 2\n  AND COALESCE(r_stats.r_std, 0) > 0\n  AND (\n        g_stats.oid IS NULL           -- no g-band detections\n        OR g_stats.g_n < 2            -- not enough g-band detections to show variability\n        OR COALESCE(g_stats.g_std, 0) = 0  -- no g-band variability\n      )\nORDER BY\n    r_stats.r_std ASC NULLS LAST,   -- order features (variability measure) ascending\n    o.oid ASC;                      -- then order final result by oid\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects classified as AGN (lc_classifier, rank=1)\n-- Variable in r band (fid=2): at least 2 corrected, non-dubious detections with non-zero scatter\n-- No detections or no variability in g band (fid=1): zero or <2 valid detections, or zero scatter\nWITH agn AS (\n    SELECT o.oid\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE p.ranking = 1\n      AND p.classifier_name = 'lc_classifier'\n      AND p.class_name = 'AGN'\n),\nr_stats AS (\n    SELECT\n        d.oid,\n        COUNT(d.magpsf_corr) AS r_n,\n        stddev_samp(d.magpsf_corr) AS r_std,\n        MAX(d.magpsf_corr) AS r_max,\n        MIN(d.magpsf_corr) AS r_min\n    FROM detection d\n    INNER JOIN agn a ON a.oid = d.oid\n    WHERE d.fid = 2\n      AND d.corrected = TRUE\n      AND d.dubious = FALSE\n      AND d.magpsf_corr IS NOT NULL\n    GROUP BY d.oid\n),\ng_stats AS (\n    SELECT\n        d.oid,\n        COUNT(d.magpsf_corr) AS g_n,\n        stddev_samp(d.magpsf_corr) AS g_std,\n        MAX(d.magpsf_corr) AS g_max,\n        MIN(d.magpsf_corr) AS g_min\n    FROM detection d\n    INNER JOIN agn a ON a.oid = d.oid\n    WHERE d.fid = 1\n      AND d.corrected = TRUE\n      AND d.dubious = FALSE\n      AND d.magpsf_corr IS NOT NULL\n    GROUP BY d.oid\n)\nSELECT\n    o.*,\n    p.*,\n    r_stats.*,\n    g_stats.*\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\nINNER JOIN r_stats\n    ON r_stats.oid = o.oid\nLEFT JOIN g_stats\n    ON g_stats.oid = o.oid\nWHERE p.ranking = 1\n  AND p.classifier_name = 'lc_classifier'\n  AND p.class_name = 'AGN'\n  AND r_stats.r_n >= 2\n  AND COALESCE(r_stats.r_std, 0) > 0\n  AND (\n        g_stats.oid IS NULL           -- no g-band detections\n        OR g_stats.g_n < 2            -- not enough g-band detections to show variability\n        OR COALESCE(g_stats.g_std, 0) = 0  -- no g-band variability\n      )\nORDER BY\n    r_stats.r_std ASC NULLS LAST,   -- order features (variability measure) ascending\n    o.oid ASC;                      -- then order final result by oid\n```"
                },
                "in_toks": 3016,
                "out_toks": 3763,
                "id": "chatcmpl-CZb3BZcPCeqUs8dfn1I9rA0J6cpco",
                "created": 1762599937,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "17",
            "experiment_id": "run_8",
            "pred_tables": [
                "probability",
                "taxonomy",
                "magstat",
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'magstat', 'feature']"
                },
                "in_toks": 629,
                "out_toks": 1175,
                "id": "chatcmpl-CZM8T4Dw3RKLJrUDH8EWCAukhpUEV",
                "created": 1762542605,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 3817,
                "out_toks": 1359,
                "id": "chatcmpl-CZY8aWkt5i1K0HTPvRVbZRdn3X5fV",
                "created": 1762588740,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Return all feature rows for objects:\n-- - Classified as 'AGN' by the lc_classifier at rank 1\n-- - Showing variability in r band (ExcessVar > 0, fid=2)\n-- - And either no detections in g (no magstat row for fid=1 or ndet=0) OR no variability in g (ExcessVar <= 0 or NULL, fid=1)\n-- Order features by value ascending within each oid, and order final results by oid.\n WITH probs_agn AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'AGN'),\n      r_var_feats AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN probs_agn pa ON pa.oid = f.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 2\n     AND f.value IS NOT NULL\n     AND f.value > 0),\n      g_nonvar_feats AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN probs_agn pa ON pa.oid = f.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 1\n     AND (f.value IS NULL\n          OR f.value <= 0)),\n      g_no_detections_mag AS\n  (SELECT DISTINCT pa.oid\n   FROM probs_agn pa\n   LEFT JOIN magstat m ON m.oid = pa.oid\n   AND m.fid = 1\n   WHERE m.oid IS NULL\n     OR m.ndet = 0),\n      g_ok AS\n  (SELECT oid\n   FROM g_nonvar_feats\n   UNION SELECT oid\n   FROM g_no_detections_mag),\n      eligible_oids AS\n  (SELECT oid\n   FROM r_var_feats INTERSECT SELECT oid\n   FROM g_ok)\nSELECT -- return all columns from all used relations (feature and CTEs)\n f.*,\n pa.*,\n rvf.*,\n gnf.*,\n gndm.*,\n gok.*,\n eo.*\nFROM feature f\nINNER JOIN eligible_oids eo ON eo.oid = f.oid\nINNER JOIN probs_agn pa ON pa.oid = f.oid\nINNER JOIN r_var_feats rvf ON rvf.oid = f.oid\nINNER JOIN g_ok gok ON gok.oid = f.oid\nLEFT JOIN g_nonvar_feats gnf ON gnf.oid = f.oid\nLEFT JOIN g_no_detections_mag gndm ON gndm.oid = f.oid\nORDER BY f.oid ASC,\n         f.value ASC;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan for generating the PostgreSQL query on the ALeRCE database\n\nGoal\n- Return all feature rows (SELECT * from feature) for objects:\n  - Classified as 'AGN' by the light-curve classifier, with rank-1 class.\n  - Showing variability in r band.\n  - And either no detections in g band OR show no variability in g band.\n- Order features by their value in ascending order within each object, and order final results by oid.\n\nAssumptions and mappings\n- Bands: fid=1 (g), fid=2 (r), fid=3 (i).\n- Classifier constraints (default and mandatory): probability.ranking = 1 AND probability.classifier_name = 'lc_classifier'.\n- AGN class filter: probability.class_name = 'AGN'.\n- Variability proxy: use feature.name = 'ExcessVar' (band-specific via fid).\n  - r-band variability condition: feature.value > 0 with fid = 2.\n  - g-band non-variability condition: feature.value <= 0 OR feature.value IS NULL with fid = 1.\n- \u201cNo detections in g\u201d comes from magstat: either no magstat row for fid=1, or magstat.ndet = 0.\n- If the user does not specify explicit columns, select all columns: return all columns from the feature table for the qualifying objects.\n- Use exact table and column names.\n\nStep-by-step plan\n\n1) CTE: Select AGN objects (rank-1 light-curve classifier)\n- Build a subquery probs_agn:\n  - FROM probability p\n  - WHERE p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.class_name = 'AGN'\n  - SELECT DISTINCT p.oid\n- This is the base set of oids to constrain all downstream joins.\n\n2) CTE: r-band variability via features\n- Build r_var_feats:\n  - FROM feature f\n  - INNER JOIN probs_agn pa ON pa.oid = f.oid\n  - WHERE f.name = 'ExcessVar'\n    AND f.fid = 2  -- r band\n    AND f.value IS NOT NULL\n    AND f.value > 0\n  - SELECT DISTINCT f.oid\n- This yields oids that show variability in r band.\n\n3) CTE: g-band non-variability via features\n- Build g_nonvar_feats:\n  - FROM feature f\n  - INNER JOIN probs_agn pa ON pa.oid = f.oid\n  - WHERE f.name = 'ExcessVar'\n    AND f.fid = 1  -- g band\n    AND (f.value IS NULL OR f.value <= 0)\n  - SELECT DISTINCT f.oid\n- This yields oids that show no variability in g band by the chosen proxy.\n\n4) CTE: g-band \u201cno detections\u201d via magstat\n- Build g_no_detections_mag:\n  - FROM probs_agn pa\n  - LEFT JOIN magstat m\n    ON m.oid = pa.oid\n    AND m.fid = 1  -- g band\n  - WHERE (m.oid IS NULL)  -- no magstat row for g\n     OR (m.ndet = 0)       -- explicit zero detections in g\n  - SELECT DISTINCT pa.oid\n- This yields oids with no g-band detections.\n\n5) CTE: Combine g-band conditions with UNION\n- Build g_ok:\n  - SELECT oid FROM g_nonvar_feats\n  - UNION\n  - SELECT oid FROM g_no_detections_mag\n- This is the set of oids that either have no variability in g or no detections in g.\n\n6) CTE: Enforce both r variability and g condition with INTERSECT\n- Build eligible_oids:\n  - (SELECT oid FROM r_var_feats)\n  - INTERSECT\n  - (SELECT oid FROM g_ok)\n- This gives the final set of oids that satisfy all logical conditions.\n\n7) Final selection of all feature rows for eligible objects\n- FROM feature f\n- INNER JOIN eligible_oids e ON e.oid = f.oid\n- SELECT f.*  -- all columns, since user did not specify explicit columns\n- ORDER BY f.oid ASC, f.value ASC\n  - This orders the result globally by oid (final query by oid) and, within each oid, orders features by their value ascending.\n\nNotes on implementation details and performance\n- Ensure DISTINCT in subqueries that project oid to feed UNION/INTERSECT cleanly.\n- Index usage:\n  - probability: ix_classification_rank1 (ranking=1), ix_probabilities_oid, ix_probabilities_probability (optional), and btree on class_name/classifier_name via filtering.\n  - feature: ix_feature_oid_2 for joins on oid; constrain by name and fid to reduce scan.\n  - magstat: ix_magstats_oid, and fid filter; ndet is indexed via ix_magstats_ndet.\n- No Q3C functions are required since no spatial constraints are requested."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan for generating the PostgreSQL query on the ALeRCE database\n\nGoal\n- Return all feature rows (SELECT * from feature) for objects:\n  - Classified as 'AGN' by the light-curve classifier, with rank-1 class.\n  - Showing variability in r band.\n  - And either no detections in g band OR show no variability in g band.\n- Order features by their value in ascending order within each object, and order final results by oid.\n\nAssumptions and mappings\n- Bands: fid=1 (g), fid=2 (r), fid=3 (i).\n- Classifier constraints (default and mandatory): probability.ranking = 1 AND probability.classifier_name = 'lc_classifier'.\n- AGN class filter: probability.class_name = 'AGN'.\n- Variability proxy: use feature.name = 'ExcessVar' (band-specific via fid).\n  - r-band variability condition: feature.value > 0 with fid = 2.\n  - g-band non-variability condition: feature.value <= 0 OR feature.value IS NULL with fid = 1.\n- \u201cNo detections in g\u201d comes from magstat: either no magstat row for fid=1, or magstat.ndet = 0.\n- If the user does not specify explicit columns, select all columns: return all columns from the feature table for the qualifying objects.\n- Use exact table and column names.\n\nStep-by-step plan\n\n1) CTE: Select AGN objects (rank-1 light-curve classifier)\n- Build a subquery probs_agn:\n  - FROM probability p\n  - WHERE p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.class_name = 'AGN'\n  - SELECT DISTINCT p.oid\n- This is the base set of oids to constrain all downstream joins.\n\n2) CTE: r-band variability via features\n- Build r_var_feats:\n  - FROM feature f\n  - INNER JOIN probs_agn pa ON pa.oid = f.oid\n  - WHERE f.name = 'ExcessVar'\n    AND f.fid = 2  -- r band\n    AND f.value IS NOT NULL\n    AND f.value > 0\n  - SELECT DISTINCT f.oid\n- This yields oids that show variability in r band.\n\n3) CTE: g-band non-variability via features\n- Build g_nonvar_feats:\n  - FROM feature f\n  - INNER JOIN probs_agn pa ON pa.oid = f.oid\n  - WHERE f.name = 'ExcessVar'\n    AND f.fid = 1  -- g band\n    AND (f.value IS NULL OR f.value <= 0)\n  - SELECT DISTINCT f.oid\n- This yields oids that show no variability in g band by the chosen proxy.\n\n4) CTE: g-band \u201cno detections\u201d via magstat\n- Build g_no_detections_mag:\n  - FROM probs_agn pa\n  - LEFT JOIN magstat m\n    ON m.oid = pa.oid\n    AND m.fid = 1  -- g band\n  - WHERE (m.oid IS NULL)  -- no magstat row for g\n     OR (m.ndet = 0)       -- explicit zero detections in g\n  - SELECT DISTINCT pa.oid\n- This yields oids with no g-band detections.\n\n5) CTE: Combine g-band conditions with UNION\n- Build g_ok:\n  - SELECT oid FROM g_nonvar_feats\n  - UNION\n  - SELECT oid FROM g_no_detections_mag\n- This is the set of oids that either have no variability in g or no detections in g.\n\n6) CTE: Enforce both r variability and g condition with INTERSECT\n- Build eligible_oids:\n  - (SELECT oid FROM r_var_feats)\n  - INTERSECT\n  - (SELECT oid FROM g_ok)\n- This gives the final set of oids that satisfy all logical conditions.\n\n7) Final selection of all feature rows for eligible objects\n- FROM feature f\n- INNER JOIN eligible_oids e ON e.oid = f.oid\n- SELECT f.*  -- all columns, since user did not specify explicit columns\n- ORDER BY f.oid ASC, f.value ASC\n  - This orders the result globally by oid (final query by oid) and, within each oid, orders features by their value ascending.\n\nNotes on implementation details and performance\n- Ensure DISTINCT in subqueries that project oid to feed UNION/INTERSECT cleanly.\n- Index usage:\n  - probability: ix_classification_rank1 (ranking=1), ix_probabilities_oid, ix_probabilities_probability (optional), and btree on class_name/classifier_name via filtering.\n  - feature: ix_feature_oid_2 for joins on oid; constrain by name and fid to reduce scan.\n  - magstat: ix_magstats_oid, and fid filter; ndet is indexed via ix_magstats_ndet.\n- No Q3C functions are required since no spatial constraints are requested."
                    },
                    "in_toks": 5696,
                    "out_toks": 5233,
                    "id": "chatcmpl-Cb5HBIw609EzEEaxmpQV2orPLSWJD",
                    "created": 1762954453,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Return all feature rows for objects:\n-- - Classified as 'AGN' by the lc_classifier at rank 1\n-- - Showing variability in r band (ExcessVar > 0, fid=2)\n-- - And either no detections in g (no magstat row for fid=1 or ndet=0) OR no variability in g (ExcessVar <= 0 or NULL, fid=1)\n-- Order features by value ascending within each oid, and order final results by oid.\n WITH probs_agn AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'AGN'),\n      r_var_feats AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN probs_agn pa ON pa.oid = f.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 2\n     AND f.value IS NOT NULL\n     AND f.value > 0),\n      g_nonvar_feats AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN probs_agn pa ON pa.oid = f.oid\n   WHERE f.name = 'ExcessVar'\n     AND f.fid = 1\n     AND (f.value IS NULL\n          OR f.value <= 0)),\n      g_no_detections_mag AS\n  (SELECT DISTINCT pa.oid\n   FROM probs_agn pa\n   LEFT JOIN magstat m ON m.oid = pa.oid\n   AND m.fid = 1\n   WHERE m.oid IS NULL\n     OR m.ndet = 0),\n      g_ok AS\n  (SELECT oid\n   FROM g_nonvar_feats\n   UNION SELECT oid\n   FROM g_no_detections_mag),\n      eligible_oids AS\n  (SELECT oid\n   FROM r_var_feats INTERSECT SELECT oid\n   FROM g_ok)\nSELECT -- return all columns from all used relations (feature and CTEs)\n f.*,\n pa.*,\n rvf.*,\n gnf.*,\n gndm.*,\n gok.*,\n eo.*\nFROM feature f\nINNER JOIN eligible_oids eo ON eo.oid = f.oid\nINNER JOIN probs_agn pa ON pa.oid = f.oid\nINNER JOIN r_var_feats rvf ON rvf.oid = f.oid\nINNER JOIN g_ok gok ON gok.oid = f.oid\nLEFT JOIN g_nonvar_feats gnf ON gnf.oid = f.oid\nLEFT JOIN g_no_detections_mag gndm ON gndm.oid = f.oid\nORDER BY f.oid ASC,\n         f.value ASC;"
                        },
                        "in_toks": 5420,
                        "out_toks": 4044,
                        "id": "chatcmpl-Cb5Is9Yu8MGqvFCFqW2YyhQcckRmK",
                        "created": 1762954558,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "17",
            "experiment_id": "run_9",
            "pred_tables": [
                "probability",
                "feature",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'feature', 'magstat']"
                },
                "in_toks": 629,
                "out_toks": 1556,
                "id": "chatcmpl-CZM8psfsG4aWtul5JsUUkD8KQa0eY",
                "created": 1762542627,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 3773,
                "out_toks": 2255,
                "id": "chatcmpl-CZY9BCUQ2yV26W9WuYA3nuzbuqu85",
                "created": 1762588777,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 5651,
                "out_toks": 4000,
                "id": "chatcmpl-CZaXiXuMC4T6RN4jYZWjUCH15HAbK",
                "created": 1762597986,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* AGN objects (lc_classifier, rank=1) with variability in r-band (fid=2) \n   and no detections or no variability in g-band (fid=1).\n   Variability proxy = amplitude = max(mag) - min(mag).\n   Order by the feature (r-band amplitude) ascending, then by oid. */\n\nWITH det AS (\n  SELECT\n    oid,\n    COUNT(*) FILTER (WHERE fid = 2) AS ndet_r,\n    MAX(coalesce(magpsf_corr, magpsf)) FILTER (WHERE fid = 2) \n      - MIN(coalesce(magpsf_corr, magpsf)) FILTER (WHERE fid = 2) AS amp_r,\n    STDDEV_SAMP(coalesce(magpsf_corr, magpsf)) FILTER (WHERE fid = 2) AS std_r,\n    COUNT(*) FILTER (WHERE fid = 1) AS ndet_g,\n    MAX(coalesce(magpsf_corr, magpsf)) FILTER (WHERE fid = 1) \n      - MIN(coalesce(magpsf_corr, magpsf)) FILTER (WHERE fid = 1) AS amp_g,\n    STDDEV_SAMP(coalesce(magpsf_corr, magpsf)) FILTER (WHERE fid = 1) AS std_g\n  FROM detection\n  GROUP BY oid\n)\nSELECT\n  /* return all columns from the used tables and subquery */\n  o.*,\n  p.*,\n  det.*\nFROM object o\nINNER JOIN probability p\n  ON p.oid = o.oid\nINNER JOIN det\n  ON det.oid = o.oid\nWHERE\n  /* default probability conditions */\n  p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n  /* AGN class */\n  AND p.class_name = 'AGN'\n  /* r-band shows variability */\n  AND det.amp_r IS NOT NULL\n  AND det.amp_r > 0\n  /* g-band has no detections or shows no variability */\n  AND (det.ndet_g = 0 OR coalesce(det.amp_g, 0) = 0)\nORDER BY\n  det.amp_r ASC,\n  o.oid ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* AGN objects (lc_classifier, rank=1) with variability in r-band (fid=2) \n   and no detections or no variability in g-band (fid=1).\n   Variability proxy = amplitude = max(mag) - min(mag).\n   Order by the feature (r-band amplitude) ascending, then by oid. */\n\nWITH det AS (\n  SELECT\n    oid,\n    COUNT(*) FILTER (WHERE fid = 2) AS ndet_r,\n    MAX(coalesce(magpsf_corr, magpsf)) FILTER (WHERE fid = 2) \n      - MIN(coalesce(magpsf_corr, magpsf)) FILTER (WHERE fid = 2) AS amp_r,\n    STDDEV_SAMP(coalesce(magpsf_corr, magpsf)) FILTER (WHERE fid = 2) AS std_r,\n    COUNT(*) FILTER (WHERE fid = 1) AS ndet_g,\n    MAX(coalesce(magpsf_corr, magpsf)) FILTER (WHERE fid = 1) \n      - MIN(coalesce(magpsf_corr, magpsf)) FILTER (WHERE fid = 1) AS amp_g,\n    STDDEV_SAMP(coalesce(magpsf_corr, magpsf)) FILTER (WHERE fid = 1) AS std_g\n  FROM detection\n  GROUP BY oid\n)\nSELECT\n  /* return all columns from the used tables and subquery */\n  o.*,\n  p.*,\n  det.*\nFROM object o\nINNER JOIN probability p\n  ON p.oid = o.oid\nINNER JOIN det\n  ON det.oid = o.oid\nWHERE\n  /* default probability conditions */\n  p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n  /* AGN class */\n  AND p.class_name = 'AGN'\n  /* r-band shows variability */\n  AND det.amp_r IS NOT NULL\n  AND det.amp_r > 0\n  /* g-band has no detections or shows no variability */\n  AND (det.ndet_g = 0 OR coalesce(det.amp_g, 0) = 0)\nORDER BY\n  det.amp_r ASC,\n  o.oid ASC;\n```"
                },
                "in_toks": 3016,
                "out_toks": 3421,
                "id": "chatcmpl-CZb3QefMynBHUxokx0jAezbYbOoYm",
                "created": 1762599952,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "37": {
        "0": {
            "req_id": "37",
            "experiment_id": "run_0",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']",
                    "1": "['probability', 'taxonomy']"
                },
                "in_toks": 615,
                "out_toks": 1184,
                "id": "chatcmpl-CSnR2X2auYn6KmFcrUu5Ak5pyU47k",
                "created": 1760979248,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 655,
                "out_toks": 207,
                "id": "chatcmpl-CSng00m8aUVRIimzVP42CQJM3IK9l",
                "created": 1760980176,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier, ordered by probability descending\nSELECT *\nFROM probability p\nWHERE p.classifier_name = 'lc_classifier' -- light curve classifier\n  AND p.class_name = 'SNIa'               -- desired class\n  AND p.ranking = 1                       -- most likely class per object\nORDER BY p.probability DESC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier, ordered by probability descending\nSELECT *\nFROM probability p\nWHERE p.classifier_name = 'lc_classifier' -- light curve classifier\n  AND p.class_name = 'SNIa'               -- desired class\n  AND p.ranking = 1                       -- most likely class per object\nORDER BY p.probability DESC\nLIMIT 200;\n```"
                },
                "in_toks": 1973,
                "out_toks": 485,
                "id": "chatcmpl-CSqs1zvFzUKe91jdhnnV4zpjsi52D",
                "created": 1760992453,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "37",
            "experiment_id": "run_1",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']",
                    "1": "['probability', 'taxonomy']"
                },
                "in_toks": 615,
                "out_toks": 1184,
                "id": "chatcmpl-CSnR2X2auYn6KmFcrUu5Ak5pyU47k",
                "created": 1760979248,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 655,
                "out_toks": 207,
                "id": "chatcmpl-CSng3Ie4mzRosVDFV0wmdoYJEvmjG",
                "created": 1760980179,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier (ranking=1), ordered by probability descending\nSELECT *\nFROM probability\nWHERE class_name = 'SNIa'\n  AND classifier_name = 'lc_classifier'\n  AND ranking = 1\nORDER BY probability DESC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier (ranking=1), ordered by probability descending\nSELECT *\nFROM probability\nWHERE class_name = 'SNIa'\n  AND classifier_name = 'lc_classifier'\n  AND ranking = 1\nORDER BY probability DESC\nLIMIT 200;\n```"
                },
                "in_toks": 1973,
                "out_toks": 399,
                "id": "chatcmpl-CSqs15SHRrOEfLpRLa1ZX56gnNn4F",
                "created": 1760992453,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "37",
            "experiment_id": "run_2",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']"
                },
                "in_toks": 615,
                "out_toks": 784,
                "id": "chatcmpl-CSsUA7bo17TxsrP8xHQWcGjaSwjaj",
                "created": 1760998662,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 655,
                "out_toks": 143,
                "id": "chatcmpl-CSxQayrSm96qbIJOrzmgJSaZG0XFd",
                "created": 1761017660,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Top 200 SNIa objects by lc_classifier with highest probability (ranking = 1)\nSELECT *\nFROM probability\nWHERE classifier_name = 'lc_classifier'\n  AND ranking = 1\n  AND class_name = 'SNIa'\nORDER BY probability DESC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Top 200 SNIa objects by lc_classifier with highest probability (ranking = 1)\nSELECT *\nFROM probability\nWHERE classifier_name = 'lc_classifier'\n  AND ranking = 1\n  AND class_name = 'SNIa'\nORDER BY probability DESC\nLIMIT 200;\n```"
                },
                "in_toks": 1973,
                "out_toks": 328,
                "id": "chatcmpl-CSy2rNq7mYWhVar76XUkcIRcb6I7A",
                "created": 1761020033,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "37",
            "experiment_id": "run_3",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']"
                },
                "in_toks": 615,
                "out_toks": 336,
                "id": "chatcmpl-CSsUM8Aunb22j8cR5iKrRXKsRwqYV",
                "created": 1760998674,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 655,
                "out_toks": 143,
                "id": "chatcmpl-CSxQdtm093nmynUs1F4XAlKaNjkHo",
                "created": 1761017663,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier (most likely class), ordered by probability descending\nSELECT *\nFROM probability\nWHERE class_name = 'SNIa'\n  AND classifier_name = 'lc_classifier'\n  AND ranking = 1\nORDER BY probability DESC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier (most likely class), ordered by probability descending\nSELECT *\nFROM probability\nWHERE class_name = 'SNIa'\n  AND classifier_name = 'lc_classifier'\n  AND ranking = 1\nORDER BY probability DESC\nLIMIT 200;\n```"
                },
                "in_toks": 1973,
                "out_toks": 527,
                "id": "chatcmpl-CSxhkZfbRRrhzzXrFYhzgfU1N6X98",
                "created": 1761018724,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "37",
            "experiment_id": "run_4",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']"
                },
                "in_toks": 615,
                "out_toks": 464,
                "id": "chatcmpl-CSsUSf1fcvdhvVVe8bw6LzpagqDgL",
                "created": 1760998680,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 655,
                "out_toks": 271,
                "id": "chatcmpl-CSxQgX1OZgA1U0WulViv04fm2VPM4",
                "created": 1761017666,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier (lc_classifier),\n-- using only the most likely class per object (ranking = 1), ordered by probability descending.\nSELECT\n    *\nFROM\n    probability\nWHERE\n    classifier_name = 'lc_classifier'\n    AND ranking = 1\n    AND class_name = 'SNIa'\nORDER BY\n    probability DESC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier (lc_classifier),\n-- using only the most likely class per object (ranking = 1), ordered by probability descending.\nSELECT\n    *\nFROM\n    probability\nWHERE\n    classifier_name = 'lc_classifier'\n    AND ranking = 1\n    AND class_name = 'SNIa'\nORDER BY\n    probability DESC\nLIMIT 200;\n```"
                },
                "in_toks": 1973,
                "out_toks": 357,
                "id": "chatcmpl-CSy2zezTY9RsyuVM8mG1Ufde1QJ74",
                "created": 1761020041,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "37",
            "experiment_id": "run_5",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']"
                },
                "in_toks": 615,
                "out_toks": 784,
                "id": "chatcmpl-CZM9PbQjxJimSPDwXrPECpBrDtQOA",
                "created": 1762542663,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 655,
                "out_toks": 143,
                "id": "chatcmpl-CZY9mmohhJIk3D2UKZhmv2KH3ZUEU",
                "created": 1762588814,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier (lc_classifier), ordered by probability descending\nSELECT *\nFROM probability\nWHERE classifier_name = 'lc_classifier'\n  AND ranking = 1\n  AND class_name = 'SNIa'\nORDER BY probability DESC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier (lc_classifier), ordered by probability descending\nSELECT *\nFROM probability\nWHERE classifier_name = 'lc_classifier'\n  AND ranking = 1\n  AND class_name = 'SNIa'\nORDER BY probability DESC\nLIMIT 200;\n```"
                },
                "in_toks": 1973,
                "out_toks": 334,
                "id": "chatcmpl-CZaNujB57MVnnLEoLib0EbVI5kRur",
                "created": 1762597378,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "37",
            "experiment_id": "run_6",
            "pred_tables": [
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability']"
                },
                "in_toks": 615,
                "out_toks": 525,
                "id": "chatcmpl-CZM9m7ljmtYItVm8gxikbwg6B711M",
                "created": 1762542686,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 610,
                "out_toks": 143,
                "id": "chatcmpl-CZY9r3Lfw8XLb8EYY9DGaQ9JV7TdG",
                "created": 1762588819,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier (lc_classifier)\n-- Using default conditions: ranking = 1 (most likely class) and classifier_name = 'lc_classifier'\nSELECT *\nFROM probability\nWHERE class_name = 'SNIa'\n  AND classifier_name = 'lc_classifier'\n  AND ranking = 1\nORDER BY probability DESC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier (lc_classifier)\n-- Using default conditions: ranking = 1 (most likely class) and classifier_name = 'lc_classifier'\nSELECT *\nFROM probability\nWHERE class_name = 'SNIa'\n  AND classifier_name = 'lc_classifier'\n  AND ranking = 1\nORDER BY probability DESC\nLIMIT 200;\n```"
                },
                "in_toks": 1928,
                "out_toks": 415,
                "id": "chatcmpl-CZZeBwUnoiAECdcOW5B2r3ObAD9Tx",
                "created": 1762594543,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "37",
            "experiment_id": "run_7",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']"
                },
                "in_toks": 615,
                "out_toks": 1104,
                "id": "chatcmpl-CZM9u5gJPxeZqLgcVIJdpAMCbPvQs",
                "created": 1762542694,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 655,
                "out_toks": 143,
                "id": "chatcmpl-CZY9us2qjgdLuE17M5Ps5DakyT3sd",
                "created": 1762588822,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier (lc_classifier)\n-- Only the most likely class per object (ranking = 1)\n-- Ordered by probability descending\nSELECT *\nFROM probability\nWHERE class_name = 'SNIa'\n  AND classifier_name = 'lc_classifier'\n  AND ranking = 1\nORDER BY probability DESC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier (lc_classifier)\n-- Only the most likely class per object (ranking = 1)\n-- Ordered by probability descending\nSELECT *\nFROM probability\nWHERE class_name = 'SNIa'\n  AND classifier_name = 'lc_classifier'\n  AND ranking = 1\nORDER BY probability DESC\nLIMIT 200;\n```"
                },
                "in_toks": 1973,
                "out_toks": 413,
                "id": "chatcmpl-CZaYwK1uuaT6NhZnA43Khl5BkGgVX",
                "created": 1762598062,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "37",
            "experiment_id": "run_8",
            "pred_tables": [
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability']"
                },
                "in_toks": 615,
                "out_toks": 781,
                "id": "chatcmpl-CZMAI0g1PVCcdfanvBrvYIJFpUaPB",
                "created": 1762542718,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 610,
                "out_toks": 143,
                "id": "chatcmpl-CZY9wmBK1TVAq63gbOo3sE0s0O3tq",
                "created": 1762588824,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Top 200 SNIa objects by light curve classifier (lc_classifier), using only rank-1 predictions\nSELECT *\nFROM probability\nWHERE class_name = 'SNIa'\n  AND classifier_name = 'lc_classifier'\n  AND ranking = 1\nORDER BY probability DESC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Top 200 SNIa objects by light curve classifier (lc_classifier), using only rank-1 predictions\nSELECT *\nFROM probability\nWHERE class_name = 'SNIa'\n  AND classifier_name = 'lc_classifier'\n  AND ranking = 1\nORDER BY probability DESC\nLIMIT 200;\n```"
                },
                "in_toks": 1928,
                "out_toks": 395,
                "id": "chatcmpl-CZaO4WLWtryGLUkOTg3E0NYtyQMaX",
                "created": 1762597388,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "37",
            "experiment_id": "run_9",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']"
                },
                "in_toks": 615,
                "out_toks": 592,
                "id": "chatcmpl-CZMAbxEAe2yLvrRflfpFYh8B4LBGA",
                "created": 1762542737,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 655,
                "out_toks": 79,
                "id": "chatcmpl-CZYA07e9NXlYLMlBJX8pBQYb9Nx9l",
                "created": 1762588828,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier,\n-- returning only the highest-probability (ranking=1) entries,\n-- ordered by probability descending.\nSELECT *\nFROM probability\nWHERE classifier_name = 'lc_classifier'\n  AND ranking = 1\n  AND class_name = 'SNIa'\nORDER BY probability DESC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Top 200 objects classified as 'SNIa' by the light curve classifier,\n-- returning only the highest-probability (ranking=1) entries,\n-- ordered by probability descending.\nSELECT *\nFROM probability\nWHERE classifier_name = 'lc_classifier'\n  AND ranking = 1\n  AND class_name = 'SNIa'\nORDER BY probability DESC\nLIMIT 200;\n```"
                },
                "in_toks": 1973,
                "out_toks": 411,
                "id": "chatcmpl-CZZeXbBSUgDsTHkimiSySA8PxdgwI",
                "created": 1762594565,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "34": {
        "0": {
            "req_id": "34",
            "experiment_id": "run_0",
            "pred_tables": [
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['feature']",
                    "1": "['feature']"
                },
                "in_toks": 704,
                "out_toks": 1176,
                "id": "chatcmpl-CSnRDc2zssFOaFaoebOh07xzzCwnh",
                "created": 1760979259,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 2946,
                "out_toks": 463,
                "id": "chatcmpl-CSng7NTWNtDZPHpYJcmCQP0UzWfXW",
                "created": 1760980183,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all feature rows for 'Amplitude' or 'Multiband_period' for the given list of oids\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all feature rows for 'Amplitude' or 'Multiband_period' for the given list of oids\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```"
                },
                "in_toks": 4263,
                "out_toks": 677,
                "id": "chatcmpl-CSqs1SctOxxcT94x2D3TtaQ6SEH17",
                "created": 1760992453,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "34",
            "experiment_id": "run_1",
            "pred_tables": [
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['feature']",
                    "1": "['feature']"
                },
                "in_toks": 704,
                "out_toks": 1176,
                "id": "chatcmpl-CSnRDc2zssFOaFaoebOh07xzzCwnh",
                "created": 1760979259,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 2946,
                "out_toks": 271,
                "id": "chatcmpl-CSngKCsb5zLpvJm4gtNQYhK67TqKK",
                "created": 1760980196,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all feature rows for Amplitude or Multiband_period for the given oids\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all feature rows for Amplitude or Multiband_period for the given oids\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```"
                },
                "in_toks": 4263,
                "out_toks": 608,
                "id": "chatcmpl-CSqs8UmFEkoW0M6SPktyKq6fkibR3",
                "created": 1760992460,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "34",
            "experiment_id": "run_2",
            "pred_tables": [
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['feature']"
                },
                "in_toks": 704,
                "out_toks": 396,
                "id": "chatcmpl-CSsUc5QQv6xkxNbcBcZQiyfAHB2LL",
                "created": 1760998690,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 2946,
                "out_toks": 207,
                "id": "chatcmpl-CSxQkNrytsoK6wsUQ2I1HHJGp3JgR",
                "created": 1761017670,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all rows from the feature table for the specified objects\n-- limited to the features 'Amplitude' and 'Multiband_period'\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all rows from the feature table for the specified objects\n-- limited to the features 'Amplitude' and 'Multiband_period'\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```"
                },
                "in_toks": 4263,
                "out_toks": 1193,
                "id": "chatcmpl-CSxhuPn8rPoG6HKPf391tU2EdBCox",
                "created": 1761018734,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "34",
            "experiment_id": "run_3",
            "pred_tables": [
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['feature']"
                },
                "in_toks": 704,
                "out_toks": 268,
                "id": "chatcmpl-CSsUjvJRYIrHdwwcmiteepKeGBpJN",
                "created": 1760998697,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 2946,
                "out_toks": 271,
                "id": "chatcmpl-CSxQoXlzvmCy5d5flQl9BbVZNQ0C1",
                "created": 1761017674,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Returns all feature rows for 'Amplitude' or 'Multiband_period' for the given list of oids\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Returns all feature rows for 'Amplitude' or 'Multiband_period' for the given list of oids\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```"
                },
                "in_toks": 4263,
                "out_toks": 741,
                "id": "chatcmpl-CSy39MocSDye5PS3gLlg1wdbFYmCo",
                "created": 1761020051,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "34",
            "experiment_id": "run_4",
            "pred_tables": [
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['feature']"
                },
                "in_toks": 704,
                "out_toks": 268,
                "id": "chatcmpl-CSsUpH6lb6XYiEvnXZkPKXomBN2At",
                "created": 1760998703,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2946,
                "out_toks": 527,
                "id": "chatcmpl-CSxQrKZoFKtFsWnxDl1cCJgp4OMu8",
                "created": 1761017677,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 4825,
                "out_toks": 4000,
                "id": "chatcmpl-CSxiBxELCvkZWVCwbQKDbprDJCgth",
                "created": 1761018751,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* Returns the requested features for the given list of oids.\n   - \"Amplitude\" is computed as (max - min) of magpsf_corr across all detections for each oid.\n   - \"Multiband_period\" is not available in the provided schema; returned as NULL.\n*/\nWITH input_oids (oid) AS (\n    VALUES \n        ('ZTF17aaadpsi'),\n        ('ZTF19aaduncs'),\n        ('ZTF18abnvehl'),\n        ('ZTF19abrqsxy'),\n        ('ZTF19aaduodl'),\n        ('ZTF19aadovdv'),\n        ('ZTF18aammkke'),\n        ('ZTF18abtriul'),\n        ('ZTF17aabwtky'),\n        ('ZTF18abwjpfy')\n),\ndet AS (\n    SELECT d.oid, d.magpsf_corr\n    FROM detection d\n    INNER JOIN input_oids i USING (oid)\n    WHERE d.magpsf_corr IS NOT NULL\n),\namplitude AS (\n    SELECT \n        oid, \n        (MAX(magpsf_corr) - MIN(magpsf_corr))::DOUBLE PRECISION AS \"Amplitude\"\n    FROM det\n    GROUP BY oid\n)\nSELECT \n    i.oid, \n    a.\"Amplitude\",\n    NULL::DOUBLE PRECISION AS \"Multiband_period\"\nFROM input_oids i\nLEFT JOIN amplitude a USING (oid)\nORDER BY i.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* Returns the requested features for the given list of oids.\n   - \"Amplitude\" is computed as (max - min) of magpsf_corr across all detections for each oid.\n   - \"Multiband_period\" is not available in the provided schema; returned as NULL.\n*/\nWITH input_oids (oid) AS (\n    VALUES \n        ('ZTF17aaadpsi'),\n        ('ZTF19aaduncs'),\n        ('ZTF18abnvehl'),\n        ('ZTF19abrqsxy'),\n        ('ZTF19aaduodl'),\n        ('ZTF19aadovdv'),\n        ('ZTF18aammkke'),\n        ('ZTF18abtriul'),\n        ('ZTF17aabwtky'),\n        ('ZTF18abwjpfy')\n),\ndet AS (\n    SELECT d.oid, d.magpsf_corr\n    FROM detection d\n    INNER JOIN input_oids i USING (oid)\n    WHERE d.magpsf_corr IS NOT NULL\n),\namplitude AS (\n    SELECT \n        oid, \n        (MAX(magpsf_corr) - MIN(magpsf_corr))::DOUBLE PRECISION AS \"Amplitude\"\n    FROM det\n    GROUP BY oid\n)\nSELECT \n    i.oid, \n    a.\"Amplitude\",\n    NULL::DOUBLE PRECISION AS \"Multiband_period\"\nFROM input_oids i\nLEFT JOIN amplitude a USING (oid)\nORDER BY i.oid;\n```"
                },
                "in_toks": 3091,
                "out_toks": 2875,
                "id": "chatcmpl-CSyNR5gKslQ4SO5Nx8q69GRXxJ4Yq",
                "created": 1761021309,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "34",
            "experiment_id": "run_5",
            "pred_tables": [
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['feature']"
                },
                "in_toks": 704,
                "out_toks": 716,
                "id": "chatcmpl-CZMAnV6MZGqyvPaQkw1PjB3qkmjgq",
                "created": 1762542749,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 2946,
                "out_toks": 207,
                "id": "chatcmpl-CZYA3n3wBvgZmpKMSVC3Vr3lZfyYq",
                "created": 1762588831,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all feature rows for 'Amplitude' or 'Multiband_period' for the specified objects\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all feature rows for 'Amplitude' or 'Multiband_period' for the specified objects\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```"
                },
                "in_toks": 4263,
                "out_toks": 802,
                "id": "chatcmpl-CZaZ5c015RVZxVaujWax0FxOPcYzb",
                "created": 1762598071,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "34",
            "experiment_id": "run_6",
            "pred_tables": [
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['feature']"
                },
                "in_toks": 704,
                "out_toks": 140,
                "id": "chatcmpl-CZMB8btSGLBwtEJpRwnpz383iBXax",
                "created": 1762542770,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 2946,
                "out_toks": 143,
                "id": "chatcmpl-CZYA7t5JHCr7brCAUftJqszpOEb8a",
                "created": 1762588835,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all feature rows for the specified oids where the feature is 'Amplitude' or 'Multiband_period'\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all feature rows for the specified oids where the feature is 'Amplitude' or 'Multiband_period'\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```"
                },
                "in_toks": 4263,
                "out_toks": 741,
                "id": "chatcmpl-CZaOCQVg4IBiBsAIY3HtusqOab7fc",
                "created": 1762597396,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "34",
            "experiment_id": "run_7",
            "pred_tables": [
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['feature']"
                },
                "in_toks": 704,
                "out_toks": 396,
                "id": "chatcmpl-CZMBCV9HQo7p4WbNNfalw6ytRvl8a",
                "created": 1762542774,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 2946,
                "out_toks": 271,
                "id": "chatcmpl-CZYAA9s3wBdpRleU2UUCESpl5hBQI",
                "created": 1762588838,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all rows from the 'feature' table for the requested objects and the features 'Amplitude' or 'Multiband_period'\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all rows from the 'feature' table for the requested objects and the features 'Amplitude' or 'Multiband_period'\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```"
                },
                "in_toks": 4263,
                "out_toks": 680,
                "id": "chatcmpl-CZZej0EKkE9Yg3FUGKNQlS81ADBFm",
                "created": 1762594577,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "34",
            "experiment_id": "run_8",
            "pred_tables": [
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['feature']"
                },
                "in_toks": 704,
                "out_toks": 332,
                "id": "chatcmpl-CZMBN003PlbPhJllGMEdYXuAoGVrI",
                "created": 1762542785,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 2946,
                "out_toks": 143,
                "id": "chatcmpl-CZYAGHxe4yfpiNyrxvOwrKSVh3Rjd",
                "created": 1762588844,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Features 'Amplitude' or 'Multiband_period' for the specified oids\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  );\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Features 'Amplitude' or 'Multiband_period' for the specified oids\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  );\n```"
                },
                "in_toks": 4263,
                "out_toks": 853,
                "id": "chatcmpl-CZaOXeOH0gXJSs60xyQm55GKoNaCq",
                "created": 1762597417,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "34",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'feature']"
                },
                "in_toks": 704,
                "out_toks": 271,
                "id": "chatcmpl-CZMBXifasv28aviymPc8teNEI0GCB",
                "created": 1762542795,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 3428,
                "out_toks": 399,
                "id": "chatcmpl-CZYAJ62PxNMVnlvqKYshnFVD78H4Z",
                "created": 1762588847,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all rows in the 'feature' table for the specified objects\n-- limited to the features 'Amplitude' or 'Multiband_period'.\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all rows in the 'feature' table for the specified objects\n-- limited to the features 'Amplitude' or 'Multiband_period'.\nSELECT *\nFROM feature\nWHERE name IN ('Amplitude', 'Multiband_period')\n  AND oid IN (\n    'ZTF17aaadpsi',\n    'ZTF19aaduncs',\n    'ZTF18abnvehl',\n    'ZTF19abrqsxy',\n    'ZTF19aaduodl',\n    'ZTF19aadovdv',\n    'ZTF18aammkke',\n    'ZTF18abtriul',\n    'ZTF17aabwtky',\n    'ZTF18abwjpfy'\n  )\nORDER BY oid, name, fid, version;\n```"
                },
                "in_toks": 4745,
                "out_toks": 875,
                "id": "chatcmpl-CZZfQOXTTNKbP2sd0TEXM6Fvocbhw",
                "created": 1762594620,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "1": {
        "0": {
            "req_id": "1",
            "experiment_id": "run_0",
            "pred_tables": [
                "probability",
                "taxonomy",
                "object",
                "detection",
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'object', 'detection', 'feature']",
                    "1": "['object', 'probability', 'taxonomy', 'detection', 'feature', 'feature_version']"
                },
                "in_toks": 737,
                "out_toks": 3768,
                "id": "chatcmpl-CSnRMZVL5fCoKd8sNFTC9XZ6qtbfd",
                "created": 1760979268,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query: pre-filter by classification and 1-year span, then by n_det>=20, then aggregate corrected magnitudes only for g/r bands on the reduced set\nWITH p AS\n  (SELECT oid\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND class_name = 'AGN'\n     AND ranking = 1\n     AND probability > 0.6),\n     o AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet,\n          o.deltajd\n   FROM OBJECT o\n   INNER JOIN p USING (oid)\n   WHERE o.deltajd >= 365 -- span >= 1 year\n), -- Require at least 20 detections in at least one band (use precomputed feature n_det per band)\nf_any AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN o USING (oid)\n   WHERE f.name = 'n_det'\n     AND f.fid IN (1,\n                   2,\n                   3)\n     AND f.value >= 20), -- Restrict detections to the reduced set (oids with n_det>=20) and required bands, using corrected magnitudes\nd AS\n  (SELECT d.oid,\n          d.fid,\n          d.magpsf_corr\n   FROM detection d\n   INNER JOIN o USING (oid)\n   WHERE d.oid IN\n       (SELECT oid\n        FROM f_any)\n     AND d.fid IN (1,\n                   2)\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL), -- Aggregate min/max and deltas per oid for g and r, enforce variability thresholds\nagg AS\n  (SELECT oid,\n          MIN(magpsf_corr) FILTER (\n                                   WHERE fid = 1) AS g_min_mag_corr,\n          MAX(magpsf_corr) FILTER (\n                                   WHERE fid = 1) AS g_max_mag_corr,\n          (MAX(magpsf_corr) FILTER (\n                                    WHERE fid = 1) - MIN(magpsf_corr) FILTER (\n                                                                              WHERE fid = 1)) AS g_delta_mag,\n          MIN(magpsf_corr) FILTER (\n                                   WHERE fid = 2) AS r_min_mag_corr,\n          MAX(magpsf_corr) FILTER (\n                                   WHERE fid = 2) AS r_max_mag_corr,\n          (MAX(magpsf_corr) FILTER (\n                                    WHERE fid = 2) - MIN(magpsf_corr) FILTER (\n                                                                              WHERE fid = 2)) AS r_delta_mag\n   FROM d\n   GROUP BY oid\n   HAVING (MAX(magpsf_corr) FILTER (\n                                    WHERE fid = 1) - MIN(magpsf_corr) FILTER (\n                                                                              WHERE fid = 1)) > 1.0\n   AND (MAX(magpsf_corr) FILTER (\n                                 WHERE fid = 2) - MIN(magpsf_corr) FILTER (\n                                                                           WHERE fid = 2)) > 0.5), -- Return the feature rows (per-band n_det >= 20) with requested alias for filter id\nfr AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN f_any USING (oid)\n   WHERE f.name = 'n_det'\n     AND f.value >= 20)\nSELECT o.oid,\n       fr.value,\n       fr.name,\n       fr.version,\n       fr.feature_fid, -- filter id from features, aliased as requested\n o.meanra,\n o.meandec,\n o.ndet,\n agg.g_min_mag_corr,\n agg.g_max_mag_corr,\n agg.g_delta_mag AS delta_mag_g,\n agg.r_min_mag_corr,\n agg.r_max_mag_corr,\n agg.r_delta_mag AS delta_mag_r\nFROM o\nINNER JOIN agg USING (oid)\nINNER JOIN fr USING (oid)\nORDER BY o.oid,\n         fr.feature_fid;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query: pre-filter by classification and 1-year span, then by n_det>=20, then aggregate corrected magnitudes only for g/r bands on the reduced set\nWITH p AS\n  (SELECT oid\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND class_name = 'AGN'\n     AND ranking = 1\n     AND probability > 0.6),\n     o AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet,\n          o.deltajd\n   FROM OBJECT o\n   INNER JOIN p USING (oid)\n   WHERE o.deltajd >= 365 -- span >= 1 year\n), -- Require at least 20 detections in at least one band (use precomputed feature n_det per band)\nf_any AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN o USING (oid)\n   WHERE f.name = 'n_det'\n     AND f.fid IN (1,\n                   2,\n                   3)\n     AND f.value >= 20), -- Restrict detections to the reduced set (oids with n_det>=20) and required bands, using corrected magnitudes\nd AS\n  (SELECT d.oid,\n          d.fid,\n          d.magpsf_corr\n   FROM detection d\n   INNER JOIN o USING (oid)\n   WHERE d.oid IN\n       (SELECT oid\n        FROM f_any)\n     AND d.fid IN (1,\n                   2)\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL), -- Aggregate min/max and deltas per oid for g and r, enforce variability thresholds\nagg AS\n  (SELECT oid,\n          MIN(magpsf_corr) FILTER (\n                                   WHERE fid = 1) AS g_min_mag_corr,\n          MAX(magpsf_corr) FILTER (\n                                   WHERE fid = 1) AS g_max_mag_corr,\n          (MAX(magpsf_corr) FILTER (\n                                    WHERE fid = 1) - MIN(magpsf_corr) FILTER (\n                                                                              WHERE fid = 1)) AS g_delta_mag,\n          MIN(magpsf_corr) FILTER (\n                                   WHERE fid = 2) AS r_min_mag_corr,\n          MAX(magpsf_corr) FILTER (\n                                   WHERE fid = 2) AS r_max_mag_corr,\n          (MAX(magpsf_corr) FILTER (\n                                    WHERE fid = 2) - MIN(magpsf_corr) FILTER (\n                                                                              WHERE fid = 2)) AS r_delta_mag\n   FROM d\n   GROUP BY oid\n   HAVING (MAX(magpsf_corr) FILTER (\n                                    WHERE fid = 1) - MIN(magpsf_corr) FILTER (\n                                                                              WHERE fid = 1)) > 1.0\n   AND (MAX(magpsf_corr) FILTER (\n                                 WHERE fid = 2) - MIN(magpsf_corr) FILTER (\n                                                                           WHERE fid = 2)) > 0.5), -- Return the feature rows (per-band n_det >= 20) with requested alias for filter id\nfr AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN f_any USING (oid)\n   WHERE f.name = 'n_det'\n     AND f.value >= 20)\nSELECT o.oid,\n       fr.value,\n       fr.name,\n       fr.version,\n       fr.feature_fid, -- filter id from features, aliased as requested\n o.meanra,\n o.meandec,\n o.ndet,\n agg.g_min_mag_corr,\n agg.g_max_mag_corr,\n agg.g_delta_mag AS delta_mag_g,\n agg.r_min_mag_corr,\n agg.r_max_mag_corr,\n agg.r_delta_mag AS delta_mag_r\nFROM o\nINNER JOIN agg USING (oid)\nINNER JOIN fr USING (oid)\nORDER BY o.oid,\n         fr.feature_fid;"
                },
                "in_toks": 6235,
                "out_toks": 4022,
                "id": "chatcmpl-CbGRBVxVY7kax166Dnua4zDg35tdD",
                "created": 1762997357,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 4238,
                "out_toks": 1039,
                "id": "chatcmpl-CSngScPY5ogYKrP4rEtEMMFkxaCYn",
                "created": 1760980204,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- AGN with probability > 0.6 from lc_classifier, top-ranked\nWITH p AS\n  (SELECT oid\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND ranking = 1\n     AND class_name = 'AGN'\n     AND probability > 0.6), -- Objects with light curve span >= 1 year\no AS\n  (SELECT o.*\n   FROM OBJECT o\n   INNER JOIN p USING (oid)\n   WHERE o.deltajd >= 365), -- g-band (fid=1) corrected-magnitude stats and variability > 1.0 mag\ng_stats AS\n  (SELECT d.oid,\n          MIN(d.magpsf_corr) AS g_min_mag_corr,\n          MAX(d.magpsf_corr) AS g_max_mag_corr,\n          (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS g_delta_mag\n   FROM detection d\n   INNER JOIN o USING (oid)\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid = 1\n   GROUP BY d.oid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 1.0), -- r-band (fid=2) corrected-magnitude stats and variability > 0.5 mag\nr_stats AS\n  (SELECT d.oid,\n          MIN(d.magpsf_corr) AS r_min_mag_corr,\n          MAX(d.magpsf_corr) AS r_max_mag_corr,\n          (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS r_delta_mag\n   FROM detection d\n   INNER JOIN o USING (oid)\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid = 2\n   GROUP BY d.oid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 0.5), -- Enforce both g and r variability thresholds\nvar_join AS\n  (SELECT gs.oid,\n          gs.g_min_mag_corr,\n          gs.g_max_mag_corr,\n          gs.g_delta_mag,\n          rs.r_min_mag_corr,\n          rs.r_max_mag_corr,\n          rs.r_delta_mag\n   FROM g_stats gs\n   INNER JOIN r_stats rs ON gs.oid = rs.oid), -- Feature 'n_det' >= 20 in any band (g=1, r=2, i=3), restricted to candidate oids\nf_ng AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN o USING (oid)\n   WHERE f.name = 'n_det'\n     AND f.fid = 1\n     AND f.value >= 20),\n                                                                                                                                f_nr AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN o USING (oid)\n   WHERE f.name = 'n_det'\n     AND f.fid = 2\n     AND f.value >= 20),\n                                                                                                                                f_ni AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN o USING (oid)\n   WHERE f.name = 'n_det'\n     AND f.fid = 3\n     AND f.value >= 20), -- Oids having >= 20 detections in at least one band\nf_n_any AS\n  (SELECT DISTINCT oid\n   FROM\n     (SELECT oid\n      FROM f_ng\n      UNION SELECT oid\n      FROM f_nr\n      UNION SELECT oid\n      FROM f_ni) u), -- Rows to return the feature columns\nfr AS\n  (SELECT *\n   FROM f_ng\n   UNION ALL SELECT *\n   FROM f_nr\n   UNION ALL SELECT *\n   FROM f_ni)\nSELECT o.oid,\n       fr.value,\n       fr.name,\n       fr.version,\n       fr.feature_fid, -- filter id from the features table, aliased as requested\n o.meanra,\n o.meandec,\n o.ndet,\n var_join.g_min_mag_corr,\n var_join.g_max_mag_corr,\n var_join.g_delta_mag, -- delta_mag for g-band (contains 'delta_mag' in the alias)\n var_join.r_min_mag_corr,\n var_join.r_max_mag_corr,\n var_join.r_delta_mag -- delta_mag for r-band (contains 'delta_mag' in the alias)\nFROM o\nINNER JOIN var_join USING (oid)\nINNER JOIN f_n_any USING (oid)\nINNER JOIN fr USING (oid)\nORDER BY o.oid,\n         fr.feature_fid;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\nSelect ALeRCE objects that:\n- Are classified as AGN with probability > 0.6 (using lc_classifier, top-ranked class).\n- Have light curves spanning at least 1 year.\n- Have \u2265 20 detections in at least one band (g, r, or i).\n- Show corrected-magnitude variability > 1.0 mag in g (fid=1) and > 0.5 mag in r (fid=2).\nReturn for each selected object:\n- oid,\n- feature.value, feature.name, feature.version, and feature.fid (aliased as feature_fid),\n- object.meanra, object.meandec,\n- object.ndet,\n- per-band (g and r) corrected maximum and minimum magnitudes,\n- per-band (g and r) variations as max \u2212 min, with the variation columns clearly labeled (use separate columns for g and r and include \u201cdelta_mag\u201d in the alias).\n\nKey schema elements and constraints\n- probability: (oid, class_name, classifier_name, classifier_version, probability, ranking)\n  - Default constraints: ranking = 1 and classifier_name = 'lc_classifier'\n  - Filter: class_name = 'AGN' and probability > 0.6\n- object: (oid, deltajd, meanra, meandec, ndet, ...)\n  - Filter: deltajd >= 365 (days)\n- detection: (oid, fid, magpsf_corr, corrected, ...)\n  - We will aggregate per (oid) within each target band and only over rows with corrected = TRUE and magpsf_corr IS NOT NULL.\n  - fid = 1 (g), 2 (r), 3 (i)\n- feature: (oid, name, value, fid, version)\n  - Use for band-specific detection counts via name = 'n_det' (value is the number of detections in the alert light curve per band).\n  - Because we will only use one feature name ('n_det'), the transposed-table multi-feature UNION/INTERSECT choreography is not strictly required for correctness, but we will still use UNION to gather band-wise eligibility and satisfy the \u201cadvanced query\u201d guidance.\n\nHigh-level structure\n- Build a base set of oids meeting classification and time-span constraints (probability + object).\n- Compute variability constraints from detection on corrected magnitudes for g and r separately (two subqueries), then INTERSECT the resulting oid sets (or INNER JOIN on oid) so both thresholds must be satisfied.\n- Ensure \u2265 20 detections in at least one band using feature.name = 'n_det' with value >= 20 (across fid in (1,2,3)), by UNION-ing per-band feature subqueries and using the unioned oid set as a semi-join filter.\n- Assemble final rows by joining:\n  - the base (probability + object),\n  - the band-variability aggregates (g and r),\n  - and the selected n_det feature rows (to return feature.value/name/version/fid).\n- Return columns as specified, using feature.fid AS feature_fid; for detection-derived band metrics, present both g and r columns with distinct names (e.g., g_min_mag_corr, g_max_mag_corr, g_delta_mag; r_min_mag_corr, r_max_mag_corr, r_delta_mag).\n\nDetailed step-by-step decomposition\n\nStep 1: Probability filter (subquery p)\n- Purpose: limit to lc_classifier top-ranked AGN with probability > 0.6.\n- FROM probability p\n- WHERE:\n  - p.classifier_name = 'lc_classifier'\n  - p.ranking = 1\n  - p.class_name = 'AGN'\n  - p.probability > 0.6\n- SELECT DISTINCT p.oid (and optionally p.probability if needed later; by default only oid).\n- Index leverage: ix_classification_rank1, ix_probabilities_probability.\n\nStep 2: Time-span and base object info (subquery o)\n- Purpose: enforce \u2265 1-year light-curve span and collect object metadata.\n- FROM object o\n- INNER JOIN p USING (oid)\n- WHERE o.deltajd >= 365\n- SELECT:\n  - o.oid,\n  - o.meanra,\n  - o.meandec,\n  - o.ndet,\n  - o.deltajd (optional, only for checking).\n- Index leverage: ix_object_firstmjd is not directly for deltajd, but base table is small enough post-join; the join on oid uses primary key.\n\nStep 3: Detection-based variability on corrected magnitudes\nCompute per-oid variability metrics on corrected magnitudes separately for g and r. Pre-restrict to only oids in Step 2 to minimize scanning.\n\n3a) g-band corrected stats (subquery g_stats)\n- Purpose: compute min, max, and delta on corrected mags in g (fid=1) and require delta > 1.0 mag.\n- FROM detection d\n- INNER JOIN o USING (oid)  // pre-filter by qualified oids\n- WHERE:\n  - d.corrected = TRUE\n  - d.magpsf_corr IS NOT NULL\n  - d.fid = 1\n- GROUP BY d.oid\n- SELECT:\n  - d.oid,\n  - MIN(d.magpsf_corr) AS g_min_mag_corr,\n  - MAX(d.magpsf_corr) AS g_max_mag_corr,\n  - (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS g_delta_mag\n- HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 1.0\n- Notes:\n  - We do not filter on other detection parameters (e.g., drb) since not requested.\n  - The oid hash index (ix_ndetection_oid) and the pre-join restriction keep this efficient.\n\n3b) r-band corrected stats (subquery r_stats)\n- Purpose: compute min, max, and delta on corrected mags in r (fid=2) and require delta > 0.5 mag.\n- FROM detection d\n- INNER JOIN o USING (oid)\n- WHERE:\n  - d.corrected = TRUE\n  - d.magpsf_corr IS NOT NULL\n  - d.fid = 2\n- GROUP BY d.oid\n- SELECT:\n  - d.oid,\n  - MIN(d.magpsf_corr) AS r_min_mag_corr,\n  - MAX(d.magpsf_corr) AS r_max_mag_corr,\n  - (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS r_delta_mag\n- HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 0.5\n\n3c) Require both g and r variability simultaneously (subquery var_join)\n- Purpose: enforce both thresholds by intersecting oid sets (or equivalently inner joining the per-band aggregates).\n- Option A (set-based): SELECT oid FROM g_stats INTERSECT SELECT oid FROM r_stats\n- Option B (preferred for carrying metrics): INNER JOIN g_stats gs ON gs.oid = rs.oid\n- Output (using INNER JOIN approach):\n  - oid,\n  - g_min_mag_corr, g_max_mag_corr, g_delta_mag,\n  - r_min_mag_corr, r_max_mag_corr, r_delta_mag\n\nStep 4: At least 20 detections in any band using the feature table\nUse feature table to assert per-band detection counts via name='n_det'. Use UNION across bands to build the eligible oid set, and also prepare the rows to return feature columns.\n\n4a) n_det per g band (subquery f_ng)\n- FROM feature f\n- INNER JOIN p USING (oid)  // limit to classified oids\n- WHERE f.name = 'n_det' AND f.fid = 1 AND f.value >= 20\n- SELECT:\n  - f.oid,\n  - f.value,\n  - f.name,\n  - f.version,\n  - f.fid AS feature_fid\n\n4b) n_det per r band (subquery f_nr)\n- Same as 4a but with f.fid = 2\n\n4c) n_det per i band (subquery f_ni)\n- Same as 4a but with f.fid = 3\n\n4d) Oids satisfying \u2265 20 detections in at least one band (subquery f_n_any)\n- Purpose: set of oids with f.name='n_det' and value >= 20 for any fid in (1,2,3).\n- Build by UNION (deduplicating) of (SELECT oid FROM f_ng) UNION (SELECT oid FROM f_nr) UNION (SELECT oid FROM f_ni).\n\n4e) Rows to return feature columns (subquery f_rows)\n- Purpose: collect the feature rows to return (value, name, version, feature_fid) for any band meeting the \u2265 20 criterion.\n- Build by UNION ALL of the three per-band subqueries (f_ng UNION ALL f_nr UNION ALL f_ni).\n- Columns:\n  - oid, value, name, version, feature_fid\n\nStep 5: Assemble and enforce all constraints\n- Start from o (objects already filtered by p and deltajd).\n- INNER JOIN var_join USING (oid)  // enforces both g and r variability thresholds and provides the min/max/delta per band.\n- INNER JOIN f_n_any USING (oid)   // enforces the \u2265 20 detections in at least one band.\n- INNER JOIN f_rows fr USING (oid) // attaches feature columns to return; multiple rows per oid are expected if multiple bands meet the \u2265 20 criterion.\n- Columns to SELECT:\n  - o.oid\n  - fr.value AS value\n  - fr.name AS name\n  - fr.version AS version\n  - fr.feature_fid AS feature_fid  // alias the filter id from the features table\n  - o.meanra\n  - o.meandec\n  - o.ndet\n  - var_join.g_min_mag_corr AS g_min_mag_corr\n  - var_join.g_max_mag_corr AS g_max_mag_corr\n  - var_join.g_delta_mag AS g_delta_mag  // include \u201cdelta_mag\u201d in the alias; band-specific prefix avoids collision\n  - var_join.r_min_mag_corr AS r_min_mag_corr\n  - var_join.r_max_mag_corr AS r_max_mag_corr\n  - var_join.r_delta_mag AS r_delta_mag  // include \u201cdelta_mag\u201d in the alias; band-specific prefix avoids collision\n- Note: We intentionally provide separate g_... and r_... columns so each band\u2019s corrected magnitudes and delta are explicit and unambiguous. Both deltas are labeled with \u201cdelta_mag\u201d in their names per the instruction.\n\nStep 6: Optional ordering and distinctness\n- If needed, add ORDER BY (e.g., o.oid) or by variability metrics (e.g., g_delta_mag DESC).\n- DISTINCT is not strictly necessary unless you want to collapse multiple feature rows per oid. The design here returns one row per qualifying feature row (fr), which matches the requirement to return the value/name/version/feature_fid from features.\n\nStep 7: Notes on performance and correctness\n- Ensure joins to detection are always pre-filtered by o (the set already constrained by p and deltajd) to reduce scanning.\n- Using detection.corrected = TRUE and magpsf_corr IS NOT NULL guarantees corrected magnitudes.\n- The \u2265 20 detections criterion is enforced via feature.name='n_det' for any band; this avoids heavy aggregation on detection.\n- INTERSECT is used conceptually in Step 3c; in implementation we use INNER JOIN between per-band aggregates to both carry metrics and enforce intersection of oids.\n- UNION is used to consolidate n_det-qualified oids across bands and to collect feature rows.\n\nSummary of all conditions\n- probability:\n  - classifier_name = 'lc_classifier'\n  - ranking = 1\n  - class_name = 'AGN'\n  - probability > 0.6\n- object:\n  - deltajd >= 365\n- feature (n_det):\n  - name = 'n_det'\n  - fid IN (1, 2, 3)\n  - value >= 20\n- detection for g-band stats:\n  - fid = 1\n  - corrected = TRUE\n  - magpsf_corr IS NOT NULL\n  - HAVING (MAX(magpsf_corr) - MIN(magpsf_corr)) > 1.0\n- detection for r-band stats:\n  - fid = 2\n  - corrected = TRUE\n  - magpsf_corr IS NOT NULL\n  - HAVING (MAX(magpsf_corr) - MIN(magpsf_corr)) > 0.5\n\nFinal output columns\n- oid\n- value (from features)\n- name (from features; expected to be 'n_det')\n- version (from features)\n- feature_fid (from features.fid)\n- meanra (from object)\n- meandec (from object)\n- ndet (from object)\n- g_min_mag_corr (from detection aggregate for fid=1)\n- g_max_mag_corr (from detection aggregate for fid=1)\n- g_delta_mag (from detection aggregate for fid=1; a \u201cdelta_mag\u201d-labeled column)\n- r_min_mag_corr (from detection aggregate for fid=2)\n- r_max_mag_corr (from detection aggregate for fid=2)\n- r_delta_mag (from detection aggregate for fid=2; a \u201cdelta_mag\u201d-labeled column)"
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\nSelect ALeRCE objects that:\n- Are classified as AGN with probability > 0.6 (using lc_classifier, top-ranked class).\n- Have light curves spanning at least 1 year.\n- Have \u2265 20 detections in at least one band (g, r, or i).\n- Show corrected-magnitude variability > 1.0 mag in g (fid=1) and > 0.5 mag in r (fid=2).\nReturn for each selected object:\n- oid,\n- feature.value, feature.name, feature.version, and feature.fid (aliased as feature_fid),\n- object.meanra, object.meandec,\n- object.ndet,\n- per-band (g and r) corrected maximum and minimum magnitudes,\n- per-band (g and r) variations as max \u2212 min, with the variation columns clearly labeled (use separate columns for g and r and include \u201cdelta_mag\u201d in the alias).\n\nKey schema elements and constraints\n- probability: (oid, class_name, classifier_name, classifier_version, probability, ranking)\n  - Default constraints: ranking = 1 and classifier_name = 'lc_classifier'\n  - Filter: class_name = 'AGN' and probability > 0.6\n- object: (oid, deltajd, meanra, meandec, ndet, ...)\n  - Filter: deltajd >= 365 (days)\n- detection: (oid, fid, magpsf_corr, corrected, ...)\n  - We will aggregate per (oid) within each target band and only over rows with corrected = TRUE and magpsf_corr IS NOT NULL.\n  - fid = 1 (g), 2 (r), 3 (i)\n- feature: (oid, name, value, fid, version)\n  - Use for band-specific detection counts via name = 'n_det' (value is the number of detections in the alert light curve per band).\n  - Because we will only use one feature name ('n_det'), the transposed-table multi-feature UNION/INTERSECT choreography is not strictly required for correctness, but we will still use UNION to gather band-wise eligibility and satisfy the \u201cadvanced query\u201d guidance.\n\nHigh-level structure\n- Build a base set of oids meeting classification and time-span constraints (probability + object).\n- Compute variability constraints from detection on corrected magnitudes for g and r separately (two subqueries), then INTERSECT the resulting oid sets (or INNER JOIN on oid) so both thresholds must be satisfied.\n- Ensure \u2265 20 detections in at least one band using feature.name = 'n_det' with value >= 20 (across fid in (1,2,3)), by UNION-ing per-band feature subqueries and using the unioned oid set as a semi-join filter.\n- Assemble final rows by joining:\n  - the base (probability + object),\n  - the band-variability aggregates (g and r),\n  - and the selected n_det feature rows (to return feature.value/name/version/fid).\n- Return columns as specified, using feature.fid AS feature_fid; for detection-derived band metrics, present both g and r columns with distinct names (e.g., g_min_mag_corr, g_max_mag_corr, g_delta_mag; r_min_mag_corr, r_max_mag_corr, r_delta_mag).\n\nDetailed step-by-step decomposition\n\nStep 1: Probability filter (subquery p)\n- Purpose: limit to lc_classifier top-ranked AGN with probability > 0.6.\n- FROM probability p\n- WHERE:\n  - p.classifier_name = 'lc_classifier'\n  - p.ranking = 1\n  - p.class_name = 'AGN'\n  - p.probability > 0.6\n- SELECT DISTINCT p.oid (and optionally p.probability if needed later; by default only oid).\n- Index leverage: ix_classification_rank1, ix_probabilities_probability.\n\nStep 2: Time-span and base object info (subquery o)\n- Purpose: enforce \u2265 1-year light-curve span and collect object metadata.\n- FROM object o\n- INNER JOIN p USING (oid)\n- WHERE o.deltajd >= 365\n- SELECT:\n  - o.oid,\n  - o.meanra,\n  - o.meandec,\n  - o.ndet,\n  - o.deltajd (optional, only for checking).\n- Index leverage: ix_object_firstmjd is not directly for deltajd, but base table is small enough post-join; the join on oid uses primary key.\n\nStep 3: Detection-based variability on corrected magnitudes\nCompute per-oid variability metrics on corrected magnitudes separately for g and r. Pre-restrict to only oids in Step 2 to minimize scanning.\n\n3a) g-band corrected stats (subquery g_stats)\n- Purpose: compute min, max, and delta on corrected mags in g (fid=1) and require delta > 1.0 mag.\n- FROM detection d\n- INNER JOIN o USING (oid)  // pre-filter by qualified oids\n- WHERE:\n  - d.corrected = TRUE\n  - d.magpsf_corr IS NOT NULL\n  - d.fid = 1\n- GROUP BY d.oid\n- SELECT:\n  - d.oid,\n  - MIN(d.magpsf_corr) AS g_min_mag_corr,\n  - MAX(d.magpsf_corr) AS g_max_mag_corr,\n  - (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS g_delta_mag\n- HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 1.0\n- Notes:\n  - We do not filter on other detection parameters (e.g., drb) since not requested.\n  - The oid hash index (ix_ndetection_oid) and the pre-join restriction keep this efficient.\n\n3b) r-band corrected stats (subquery r_stats)\n- Purpose: compute min, max, and delta on corrected mags in r (fid=2) and require delta > 0.5 mag.\n- FROM detection d\n- INNER JOIN o USING (oid)\n- WHERE:\n  - d.corrected = TRUE\n  - d.magpsf_corr IS NOT NULL\n  - d.fid = 2\n- GROUP BY d.oid\n- SELECT:\n  - d.oid,\n  - MIN(d.magpsf_corr) AS r_min_mag_corr,\n  - MAX(d.magpsf_corr) AS r_max_mag_corr,\n  - (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS r_delta_mag\n- HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 0.5\n\n3c) Require both g and r variability simultaneously (subquery var_join)\n- Purpose: enforce both thresholds by intersecting oid sets (or equivalently inner joining the per-band aggregates).\n- Option A (set-based): SELECT oid FROM g_stats INTERSECT SELECT oid FROM r_stats\n- Option B (preferred for carrying metrics): INNER JOIN g_stats gs ON gs.oid = rs.oid\n- Output (using INNER JOIN approach):\n  - oid,\n  - g_min_mag_corr, g_max_mag_corr, g_delta_mag,\n  - r_min_mag_corr, r_max_mag_corr, r_delta_mag\n\nStep 4: At least 20 detections in any band using the feature table\nUse feature table to assert per-band detection counts via name='n_det'. Use UNION across bands to build the eligible oid set, and also prepare the rows to return feature columns.\n\n4a) n_det per g band (subquery f_ng)\n- FROM feature f\n- INNER JOIN p USING (oid)  // limit to classified oids\n- WHERE f.name = 'n_det' AND f.fid = 1 AND f.value >= 20\n- SELECT:\n  - f.oid,\n  - f.value,\n  - f.name,\n  - f.version,\n  - f.fid AS feature_fid\n\n4b) n_det per r band (subquery f_nr)\n- Same as 4a but with f.fid = 2\n\n4c) n_det per i band (subquery f_ni)\n- Same as 4a but with f.fid = 3\n\n4d) Oids satisfying \u2265 20 detections in at least one band (subquery f_n_any)\n- Purpose: set of oids with f.name='n_det' and value >= 20 for any fid in (1,2,3).\n- Build by UNION (deduplicating) of (SELECT oid FROM f_ng) UNION (SELECT oid FROM f_nr) UNION (SELECT oid FROM f_ni).\n\n4e) Rows to return feature columns (subquery f_rows)\n- Purpose: collect the feature rows to return (value, name, version, feature_fid) for any band meeting the \u2265 20 criterion.\n- Build by UNION ALL of the three per-band subqueries (f_ng UNION ALL f_nr UNION ALL f_ni).\n- Columns:\n  - oid, value, name, version, feature_fid\n\nStep 5: Assemble and enforce all constraints\n- Start from o (objects already filtered by p and deltajd).\n- INNER JOIN var_join USING (oid)  // enforces both g and r variability thresholds and provides the min/max/delta per band.\n- INNER JOIN f_n_any USING (oid)   // enforces the \u2265 20 detections in at least one band.\n- INNER JOIN f_rows fr USING (oid) // attaches feature columns to return; multiple rows per oid are expected if multiple bands meet the \u2265 20 criterion.\n- Columns to SELECT:\n  - o.oid\n  - fr.value AS value\n  - fr.name AS name\n  - fr.version AS version\n  - fr.feature_fid AS feature_fid  // alias the filter id from the features table\n  - o.meanra\n  - o.meandec\n  - o.ndet\n  - var_join.g_min_mag_corr AS g_min_mag_corr\n  - var_join.g_max_mag_corr AS g_max_mag_corr\n  - var_join.g_delta_mag AS g_delta_mag  // include \u201cdelta_mag\u201d in the alias; band-specific prefix avoids collision\n  - var_join.r_min_mag_corr AS r_min_mag_corr\n  - var_join.r_max_mag_corr AS r_max_mag_corr\n  - var_join.r_delta_mag AS r_delta_mag  // include \u201cdelta_mag\u201d in the alias; band-specific prefix avoids collision\n- Note: We intentionally provide separate g_... and r_... columns so each band\u2019s corrected magnitudes and delta are explicit and unambiguous. Both deltas are labeled with \u201cdelta_mag\u201d in their names per the instruction.\n\nStep 6: Optional ordering and distinctness\n- If needed, add ORDER BY (e.g., o.oid) or by variability metrics (e.g., g_delta_mag DESC).\n- DISTINCT is not strictly necessary unless you want to collapse multiple feature rows per oid. The design here returns one row per qualifying feature row (fr), which matches the requirement to return the value/name/version/feature_fid from features.\n\nStep 7: Notes on performance and correctness\n- Ensure joins to detection are always pre-filtered by o (the set already constrained by p and deltajd) to reduce scanning.\n- Using detection.corrected = TRUE and magpsf_corr IS NOT NULL guarantees corrected magnitudes.\n- The \u2265 20 detections criterion is enforced via feature.name='n_det' for any band; this avoids heavy aggregation on detection.\n- INTERSECT is used conceptually in Step 3c; in implementation we use INNER JOIN between per-band aggregates to both carry metrics and enforce intersection of oids.\n- UNION is used to consolidate n_det-qualified oids across bands and to collect feature rows.\n\nSummary of all conditions\n- probability:\n  - classifier_name = 'lc_classifier'\n  - ranking = 1\n  - class_name = 'AGN'\n  - probability > 0.6\n- object:\n  - deltajd >= 365\n- feature (n_det):\n  - name = 'n_det'\n  - fid IN (1, 2, 3)\n  - value >= 20\n- detection for g-band stats:\n  - fid = 1\n  - corrected = TRUE\n  - magpsf_corr IS NOT NULL\n  - HAVING (MAX(magpsf_corr) - MIN(magpsf_corr)) > 1.0\n- detection for r-band stats:\n  - fid = 2\n  - corrected = TRUE\n  - magpsf_corr IS NOT NULL\n  - HAVING (MAX(magpsf_corr) - MIN(magpsf_corr)) > 0.5\n\nFinal output columns\n- oid\n- value (from features)\n- name (from features; expected to be 'n_det')\n- version (from features)\n- feature_fid (from features.fid)\n- meanra (from object)\n- meandec (from object)\n- ndet (from object)\n- g_min_mag_corr (from detection aggregate for fid=1)\n- g_max_mag_corr (from detection aggregate for fid=1)\n- g_delta_mag (from detection aggregate for fid=1; a \u201cdelta_mag\u201d-labeled column)\n- r_min_mag_corr (from detection aggregate for fid=2)\n- r_max_mag_corr (from detection aggregate for fid=2)\n- r_delta_mag (from detection aggregate for fid=2; a \u201cdelta_mag\u201d-labeled column)"
                    },
                    "in_toks": 6117,
                    "out_toks": 10416,
                    "id": "chatcmpl-Cb5K2NXuQ9YPMgnDqoXwjk7mMm6sp",
                    "created": 1762954630,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- AGN with probability > 0.6 from lc_classifier, top-ranked\nWITH p AS\n  (SELECT oid\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND ranking = 1\n     AND class_name = 'AGN'\n     AND probability > 0.6), -- Objects with light curve span >= 1 year\no AS\n  (SELECT o.*\n   FROM OBJECT o\n   INNER JOIN p USING (oid)\n   WHERE o.deltajd >= 365), -- g-band (fid=1) corrected-magnitude stats and variability > 1.0 mag\ng_stats AS\n  (SELECT d.oid,\n          MIN(d.magpsf_corr) AS g_min_mag_corr,\n          MAX(d.magpsf_corr) AS g_max_mag_corr,\n          (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS g_delta_mag\n   FROM detection d\n   INNER JOIN o USING (oid)\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid = 1\n   GROUP BY d.oid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 1.0), -- r-band (fid=2) corrected-magnitude stats and variability > 0.5 mag\nr_stats AS\n  (SELECT d.oid,\n          MIN(d.magpsf_corr) AS r_min_mag_corr,\n          MAX(d.magpsf_corr) AS r_max_mag_corr,\n          (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS r_delta_mag\n   FROM detection d\n   INNER JOIN o USING (oid)\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid = 2\n   GROUP BY d.oid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 0.5), -- Enforce both g and r variability thresholds\nvar_join AS\n  (SELECT gs.oid,\n          gs.g_min_mag_corr,\n          gs.g_max_mag_corr,\n          gs.g_delta_mag,\n          rs.r_min_mag_corr,\n          rs.r_max_mag_corr,\n          rs.r_delta_mag\n   FROM g_stats gs\n   INNER JOIN r_stats rs ON gs.oid = rs.oid), -- Feature 'n_det' >= 20 in any band (g=1, r=2, i=3), restricted to candidate oids\nf_ng AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN o USING (oid)\n   WHERE f.name = 'n_det'\n     AND f.fid = 1\n     AND f.value >= 20),\n                                                                                                                                f_nr AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN o USING (oid)\n   WHERE f.name = 'n_det'\n     AND f.fid = 2\n     AND f.value >= 20),\n                                                                                                                                f_ni AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN o USING (oid)\n   WHERE f.name = 'n_det'\n     AND f.fid = 3\n     AND f.value >= 20), -- Oids having >= 20 detections in at least one band\nf_n_any AS\n  (SELECT DISTINCT oid\n   FROM\n     (SELECT oid\n      FROM f_ng\n      UNION SELECT oid\n      FROM f_nr\n      UNION SELECT oid\n      FROM f_ni) u), -- Rows to return the feature columns\nfr AS\n  (SELECT *\n   FROM f_ng\n   UNION ALL SELECT *\n   FROM f_nr\n   UNION ALL SELECT *\n   FROM f_ni)\nSELECT o.oid,\n       fr.value,\n       fr.name,\n       fr.version,\n       fr.feature_fid, -- filter id from the features table, aliased as requested\n o.meanra,\n o.meandec,\n o.ndet,\n var_join.g_min_mag_corr,\n var_join.g_max_mag_corr,\n var_join.g_delta_mag, -- delta_mag for g-band (contains 'delta_mag' in the alias)\n var_join.r_min_mag_corr,\n var_join.r_max_mag_corr,\n var_join.r_delta_mag -- delta_mag for r-band (contains 'delta_mag' in the alias)\nFROM o\nINNER JOIN var_join USING (oid)\nINNER JOIN f_n_any USING (oid)\nINNER JOIN fr USING (oid)\nORDER BY o.oid,\n         fr.feature_fid;"
                        },
                        "in_toks": 7632,
                        "out_toks": 4707,
                        "id": "chatcmpl-Cb5NBMfqU29majpuYOjkHQR4X4hd5",
                        "created": 1762954825,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "1": {
            "req_id": "1",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'object', 'detection', 'feature']",
                    "1": "['object', 'probability', 'taxonomy', 'detection', 'feature', 'feature_version']"
                },
                "in_toks": 737,
                "out_toks": 3768,
                "id": "chatcmpl-CSnRMZVL5fCoKd8sNFTC9XZ6qtbfd",
                "created": 1760979268,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query: filter by probability and duration first, require >=20 detections in at least one band via features,\n-- then aggregate corrected detections only for those oids and enforce g and r variability thresholds.\nWITH candidates AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   JOIN probability p ON p.oid = o.oid\n   WHERE p.classifier_name = 'lc_classifier' -- classifier\n\n     AND p.class_name = 'AGN' -- target class\n\n     AND p.ranking = 1 -- top-ranked class\n\n     AND p.probability > 0.6 -- probability threshold\n\n     AND o.deltajd >= 365 -- light curve spans at least one year\n),\n     oids_with_20 AS\n  (-- oids that have >=20 detections in at least one band (g or r) using feature 'n_det'\n SELECT DISTINCT f.oid\n   FROM feature f\n   JOIN candidates c ON c.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.fid IN (1,\n                   2)-- 1=g, 2=r\n\n     AND f.value >= 20),\n     det_agg AS\n  (-- aggregate corrected magnitudes per oid, per band\n SELECT d.oid,\n        d.fid,\n        MIN(d.magpsf_corr) AS min_mag,\n        MAX(d.magpsf_corr) AS max_mag,\n        MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS delta_mag\n   FROM detection d\n   WHERE d.oid IN\n       (SELECT oid\n        FROM oids_with_20)-- restrict early to reduce scan\n\n     AND d.corrected = TRUE -- use corrected magnitudes only\n\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid IN (1,\n                   2)-- only g and r\n\n   GROUP BY d.oid,\n            d.fid),\n     pass_bands AS\n  (-- per-band variability thresholds\n SELECT *\n   FROM det_agg\n   WHERE (fid = 1\n          AND delta_mag > 1.0)-- g-band > 1.0 mag\n\n     OR (fid = 2\n         AND delta_mag > 0.5)-- r-band > 0.5 mag\n),\n     require_both AS\n  (-- keep only oids that pass both g and r thresholds\n SELECT oid\n   FROM pass_bands\n   GROUP BY oid\n   HAVING COUNT(DISTINCT fid) = 2),\n     per_band_rows AS\n  (-- rows to return per band (g and r) for qualifying objects\n SELECT d.*\n   FROM det_agg d\n   JOIN require_both b USING (oid)\n   WHERE d.fid IN (1,\n                   2))\nSELECT pr.oid,\n       f.value, -- feature value (n_det per band)\n f.name, -- feature name\n f.version, -- feature version\n f.fid AS feature_fid, -- feature filter id\n c.meanra,\n c.meandec,\n c.ndet, -- total number of detections (object-level)\n pr.max_mag,\n pr.min_mag,\n pr.delta_mag, -- variability per band\n pr.fid AS detection_fid -- detection filter id\nFROM per_band_rows pr\nJOIN candidates c ON c.oid = pr.oid\nLEFT JOIN feature f ON f.oid = pr.oid\nAND f.name = 'n_det'\nAND f.fid = pr.fid;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query: filter by probability and duration first, require >=20 detections in at least one band via features,\n-- then aggregate corrected detections only for those oids and enforce g and r variability thresholds.\nWITH candidates AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   JOIN probability p ON p.oid = o.oid\n   WHERE p.classifier_name = 'lc_classifier' -- classifier\n\n     AND p.class_name = 'AGN' -- target class\n\n     AND p.ranking = 1 -- top-ranked class\n\n     AND p.probability > 0.6 -- probability threshold\n\n     AND o.deltajd >= 365 -- light curve spans at least one year\n),\n     oids_with_20 AS\n  (-- oids that have >=20 detections in at least one band (g or r) using feature 'n_det'\n SELECT DISTINCT f.oid\n   FROM feature f\n   JOIN candidates c ON c.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.fid IN (1,\n                   2)-- 1=g, 2=r\n\n     AND f.value >= 20),\n     det_agg AS\n  (-- aggregate corrected magnitudes per oid, per band\n SELECT d.oid,\n        d.fid,\n        MIN(d.magpsf_corr) AS min_mag,\n        MAX(d.magpsf_corr) AS max_mag,\n        MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS delta_mag\n   FROM detection d\n   WHERE d.oid IN\n       (SELECT oid\n        FROM oids_with_20)-- restrict early to reduce scan\n\n     AND d.corrected = TRUE -- use corrected magnitudes only\n\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid IN (1,\n                   2)-- only g and r\n\n   GROUP BY d.oid,\n            d.fid),\n     pass_bands AS\n  (-- per-band variability thresholds\n SELECT *\n   FROM det_agg\n   WHERE (fid = 1\n          AND delta_mag > 1.0)-- g-band > 1.0 mag\n\n     OR (fid = 2\n         AND delta_mag > 0.5)-- r-band > 0.5 mag\n),\n     require_both AS\n  (-- keep only oids that pass both g and r thresholds\n SELECT oid\n   FROM pass_bands\n   GROUP BY oid\n   HAVING COUNT(DISTINCT fid) = 2),\n     per_band_rows AS\n  (-- rows to return per band (g and r) for qualifying objects\n SELECT d.*\n   FROM det_agg d\n   JOIN require_both b USING (oid)\n   WHERE d.fid IN (1,\n                   2))\nSELECT pr.oid,\n       f.value, -- feature value (n_det per band)\n f.name, -- feature name\n f.version, -- feature version\n f.fid AS feature_fid, -- feature filter id\n c.meanra,\n c.meandec,\n c.ndet, -- total number of detections (object-level)\n pr.max_mag,\n pr.min_mag,\n pr.delta_mag, -- variability per band\n pr.fid AS detection_fid -- detection filter id\nFROM per_band_rows pr\nJOIN candidates c ON c.oid = pr.oid\nLEFT JOIN feature f ON f.oid = pr.oid\nAND f.name = 'n_det'\nAND f.fid = pr.fid;"
                },
                "in_toks": 6394,
                "out_toks": 3331,
                "id": "chatcmpl-CbGToedR1teWi6QvoiHgjMvgXtXsB",
                "created": 1762997520,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 4290,
                "out_toks": 1615,
                "id": "chatcmpl-CSngtHou5uUc31svE0JSDYaIO6vTi",
                "created": 1760980231,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "/* AGN with prob>0.6 (lc_classifier, rank=1), deltajd>=365, >=20 detections in at least one band (feature 'n_det'),\n   and corrected magnitude variability: g>1.0 mag, r>0.5 mag. Return per-band rows with requested fields. */ WITH p_agn AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6),\n                                                                                                                  o_filtered AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   INNER JOIN p_agn p ON p.oid = o.oid\n   WHERE o.deltajd >= 365),\n                                                                                                                  f_n_g AS\n  (/* n_det in g band (fid=1) >= 20 */  SELECT f.oid,\n                                               f.value,\n                                               f.name,\n                                               f.version,\n                                               f.fid\n   FROM feature f\n   INNER JOIN o_filtered c ON c.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.fid = 1\n     AND f.value >= 20),\n                                                                                                                  f_n_r AS\n  (/* n_det in r band (fid=2) >= 20 */  SELECT f.oid,\n                                               f.value,\n                                               f.name,\n                                               f.version,\n                                               f.fid\n   FROM feature f\n   INNER JOIN o_filtered c ON c.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.fid = 2\n     AND f.value >= 20),\n                                                                                                                  n_det_any_oids AS\n  (/* oids with >=20 detections in at least one band */  SELECT oid\n   FROM f_n_g\n   UNION SELECT oid\n   FROM f_n_r),\n                                                                                                                  det_g AS\n  (/* corrected g-band variability > 1.0 mag */  SELECT d.oid,\n                                                        MIN(d.magpsf_corr) AS min_mag,\n                                                        MAX(d.magpsf_corr) AS max_mag,\n                                                        (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag\n   FROM detection d\n   INNER JOIN o_filtered c ON c.oid = d.oid\n   WHERE d.fid = 1\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 1.0),\n                                                                                                                  det_r AS\n  (/* corrected r-band variability > 0.5 mag */  SELECT d.oid,\n                                                        MIN(d.magpsf_corr) AS min_mag,\n                                                        MAX(d.magpsf_corr) AS max_mag,\n                                                        (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag\n   FROM detection d\n   INNER JOIN o_filtered c ON c.oid = d.oid\n   WHERE d.fid = 2\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 0.5),\n                                                                                                                  det_intersect_oids AS\n  (/* require both bands to satisfy variability */  SELECT oid\n   FROM det_g INTERSECT SELECT oid\n   FROM det_r),\n                                                                                                                  final_oids AS\n  (/* enforce >=20 detections in at least one band */  SELECT i.oid\n   FROM det_intersect_oids i\n   INNER JOIN n_det_any_oids n ON n.oid = i.oid),\n                                                                                                                  det_union_rows AS\n  (/* per-band rows with band tag as detection_fid */  SELECT oid,\n                                                              min_mag,\n                                                              max_mag,\n                                                              delta_mag,\n                                                              1 AS detection_fid\n   FROM det_g\n   UNION ALL SELECT oid,\n                    min_mag,\n                    max_mag,\n                    delta_mag,\n                    2 AS detection_fid\n   FROM det_r)\nSELECT dur.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid, /* requested alias: [table_name]_fid for feature */  o.meanra,\n                                                                                  o.meandec,\n                                                                                  o.ndet,\n                                                                                  dur.max_mag,\n                                                                                  dur.min_mag,\n                                                                                  dur.delta_mag,\n                                                                                  dur.detection_fid /* requested alias: [table_name]_fid for detection */\nFROM det_union_rows dur\nINNER JOIN final_oids fo ON fo.oid = dur.oid\nINNER JOIN o_filtered o ON o.oid = dur.oid\nLEFT JOIN feature f ON f.oid = dur.oid\nAND f.name = 'n_det'\nAND f.fid = dur.detection_fid /* ORDER BY dur.oid, dur.detection_fid */;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan (no SQL, just the steps, conditions, and structure to generate it)\n\nGoal\nReturn all AGN (lc_classifier, rank-1, prob > 0.6) whose light curves span at least one year (object.deltajd \u2265 365), that have \u2265 20 detections in at least one band (use feature.name='n_det'), and show corrected-magnitude variability > 1 mag in g (fid=1) and > 0.5 mag in r (fid=2). Output, per band row, the following: oid, feature.value, feature.name, feature.version, feature fid as feature_fid, object.meanra, object.meandec, object.ndet, minimum and maximum corrected magnitudes, and delta_mag (max\u2212min), with detection fid as detection_fid.\n\nTables and columns to use\n- probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n- object(oid, deltajd, meanra, meandec, ndet)\n- detection(oid, fid, magpsf_corr, corrected)\n- feature(oid, name, value, fid, version)\n\nFixed conditions\n- Probability defaults: probability.ranking = 1 and probability.classifier_name = 'lc_classifier'\n- Class filter: probability.class_name = 'AGN'\n- Probability threshold: probability.probability > 0.6\n- Time span: object.deltajd \u2265 365\n- Detections per band (at least one band): feature.name = 'n_det' AND feature.fid IN (1,2) AND feature.value \u2265 20\n- Variability thresholds on corrected magnitudes using detection.magpsf_corr and detection.corrected = TRUE:\n  - g band (fid=1): (max(magpsf_corr) \u2212 min(magpsf_corr)) > 1.0\n  - r band (fid=2): (max(magpsf_corr) \u2212 min(magpsf_corr)) > 0.5\n\nQuery structure (use CTEs or nested subqueries)\n\n1) Base AGN candidates (p_agn)\n- From probability p\n- WHERE p.classifier_name='lc_classifier' AND p.ranking=1 AND p.class_name='AGN' AND p.probability>0.6\n- SELECT DISTINCT p.oid\n\n2) Apply object time-span filter (cand_oids)\n- INNER JOIN object o ON o.oid = p_agn.oid\n- WHERE o.deltajd >= 365\n- SELECT DISTINCT o.oid\n- Keep object columns (o.meanra, o.meandec, o.ndet) for final output via later join\n\n3) At least-one-band detection-count condition via feature (n_det >= 20)\n- Build two feature subqueries restricted to cand_oids:\n  - f_n_g: FROM feature f INNER JOIN cand_oids c ON f.oid=c.oid\n    WHERE f.name='n_det' AND f.fid=1 AND f.value>=20\n    SELECT f.oid, f.value, f.name, f.version, f.fid\n  - f_n_r: FROM feature f INNER JOIN cand_oids c ON f.oid=c.oid\n    WHERE f.name='n_det' AND f.fid=2 AND f.value>=20\n    SELECT f.oid, f.value, f.name, f.version, f.fid\n- Form n_det_any_oids as DISTINCT oid UNION of f_n_g and f_n_r (this encodes \u201c\u226520 detections in at least one band\u201d).\n- Note: we will LEFT JOIN features for display later; n_det_any_oids will be used as an existence filter to enforce the \u226520 condition.\n\n4) Band-wise corrected magnitude variability from detection\n- Restrict detection only by oid using cand_oids to avoid full-table scans; require detection.corrected=TRUE.\n\n4a) g-band variability (det_g)\n- FROM detection d INNER JOIN cand_oids c ON d.oid=c.oid\n- WHERE d.fid=1 AND d.corrected=TRUE\n- GROUP BY d.oid\n- SELECT d.oid,\n  min(d.magpsf_corr) AS min_mag,\n  max(d.magpsf_corr) AS max_mag,\n  (max(d.magpsf_corr) - min(d.magpsf_corr)) AS delta_mag\n- HAVING (max(d.magpsf_corr) - min(d.magpsf_corr)) > 1.0\n\n4b) r-band variability (det_r)\n- FROM detection d INNER JOIN cand_oids c ON d.oid=c.oid\n- WHERE d.fid=2 AND d.corrected=TRUE\n- GROUP BY d.oid\n- SELECT d.oid,\n  min(d.magpsf_corr) AS min_mag,\n  max(d.magpsf_corr) AS max_mag,\n  (max(d.magpsf_corr) - min(d.magpsf_corr)) AS delta_mag\n- HAVING (max(d.magpsf_corr) - min(d.magpsf_corr)) > 0.5\n\n4c) Enforce both variability thresholds simultaneously (det_intersect_oids)\n- Build the set of oids present in both det_g and det_r via INTERSECT:\n  SELECT oid FROM det_g\n  INTERSECT\n  SELECT oid FROM det_r\n\n4d) Produce band-wise rows for output (det_union_rows)\n- UNION ALL the two band results and tag the band:\n  - SELECT oid, min_mag, max_mag, delta_mag, 1 AS detection_fid FROM det_g\n  - UNION ALL\n  - SELECT oid, min_mag, max_mag, delta_mag, 2 AS detection_fid FROM det_r\n\n5) Final filtering and joins to shape the output\n- Final_oids = oids that satisfy both variability thresholds AND the \u226520-in-at-least-one-band condition:\n  - Final_oids = det_intersect_oids\n  - INNER JOIN (SELECT DISTINCT oid FROM n_det_any_oids) USING (oid)\n- Restrict det_union_rows to Final_oids (WHERE det_union_rows.oid IN Final_oids).\n- INNER JOIN object o ON o.oid = det_union_rows.oid to bring meanra, meandec, ndet.\n- LEFT JOIN feature f_det ON f_det.oid = det_union_rows.oid\n  AND f_det.name = 'n_det'\n  AND f_det.fid = det_union_rows.detection_fid\n  (This returns the feature fields per band for display; LEFT JOIN ensures the row still appears even if that band did not meet the \u226520 condition. The \u226520 condition is already enforced by Final_oids using n_det_any_oids.)\n\n6) Final SELECT columns and aliases\n- Columns to return:\n  - det_union_rows.oid AS oid\n  - f_det.value AS value\n  - f_det.name AS name\n  - f_det.version AS version\n  - f_det.fid AS feature_fid\n  - o.meanra, o.meandec\n  - o.ndet\n  - det_union_rows.max_mag AS max_mag\n  - det_union_rows.min_mag AS min_mag\n  - det_union_rows.delta_mag AS delta_mag\n  - det_union_rows.detection_fid AS detection_fid\n- Note on filter id aliasing: use feature_fid for feature.fid and detection_fid for the band tag from det_union_rows, as requested.\n\n7) Optional ordering\n- Not required by the user. If desired for readability, order by oid, detection_fid.\n\nPerformance notes\n- Always restrict large operations on detection via INNER JOIN with cand_oids (and later Final_oids).\n- The probability conditions use indexes on ranking and probability and the hash index on oid.\n- The object.deltajd filter is indexed via typical scans on object.\n- Feature table joins are limited by oid and specific name='n_det' and fid IN (1,2)."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan (no SQL, just the steps, conditions, and structure to generate it)\n\nGoal\nReturn all AGN (lc_classifier, rank-1, prob > 0.6) whose light curves span at least one year (object.deltajd \u2265 365), that have \u2265 20 detections in at least one band (use feature.name='n_det'), and show corrected-magnitude variability > 1 mag in g (fid=1) and > 0.5 mag in r (fid=2). Output, per band row, the following: oid, feature.value, feature.name, feature.version, feature fid as feature_fid, object.meanra, object.meandec, object.ndet, minimum and maximum corrected magnitudes, and delta_mag (max\u2212min), with detection fid as detection_fid.\n\nTables and columns to use\n- probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n- object(oid, deltajd, meanra, meandec, ndet)\n- detection(oid, fid, magpsf_corr, corrected)\n- feature(oid, name, value, fid, version)\n\nFixed conditions\n- Probability defaults: probability.ranking = 1 and probability.classifier_name = 'lc_classifier'\n- Class filter: probability.class_name = 'AGN'\n- Probability threshold: probability.probability > 0.6\n- Time span: object.deltajd \u2265 365\n- Detections per band (at least one band): feature.name = 'n_det' AND feature.fid IN (1,2) AND feature.value \u2265 20\n- Variability thresholds on corrected magnitudes using detection.magpsf_corr and detection.corrected = TRUE:\n  - g band (fid=1): (max(magpsf_corr) \u2212 min(magpsf_corr)) > 1.0\n  - r band (fid=2): (max(magpsf_corr) \u2212 min(magpsf_corr)) > 0.5\n\nQuery structure (use CTEs or nested subqueries)\n\n1) Base AGN candidates (p_agn)\n- From probability p\n- WHERE p.classifier_name='lc_classifier' AND p.ranking=1 AND p.class_name='AGN' AND p.probability>0.6\n- SELECT DISTINCT p.oid\n\n2) Apply object time-span filter (cand_oids)\n- INNER JOIN object o ON o.oid = p_agn.oid\n- WHERE o.deltajd >= 365\n- SELECT DISTINCT o.oid\n- Keep object columns (o.meanra, o.meandec, o.ndet) for final output via later join\n\n3) At least-one-band detection-count condition via feature (n_det >= 20)\n- Build two feature subqueries restricted to cand_oids:\n  - f_n_g: FROM feature f INNER JOIN cand_oids c ON f.oid=c.oid\n    WHERE f.name='n_det' AND f.fid=1 AND f.value>=20\n    SELECT f.oid, f.value, f.name, f.version, f.fid\n  - f_n_r: FROM feature f INNER JOIN cand_oids c ON f.oid=c.oid\n    WHERE f.name='n_det' AND f.fid=2 AND f.value>=20\n    SELECT f.oid, f.value, f.name, f.version, f.fid\n- Form n_det_any_oids as DISTINCT oid UNION of f_n_g and f_n_r (this encodes \u201c\u226520 detections in at least one band\u201d).\n- Note: we will LEFT JOIN features for display later; n_det_any_oids will be used as an existence filter to enforce the \u226520 condition.\n\n4) Band-wise corrected magnitude variability from detection\n- Restrict detection only by oid using cand_oids to avoid full-table scans; require detection.corrected=TRUE.\n\n4a) g-band variability (det_g)\n- FROM detection d INNER JOIN cand_oids c ON d.oid=c.oid\n- WHERE d.fid=1 AND d.corrected=TRUE\n- GROUP BY d.oid\n- SELECT d.oid,\n  min(d.magpsf_corr) AS min_mag,\n  max(d.magpsf_corr) AS max_mag,\n  (max(d.magpsf_corr) - min(d.magpsf_corr)) AS delta_mag\n- HAVING (max(d.magpsf_corr) - min(d.magpsf_corr)) > 1.0\n\n4b) r-band variability (det_r)\n- FROM detection d INNER JOIN cand_oids c ON d.oid=c.oid\n- WHERE d.fid=2 AND d.corrected=TRUE\n- GROUP BY d.oid\n- SELECT d.oid,\n  min(d.magpsf_corr) AS min_mag,\n  max(d.magpsf_corr) AS max_mag,\n  (max(d.magpsf_corr) - min(d.magpsf_corr)) AS delta_mag\n- HAVING (max(d.magpsf_corr) - min(d.magpsf_corr)) > 0.5\n\n4c) Enforce both variability thresholds simultaneously (det_intersect_oids)\n- Build the set of oids present in both det_g and det_r via INTERSECT:\n  SELECT oid FROM det_g\n  INTERSECT\n  SELECT oid FROM det_r\n\n4d) Produce band-wise rows for output (det_union_rows)\n- UNION ALL the two band results and tag the band:\n  - SELECT oid, min_mag, max_mag, delta_mag, 1 AS detection_fid FROM det_g\n  - UNION ALL\n  - SELECT oid, min_mag, max_mag, delta_mag, 2 AS detection_fid FROM det_r\n\n5) Final filtering and joins to shape the output\n- Final_oids = oids that satisfy both variability thresholds AND the \u226520-in-at-least-one-band condition:\n  - Final_oids = det_intersect_oids\n  - INNER JOIN (SELECT DISTINCT oid FROM n_det_any_oids) USING (oid)\n- Restrict det_union_rows to Final_oids (WHERE det_union_rows.oid IN Final_oids).\n- INNER JOIN object o ON o.oid = det_union_rows.oid to bring meanra, meandec, ndet.\n- LEFT JOIN feature f_det ON f_det.oid = det_union_rows.oid\n  AND f_det.name = 'n_det'\n  AND f_det.fid = det_union_rows.detection_fid\n  (This returns the feature fields per band for display; LEFT JOIN ensures the row still appears even if that band did not meet the \u226520 condition. The \u226520 condition is already enforced by Final_oids using n_det_any_oids.)\n\n6) Final SELECT columns and aliases\n- Columns to return:\n  - det_union_rows.oid AS oid\n  - f_det.value AS value\n  - f_det.name AS name\n  - f_det.version AS version\n  - f_det.fid AS feature_fid\n  - o.meanra, o.meandec\n  - o.ndet\n  - det_union_rows.max_mag AS max_mag\n  - det_union_rows.min_mag AS min_mag\n  - det_union_rows.delta_mag AS delta_mag\n  - det_union_rows.detection_fid AS detection_fid\n- Note on filter id aliasing: use feature_fid for feature.fid and detection_fid for the band tag from det_union_rows, as requested.\n\n7) Optional ordering\n- Not required by the user. If desired for readability, order by oid, detection_fid.\n\nPerformance notes\n- Always restrict large operations on detection via INNER JOIN with cand_oids (and later Final_oids).\n- The probability conditions use indexes on ranking and probability and the hash index on oid.\n- The object.deltajd filter is indexed via typical scans on object.\n- Feature table joins are limited by oid and specific name='n_det' and fid IN (1,2)."
                    },
                    "in_toks": 6168,
                    "out_toks": 8842,
                    "id": "chatcmpl-Cb5OFYwa9mP6trvELvfg2eEKHOBGw",
                    "created": 1762954891,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "/* AGN with prob>0.6 (lc_classifier, rank=1), deltajd>=365, >=20 detections in at least one band (feature 'n_det'),\n   and corrected magnitude variability: g>1.0 mag, r>0.5 mag. Return per-band rows with requested fields. */ WITH p_agn AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6),\n                                                                                                                  o_filtered AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   INNER JOIN p_agn p ON p.oid = o.oid\n   WHERE o.deltajd >= 365),\n                                                                                                                  f_n_g AS\n  (/* n_det in g band (fid=1) >= 20 */  SELECT f.oid,\n                                               f.value,\n                                               f.name,\n                                               f.version,\n                                               f.fid\n   FROM feature f\n   INNER JOIN o_filtered c ON c.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.fid = 1\n     AND f.value >= 20),\n                                                                                                                  f_n_r AS\n  (/* n_det in r band (fid=2) >= 20 */  SELECT f.oid,\n                                               f.value,\n                                               f.name,\n                                               f.version,\n                                               f.fid\n   FROM feature f\n   INNER JOIN o_filtered c ON c.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.fid = 2\n     AND f.value >= 20),\n                                                                                                                  n_det_any_oids AS\n  (/* oids with >=20 detections in at least one band */  SELECT oid\n   FROM f_n_g\n   UNION SELECT oid\n   FROM f_n_r),\n                                                                                                                  det_g AS\n  (/* corrected g-band variability > 1.0 mag */  SELECT d.oid,\n                                                        MIN(d.magpsf_corr) AS min_mag,\n                                                        MAX(d.magpsf_corr) AS max_mag,\n                                                        (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag\n   FROM detection d\n   INNER JOIN o_filtered c ON c.oid = d.oid\n   WHERE d.fid = 1\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 1.0),\n                                                                                                                  det_r AS\n  (/* corrected r-band variability > 0.5 mag */  SELECT d.oid,\n                                                        MIN(d.magpsf_corr) AS min_mag,\n                                                        MAX(d.magpsf_corr) AS max_mag,\n                                                        (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag\n   FROM detection d\n   INNER JOIN o_filtered c ON c.oid = d.oid\n   WHERE d.fid = 2\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 0.5),\n                                                                                                                  det_intersect_oids AS\n  (/* require both bands to satisfy variability */  SELECT oid\n   FROM det_g INTERSECT SELECT oid\n   FROM det_r),\n                                                                                                                  final_oids AS\n  (/* enforce >=20 detections in at least one band */  SELECT i.oid\n   FROM det_intersect_oids i\n   INNER JOIN n_det_any_oids n ON n.oid = i.oid),\n                                                                                                                  det_union_rows AS\n  (/* per-band rows with band tag as detection_fid */  SELECT oid,\n                                                              min_mag,\n                                                              max_mag,\n                                                              delta_mag,\n                                                              1 AS detection_fid\n   FROM det_g\n   UNION ALL SELECT oid,\n                    min_mag,\n                    max_mag,\n                    delta_mag,\n                    2 AS detection_fid\n   FROM det_r)\nSELECT dur.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid, /* requested alias: [table_name]_fid for feature */  o.meanra,\n                                                                                  o.meandec,\n                                                                                  o.ndet,\n                                                                                  dur.max_mag,\n                                                                                  dur.min_mag,\n                                                                                  dur.delta_mag,\n                                                                                  dur.detection_fid /* requested alias: [table_name]_fid for detection */\nFROM det_union_rows dur\nINNER JOIN final_oids fo ON fo.oid = dur.oid\nINNER JOIN o_filtered o ON o.oid = dur.oid\nLEFT JOIN feature f ON f.oid = dur.oid\nAND f.name = 'n_det'\nAND f.fid = dur.detection_fid /* ORDER BY dur.oid, dur.detection_fid */;"
                        },
                        "in_toks": 6494,
                        "out_toks": 2890,
                        "id": "chatcmpl-Cb5QAjNqUyS2lgBpIc8pboRBgyhEE",
                        "created": 1762955010,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "2": {
            "req_id": "1",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "feature",
                "feature_version",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'feature', 'feature_version', 'detection']"
                },
                "in_toks": 737,
                "out_toks": 2270,
                "id": "chatcmpl-CSsUxtqppQhgh63PPKIjH3FLCWGVE",
                "created": 1760998711,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- AGN with prob>0.6 (top-ranked lc_classifier), 1-year span, >=20 detections in at least one band,\n-- and corrected-magnitude variability thresholds: g > 1.0 mag, r > 0.5 mag.\n-- Returns: oid, feature value/name/version/fid (as feature_fid), mean coords, ndet, max/min corrected mags,\n-- per-band delta_mag (as max - min), and band id (as detection_fid).\nWITH eligible AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   JOIN probability p ON p.oid = o.oid\n   AND p.classifier_name = 'lc_classifier'\n   AND p.class_name = 'AGN'\n   AND p.ranking = 1\n   AND p.probability > 0.6\n   WHERE o.deltajd >= 365),\n     band_stats AS\n  (SELECT d.oid,\n          COUNT(*) FILTER (\n                           WHERE d.fid = 1) AS n_g,\n          COUNT(*) FILTER (\n                           WHERE d.fid = 2) AS n_r,\n          MIN(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 1) AS min_g,\n          MAX(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 1) AS max_g,\n          MIN(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 2) AS min_r,\n          MAX(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 2) AS max_r\n   FROM detection d\n   JOIN eligible e ON e.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid IN (1,\n                   2)-- g, r\n\n   GROUP BY d.oid),\n     selected AS\n  (SELECT e.oid,\n          e.meanra,\n          e.meandec,\n          e.ndet,\n          bs.min_g,\n          bs.max_g,\n          (bs.max_g - bs.min_g) AS delta_g,\n          bs.min_r,\n          bs.max_r,\n          (bs.max_r - bs.min_r) AS delta_r,\n          bs.n_g,\n          bs.n_r\n   FROM eligible e\n   JOIN band_stats bs ON bs.oid = e.oid\n   WHERE (bs.n_g >= 20\n          OR bs.n_r >= 20)\n     AND (bs.max_g - bs.min_g) > 1.0\n     AND (bs.max_r - bs.min_r) > 0.5),\n     per_band AS\n  (SELECT oid,\n          1 AS detection_fid,\n          min_g AS min_mag,\n          max_g AS max_mag,\n          (max_g - min_g) AS delta_mag,\n          meanra,\n          meandec,\n          ndet\n   FROM selected\n   UNION ALL SELECT oid,\n                    2 AS detection_fid,\n                    min_r AS min_mag,\n                    max_r AS max_mag,\n                    (max_r - min_r) AS delta_mag,\n                    meanra,\n                    meandec,\n                    ndet\n   FROM selected)\nSELECT pb.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid, -- feature table fid\n pb.meanra,\n pb.meandec,\n pb.ndet,\n pb.max_mag,\n pb.min_mag,\n pb.delta_mag, -- max_mag - min_mag per band\n pb.detection_fid -- detection (band) id\nFROM per_band pb\nJOIN feature f ON f.oid = pb.oid\nAND f.fid = pb.detection_fid -- return features for the same band to reduce result size\nORDER BY pb.oid,\n         pb.detection_fid,\n         f.name;",
            "sql_response": {
                "responses": {
                    "0": "-- AGN with prob>0.6 (top-ranked lc_classifier), 1-year span, >=20 detections in at least one band,\n-- and corrected-magnitude variability thresholds: g > 1.0 mag, r > 0.5 mag.\n-- Returns: oid, feature value/name/version/fid (as feature_fid), mean coords, ndet, max/min corrected mags,\n-- per-band delta_mag (as max - min), and band id (as detection_fid).\nWITH eligible AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   JOIN probability p ON p.oid = o.oid\n   AND p.classifier_name = 'lc_classifier'\n   AND p.class_name = 'AGN'\n   AND p.ranking = 1\n   AND p.probability > 0.6\n   WHERE o.deltajd >= 365),\n     band_stats AS\n  (SELECT d.oid,\n          COUNT(*) FILTER (\n                           WHERE d.fid = 1) AS n_g,\n          COUNT(*) FILTER (\n                           WHERE d.fid = 2) AS n_r,\n          MIN(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 1) AS min_g,\n          MAX(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 1) AS max_g,\n          MIN(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 2) AS min_r,\n          MAX(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 2) AS max_r\n   FROM detection d\n   JOIN eligible e ON e.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid IN (1,\n                   2)-- g, r\n\n   GROUP BY d.oid),\n     selected AS\n  (SELECT e.oid,\n          e.meanra,\n          e.meandec,\n          e.ndet,\n          bs.min_g,\n          bs.max_g,\n          (bs.max_g - bs.min_g) AS delta_g,\n          bs.min_r,\n          bs.max_r,\n          (bs.max_r - bs.min_r) AS delta_r,\n          bs.n_g,\n          bs.n_r\n   FROM eligible e\n   JOIN band_stats bs ON bs.oid = e.oid\n   WHERE (bs.n_g >= 20\n          OR bs.n_r >= 20)\n     AND (bs.max_g - bs.min_g) > 1.0\n     AND (bs.max_r - bs.min_r) > 0.5),\n     per_band AS\n  (SELECT oid,\n          1 AS detection_fid,\n          min_g AS min_mag,\n          max_g AS max_mag,\n          (max_g - min_g) AS delta_mag,\n          meanra,\n          meandec,\n          ndet\n   FROM selected\n   UNION ALL SELECT oid,\n                    2 AS detection_fid,\n                    min_r AS min_mag,\n                    max_r AS max_mag,\n                    (max_r - min_r) AS delta_mag,\n                    meanra,\n                    meandec,\n                    ndet\n   FROM selected)\nSELECT pb.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid, -- feature table fid\n pb.meanra,\n pb.meandec,\n pb.ndet,\n pb.max_mag,\n pb.min_mag,\n pb.delta_mag, -- max_mag - min_mag per band\n pb.detection_fid -- detection (band) id\nFROM per_band pb\nJOIN feature f ON f.oid = pb.oid\nAND f.fid = pb.detection_fid -- return features for the same band to reduce result size\nORDER BY pb.oid,\n         pb.detection_fid,\n         f.name;"
                },
                "in_toks": 5758,
                "out_toks": 4523,
                "id": "chatcmpl-CbGW3s1qWmUl7zeVA9WXJVtTUL9b9",
                "created": 1762997659,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 4290,
                "out_toks": 1487,
                "id": "chatcmpl-CSxQxcCUAPMNLUqdt3JuVHS5Om4t9",
                "created": 1761017683,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- AGN, rank=1 of lc_classifier, prob>0.6; 1yr span; >=20 detections in at least one band; variability on corrected mags: g>1.0, r>0.5\nWITH P_agn AS\n  (SELECT DISTINCT oid\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND ranking = 1\n     AND class_name = 'AGN'\n     AND probability > 0.6),\n     O_year AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet,\n          o.deltajd\n   FROM OBJECT o\n   INNER JOIN P_agn p ON p.oid = o.oid\n   WHERE o.deltajd >= 365),\n     D_stats AS\n  (SELECT d.oid,\n          d.fid AS detection_fid,\n          COUNT(*) AS n_det_band,\n          MIN(d.magpsf_corr) AS min_mag,\n          MAX(d.magpsf_corr) AS max_mag,\n          MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS delta_mag\n   FROM detection d\n   WHERE d.oid IN\n       (SELECT oid\n        FROM O_year)\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid IN (1,\n                   2)-- g, r\n\n   GROUP BY d.oid,\n            d.fid),\n     Has20 AS\n  (SELECT DISTINCT oid\n   FROM D_stats\n   WHERE n_det_band >= 20),\n     G_ok AS\n  (SELECT oid\n   FROM D_stats\n   WHERE detection_fid = 1\n     AND delta_mag > 1.0),\n     R_ok AS\n  (SELECT oid\n   FROM D_stats\n   WHERE detection_fid = 2\n     AND delta_mag > 0.5),\n     Both_ok AS\n  (SELECT oid\n   FROM G_ok INTERSECT SELECT oid\n   FROM R_ok),\n     Selected AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM O_year o\n   WHERE o.oid IN\n       (SELECT oid\n        FROM Has20)\n     AND o.oid IN\n       (SELECT oid\n        FROM Both_ok))\nSELECT s.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid,\n       s.meanra,\n       s.meandec,\n       s.ndet,\n       d.max_mag AS max_mag,\n       d.min_mag AS min_mag,\n       d.delta_mag AS delta_mag,\n       d.detection_fid AS detection_fid\nFROM Selected s\nINNER JOIN D_stats d ON d.oid = s.oid\nAND d.detection_fid = 1\nINNER JOIN feature f ON f.oid = s.oid\nUNION ALL\nSELECT s.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid,\n       s.meanra,\n       s.meandec,\n       s.ndet,\n       d.max_mag AS max_mag,\n       d.min_mag AS min_mag,\n       d.delta_mag AS delta_mag,\n       d.detection_fid AS detection_fid\nFROM Selected s\nINNER JOIN D_stats d ON d.oid = s.oid\nAND d.detection_fid = 2\nINNER JOIN feature f ON f.oid = s.oid\nORDER BY oid,\n         detection_fid,\n         name;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query for the ALeRCE database\n\nGoal\nRetrieve all objects most-probably classified as AGN (lc_classifier, rank=1) with probability > 0.6, whose light curves span at least 1 year, that have at least 20 detections in at least one band, and that show per-band corrected-magnitude variability larger than 1.0 mag in g (fid=1) and larger than 0.5 mag in r (fid=2). Return, for those objects:\n- object.oid\n- feature.value, feature.name, feature.version, feature.fid (aliased as feature_fid)\n- object.meanra, object.meandec\n- object.ndet (number of detections)\n- per-band corrected max and min magnitudes from detection.magpsf_corr, and delta_mag = (max_mag - min_mag)\n- detection.fid (aliased as detection_fid)\nThe final output should contain rows per object and per band (g and r), carrying the per-band min/max/delta computed from corrected magnitudes.\n\nConstants and band mapping\n- One year threshold: 365 days (object.deltajd >= 365)\n- Minimum detections per band (existence in at least one band): 20\n- Variability thresholds:\n  - g-band (fid=1): delta_mag > 1.0\n  - r-band (fid=2): delta_mag > 0.5\n- Band IDs: detection.fid = 1 (g), 2 (r), 3 (i)\n\nStep-by-step plan\n\n1) Base selection of most-probable AGN (probability table)\n- Create a subquery (CTE) P_agn that selects oids from probability with:\n  - probability.classifier_name = 'lc_classifier' (default condition)\n  - probability.ranking = 1 (default condition)\n  - probability.class_name = 'AGN'\n  - probability.probability > 0.6\n- Columns: P_agn(oid)\n\n2) Join to object and enforce light curve duration >= 1 year\n- Create a subquery (CTE) O_year by INNER JOIN object O to P_agn on O.oid = P_agn.oid.\n- Filter O.deltajd >= 365.\n- Columns to carry forward: O_year(oid, meanra, meandec, ndet, deltajd)\n\n3) Compute per-band corrected magnitude stats and counts from detection\n- Build a subquery (CTE) D_stats that:\n  - Filters detection rows to only those with detection.oid IN (SELECT oid FROM O_year).\n  - Uses only corrected magnitudes: detection.corrected = TRUE AND detection.magpsf_corr IS NOT NULL.\n  - Groups by (oid, fid).\n  - Computes per (oid, fid):\n    - n_det_band = COUNT(*)\n    - min_mag_corr = MIN(detection.magpsf_corr)\n    - max_mag_corr = MAX(detection.magpsf_corr)\n    - delta_mag = (MAX(detection.magpsf_corr) - MIN(detection.magpsf_corr))\n  - Limit to bands of interest for downstream variability checks: fid IN (1, 2).\n  - Expose fid as detection_fid in the select list for the final output.\n- Columns: D_stats(oid, detection_fid, n_det_band, min_mag_corr, max_mag_corr, delta_mag)\n\n4) Ensure \u201cat least 20 detections in at least one band\u201d\n- Create a subquery (CTE) Has20 that selects DISTINCT oid from D_stats where n_det_band >= 20.\n- Columns: Has20(oid)\n\n5) Per-band variability constraints on corrected magnitudes\n- Create two subqueries selecting oids from D_stats:\n  - G_ok: WHERE detection_fid = 1 AND delta_mag > 1.0\n  - R_ok: WHERE detection_fid = 2 AND delta_mag > 0.5\n- Create a subquery Both_ok that returns oids present in both sets using INTERSECT:\n  - Both_ok = (SELECT oid FROM G_ok) INTERSECT (SELECT oid FROM R_ok)\n- Columns: Both_ok(oid)\n\n6) Final object selection combining all constraints\n- Create a subquery (CTE) Selected that returns rows from O_year where:\n  - oid IN (SELECT oid FROM Has20)  [\u2265 20 detections in at least one band]\n  - AND oid IN (SELECT oid FROM Both_ok)  [passes both g and r variability thresholds]\n- Columns: Selected(oid, meanra, meandec, ndet)\n\n7) Prepare per-band output blocks and use UNION ALL to stack g and r rows\n- Build two band-specific subqueries that will be UNIONed:\n\n  7a) Output_g (for g-band rows):\n  - INNER JOIN Selected S to D_stats D on (S.oid = D.oid AND D.detection_fid = 1)\n  - INNER JOIN feature F on F.oid = S.oid  [no additional feature filters; return all feature rows]\n  - Select the required columns:\n    - S.oid\n    - F.value, F.name, F.version, F.fid AS feature_fid\n    - S.meanra, S.meandec\n    - S.ndet\n    - D.max_mag_corr AS max_mag\n    - D.min_mag_corr AS min_mag\n    - D.delta_mag AS delta_mag\n    - D.detection_fid AS detection_fid\n\n  7b) Output_r (for r-band rows):\n  - INNER JOIN Selected S to D_stats D on (S.oid = D.oid AND D.detection_fid = 2)\n  - INNER JOIN feature F on F.oid = S.oid\n  - Select the same columns and aliases as in 7a.\n\n- Final result:\n  - UNION ALL Output_g and Output_r to produce one rowset containing both g and r band rows per object.\n  - This satisfies the requirement to return per-band max/min/variation and to use UNION.\n\n8) Aliasing and column naming\n- For filter id fields:\n  - D_stats.fid must be exposed as detection_fid\n  - feature.fid must be exposed as feature_fid\n- Ensure the variability column is returned as delta_mag.\n- Ensure max and min corrected magnitudes are labeled max_mag and min_mag, respectively.\n\n9) Optional ordering (not required, but useful)\n- ORDER BY oid, detection_fid, F.name (or as needed).\n\n10) Performance notes and constraints compliance\n- probability filters use indexes: ranking and classifier_name, and class_name/probability.\n- detection access is restricted to oids from O_year (hash index on detection.oid) and to corrected rows with non-null magpsf_corr.\n- Aggregations are done per (oid, fid) only; no filtering on detection by unindexed columns.\n- The query uses:\n  - JOINs (probability\u2194object, object\u2194detection aggregates, object\u2194feature),\n  - INTERSECT (to enforce both g and r variability),\n  - UNION ALL (to return separate band rows in the final output),\n  - Nested/CTE subqueries for clarity and efficiency."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query for the ALeRCE database\n\nGoal\nRetrieve all objects most-probably classified as AGN (lc_classifier, rank=1) with probability > 0.6, whose light curves span at least 1 year, that have at least 20 detections in at least one band, and that show per-band corrected-magnitude variability larger than 1.0 mag in g (fid=1) and larger than 0.5 mag in r (fid=2). Return, for those objects:\n- object.oid\n- feature.value, feature.name, feature.version, feature.fid (aliased as feature_fid)\n- object.meanra, object.meandec\n- object.ndet (number of detections)\n- per-band corrected max and min magnitudes from detection.magpsf_corr, and delta_mag = (max_mag - min_mag)\n- detection.fid (aliased as detection_fid)\nThe final output should contain rows per object and per band (g and r), carrying the per-band min/max/delta computed from corrected magnitudes.\n\nConstants and band mapping\n- One year threshold: 365 days (object.deltajd >= 365)\n- Minimum detections per band (existence in at least one band): 20\n- Variability thresholds:\n  - g-band (fid=1): delta_mag > 1.0\n  - r-band (fid=2): delta_mag > 0.5\n- Band IDs: detection.fid = 1 (g), 2 (r), 3 (i)\n\nStep-by-step plan\n\n1) Base selection of most-probable AGN (probability table)\n- Create a subquery (CTE) P_agn that selects oids from probability with:\n  - probability.classifier_name = 'lc_classifier' (default condition)\n  - probability.ranking = 1 (default condition)\n  - probability.class_name = 'AGN'\n  - probability.probability > 0.6\n- Columns: P_agn(oid)\n\n2) Join to object and enforce light curve duration >= 1 year\n- Create a subquery (CTE) O_year by INNER JOIN object O to P_agn on O.oid = P_agn.oid.\n- Filter O.deltajd >= 365.\n- Columns to carry forward: O_year(oid, meanra, meandec, ndet, deltajd)\n\n3) Compute per-band corrected magnitude stats and counts from detection\n- Build a subquery (CTE) D_stats that:\n  - Filters detection rows to only those with detection.oid IN (SELECT oid FROM O_year).\n  - Uses only corrected magnitudes: detection.corrected = TRUE AND detection.magpsf_corr IS NOT NULL.\n  - Groups by (oid, fid).\n  - Computes per (oid, fid):\n    - n_det_band = COUNT(*)\n    - min_mag_corr = MIN(detection.magpsf_corr)\n    - max_mag_corr = MAX(detection.magpsf_corr)\n    - delta_mag = (MAX(detection.magpsf_corr) - MIN(detection.magpsf_corr))\n  - Limit to bands of interest for downstream variability checks: fid IN (1, 2).\n  - Expose fid as detection_fid in the select list for the final output.\n- Columns: D_stats(oid, detection_fid, n_det_band, min_mag_corr, max_mag_corr, delta_mag)\n\n4) Ensure \u201cat least 20 detections in at least one band\u201d\n- Create a subquery (CTE) Has20 that selects DISTINCT oid from D_stats where n_det_band >= 20.\n- Columns: Has20(oid)\n\n5) Per-band variability constraints on corrected magnitudes\n- Create two subqueries selecting oids from D_stats:\n  - G_ok: WHERE detection_fid = 1 AND delta_mag > 1.0\n  - R_ok: WHERE detection_fid = 2 AND delta_mag > 0.5\n- Create a subquery Both_ok that returns oids present in both sets using INTERSECT:\n  - Both_ok = (SELECT oid FROM G_ok) INTERSECT (SELECT oid FROM R_ok)\n- Columns: Both_ok(oid)\n\n6) Final object selection combining all constraints\n- Create a subquery (CTE) Selected that returns rows from O_year where:\n  - oid IN (SELECT oid FROM Has20)  [\u2265 20 detections in at least one band]\n  - AND oid IN (SELECT oid FROM Both_ok)  [passes both g and r variability thresholds]\n- Columns: Selected(oid, meanra, meandec, ndet)\n\n7) Prepare per-band output blocks and use UNION ALL to stack g and r rows\n- Build two band-specific subqueries that will be UNIONed:\n\n  7a) Output_g (for g-band rows):\n  - INNER JOIN Selected S to D_stats D on (S.oid = D.oid AND D.detection_fid = 1)\n  - INNER JOIN feature F on F.oid = S.oid  [no additional feature filters; return all feature rows]\n  - Select the required columns:\n    - S.oid\n    - F.value, F.name, F.version, F.fid AS feature_fid\n    - S.meanra, S.meandec\n    - S.ndet\n    - D.max_mag_corr AS max_mag\n    - D.min_mag_corr AS min_mag\n    - D.delta_mag AS delta_mag\n    - D.detection_fid AS detection_fid\n\n  7b) Output_r (for r-band rows):\n  - INNER JOIN Selected S to D_stats D on (S.oid = D.oid AND D.detection_fid = 2)\n  - INNER JOIN feature F on F.oid = S.oid\n  - Select the same columns and aliases as in 7a.\n\n- Final result:\n  - UNION ALL Output_g and Output_r to produce one rowset containing both g and r band rows per object.\n  - This satisfies the requirement to return per-band max/min/variation and to use UNION.\n\n8) Aliasing and column naming\n- For filter id fields:\n  - D_stats.fid must be exposed as detection_fid\n  - feature.fid must be exposed as feature_fid\n- Ensure the variability column is returned as delta_mag.\n- Ensure max and min corrected magnitudes are labeled max_mag and min_mag, respectively.\n\n9) Optional ordering (not required, but useful)\n- ORDER BY oid, detection_fid, F.name (or as needed).\n\n10) Performance notes and constraints compliance\n- probability filters use indexes: ranking and classifier_name, and class_name/probability.\n- detection access is restricted to oids from O_year (hash index on detection.oid) and to corrected rows with non-null magpsf_corr.\n- Aggregations are done per (oid, fid) only; no filtering on detection by unindexed columns.\n- The query uses:\n  - JOINs (probability\u2194object, object\u2194detection aggregates, object\u2194feature),\n  - INTERSECT (to enforce both g and r variability),\n  - UNION ALL (to return separate band rows in the final output),\n  - Nested/CTE subqueries for clarity and efficiency."
                    },
                    "in_toks": 6168,
                    "out_toks": 6085,
                    "id": "chatcmpl-Cb5QpeAt07OgkiPOL3KyWf2lsqNEq",
                    "created": 1762955051,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- AGN, rank=1 of lc_classifier, prob>0.6; 1yr span; >=20 detections in at least one band; variability on corrected mags: g>1.0, r>0.5\nWITH P_agn AS\n  (SELECT DISTINCT oid\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND ranking = 1\n     AND class_name = 'AGN'\n     AND probability > 0.6),\n     O_year AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet,\n          o.deltajd\n   FROM OBJECT o\n   INNER JOIN P_agn p ON p.oid = o.oid\n   WHERE o.deltajd >= 365),\n     D_stats AS\n  (SELECT d.oid,\n          d.fid AS detection_fid,\n          COUNT(*) AS n_det_band,\n          MIN(d.magpsf_corr) AS min_mag,\n          MAX(d.magpsf_corr) AS max_mag,\n          MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS delta_mag\n   FROM detection d\n   WHERE d.oid IN\n       (SELECT oid\n        FROM O_year)\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid IN (1,\n                   2)-- g, r\n\n   GROUP BY d.oid,\n            d.fid),\n     Has20 AS\n  (SELECT DISTINCT oid\n   FROM D_stats\n   WHERE n_det_band >= 20),\n     G_ok AS\n  (SELECT oid\n   FROM D_stats\n   WHERE detection_fid = 1\n     AND delta_mag > 1.0),\n     R_ok AS\n  (SELECT oid\n   FROM D_stats\n   WHERE detection_fid = 2\n     AND delta_mag > 0.5),\n     Both_ok AS\n  (SELECT oid\n   FROM G_ok INTERSECT SELECT oid\n   FROM R_ok),\n     Selected AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM O_year o\n   WHERE o.oid IN\n       (SELECT oid\n        FROM Has20)\n     AND o.oid IN\n       (SELECT oid\n        FROM Both_ok))\nSELECT s.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid,\n       s.meanra,\n       s.meandec,\n       s.ndet,\n       d.max_mag AS max_mag,\n       d.min_mag AS min_mag,\n       d.delta_mag AS delta_mag,\n       d.detection_fid AS detection_fid\nFROM Selected s\nINNER JOIN D_stats d ON d.oid = s.oid\nAND d.detection_fid = 1\nINNER JOIN feature f ON f.oid = s.oid\nUNION ALL\nSELECT s.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid,\n       s.meanra,\n       s.meandec,\n       s.ndet,\n       d.max_mag AS max_mag,\n       d.min_mag AS min_mag,\n       d.delta_mag AS delta_mag,\n       d.detection_fid AS detection_fid\nFROM Selected s\nINNER JOIN D_stats d ON d.oid = s.oid\nAND d.detection_fid = 2\nINNER JOIN feature f ON f.oid = s.oid\nORDER BY oid,\n         detection_fid,\n         name;"
                        },
                        "in_toks": 6361,
                        "out_toks": 4065,
                        "id": "chatcmpl-Cb5SAkAsDppsw5dHO6U95kJ9KiWXz",
                        "created": 1762955134,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "3": {
            "req_id": "1",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'detection', 'feature', 'feature_version']"
                },
                "in_toks": 737,
                "out_toks": 1374,
                "id": "chatcmpl-CSsViDMYfYdtLovU53yXm09gvVR8L",
                "created": 1760998758,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query: restrict candidate set early; aggregate per-oid once using FILTER; limit features to g/r bands; keep ranking=1 in probability\nWITH cand_prob AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.ranking = 1\n     AND p.probability > 0.6),\n     base AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   JOIN cand_prob cp ON cp.oid = o.oid\n   WHERE o.deltajd >= 365.0),\n     det_agg AS\n  (SELECT d.oid,\n          MIN(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 1) AS min_mag_g,\n          MAX(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 1) AS max_mag_g,\n          MIN(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 2) AS min_mag_r,\n          MAX(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 2) AS max_mag_r,\n          COUNT(*) FILTER (\n                           WHERE d.fid = 1) AS n_g,\n          COUNT(*) FILTER (\n                           WHERE d.fid = 2) AS n_r\n   FROM detection d\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.oid IN\n       (SELECT oid\n        FROM base)\n   GROUP BY d.oid\n   HAVING (MAX(d.magpsf_corr) FILTER (\n                                      WHERE d.fid = 1) - MIN(d.magpsf_corr) FILTER (\n                                                                                    WHERE d.fid = 1)) > 1.0\n   AND (MAX(d.magpsf_corr) FILTER (\n                                   WHERE d.fid = 2) - MIN(d.magpsf_corr) FILTER (\n                                                                                 WHERE d.fid = 2)) > 0.5\n   AND GREATEST(COUNT(*) FILTER (\n                                 WHERE d.fid = 1), COUNT(*) FILTER (\n                                                                    WHERE d.fid = 2)) >= 20),\n     rows_per_band AS\n  (SELECT b.oid,\n          b.meanra,\n          b.meandec,\n          b.ndet,\n          da.max_mag_g AS max_mag,\n          da.min_mag_g AS min_mag,\n          (da.max_mag_g - da.min_mag_g) AS delta_mag,\n          1 AS detection_fid\n   FROM det_agg da\n   JOIN base b ON b.oid = da.oid\n   UNION ALL SELECT b.oid,\n                    b.meanra,\n                    b.meandec,\n                    b.ndet,\n                    da.max_mag_r AS max_mag,\n                    da.min_mag_r AS min_mag,\n                    (da.max_mag_r - da.min_mag_r) AS delta_mag,\n                    2 AS detection_fid\n   FROM det_agg da\n   JOIN base b ON b.oid = da.oid),\n     feat AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   WHERE f.fid IN (1,\n                   2)-- limit to g/r features to reduce output volume\n\n     AND f.oid IN\n       (SELECT oid\n        FROM det_agg))\nSELECT rpb.oid,\n       fe.value,\n       fe.name,\n       fe.version,\n       fe.feature_fid, -- feature table filter id (as requested)\n rpb.meanra,\n rpb.meandec,\n rpb.ndet,\n rpb.max_mag,\n rpb.min_mag,\n rpb.delta_mag, -- difference between max and min corrected magnitudes\n rpb.detection_fid -- detection table filter id (as requested)\nFROM rows_per_band rpb\nJOIN feat fe ON fe.oid = rpb.oid\nORDER BY rpb.oid ASC,\n         rpb.detection_fid ASC,\n         fe.name ASC;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query: restrict candidate set early; aggregate per-oid once using FILTER; limit features to g/r bands; keep ranking=1 in probability\nWITH cand_prob AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.ranking = 1\n     AND p.probability > 0.6),\n     base AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   JOIN cand_prob cp ON cp.oid = o.oid\n   WHERE o.deltajd >= 365.0),\n     det_agg AS\n  (SELECT d.oid,\n          MIN(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 1) AS min_mag_g,\n          MAX(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 1) AS max_mag_g,\n          MIN(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 2) AS min_mag_r,\n          MAX(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 2) AS max_mag_r,\n          COUNT(*) FILTER (\n                           WHERE d.fid = 1) AS n_g,\n          COUNT(*) FILTER (\n                           WHERE d.fid = 2) AS n_r\n   FROM detection d\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.oid IN\n       (SELECT oid\n        FROM base)\n   GROUP BY d.oid\n   HAVING (MAX(d.magpsf_corr) FILTER (\n                                      WHERE d.fid = 1) - MIN(d.magpsf_corr) FILTER (\n                                                                                    WHERE d.fid = 1)) > 1.0\n   AND (MAX(d.magpsf_corr) FILTER (\n                                   WHERE d.fid = 2) - MIN(d.magpsf_corr) FILTER (\n                                                                                 WHERE d.fid = 2)) > 0.5\n   AND GREATEST(COUNT(*) FILTER (\n                                 WHERE d.fid = 1), COUNT(*) FILTER (\n                                                                    WHERE d.fid = 2)) >= 20),\n     rows_per_band AS\n  (SELECT b.oid,\n          b.meanra,\n          b.meandec,\n          b.ndet,\n          da.max_mag_g AS max_mag,\n          da.min_mag_g AS min_mag,\n          (da.max_mag_g - da.min_mag_g) AS delta_mag,\n          1 AS detection_fid\n   FROM det_agg da\n   JOIN base b ON b.oid = da.oid\n   UNION ALL SELECT b.oid,\n                    b.meanra,\n                    b.meandec,\n                    b.ndet,\n                    da.max_mag_r AS max_mag,\n                    da.min_mag_r AS min_mag,\n                    (da.max_mag_r - da.min_mag_r) AS delta_mag,\n                    2 AS detection_fid\n   FROM det_agg da\n   JOIN base b ON b.oid = da.oid),\n     feat AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   WHERE f.fid IN (1,\n                   2)-- limit to g/r features to reduce output volume\n\n     AND f.oid IN\n       (SELECT oid\n        FROM det_agg))\nSELECT rpb.oid,\n       fe.value,\n       fe.name,\n       fe.version,\n       fe.feature_fid, -- feature table filter id (as requested)\n rpb.meanra,\n rpb.meandec,\n rpb.ndet,\n rpb.max_mag,\n rpb.min_mag,\n rpb.delta_mag, -- difference between max and min corrected magnitudes\n rpb.detection_fid -- detection table filter id (as requested)\nFROM rows_per_band rpb\nJOIN feat fe ON fe.oid = rpb.oid\nORDER BY rpb.oid ASC,\n         rpb.detection_fid ASC,\n         fe.name ASC;"
                },
                "in_toks": 6294,
                "out_toks": 4045,
                "id": "chatcmpl-CbGX0PI5rBOJdz7ZM3Ed4BrO1VhYX",
                "created": 1762997718,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 4290,
                "out_toks": 848,
                "id": "chatcmpl-CSxRJg0tc6SdHoVuePWSNMApgHCPY",
                "created": 1761017705,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- AGN with P>0.6 (lc_classifier, rank=1), \u22651 year span, \u226520 corrected detections in any band,\n-- and corrected-magnitude variability >1 mag in g and >0.5 mag in r.\n-- Return per selected object and per band row (g and r): oid, feature fields (value, name, version, feature_fid),\n-- object fields (meanra, meandec, ndet), per-band corrected min/max mags, delta_mag, and detection_fid.\n WITH P_AGN AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6),\n      O_base AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet,\n          o.deltajd\n   FROM OBJECT o\n   INNER JOIN P_AGN pa ON pa.oid = o.oid\n   WHERE o.deltajd >= 365.0),\n      D_corr AS\n  (SELECT d.oid,\n          d.fid,\n          d.magpsf_corr\n   FROM detection d\n   INNER JOIN O_base ob ON ob.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL),\n      D_g AS\n  (SELECT oid,\n          MIN(magpsf_corr) AS min_mag_g,\n          MAX(magpsf_corr) AS max_mag_g\n   FROM D_corr\n   WHERE fid = 1\n   GROUP BY oid),\n      D_r AS\n  (SELECT oid,\n          MIN(magpsf_corr) AS min_mag_r,\n          MAX(magpsf_corr) AS max_mag_r\n   FROM D_corr\n   WHERE fid = 2\n   GROUP BY oid),\n      Cand_g AS\n  (SELECT dg.oid\n   FROM D_g dg\n   WHERE (dg.max_mag_g - dg.min_mag_g) > 1.0),\n      Cand_r AS\n  (SELECT dr.oid\n   FROM D_r dr\n   WHERE (dr.max_mag_r - dr.min_mag_r) > 0.5),\n      Cand_delta_both AS\n  (SELECT oid\n   FROM Cand_g INTERSECT SELECT oid\n   FROM Cand_r),\n      D_cnt AS\n  (SELECT oid,\n          fid,\n          COUNT(*) AS n_det_band\n   FROM D_corr\n   GROUP BY oid,\n            fid),\n      Cand_count AS\n  (SELECT oid\n   FROM D_cnt\n   GROUP BY oid\n   HAVING MAX(n_det_band) >= 20),\n      Cand_final AS\n  (SELECT oid\n   FROM O_base INTERSECT SELECT oid\n   FROM Cand_delta_both INTERSECT SELECT oid\n   FROM Cand_count),\n      Rows_g AS\n  (SELECT ob.oid,\n          ob.meanra,\n          ob.meandec,\n          ob.ndet,\n          dg.max_mag_g AS max_mag,\n          dg.min_mag_g AS min_mag,\n          (dg.max_mag_g - dg.min_mag_g) AS delta_mag,\n          1 AS detection_fid\n   FROM D_g dg\n   INNER JOIN Cand_final cf ON cf.oid = dg.oid\n   INNER JOIN O_base ob ON ob.oid = dg.oid),\n      Rows_r AS\n  (SELECT ob.oid,\n          ob.meanra,\n          ob.meandec,\n          ob.ndet,\n          dr.max_mag_r AS max_mag,\n          dr.min_mag_r AS min_mag,\n          (dr.max_mag_r - dr.min_mag_r) AS delta_mag,\n          2 AS detection_fid\n   FROM D_r dr\n   INNER JOIN Cand_final cf ON cf.oid = dr.oid\n   INNER JOIN O_base ob ON ob.oid = dr.oid),\n      Rows_per_band AS\n  (SELECT *\n   FROM Rows_g\n   UNION ALL SELECT *\n   FROM Rows_r),\n      F_all AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN Cand_final cf ON cf.oid = f.oid)\nSELECT rpb.oid,\n       fa.value,\n       fa.name,\n       fa.version,\n       fa.feature_fid,\n       rpb.meanra,\n       rpb.meandec,\n       rpb.ndet,\n       rpb.max_mag,\n       rpb.min_mag,\n       rpb.delta_mag,\n       rpb.detection_fid\nFROM Rows_per_band rpb\nINNER JOIN F_all fa ON fa.oid = rpb.oid\nORDER BY rpb.oid ASC,\n         rpb.detection_fid ASC,\n         fa.name ASC;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query for the ALeRCE database\n\nGoal\nRetrieve AGN objects (per lc_classifier) with P>0.6, whose light curves span \u22651 year, have \u226520 corrected detections in at least one band, and show corrected-magnitude variations >1 mag in g and >0.5 mag in r. Return, for each selected object and per band row (g and r):\n- oid\n- feature fields: value, name, version, fid (aliased as feature_fid)\n- object fields: meanra, meandec, ndet\n- per-band corrected min and max magnitudes, and their difference aliased as delta_mag\n- detection fid (aliased as detection_fid)\n\nConventions and defaults\n- Classifier filter: probability.classifier_name='lc_classifier' AND probability.ranking=1\n- Target class: probability.class_name='AGN' AND probability.probability>0.6\n- Light-curve span: object.deltajd >= 365.0 (days)\n- Use corrected magnitudes from detection.magpsf_corr (non-null) with detection.corrected=TRUE\n- Band IDs: g (fid=1), r (fid=2)\n- Alias fid columns as: detection_fid (from detection/detection aggregates) and feature_fid (from feature)\n\nHigh-level structure\n- Use nested subqueries/CTEs to:\n  1) Select AGN candidates (probability)\n  2) Enforce \u22651-year span (object)\n  3) Compute per-band corrected min/max/\u0394 (detection) for g and r\n  4) Build object sets meeting \u0394 thresholds (g and r separately), then INTERSECT\n  5) Enforce \u226520 corrected detections in at least one band (detection), via a per-object band max count\n  6) INTERSECT all object sets to produce the final oid set\n  7) Produce per-band aggregated rows (g and r) with min_mag, max_mag, delta_mag and detection_fid\n  8) UNION ALL the g and r band rows\n  9) Join in features for those oids, returning value, name, version, fid AS feature_fid\n  10) Join in object columns (meanra, meandec, ndet), and order\n\nDetailed steps and subqueries\n\n1) Base AGN selection with probability filters\n- Subquery name: P_AGN\n- FROM: probability p\n- WHERE:\n  - p.classifier_name = 'lc_classifier'\n  - p.ranking = 1\n  - p.class_name = 'AGN'\n  - p.probability > 0.6\n- SELECT: p.oid (and optionally p.classifier_version if needed later)\n- Purpose: reduce to oids with top-1 lc_classifier AGN probability > 0.6\n\n2) Apply light-curve span constraint and gather object-level fields\n- Subquery name: O_base\n- FROM: object o\n- INNER JOIN P_AGN pa ON pa.oid = o.oid\n- WHERE: o.deltajd >= 365.0\n- SELECT: o.oid, o.meanra, o.meandec, o.ndet, o.deltajd\n- Purpose: ensure \u22651-year coverage and retain required object columns\n\n3) Restrict detection table to relevant objects and corrected photometry\n- Subquery name: D_corr\n- FROM: detection d\n- INNER JOIN O_base ob ON ob.oid = d.oid\n- WHERE:\n  - d.corrected = TRUE\n  - d.magpsf_corr IS NOT NULL\n- SELECT: d.oid, d.fid, d.magpsf_corr\n- Purpose: limit detection rows to corrected magnitudes for the selected objects\n\n4) Per-band corrected extrema and deltas (g band)\n- Subquery name: D_g\n- FROM: D_corr\n- WHERE: fid = 1\n- GROUP BY: oid\n- Aggregations:\n  - min_mag_g = MIN(magpsf_corr)\n  - max_mag_g = MAX(magpsf_corr)\n  - delta_mag = (max_mag_g - min_mag_g)  [alias this column as delta_mag in the final g-band selection]\n- SELECT: oid, min_mag_g, max_mag_g, delta_mag\n- Purpose: compute g-band variation based on corrected magnitudes\n\n5) Per-band corrected extrema and deltas (r band)\n- Subquery name: D_r\n- FROM: D_corr\n- WHERE: fid = 2\n- GROUP BY: oid\n- Aggregations:\n  - min_mag_r = MIN(magpsf_corr)\n  - max_mag_r = MAX(magpsf_corr)\n  - delta_mag = (max_mag_r - min_mag_r)  [alias this column as delta_mag in the final r-band selection]\n- SELECT: oid, min_mag_r, max_mag_r, delta_mag\n- Purpose: compute r-band variation based on corrected magnitudes\n\n6) Object sets meeting per-band variation thresholds\n- Subquery name: Cand_g\n  - FROM: D_g\n  - WHERE: delta_mag > 1.0\n  - SELECT: oid\n- Subquery name: Cand_r\n  - FROM: D_r\n  - WHERE: delta_mag > 0.5\n  - SELECT: oid\n- Subquery name: Cand_delta_both\n  - Definition: Cand_g INTERSECT Cand_r\n  - SELECT: oid\n- Purpose: enforce both g and r variability thresholds via INTERSECT\n\n7) At-least-20 corrected detections in any band\n- Subquery name: D_cnt\n  - FROM: D_corr\n  - GROUP BY: oid, fid\n  - Aggregation: n_det_band = COUNT(*)\n  - SELECT: oid, fid, n_det_band\n- Subquery name: Cand_count\n  - FROM: D_cnt\n  - GROUP BY: oid\n  - HAVING: MAX(n_det_band) >= 20\n  - SELECT: oid\n- Purpose: ensure there exists at least one band (any fid) with \u226520 corrected detections\n\n8) Final oid set meeting all object-level constraints\n- Subquery name: Cand_final\n  - Definition: (SELECT oid FROM O_base)  INTERSECT  Cand_delta_both  INTERSECT  Cand_count\n  - SELECT: oid\n- Purpose: consolidate coverage, variability, and detection-count criteria via nested INTERSECTs\n\n9) Build per-band rows with min/max/\u0394 and detection_fid, limited to final oids\n- Subquery name: Rows_g\n  - FROM: D_g dg\n  - INNER JOIN Cand_final cf ON cf.oid = dg.oid\n  - INNER JOIN O_base ob ON ob.oid = dg.oid\n  - SELECT:\n    - ob.oid\n    - ob.meanra\n    - ob.meandec\n    - ob.ndet\n    - dg.min_mag_g AS min_mag\n    - dg.max_mag_g AS max_mag\n    - (dg.max_mag_g - dg.min_mag_g) AS delta_mag\n    - 1 AS detection_fid\n- Subquery name: Rows_r\n  - FROM: D_r dr\n  - INNER JOIN Cand_final cf ON cf.oid = dr.oid\n  - INNER JOIN O_base ob ON ob.oid = dr.oid\n  - SELECT:\n    - ob.oid\n    - ob.meanra\n    - ob.meandec\n    - ob.ndet\n    - dr.min_mag_r AS min_mag\n    - dr.max_mag_r AS max_mag\n    - (dr.max_mag_r - dr.min_mag_r) AS delta_mag\n    - 2 AS detection_fid\n- Subquery name: Rows_per_band\n  - Definition: Rows_g UNION ALL Rows_r\n- Purpose: produce two rows per object (g and r), each with min_mag, max_mag, delta_mag, and detection_fid as requested\n\n10) Feature rows for selected objects\n- Subquery name: F_all\n- FROM: feature f\n- INNER JOIN Cand_final cf ON cf.oid = f.oid\n- SELECT:\n  - f.oid\n  - f.value\n  - f.name\n  - f.version\n  - f.fid AS feature_fid\n- Purpose: collect all features for the selected objects, with fid aliased as feature_fid\n\n11) Final assembly: join per-band rows with features\n- FROM: Rows_per_band rpb\n- INNER JOIN F_all fa ON fa.oid = rpb.oid\n- SELECT (final output columns, in this order or similar):\n  - rpb.oid\n  - fa.value\n  - fa.name\n  - fa.version\n  - fa.feature_fid\n  - rpb.meanra\n  - rpb.meandec\n  - rpb.ndet\n  - rpb.max_mag\n  - rpb.min_mag\n  - rpb.delta_mag\n  - rpb.detection_fid\n- Optional ORDER BY:\n  - rpb.oid ASC, rpb.detection_fid ASC, fa.name ASC\n\nNotes and implementation details\n- The INTERSECT operations are essential to enforce that oids satisfy both g and r variability thresholds, as well as the \u226520-corrected-detections and \u22651-year-coverage conditions.\n- All detection-based computations (counts, min/max/\u0394) are restricted to corrected photometry (d.corrected=TRUE and magpsf_corr IS NOT NULL).\n- Rows_per_band presents one row per (oid, band) for g and r, with the column delta_mag aliased identically in each branch; detection_fid disambiguates the band per row.\n- The feature table is joined without additional filtering to return its value, name, version, and fid (as feature_fid) for each selected object.\n- Use the provided indexes implicitly: probability(ranking), probability(probability), detection(oid), and object(ndet, firstmjd) to keep execution efficient by constraining early with P_AGN and O_base before scanning detection."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query for the ALeRCE database\n\nGoal\nRetrieve AGN objects (per lc_classifier) with P>0.6, whose light curves span \u22651 year, have \u226520 corrected detections in at least one band, and show corrected-magnitude variations >1 mag in g and >0.5 mag in r. Return, for each selected object and per band row (g and r):\n- oid\n- feature fields: value, name, version, fid (aliased as feature_fid)\n- object fields: meanra, meandec, ndet\n- per-band corrected min and max magnitudes, and their difference aliased as delta_mag\n- detection fid (aliased as detection_fid)\n\nConventions and defaults\n- Classifier filter: probability.classifier_name='lc_classifier' AND probability.ranking=1\n- Target class: probability.class_name='AGN' AND probability.probability>0.6\n- Light-curve span: object.deltajd >= 365.0 (days)\n- Use corrected magnitudes from detection.magpsf_corr (non-null) with detection.corrected=TRUE\n- Band IDs: g (fid=1), r (fid=2)\n- Alias fid columns as: detection_fid (from detection/detection aggregates) and feature_fid (from feature)\n\nHigh-level structure\n- Use nested subqueries/CTEs to:\n  1) Select AGN candidates (probability)\n  2) Enforce \u22651-year span (object)\n  3) Compute per-band corrected min/max/\u0394 (detection) for g and r\n  4) Build object sets meeting \u0394 thresholds (g and r separately), then INTERSECT\n  5) Enforce \u226520 corrected detections in at least one band (detection), via a per-object band max count\n  6) INTERSECT all object sets to produce the final oid set\n  7) Produce per-band aggregated rows (g and r) with min_mag, max_mag, delta_mag and detection_fid\n  8) UNION ALL the g and r band rows\n  9) Join in features for those oids, returning value, name, version, fid AS feature_fid\n  10) Join in object columns (meanra, meandec, ndet), and order\n\nDetailed steps and subqueries\n\n1) Base AGN selection with probability filters\n- Subquery name: P_AGN\n- FROM: probability p\n- WHERE:\n  - p.classifier_name = 'lc_classifier'\n  - p.ranking = 1\n  - p.class_name = 'AGN'\n  - p.probability > 0.6\n- SELECT: p.oid (and optionally p.classifier_version if needed later)\n- Purpose: reduce to oids with top-1 lc_classifier AGN probability > 0.6\n\n2) Apply light-curve span constraint and gather object-level fields\n- Subquery name: O_base\n- FROM: object o\n- INNER JOIN P_AGN pa ON pa.oid = o.oid\n- WHERE: o.deltajd >= 365.0\n- SELECT: o.oid, o.meanra, o.meandec, o.ndet, o.deltajd\n- Purpose: ensure \u22651-year coverage and retain required object columns\n\n3) Restrict detection table to relevant objects and corrected photometry\n- Subquery name: D_corr\n- FROM: detection d\n- INNER JOIN O_base ob ON ob.oid = d.oid\n- WHERE:\n  - d.corrected = TRUE\n  - d.magpsf_corr IS NOT NULL\n- SELECT: d.oid, d.fid, d.magpsf_corr\n- Purpose: limit detection rows to corrected magnitudes for the selected objects\n\n4) Per-band corrected extrema and deltas (g band)\n- Subquery name: D_g\n- FROM: D_corr\n- WHERE: fid = 1\n- GROUP BY: oid\n- Aggregations:\n  - min_mag_g = MIN(magpsf_corr)\n  - max_mag_g = MAX(magpsf_corr)\n  - delta_mag = (max_mag_g - min_mag_g)  [alias this column as delta_mag in the final g-band selection]\n- SELECT: oid, min_mag_g, max_mag_g, delta_mag\n- Purpose: compute g-band variation based on corrected magnitudes\n\n5) Per-band corrected extrema and deltas (r band)\n- Subquery name: D_r\n- FROM: D_corr\n- WHERE: fid = 2\n- GROUP BY: oid\n- Aggregations:\n  - min_mag_r = MIN(magpsf_corr)\n  - max_mag_r = MAX(magpsf_corr)\n  - delta_mag = (max_mag_r - min_mag_r)  [alias this column as delta_mag in the final r-band selection]\n- SELECT: oid, min_mag_r, max_mag_r, delta_mag\n- Purpose: compute r-band variation based on corrected magnitudes\n\n6) Object sets meeting per-band variation thresholds\n- Subquery name: Cand_g\n  - FROM: D_g\n  - WHERE: delta_mag > 1.0\n  - SELECT: oid\n- Subquery name: Cand_r\n  - FROM: D_r\n  - WHERE: delta_mag > 0.5\n  - SELECT: oid\n- Subquery name: Cand_delta_both\n  - Definition: Cand_g INTERSECT Cand_r\n  - SELECT: oid\n- Purpose: enforce both g and r variability thresholds via INTERSECT\n\n7) At-least-20 corrected detections in any band\n- Subquery name: D_cnt\n  - FROM: D_corr\n  - GROUP BY: oid, fid\n  - Aggregation: n_det_band = COUNT(*)\n  - SELECT: oid, fid, n_det_band\n- Subquery name: Cand_count\n  - FROM: D_cnt\n  - GROUP BY: oid\n  - HAVING: MAX(n_det_band) >= 20\n  - SELECT: oid\n- Purpose: ensure there exists at least one band (any fid) with \u226520 corrected detections\n\n8) Final oid set meeting all object-level constraints\n- Subquery name: Cand_final\n  - Definition: (SELECT oid FROM O_base)  INTERSECT  Cand_delta_both  INTERSECT  Cand_count\n  - SELECT: oid\n- Purpose: consolidate coverage, variability, and detection-count criteria via nested INTERSECTs\n\n9) Build per-band rows with min/max/\u0394 and detection_fid, limited to final oids\n- Subquery name: Rows_g\n  - FROM: D_g dg\n  - INNER JOIN Cand_final cf ON cf.oid = dg.oid\n  - INNER JOIN O_base ob ON ob.oid = dg.oid\n  - SELECT:\n    - ob.oid\n    - ob.meanra\n    - ob.meandec\n    - ob.ndet\n    - dg.min_mag_g AS min_mag\n    - dg.max_mag_g AS max_mag\n    - (dg.max_mag_g - dg.min_mag_g) AS delta_mag\n    - 1 AS detection_fid\n- Subquery name: Rows_r\n  - FROM: D_r dr\n  - INNER JOIN Cand_final cf ON cf.oid = dr.oid\n  - INNER JOIN O_base ob ON ob.oid = dr.oid\n  - SELECT:\n    - ob.oid\n    - ob.meanra\n    - ob.meandec\n    - ob.ndet\n    - dr.min_mag_r AS min_mag\n    - dr.max_mag_r AS max_mag\n    - (dr.max_mag_r - dr.min_mag_r) AS delta_mag\n    - 2 AS detection_fid\n- Subquery name: Rows_per_band\n  - Definition: Rows_g UNION ALL Rows_r\n- Purpose: produce two rows per object (g and r), each with min_mag, max_mag, delta_mag, and detection_fid as requested\n\n10) Feature rows for selected objects\n- Subquery name: F_all\n- FROM: feature f\n- INNER JOIN Cand_final cf ON cf.oid = f.oid\n- SELECT:\n  - f.oid\n  - f.value\n  - f.name\n  - f.version\n  - f.fid AS feature_fid\n- Purpose: collect all features for the selected objects, with fid aliased as feature_fid\n\n11) Final assembly: join per-band rows with features\n- FROM: Rows_per_band rpb\n- INNER JOIN F_all fa ON fa.oid = rpb.oid\n- SELECT (final output columns, in this order or similar):\n  - rpb.oid\n  - fa.value\n  - fa.name\n  - fa.version\n  - fa.feature_fid\n  - rpb.meanra\n  - rpb.meandec\n  - rpb.ndet\n  - rpb.max_mag\n  - rpb.min_mag\n  - rpb.delta_mag\n  - rpb.detection_fid\n- Optional ORDER BY:\n  - rpb.oid ASC, rpb.detection_fid ASC, fa.name ASC\n\nNotes and implementation details\n- The INTERSECT operations are essential to enforce that oids satisfy both g and r variability thresholds, as well as the \u226520-corrected-detections and \u22651-year-coverage conditions.\n- All detection-based computations (counts, min/max/\u0394) are restricted to corrected photometry (d.corrected=TRUE and magpsf_corr IS NOT NULL).\n- Rows_per_band presents one row per (oid, band) for g and r, with the column delta_mag aliased identically in each branch; detection_fid disambiguates the band per row.\n- The feature table is joined without additional filtering to return its value, name, version, and fid (as feature_fid) for each selected object.\n- Use the provided indexes implicitly: probability(ranking), probability(probability), detection(oid), and object(ndet, firstmjd) to keep execution efficient by constraining early with P_AGN and O_base before scanning detection."
                    },
                    "in_toks": 6168,
                    "out_toks": 7274,
                    "id": "chatcmpl-Cb5SuFHRzgIuMFXqZ9vPpnDIwTQbO",
                    "created": 1762955180,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- AGN with P>0.6 (lc_classifier, rank=1), \u22651 year span, \u226520 corrected detections in any band,\n-- and corrected-magnitude variability >1 mag in g and >0.5 mag in r.\n-- Return per selected object and per band row (g and r): oid, feature fields (value, name, version, feature_fid),\n-- object fields (meanra, meandec, ndet), per-band corrected min/max mags, delta_mag, and detection_fid.\n WITH P_AGN AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6),\n      O_base AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet,\n          o.deltajd\n   FROM OBJECT o\n   INNER JOIN P_AGN pa ON pa.oid = o.oid\n   WHERE o.deltajd >= 365.0),\n      D_corr AS\n  (SELECT d.oid,\n          d.fid,\n          d.magpsf_corr\n   FROM detection d\n   INNER JOIN O_base ob ON ob.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL),\n      D_g AS\n  (SELECT oid,\n          MIN(magpsf_corr) AS min_mag_g,\n          MAX(magpsf_corr) AS max_mag_g\n   FROM D_corr\n   WHERE fid = 1\n   GROUP BY oid),\n      D_r AS\n  (SELECT oid,\n          MIN(magpsf_corr) AS min_mag_r,\n          MAX(magpsf_corr) AS max_mag_r\n   FROM D_corr\n   WHERE fid = 2\n   GROUP BY oid),\n      Cand_g AS\n  (SELECT dg.oid\n   FROM D_g dg\n   WHERE (dg.max_mag_g - dg.min_mag_g) > 1.0),\n      Cand_r AS\n  (SELECT dr.oid\n   FROM D_r dr\n   WHERE (dr.max_mag_r - dr.min_mag_r) > 0.5),\n      Cand_delta_both AS\n  (SELECT oid\n   FROM Cand_g INTERSECT SELECT oid\n   FROM Cand_r),\n      D_cnt AS\n  (SELECT oid,\n          fid,\n          COUNT(*) AS n_det_band\n   FROM D_corr\n   GROUP BY oid,\n            fid),\n      Cand_count AS\n  (SELECT oid\n   FROM D_cnt\n   GROUP BY oid\n   HAVING MAX(n_det_band) >= 20),\n      Cand_final AS\n  (SELECT oid\n   FROM O_base INTERSECT SELECT oid\n   FROM Cand_delta_both INTERSECT SELECT oid\n   FROM Cand_count),\n      Rows_g AS\n  (SELECT ob.oid,\n          ob.meanra,\n          ob.meandec,\n          ob.ndet,\n          dg.max_mag_g AS max_mag,\n          dg.min_mag_g AS min_mag,\n          (dg.max_mag_g - dg.min_mag_g) AS delta_mag,\n          1 AS detection_fid\n   FROM D_g dg\n   INNER JOIN Cand_final cf ON cf.oid = dg.oid\n   INNER JOIN O_base ob ON ob.oid = dg.oid),\n      Rows_r AS\n  (SELECT ob.oid,\n          ob.meanra,\n          ob.meandec,\n          ob.ndet,\n          dr.max_mag_r AS max_mag,\n          dr.min_mag_r AS min_mag,\n          (dr.max_mag_r - dr.min_mag_r) AS delta_mag,\n          2 AS detection_fid\n   FROM D_r dr\n   INNER JOIN Cand_final cf ON cf.oid = dr.oid\n   INNER JOIN O_base ob ON ob.oid = dr.oid),\n      Rows_per_band AS\n  (SELECT *\n   FROM Rows_g\n   UNION ALL SELECT *\n   FROM Rows_r),\n      F_all AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN Cand_final cf ON cf.oid = f.oid)\nSELECT rpb.oid,\n       fa.value,\n       fa.name,\n       fa.version,\n       fa.feature_fid,\n       rpb.meanra,\n       rpb.meandec,\n       rpb.ndet,\n       rpb.max_mag,\n       rpb.min_mag,\n       rpb.delta_mag,\n       rpb.detection_fid\nFROM Rows_per_band rpb\nINNER JOIN F_all fa ON fa.oid = rpb.oid\nORDER BY rpb.oid ASC,\n         rpb.detection_fid ASC,\n         fa.name ASC;"
                        },
                        "in_toks": 6974,
                        "out_toks": 2601,
                        "id": "chatcmpl-Cb5UoGDY9B7gXt7iHhqJQY4gffMSv",
                        "created": 1762955298,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "4": {
            "req_id": "1",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection",
                "magstat",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'detection', 'magstat', 'feature', 'feature_version']"
                },
                "in_toks": 737,
                "out_toks": 1314,
                "id": "chatcmpl-CSsW578JbEY4swrSPu1ksLiXCoL4O",
                "created": 1760998781,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query using EXISTS filters and avoiding large INTERSECT sets\n-- Requirements:\n--  - AGN classified by lc_classifier with ranking=1 and probability > 0.6\n--  - Light-curve coverage >= 1 year (object.deltajd >= 365)\n--  - At least one band with ndet >= 20 (from magstat)\n--  - Corrected variability: g band (fid=1) delta > 1.0, r band (fid=2) delta > 0.5\n--  - Return: oid, feature value/name/version/feature_fid, meanra, meandec, ndet,\n--           magstat magmax_corr, magmin_corr, delta_mag, and magstat_fid\n WITH base AS\n  (SELECT DISTINCT o.oid,\n                   o.meanra,\n                   o.meandec,\n                   o.ndet\n   FROM OBJECT o\n   JOIN probability p ON p.oid = o.oid\n   WHERE p.class_name = 'AGN'\n     AND p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.probability > 0.6\n     AND o.deltajd >= 365.0 -- At least one band with >= 20 detections\n\n     AND EXISTS\n       (SELECT 1\n        FROM magstat ms\n        WHERE ms.oid = o.oid\n          AND ms.ndet >= 20 )-- g band corrected variability > 1.0 mag\n\n     AND EXISTS\n       (SELECT 1\n        FROM magstat mg\n        WHERE mg.oid = o.oid\n          AND mg.fid = 1\n          AND mg.corrected = TRUE\n          AND mg.magmax_corr IS NOT NULL\n          AND mg.magmin_corr IS NOT NULL\n          AND (mg.magmax_corr - mg.magmin_corr) > 1.0 )-- r band corrected variability > 0.5 mag\n\n     AND EXISTS\n       (SELECT 1\n        FROM magstat mr\n        WHERE mr.oid = o.oid\n          AND mr.fid = 2\n          AND mr.corrected = TRUE\n          AND mr.magmax_corr IS NOT NULL\n          AND mr.magmin_corr IS NOT NULL\n          AND (mr.magmax_corr - mr.magmin_corr) > 0.5))\nSELECT b.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid, -- feature table filter id\n b.meanra,\n b.meandec,\n b.ndet,\n m.magmax_corr,\n m.magmin_corr,\n (m.magmax_corr - m.magmin_corr) AS delta_mag,\n m.fid AS magstat_fid -- magstat table filter id\nFROM base b\nJOIN magstat m ON m.oid = b.oid\nAND m.corrected = TRUE\nAND m.fid IN (1,\n              2)-- return per-band (g, r) corrected magnitudes\nJOIN feature f ON f.oid = b.oid\nORDER BY b.oid ASC,\n         m.fid ASC,\n         f.name ASC;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query using EXISTS filters and avoiding large INTERSECT sets\n-- Requirements:\n--  - AGN classified by lc_classifier with ranking=1 and probability > 0.6\n--  - Light-curve coverage >= 1 year (object.deltajd >= 365)\n--  - At least one band with ndet >= 20 (from magstat)\n--  - Corrected variability: g band (fid=1) delta > 1.0, r band (fid=2) delta > 0.5\n--  - Return: oid, feature value/name/version/feature_fid, meanra, meandec, ndet,\n--           magstat magmax_corr, magmin_corr, delta_mag, and magstat_fid\n WITH base AS\n  (SELECT DISTINCT o.oid,\n                   o.meanra,\n                   o.meandec,\n                   o.ndet\n   FROM OBJECT o\n   JOIN probability p ON p.oid = o.oid\n   WHERE p.class_name = 'AGN'\n     AND p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.probability > 0.6\n     AND o.deltajd >= 365.0 -- At least one band with >= 20 detections\n\n     AND EXISTS\n       (SELECT 1\n        FROM magstat ms\n        WHERE ms.oid = o.oid\n          AND ms.ndet >= 20 )-- g band corrected variability > 1.0 mag\n\n     AND EXISTS\n       (SELECT 1\n        FROM magstat mg\n        WHERE mg.oid = o.oid\n          AND mg.fid = 1\n          AND mg.corrected = TRUE\n          AND mg.magmax_corr IS NOT NULL\n          AND mg.magmin_corr IS NOT NULL\n          AND (mg.magmax_corr - mg.magmin_corr) > 1.0 )-- r band corrected variability > 0.5 mag\n\n     AND EXISTS\n       (SELECT 1\n        FROM magstat mr\n        WHERE mr.oid = o.oid\n          AND mr.fid = 2\n          AND mr.corrected = TRUE\n          AND mr.magmax_corr IS NOT NULL\n          AND mr.magmin_corr IS NOT NULL\n          AND (mr.magmax_corr - mr.magmin_corr) > 0.5))\nSELECT b.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid, -- feature table filter id\n b.meanra,\n b.meandec,\n b.ndet,\n m.magmax_corr,\n m.magmin_corr,\n (m.magmax_corr - m.magmin_corr) AS delta_mag,\n m.fid AS magstat_fid -- magstat table filter id\nFROM base b\nJOIN magstat m ON m.oid = b.oid\nAND m.corrected = TRUE\nAND m.fid IN (1,\n              2)-- return per-band (g, r) corrected magnitudes\nJOIN feature f ON f.oid = b.oid\nORDER BY b.oid ASC,\n         m.fid ASC,\n         f.name ASC;"
                },
                "in_toks": 6429,
                "out_toks": 3822,
                "id": "chatcmpl-CbGZtYPIVgcYTZJ2ZgmnaUwwrNep6",
                "created": 1762997897,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 5007,
                "out_toks": 1039,
                "id": "chatcmpl-CSxRXMsWiOQBqdOzbZUzonNSBjnuP",
                "created": 1761017719,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Objects classified as AGN with prob > 0.6 (default: ranking=1, classifier_name='lc_classifier')\nWITH P AS\n  (SELECT DISTINCT probability.oid\n   FROM probability\n   WHERE probability.class_name = 'AGN'\n     AND probability.classifier_name = 'lc_classifier'\n     AND probability.ranking = 1\n     AND probability.probability > 0.6), -- One-year light-curve coverage\nO1yr AS\n  (SELECT DISTINCT object.oid\n   FROM OBJECT\n   INNER JOIN P ON object.oid = P.oid\n   WHERE object.deltajd >= 365.0), -- At least one band with ndet >= 20\nB20 AS\n  (SELECT DISTINCT magstat.oid\n   FROM magstat\n   INNER JOIN P ON magstat.oid = P.oid\n   WHERE magstat.ndet >= 20), -- g-band corrected variability > 1 mag\nGvar AS\n  (SELECT DISTINCT magstat.oid\n   FROM magstat\n   INNER JOIN P ON magstat.oid = P.oid\n   WHERE magstat.fid = 1\n     AND magstat.corrected = TRUE\n     AND magstat.magmax_corr IS NOT NULL\n     AND magstat.magmin_corr IS NOT NULL\n     AND (magstat.magmax_corr - magstat.magmin_corr) > 1.0), -- r-band corrected variability > 0.5 mag\nRvar AS\n  (SELECT DISTINCT magstat.oid\n   FROM magstat\n   INNER JOIN P ON magstat.oid = P.oid\n   WHERE magstat.fid = 2\n     AND magstat.corrected = TRUE\n     AND magstat.magmax_corr IS NOT NULL\n     AND magstat.magmin_corr IS NOT NULL\n     AND (magstat.magmax_corr - magstat.magmin_corr) > 0.5), -- Oids meeting all criteria\nSelectedOids AS\n  (SELECT oid\n   FROM P INTERSECT SELECT oid\n   FROM O1yr INTERSECT SELECT oid\n   FROM B20 INTERSECT SELECT oid\n   FROM Gvar INTERSECT SELECT oid\n   FROM Rvar), -- Per-band (g,r) corrected max/min and delta_mag\nMout AS\n  (SELECT magstat.oid,\n          magstat.fid AS magstat_fid,\n          magstat.magmax_corr,\n          magstat.magmin_corr,\n          (magstat.magmax_corr - magstat.magmin_corr) AS delta_mag\n   FROM magstat\n   INNER JOIN SelectedOids S ON magstat.oid = S.oid\n   WHERE magstat.corrected = TRUE\n     AND magstat.fid IN (1,\n                         2)), -- Features for selected objects\nF AS\n  (SELECT feature.oid,\n          feature.value,\n          feature.name,\n          feature.version,\n          feature.fid AS feature_fid\n   FROM feature\n   INNER JOIN SelectedOids S ON feature.oid = S.oid), -- Object metadata\nOmeta AS\n  (SELECT object.oid,\n          object.meanra,\n          object.meandec,\n          object.ndet\n   FROM OBJECT\n   INNER JOIN SelectedOids S ON object.oid = S.oid) -- Final output\n\nSELECT o.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.feature_fid,\n       o.meanra,\n       o.meandec,\n       o.ndet,\n       m.magmax_corr,\n       m.magmin_corr,\n       m.delta_mag,\n       m.magstat_fid\nFROM Ometa o\nINNER JOIN Mout m ON m.oid = o.oid\nINNER JOIN F f ON f.oid = o.oid\nORDER BY o.oid ASC,\n         m.magstat_fid ASC,\n         f.name ASC;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Base probabilistic selection (CTE P)\n- Purpose: select only objects classified as AGN with high confidence using the default probability constraints.\n- Table: probability\n- Columns: probability.oid\n- Conditions:\n  - probability.class_name = 'AGN'\n  - probability.classifier_name = 'lc_classifier'  (default)\n  - probability.ranking = 1  (default)\n  - probability.probability > 0.6\n- Output: distinct list of oid\n\n2) One-year light-curve coverage constraint (CTE O1yr)\n- Purpose: enforce light-curve timespan \u2265 365 days at object level.\n- Tables: object INNER JOIN P ON object.oid = P.oid\n- Columns: object.oid\n- Conditions:\n  - object.deltajd >= 365.0\n- Output: distinct list of oid\n\n3) \u226520 detections in at least one band (CTE B20)\n- Purpose: ensure the object has at least one band with ndet \u2265 20 (per-band).\n- Tables: magstat INNER JOIN P ON magstat.oid = P.oid\n- Columns: magstat.oid\n- Conditions:\n  - magstat.ndet >= 20\n  - No restriction on magstat.fid (accept any available band: 1=g, 2=r, 3=i)\n- Output: distinct list of oid\n\n4) G-band variability constraint (CTE Gvar)\n- Purpose: ensure g-band corrected variability > 1 mag using corrected magnitudes.\n- Tables: magstat INNER JOIN P ON magstat.oid = P.oid\n- Columns: magstat.oid\n- Conditions:\n  - magstat.fid = 1  (g band)\n  - magstat.corrected = TRUE\n  - magstat.magmax_corr IS NOT NULL AND magstat.magmin_corr IS NOT NULL\n  - (magstat.magmax_corr - magstat.magmin_corr) > 1.0\n- Output: distinct list of oid\n\n5) R-band variability constraint (CTE Rvar)\n- Purpose: ensure r-band corrected variability > 0.5 mag using corrected magnitudes.\n- Tables: magstat INNER JOIN P ON magstat.oid = P.oid\n- Columns: magstat.oid\n- Conditions:\n  - magstat.fid = 2  (r band)\n  - magstat.corrected = TRUE\n  - magstat.magmax_corr IS NOT NULL AND magstat.magmin_corr IS NOT NULL\n  - (magstat.magmax_corr - magstat.magmin_corr) > 0.5\n- Output: distinct list of oid\n\n6) Combine all object-level filters (CTE SelectedOids)\n- Purpose: keep only oids meeting all criteria.\n- Operation: INTERSECT the oid sets\n  - SELECT oid FROM P\n  - INTERSECT SELECT oid FROM O1yr\n  - INTERSECT SELECT oid FROM B20\n  - INTERSECT SELECT oid FROM Gvar\n  - INTERSECT SELECT oid FROM Rvar\n- Output: distinct list of qualifying oid\n\n7) Prepare per-band magnitude output rows for g and r (CTE Mout)\n- Purpose: return corrected max/min magnitudes and per-band delta_mag for bands that passed the variability constraints (g and r).\n- Tables: magstat INNER JOIN SelectedOids S ON magstat.oid = S.oid\n- Columns to output:\n  - magstat.oid\n  - magstat.fid AS magstat_fid\n  - magstat.magmax_corr\n  - magstat.magmin_corr\n  - (magstat.magmax_corr - magstat.magmin_corr) AS delta_mag\n- Conditions:\n  - magstat.corrected = TRUE\n  - magstat.fid IN (1, 2)\n- To ensure both bands appear, use UNION ALL between:\n  - the subset with magstat.fid = 1\n  - the subset with magstat.fid = 2\n\n8) Gather all features for the selected objects (CTE F)\n- Purpose: include feature information for all features associated with the selected objects.\n- Tables: feature INNER JOIN SelectedOids S ON feature.oid = S.oid\n- Columns to output:\n  - feature.oid\n  - feature.value\n  - feature.name\n  - feature.version\n  - feature.fid AS feature_fid\n- Notes:\n  - No additional feature filtering is required; we are returning all features for the selected oids.\n  - The special multi-feature filtering procedure (UNION/INTERSECT across individual feature names) is not needed here because there are no feature-based selection conditions.\n\n9) Attach object-level metadata for output (CTE Ometa)\n- Purpose: provide mean coordinates and total number of detections for each selected object.\n- Tables: object INNER JOIN SelectedOids S ON object.oid = S.oid\n- Columns to output:\n  - object.oid\n  - object.meanra\n  - object.meandec\n  - object.ndet\n\n10) Final assembly of the output rows\n- Purpose: output the requested columns combining object metadata, per-band magnitude info (g and r), and feature rows.\n- Tables and joins:\n  - Ometa o\n  - INNER JOIN Mout m ON m.oid = o.oid\n  - INNER JOIN F f ON f.oid = o.oid\n- Columns to SELECT (with required aliases):\n  - o.oid\n  - f.value\n  - f.name\n  - f.version\n  - f.feature_fid  (feature.fid AS feature_fid)\n  - o.meanra\n  - o.meandec\n  - o.ndet\n  - m.magmax_corr\n  - m.magmin_corr\n  - m.delta_mag  ((magmax_corr - magmin_corr) AS delta_mag)\n  - m.magstat_fid  (magstat.fid AS magstat_fid)\n- Optional ORDER BY for readability:\n  - o.oid ASC, m.magstat_fid ASC, f.name ASC\n\n11) Index and performance considerations\n- probability filter uses:\n  - ix_classification_rank1 (ranking = 1)\n  - ix_probabilities_probability (probability)\n  - ix_probabilities_oid for joins\n- object join uses primary key on object.oid\n- magstat joins use ix_magstats_oid (hash on oid); filters on fid and corrected are selective\n- Keep projection minimal in early CTEs (only oid) to reduce data volume\n- Use DISTINCT in per-oid CTEs (P, O1yr, B20, Gvar, Rvar) if needed to avoid duplicates prior to INTERSECT\n\n12) Notes on correctness and requested details\n- Class names must be exact with single quotes: 'AGN', classifier_name 'lc_classifier'\n- \u201cLight curves covering at least one year\u201d enforced via object.deltajd >= 365.0\n- \u201cAt least 20 detections in at least one band\u201d enforced via magstat.ndet >= 20 for any fid\n- Variability criteria are applied on corrected magnitudes via magstat.magmax_corr and magstat.magmin_corr with magstat.corrected = TRUE\n- Filter id columns are explicitly aliased as:\n  - feature.fid AS feature_fid\n  - magstat.fid AS magstat_fid\n- Returned magnitudes are corrected ones (magmax_corr, magmin_corr), and delta_mag is computed as their difference\n- All requested columns are included: oid; feature value/name/version/fid; mean coordinates; total number of detections; max/min corrected magnitudes; delta_mag per band (g and r)"
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\n1) Base probabilistic selection (CTE P)\n- Purpose: select only objects classified as AGN with high confidence using the default probability constraints.\n- Table: probability\n- Columns: probability.oid\n- Conditions:\n  - probability.class_name = 'AGN'\n  - probability.classifier_name = 'lc_classifier'  (default)\n  - probability.ranking = 1  (default)\n  - probability.probability > 0.6\n- Output: distinct list of oid\n\n2) One-year light-curve coverage constraint (CTE O1yr)\n- Purpose: enforce light-curve timespan \u2265 365 days at object level.\n- Tables: object INNER JOIN P ON object.oid = P.oid\n- Columns: object.oid\n- Conditions:\n  - object.deltajd >= 365.0\n- Output: distinct list of oid\n\n3) \u226520 detections in at least one band (CTE B20)\n- Purpose: ensure the object has at least one band with ndet \u2265 20 (per-band).\n- Tables: magstat INNER JOIN P ON magstat.oid = P.oid\n- Columns: magstat.oid\n- Conditions:\n  - magstat.ndet >= 20\n  - No restriction on magstat.fid (accept any available band: 1=g, 2=r, 3=i)\n- Output: distinct list of oid\n\n4) G-band variability constraint (CTE Gvar)\n- Purpose: ensure g-band corrected variability > 1 mag using corrected magnitudes.\n- Tables: magstat INNER JOIN P ON magstat.oid = P.oid\n- Columns: magstat.oid\n- Conditions:\n  - magstat.fid = 1  (g band)\n  - magstat.corrected = TRUE\n  - magstat.magmax_corr IS NOT NULL AND magstat.magmin_corr IS NOT NULL\n  - (magstat.magmax_corr - magstat.magmin_corr) > 1.0\n- Output: distinct list of oid\n\n5) R-band variability constraint (CTE Rvar)\n- Purpose: ensure r-band corrected variability > 0.5 mag using corrected magnitudes.\n- Tables: magstat INNER JOIN P ON magstat.oid = P.oid\n- Columns: magstat.oid\n- Conditions:\n  - magstat.fid = 2  (r band)\n  - magstat.corrected = TRUE\n  - magstat.magmax_corr IS NOT NULL AND magstat.magmin_corr IS NOT NULL\n  - (magstat.magmax_corr - magstat.magmin_corr) > 0.5\n- Output: distinct list of oid\n\n6) Combine all object-level filters (CTE SelectedOids)\n- Purpose: keep only oids meeting all criteria.\n- Operation: INTERSECT the oid sets\n  - SELECT oid FROM P\n  - INTERSECT SELECT oid FROM O1yr\n  - INTERSECT SELECT oid FROM B20\n  - INTERSECT SELECT oid FROM Gvar\n  - INTERSECT SELECT oid FROM Rvar\n- Output: distinct list of qualifying oid\n\n7) Prepare per-band magnitude output rows for g and r (CTE Mout)\n- Purpose: return corrected max/min magnitudes and per-band delta_mag for bands that passed the variability constraints (g and r).\n- Tables: magstat INNER JOIN SelectedOids S ON magstat.oid = S.oid\n- Columns to output:\n  - magstat.oid\n  - magstat.fid AS magstat_fid\n  - magstat.magmax_corr\n  - magstat.magmin_corr\n  - (magstat.magmax_corr - magstat.magmin_corr) AS delta_mag\n- Conditions:\n  - magstat.corrected = TRUE\n  - magstat.fid IN (1, 2)\n- To ensure both bands appear, use UNION ALL between:\n  - the subset with magstat.fid = 1\n  - the subset with magstat.fid = 2\n\n8) Gather all features for the selected objects (CTE F)\n- Purpose: include feature information for all features associated with the selected objects.\n- Tables: feature INNER JOIN SelectedOids S ON feature.oid = S.oid\n- Columns to output:\n  - feature.oid\n  - feature.value\n  - feature.name\n  - feature.version\n  - feature.fid AS feature_fid\n- Notes:\n  - No additional feature filtering is required; we are returning all features for the selected oids.\n  - The special multi-feature filtering procedure (UNION/INTERSECT across individual feature names) is not needed here because there are no feature-based selection conditions.\n\n9) Attach object-level metadata for output (CTE Ometa)\n- Purpose: provide mean coordinates and total number of detections for each selected object.\n- Tables: object INNER JOIN SelectedOids S ON object.oid = S.oid\n- Columns to output:\n  - object.oid\n  - object.meanra\n  - object.meandec\n  - object.ndet\n\n10) Final assembly of the output rows\n- Purpose: output the requested columns combining object metadata, per-band magnitude info (g and r), and feature rows.\n- Tables and joins:\n  - Ometa o\n  - INNER JOIN Mout m ON m.oid = o.oid\n  - INNER JOIN F f ON f.oid = o.oid\n- Columns to SELECT (with required aliases):\n  - o.oid\n  - f.value\n  - f.name\n  - f.version\n  - f.feature_fid  (feature.fid AS feature_fid)\n  - o.meanra\n  - o.meandec\n  - o.ndet\n  - m.magmax_corr\n  - m.magmin_corr\n  - m.delta_mag  ((magmax_corr - magmin_corr) AS delta_mag)\n  - m.magstat_fid  (magstat.fid AS magstat_fid)\n- Optional ORDER BY for readability:\n  - o.oid ASC, m.magstat_fid ASC, f.name ASC\n\n11) Index and performance considerations\n- probability filter uses:\n  - ix_classification_rank1 (ranking = 1)\n  - ix_probabilities_probability (probability)\n  - ix_probabilities_oid for joins\n- object join uses primary key on object.oid\n- magstat joins use ix_magstats_oid (hash on oid); filters on fid and corrected are selective\n- Keep projection minimal in early CTEs (only oid) to reduce data volume\n- Use DISTINCT in per-oid CTEs (P, O1yr, B20, Gvar, Rvar) if needed to avoid duplicates prior to INTERSECT\n\n12) Notes on correctness and requested details\n- Class names must be exact with single quotes: 'AGN', classifier_name 'lc_classifier'\n- \u201cLight curves covering at least one year\u201d enforced via object.deltajd >= 365.0\n- \u201cAt least 20 detections in at least one band\u201d enforced via magstat.ndet >= 20 for any fid\n- Variability criteria are applied on corrected magnitudes via magstat.magmax_corr and magstat.magmin_corr with magstat.corrected = TRUE\n- Filter id columns are explicitly aliased as:\n  - feature.fid AS feature_fid\n  - magstat.fid AS magstat_fid\n- Returned magnitudes are corrected ones (magmax_corr, magmin_corr), and delta_mag is computed as their difference\n- All requested columns are included: oid; feature value/name/version/fid; mean coordinates; total number of detections; max/min corrected magnitudes; delta_mag per band (g and r)"
                    },
                    "in_toks": 6885,
                    "out_toks": 5983,
                    "id": "chatcmpl-Cb5VKXfm0gtSiKQXqYXXaR5Wy8Y8o",
                    "created": 1762955330,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Objects classified as AGN with prob > 0.6 (default: ranking=1, classifier_name='lc_classifier')\nWITH P AS\n  (SELECT DISTINCT probability.oid\n   FROM probability\n   WHERE probability.class_name = 'AGN'\n     AND probability.classifier_name = 'lc_classifier'\n     AND probability.ranking = 1\n     AND probability.probability > 0.6), -- One-year light-curve coverage\nO1yr AS\n  (SELECT DISTINCT object.oid\n   FROM OBJECT\n   INNER JOIN P ON object.oid = P.oid\n   WHERE object.deltajd >= 365.0), -- At least one band with ndet >= 20\nB20 AS\n  (SELECT DISTINCT magstat.oid\n   FROM magstat\n   INNER JOIN P ON magstat.oid = P.oid\n   WHERE magstat.ndet >= 20), -- g-band corrected variability > 1 mag\nGvar AS\n  (SELECT DISTINCT magstat.oid\n   FROM magstat\n   INNER JOIN P ON magstat.oid = P.oid\n   WHERE magstat.fid = 1\n     AND magstat.corrected = TRUE\n     AND magstat.magmax_corr IS NOT NULL\n     AND magstat.magmin_corr IS NOT NULL\n     AND (magstat.magmax_corr - magstat.magmin_corr) > 1.0), -- r-band corrected variability > 0.5 mag\nRvar AS\n  (SELECT DISTINCT magstat.oid\n   FROM magstat\n   INNER JOIN P ON magstat.oid = P.oid\n   WHERE magstat.fid = 2\n     AND magstat.corrected = TRUE\n     AND magstat.magmax_corr IS NOT NULL\n     AND magstat.magmin_corr IS NOT NULL\n     AND (magstat.magmax_corr - magstat.magmin_corr) > 0.5), -- Oids meeting all criteria\nSelectedOids AS\n  (SELECT oid\n   FROM P INTERSECT SELECT oid\n   FROM O1yr INTERSECT SELECT oid\n   FROM B20 INTERSECT SELECT oid\n   FROM Gvar INTERSECT SELECT oid\n   FROM Rvar), -- Per-band (g,r) corrected max/min and delta_mag\nMout AS\n  (SELECT magstat.oid,\n          magstat.fid AS magstat_fid,\n          magstat.magmax_corr,\n          magstat.magmin_corr,\n          (magstat.magmax_corr - magstat.magmin_corr) AS delta_mag\n   FROM magstat\n   INNER JOIN SelectedOids S ON magstat.oid = S.oid\n   WHERE magstat.corrected = TRUE\n     AND magstat.fid IN (1,\n                         2)), -- Features for selected objects\nF AS\n  (SELECT feature.oid,\n          feature.value,\n          feature.name,\n          feature.version,\n          feature.fid AS feature_fid\n   FROM feature\n   INNER JOIN SelectedOids S ON feature.oid = S.oid), -- Object metadata\nOmeta AS\n  (SELECT object.oid,\n          object.meanra,\n          object.meandec,\n          object.ndet\n   FROM OBJECT\n   INNER JOIN SelectedOids S ON object.oid = S.oid) -- Final output\n\nSELECT o.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.feature_fid,\n       o.meanra,\n       o.meandec,\n       o.ndet,\n       m.magmax_corr,\n       m.magmin_corr,\n       m.delta_mag,\n       m.magstat_fid\nFROM Ometa o\nINNER JOIN Mout m ON m.oid = o.oid\nINNER JOIN F f ON f.oid = o.oid\nORDER BY o.oid ASC,\n         m.magstat_fid ASC,\n         f.name ASC;"
                        },
                        "in_toks": 7168,
                        "out_toks": 3313,
                        "id": "chatcmpl-Cb5WfRAlz4amDqENKneZMx1hiPymN",
                        "created": 1762955413,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "5": {
            "req_id": "1",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection",
                "feature"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'detection', 'feature']"
                },
                "in_toks": 737,
                "out_toks": 2522,
                "id": "chatcmpl-CZMBeGibsTonPswHkVx4vcnXdhJ3V",
                "created": 1762542802,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query using early pruning and aggregated subqueries to avoid scanning detections repeatedly\nWITH -- 1) AGN candidates with required probability conditions (ranking=1 is mandatory)\np_agn AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.class_name = 'AGN'\n     AND p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.probability > 0.6), -- 2) Keep only objects with \u22651 year coverage\nobj_yr AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   INNER JOIN p_agn p ON p.oid = o.oid\n   WHERE o.deltajd >= 365), -- 3) Base corrected detections for pruned objects (single pass through detection)\ndet_corr AS\n  (SELECT d.oid,\n          d.fid,\n          d.magpsf_corr\n   FROM detection d\n   INNER JOIN obj_yr o ON o.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL), -- 4) Objects with \u226520 corrected detections in at least one band (any fid)\ndet_counts AS\n  (SELECT oid,\n          fid,\n          COUNT(*) AS cnt\n   FROM det_corr\n   GROUP BY oid,\n            fid),\n                                                                                                               det_20_any AS\n  (SELECT oid\n   FROM det_counts\n   GROUP BY oid\n   HAVING MAX(cnt) >= 20), -- 5) Per-band corrected mag stats for g/r bands only\ndet_stats_gr AS\n  (SELECT dc.oid,\n          dc.fid AS detection_fid,\n          MIN(dc.magpsf_corr) AS min_mag,\n          MAX(dc.magpsf_corr) AS max_mag,\n          MAX(dc.magpsf_corr) - MIN(dc.magpsf_corr) AS delta_mag\n   FROM det_corr dc\n   WHERE dc.fid IN (1,\n                    2)-- g=1, r=2\n\n   GROUP BY dc.oid,\n            dc.fid), -- 6) Objects satisfying variability thresholds in each band\ng_ok AS\n  (SELECT oid\n   FROM det_stats_gr\n   WHERE detection_fid = 1\n     AND delta_mag > 1.0),\n                                                                                 r_ok AS\n  (SELECT oid\n   FROM det_stats_gr\n   WHERE detection_fid = 2\n     AND delta_mag > 0.5), -- 7) Final OIDs that satisfy all constraints\nfinal_oids AS\n  (SELECT o.oid\n   FROM obj_yr o\n   INNER JOIN det_20_any d20 ON d20.oid = o.oid\n   INNER JOIN g_ok g ON g.oid = o.oid\n   INNER JOIN r_ok r ON r.oid = o.oid), -- 8) Features for the selected objects\nfeatures_all AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN final_oids fo ON fo.oid = f.oid), -- 9) Stats output only for selected objects (g/r bands)\nstats_out AS\n  (SELECT s.oid,\n          s.detection_fid,\n          s.min_mag,\n          s.max_mag,\n          s.delta_mag\n   FROM det_stats_gr s\n   INNER JOIN final_oids fo ON fo.oid = s.oid) -- Final output\n\nSELECT o.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.feature_fid,\n       o.meanra,\n       o.meandec,\n       o.ndet,\n       s.max_mag,\n       s.min_mag,\n       s.delta_mag,\n       s.detection_fid\nFROM final_oids fo\nINNER JOIN obj_yr o ON o.oid = fo.oid\nINNER JOIN features_all f ON f.oid = fo.oid\nINNER JOIN stats_out s ON s.oid = fo.oid\nORDER BY o.oid,\n         s.detection_fid,\n         f.name;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query using early pruning and aggregated subqueries to avoid scanning detections repeatedly\nWITH -- 1) AGN candidates with required probability conditions (ranking=1 is mandatory)\np_agn AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.class_name = 'AGN'\n     AND p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.probability > 0.6), -- 2) Keep only objects with \u22651 year coverage\nobj_yr AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   INNER JOIN p_agn p ON p.oid = o.oid\n   WHERE o.deltajd >= 365), -- 3) Base corrected detections for pruned objects (single pass through detection)\ndet_corr AS\n  (SELECT d.oid,\n          d.fid,\n          d.magpsf_corr\n   FROM detection d\n   INNER JOIN obj_yr o ON o.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL), -- 4) Objects with \u226520 corrected detections in at least one band (any fid)\ndet_counts AS\n  (SELECT oid,\n          fid,\n          COUNT(*) AS cnt\n   FROM det_corr\n   GROUP BY oid,\n            fid),\n                                                                                                               det_20_any AS\n  (SELECT oid\n   FROM det_counts\n   GROUP BY oid\n   HAVING MAX(cnt) >= 20), -- 5) Per-band corrected mag stats for g/r bands only\ndet_stats_gr AS\n  (SELECT dc.oid,\n          dc.fid AS detection_fid,\n          MIN(dc.magpsf_corr) AS min_mag,\n          MAX(dc.magpsf_corr) AS max_mag,\n          MAX(dc.magpsf_corr) - MIN(dc.magpsf_corr) AS delta_mag\n   FROM det_corr dc\n   WHERE dc.fid IN (1,\n                    2)-- g=1, r=2\n\n   GROUP BY dc.oid,\n            dc.fid), -- 6) Objects satisfying variability thresholds in each band\ng_ok AS\n  (SELECT oid\n   FROM det_stats_gr\n   WHERE detection_fid = 1\n     AND delta_mag > 1.0),\n                                                                                 r_ok AS\n  (SELECT oid\n   FROM det_stats_gr\n   WHERE detection_fid = 2\n     AND delta_mag > 0.5), -- 7) Final OIDs that satisfy all constraints\nfinal_oids AS\n  (SELECT o.oid\n   FROM obj_yr o\n   INNER JOIN det_20_any d20 ON d20.oid = o.oid\n   INNER JOIN g_ok g ON g.oid = o.oid\n   INNER JOIN r_ok r ON r.oid = o.oid), -- 8) Features for the selected objects\nfeatures_all AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN final_oids fo ON fo.oid = f.oid), -- 9) Stats output only for selected objects (g/r bands)\nstats_out AS\n  (SELECT s.oid,\n          s.detection_fid,\n          s.min_mag,\n          s.max_mag,\n          s.delta_mag\n   FROM det_stats_gr s\n   INNER JOIN final_oids fo ON fo.oid = s.oid) -- Final output\n\nSELECT o.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.feature_fid,\n       o.meanra,\n       o.meandec,\n       o.ndet,\n       s.max_mag,\n       s.min_mag,\n       s.delta_mag,\n       s.detection_fid\nFROM final_oids fo\nINNER JOIN obj_yr o ON o.oid = fo.oid\nINNER JOIN features_all f ON f.oid = fo.oid\nINNER JOIN stats_out s ON s.oid = fo.oid\nORDER BY o.oid,\n         s.detection_fid,\n         f.name;"
                },
                "in_toks": 5905,
                "out_toks": 3810,
                "id": "chatcmpl-CbGcckEC4y4a4ixVSAkZVedJ5K1pu",
                "created": 1762998066,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 4238,
                "out_toks": 1359,
                "id": "chatcmpl-CZYAQN38dIeba292pq4FptoxaAfIR",
                "created": 1762588854,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Objects classified as AGN (lc_classifier, rank 1) with probability > 0.6\n-- One-year coverage (deltajd >= 365)\n-- \u226520 corrected detections in at least one band\n-- Variability using corrected magnitudes: g (fid=1) delta_mag > 1.0, r (fid=2) delta_mag > 0.5\n-- Return: oid, feature.value/name/version and feature_fid, meanra, meandec, ndet,\n-- per-band max/min corrected magnitudes, delta_mag, and detection_fid\nWITH p_agn AS\n  (SELECT DISTINCT probability.oid\n   FROM probability\n   WHERE probability.class_name = 'AGN'\n     AND probability.classifier_name = 'lc_classifier'\n     AND probability.ranking = 1\n     AND probability.probability > 0.6),\n     obj_yr AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   INNER JOIN p_agn p ON p.oid = o.oid\n   WHERE o.deltajd >= 365),\n     det_stats_gr AS\n  (SELECT d.oid,\n          d.fid AS detection_fid,\n          MIN(d.magpsf_corr) AS min_mag_corr,\n          MAX(d.magpsf_corr) AS max_mag_corr,\n          MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS delta_mag\n   FROM detection d\n   INNER JOIN p_agn p ON p.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid IN (1,\n                   2)-- g and r bands\n\n   GROUP BY d.oid,\n            d.fid),\n     det_g_sel AS\n  (SELECT DISTINCT oid\n   FROM det_stats_gr\n   WHERE detection_fid = 1\n     AND delta_mag > 1.0),\n     det_r_sel AS\n  (SELECT DISTINCT oid\n   FROM det_stats_gr\n   WHERE detection_fid = 2\n     AND delta_mag > 0.5),\n     det_20_any AS\n  (SELECT DISTINCT d.oid\n   FROM detection d\n   INNER JOIN p_agn p ON p.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid,\n            d.fid\n   HAVING COUNT(*) >= 20),\n     final_oids AS (\n                      (SELECT o.oid\n                       FROM obj_yr o) INTERSECT\n                      (SELECT oid\n                       FROM det_g_sel) INTERSECT\n                      (SELECT oid\n                       FROM det_r_sel) INTERSECT\n                      (SELECT oid\n                       FROM det_20_any)),\n     features_all AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN final_oids fo ON fo.oid = f.oid),\n     stats_out AS\n  (SELECT s.oid,\n          s.detection_fid,\n          s.min_mag_corr AS min_mag,\n          s.max_mag_corr AS max_mag,\n          s.delta_mag\n   FROM det_stats_gr s\n   INNER JOIN final_oids fo ON fo.oid = s.oid)\nSELECT o.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.feature_fid,\n       o.meanra,\n       o.meandec,\n       o.ndet,\n       s.max_mag,\n       s.min_mag,\n       s.delta_mag,\n       s.detection_fid\nFROM final_oids fo\nINNER JOIN obj_yr o ON o.oid = fo.oid\nINNER JOIN features_all f ON f.oid = fo.oid\nINNER JOIN stats_out s ON s.oid = fo.oid\nORDER BY o.oid,\n         s.detection_fid,\n         f.name;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nRetrieve objects classified as AGN (most likely class from lc_classifier with probability > 0.6), whose light curves span \u2265 365 days, that have \u2265 20 corrected detections in at least one band, and that show corrected-magnitude variability > 1 mag in g (fid=1) and > 0.5 mag in r (fid=2). Return:\n- object.oid\n- feature.value, feature.name, feature.version, feature.fid (aliased as feature_fid)\n- object.meanra, object.meandec\n- object.ndet\n- per-band (g and r) max and min corrected magnitudes from detection.magpsf_corr\n- per-band variability as (max_mag_corr \u2212 min_mag_corr), aliased as delta_mag\n- include per-band id from detection as detection_fid\n\nImportant schema details and defaults to respect\n- probability default filters: probability.classifier_name = 'lc_classifier' AND probability.ranking = 1.\n- Use exact class_name 'AGN'.\n- Bands: fid = 1 (g), 2 (r), 3 (i).\n- Corrected magnitudes column in detection: detection.magpsf_corr; prefer rows where detection.corrected = TRUE and magpsf_corr IS NOT NULL.\n- Light-curve span: object.deltajd (in days).\n- \u201cAt least 20 detections in at least one band\u201d must be evaluated per oid, per fid using detection, but detection access should be constrained by oid first (use subquery of qualifying oids to leverage ix_ndetection_oid).\n- Feature table is transposed; here we are not filtering by feature conditions, only returning feature rows for qualifying oids, so the UNION/INTERSECT procedure for multiple feature filters is not required.\n\nStep-by-step subqueries and joins\n\n1) Probability filter (primary candidate set p_agn)\n- FROM probability\n- WHERE\n  - probability.class_name = 'AGN'\n  - probability.classifier_name = 'lc_classifier' (default)\n  - probability.ranking = 1 (default)\n  - probability.probability > 0.6\n- SELECT DISTINCT probability.oid\n- This is the seed list of oids.\n\n2) One-year coverage filter joined to objects (obj_yr)\n- FROM object o\n- INNER JOIN p_agn p ON p.oid = o.oid\n- WHERE o.deltajd >= 365\n- SELECT o.oid, o.meanra, o.meandec, o.ndet\n- This produces the set of oids with sufficient time baseline and also provides object-level columns needed in the output.\n\n3) Per-band corrected detection statistics (det_stats_gr)\n- FROM detection d\n- INNER JOIN p_agn p ON p.oid = d.oid\n- WHERE\n  - d.corrected = TRUE\n  - d.magpsf_corr IS NOT NULL\n  - d.fid IN (1, 2)  // g and r only since variability thresholds are defined for these bands\n- GROUP BY d.oid, d.fid\n- Compute per (oid, fid):\n  - min_mag_corr = MIN(d.magpsf_corr)\n  - max_mag_corr = MAX(d.magpsf_corr)\n  - delta_mag = MAX(d.magpsf_corr) - MIN(d.magpsf_corr)\n  - n_det_band = COUNT(*)  // can be useful but not explicitly requested in output\n- SELECT d.oid, d.fid AS detection_fid, min_mag_corr, max_mag_corr, delta_mag\n\n4) Variability filters per band using INTERSECT (det_g_sel and det_r_sel)\n- det_g_sel:\n  - FROM det_stats_gr\n  - WHERE detection_fid = 1 AND delta_mag > 1.0\n  - SELECT DISTINCT oid\n- det_r_sel:\n  - FROM det_stats_gr\n  - WHERE detection_fid = 2 AND delta_mag > 0.5\n  - SELECT DISTINCT oid\n- These are the oids satisfying variability thresholds in g and r, respectively.\n\n5) \u201cAt least 20 corrected detections in at least one band\u201d (det_20_any)\n- FROM detection d\n- INNER JOIN p_agn p ON p.oid = d.oid\n- WHERE\n  - d.corrected = TRUE\n  - d.magpsf_corr IS NOT NULL\n- GROUP BY d.oid, d.fid\n- HAVING COUNT(*) >= 20\n- SELECT DISTINCT d.oid\n- This yields the oids having \u2265 20 corrected detections in at least one band (any fid).\n\n6) Eligible oids set via INTERSECT (final_oids)\n- Start with oids from obj_yr (Step 2)\n- INTERSECT with det_g_sel (Step 4)\n- INTERSECT with det_r_sel (Step 4)\n- INTERSECT with det_20_any (Step 5)\n- SELECT DISTINCT oid\n- This produces the final set of oids that satisfy all constraints simultaneously.\n\n7) Prepare the features rows (features_all)\n- FROM feature f\n- INNER JOIN final_oids fo ON fo.oid = f.oid\n- SELECT f.oid, f.name, f.value, f.version, f.fid AS feature_fid\n- No additional filters on features since the request is to return these columns for qualifying objects.\n\n8) Prepare the per-band magnitude statistics for output (stats_out)\n- FROM det_stats_gr s\n- INNER JOIN final_oids fo ON fo.oid = s.oid\n- (s already restricted to fid IN (1, 2) and to corrected magnitudes)\n- SELECT s.oid, s.detection_fid, s.min_mag_corr AS min_mag, s.max_mag_corr AS max_mag, s.delta_mag\n\n9) Assemble the final result with JOINs\n- FROM final_oids fo\n- INNER JOIN object o ON o.oid = fo.oid  // to return meanra, meandec, ndet\n- INNER JOIN features_all f ON f.oid = fo.oid  // to return feature columns\n- INNER JOIN stats_out s ON s.oid = fo.oid  // to attach per-band magnitude stats (g and r)\n- SELECT columns:\n  - o.oid\n  - f.value\n  - f.name\n  - f.version\n  - f.feature_fid  // alias for feature.fid as requested\n  - o.meanra\n  - o.meandec\n  - o.ndet\n  - s.max_mag  // from detection.magpsf_corr aggregates\n  - s.min_mag  // from detection.magpsf_corr aggregates\n  - s.delta_mag  // (max_mag_corr \u2212 min_mag_corr), aliased exactly as delta_mag\n  - s.detection_fid  // alias for detection.fid as requested\n- Optional ORDER BY: o.oid, s.detection_fid, f.name\n\nOptimization and correctness notes\n- All detection-based subqueries (Steps 3, 4, 5) are constrained by joining to p_agn or final_oids, ensuring detection lookups are filtered by oid first (leveraging ix_ndetection_oid).\n- Use exact classifier and class names: 'lc_classifier' and 'AGN'.\n- Variability and detection-count constraints are enforced via INTERSECT of oid sets (Steps 4\u20136), ensuring both g and r thresholds are met and \u226520 corrected detections in at least one band.\n- Only corrected magnitudes (d.corrected = TRUE and d.magpsf_corr IS NOT NULL) are used to compute min/max and delta_mag as required.\n- The fid aliases are:\n  - feature fid as feature_fid\n  - detection fid (per-band magnitude stats) as detection_fid\n- No spatial filtering is needed (Q3C functions not used)."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nRetrieve objects classified as AGN (most likely class from lc_classifier with probability > 0.6), whose light curves span \u2265 365 days, that have \u2265 20 corrected detections in at least one band, and that show corrected-magnitude variability > 1 mag in g (fid=1) and > 0.5 mag in r (fid=2). Return:\n- object.oid\n- feature.value, feature.name, feature.version, feature.fid (aliased as feature_fid)\n- object.meanra, object.meandec\n- object.ndet\n- per-band (g and r) max and min corrected magnitudes from detection.magpsf_corr\n- per-band variability as (max_mag_corr \u2212 min_mag_corr), aliased as delta_mag\n- include per-band id from detection as detection_fid\n\nImportant schema details and defaults to respect\n- probability default filters: probability.classifier_name = 'lc_classifier' AND probability.ranking = 1.\n- Use exact class_name 'AGN'.\n- Bands: fid = 1 (g), 2 (r), 3 (i).\n- Corrected magnitudes column in detection: detection.magpsf_corr; prefer rows where detection.corrected = TRUE and magpsf_corr IS NOT NULL.\n- Light-curve span: object.deltajd (in days).\n- \u201cAt least 20 detections in at least one band\u201d must be evaluated per oid, per fid using detection, but detection access should be constrained by oid first (use subquery of qualifying oids to leverage ix_ndetection_oid).\n- Feature table is transposed; here we are not filtering by feature conditions, only returning feature rows for qualifying oids, so the UNION/INTERSECT procedure for multiple feature filters is not required.\n\nStep-by-step subqueries and joins\n\n1) Probability filter (primary candidate set p_agn)\n- FROM probability\n- WHERE\n  - probability.class_name = 'AGN'\n  - probability.classifier_name = 'lc_classifier' (default)\n  - probability.ranking = 1 (default)\n  - probability.probability > 0.6\n- SELECT DISTINCT probability.oid\n- This is the seed list of oids.\n\n2) One-year coverage filter joined to objects (obj_yr)\n- FROM object o\n- INNER JOIN p_agn p ON p.oid = o.oid\n- WHERE o.deltajd >= 365\n- SELECT o.oid, o.meanra, o.meandec, o.ndet\n- This produces the set of oids with sufficient time baseline and also provides object-level columns needed in the output.\n\n3) Per-band corrected detection statistics (det_stats_gr)\n- FROM detection d\n- INNER JOIN p_agn p ON p.oid = d.oid\n- WHERE\n  - d.corrected = TRUE\n  - d.magpsf_corr IS NOT NULL\n  - d.fid IN (1, 2)  // g and r only since variability thresholds are defined for these bands\n- GROUP BY d.oid, d.fid\n- Compute per (oid, fid):\n  - min_mag_corr = MIN(d.magpsf_corr)\n  - max_mag_corr = MAX(d.magpsf_corr)\n  - delta_mag = MAX(d.magpsf_corr) - MIN(d.magpsf_corr)\n  - n_det_band = COUNT(*)  // can be useful but not explicitly requested in output\n- SELECT d.oid, d.fid AS detection_fid, min_mag_corr, max_mag_corr, delta_mag\n\n4) Variability filters per band using INTERSECT (det_g_sel and det_r_sel)\n- det_g_sel:\n  - FROM det_stats_gr\n  - WHERE detection_fid = 1 AND delta_mag > 1.0\n  - SELECT DISTINCT oid\n- det_r_sel:\n  - FROM det_stats_gr\n  - WHERE detection_fid = 2 AND delta_mag > 0.5\n  - SELECT DISTINCT oid\n- These are the oids satisfying variability thresholds in g and r, respectively.\n\n5) \u201cAt least 20 corrected detections in at least one band\u201d (det_20_any)\n- FROM detection d\n- INNER JOIN p_agn p ON p.oid = d.oid\n- WHERE\n  - d.corrected = TRUE\n  - d.magpsf_corr IS NOT NULL\n- GROUP BY d.oid, d.fid\n- HAVING COUNT(*) >= 20\n- SELECT DISTINCT d.oid\n- This yields the oids having \u2265 20 corrected detections in at least one band (any fid).\n\n6) Eligible oids set via INTERSECT (final_oids)\n- Start with oids from obj_yr (Step 2)\n- INTERSECT with det_g_sel (Step 4)\n- INTERSECT with det_r_sel (Step 4)\n- INTERSECT with det_20_any (Step 5)\n- SELECT DISTINCT oid\n- This produces the final set of oids that satisfy all constraints simultaneously.\n\n7) Prepare the features rows (features_all)\n- FROM feature f\n- INNER JOIN final_oids fo ON fo.oid = f.oid\n- SELECT f.oid, f.name, f.value, f.version, f.fid AS feature_fid\n- No additional filters on features since the request is to return these columns for qualifying objects.\n\n8) Prepare the per-band magnitude statistics for output (stats_out)\n- FROM det_stats_gr s\n- INNER JOIN final_oids fo ON fo.oid = s.oid\n- (s already restricted to fid IN (1, 2) and to corrected magnitudes)\n- SELECT s.oid, s.detection_fid, s.min_mag_corr AS min_mag, s.max_mag_corr AS max_mag, s.delta_mag\n\n9) Assemble the final result with JOINs\n- FROM final_oids fo\n- INNER JOIN object o ON o.oid = fo.oid  // to return meanra, meandec, ndet\n- INNER JOIN features_all f ON f.oid = fo.oid  // to return feature columns\n- INNER JOIN stats_out s ON s.oid = fo.oid  // to attach per-band magnitude stats (g and r)\n- SELECT columns:\n  - o.oid\n  - f.value\n  - f.name\n  - f.version\n  - f.feature_fid  // alias for feature.fid as requested\n  - o.meanra\n  - o.meandec\n  - o.ndet\n  - s.max_mag  // from detection.magpsf_corr aggregates\n  - s.min_mag  // from detection.magpsf_corr aggregates\n  - s.delta_mag  // (max_mag_corr \u2212 min_mag_corr), aliased exactly as delta_mag\n  - s.detection_fid  // alias for detection.fid as requested\n- Optional ORDER BY: o.oid, s.detection_fid, f.name\n\nOptimization and correctness notes\n- All detection-based subqueries (Steps 3, 4, 5) are constrained by joining to p_agn or final_oids, ensuring detection lookups are filtered by oid first (leveraging ix_ndetection_oid).\n- Use exact classifier and class names: 'lc_classifier' and 'AGN'.\n- Variability and detection-count constraints are enforced via INTERSECT of oid sets (Steps 4\u20136), ensuring both g and r thresholds are met and \u226520 corrected detections in at least one band.\n- Only corrected magnitudes (d.corrected = TRUE and d.magpsf_corr IS NOT NULL) are used to compute min/max and delta_mag as required.\n- The fid aliases are:\n  - feature fid as feature_fid\n  - detection fid (per-band magnitude stats) as detection_fid\n- No spatial filtering is needed (Q3C functions not used)."
                    },
                    "in_toks": 6117,
                    "out_toks": 6842,
                    "id": "chatcmpl-Cb5XShroKjrRNWlOpROOtFE0JtyA7",
                    "created": 1762955462,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Objects classified as AGN (lc_classifier, rank 1) with probability > 0.6\n-- One-year coverage (deltajd >= 365)\n-- \u226520 corrected detections in at least one band\n-- Variability using corrected magnitudes: g (fid=1) delta_mag > 1.0, r (fid=2) delta_mag > 0.5\n-- Return: oid, feature.value/name/version and feature_fid, meanra, meandec, ndet,\n-- per-band max/min corrected magnitudes, delta_mag, and detection_fid\nWITH p_agn AS\n  (SELECT DISTINCT probability.oid\n   FROM probability\n   WHERE probability.class_name = 'AGN'\n     AND probability.classifier_name = 'lc_classifier'\n     AND probability.ranking = 1\n     AND probability.probability > 0.6),\n     obj_yr AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   INNER JOIN p_agn p ON p.oid = o.oid\n   WHERE o.deltajd >= 365),\n     det_stats_gr AS\n  (SELECT d.oid,\n          d.fid AS detection_fid,\n          MIN(d.magpsf_corr) AS min_mag_corr,\n          MAX(d.magpsf_corr) AS max_mag_corr,\n          MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS delta_mag\n   FROM detection d\n   INNER JOIN p_agn p ON p.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid IN (1,\n                   2)-- g and r bands\n\n   GROUP BY d.oid,\n            d.fid),\n     det_g_sel AS\n  (SELECT DISTINCT oid\n   FROM det_stats_gr\n   WHERE detection_fid = 1\n     AND delta_mag > 1.0),\n     det_r_sel AS\n  (SELECT DISTINCT oid\n   FROM det_stats_gr\n   WHERE detection_fid = 2\n     AND delta_mag > 0.5),\n     det_20_any AS\n  (SELECT DISTINCT d.oid\n   FROM detection d\n   INNER JOIN p_agn p ON p.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid,\n            d.fid\n   HAVING COUNT(*) >= 20),\n     final_oids AS (\n                      (SELECT o.oid\n                       FROM obj_yr o) INTERSECT\n                      (SELECT oid\n                       FROM det_g_sel) INTERSECT\n                      (SELECT oid\n                       FROM det_r_sel) INTERSECT\n                      (SELECT oid\n                       FROM det_20_any)),\n     features_all AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN final_oids fo ON fo.oid = f.oid),\n     stats_out AS\n  (SELECT s.oid,\n          s.detection_fid,\n          s.min_mag_corr AS min_mag,\n          s.max_mag_corr AS max_mag,\n          s.delta_mag\n   FROM det_stats_gr s\n   INNER JOIN final_oids fo ON fo.oid = s.oid)\nSELECT o.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.feature_fid,\n       o.meanra,\n       o.meandec,\n       o.ndet,\n       s.max_mag,\n       s.min_mag,\n       s.delta_mag,\n       s.detection_fid\nFROM final_oids fo\nINNER JOIN obj_yr o ON o.oid = fo.oid\nINNER JOIN features_all f ON f.oid = fo.oid\nINNER JOIN stats_out s ON s.oid = fo.oid\nORDER BY o.oid,\n         s.detection_fid,\n         f.name;"
                        },
                        "in_toks": 6426,
                        "out_toks": 3652,
                        "id": "chatcmpl-Cb5Zbi806mq6JYyEHd4kD22H56CxE",
                        "created": 1762955595,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "6": {
            "req_id": "1",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "feature",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'feature', 'detection']"
                },
                "in_toks": 737,
                "out_toks": 1498,
                "id": "chatcmpl-CZMCWkWRhu3fS96kMAKfq9MKAyIzr",
                "created": 1762542856,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "/* Optimized query: filter down early by classification, timespan, and per-band n_det;\n   then aggregate corrected magnitudes per band only for the remaining OIDs. */ WITH prob AS\n  (/* AGN objects from lc_classifier with ranking=1 and prob>0.6 */  SELECT p.oid\n   FROM probability p\n   WHERE p.class_name = 'AGN'\n     AND p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.probability > 0.6),\n                                                                                     obj AS\n  (/* One-year coverage (>=365 days) */  SELECT o.oid,\n                                                o.meanra,\n                                                o.meandec,\n                                                o.ndet,\n                                                o.deltajd\n   FROM OBJECT o\n   JOIN prob p ON p.oid = o.oid\n   WHERE o.deltajd >= 365),\n                                                                                     have_n AS\n  (/* At least one band with >=20 detections using feature 'n_det' (per-band) */  SELECT DISTINCT f.oid\n   FROM feature f\n   JOIN obj o ON o.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.value >= 20),\n                                                                                     det_agg AS\n  (/* Aggregate corrected magnitudes per OID across g and r in a single pass */  SELECT d.oid,\n                                                                                        MIN(CASE\n                                                                                                WHEN d.fid = 1 THEN d.magpsf_corr\n                                                                                            END) AS g_min_mag,\n                                                                                        MAX(CASE\n                                                                                                WHEN d.fid = 1 THEN d.magpsf_corr\n                                                                                            END) AS g_max_mag,\n                                                                                        (MAX(CASE\n                                                                                                 WHEN d.fid = 1 THEN d.magpsf_corr\n                                                                                             END) - MIN(CASE\n                                                                                                            WHEN d.fid = 1 THEN d.magpsf_corr\n                                                                                                        END)) AS g_delta_mag,\n                                                                                        MIN(CASE\n                                                                                                WHEN d.fid = 2 THEN d.magpsf_corr\n                                                                                            END) AS r_min_mag,\n                                                                                        MAX(CASE\n                                                                                                WHEN d.fid = 2 THEN d.magpsf_corr\n                                                                                            END) AS r_max_mag,\n                                                                                        (MAX(CASE\n                                                                                                 WHEN d.fid = 2 THEN d.magpsf_corr\n                                                                                             END) - MIN(CASE\n                                                                                                            WHEN d.fid = 2 THEN d.magpsf_corr\n                                                                                                        END)) AS r_delta_mag\n   FROM detection d\n   WHERE d.magpsf_corr IS NOT NULL\n     AND d.fid IN (1,\n                   2)\n     AND d.oid IN\n       (SELECT oid\n        FROM have_n)\n   GROUP BY d.oid\n   HAVING (MAX(CASE\n                   WHEN d.fid = 1 THEN d.magpsf_corr\n               END) - MIN(CASE\n                              WHEN d.fid = 1 THEN d.magpsf_corr\n                          END)) > 1.0\n   AND (MAX(CASE\n                WHEN d.fid = 2 THEN d.magpsf_corr\n            END) - MIN(CASE\n                           WHEN d.fid = 2 THEN d.magpsf_corr\n                       END)) > 0.5),\n                                                                                     bands AS\n  (/* Produce one row per qualifying OID per band (g and r) */  SELECT da.oid,\n                                                                       da.g_max_mag AS max_mag,\n                                                                       da.g_min_mag AS min_mag,\n                                                                       da.g_delta_mag AS delta_mag,\n                                                                       1 AS detection_fid\n   FROM det_agg da\n   UNION ALL SELECT da.oid,\n                    da.r_max_mag AS max_mag,\n                    da.r_min_mag AS min_mag,\n                    da.r_delta_mag AS delta_mag,\n                    2 AS detection_fid\n   FROM det_agg da)\nSELECT o.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid, -- feature table filter id\n o.meanra,\n o.meandec,\n o.ndet,\n b.max_mag,\n b.min_mag,\n b.delta_mag, -- (max_mag - min_mag)\n b.detection_fid -- detection table filter id\nFROM bands b\nJOIN obj o ON o.oid = b.oid\nJOIN feature f ON f.oid = b.oid\nAND f.fid = b.detection_fid\nWHERE f.fid IN (1,\n                2)-- only features for g and r bands\nORDER BY o.oid,\n         b.detection_fid,\n         f.name;",
            "sql_response": {
                "responses": {
                    "0": "/* Optimized query: filter down early by classification, timespan, and per-band n_det;\n   then aggregate corrected magnitudes per band only for the remaining OIDs. */ WITH prob AS\n  (/* AGN objects from lc_classifier with ranking=1 and prob>0.6 */  SELECT p.oid\n   FROM probability p\n   WHERE p.class_name = 'AGN'\n     AND p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.probability > 0.6),\n                                                                                     obj AS\n  (/* One-year coverage (>=365 days) */  SELECT o.oid,\n                                                o.meanra,\n                                                o.meandec,\n                                                o.ndet,\n                                                o.deltajd\n   FROM OBJECT o\n   JOIN prob p ON p.oid = o.oid\n   WHERE o.deltajd >= 365),\n                                                                                     have_n AS\n  (/* At least one band with >=20 detections using feature 'n_det' (per-band) */  SELECT DISTINCT f.oid\n   FROM feature f\n   JOIN obj o ON o.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.value >= 20),\n                                                                                     det_agg AS\n  (/* Aggregate corrected magnitudes per OID across g and r in a single pass */  SELECT d.oid,\n                                                                                        MIN(CASE\n                                                                                                WHEN d.fid = 1 THEN d.magpsf_corr\n                                                                                            END) AS g_min_mag,\n                                                                                        MAX(CASE\n                                                                                                WHEN d.fid = 1 THEN d.magpsf_corr\n                                                                                            END) AS g_max_mag,\n                                                                                        (MAX(CASE\n                                                                                                 WHEN d.fid = 1 THEN d.magpsf_corr\n                                                                                             END) - MIN(CASE\n                                                                                                            WHEN d.fid = 1 THEN d.magpsf_corr\n                                                                                                        END)) AS g_delta_mag,\n                                                                                        MIN(CASE\n                                                                                                WHEN d.fid = 2 THEN d.magpsf_corr\n                                                                                            END) AS r_min_mag,\n                                                                                        MAX(CASE\n                                                                                                WHEN d.fid = 2 THEN d.magpsf_corr\n                                                                                            END) AS r_max_mag,\n                                                                                        (MAX(CASE\n                                                                                                 WHEN d.fid = 2 THEN d.magpsf_corr\n                                                                                             END) - MIN(CASE\n                                                                                                            WHEN d.fid = 2 THEN d.magpsf_corr\n                                                                                                        END)) AS r_delta_mag\n   FROM detection d\n   WHERE d.magpsf_corr IS NOT NULL\n     AND d.fid IN (1,\n                   2)\n     AND d.oid IN\n       (SELECT oid\n        FROM have_n)\n   GROUP BY d.oid\n   HAVING (MAX(CASE\n                   WHEN d.fid = 1 THEN d.magpsf_corr\n               END) - MIN(CASE\n                              WHEN d.fid = 1 THEN d.magpsf_corr\n                          END)) > 1.0\n   AND (MAX(CASE\n                WHEN d.fid = 2 THEN d.magpsf_corr\n            END) - MIN(CASE\n                           WHEN d.fid = 2 THEN d.magpsf_corr\n                       END)) > 0.5),\n                                                                                     bands AS\n  (/* Produce one row per qualifying OID per band (g and r) */  SELECT da.oid,\n                                                                       da.g_max_mag AS max_mag,\n                                                                       da.g_min_mag AS min_mag,\n                                                                       da.g_delta_mag AS delta_mag,\n                                                                       1 AS detection_fid\n   FROM det_agg da\n   UNION ALL SELECT da.oid,\n                    da.r_max_mag AS max_mag,\n                    da.r_min_mag AS min_mag,\n                    da.r_delta_mag AS delta_mag,\n                    2 AS detection_fid\n   FROM det_agg da)\nSELECT o.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid, -- feature table filter id\n o.meanra,\n o.meandec,\n o.ndet,\n b.max_mag,\n b.min_mag,\n b.delta_mag, -- (max_mag - min_mag)\n b.detection_fid -- detection table filter id\nFROM bands b\nJOIN obj o ON o.oid = b.oid\nJOIN feature f ON f.oid = b.oid\nAND f.fid = b.detection_fid\nWHERE f.fid IN (1,\n                2)-- only features for g and r bands\nORDER BY o.oid,\n         b.detection_fid,\n         f.name;"
                },
                "in_toks": 6103,
                "out_toks": 3977,
                "id": "chatcmpl-CbGfPCBOnno4lXpyCOf4CZEIArKeh",
                "created": 1762998239,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 4239,
                "out_toks": 1487,
                "id": "chatcmpl-CZYBFlqNzEj0gaJjI3NJX2Oqz6dQK",
                "created": 1762588905,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "/* Objects classified as AGN (lc_classifier, ranking=1) with prob>0.6, deltajd>=365, >=20 detections in any band, and corrected mag variations >1.0 in g and >0.5 in r. */ WITH P AS\n  (SELECT probability.oid\n   FROM probability\n   WHERE probability.class_name = 'AGN'\n     AND probability.classifier_name = 'lc_classifier'\n     AND probability.ranking = 1\n     AND probability.probability > 0.6),\n                                                                                                                                                                                O AS\n  (SELECT object.oid,\n          object.meanra,\n          object.meandec,\n          object.ndet,\n          object.deltajd\n   FROM OBJECT\n   INNER JOIN P ON P.oid = object.oid\n   WHERE object.deltajd >= 365),\n                                                                                                                                                                                F_n_det AS\n  (/* At least one band with >= 20 detections using feature 'n_det' */  SELECT DISTINCT feature.oid\n   FROM feature\n   INNER JOIN O ON O.oid = feature.oid\n   WHERE feature.name = 'n_det'\n     AND feature.value >= 20),\n                                                                                                                                                                                C AS\n  (/* Candidate OIDs satisfying classification, time-span, and >=20 detections in any band */  SELECT DISTINCT O.oid\n   FROM O\n   INNER JOIN F_n_det ON F_n_det.oid = O.oid),\n                                                                                                                                                                                D_g AS\n  (/* Per-oid corrected magnitude extremes in g band (fid=1) with variation > 1.0 */  SELECT detection.oid,\n                                                                                             MIN(detection.magpsf_corr) AS min_mag,\n                                                                                             MAX(detection.magpsf_corr) AS max_mag,\n                                                                                             (MAX(detection.magpsf_corr) - MIN(detection.magpsf_corr)) AS delta_mag,\n                                                                                             1 AS detection_fid\n   FROM detection\n   INNER JOIN C ON C.oid = detection.oid\n   WHERE detection.fid = 1\n     AND detection.magpsf_corr IS NOT NULL\n   GROUP BY detection.oid\n   HAVING (MAX(detection.magpsf_corr) - MIN(detection.magpsf_corr)) > 1.0),\n                                                                                                                                                                                D_r AS\n  (/* Per-oid corrected magnitude extremes in r band (fid=2) with variation > 0.5 */  SELECT detection.oid,\n                                                                                             MIN(detection.magpsf_corr) AS min_mag,\n                                                                                             MAX(detection.magpsf_corr) AS max_mag,\n                                                                                             (MAX(detection.magpsf_corr) - MIN(detection.magpsf_corr)) AS delta_mag,\n                                                                                             2 AS detection_fid\n   FROM detection\n   INNER JOIN C ON C.oid = detection.oid\n   WHERE detection.fid = 2\n     AND detection.magpsf_corr IS NOT NULL\n   GROUP BY detection.oid\n   HAVING (MAX(detection.magpsf_corr) - MIN(detection.magpsf_corr)) > 0.5),\n                                                                                                                                                                                Oids_both AS\n  (/* Require both g and r variability thresholds */  SELECT oid\n   FROM D_g INTERSECT SELECT oid\n   FROM D_r),\n                                                                                                                                                                                U_bands AS\n  (/* Two rows per qualifying object: one for g, one for r */  SELECT D_g.oid,\n                                                                      D_g.min_mag,\n                                                                      D_g.max_mag,\n                                                                      D_g.delta_mag,\n                                                                      D_g.detection_fid\n   FROM D_g\n   WHERE D_g.oid IN\n       (SELECT oid\n        FROM Oids_both)\n   UNION ALL SELECT D_r.oid,\n                    D_r.min_mag,\n                    D_r.max_mag,\n                    D_r.delta_mag,\n                    D_r.detection_fid\n   FROM D_r\n   WHERE D_r.oid IN\n       (SELECT oid\n        FROM Oids_both))\nSELECT O.oid,\n       feature.value,\n       feature.name,\n       feature.version,\n       feature.fid AS feature_fid,\n       O.meanra,\n       O.meandec,\n       O.ndet,\n       U_bands.max_mag,\n       U_bands.min_mag,\n       U_bands.delta_mag,\n       U_bands.detection_fid\nFROM U_bands\nINNER JOIN O ON O.oid = U_bands.oid\nINNER JOIN feature ON feature.oid = U_bands.oid\nAND feature.fid = U_bands.detection_fid\nORDER BY O.oid,\n         U_bands.detection_fid,\n         feature.name;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query for the ALeRCE database\n\nGoal: Retrieve all objects:\n- Classified as 'AGN' by the light-curve classifier with probability > 0.6 (and default ranking=1).\n- With light-curve time-span \u2265 365 days.\n- With at least one band having \u2265 20 detections.\n- With corrected magnitude variations: \u0394mag_g > 1.0 (fid=1) and \u0394mag_r > 0.5 (fid=2), computed from corrected photometry (detection.magpsf_corr).\nReturn, per qualifying object and per band row (g and r), the following:\n- object.oid\n- feature.value, feature.name, feature.version, feature.fid (aliased as feature_fid)\n- object.meanra, object.meandec\n- object.ndet\n- per-band maximum and minimum corrected magnitudes from detections (aliased as max_mag and min_mag)\n- per-band variation delta_mag = max_mag - min_mag (aliased as delta_mag)\n- per-band fid from detections (aliased as detection_fid)\nUse required JOINs, UNIONs, and INTERSECTs. Avoid filtering on detection beyond oid except where strictly needed for band aggregation.\n\nStep-by-step plan\n\n1) Base classification filter (probability table)\n- Build a subquery P to select AGN-like objects with:\n  - probability.class_name = 'AGN'\n  - probability.classifier_name = 'lc_classifier' (default condition)\n  - probability.ranking = 1 (default condition)\n  - probability.probability > 0.6\n- Columns: P.oid\n- Indexes leveraged: ix_probabilities_oid (hash on oid), ix_probabilities_probability, ix_classification_rank1.\n\n2) Join with object and apply time-span constraint\n- Join P with object O on O.oid = P.oid to ensure object-level constraints:\n  - O.deltajd >= 365 (one-year coverage in days)\n- Columns to carry forward for final output:\n  - O.oid, O.meanra, O.meandec, O.ndet\n- Indexes: ix_object_ndet, ix_object_firstmjd, ix_object_g_r_mean_corr are present but main filter is deltajd; no dedicated index, but the join reduces cardinality.\n\n3) Ensure \u201c\u2265 20 detections in at least one band\u201d using feature table\n- Use feature table to avoid heavy detection scans:\n  - Create subquery F_n_det selecting features with:\n    - feature.oid IN (P joined with O) via INNER JOIN to restrict to candidate oids\n    - feature.name = 'n_det'\n    - feature.value >= 20\n  - This returns rows per oid, fid where the band has \u2265 20 detections.\n- The existence of at least one such row per oid satisfies the requirement. Retain distinct oids from F_n_det as SufficientDet OIDs.\n- Keep also feature rows for final output join (value, name, version, fid) but do not yet expand; we will re-join features later on the final band rows.\n- Index: ix_feature_oid_2 (hash on oid).\n\n4) Candidate objects after detection count filter\n- Define C as DISTINCT oid set from the intersection of steps 2 and 3:\n  - C = SELECT DISTINCT O.oid from O INNER JOIN F_n_det on O.oid = F_n_det.oid\n- This ensures:\n  - Classified as AGN with required probability/ranking/classifier\n  - One-year coverage\n  - At least one band with \u2265 20 detections\n\n5) Compute corrected per-band magnitude extremes for g (fid=1)\n- Build subquery D_g on detection:\n  - Join detection d with C on d.oid = C.oid (this limits rows early)\n  - Constraints:\n    - d.fid = 1 (g band)\n    - d.magpsf_corr IS NOT NULL\n    - Optionally d.corrected = TRUE (to strictly enforce corrected photometry; if magpsf_corr is non-null, this is satisfied, but include it for clarity)\n  - Group by d.oid\n  - Compute:\n    - min_mag_g = MIN(d.magpsf_corr)\n    - max_mag_g = MAX(d.magpsf_corr)\n    - delta_mag_g = MAX(d.magpsf_corr) - MIN(d.magpsf_corr)\n  - HAVING delta_mag_g > 1.0\n  - Output columns: oid, min_mag_g, max_mag_g, delta_mag_g, and literal 1 as detection_fid\n- Index: ix_ndetection_oid (hash on oid) supports the restricted join by oid efficiently.\n\n6) Compute corrected per-band magnitude extremes for r (fid=2)\n- Build subquery D_r analogously:\n  - Join detection d with C on d.oid = C.oid\n  - Constraints:\n    - d.fid = 2 (r band)\n    - d.magpsf_corr IS NOT NULL\n    - Optionally d.corrected = TRUE\n  - Group by d.oid\n  - Compute:\n    - min_mag_r = MIN(d.magpsf_corr)\n    - max_mag_r = MAX(d.magpsf_corr)\n    - delta_mag_r = MAX(d.magpsf_corr) - MIN(d.magpsf_corr)\n  - HAVING delta_mag_r > 0.5\n  - Output columns: oid, min_mag_r, max_mag_r, delta_mag_r, and literal 2 as detection_fid\n\n7) Enforce simultaneous g and r variability via INTERSECT\n- Create Oids_both as:\n  - SELECT oid FROM D_g\n  - INTERSECT\n  - SELECT oid FROM D_r\n- This ensures only objects satisfying both band thresholds are kept.\n\n8) Build per-band output rows via UNION ALL\n- Create U_bands as the per-band row set limited to oids in Oids_both:\n  - From D_g (restricted to oid IN Oids_both), project:\n    - oid\n    - min_mag = min_mag_g\n    - max_mag = max_mag_g\n    - delta_mag = delta_mag_g\n    - detection_fid = 1\n  - UNION ALL\n  - From D_r (restricted to oid IN Oids_both), project:\n    - oid\n    - min_mag = min_mag_r\n    - max_mag = max_mag_r\n    - delta_mag = delta_mag_r\n    - detection_fid = 2\n- This produces two rows per qualifying object (one per band), with the per-band corrected min/max and delta.\n\n9) Join with object/probability and restrict to final oid set\n- Join U_bands with:\n  - O (from step 2) on oid\n  - Ensure oid is in Oids_both (already enforced by U_bands source)\n  - This passes through the object columns for final output:\n    - O.oid, O.meanra, O.meandec, O.ndet\n\n10) Join features for requested feature columns, aligned by band\n- To return feature.value, feature.name, feature.version, and feature fid as feature_fid:\n  - INNER JOIN feature f on:\n    - f.oid = U_bands.oid\n    - f.fid = U_bands.detection_fid\n  - This restricts features to the same band as the per-band row (reduces explosive row counts and aligns with band-specific output).\n- Columns selected from feature:\n  - f.value\n  - f.name\n  - f.version\n  - f.fid AS feature_fid\n- Note: This join returns all features for the object in that band. If you want to restrict to specific features (e.g., only 'n_det'), add f.name IN ('n_det') in this join; otherwise, leave unrestricted as per the user\u2019s request to return \u201cthe value, name, version and filter id from the features.\u201d\n\n11) Final selection and column aliases\n- Output columns:\n  - O.oid\n  - f.value, f.name, f.version, f.fid AS feature_fid\n  - O.meanra, O.meandec\n  - O.ndet\n  - U_bands.max_mag (corrected; from detection.magpsf_corr), alias as max_mag\n  - U_bands.min_mag (corrected; from detection.magpsf_corr), alias as min_mag\n  - U_bands.delta_mag (corrected), alias exactly as delta_mag\n  - U_bands.detection_fid AS detection_fid\n- Ensure aliases match the requirement for fid columns: feature_fid and detection_fid.\n\n12) Optional deduplication/ordering\n- If needed, add ORDER BY O.oid, detection_fid, f.name for stable presentation.\n- Do not DISTINCT unless necessary, as feature rows are inherently multiple per object/band.\n\n13) Summary of logical flow with required SQL constructs\n- JOINs:\n  - P (probability) INNER JOIN O (object)\n  - O INNER JOIN F_n_det (feature filtered to 'n_det' >= 20)\n  - C (distinct oids) JOIN detection for D_g and D_r\n  - U_bands JOIN O and JOIN feature f (by oid and matching band)\n- INTERSECT:\n  - Between oids from D_g and D_r (Oids_both) to enforce both-band variability\n- UNION ALL:\n  - Combine per-band rows from D_g and D_r into U_bands\n- Nested subqueries/CTEs:\n  - P, O, F_n_det, C, D_g, D_r, Oids_both, U_bands\n\n14) Constraints recap to embed exactly\n- probability.class_name = 'AGN'\n- probability.classifier_name = 'lc_classifier'\n- probability.ranking = 1\n- probability.probability > 0.6\n- object.deltajd >= 365\n- feature.name = 'n_det' AND feature.value >= 20 (exists for at least one fid)\n- detection constraints for corrected magnitudes:\n  - d.fid = 1 for g (D_g), d.fid = 2 for r (D_r)\n  - d.magpsf_corr IS NOT NULL\n  - Optional: d.corrected = TRUE\n  - Group by oid; compute MIN/MAX on magpsf_corr\n  - HAVING (MAX - MIN) > 1.0 (g) and > 0.5 (r)\n- Final join to feature for output restricted by f.oid = U_bands.oid and f.fid = U_bands.detection_fid\n- Aliases for fid columns:\n  - detection_fid for detection fid\n  - feature_fid for feature fid\n\nThis plan yields the required object set and returns, per object and per band (g and r), the requested columns with corrected photometric extrema and their difference (delta_mag), plus the specified feature metadata."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query for the ALeRCE database\n\nGoal: Retrieve all objects:\n- Classified as 'AGN' by the light-curve classifier with probability > 0.6 (and default ranking=1).\n- With light-curve time-span \u2265 365 days.\n- With at least one band having \u2265 20 detections.\n- With corrected magnitude variations: \u0394mag_g > 1.0 (fid=1) and \u0394mag_r > 0.5 (fid=2), computed from corrected photometry (detection.magpsf_corr).\nReturn, per qualifying object and per band row (g and r), the following:\n- object.oid\n- feature.value, feature.name, feature.version, feature.fid (aliased as feature_fid)\n- object.meanra, object.meandec\n- object.ndet\n- per-band maximum and minimum corrected magnitudes from detections (aliased as max_mag and min_mag)\n- per-band variation delta_mag = max_mag - min_mag (aliased as delta_mag)\n- per-band fid from detections (aliased as detection_fid)\nUse required JOINs, UNIONs, and INTERSECTs. Avoid filtering on detection beyond oid except where strictly needed for band aggregation.\n\nStep-by-step plan\n\n1) Base classification filter (probability table)\n- Build a subquery P to select AGN-like objects with:\n  - probability.class_name = 'AGN'\n  - probability.classifier_name = 'lc_classifier' (default condition)\n  - probability.ranking = 1 (default condition)\n  - probability.probability > 0.6\n- Columns: P.oid\n- Indexes leveraged: ix_probabilities_oid (hash on oid), ix_probabilities_probability, ix_classification_rank1.\n\n2) Join with object and apply time-span constraint\n- Join P with object O on O.oid = P.oid to ensure object-level constraints:\n  - O.deltajd >= 365 (one-year coverage in days)\n- Columns to carry forward for final output:\n  - O.oid, O.meanra, O.meandec, O.ndet\n- Indexes: ix_object_ndet, ix_object_firstmjd, ix_object_g_r_mean_corr are present but main filter is deltajd; no dedicated index, but the join reduces cardinality.\n\n3) Ensure \u201c\u2265 20 detections in at least one band\u201d using feature table\n- Use feature table to avoid heavy detection scans:\n  - Create subquery F_n_det selecting features with:\n    - feature.oid IN (P joined with O) via INNER JOIN to restrict to candidate oids\n    - feature.name = 'n_det'\n    - feature.value >= 20\n  - This returns rows per oid, fid where the band has \u2265 20 detections.\n- The existence of at least one such row per oid satisfies the requirement. Retain distinct oids from F_n_det as SufficientDet OIDs.\n- Keep also feature rows for final output join (value, name, version, fid) but do not yet expand; we will re-join features later on the final band rows.\n- Index: ix_feature_oid_2 (hash on oid).\n\n4) Candidate objects after detection count filter\n- Define C as DISTINCT oid set from the intersection of steps 2 and 3:\n  - C = SELECT DISTINCT O.oid from O INNER JOIN F_n_det on O.oid = F_n_det.oid\n- This ensures:\n  - Classified as AGN with required probability/ranking/classifier\n  - One-year coverage\n  - At least one band with \u2265 20 detections\n\n5) Compute corrected per-band magnitude extremes for g (fid=1)\n- Build subquery D_g on detection:\n  - Join detection d with C on d.oid = C.oid (this limits rows early)\n  - Constraints:\n    - d.fid = 1 (g band)\n    - d.magpsf_corr IS NOT NULL\n    - Optionally d.corrected = TRUE (to strictly enforce corrected photometry; if magpsf_corr is non-null, this is satisfied, but include it for clarity)\n  - Group by d.oid\n  - Compute:\n    - min_mag_g = MIN(d.magpsf_corr)\n    - max_mag_g = MAX(d.magpsf_corr)\n    - delta_mag_g = MAX(d.magpsf_corr) - MIN(d.magpsf_corr)\n  - HAVING delta_mag_g > 1.0\n  - Output columns: oid, min_mag_g, max_mag_g, delta_mag_g, and literal 1 as detection_fid\n- Index: ix_ndetection_oid (hash on oid) supports the restricted join by oid efficiently.\n\n6) Compute corrected per-band magnitude extremes for r (fid=2)\n- Build subquery D_r analogously:\n  - Join detection d with C on d.oid = C.oid\n  - Constraints:\n    - d.fid = 2 (r band)\n    - d.magpsf_corr IS NOT NULL\n    - Optionally d.corrected = TRUE\n  - Group by d.oid\n  - Compute:\n    - min_mag_r = MIN(d.magpsf_corr)\n    - max_mag_r = MAX(d.magpsf_corr)\n    - delta_mag_r = MAX(d.magpsf_corr) - MIN(d.magpsf_corr)\n  - HAVING delta_mag_r > 0.5\n  - Output columns: oid, min_mag_r, max_mag_r, delta_mag_r, and literal 2 as detection_fid\n\n7) Enforce simultaneous g and r variability via INTERSECT\n- Create Oids_both as:\n  - SELECT oid FROM D_g\n  - INTERSECT\n  - SELECT oid FROM D_r\n- This ensures only objects satisfying both band thresholds are kept.\n\n8) Build per-band output rows via UNION ALL\n- Create U_bands as the per-band row set limited to oids in Oids_both:\n  - From D_g (restricted to oid IN Oids_both), project:\n    - oid\n    - min_mag = min_mag_g\n    - max_mag = max_mag_g\n    - delta_mag = delta_mag_g\n    - detection_fid = 1\n  - UNION ALL\n  - From D_r (restricted to oid IN Oids_both), project:\n    - oid\n    - min_mag = min_mag_r\n    - max_mag = max_mag_r\n    - delta_mag = delta_mag_r\n    - detection_fid = 2\n- This produces two rows per qualifying object (one per band), with the per-band corrected min/max and delta.\n\n9) Join with object/probability and restrict to final oid set\n- Join U_bands with:\n  - O (from step 2) on oid\n  - Ensure oid is in Oids_both (already enforced by U_bands source)\n  - This passes through the object columns for final output:\n    - O.oid, O.meanra, O.meandec, O.ndet\n\n10) Join features for requested feature columns, aligned by band\n- To return feature.value, feature.name, feature.version, and feature fid as feature_fid:\n  - INNER JOIN feature f on:\n    - f.oid = U_bands.oid\n    - f.fid = U_bands.detection_fid\n  - This restricts features to the same band as the per-band row (reduces explosive row counts and aligns with band-specific output).\n- Columns selected from feature:\n  - f.value\n  - f.name\n  - f.version\n  - f.fid AS feature_fid\n- Note: This join returns all features for the object in that band. If you want to restrict to specific features (e.g., only 'n_det'), add f.name IN ('n_det') in this join; otherwise, leave unrestricted as per the user\u2019s request to return \u201cthe value, name, version and filter id from the features.\u201d\n\n11) Final selection and column aliases\n- Output columns:\n  - O.oid\n  - f.value, f.name, f.version, f.fid AS feature_fid\n  - O.meanra, O.meandec\n  - O.ndet\n  - U_bands.max_mag (corrected; from detection.magpsf_corr), alias as max_mag\n  - U_bands.min_mag (corrected; from detection.magpsf_corr), alias as min_mag\n  - U_bands.delta_mag (corrected), alias exactly as delta_mag\n  - U_bands.detection_fid AS detection_fid\n- Ensure aliases match the requirement for fid columns: feature_fid and detection_fid.\n\n12) Optional deduplication/ordering\n- If needed, add ORDER BY O.oid, detection_fid, f.name for stable presentation.\n- Do not DISTINCT unless necessary, as feature rows are inherently multiple per object/band.\n\n13) Summary of logical flow with required SQL constructs\n- JOINs:\n  - P (probability) INNER JOIN O (object)\n  - O INNER JOIN F_n_det (feature filtered to 'n_det' >= 20)\n  - C (distinct oids) JOIN detection for D_g and D_r\n  - U_bands JOIN O and JOIN feature f (by oid and matching band)\n- INTERSECT:\n  - Between oids from D_g and D_r (Oids_both) to enforce both-band variability\n- UNION ALL:\n  - Combine per-band rows from D_g and D_r into U_bands\n- Nested subqueries/CTEs:\n  - P, O, F_n_det, C, D_g, D_r, Oids_both, U_bands\n\n14) Constraints recap to embed exactly\n- probability.class_name = 'AGN'\n- probability.classifier_name = 'lc_classifier'\n- probability.ranking = 1\n- probability.probability > 0.6\n- object.deltajd >= 365\n- feature.name = 'n_det' AND feature.value >= 20 (exists for at least one fid)\n- detection constraints for corrected magnitudes:\n  - d.fid = 1 for g (D_g), d.fid = 2 for r (D_r)\n  - d.magpsf_corr IS NOT NULL\n  - Optional: d.corrected = TRUE\n  - Group by oid; compute MIN/MAX on magpsf_corr\n  - HAVING (MAX - MIN) > 1.0 (g) and > 0.5 (r)\n- Final join to feature for output restricted by f.oid = U_bands.oid and f.fid = U_bands.detection_fid\n- Aliases for fid columns:\n  - detection_fid for detection fid\n  - feature_fid for feature fid\n\nThis plan yields the required object set and returns, per object and per band (g and r), the requested columns with corrected photometric extrema and their difference (delta_mag), plus the specified feature metadata."
                    },
                    "in_toks": 6117,
                    "out_toks": 7630,
                    "id": "chatcmpl-Cb5aVKwQcFu1ZQaNdzRMM6rQ7nA92",
                    "created": 1762955651,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "/* Objects classified as AGN (lc_classifier, ranking=1) with prob>0.6, deltajd>=365, >=20 detections in any band, and corrected mag variations >1.0 in g and >0.5 in r. */ WITH P AS\n  (SELECT probability.oid\n   FROM probability\n   WHERE probability.class_name = 'AGN'\n     AND probability.classifier_name = 'lc_classifier'\n     AND probability.ranking = 1\n     AND probability.probability > 0.6),\n                                                                                                                                                                                O AS\n  (SELECT object.oid,\n          object.meanra,\n          object.meandec,\n          object.ndet,\n          object.deltajd\n   FROM OBJECT\n   INNER JOIN P ON P.oid = object.oid\n   WHERE object.deltajd >= 365),\n                                                                                                                                                                                F_n_det AS\n  (/* At least one band with >= 20 detections using feature 'n_det' */  SELECT DISTINCT feature.oid\n   FROM feature\n   INNER JOIN O ON O.oid = feature.oid\n   WHERE feature.name = 'n_det'\n     AND feature.value >= 20),\n                                                                                                                                                                                C AS\n  (/* Candidate OIDs satisfying classification, time-span, and >=20 detections in any band */  SELECT DISTINCT O.oid\n   FROM O\n   INNER JOIN F_n_det ON F_n_det.oid = O.oid),\n                                                                                                                                                                                D_g AS\n  (/* Per-oid corrected magnitude extremes in g band (fid=1) with variation > 1.0 */  SELECT detection.oid,\n                                                                                             MIN(detection.magpsf_corr) AS min_mag,\n                                                                                             MAX(detection.magpsf_corr) AS max_mag,\n                                                                                             (MAX(detection.magpsf_corr) - MIN(detection.magpsf_corr)) AS delta_mag,\n                                                                                             1 AS detection_fid\n   FROM detection\n   INNER JOIN C ON C.oid = detection.oid\n   WHERE detection.fid = 1\n     AND detection.magpsf_corr IS NOT NULL\n   GROUP BY detection.oid\n   HAVING (MAX(detection.magpsf_corr) - MIN(detection.magpsf_corr)) > 1.0),\n                                                                                                                                                                                D_r AS\n  (/* Per-oid corrected magnitude extremes in r band (fid=2) with variation > 0.5 */  SELECT detection.oid,\n                                                                                             MIN(detection.magpsf_corr) AS min_mag,\n                                                                                             MAX(detection.magpsf_corr) AS max_mag,\n                                                                                             (MAX(detection.magpsf_corr) - MIN(detection.magpsf_corr)) AS delta_mag,\n                                                                                             2 AS detection_fid\n   FROM detection\n   INNER JOIN C ON C.oid = detection.oid\n   WHERE detection.fid = 2\n     AND detection.magpsf_corr IS NOT NULL\n   GROUP BY detection.oid\n   HAVING (MAX(detection.magpsf_corr) - MIN(detection.magpsf_corr)) > 0.5),\n                                                                                                                                                                                Oids_both AS\n  (/* Require both g and r variability thresholds */  SELECT oid\n   FROM D_g INTERSECT SELECT oid\n   FROM D_r),\n                                                                                                                                                                                U_bands AS\n  (/* Two rows per qualifying object: one for g, one for r */  SELECT D_g.oid,\n                                                                      D_g.min_mag,\n                                                                      D_g.max_mag,\n                                                                      D_g.delta_mag,\n                                                                      D_g.detection_fid\n   FROM D_g\n   WHERE D_g.oid IN\n       (SELECT oid\n        FROM Oids_both)\n   UNION ALL SELECT D_r.oid,\n                    D_r.min_mag,\n                    D_r.max_mag,\n                    D_r.delta_mag,\n                    D_r.detection_fid\n   FROM D_r\n   WHERE D_r.oid IN\n       (SELECT oid\n        FROM Oids_both))\nSELECT O.oid,\n       feature.value,\n       feature.name,\n       feature.version,\n       feature.fid AS feature_fid,\n       O.meanra,\n       O.meandec,\n       O.ndet,\n       U_bands.max_mag,\n       U_bands.min_mag,\n       U_bands.delta_mag,\n       U_bands.detection_fid\nFROM U_bands\nINNER JOIN O ON O.oid = U_bands.oid\nINNER JOIN feature ON feature.oid = U_bands.oid\nAND feature.fid = U_bands.detection_fid\nORDER BY O.oid,\n         U_bands.detection_fid,\n         feature.name;"
                        },
                        "in_toks": 7087,
                        "out_toks": 4728,
                        "id": "chatcmpl-Cb5cYnMbhqkp7WafpyAvBA4Z2A62y",
                        "created": 1762955778,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "7": {
            "req_id": "1",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "feature",
                "feature_version",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'feature', 'feature_version', 'detection']"
                },
                "in_toks": 737,
                "out_toks": 1950,
                "id": "chatcmpl-CZMCz4EH9260oFUNINZJGCcjpz4Gw",
                "created": 1762542885,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query: restrict OIDs early (by class, coverage, and per-band n_det >= 20),\n-- then aggregate detections only for those OIDs and require both g and r variability conditions.\n WITH -- 1) AGN with lc_classifier, rank=1, prob>0.6\nagn AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.ranking = 1\n     AND p.probability > 0.6), -- 2) Objects with >= 1 year coverage\nbase_oids AS\n  (SELECT o.oid\n   FROM OBJECT o\n   JOIN agn a ON a.oid = o.oid\n   WHERE o.deltajd >= 365.0), -- 3) OIDs with at least one band having n_det >= 20 (use features for efficiency)\nndet_any_band AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   JOIN base_oids b ON b.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.value >= 20\n     AND f.fid IN (1,\n                   2,\n                   3)),\n                                                                                                                eligible_base AS\n  (SELECT b.oid\n   FROM base_oids b\n   JOIN ndet_any_band n ON n.oid = b.oid), -- 4) Per-oid, per-band corrected magnitude stats (restricted to eligible OIDs and bands g,r)\ndet_stats AS\n  (SELECT d.oid,\n          d.fid AS detection_fid, -- alias per requirement\n MIN(d.magpsf_corr) AS min_mag,\n MAX(d.magpsf_corr) AS max_mag,\n (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag\n   FROM detection d\n   JOIN eligible_base e ON e.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid IN (1,\n                   2)-- 1=g, 2=r\n\n   GROUP BY d.oid,\n            d.fid), -- 5) Apply band-specific variability thresholds\ndet_g AS\n  (SELECT *\n   FROM det_stats\n   WHERE detection_fid = 1\n     AND delta_mag > 1.0),\n                                                                    det_r AS\n  (SELECT *\n   FROM det_stats\n   WHERE detection_fid = 2\n     AND delta_mag > 0.5), -- 6) Require objects to satisfy BOTH g and r variability conditions\neligible_oids AS\n  (SELECT g.oid\n   FROM det_g g\n   INNER JOIN det_r r ON r.oid = g.oid), -- 7) Rows to output from both bands for eligible objects\ndet_rows AS\n  (SELECT *\n   FROM det_g\n   WHERE oid IN\n       (SELECT oid\n        FROM eligible_oids)\n   UNION ALL SELECT *\n   FROM det_r\n   WHERE oid IN\n       (SELECT oid\n        FROM eligible_oids)), -- 8) Feature rows (n_det >= 20) to return alongside, include feature_fid alias\nfeat_ndet_ge20 AS\n  (SELECT f.oid,\n          f.name,\n          f.value,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   JOIN ndet_any_band n ON n.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.value >= 20\n     AND f.fid IN (1,\n                   2,\n                   3))\nSELECT dr.oid,\n       fn.value,\n       fn.name,\n       fn.version,\n       fn.feature_fid, -- feature filter id with required alias\n o.meanra,\n o.meandec,\n o.ndet,\n dr.max_mag,\n dr.min_mag,\n dr.delta_mag, -- difference between max and min corrected mags\n dr.detection_fid -- detection filter id with required alias\nFROM det_rows dr\nJOIN OBJECT o ON o.oid = dr.oid\nLEFT JOIN feat_ndet_ge20 fn ON fn.oid = dr.oid\nORDER BY dr.oid,\n         dr.detection_fid,\n         fn.feature_fid;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query: restrict OIDs early (by class, coverage, and per-band n_det >= 20),\n-- then aggregate detections only for those OIDs and require both g and r variability conditions.\n WITH -- 1) AGN with lc_classifier, rank=1, prob>0.6\nagn AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.ranking = 1\n     AND p.probability > 0.6), -- 2) Objects with >= 1 year coverage\nbase_oids AS\n  (SELECT o.oid\n   FROM OBJECT o\n   JOIN agn a ON a.oid = o.oid\n   WHERE o.deltajd >= 365.0), -- 3) OIDs with at least one band having n_det >= 20 (use features for efficiency)\nndet_any_band AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   JOIN base_oids b ON b.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.value >= 20\n     AND f.fid IN (1,\n                   2,\n                   3)),\n                                                                                                                eligible_base AS\n  (SELECT b.oid\n   FROM base_oids b\n   JOIN ndet_any_band n ON n.oid = b.oid), -- 4) Per-oid, per-band corrected magnitude stats (restricted to eligible OIDs and bands g,r)\ndet_stats AS\n  (SELECT d.oid,\n          d.fid AS detection_fid, -- alias per requirement\n MIN(d.magpsf_corr) AS min_mag,\n MAX(d.magpsf_corr) AS max_mag,\n (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag\n   FROM detection d\n   JOIN eligible_base e ON e.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid IN (1,\n                   2)-- 1=g, 2=r\n\n   GROUP BY d.oid,\n            d.fid), -- 5) Apply band-specific variability thresholds\ndet_g AS\n  (SELECT *\n   FROM det_stats\n   WHERE detection_fid = 1\n     AND delta_mag > 1.0),\n                                                                    det_r AS\n  (SELECT *\n   FROM det_stats\n   WHERE detection_fid = 2\n     AND delta_mag > 0.5), -- 6) Require objects to satisfy BOTH g and r variability conditions\neligible_oids AS\n  (SELECT g.oid\n   FROM det_g g\n   INNER JOIN det_r r ON r.oid = g.oid), -- 7) Rows to output from both bands for eligible objects\ndet_rows AS\n  (SELECT *\n   FROM det_g\n   WHERE oid IN\n       (SELECT oid\n        FROM eligible_oids)\n   UNION ALL SELECT *\n   FROM det_r\n   WHERE oid IN\n       (SELECT oid\n        FROM eligible_oids)), -- 8) Feature rows (n_det >= 20) to return alongside, include feature_fid alias\nfeat_ndet_ge20 AS\n  (SELECT f.oid,\n          f.name,\n          f.value,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   JOIN ndet_any_band n ON n.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.value >= 20\n     AND f.fid IN (1,\n                   2,\n                   3))\nSELECT dr.oid,\n       fn.value,\n       fn.name,\n       fn.version,\n       fn.feature_fid, -- feature filter id with required alias\n o.meanra,\n o.meandec,\n o.ndet,\n dr.max_mag,\n dr.min_mag,\n dr.delta_mag, -- difference between max and min corrected mags\n dr.detection_fid -- detection filter id with required alias\nFROM det_rows dr\nJOIN OBJECT o ON o.oid = dr.oid\nLEFT JOIN feat_ndet_ge20 fn ON fn.oid = dr.oid\nORDER BY dr.oid,\n         dr.detection_fid,\n         fn.feature_fid;"
                },
                "in_toks": 6184,
                "out_toks": 4221,
                "id": "chatcmpl-CbGh8EqFouEavqMmQKdsozlhXqCNX",
                "created": 1762998346,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 4290,
                "out_toks": 1295,
                "id": "chatcmpl-CZYC85MCbpBJwR898arBP3wmrUyET",
                "created": 1762588960,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Objects classified as AGN (lc_classifier, rank=1) with probability > 0.6\nWITH p_lc_rank1_agn AS\n  (SELECT oid,\n          class_name,\n          classifier_name,\n          classifier_version,\n          probability,\n          ranking\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND ranking = 1\n     AND class_name = 'AGN'\n     AND probability > 0.6), -- Objects with >= 1 year coverage\nobj_sel AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   INNER JOIN p_lc_rank1_agn p ON p.oid = o.oid\n   WHERE o.deltajd >= 365.0), -- Variability per band using corrected magnitudes: g-band (fid=1), delta > 1.0\ndet_var_g AS\n  (SELECT d.oid,\n          d.fid AS detection_fid,\n          MIN(d.magpsf_corr) AS min_mag,\n          MAX(d.magpsf_corr) AS max_mag,\n          (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag\n   FROM detection d\n   INNER JOIN obj_sel o ON o.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid = 1\n   GROUP BY d.oid,\n            d.fid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 1.0), -- Variability per band using corrected magnitudes: r-band (fid=2), delta > 0.5\ndet_var_r AS\n  (SELECT d.oid,\n          d.fid AS detection_fid,\n          MIN(d.magpsf_corr) AS min_mag,\n          MAX(d.magpsf_corr) AS max_mag,\n          (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag\n   FROM detection d\n   INNER JOIN obj_sel o ON o.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid = 2\n   GROUP BY d.oid,\n            d.fid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 0.5), -- Union of variability rows (per oid, per band)\ndet_var_union AS\n  (SELECT *\n   FROM det_var_g\n   UNION ALL SELECT *\n   FROM det_var_r), -- Feature rows with at least 20 detections in any band (1,2,3)\nfeat_ndet_ge20 AS\n  (SELECT f.oid,\n          f.name,\n          f.value,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN obj_sel o ON o.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.value >= 20\n     AND f.fid IN (1,\n                   2,\n                   3)), -- OIDs that satisfy the >=20 detections condition in at least one band\noids_ndet_ge20 AS\n  (SELECT DISTINCT oid\n   FROM feat_ndet_ge20), -- Combine conditions using UNION and INTERSECT\ncond_union AS\n  (SELECT oid\n   FROM det_var_g\n   UNION SELECT oid\n   FROM det_var_r\n   UNION SELECT oid\n   FROM oids_ndet_ge20),\n                                                                        cond_intersect AS\n  (SELECT oid\n   FROM det_var_g INTERSECT SELECT oid\n   FROM det_var_r INTERSECT SELECT oid\n   FROM oids_ndet_ge20),\n                                                                        eligible_oids AS\n  (SELECT DISTINCT cu.oid\n   FROM cond_union cu\n   INNER JOIN cond_intersect ci ON ci.oid = cu.oid) -- Final selection: per-object and per-band variability rows, with feature info\n\nSELECT o.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.feature_fid,\n       o.meanra,\n       o.meandec,\n       o.ndet,\n       dv.max_mag,\n       dv.min_mag,\n       dv.delta_mag,\n       dv.detection_fid\nFROM det_var_union dv\nINNER JOIN eligible_oids eo ON eo.oid = dv.oid\nINNER JOIN obj_sel o ON o.oid = dv.oid\nLEFT JOIN feat_ndet_ge20 f ON f.oid = dv.oid;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query for the ALeRCE database\n\nGoal\n- Select objects classified as AGN (lc_classifier, ranking=1) with probability > 0.6.\n- Light-curve time span at least one year.\n- At least 20 detections in at least one band (use feature 'n_det' by band).\n- Variability (using corrected magnitudes) larger than:\n  - 1.0 mag in g (fid=1),\n  - 0.5 mag in r (fid=2).\n- Return, per qualifying object and per band where variability is computed:\n  - oid;\n  - feature columns: value, name, version, and filter id (alias feature_fid) for the n_det feature rows that satisfy >=20 detections condition;\n  - mean coordinates (object.meanra, object.meandec);\n  - total number of detections (object.ndet);\n  - maximum and minimum corrected magnitudes from detections, and their difference as delta_mag;\n  - the detection band id (alias detection_fid).\n- Use JOINs, UNIONs, and INTERSECTs with nested subqueries.\n- Use exact table and column names.\n\nParameters and constants\n- Required class: probability.class_name = 'AGN'\n- Default classifier and ranking: probability.classifier_name = 'lc_classifier' AND probability.ranking = 1\n- Minimum class probability: probability.probability > 0.6\n- Minimum time coverage: object.deltajd >= 365.0\n- Detection count threshold (per band): feature.value >= 20 for feature.name = 'n_det'\n- g-band fid: 1, r-band fid: 2\n- Corrected magnitudes source: detection.magpsf_corr (ensure detection.corrected = true and magpsf_corr IS NOT NULL)\n\nStep 1: Base classification filter (probability subquery)\n- Subquery p_lc_rank1_agn:\n  - FROM probability\n  - WHERE:\n    - probability.classifier_name = 'lc_classifier'\n    - probability.ranking = 1\n    - probability.class_name = 'AGN'\n    - probability.probability > 0.6\n  - SELECT: oid (distinct), plus probability fields if needed for debugging (not required in final select).\n\nStep 2: Object-level constraints and columns\n- Subquery obj_sel:\n  - FROM object o\n  - INNER JOIN p_lc_rank1_agn p ON p.oid = o.oid\n  - WHERE o.deltajd >= 365.0\n  - SELECT:\n    - o.oid\n    - o.meanra, o.meandec\n    - o.ndet\n  - This limits the working set to objects meeting classification and time coverage, and provides the object-level columns.\n\nStep 3: Variability per band using corrected magnitudes (detection aggregates)\n- Note: Use only detection rows with corrected = true and magpsf_corr IS NOT NULL. Aggregate by oid and fid.\n\n3a) g-band variability subquery (fid=1), corrected\n- Subquery det_var_g:\n  - FROM detection d\n  - INNER JOIN obj_sel o ON o.oid = d.oid\n  - WHERE d.corrected = true AND d.magpsf_corr IS NOT NULL AND d.fid = 1\n  - GROUP BY d.oid, d.fid\n  - HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 1.0\n  - SELECT:\n    - d.oid\n    - d.fid AS detection_fid\n    - MIN(d.magpsf_corr) AS min_mag\n    - MAX(d.magpsf_corr) AS max_mag\n    - (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag\n\n3b) r-band variability subquery (fid=2), corrected\n- Subquery det_var_r:\n  - Same as det_var_g but with d.fid = 2 and HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 0.5\n  - SELECT analogous columns.\n\n3c) OIDs that satisfy both band-variability constraints\n- Subquery oids_var_both:\n  - (SELECT oid FROM det_var_g) INTERSECT (SELECT oid FROM det_var_r)\n\n3d) Consolidated per-band variability rows (for output and later join)\n- Subquery det_var_union:\n  - (SELECT rows from det_var_g)\n  - UNION ALL\n  - (SELECT rows from det_var_r)\n  - This provides one row per (oid, detection_fid) carrying min_mag, max_mag, delta_mag, for the bands 1 and 2 that individually pass their thresholds.\n\nStep 4: Per-band detection-count feature condition (at least one band with n_det >= 20)\n- Subquery feat_ndet_ge20:\n  - FROM feature f\n  - INNER JOIN obj_sel o ON o.oid = f.oid\n  - WHERE f.name = 'n_det' AND f.value >= 20 AND f.fid IN (1, 2, 3)\n  - SELECT:\n    - f.oid\n    - f.name\n    - f.value\n    - f.version\n    - f.fid AS feature_fid\n  - This yields all feature rows for bands (1,2,3) that satisfy >=20 detections.\n\n- Subquery oids_ndet_ge20:\n  - SELECT DISTINCT oid FROM feat_ndet_ge20\n\nStep 5: Combine condition sets via UNION and INTERSECT to obtain final eligible OIDs\n- Union of condition sources (for completeness; used to then filter by intersection):\n  - Subquery cond_union:\n    - (SELECT oid FROM det_var_g)\n    - UNION\n    - (SELECT oid FROM det_var_r)\n    - UNION\n    - (SELECT oid FROM oids_ndet_ge20)\n\n- Intersection of all conditions (objects that satisfy every required condition):\n  - Subquery cond_intersect:\n    - (SELECT oid FROM det_var_g)\n    - INTERSECT\n    - (SELECT oid FROM det_var_r)\n    - INTERSECT\n    - (SELECT oid FROM oids_ndet_ge20)\n\n- Final eligible OIDs (filter union by intersection to comply with the requested methodology):\n  - Subquery eligible_oids:\n    - SELECT DISTINCT cu.oid\n    - FROM cond_union cu\n    - INNER JOIN cond_intersect ci ON ci.oid = cu.oid\n  - Alternatively, eligible_oids \u2261 cond_intersect (set of OIDs satisfying all constraints).\n\nStep 6: Assemble final result rows\n- Start from per-band variability aggregates (det_var_union) filtered to eligible_oids.\n- Join in the object columns and the feature rows.\n\n- Subquery final_rows:\n  - FROM det_var_union dv\n  - INNER JOIN eligible_oids eo ON eo.oid = dv.oid\n  - INNER JOIN obj_sel o ON o.oid = dv.oid\n  - LEFT JOIN feat_ndet_ge20 f ON f.oid = dv.oid\n    - Note: This join includes the feature rows (name/value/version/feature_fid) for the bands with n_det >= 20. It may produce multiple rows per oid and detection_fid if multiple feature bands satisfy >=20; this is acceptable as the request asks to return the feature values and filter id. If a 1:1 match is desired, optionally filter feat_ndet_ge20 to a single band per oid (e.g., the band with MAX(value) via a window function), but this is not required by the user.\n\n  - SELECT the requested columns:\n    - o.oid\n    - f.value AS value\n    - f.name AS name\n    - f.version AS version\n    - f.feature_fid AS feature_fid\n    - o.meanra\n    - o.meandec\n    - o.ndet\n    - dv.max_mag AS max_mag\n    - dv.min_mag AS min_mag\n    - dv.delta_mag AS delta_mag\n    - dv.detection_fid AS detection_fid\n\nStep 7: Optional restrictions and notes\n- If you want to ensure every returned row represents a variability band (g or r) and that the object also passes n_det in at least one band (not necessarily the same band), keep the LEFT JOIN to feat_ndet_ge20 and the eligible_oids restriction as above.\n- Do not impose any additional filters on detection apart from oid, corrected=true, fid in {1,2}, and magpsf_corr IS NOT NULL, to follow the performance guidance.\n- Index usage:\n  - probability: ix_probabilities_oid (hash), ix_probabilities_ranking, ix_probabilities_probability, ix_classification_rank1 (ranking=1) will help.\n  - object: btree indices on ndet, firstmjd, meanra, meandec are available; filtering by deltajd uses column without index but the join cardinality is already reduced by probability filter.\n  - feature: ix_feature_oid_2 (hash) helps joining by oid.\n  - detection: ix_ndetection_oid (hash) helps grouping by oid; ensure WHERE uses oid IN (obj_sel) to leverage it.\n\nStep 8: Ordering (optional)\n- If needed, add ORDER BY (e.g., delta_mag DESC, or probability.probability DESC by joining p_lc_rank1_agn) though the user did not request a specific ordering.\n\nSummary of subqueries and their roles\n- p_lc_rank1_agn: filter to AGN (lc_classifier, rank=1) with probability > 0.6.\n- obj_sel: enforce >=1 year coverage, retrieve object-level columns.\n- det_var_g / det_var_r: per-band variability using corrected magnitudes and thresholds.\n- oids_var_both: objects that pass both g and r variability.\n- det_var_union: union of per-band variability rows for output.\n- feat_ndet_ge20: feature rows (name='n_det') with value >= 20 in any band.\n- oids_ndet_ge20: OIDs satisfying the n_det band condition.\n- cond_union / cond_intersect: ensure the object satisfies all conditions using UNION and INTERSECT.\n- eligible_oids: final OID set.\n- final_rows: assemble and select requested columns with proper fid aliases:\n  - feature_fid for feature.fid,\n  - detection_fid for detection fid."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query for the ALeRCE database\n\nGoal\n- Select objects classified as AGN (lc_classifier, ranking=1) with probability > 0.6.\n- Light-curve time span at least one year.\n- At least 20 detections in at least one band (use feature 'n_det' by band).\n- Variability (using corrected magnitudes) larger than:\n  - 1.0 mag in g (fid=1),\n  - 0.5 mag in r (fid=2).\n- Return, per qualifying object and per band where variability is computed:\n  - oid;\n  - feature columns: value, name, version, and filter id (alias feature_fid) for the n_det feature rows that satisfy >=20 detections condition;\n  - mean coordinates (object.meanra, object.meandec);\n  - total number of detections (object.ndet);\n  - maximum and minimum corrected magnitudes from detections, and their difference as delta_mag;\n  - the detection band id (alias detection_fid).\n- Use JOINs, UNIONs, and INTERSECTs with nested subqueries.\n- Use exact table and column names.\n\nParameters and constants\n- Required class: probability.class_name = 'AGN'\n- Default classifier and ranking: probability.classifier_name = 'lc_classifier' AND probability.ranking = 1\n- Minimum class probability: probability.probability > 0.6\n- Minimum time coverage: object.deltajd >= 365.0\n- Detection count threshold (per band): feature.value >= 20 for feature.name = 'n_det'\n- g-band fid: 1, r-band fid: 2\n- Corrected magnitudes source: detection.magpsf_corr (ensure detection.corrected = true and magpsf_corr IS NOT NULL)\n\nStep 1: Base classification filter (probability subquery)\n- Subquery p_lc_rank1_agn:\n  - FROM probability\n  - WHERE:\n    - probability.classifier_name = 'lc_classifier'\n    - probability.ranking = 1\n    - probability.class_name = 'AGN'\n    - probability.probability > 0.6\n  - SELECT: oid (distinct), plus probability fields if needed for debugging (not required in final select).\n\nStep 2: Object-level constraints and columns\n- Subquery obj_sel:\n  - FROM object o\n  - INNER JOIN p_lc_rank1_agn p ON p.oid = o.oid\n  - WHERE o.deltajd >= 365.0\n  - SELECT:\n    - o.oid\n    - o.meanra, o.meandec\n    - o.ndet\n  - This limits the working set to objects meeting classification and time coverage, and provides the object-level columns.\n\nStep 3: Variability per band using corrected magnitudes (detection aggregates)\n- Note: Use only detection rows with corrected = true and magpsf_corr IS NOT NULL. Aggregate by oid and fid.\n\n3a) g-band variability subquery (fid=1), corrected\n- Subquery det_var_g:\n  - FROM detection d\n  - INNER JOIN obj_sel o ON o.oid = d.oid\n  - WHERE d.corrected = true AND d.magpsf_corr IS NOT NULL AND d.fid = 1\n  - GROUP BY d.oid, d.fid\n  - HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 1.0\n  - SELECT:\n    - d.oid\n    - d.fid AS detection_fid\n    - MIN(d.magpsf_corr) AS min_mag\n    - MAX(d.magpsf_corr) AS max_mag\n    - (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag\n\n3b) r-band variability subquery (fid=2), corrected\n- Subquery det_var_r:\n  - Same as det_var_g but with d.fid = 2 and HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 0.5\n  - SELECT analogous columns.\n\n3c) OIDs that satisfy both band-variability constraints\n- Subquery oids_var_both:\n  - (SELECT oid FROM det_var_g) INTERSECT (SELECT oid FROM det_var_r)\n\n3d) Consolidated per-band variability rows (for output and later join)\n- Subquery det_var_union:\n  - (SELECT rows from det_var_g)\n  - UNION ALL\n  - (SELECT rows from det_var_r)\n  - This provides one row per (oid, detection_fid) carrying min_mag, max_mag, delta_mag, for the bands 1 and 2 that individually pass their thresholds.\n\nStep 4: Per-band detection-count feature condition (at least one band with n_det >= 20)\n- Subquery feat_ndet_ge20:\n  - FROM feature f\n  - INNER JOIN obj_sel o ON o.oid = f.oid\n  - WHERE f.name = 'n_det' AND f.value >= 20 AND f.fid IN (1, 2, 3)\n  - SELECT:\n    - f.oid\n    - f.name\n    - f.value\n    - f.version\n    - f.fid AS feature_fid\n  - This yields all feature rows for bands (1,2,3) that satisfy >=20 detections.\n\n- Subquery oids_ndet_ge20:\n  - SELECT DISTINCT oid FROM feat_ndet_ge20\n\nStep 5: Combine condition sets via UNION and INTERSECT to obtain final eligible OIDs\n- Union of condition sources (for completeness; used to then filter by intersection):\n  - Subquery cond_union:\n    - (SELECT oid FROM det_var_g)\n    - UNION\n    - (SELECT oid FROM det_var_r)\n    - UNION\n    - (SELECT oid FROM oids_ndet_ge20)\n\n- Intersection of all conditions (objects that satisfy every required condition):\n  - Subquery cond_intersect:\n    - (SELECT oid FROM det_var_g)\n    - INTERSECT\n    - (SELECT oid FROM det_var_r)\n    - INTERSECT\n    - (SELECT oid FROM oids_ndet_ge20)\n\n- Final eligible OIDs (filter union by intersection to comply with the requested methodology):\n  - Subquery eligible_oids:\n    - SELECT DISTINCT cu.oid\n    - FROM cond_union cu\n    - INNER JOIN cond_intersect ci ON ci.oid = cu.oid\n  - Alternatively, eligible_oids \u2261 cond_intersect (set of OIDs satisfying all constraints).\n\nStep 6: Assemble final result rows\n- Start from per-band variability aggregates (det_var_union) filtered to eligible_oids.\n- Join in the object columns and the feature rows.\n\n- Subquery final_rows:\n  - FROM det_var_union dv\n  - INNER JOIN eligible_oids eo ON eo.oid = dv.oid\n  - INNER JOIN obj_sel o ON o.oid = dv.oid\n  - LEFT JOIN feat_ndet_ge20 f ON f.oid = dv.oid\n    - Note: This join includes the feature rows (name/value/version/feature_fid) for the bands with n_det >= 20. It may produce multiple rows per oid and detection_fid if multiple feature bands satisfy >=20; this is acceptable as the request asks to return the feature values and filter id. If a 1:1 match is desired, optionally filter feat_ndet_ge20 to a single band per oid (e.g., the band with MAX(value) via a window function), but this is not required by the user.\n\n  - SELECT the requested columns:\n    - o.oid\n    - f.value AS value\n    - f.name AS name\n    - f.version AS version\n    - f.feature_fid AS feature_fid\n    - o.meanra\n    - o.meandec\n    - o.ndet\n    - dv.max_mag AS max_mag\n    - dv.min_mag AS min_mag\n    - dv.delta_mag AS delta_mag\n    - dv.detection_fid AS detection_fid\n\nStep 7: Optional restrictions and notes\n- If you want to ensure every returned row represents a variability band (g or r) and that the object also passes n_det in at least one band (not necessarily the same band), keep the LEFT JOIN to feat_ndet_ge20 and the eligible_oids restriction as above.\n- Do not impose any additional filters on detection apart from oid, corrected=true, fid in {1,2}, and magpsf_corr IS NOT NULL, to follow the performance guidance.\n- Index usage:\n  - probability: ix_probabilities_oid (hash), ix_probabilities_ranking, ix_probabilities_probability, ix_classification_rank1 (ranking=1) will help.\n  - object: btree indices on ndet, firstmjd, meanra, meandec are available; filtering by deltajd uses column without index but the join cardinality is already reduced by probability filter.\n  - feature: ix_feature_oid_2 (hash) helps joining by oid.\n  - detection: ix_ndetection_oid (hash) helps grouping by oid; ensure WHERE uses oid IN (obj_sel) to leverage it.\n\nStep 8: Ordering (optional)\n- If needed, add ORDER BY (e.g., delta_mag DESC, or probability.probability DESC by joining p_lc_rank1_agn) though the user did not request a specific ordering.\n\nSummary of subqueries and their roles\n- p_lc_rank1_agn: filter to AGN (lc_classifier, rank=1) with probability > 0.6.\n- obj_sel: enforce >=1 year coverage, retrieve object-level columns.\n- det_var_g / det_var_r: per-band variability using corrected magnitudes and thresholds.\n- oids_var_both: objects that pass both g and r variability.\n- det_var_union: union of per-band variability rows for output.\n- feat_ndet_ge20: feature rows (name='n_det') with value >= 20 in any band.\n- oids_ndet_ge20: OIDs satisfying the n_det band condition.\n- cond_union / cond_intersect: ensure the object satisfies all conditions using UNION and INTERSECT.\n- eligible_oids: final OID set.\n- final_rows: assemble and select requested columns with proper fid aliases:\n  - feature_fid for feature.fid,\n  - detection_fid for detection fid."
                    },
                    "in_toks": 6168,
                    "out_toks": 9056,
                    "id": "chatcmpl-Cb5dr5dJK5RtCPJ6cJoN6I6Actanq",
                    "created": 1762955859,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Objects classified as AGN (lc_classifier, rank=1) with probability > 0.6\nWITH p_lc_rank1_agn AS\n  (SELECT oid,\n          class_name,\n          classifier_name,\n          classifier_version,\n          probability,\n          ranking\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND ranking = 1\n     AND class_name = 'AGN'\n     AND probability > 0.6), -- Objects with >= 1 year coverage\nobj_sel AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   INNER JOIN p_lc_rank1_agn p ON p.oid = o.oid\n   WHERE o.deltajd >= 365.0), -- Variability per band using corrected magnitudes: g-band (fid=1), delta > 1.0\ndet_var_g AS\n  (SELECT d.oid,\n          d.fid AS detection_fid,\n          MIN(d.magpsf_corr) AS min_mag,\n          MAX(d.magpsf_corr) AS max_mag,\n          (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag\n   FROM detection d\n   INNER JOIN obj_sel o ON o.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid = 1\n   GROUP BY d.oid,\n            d.fid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 1.0), -- Variability per band using corrected magnitudes: r-band (fid=2), delta > 0.5\ndet_var_r AS\n  (SELECT d.oid,\n          d.fid AS detection_fid,\n          MIN(d.magpsf_corr) AS min_mag,\n          MAX(d.magpsf_corr) AS max_mag,\n          (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag\n   FROM detection d\n   INNER JOIN obj_sel o ON o.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid = 2\n   GROUP BY d.oid,\n            d.fid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 0.5), -- Union of variability rows (per oid, per band)\ndet_var_union AS\n  (SELECT *\n   FROM det_var_g\n   UNION ALL SELECT *\n   FROM det_var_r), -- Feature rows with at least 20 detections in any band (1,2,3)\nfeat_ndet_ge20 AS\n  (SELECT f.oid,\n          f.name,\n          f.value,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN obj_sel o ON o.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.value >= 20\n     AND f.fid IN (1,\n                   2,\n                   3)), -- OIDs that satisfy the >=20 detections condition in at least one band\noids_ndet_ge20 AS\n  (SELECT DISTINCT oid\n   FROM feat_ndet_ge20), -- Combine conditions using UNION and INTERSECT\ncond_union AS\n  (SELECT oid\n   FROM det_var_g\n   UNION SELECT oid\n   FROM det_var_r\n   UNION SELECT oid\n   FROM oids_ndet_ge20),\n                                                                        cond_intersect AS\n  (SELECT oid\n   FROM det_var_g INTERSECT SELECT oid\n   FROM det_var_r INTERSECT SELECT oid\n   FROM oids_ndet_ge20),\n                                                                        eligible_oids AS\n  (SELECT DISTINCT cu.oid\n   FROM cond_union cu\n   INNER JOIN cond_intersect ci ON ci.oid = cu.oid) -- Final selection: per-object and per-band variability rows, with feature info\n\nSELECT o.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.feature_fid,\n       o.meanra,\n       o.meandec,\n       o.ndet,\n       dv.max_mag,\n       dv.min_mag,\n       dv.delta_mag,\n       dv.detection_fid\nFROM det_var_union dv\nINNER JOIN eligible_oids eo ON eo.oid = dv.oid\nINNER JOIN obj_sel o ON o.oid = dv.oid\nLEFT JOIN feat_ndet_ge20 f ON f.oid = dv.oid;"
                        },
                        "in_toks": 7028,
                        "out_toks": 4083,
                        "id": "chatcmpl-Cb5gjitUHyGkPSoUQdcMtzTeitUY2",
                        "created": 1762956037,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "8": {
            "req_id": "1",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'detection', 'feature', 'feature_version']"
                },
                "in_toks": 737,
                "out_toks": 1630,
                "id": "chatcmpl-CZMDxBKm8jeB9zU7EIVF0vZ8ts5bo",
                "created": 1762542945,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query avoiding heavy detection scans by using precomputed features.\n-- Ensures: AGN (lc_classifier, ranking=1) with prob>0.6, >=1 yr coverage, object corrected,\n-- >=20 detections in at least one band, and band variations using corrected magnitudes:\n-- g: delta_mag > 1.0, r: delta_mag > 0.5.\nWITH P AS\n  (-- Filter objects classified as AGN with sufficient probability (use ranking=1)\n SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.ranking = 1\n     AND p.probability > 0.6),\n     O AS\n  (-- Object-level constraints: >= 1 year coverage and corrected\n SELECT o.oid,\n        o.meanra,\n        o.meandec,\n        o.ndet\n   FROM OBJECT o\n   JOIN P ON P.oid = o.oid\n   WHERE o.deltajd >= 365.0\n     AND o.corrected = TRUE),\n     N20 AS\n  (-- At least 20 detections in ANY band (g/r/i)\n SELECT DISTINCT f.oid\n   FROM feature f\n   JOIN O USING (oid)\n   WHERE f.name = 'n_det'\n     AND f.fid IN (1,\n                   2,\n                   3)\n     AND f.value >= 20),\n     Fg AS\n  (-- g-band stats from features: min_mag and delta_mag_fid; compute max_mag = min + delta\n SELECT o.oid,\n        fmin.value AS min_mag,\n        (fmin.value + fdel.value) AS max_mag,\n        fdel.value AS delta_mag,\n        1 AS detection_fid\n   FROM O o\n   JOIN feature fmin ON fmin.oid = o.oid\n   AND fmin.name = 'min_mag'\n   AND fmin.fid = 1\n   JOIN feature fdel ON fdel.oid = o.oid\n   AND fdel.name = 'delta_mag_fid'\n   AND fdel.fid = 1\n   WHERE fdel.value > 1.0),\n     Fr AS\n  (-- r-band stats from features\n SELECT o.oid,\n        fmin.value AS min_mag,\n        (fmin.value + fdel.value) AS max_mag,\n        fdel.value AS delta_mag,\n        2 AS detection_fid\n   FROM O o\n   JOIN feature fmin ON fmin.oid = o.oid\n   AND fmin.name = 'min_mag'\n   AND fmin.fid = 2\n   JOIN feature fdel ON fdel.oid = o.oid\n   AND fdel.name = 'delta_mag_fid'\n   AND fdel.fid = 2\n   WHERE fdel.value > 0.5),\n     FO AS\n  (-- Final OIDs that satisfy all constraints (coverage, corrected, N>=20 in any band, and both g/r variability)\n SELECT o.oid\n   FROM O o\n   JOIN N20 n USING (oid)\n   JOIN Fg USING (oid)\n   JOIN Fr USING (oid)),\n     B AS\n  (-- Band-wise min/max/delta for g and r\n SELECT fg.oid,\n        fg.min_mag,\n        fg.max_mag,\n        fg.delta_mag,\n        fg.detection_fid\n   FROM Fg fg\n   JOIN FO USING (oid)\n   UNION ALL SELECT fr.oid,\n                    fr.min_mag,\n                    fr.max_mag,\n                    fr.delta_mag,\n                    fr.detection_fid\n   FROM Fr fr\n   JOIN FO USING (oid)),\n     F_all AS\n  (-- Return features for these objects (restrict to g and r bands to reduce output size)\n SELECT f.oid,\n        f.value,\n        f.name,\n        f.version,\n        f.fid AS feature_fid\n   FROM feature f\n   JOIN FO USING (oid)\n   WHERE f.fid IN (1,\n                   2))\nSELECT FO.oid,\n       F_all.value,\n       F_all.name,\n       F_all.version,\n       F_all.feature_fid, -- features.fid aliased as feature_fid\n O.meanra,\n O.meandec,\n O.ndet,\n B.max_mag,\n B.min_mag,\n B.delta_mag, -- difference between max and min magnitudes\n B.detection_fid -- band id for the computed stats aliased as detection_fid\nFROM FO\nJOIN O ON O.oid = FO.oid\nJOIN B ON B.oid = FO.oid\nJOIN F_all ON F_all.oid = FO.oid\nORDER BY FO.oid,\n         B.detection_fid,\n         F_all.name;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query avoiding heavy detection scans by using precomputed features.\n-- Ensures: AGN (lc_classifier, ranking=1) with prob>0.6, >=1 yr coverage, object corrected,\n-- >=20 detections in at least one band, and band variations using corrected magnitudes:\n-- g: delta_mag > 1.0, r: delta_mag > 0.5.\nWITH P AS\n  (-- Filter objects classified as AGN with sufficient probability (use ranking=1)\n SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.ranking = 1\n     AND p.probability > 0.6),\n     O AS\n  (-- Object-level constraints: >= 1 year coverage and corrected\n SELECT o.oid,\n        o.meanra,\n        o.meandec,\n        o.ndet\n   FROM OBJECT o\n   JOIN P ON P.oid = o.oid\n   WHERE o.deltajd >= 365.0\n     AND o.corrected = TRUE),\n     N20 AS\n  (-- At least 20 detections in ANY band (g/r/i)\n SELECT DISTINCT f.oid\n   FROM feature f\n   JOIN O USING (oid)\n   WHERE f.name = 'n_det'\n     AND f.fid IN (1,\n                   2,\n                   3)\n     AND f.value >= 20),\n     Fg AS\n  (-- g-band stats from features: min_mag and delta_mag_fid; compute max_mag = min + delta\n SELECT o.oid,\n        fmin.value AS min_mag,\n        (fmin.value + fdel.value) AS max_mag,\n        fdel.value AS delta_mag,\n        1 AS detection_fid\n   FROM O o\n   JOIN feature fmin ON fmin.oid = o.oid\n   AND fmin.name = 'min_mag'\n   AND fmin.fid = 1\n   JOIN feature fdel ON fdel.oid = o.oid\n   AND fdel.name = 'delta_mag_fid'\n   AND fdel.fid = 1\n   WHERE fdel.value > 1.0),\n     Fr AS\n  (-- r-band stats from features\n SELECT o.oid,\n        fmin.value AS min_mag,\n        (fmin.value + fdel.value) AS max_mag,\n        fdel.value AS delta_mag,\n        2 AS detection_fid\n   FROM O o\n   JOIN feature fmin ON fmin.oid = o.oid\n   AND fmin.name = 'min_mag'\n   AND fmin.fid = 2\n   JOIN feature fdel ON fdel.oid = o.oid\n   AND fdel.name = 'delta_mag_fid'\n   AND fdel.fid = 2\n   WHERE fdel.value > 0.5),\n     FO AS\n  (-- Final OIDs that satisfy all constraints (coverage, corrected, N>=20 in any band, and both g/r variability)\n SELECT o.oid\n   FROM O o\n   JOIN N20 n USING (oid)\n   JOIN Fg USING (oid)\n   JOIN Fr USING (oid)),\n     B AS\n  (-- Band-wise min/max/delta for g and r\n SELECT fg.oid,\n        fg.min_mag,\n        fg.max_mag,\n        fg.delta_mag,\n        fg.detection_fid\n   FROM Fg fg\n   JOIN FO USING (oid)\n   UNION ALL SELECT fr.oid,\n                    fr.min_mag,\n                    fr.max_mag,\n                    fr.delta_mag,\n                    fr.detection_fid\n   FROM Fr fr\n   JOIN FO USING (oid)),\n     F_all AS\n  (-- Return features for these objects (restrict to g and r bands to reduce output size)\n SELECT f.oid,\n        f.value,\n        f.name,\n        f.version,\n        f.fid AS feature_fid\n   FROM feature f\n   JOIN FO USING (oid)\n   WHERE f.fid IN (1,\n                   2))\nSELECT FO.oid,\n       F_all.value,\n       F_all.name,\n       F_all.version,\n       F_all.feature_fid, -- features.fid aliased as feature_fid\n O.meanra,\n O.meandec,\n O.ndet,\n B.max_mag,\n B.min_mag,\n B.delta_mag, -- difference between max and min magnitudes\n B.detection_fid -- band id for the computed stats aliased as detection_fid\nFROM FO\nJOIN O ON O.oid = FO.oid\nJOIN B ON B.oid = FO.oid\nJOIN F_all ON F_all.oid = FO.oid\nORDER BY FO.oid,\n         B.detection_fid,\n         F_all.name;"
                },
                "in_toks": 6294,
                "out_toks": 5659,
                "id": "chatcmpl-CbGifyEbiMPZlyvfNEbYUvxzRVktA",
                "created": 1762998441,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 4290,
                "out_toks": 1103,
                "id": "chatcmpl-CZYClAH6SS7T2TFigCER8gmje0P3U",
                "created": 1762588999,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Get AGN (lc_classifier, rank=1) with prob>0.6, >=1 yr coverage, >=20 detections in any band,\n-- and corrected magnitude variability: g delta_mag>1.0 and r delta_mag>0.5.\nWITH P AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6),\n     O AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   INNER JOIN P ON P.oid = o.oid\n   WHERE o.deltajd >= 365.0),\n     F_g20 AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN P ON P.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.fid = 1\n     AND f.value >= 20),\n     F_r20 AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN P ON P.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.fid = 2\n     AND f.value >= 20),\n     F_i20 AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN P ON P.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.fid = 3\n     AND f.value >= 20),\n     N20 AS\n  (SELECT oid\n   FROM F_g20\n   UNION SELECT oid\n   FROM F_r20\n   UNION SELECT oid\n   FROM F_i20),\n     D_g AS\n  (SELECT d.oid,\n          MIN(d.magpsf_corr) AS min_mag,\n          MAX(d.magpsf_corr) AS max_mag,\n          (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag,\n          1 AS detection_fid\n   FROM detection d\n   INNER JOIN O ON O.oid = d.oid\n   WHERE d.fid = 1\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 1.0),\n     D_r AS\n  (SELECT d.oid,\n          MIN(d.magpsf_corr) AS min_mag,\n          MAX(d.magpsf_corr) AS max_mag,\n          (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag,\n          2 AS detection_fid\n   FROM detection d\n   INNER JOIN O ON O.oid = d.oid\n   WHERE d.fid = 2\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 0.5),\n     FO AS\n  (SELECT oid\n   FROM O INTERSECT SELECT oid\n   FROM N20 INTERSECT SELECT oid\n   FROM D_g INTERSECT SELECT oid\n   FROM D_r),\n     B AS\n  (SELECT dg.oid,\n          dg.min_mag,\n          dg.max_mag,\n          dg.delta_mag,\n          dg.detection_fid\n   FROM D_g dg\n   INNER JOIN FO ON FO.oid = dg.oid\n   UNION ALL SELECT dr.oid,\n                    dr.min_mag,\n                    dr.max_mag,\n                    dr.delta_mag,\n                    dr.detection_fid\n   FROM D_r dr\n   INNER JOIN FO ON FO.oid = dr.oid),\n     F_all AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN FO ON FO.oid = f.oid)\nSELECT FO.oid,\n       F_all.value,\n       F_all.name,\n       F_all.version,\n       F_all.feature_fid, -- feature.fid aliased as feature_fid\n O.meanra,\n O.meandec,\n O.ndet,\n B.max_mag,\n B.min_mag,\n B.delta_mag, -- difference between max and min corrected magnitudes\n B.detection_fid -- band id from detection aggregates aliased as detection_fid\nFROM FO\nINNER JOIN O ON O.oid = FO.oid\nINNER JOIN B ON B.oid = FO.oid\nINNER JOIN F_all ON F_all.oid = FO.oid\nORDER BY FO.oid,\n         B.detection_fid,\n         F_all.name;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nRetrieve all ZTF objects that:\n- Are classified as AGN with probability > 0.6 (using the lc_classifier, ranking=1).\n- Have light-curve time coverage of at least one year.\n- Have at least 20 detections in at least one band (g or r or i), using features.\n- Show corrected-magnitude variability:\n  - g band (fid=1): delta_mag > 1.0 (computed from corrected magnitudes).\n  - r band (fid=2): delta_mag > 0.5 (computed from corrected magnitudes).\nReturn, for the qualifying objects:\n- oid\n- From feature table: value, name, version, and fid (aliased as feature_fid)\n- From object: meanra, meandec, ndet\n- From detection aggregates: maximum and minimum corrected magnitudes per band and their difference, aliased as delta_mag, plus fid (aliased as detection_fid)\n\nNotes and constraints to respect\n- Use table and column names exactly as defined.\n- Default probability filters:\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n- Classes use exact strings, e.g., 'AGN'.\n- Use corrected magnitudes from detection.magpsf_corr and filter detections with detection.corrected = TRUE.\n- Band identifiers: fid=1 (g), fid=2 (r), fid=3 (i).\n- Time coverage criterion: object.deltajd >= 365 (days).\n- Feature table is transposed; when filtering by features, follow the multi-feature subquery strategy. Here we only use one feature (n_det), but we still structure subqueries joined to the filtered oid set from probability for efficiency.\n- Use JOINs, UNIONs, INTERSECTs, and nested subqueries.\n- For filter id columns, alias as [table_name]_fid (e.g., feature.fid AS feature_fid; aggregated detection fid AS detection_fid).\n\nStep-by-step plan\n\n1) Define constants and band mapping (for readability in explanations)\n- AGN class_name = 'AGN'.\n- classifier_name = 'lc_classifier'.\n- ranking = 1.\n- prob_threshold = 0.6.\n- coverage_days = 365.0.\n- g band fid_g = 1; r band fid_r = 2; i band fid_i = 3.\n- g variability threshold: delta_g > 1.0.\n- r variability threshold: delta_r > 0.5.\n\n2) Subquery P: Most-likely AGN classification with probability > 0.6\n- FROM probability\n- WHERE\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n  - probability.class_name = 'AGN'\n  - probability.probability > 0.6\n- SELECT DISTINCT probability.oid\nPurpose: Get the base oid set satisfying the classification constraints. Use ix_classification_rank1 and ix_probabilities_probability to filter efficiently.\n\n3) Subquery O: Enforce time coverage (>= 1 year) and prepare object-level columns\n- FROM object o\n- INNER JOIN P ON o.oid = P.oid\n- WHERE o.deltajd >= 365.0\n- SELECT\n  - o.oid,\n  - o.meanra,\n  - o.meandec,\n  - o.ndet\nPurpose: Reduce the candidate set using object-level coverage and produce object columns needed in the final output. This subquery will be the preferred anchor for detection join operations to leverage ix_ndetection_oid.\n\n4) Feature-based \u201cat least 20 detections in at least one band\u201d\nBecause feature is transposed, construct band-specific subqueries joined to P and then UNION them.\n\n4.1) Subquery F_g20: objects with n_det >= 20 in g band\n- FROM feature f\n- INNER JOIN P ON f.oid = P.oid\n- WHERE\n  - f.name = 'n_det'\n  - f.fid = 1\n  - f.value >= 20\n- SELECT DISTINCT f.oid\n\n4.2) Subquery F_r20: objects with n_det >= 20 in r band\n- Same as F_g20 but f.fid = 2\n\n4.3) Subquery F_i20: objects with n_det >= 20 in i band\n- Same as F_g20 but f.fid = 3\n\n4.4) Subquery N20: union of the three bands (at least one band criterion)\n- SELECT oid FROM F_g20\n  UNION\n  SELECT oid FROM F_r20\n  UNION\n  SELECT oid FROM F_i20\nPurpose: N20 is the set of oids that satisfy \u201cat least 20 detections in at least one band\u201d.\n\n5) Detection-based corrected magnitude variability per band\nCompute per-oid, per-band min/max of detection.magpsf_corr over corrected detections, and filter by variability thresholds. Do this after limiting to the O set (which already enforces AGN + prob + coverage) to keep detection scans efficient (via ix_ndetection_oid).\n\n5.1) Subquery D_g: corrected magnitude stats for g band with delta > 1.0\n- FROM detection d\n- INNER JOIN O ON d.oid = O.oid\n- WHERE\n  - d.fid = 1\n  - d.corrected = TRUE\n  - d.magpsf_corr IS NOT NULL\n- GROUP BY d.oid\n- SELECT\n  - d.oid,\n  - MIN(d.magpsf_corr) AS min_mag,\n  - MAX(d.magpsf_corr) AS max_mag,\n  - (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag,\n  - 1 AS detection_fid\n- HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 1.0\n\n5.2) Subquery D_r: corrected magnitude stats for r band with delta > 0.5\n- FROM detection d\n- INNER JOIN O ON d.oid = O.oid\n- WHERE\n  - d.fid = 2\n  - d.corrected = TRUE\n  - d.magpsf_corr IS NOT NULL\n- GROUP BY d.oid\n- SELECT\n  - d.oid,\n  - MIN(d.magpsf_corr) AS min_mag,\n  - MAX(d.magpsf_corr) AS max_mag,\n  - (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag,\n  - 2 AS detection_fid\n- HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 0.5\n\nPurpose: Enforce band-specific variability thresholds using corrected magnitudes and produce per-band stats needed for output.\n\n6) Subquery FO: Final set of oids satisfying all constraints using INTERSECT\n- SELECT oid FROM O           -- AGN + prob + coverage\n  INTERSECT\n  SELECT oid FROM N20         -- at least 20 detections in at least one band\n  INTERSECT\n  SELECT oid FROM D_g         -- g-band corrected delta > 1.0\n  INTERSECT\n  SELECT oid FROM D_r         -- r-band corrected delta > 0.5\nPurpose: Keep only oids that meet every requirement.\n\n7) Subquery B: Band-wise stats for output (UNION g and r stats)\nConstruct a unified table of band stats for the final output rows by UNION-ing D_g and D_r, but restricted to FO to avoid including extraneous oids.\n\n- FROM (\n    SELECT d.oid, d.min_mag, d.max_mag, d.delta_mag, d.detection_fid\n    FROM D_g d\n    INNER JOIN FO ON FO.oid = d.oid\n    UNION ALL\n    SELECT d.oid, d.min_mag, d.max_mag, d.delta_mag, d.detection_fid\n    FROM D_r d\n    INNER JOIN FO ON FO.oid = d.oid\n  ) AS B\n\nNotes:\n- Use UNION ALL since g and r rows are disjoint by detection_fid and should not be deduplicated; this preserves two rows per oid (one for each band).\n\n8) Subquery F_all: All features rows for the final oids (for requested columns)\n- FROM feature f\n- INNER JOIN FO ON f.oid = FO.oid\n- SELECT\n  - f.oid,\n  - f.value,\n  - f.name,\n  - f.version,\n  - f.fid AS feature_fid\n\nPurpose: Provide the requested feature metadata for the selected objects. No additional feature filtering is applied here.\n\n9) Final SELECT and JOIN composition\n- FROM FO\n- INNER JOIN O ON O.oid = FO.oid\n- INNER JOIN B ON B.oid = FO.oid\n- INNER JOIN F_all ON F_all.oid = FO.oid\n- SELECT the required columns:\n  - FO.oid\n  - F_all.value\n  - F_all.name\n  - F_all.version\n  - F_all.feature_fid        -- alias for feature.fid as requested\n  - O.meanra\n  - O.meandec\n  - O.ndet\n  - B.max_mag\n  - B.min_mag\n  - B.delta_mag              -- alias already set in band stats subqueries\n  - B.detection_fid          -- alias for the band id from detection aggregates\n- Optional ORDER BY FO.oid, B.detection_fid, F_all.name to organize results.\n\n10) Performance and correctness considerations\n- The heavy detection aggregations are restricted by first joining to O (which is filtered by P and time coverage), and later intersected with FO; this ensures use of ix_ndetection_oid and minimizes scanning.\n- Probability filters use classifier_name = 'lc_classifier' and ranking = 1 by default, with class_name = 'AGN' and probability > 0.6 explicitly.\n- Use detection.corrected = TRUE and detection.magpsf_corr IS NOT NULL to enforce corrected magnitudes for variability computation.\n- At-least-20-detections criterion is implemented via feature name 'n_det' with band-specific fid and value >= 20, and uses UNION across bands to satisfy \u201cat least in one band.\u201d\n- The final output contains two rows per object from B (g and r band stats), crossed with all feature rows F_all for that object; this matches the request to return both band variability stats and feature metadata."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nRetrieve all ZTF objects that:\n- Are classified as AGN with probability > 0.6 (using the lc_classifier, ranking=1).\n- Have light-curve time coverage of at least one year.\n- Have at least 20 detections in at least one band (g or r or i), using features.\n- Show corrected-magnitude variability:\n  - g band (fid=1): delta_mag > 1.0 (computed from corrected magnitudes).\n  - r band (fid=2): delta_mag > 0.5 (computed from corrected magnitudes).\nReturn, for the qualifying objects:\n- oid\n- From feature table: value, name, version, and fid (aliased as feature_fid)\n- From object: meanra, meandec, ndet\n- From detection aggregates: maximum and minimum corrected magnitudes per band and their difference, aliased as delta_mag, plus fid (aliased as detection_fid)\n\nNotes and constraints to respect\n- Use table and column names exactly as defined.\n- Default probability filters:\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n- Classes use exact strings, e.g., 'AGN'.\n- Use corrected magnitudes from detection.magpsf_corr and filter detections with detection.corrected = TRUE.\n- Band identifiers: fid=1 (g), fid=2 (r), fid=3 (i).\n- Time coverage criterion: object.deltajd >= 365 (days).\n- Feature table is transposed; when filtering by features, follow the multi-feature subquery strategy. Here we only use one feature (n_det), but we still structure subqueries joined to the filtered oid set from probability for efficiency.\n- Use JOINs, UNIONs, INTERSECTs, and nested subqueries.\n- For filter id columns, alias as [table_name]_fid (e.g., feature.fid AS feature_fid; aggregated detection fid AS detection_fid).\n\nStep-by-step plan\n\n1) Define constants and band mapping (for readability in explanations)\n- AGN class_name = 'AGN'.\n- classifier_name = 'lc_classifier'.\n- ranking = 1.\n- prob_threshold = 0.6.\n- coverage_days = 365.0.\n- g band fid_g = 1; r band fid_r = 2; i band fid_i = 3.\n- g variability threshold: delta_g > 1.0.\n- r variability threshold: delta_r > 0.5.\n\n2) Subquery P: Most-likely AGN classification with probability > 0.6\n- FROM probability\n- WHERE\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n  - probability.class_name = 'AGN'\n  - probability.probability > 0.6\n- SELECT DISTINCT probability.oid\nPurpose: Get the base oid set satisfying the classification constraints. Use ix_classification_rank1 and ix_probabilities_probability to filter efficiently.\n\n3) Subquery O: Enforce time coverage (>= 1 year) and prepare object-level columns\n- FROM object o\n- INNER JOIN P ON o.oid = P.oid\n- WHERE o.deltajd >= 365.0\n- SELECT\n  - o.oid,\n  - o.meanra,\n  - o.meandec,\n  - o.ndet\nPurpose: Reduce the candidate set using object-level coverage and produce object columns needed in the final output. This subquery will be the preferred anchor for detection join operations to leverage ix_ndetection_oid.\n\n4) Feature-based \u201cat least 20 detections in at least one band\u201d\nBecause feature is transposed, construct band-specific subqueries joined to P and then UNION them.\n\n4.1) Subquery F_g20: objects with n_det >= 20 in g band\n- FROM feature f\n- INNER JOIN P ON f.oid = P.oid\n- WHERE\n  - f.name = 'n_det'\n  - f.fid = 1\n  - f.value >= 20\n- SELECT DISTINCT f.oid\n\n4.2) Subquery F_r20: objects with n_det >= 20 in r band\n- Same as F_g20 but f.fid = 2\n\n4.3) Subquery F_i20: objects with n_det >= 20 in i band\n- Same as F_g20 but f.fid = 3\n\n4.4) Subquery N20: union of the three bands (at least one band criterion)\n- SELECT oid FROM F_g20\n  UNION\n  SELECT oid FROM F_r20\n  UNION\n  SELECT oid FROM F_i20\nPurpose: N20 is the set of oids that satisfy \u201cat least 20 detections in at least one band\u201d.\n\n5) Detection-based corrected magnitude variability per band\nCompute per-oid, per-band min/max of detection.magpsf_corr over corrected detections, and filter by variability thresholds. Do this after limiting to the O set (which already enforces AGN + prob + coverage) to keep detection scans efficient (via ix_ndetection_oid).\n\n5.1) Subquery D_g: corrected magnitude stats for g band with delta > 1.0\n- FROM detection d\n- INNER JOIN O ON d.oid = O.oid\n- WHERE\n  - d.fid = 1\n  - d.corrected = TRUE\n  - d.magpsf_corr IS NOT NULL\n- GROUP BY d.oid\n- SELECT\n  - d.oid,\n  - MIN(d.magpsf_corr) AS min_mag,\n  - MAX(d.magpsf_corr) AS max_mag,\n  - (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag,\n  - 1 AS detection_fid\n- HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 1.0\n\n5.2) Subquery D_r: corrected magnitude stats for r band with delta > 0.5\n- FROM detection d\n- INNER JOIN O ON d.oid = O.oid\n- WHERE\n  - d.fid = 2\n  - d.corrected = TRUE\n  - d.magpsf_corr IS NOT NULL\n- GROUP BY d.oid\n- SELECT\n  - d.oid,\n  - MIN(d.magpsf_corr) AS min_mag,\n  - MAX(d.magpsf_corr) AS max_mag,\n  - (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag,\n  - 2 AS detection_fid\n- HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 0.5\n\nPurpose: Enforce band-specific variability thresholds using corrected magnitudes and produce per-band stats needed for output.\n\n6) Subquery FO: Final set of oids satisfying all constraints using INTERSECT\n- SELECT oid FROM O           -- AGN + prob + coverage\n  INTERSECT\n  SELECT oid FROM N20         -- at least 20 detections in at least one band\n  INTERSECT\n  SELECT oid FROM D_g         -- g-band corrected delta > 1.0\n  INTERSECT\n  SELECT oid FROM D_r         -- r-band corrected delta > 0.5\nPurpose: Keep only oids that meet every requirement.\n\n7) Subquery B: Band-wise stats for output (UNION g and r stats)\nConstruct a unified table of band stats for the final output rows by UNION-ing D_g and D_r, but restricted to FO to avoid including extraneous oids.\n\n- FROM (\n    SELECT d.oid, d.min_mag, d.max_mag, d.delta_mag, d.detection_fid\n    FROM D_g d\n    INNER JOIN FO ON FO.oid = d.oid\n    UNION ALL\n    SELECT d.oid, d.min_mag, d.max_mag, d.delta_mag, d.detection_fid\n    FROM D_r d\n    INNER JOIN FO ON FO.oid = d.oid\n  ) AS B\n\nNotes:\n- Use UNION ALL since g and r rows are disjoint by detection_fid and should not be deduplicated; this preserves two rows per oid (one for each band).\n\n8) Subquery F_all: All features rows for the final oids (for requested columns)\n- FROM feature f\n- INNER JOIN FO ON f.oid = FO.oid\n- SELECT\n  - f.oid,\n  - f.value,\n  - f.name,\n  - f.version,\n  - f.fid AS feature_fid\n\nPurpose: Provide the requested feature metadata for the selected objects. No additional feature filtering is applied here.\n\n9) Final SELECT and JOIN composition\n- FROM FO\n- INNER JOIN O ON O.oid = FO.oid\n- INNER JOIN B ON B.oid = FO.oid\n- INNER JOIN F_all ON F_all.oid = FO.oid\n- SELECT the required columns:\n  - FO.oid\n  - F_all.value\n  - F_all.name\n  - F_all.version\n  - F_all.feature_fid        -- alias for feature.fid as requested\n  - O.meanra\n  - O.meandec\n  - O.ndet\n  - B.max_mag\n  - B.min_mag\n  - B.delta_mag              -- alias already set in band stats subqueries\n  - B.detection_fid          -- alias for the band id from detection aggregates\n- Optional ORDER BY FO.oid, B.detection_fid, F_all.name to organize results.\n\n10) Performance and correctness considerations\n- The heavy detection aggregations are restricted by first joining to O (which is filtered by P and time coverage), and later intersected with FO; this ensures use of ix_ndetection_oid and minimizes scanning.\n- Probability filters use classifier_name = 'lc_classifier' and ranking = 1 by default, with class_name = 'AGN' and probability > 0.6 explicitly.\n- Use detection.corrected = TRUE and detection.magpsf_corr IS NOT NULL to enforce corrected magnitudes for variability computation.\n- At-least-20-detections criterion is implemented via feature name 'n_det' with band-specific fid and value >= 20, and uses UNION across bands to satisfy \u201cat least in one band.\u201d\n- The final output contains two rows per object from B (g and r band stats), crossed with all feature rows F_all for that object; this matches the request to return both band variability stats and feature metadata."
                    },
                    "in_toks": 6168,
                    "out_toks": 7536,
                    "id": "chatcmpl-Cb5hf1RbOU9uMeRXUNNWrX8eYQ25z",
                    "created": 1762956095,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Get AGN (lc_classifier, rank=1) with prob>0.6, >=1 yr coverage, >=20 detections in any band,\n-- and corrected magnitude variability: g delta_mag>1.0 and r delta_mag>0.5.\nWITH P AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6),\n     O AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   INNER JOIN P ON P.oid = o.oid\n   WHERE o.deltajd >= 365.0),\n     F_g20 AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN P ON P.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.fid = 1\n     AND f.value >= 20),\n     F_r20 AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN P ON P.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.fid = 2\n     AND f.value >= 20),\n     F_i20 AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   INNER JOIN P ON P.oid = f.oid\n   WHERE f.name = 'n_det'\n     AND f.fid = 3\n     AND f.value >= 20),\n     N20 AS\n  (SELECT oid\n   FROM F_g20\n   UNION SELECT oid\n   FROM F_r20\n   UNION SELECT oid\n   FROM F_i20),\n     D_g AS\n  (SELECT d.oid,\n          MIN(d.magpsf_corr) AS min_mag,\n          MAX(d.magpsf_corr) AS max_mag,\n          (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag,\n          1 AS detection_fid\n   FROM detection d\n   INNER JOIN O ON O.oid = d.oid\n   WHERE d.fid = 1\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 1.0),\n     D_r AS\n  (SELECT d.oid,\n          MIN(d.magpsf_corr) AS min_mag,\n          MAX(d.magpsf_corr) AS max_mag,\n          (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag,\n          2 AS detection_fid\n   FROM detection d\n   INNER JOIN O ON O.oid = d.oid\n   WHERE d.fid = 2\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid\n   HAVING (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) > 0.5),\n     FO AS\n  (SELECT oid\n   FROM O INTERSECT SELECT oid\n   FROM N20 INTERSECT SELECT oid\n   FROM D_g INTERSECT SELECT oid\n   FROM D_r),\n     B AS\n  (SELECT dg.oid,\n          dg.min_mag,\n          dg.max_mag,\n          dg.delta_mag,\n          dg.detection_fid\n   FROM D_g dg\n   INNER JOIN FO ON FO.oid = dg.oid\n   UNION ALL SELECT dr.oid,\n                    dr.min_mag,\n                    dr.max_mag,\n                    dr.delta_mag,\n                    dr.detection_fid\n   FROM D_r dr\n   INNER JOIN FO ON FO.oid = dr.oid),\n     F_all AS\n  (SELECT f.oid,\n          f.value,\n          f.name,\n          f.version,\n          f.fid AS feature_fid\n   FROM feature f\n   INNER JOIN FO ON FO.oid = f.oid)\nSELECT FO.oid,\n       F_all.value,\n       F_all.name,\n       F_all.version,\n       F_all.feature_fid, -- feature.fid aliased as feature_fid\n O.meanra,\n O.meandec,\n O.ndet,\n B.max_mag,\n B.min_mag,\n B.delta_mag, -- difference between max and min corrected magnitudes\n B.detection_fid -- band id from detection aggregates aliased as detection_fid\nFROM FO\nINNER JOIN O ON O.oid = FO.oid\nINNER JOIN B ON B.oid = FO.oid\nINNER JOIN F_all ON F_all.oid = FO.oid\nORDER BY FO.oid,\n         B.detection_fid,\n         F_all.name;"
                        },
                        "in_toks": 7044,
                        "out_toks": 4348,
                        "id": "chatcmpl-Cb5jcDtljpdNHpWg3xorLRe0Kgsyy",
                        "created": 1762956216,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "9": {
            "req_id": "1",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'detection', 'feature', 'feature_version']"
                },
                "in_toks": 737,
                "out_toks": 2078,
                "id": "chatcmpl-CZMEgcnxPReUuWtCoKnG6Lkr2Rj44",
                "created": 1762542990,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Select AGN ranked 1 by lc_classifier with P>0.6, require >=1 yr baseline, and compute band stats\nWITH p_sel AS\n  (SELECT oid\n   FROM probability\n   WHERE class_name = 'AGN'\n     AND classifier_name = 'lc_classifier'\n     AND ranking = 1\n     AND probability > 0.6),\n     obj_sel AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   JOIN p_sel p USING (oid)\n   WHERE o.deltajd >= 365 -- at least one year of coverage\n), -- Aggregate corrected magnitudes only for g/r to reduce volume\ndet_agg AS\n  (SELECT d.oid,\n          d.fid,\n          COUNT(*) AS n_det_band,\n          MIN(d.magpsf_corr) AS min_mag,\n          MAX(d.magpsf_corr) AS max_mag\n   FROM detection d\n   JOIN obj_sel o ON o.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid IN (1,\n                   2)-- g and r bands\n\n   GROUP BY d.oid,\n            d.fid), -- Keep objects with variability thresholds in both bands and >=20 detections in any band\npassing_oids AS\n  (SELECT da.oid\n   FROM det_agg da\n   GROUP BY da.oid\n   HAVING MAX(CASE\n                  WHEN da.fid = 1\n                       AND (da.max_mag - da.min_mag) > 1 THEN 1\n                  ELSE 0\n              END) = 1\n   AND MAX(CASE\n               WHEN da.fid = 2\n                    AND (da.max_mag - da.min_mag) > 0.5 THEN 1\n               ELSE 0\n           END) = 1\n   AND MAX(da.n_det_band) >= 20), -- Final per-band aggregates for passing objects\ngr_agg AS\n  (SELECT da.oid,\n          da.fid,\n          da.n_det_band,\n          da.min_mag,\n          da.max_mag,\n          (da.max_mag - da.min_mag) AS delta_mag\n   FROM det_agg da\n   JOIN passing_oids po USING (oid))\nSELECT o.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid, -- feature table filter id\n o.meanra,\n o.meandec,\n o.ndet,\n ga.max_mag AS max_mag, -- corrected max magnitude per band\n ga.min_mag AS min_mag, -- corrected min magnitude per band\n ga.delta_mag AS delta_mag,\n ga.fid AS detection_fid -- detection aggregate filter id\nFROM gr_agg ga\nJOIN obj_sel o ON o.oid = ga.oid\nJOIN feature f ON f.oid = ga.oid\nAND f.fid = ga.fid;",
            "sql_response": {
                "responses": {
                    "0": "-- Select AGN ranked 1 by lc_classifier with P>0.6, require >=1 yr baseline, and compute band stats\nWITH p_sel AS\n  (SELECT oid\n   FROM probability\n   WHERE class_name = 'AGN'\n     AND classifier_name = 'lc_classifier'\n     AND ranking = 1\n     AND probability > 0.6),\n     obj_sel AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   JOIN p_sel p USING (oid)\n   WHERE o.deltajd >= 365 -- at least one year of coverage\n), -- Aggregate corrected magnitudes only for g/r to reduce volume\ndet_agg AS\n  (SELECT d.oid,\n          d.fid,\n          COUNT(*) AS n_det_band,\n          MIN(d.magpsf_corr) AS min_mag,\n          MAX(d.magpsf_corr) AS max_mag\n   FROM detection d\n   JOIN obj_sel o ON o.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n     AND d.fid IN (1,\n                   2)-- g and r bands\n\n   GROUP BY d.oid,\n            d.fid), -- Keep objects with variability thresholds in both bands and >=20 detections in any band\npassing_oids AS\n  (SELECT da.oid\n   FROM det_agg da\n   GROUP BY da.oid\n   HAVING MAX(CASE\n                  WHEN da.fid = 1\n                       AND (da.max_mag - da.min_mag) > 1 THEN 1\n                  ELSE 0\n              END) = 1\n   AND MAX(CASE\n               WHEN da.fid = 2\n                    AND (da.max_mag - da.min_mag) > 0.5 THEN 1\n               ELSE 0\n           END) = 1\n   AND MAX(da.n_det_band) >= 20), -- Final per-band aggregates for passing objects\ngr_agg AS\n  (SELECT da.oid,\n          da.fid,\n          da.n_det_band,\n          da.min_mag,\n          da.max_mag,\n          (da.max_mag - da.min_mag) AS delta_mag\n   FROM det_agg da\n   JOIN passing_oids po USING (oid))\nSELECT o.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid, -- feature table filter id\n o.meanra,\n o.meandec,\n o.ndet,\n ga.max_mag AS max_mag, -- corrected max magnitude per band\n ga.min_mag AS min_mag, -- corrected min magnitude per band\n ga.delta_mag AS delta_mag,\n ga.fid AS detection_fid -- detection aggregate filter id\nFROM gr_agg ga\nJOIN obj_sel o ON o.oid = ga.oid\nJOIN feature f ON f.oid = ga.oid\nAND f.fid = ga.fid;"
                },
                "in_toks": 5648,
                "out_toks": 4210,
                "id": "chatcmpl-CbGkqKSNKOiG3ZjAHGNy0hK1ZTifq",
                "created": 1762998576,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 4290,
                "out_toks": 2319,
                "id": "chatcmpl-CZYD7uilIkeJ6tj1hOgyRepDPoOdI",
                "created": 1762589021,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "/* 1) Select AGN at rank 1 with probability > 0.6 under lc_classifier */ WITH p_sel AS\n  (SELECT probability.oid\n   FROM probability\n   WHERE probability.class_name = 'AGN'\n     AND probability.classifier_name = 'lc_classifier'\n     AND probability.ranking = 1\n     AND probability.probability > 0.6), /* 2) Restrict to objects with >= 365 days baseline and keep metadata */ obj_sel AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   INNER JOIN p_sel p ON p.oid = o.oid\n   WHERE o.deltajd >= 365), /* 3) Aggregate corrected magnitudes per object and band */ det_agg AS\n  (SELECT d.oid,\n          d.fid,\n          COUNT(*) AS n_det_band,\n          MIN(d.magpsf_corr) AS min_mag,\n          MAX(d.magpsf_corr) AS max_mag,\n          (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag\n   FROM detection d\n   INNER JOIN obj_sel o ON o.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid,\n            d.fid), /* 4) OID sets for band variability and detection-count constraints */ g_var AS\n  (SELECT DISTINCT oid\n   FROM det_agg\n   WHERE fid = 1\n     AND delta_mag > 1),\n                                                                                           r_var AS\n  (SELECT DISTINCT oid\n   FROM det_agg\n   WHERE fid = 2\n     AND delta_mag > 0.5),\n                                                                                           n20_any AS\n  (SELECT DISTINCT oid\n   FROM det_agg\n   WHERE n_det_band >= 20),\n                                                                                           passing_oids AS\n  (SELECT oid\n   FROM g_var INTERSECT SELECT oid\n   FROM r_var INTERSECT SELECT oid\n   FROM n20_any), /* 5) Keep only g and r band aggregates for passing objects */ gr_agg AS\n  (SELECT da.oid,\n          da.fid,\n          da.n_det_band,\n          da.min_mag,\n          da.max_mag,\n          da.delta_mag\n   FROM det_agg da\n   WHERE da.fid IN (1,\n                    2)\n     AND da.oid IN\n       (SELECT oid\n        FROM passing_oids))\nSELECT o.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid, -- feature table filter id\n o.meanra,\n o.meandec,\n o.ndet,\n gr_agg.max_mag AS max_mag,\n gr_agg.min_mag AS min_mag,\n gr_agg.delta_mag AS delta_mag, -- difference between max and min magnitudes\n gr_agg.fid AS detection_fid -- detection aggregate filter id\nFROM gr_agg\nINNER JOIN obj_sel o ON o.oid = gr_agg.oid\nINNER JOIN feature f ON f.oid = gr_agg.oid\nAND f.fid = gr_agg.fid /* Optional ordering for readability */\nORDER BY o.oid,\n         detection_fid,\n         f.name;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Base AGN selection (probability table)\n- Purpose: restrict to AGN objects with high-confidence classification using default probability conditions.\n- Table: probability\n- Filters:\n  - probability.class_name = 'AGN'\n  - probability.classifier_name = 'lc_classifier'  (default)\n  - probability.ranking = 1                        (default)\n  - probability.probability > 0.6\n- Output columns: probability.oid\n- This subquery (call it p_sel) provides the list of candidate oids.\n\n2) Enforce light-curve duration and retrieve object-level info (object table)\n- Purpose: ensure at least one year of baseline and fetch object-level metadata.\n- Join: INNER JOIN object o ON o.oid = p_sel.oid\n- Filters:\n  - o.deltajd >= 365  (light curves covering at least one year)\n- Output columns to carry forward:\n  - o.oid\n  - o.meanra, o.meandec\n  - o.ndet\n- Name this subquery obj_sel.\n\n3) Aggregate corrected magnitudes per band (detection table)\n- Purpose: compute per-object, per-band corrected magnitude extrema and counts.\n- Join: INNER JOIN detection d ON d.oid = obj_sel.oid\n- Filters on detection:\n  - d.corrected = TRUE                  (ensure corrected photometry)\n  - d.magpsf_corr IS NOT NULL           (only corrected magnitude measurements)\n- Grouping: GROUP BY d.oid, d.fid   (fid: 1=g band, 2=r band, 3=i band)\n- Aggregates to compute:\n  - n_det_band = COUNT(*)                     (detections per band)\n  - min_mag = MIN(d.magpsf_corr)             (minimum corrected magnitude)\n  - max_mag = MAX(d.magpsf_corr)             (maximum corrected magnitude)\n  - delta_mag = MAX(d.magpsf_corr) - MIN(d.magpsf_corr)\n- Output columns: d.oid, d.fid, n_det_band, min_mag, max_mag, delta_mag\n- Name this subquery det_agg.\n\n4) Build per-condition oid sets from det_agg and intersect them\n- Purpose: enforce all band-specific and count constraints with set logic.\n- Create three derived subqueries from det_agg:\n  a) g_var: SELECT DISTINCT oid FROM det_agg WHERE fid = 1 AND delta_mag > 1\n  b) r_var: SELECT DISTINCT oid FROM det_agg WHERE fid = 2 AND delta_mag > 0.5\n  c) n20_any: SELECT DISTINCT oid FROM det_agg WHERE n_det_band >= 20\n- Intersect these sets to get only oids that satisfy all three:\n  - passing_oids = g_var INTERSECT r_var INTERSECT n20_any\n- Also ensure they belong to obj_sel by intersecting:\n  - passing_oids = passing_oids INTERSECT (SELECT oid FROM obj_sel)\n\n5) Prepare per-band (g and r) aggregated rows for output\n- Purpose: return band-specific extrema and delta for g and r only, with a single, uniform column naming.\n- Create two filtered subqueries from det_agg:\n  - g_agg: SELECT oid, fid, min_mag, max_mag, delta_mag FROM det_agg WHERE fid = 1\n  - r_agg: SELECT oid, fid, min_mag, max_mag, delta_mag FROM det_agg WHERE fid = 2\n- UNION ALL these two to keep both bands:\n  - gr_agg = g_agg UNION ALL r_agg\n- Filter gr_agg to oids in passing_oids (INNER JOIN or WHERE oid IN (...passing_oids...)).\n- For later projection, plan to alias:\n  - gr_agg.fid AS detection_fid\n  - gr_agg.min_mag AS min_mag\n  - gr_agg.max_mag AS max_mag\n  - gr_agg.delta_mag AS delta_mag\n\n6) Join features restricted to the same band as the detection aggregates\n- Purpose: include feature rows for those objects and bands (g and r), avoiding a cross-product across bands.\n- Join: INNER JOIN feature f\n  - ON f.oid = gr_agg.oid\n  - AND f.fid = gr_agg.fid    (restrict features to the same band as the detection aggregate; i.e., fid in {1,2})\n- Keep only features belonging to the selected objects by joining through gr_agg (already filtered by passing_oids).\n- Columns to return from feature (as requested):\n  - f.value\n  - f.name\n  - f.version\n  - f.fid AS feature_fid\n- Note: No feature-based filtering is applied; we include all available features for bands fid=1 and fid=2.\n\n7) Final assembly with object-level metadata\n- Join: INNER JOIN obj_sel o ON o.oid = gr_agg.oid\n- Projection (final SELECT) should include:\n  - o.oid\n  - f.value, f.name, f.version, f.fid AS feature_fid   (aliasing filter id as requested)\n  - o.meanra, o.meandec\n  - o.ndet\n  - gr_agg.max_mag AS max_mag\n  - gr_agg.min_mag AS min_mag\n  - gr_agg.delta_mag AS delta_mag\n  - gr_agg.fid AS detection_fid                        (aliasing filter id as requested)\n- Optional ordering (not required by user): ORDER BY o.oid, detection_fid, f.name.\n\n8) Performance and correctness notes\n- Ensure the probability constraints use:\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n  - probability.class_name = 'AGN'\n  - probability.probability > 0.6\n- Use INNER JOINs to restrict early:\n  - probability \u2192 object (obj_sel)\n  - obj_sel \u2192 detection (det_agg)\n  - passing_oids to filter gr_agg\n  - gr_agg \u2192 feature for band-matched features\n- Index usage:\n  - probability: ix_classification_rank1 (ranking=1), ix_probabilities_oid (oid), ix_probabilities_probability (probability)\n  - detection: ix_ndetection_oid (oid)\n  - object: primary key on oid and btree indices on ndet if needed\n- Magnitudes are the corrected ones via detection.magpsf_corr, ensured by d.corrected = TRUE and magpsf_corr IS NOT NULL.\n- Band ids: g = 1, r = 2 (fid in detection and feature).\n- The \u201cat least 20 detections in at least one band\u201d is satisfied by intersecting with n20_any derived from det_agg.\n- The g/r variation thresholds are enforced by intersecting g_var and r_var (delta_mag computed as max_mag - min_mag per band).\n- Filter id aliasing:\n  - feature.fid must be returned as feature_fid\n  - gr_agg/detection fid must be returned as detection_fid\n\nThis plan yields only those oids that:\n- Are AGN with probability > 0.6 under lc_classifier at rank 1,\n- Have light curves spanning at least 365 days,\n- Have at least one band with \u2265 20 detections,\n- Show corrected-magnitude variability > 1 mag in g and > 0.5 mag in r,\nand returns the requested features, object metadata, and band-wise corrected min/max magnitudes and delta_mag, with filter id columns aliased as specified."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\n1) Base AGN selection (probability table)\n- Purpose: restrict to AGN objects with high-confidence classification using default probability conditions.\n- Table: probability\n- Filters:\n  - probability.class_name = 'AGN'\n  - probability.classifier_name = 'lc_classifier'  (default)\n  - probability.ranking = 1                        (default)\n  - probability.probability > 0.6\n- Output columns: probability.oid\n- This subquery (call it p_sel) provides the list of candidate oids.\n\n2) Enforce light-curve duration and retrieve object-level info (object table)\n- Purpose: ensure at least one year of baseline and fetch object-level metadata.\n- Join: INNER JOIN object o ON o.oid = p_sel.oid\n- Filters:\n  - o.deltajd >= 365  (light curves covering at least one year)\n- Output columns to carry forward:\n  - o.oid\n  - o.meanra, o.meandec\n  - o.ndet\n- Name this subquery obj_sel.\n\n3) Aggregate corrected magnitudes per band (detection table)\n- Purpose: compute per-object, per-band corrected magnitude extrema and counts.\n- Join: INNER JOIN detection d ON d.oid = obj_sel.oid\n- Filters on detection:\n  - d.corrected = TRUE                  (ensure corrected photometry)\n  - d.magpsf_corr IS NOT NULL           (only corrected magnitude measurements)\n- Grouping: GROUP BY d.oid, d.fid   (fid: 1=g band, 2=r band, 3=i band)\n- Aggregates to compute:\n  - n_det_band = COUNT(*)                     (detections per band)\n  - min_mag = MIN(d.magpsf_corr)             (minimum corrected magnitude)\n  - max_mag = MAX(d.magpsf_corr)             (maximum corrected magnitude)\n  - delta_mag = MAX(d.magpsf_corr) - MIN(d.magpsf_corr)\n- Output columns: d.oid, d.fid, n_det_band, min_mag, max_mag, delta_mag\n- Name this subquery det_agg.\n\n4) Build per-condition oid sets from det_agg and intersect them\n- Purpose: enforce all band-specific and count constraints with set logic.\n- Create three derived subqueries from det_agg:\n  a) g_var: SELECT DISTINCT oid FROM det_agg WHERE fid = 1 AND delta_mag > 1\n  b) r_var: SELECT DISTINCT oid FROM det_agg WHERE fid = 2 AND delta_mag > 0.5\n  c) n20_any: SELECT DISTINCT oid FROM det_agg WHERE n_det_band >= 20\n- Intersect these sets to get only oids that satisfy all three:\n  - passing_oids = g_var INTERSECT r_var INTERSECT n20_any\n- Also ensure they belong to obj_sel by intersecting:\n  - passing_oids = passing_oids INTERSECT (SELECT oid FROM obj_sel)\n\n5) Prepare per-band (g and r) aggregated rows for output\n- Purpose: return band-specific extrema and delta for g and r only, with a single, uniform column naming.\n- Create two filtered subqueries from det_agg:\n  - g_agg: SELECT oid, fid, min_mag, max_mag, delta_mag FROM det_agg WHERE fid = 1\n  - r_agg: SELECT oid, fid, min_mag, max_mag, delta_mag FROM det_agg WHERE fid = 2\n- UNION ALL these two to keep both bands:\n  - gr_agg = g_agg UNION ALL r_agg\n- Filter gr_agg to oids in passing_oids (INNER JOIN or WHERE oid IN (...passing_oids...)).\n- For later projection, plan to alias:\n  - gr_agg.fid AS detection_fid\n  - gr_agg.min_mag AS min_mag\n  - gr_agg.max_mag AS max_mag\n  - gr_agg.delta_mag AS delta_mag\n\n6) Join features restricted to the same band as the detection aggregates\n- Purpose: include feature rows for those objects and bands (g and r), avoiding a cross-product across bands.\n- Join: INNER JOIN feature f\n  - ON f.oid = gr_agg.oid\n  - AND f.fid = gr_agg.fid    (restrict features to the same band as the detection aggregate; i.e., fid in {1,2})\n- Keep only features belonging to the selected objects by joining through gr_agg (already filtered by passing_oids).\n- Columns to return from feature (as requested):\n  - f.value\n  - f.name\n  - f.version\n  - f.fid AS feature_fid\n- Note: No feature-based filtering is applied; we include all available features for bands fid=1 and fid=2.\n\n7) Final assembly with object-level metadata\n- Join: INNER JOIN obj_sel o ON o.oid = gr_agg.oid\n- Projection (final SELECT) should include:\n  - o.oid\n  - f.value, f.name, f.version, f.fid AS feature_fid   (aliasing filter id as requested)\n  - o.meanra, o.meandec\n  - o.ndet\n  - gr_agg.max_mag AS max_mag\n  - gr_agg.min_mag AS min_mag\n  - gr_agg.delta_mag AS delta_mag\n  - gr_agg.fid AS detection_fid                        (aliasing filter id as requested)\n- Optional ordering (not required by user): ORDER BY o.oid, detection_fid, f.name.\n\n8) Performance and correctness notes\n- Ensure the probability constraints use:\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n  - probability.class_name = 'AGN'\n  - probability.probability > 0.6\n- Use INNER JOINs to restrict early:\n  - probability \u2192 object (obj_sel)\n  - obj_sel \u2192 detection (det_agg)\n  - passing_oids to filter gr_agg\n  - gr_agg \u2192 feature for band-matched features\n- Index usage:\n  - probability: ix_classification_rank1 (ranking=1), ix_probabilities_oid (oid), ix_probabilities_probability (probability)\n  - detection: ix_ndetection_oid (oid)\n  - object: primary key on oid and btree indices on ndet if needed\n- Magnitudes are the corrected ones via detection.magpsf_corr, ensured by d.corrected = TRUE and magpsf_corr IS NOT NULL.\n- Band ids: g = 1, r = 2 (fid in detection and feature).\n- The \u201cat least 20 detections in at least one band\u201d is satisfied by intersecting with n20_any derived from det_agg.\n- The g/r variation thresholds are enforced by intersecting g_var and r_var (delta_mag computed as max_mag - min_mag per band).\n- Filter id aliasing:\n  - feature.fid must be returned as feature_fid\n  - gr_agg/detection fid must be returned as detection_fid\n\nThis plan yields only those oids that:\n- Are AGN with probability > 0.6 under lc_classifier at rank 1,\n- Have light curves spanning at least 365 days,\n- Have at least one band with \u2265 20 detections,\n- Show corrected-magnitude variability > 1 mag in g and > 0.5 mag in r,\nand returns the requested features, object metadata, and band-wise corrected min/max magnitudes and delta_mag, with filter id columns aliased as specified."
                    },
                    "in_toks": 6168,
                    "out_toks": 6731,
                    "id": "chatcmpl-Cb5knxzsQpVpoW8nCe2ZT21ZGvANf",
                    "created": 1762956289,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "/* 1) Select AGN at rank 1 with probability > 0.6 under lc_classifier */ WITH p_sel AS\n  (SELECT probability.oid\n   FROM probability\n   WHERE probability.class_name = 'AGN'\n     AND probability.classifier_name = 'lc_classifier'\n     AND probability.ranking = 1\n     AND probability.probability > 0.6), /* 2) Restrict to objects with >= 365 days baseline and keep metadata */ obj_sel AS\n  (SELECT o.oid,\n          o.meanra,\n          o.meandec,\n          o.ndet\n   FROM OBJECT o\n   INNER JOIN p_sel p ON p.oid = o.oid\n   WHERE o.deltajd >= 365), /* 3) Aggregate corrected magnitudes per object and band */ det_agg AS\n  (SELECT d.oid,\n          d.fid,\n          COUNT(*) AS n_det_band,\n          MIN(d.magpsf_corr) AS min_mag,\n          MAX(d.magpsf_corr) AS max_mag,\n          (MAX(d.magpsf_corr) - MIN(d.magpsf_corr)) AS delta_mag\n   FROM detection d\n   INNER JOIN obj_sel o ON o.oid = d.oid\n   WHERE d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid,\n            d.fid), /* 4) OID sets for band variability and detection-count constraints */ g_var AS\n  (SELECT DISTINCT oid\n   FROM det_agg\n   WHERE fid = 1\n     AND delta_mag > 1),\n                                                                                           r_var AS\n  (SELECT DISTINCT oid\n   FROM det_agg\n   WHERE fid = 2\n     AND delta_mag > 0.5),\n                                                                                           n20_any AS\n  (SELECT DISTINCT oid\n   FROM det_agg\n   WHERE n_det_band >= 20),\n                                                                                           passing_oids AS\n  (SELECT oid\n   FROM g_var INTERSECT SELECT oid\n   FROM r_var INTERSECT SELECT oid\n   FROM n20_any), /* 5) Keep only g and r band aggregates for passing objects */ gr_agg AS\n  (SELECT da.oid,\n          da.fid,\n          da.n_det_band,\n          da.min_mag,\n          da.max_mag,\n          da.delta_mag\n   FROM det_agg da\n   WHERE da.fid IN (1,\n                    2)\n     AND da.oid IN\n       (SELECT oid\n        FROM passing_oids))\nSELECT o.oid,\n       f.value,\n       f.name,\n       f.version,\n       f.fid AS feature_fid, -- feature table filter id\n o.meanra,\n o.meandec,\n o.ndet,\n gr_agg.max_mag AS max_mag,\n gr_agg.min_mag AS min_mag,\n gr_agg.delta_mag AS delta_mag, -- difference between max and min magnitudes\n gr_agg.fid AS detection_fid -- detection aggregate filter id\nFROM gr_agg\nINNER JOIN obj_sel o ON o.oid = gr_agg.oid\nINNER JOIN feature f ON f.oid = gr_agg.oid\nAND f.fid = gr_agg.fid /* Optional ordering for readability */\nORDER BY o.oid,\n         detection_fid,\n         f.name;"
                        },
                        "in_toks": 6431,
                        "out_toks": 2826,
                        "id": "chatcmpl-Cb5mwtp549lVY5RaYIvhqF4E8Kv7l",
                        "created": 1762956422,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        }
    },
    "16": {
        "0": {
            "req_id": "16",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "non_detection",
                "detection",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'non_detection', 'detection', 'magstat']",
                    "1": "['object', 'probability', 'taxonomy', 'magstat', 'detection', 'non_detection']"
                },
                "in_toks": 692,
                "out_toks": 4350,
                "id": "chatcmpl-CSnRmqqE3lmLl6qHtfNw2Pfv1DIXI",
                "created": 1760979294,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query: prefilter by stamp SN and object.firstmjd window, use LATERAL to get first detection per OID (only filtering detection by oid), align magstat by first fid, compute fast risers, then fetch non-detections up to first detection.\nWITH stamp_sn AS\n  (-- Ensure at least three conditions on probability for selectivity\n SELECT p.oid,\n        p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1),\n     window_oids AS\n  (-- Restrict to first detections within 2023-09-01 to 2023-09-02 (MJD [60188.0, 60190.0))\n -- Using object.firstmjd avoids scanning detection here\n SELECT s.oid,\n        s.probability\n   FROM stamp_sn s\n   JOIN OBJECT o ON o.oid = s.oid\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n     first_det AS\n  (-- Fetch the earliest detection row per OID using only oid filter (fast path)\n SELECT w.oid,\n        w.probability,\n        fd.first_mjd,\n        fd.first_fid,\n        fd.first_isdiffpos\n   FROM window_oids w\n   CROSS JOIN LATERAL\n     (SELECT d.mjd AS first_mjd,\n             d.fid AS first_fid,\n             d.isdiffpos AS first_isdiffpos\n      FROM detection d\n      WHERE d.oid = w.oid\n      ORDER BY d.mjd ASC,\n               d.candid ASC\n      LIMIT 1) fd),\n     fast AS\n  (-- Align magstat to the first detection's filter and compute initial rise\n SELECT f.oid,\n        f.probability,\n        f.first_mjd,\n        f.first_fid,\n        f.first_isdiffpos,\n        ms.fid AS magstat_fid,\n        COALESCE(ms.dmdt_first, CASE\n                                    WHEN ms.dt_first > 0 THEN ms.dm_first / ms.dt_first\n                                END) AS initial_rise\n   FROM first_det f\n   JOIN magstat ms ON ms.oid = f.oid\n   AND ms.fid = f.first_fid\n   WHERE COALESCE(ms.dmdt_first, CASE\n                                     WHEN ms.dt_first > 0 THEN ms.dm_first / ms.dt_first\n                                 END) <= -0.25),\n     nond AS\n  (-- Non-detections in the same filter up to the first detection epoch\n SELECT nd.oid,\n        nd.fid,\n        nd.mjd,\n        nd.diffmaglim\n   FROM non_detection nd\n   JOIN fast f ON f.oid = nd.oid\n   WHERE nd.fid = f.first_fid\n     AND nd.mjd <= f.first_mjd)\nSELECT n.oid,\n       f.probability,\n       f.first_fid AS fid,\n       f.first_isdiffpos AS isdiffpos,\n       f.magstat_fid,\n       f.initial_rise,\n       n.mjd,\n       n.fid AS non_detection_fid,\n       n.diffmaglim\nFROM nond n\nJOIN fast f ON f.oid = n.oid\nORDER BY n.oid\nLIMIT 100;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query: prefilter by stamp SN and object.firstmjd window, use LATERAL to get first detection per OID (only filtering detection by oid), align magstat by first fid, compute fast risers, then fetch non-detections up to first detection.\nWITH stamp_sn AS\n  (-- Ensure at least three conditions on probability for selectivity\n SELECT p.oid,\n        p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1),\n     window_oids AS\n  (-- Restrict to first detections within 2023-09-01 to 2023-09-02 (MJD [60188.0, 60190.0))\n -- Using object.firstmjd avoids scanning detection here\n SELECT s.oid,\n        s.probability\n   FROM stamp_sn s\n   JOIN OBJECT o ON o.oid = s.oid\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n     first_det AS\n  (-- Fetch the earliest detection row per OID using only oid filter (fast path)\n SELECT w.oid,\n        w.probability,\n        fd.first_mjd,\n        fd.first_fid,\n        fd.first_isdiffpos\n   FROM window_oids w\n   CROSS JOIN LATERAL\n     (SELECT d.mjd AS first_mjd,\n             d.fid AS first_fid,\n             d.isdiffpos AS first_isdiffpos\n      FROM detection d\n      WHERE d.oid = w.oid\n      ORDER BY d.mjd ASC,\n               d.candid ASC\n      LIMIT 1) fd),\n     fast AS\n  (-- Align magstat to the first detection's filter and compute initial rise\n SELECT f.oid,\n        f.probability,\n        f.first_mjd,\n        f.first_fid,\n        f.first_isdiffpos,\n        ms.fid AS magstat_fid,\n        COALESCE(ms.dmdt_first, CASE\n                                    WHEN ms.dt_first > 0 THEN ms.dm_first / ms.dt_first\n                                END) AS initial_rise\n   FROM first_det f\n   JOIN magstat ms ON ms.oid = f.oid\n   AND ms.fid = f.first_fid\n   WHERE COALESCE(ms.dmdt_first, CASE\n                                     WHEN ms.dt_first > 0 THEN ms.dm_first / ms.dt_first\n                                 END) <= -0.25),\n     nond AS\n  (-- Non-detections in the same filter up to the first detection epoch\n SELECT nd.oid,\n        nd.fid,\n        nd.mjd,\n        nd.diffmaglim\n   FROM non_detection nd\n   JOIN fast f ON f.oid = nd.oid\n   WHERE nd.fid = f.first_fid\n     AND nd.mjd <= f.first_mjd)\nSELECT n.oid,\n       f.probability,\n       f.first_fid AS fid,\n       f.first_isdiffpos AS isdiffpos,\n       f.magstat_fid,\n       f.initial_rise,\n       n.mjd,\n       n.fid AS non_detection_fid,\n       n.diffmaglim\nFROM nond n\nJOIN fast f ON f.oid = n.oid\nORDER BY n.oid\nLIMIT 100;"
                },
                "in_toks": 4411,
                "out_toks": 4042,
                "id": "chatcmpl-CbGmTT5eb93zVPz4XI4UEYV0NduZ0",
                "created": 1762998677,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2597,
                "out_toks": 1295,
                "id": "chatcmpl-CSnhSjOdMIjnBTbMZps9JQcBj1jDL",
                "created": 1760980266,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Objects with top-ranked 'SN' in the stamp classifier\nWITH S_stamp_sn AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'SN'), -- First detection time per OID (prefiltered by stamp SN)\nS_first_det_min AS\n  (SELECT d.oid,\n          MIN(d.mjd) AS first_mjd\n   FROM detection d\n   INNER JOIN S_stamp_sn s ON s.oid = d.oid\n   GROUP BY d.oid), -- Materialize the earliest detection row (including fid and isdiffpos)\nS_first_det_row AS\n  (SELECT DISTINCT ON (d.oid) d.oid,\n                      d.mjd AS first_mjd,\n                      d.fid AS first_fid,\n                      d.isdiffpos AS first_isdiffpos\n   FROM detection d\n   INNER JOIN S_first_det_min m ON d.oid = m.oid\n   AND d.mjd = m.first_mjd\n   ORDER BY d.oid,\n            d.candid), -- Restrict first detection to Sept 1\u20132 window [60188.0, 60190.0)\nS_first_det_window AS\n  (SELECT r.oid,\n          r.first_mjd,\n          r.first_fid,\n          r.first_isdiffpos\n   FROM S_first_det_row r\n   WHERE r.first_mjd >= 60188.0\n     AND r.first_mjd < 60190.0), -- Align magstat to the first-detection filter\nS_magstat_match AS\n  (SELECT ms.oid,\n          ms.fid AS magstat_fid,\n          ms.dmdt_first,\n          ms.dm_first,\n          ms.dt_first\n   FROM magstat ms\n   INNER JOIN S_first_det_window f ON ms.oid = f.oid\n   AND ms.fid = f.first_fid), -- Fast risers using dmdt_first\nS_fast_risers_dmdt AS\n  (SELECT m.oid,\n          m.magstat_fid,\n          m.dmdt_first AS initial_rise\n   FROM S_magstat_match m\n   WHERE m.dmdt_first IS NOT NULL\n     AND m.dmdt_first <= -0.25), -- Fast risers using dm_first/dt_first when dmdt_first is NULL\nS_fast_risers_ratio AS\n  (SELECT m.oid,\n          m.magstat_fid,\n          (m.dm_first / NULLIF(m.dt_first, 0)) AS initial_rise\n   FROM S_magstat_match m\n   WHERE m.dmdt_first IS NULL\n     AND m.dt_first > 0\n     AND (m.dm_first / NULLIF(m.dt_first, 0)) <= -0.25), -- Union of both fast-riser pathways\nS_fast_risers AS\n  (SELECT *\n   FROM S_fast_risers_dmdt\n   UNION SELECT *\n   FROM S_fast_risers_ratio), -- Candidate OIDs that satisfy all three: stamp SN, first-det window, fast riser\nS_candidates AS\n  (SELECT s.oid\n   FROM S_stamp_sn s\n   INNER JOIN S_first_det_window f ON f.oid = s.oid\n   INNER JOIN S_fast_risers fr ON fr.oid = s.oid\n   GROUP BY s.oid), -- Non-detections in the same filter as the first detection, up to the first detection epoch\nS_non_det_same_fid AS\n  (SELECT nd.oid,\n          nd.fid,\n          nd.mjd,\n          nd.diffmaglim\n   FROM non_detection nd\n   INNER JOIN S_candidates c ON c.oid = nd.oid\n   INNER JOIN S_first_det_window f ON f.oid = nd.oid\n   AND nd.fid = f.first_fid\n   WHERE nd.mjd <= f.first_mjd) -- Final projection: oid, stamp probability, first-detection filter info and sign, magstat_fid, initial_rise, and non-detection light curve points\n\nSELECT nd.oid,\n       s.probability,\n       f.first_fid AS fid,\n       f.first_isdiffpos AS isdiffpos,\n       fr.magstat_fid,\n       fr.initial_rise,\n       nd.mjd,\n       nd.fid AS non_detection_fid,\n       nd.diffmaglim\nFROM S_non_det_same_fid nd\nINNER JOIN S_stamp_sn s ON s.oid = nd.oid\nINNER JOIN S_first_det_window f ON f.oid = nd.oid\nINNER JOIN S_fast_risers fr ON fr.oid = nd.oid\nORDER BY nd.oid\nLIMIT 100;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Establish constants\n- Time window for first detection: mjd in [60188.0, 60190.0).\n- Fast-riser threshold: at least 0.25 mag/day brightening. Use a negative slope in magnitude, so threshold = -0.25 mag/day.\n\n2) Subquery S_stamp_sn (filter by stamp classifier, highest-probability SN)\n- Table: probability\n- Columns: oid, probability\n- Conditions:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.ranking = 1\n  - probability.class_name = 'SN'\n- Purpose: restrict to objects whose top stamp-classifier class is SN and keep the associated probability to return.\n\n3) Subquery S_first_det_min (earliest detection per object)\n- Table: detection\n- Input: oids from S_stamp_sn (inner join on detection.oid = S_stamp_sn.oid to pre-filter)\n- Columns: oid, MIN(mjd) AS first_mjd\n- Group by: oid\n- Purpose: compute the first detection time per oid.\n\n4) Subquery S_first_det_row (materialize the earliest detection row)\n- Tables: detection INNER JOIN S_first_det_min\n- Join keys:\n  - detection.oid = S_first_det_min.oid\n  - detection.mjd = S_first_det_min.first_mjd\n- Columns to keep from detection (needed later): oid, mjd, fid, isdiffpos\n- Purpose: get the detection row corresponding to the earliest detection (including its fid and isdiffpos).\n\n5) Subquery S_first_det_window (enforce the September 1\u20132 window)\n- Input: S_first_det_row\n- Condition on mjd:\n  - S_first_det_row.mjd >= 60188.0 AND S_first_det_row.mjd < 60190.0\n- Columns: oid, mjd AS first_mjd, fid AS first_fid, isdiffpos AS first_isdiffpos\n- Purpose: keep only objects whose first detection falls in the requested window and carry forward the first detection fid and isdiffpos.\n\n6) Subquery S_magstat_match (align magstat to the first-detection filter)\n- Tables: magstat INNER JOIN S_first_det_window\n- Join keys:\n  - magstat.oid = S_first_det_window.oid\n  - magstat.fid = S_first_det_window.first_fid\n- Columns to keep from magstat for fast-rise calculation and return:\n  - oid, fid (alias as magstat_fid), dmdt_first, dm_first, dt_first\n- Purpose: ensure fast-rise is evaluated in the same filter as the first detection.\n\n7) Fast-riser sets (two alternative computations) and UNION\n- Subquery S_fast_risers_dmdt\n  - Input: S_magstat_match\n  - Condition: dmdt_first IS NOT NULL AND dmdt_first <= -0.25\n  - Columns: oid, magstat_fid (= fid), initial_rise = dmdt_first\n- Subquery S_fast_risers_ratio\n  - Input: S_magstat_match\n  - Conditions: dmdt_first IS NULL AND dt_first > 0 AND (dm_first / dt_first) <= -0.25\n  - Columns: oid, magstat_fid (= fid), initial_rise = (dm_first / dt_first)\n- Subquery S_fast_risers\n  - UNION the results of S_fast_risers_dmdt and S_fast_risers_ratio (use UNION, not UNION ALL, to deduplicate).\n- Purpose: build a complete set of fast risers using dmdt_first when available, otherwise the dm_first/dt_first ratio.\n\n8) Build set intersections to form the candidate OIDs\n- Subquery S_oids_stamp: SELECT oid FROM S_stamp_sn\n- Subquery S_oids_firstwin: SELECT oid FROM S_first_det_window\n- Subquery S_oids_fast: SELECT oid FROM S_fast_risers\n- Subquery S_candidates_oids:\n  - INTERSECT S_oids_stamp, S_oids_firstwin, and S_oids_fast to obtain the final candidate OIDs set.\n\n9) Subquery S_non_det_same_fid (non-detections for the light curves in the same filter as the first detection, up to the first detection epoch)\n- Tables: non_detection INNER JOIN S_candidates_oids INNER JOIN S_first_det_window\n- Join keys and filter:\n  - non_detection.oid = S_candidates_oids.oid\n  - non_detection.oid = S_first_det_window.oid\n  - non_detection.fid = S_first_det_window.first_fid\n  - Optionally restrict to non_detection.mjd <= S_first_det_window.first_mjd to include only pre-first-detection non-detections (consistent with the fast-riser definition).\n- Columns: non_detection.* (mjd, fid, diffmaglim) to provide the non-detection light curve points.\n- Purpose: return the light curves (only non-detections) in the same band used to assess the rise.\n\n10) Final assembly (JOINs to attach all required fields)\n- Start from S_non_det_same_fid (this defines one row per non-detection).\n- INNER JOIN S_stamp_sn ON oid (to bring stamp classifier probability; alias as stamp_probability).\n- INNER JOIN S_first_det_window ON oid (to return filter ID and image difference from the first detection):\n  - Return: first_fid AS fid\n  - Return: first_isdiffpos AS isdiffpos (the difference-image sign for the first detection)\n- INNER JOIN S_fast_risers ON oid (to bring magstat_fid and initial_rise):\n  - Return: magstat_fid\n  - Return: initial_rise\n- Projection (columns to return):\n  - oid\n  - stamp_probability (from S_stamp_sn.probability)\n  - fid (from S_first_det_window.first_fid; this is the first detection filter ID)\n  - isdiffpos (from S_first_det_window.first_isdiffpos)\n  - magstat_fid (from S_fast_risers)\n  - initial_rise (from S_fast_risers; computed as dmdt_first or dm_first/dt_first)\n  - All columns from non_detection (non_detection.*) to provide the \u201clight curves (including only non-detections)\u201d\n- Note: If desired, you can additionally include object.firstmjd for reference by joining object on oid, but it is not required by the request.\n\n11) Ordering and limiting\n- ORDER BY oid (you may add non_detection.mjd as a secondary sort key if ordered light-curve points are useful, but the request only mandates ordering by oid).\n- LIMIT 100.\n\n12) Index/efficiency notes\n- The filter on probability leverages ix_classification_rank1 (ranking = 1) and equality on classifier_name = 'stamp_classifier' and class_name = 'SN'.\n- Pre-filter detection by the oids from S_stamp_sn before grouping MIN(mjd) to reduce the grouping set size (use the inner join as described).\n- Use join on (oid, fid) to magstat to keep band-consistency for fast-rise testing.\n- Keep the non_detection join constrained by both oid and fid (and optionally mjd <= first_mjd) to minimize the number of returned rows.\n\nSummary of subqueries and their roles\n- S_stamp_sn: OIDs with top stamp-class SN and their probabilities.\n- S_first_det_min: First detection time per OID.\n- S_first_det_row: Details of the first detection (fid, isdiffpos).\n- S_first_det_window: Restrict first detection to Sept 1\u20132 window; carry first_fid and isdiffpos.\n- S_magstat_match: Align magstat rows with first detection filter.\n- S_fast_risers_dmdt / S_fast_risers_ratio: Two pathway checks for fast risers; UNIONed in S_fast_risers.\n- S_candidates_oids: INTERSECT of OID sets from stamp SN, first-detection window, and fast risers.\n- S_non_det_same_fid: Non-detection light-curve points in the same filter (optionally only pre-first-detection).\n- Final SELECT: Join all pieces; return requested fields; ORDER BY oid; LIMIT 100."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Establish constants\n- Time window for first detection: mjd in [60188.0, 60190.0).\n- Fast-riser threshold: at least 0.25 mag/day brightening. Use a negative slope in magnitude, so threshold = -0.25 mag/day.\n\n2) Subquery S_stamp_sn (filter by stamp classifier, highest-probability SN)\n- Table: probability\n- Columns: oid, probability\n- Conditions:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.ranking = 1\n  - probability.class_name = 'SN'\n- Purpose: restrict to objects whose top stamp-classifier class is SN and keep the associated probability to return.\n\n3) Subquery S_first_det_min (earliest detection per object)\n- Table: detection\n- Input: oids from S_stamp_sn (inner join on detection.oid = S_stamp_sn.oid to pre-filter)\n- Columns: oid, MIN(mjd) AS first_mjd\n- Group by: oid\n- Purpose: compute the first detection time per oid.\n\n4) Subquery S_first_det_row (materialize the earliest detection row)\n- Tables: detection INNER JOIN S_first_det_min\n- Join keys:\n  - detection.oid = S_first_det_min.oid\n  - detection.mjd = S_first_det_min.first_mjd\n- Columns to keep from detection (needed later): oid, mjd, fid, isdiffpos\n- Purpose: get the detection row corresponding to the earliest detection (including its fid and isdiffpos).\n\n5) Subquery S_first_det_window (enforce the September 1\u20132 window)\n- Input: S_first_det_row\n- Condition on mjd:\n  - S_first_det_row.mjd >= 60188.0 AND S_first_det_row.mjd < 60190.0\n- Columns: oid, mjd AS first_mjd, fid AS first_fid, isdiffpos AS first_isdiffpos\n- Purpose: keep only objects whose first detection falls in the requested window and carry forward the first detection fid and isdiffpos.\n\n6) Subquery S_magstat_match (align magstat to the first-detection filter)\n- Tables: magstat INNER JOIN S_first_det_window\n- Join keys:\n  - magstat.oid = S_first_det_window.oid\n  - magstat.fid = S_first_det_window.first_fid\n- Columns to keep from magstat for fast-rise calculation and return:\n  - oid, fid (alias as magstat_fid), dmdt_first, dm_first, dt_first\n- Purpose: ensure fast-rise is evaluated in the same filter as the first detection.\n\n7) Fast-riser sets (two alternative computations) and UNION\n- Subquery S_fast_risers_dmdt\n  - Input: S_magstat_match\n  - Condition: dmdt_first IS NOT NULL AND dmdt_first <= -0.25\n  - Columns: oid, magstat_fid (= fid), initial_rise = dmdt_first\n- Subquery S_fast_risers_ratio\n  - Input: S_magstat_match\n  - Conditions: dmdt_first IS NULL AND dt_first > 0 AND (dm_first / dt_first) <= -0.25\n  - Columns: oid, magstat_fid (= fid), initial_rise = (dm_first / dt_first)\n- Subquery S_fast_risers\n  - UNION the results of S_fast_risers_dmdt and S_fast_risers_ratio (use UNION, not UNION ALL, to deduplicate).\n- Purpose: build a complete set of fast risers using dmdt_first when available, otherwise the dm_first/dt_first ratio.\n\n8) Build set intersections to form the candidate OIDs\n- Subquery S_oids_stamp: SELECT oid FROM S_stamp_sn\n- Subquery S_oids_firstwin: SELECT oid FROM S_first_det_window\n- Subquery S_oids_fast: SELECT oid FROM S_fast_risers\n- Subquery S_candidates_oids:\n  - INTERSECT S_oids_stamp, S_oids_firstwin, and S_oids_fast to obtain the final candidate OIDs set.\n\n9) Subquery S_non_det_same_fid (non-detections for the light curves in the same filter as the first detection, up to the first detection epoch)\n- Tables: non_detection INNER JOIN S_candidates_oids INNER JOIN S_first_det_window\n- Join keys and filter:\n  - non_detection.oid = S_candidates_oids.oid\n  - non_detection.oid = S_first_det_window.oid\n  - non_detection.fid = S_first_det_window.first_fid\n  - Optionally restrict to non_detection.mjd <= S_first_det_window.first_mjd to include only pre-first-detection non-detections (consistent with the fast-riser definition).\n- Columns: non_detection.* (mjd, fid, diffmaglim) to provide the non-detection light curve points.\n- Purpose: return the light curves (only non-detections) in the same band used to assess the rise.\n\n10) Final assembly (JOINs to attach all required fields)\n- Start from S_non_det_same_fid (this defines one row per non-detection).\n- INNER JOIN S_stamp_sn ON oid (to bring stamp classifier probability; alias as stamp_probability).\n- INNER JOIN S_first_det_window ON oid (to return filter ID and image difference from the first detection):\n  - Return: first_fid AS fid\n  - Return: first_isdiffpos AS isdiffpos (the difference-image sign for the first detection)\n- INNER JOIN S_fast_risers ON oid (to bring magstat_fid and initial_rise):\n  - Return: magstat_fid\n  - Return: initial_rise\n- Projection (columns to return):\n  - oid\n  - stamp_probability (from S_stamp_sn.probability)\n  - fid (from S_first_det_window.first_fid; this is the first detection filter ID)\n  - isdiffpos (from S_first_det_window.first_isdiffpos)\n  - magstat_fid (from S_fast_risers)\n  - initial_rise (from S_fast_risers; computed as dmdt_first or dm_first/dt_first)\n  - All columns from non_detection (non_detection.*) to provide the \u201clight curves (including only non-detections)\u201d\n- Note: If desired, you can additionally include object.firstmjd for reference by joining object on oid, but it is not required by the request.\n\n11) Ordering and limiting\n- ORDER BY oid (you may add non_detection.mjd as a secondary sort key if ordered light-curve points are useful, but the request only mandates ordering by oid).\n- LIMIT 100.\n\n12) Index/efficiency notes\n- The filter on probability leverages ix_classification_rank1 (ranking = 1) and equality on classifier_name = 'stamp_classifier' and class_name = 'SN'.\n- Pre-filter detection by the oids from S_stamp_sn before grouping MIN(mjd) to reduce the grouping set size (use the inner join as described).\n- Use join on (oid, fid) to magstat to keep band-consistency for fast-rise testing.\n- Keep the non_detection join constrained by both oid and fid (and optionally mjd <= first_mjd) to minimize the number of returned rows.\n\nSummary of subqueries and their roles\n- S_stamp_sn: OIDs with top stamp-class SN and their probabilities.\n- S_first_det_min: First detection time per OID.\n- S_first_det_row: Details of the first detection (fid, isdiffpos).\n- S_first_det_window: Restrict first detection to Sept 1\u20132 window; carry first_fid and isdiffpos.\n- S_magstat_match: Align magstat rows with first detection filter.\n- S_fast_risers_dmdt / S_fast_risers_ratio: Two pathway checks for fast risers; UNIONed in S_fast_risers.\n- S_candidates_oids: INTERSECT of OID sets from stamp SN, first-detection window, and fast risers.\n- S_non_det_same_fid: Non-detection light-curve points in the same filter (optionally only pre-first-detection).\n- Final SELECT: Join all pieces; return requested fields; ORDER BY oid; LIMIT 100."
                    },
                    "in_toks": 4555,
                    "out_toks": 8029,
                    "id": "chatcmpl-Cb5nZMpdKilrw8BXwGDHDVyASIr00",
                    "created": 1762956461,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Objects with top-ranked 'SN' in the stamp classifier\nWITH S_stamp_sn AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'SN'), -- First detection time per OID (prefiltered by stamp SN)\nS_first_det_min AS\n  (SELECT d.oid,\n          MIN(d.mjd) AS first_mjd\n   FROM detection d\n   INNER JOIN S_stamp_sn s ON s.oid = d.oid\n   GROUP BY d.oid), -- Materialize the earliest detection row (including fid and isdiffpos)\nS_first_det_row AS\n  (SELECT DISTINCT ON (d.oid) d.oid,\n                      d.mjd AS first_mjd,\n                      d.fid AS first_fid,\n                      d.isdiffpos AS first_isdiffpos\n   FROM detection d\n   INNER JOIN S_first_det_min m ON d.oid = m.oid\n   AND d.mjd = m.first_mjd\n   ORDER BY d.oid,\n            d.candid), -- Restrict first detection to Sept 1\u20132 window [60188.0, 60190.0)\nS_first_det_window AS\n  (SELECT r.oid,\n          r.first_mjd,\n          r.first_fid,\n          r.first_isdiffpos\n   FROM S_first_det_row r\n   WHERE r.first_mjd >= 60188.0\n     AND r.first_mjd < 60190.0), -- Align magstat to the first-detection filter\nS_magstat_match AS\n  (SELECT ms.oid,\n          ms.fid AS magstat_fid,\n          ms.dmdt_first,\n          ms.dm_first,\n          ms.dt_first\n   FROM magstat ms\n   INNER JOIN S_first_det_window f ON ms.oid = f.oid\n   AND ms.fid = f.first_fid), -- Fast risers using dmdt_first\nS_fast_risers_dmdt AS\n  (SELECT m.oid,\n          m.magstat_fid,\n          m.dmdt_first AS initial_rise\n   FROM S_magstat_match m\n   WHERE m.dmdt_first IS NOT NULL\n     AND m.dmdt_first <= -0.25), -- Fast risers using dm_first/dt_first when dmdt_first is NULL\nS_fast_risers_ratio AS\n  (SELECT m.oid,\n          m.magstat_fid,\n          (m.dm_first / NULLIF(m.dt_first, 0)) AS initial_rise\n   FROM S_magstat_match m\n   WHERE m.dmdt_first IS NULL\n     AND m.dt_first > 0\n     AND (m.dm_first / NULLIF(m.dt_first, 0)) <= -0.25), -- Union of both fast-riser pathways\nS_fast_risers AS\n  (SELECT *\n   FROM S_fast_risers_dmdt\n   UNION SELECT *\n   FROM S_fast_risers_ratio), -- Candidate OIDs that satisfy all three: stamp SN, first-det window, fast riser\nS_candidates AS\n  (SELECT s.oid\n   FROM S_stamp_sn s\n   INNER JOIN S_first_det_window f ON f.oid = s.oid\n   INNER JOIN S_fast_risers fr ON fr.oid = s.oid\n   GROUP BY s.oid), -- Non-detections in the same filter as the first detection, up to the first detection epoch\nS_non_det_same_fid AS\n  (SELECT nd.oid,\n          nd.fid,\n          nd.mjd,\n          nd.diffmaglim\n   FROM non_detection nd\n   INNER JOIN S_candidates c ON c.oid = nd.oid\n   INNER JOIN S_first_det_window f ON f.oid = nd.oid\n   AND nd.fid = f.first_fid\n   WHERE nd.mjd <= f.first_mjd) -- Final projection: oid, stamp probability, first-detection filter info and sign, magstat_fid, initial_rise, and non-detection light curve points\n\nSELECT nd.oid,\n       s.probability,\n       f.first_fid AS fid,\n       f.first_isdiffpos AS isdiffpos,\n       fr.magstat_fid,\n       fr.initial_rise,\n       nd.mjd,\n       nd.fid AS non_detection_fid,\n       nd.diffmaglim\nFROM S_non_det_same_fid nd\nINNER JOIN S_stamp_sn s ON s.oid = nd.oid\nINNER JOIN S_first_det_window f ON f.oid = nd.oid\nINNER JOIN S_fast_risers fr ON fr.oid = nd.oid\nORDER BY nd.oid\nLIMIT 100;"
                        },
                        "in_toks": 4964,
                        "out_toks": 5246,
                        "id": "chatcmpl-Cb5pRobMaeDjCocxYV9QGVV4QSLrC",
                        "created": 1762956577,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "1": {
            "req_id": "16",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "magstat",
                "detection",
                "non_detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'non_detection', 'detection', 'magstat']",
                    "1": "['object', 'probability', 'taxonomy', 'magstat', 'detection', 'non_detection']"
                },
                "in_toks": 692,
                "out_toks": 4350,
                "id": "chatcmpl-CSnRmqqE3lmLl6qHtfNw2Pfv1DIXI",
                "created": 1760979294,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "/* Optimized query:\n   - Uses object.firstmjd to avoid scanning detections for min(mjd)\n   - Restricts early by probability (stamp_classifier, SN, ranking=1) and firstmjd window\n   - Joins to the single first detection row via (oid, firstmjd)\n   - Checks fast risers in magstat for the same filter as first detection\n   - Returns only non-detections up to first detection time\n*/ WITH prob_sn AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1),\n        objs AS\n  (SELECT o.oid,\n          o.firstmjd\n   FROM OBJECT o\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n        first_det AS\n  (/* First detection row via equality to object.firstmjd */  SELECT d.oid,\n                                                                     d.fid AS first_det_fid,\n                                                                     d.isdiffpos\n   FROM detection d\n   JOIN objs o ON o.oid = d.oid\n   AND d.mjd = o.firstmjd),\n        fast_risers AS\n  (/* Same-filter fast risers */  SELECT fd.oid,\n                                         ms.fid AS magstat_fid,\n                                         ms.dmdt_first\n   FROM first_det fd\n   JOIN magstat ms ON ms.oid = fd.oid\n   AND ms.fid = fd.first_det_fid\n   WHERE ms.dmdt_first <= -0.25),\n        enriched AS\n  (/* Objects meeting all criteria */  SELECT o.oid,\n                                              ps.probability,\n                                              o.firstmjd,\n                                              fd.first_det_fid,\n                                              fd.isdiffpos,\n                                              fr.magstat_fid,\n                                              fr.dmdt_first\n   FROM objs o\n   JOIN prob_sn ps ON ps.oid = o.oid\n   JOIN first_det fd ON fd.oid = o.oid\n   JOIN fast_risers fr ON fr.oid = o.oid)\nSELECT e.oid,\n       e.probability,\n       nd.fid, -- non-detection filter ID\n e.isdiffpos, -- image difference sign from first detection\n e.magstat_fid, -- magstat filter ID\n e.dmdt_first, -- initial rise estimate\n nd.mjd, -- non-detection time\n nd.diffmaglim -- non-detection magnitude limit\nFROM enriched e\nJOIN non_detection nd ON nd.oid = e.oid\nAND nd.mjd <= e.firstmjd\nORDER BY e.oid\nLIMIT 100;",
            "sql_response": {
                "responses": {
                    "0": "/* Optimized query:\n   - Uses object.firstmjd to avoid scanning detections for min(mjd)\n   - Restricts early by probability (stamp_classifier, SN, ranking=1) and firstmjd window\n   - Joins to the single first detection row via (oid, firstmjd)\n   - Checks fast risers in magstat for the same filter as first detection\n   - Returns only non-detections up to first detection time\n*/ WITH prob_sn AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1),\n        objs AS\n  (SELECT o.oid,\n          o.firstmjd\n   FROM OBJECT o\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n        first_det AS\n  (/* First detection row via equality to object.firstmjd */  SELECT d.oid,\n                                                                     d.fid AS first_det_fid,\n                                                                     d.isdiffpos\n   FROM detection d\n   JOIN objs o ON o.oid = d.oid\n   AND d.mjd = o.firstmjd),\n        fast_risers AS\n  (/* Same-filter fast risers */  SELECT fd.oid,\n                                         ms.fid AS magstat_fid,\n                                         ms.dmdt_first\n   FROM first_det fd\n   JOIN magstat ms ON ms.oid = fd.oid\n   AND ms.fid = fd.first_det_fid\n   WHERE ms.dmdt_first <= -0.25),\n        enriched AS\n  (/* Objects meeting all criteria */  SELECT o.oid,\n                                              ps.probability,\n                                              o.firstmjd,\n                                              fd.first_det_fid,\n                                              fd.isdiffpos,\n                                              fr.magstat_fid,\n                                              fr.dmdt_first\n   FROM objs o\n   JOIN prob_sn ps ON ps.oid = o.oid\n   JOIN first_det fd ON fd.oid = o.oid\n   JOIN fast_risers fr ON fr.oid = o.oid)\nSELECT e.oid,\n       e.probability,\n       nd.fid, -- non-detection filter ID\n e.isdiffpos, -- image difference sign from first detection\n e.magstat_fid, -- magstat filter ID\n e.dmdt_first, -- initial rise estimate\n nd.mjd, -- non-detection time\n nd.diffmaglim -- non-detection magnitude limit\nFROM enriched e\nJOIN non_detection nd ON nd.oid = e.oid\nAND nd.mjd <= e.firstmjd\nORDER BY e.oid\nLIMIT 100;"
                },
                "in_toks": 3943,
                "out_toks": 3783,
                "id": "chatcmpl-CbGo2VK6q4pINFUFbxPLSGXunR70M",
                "created": 1762998774,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2597,
                "out_toks": 1103,
                "id": "chatcmpl-CSnhm3IgrlqAFkPATOhR5XXcyBa8M",
                "created": 1760980286,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "/* Objects whose top-ranked stamp classifier class is 'SN',\n   first detection within MJD [60188.0, 60190.0) (Sept 1\u20132),\n   and fast risers (same-filter dmdt_first <= -0.25 mag/day).\n   Return per-object non-detections with requested fields. */ WITH prob_sn AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1),\n                                                                   objs_window AS\n  (SELECT o.oid,\n          o.firstmjd\n   FROM OBJECT o\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n                                                                   min_det AS\n  (/* Earliest detection per object, restrict detection by oid for performance */  SELECT d.oid,\n                                                                                          MIN(d.mjd) AS first_det_mjd\n   FROM detection d\n   WHERE d.oid IN\n       (SELECT oid\n        FROM objs_window)\n   GROUP BY d.oid),\n                                                                   first_det AS\n  (/* Attach first detection fid and image difference sign */  SELECT d.oid,\n                                                                      md.first_det_mjd,\n                                                                      d.fid AS first_det_fid,\n                                                                      d.isdiffpos\n   FROM min_det md\n   INNER JOIN detection d ON d.oid = md.oid\n   AND d.mjd = md.first_det_mjd),\n                                                                   first_det_in_window AS\n  (SELECT fd.oid\n   FROM first_det fd\n   WHERE fd.first_det_mjd >= 60188.0\n     AND fd.first_det_mjd < 60190.0),\n                                                                   fast_risers AS\n  (/* Fast riser in the same filter as the first detection */  SELECT fd.oid,\n                                                                      ms.fid AS magstat_fid,\n                                                                      ms.dmdt_first\n   FROM first_det fd\n   INNER JOIN magstat ms ON ms.oid = fd.oid\n   AND ms.fid = fd.first_det_fid\n   WHERE ms.dmdt_first <= -0.25),\n                                                                   candidates AS\n  (/* Enforce all criteria via INTERSECT */  SELECT oid\n   FROM prob_sn INTERSECT SELECT oid\n   FROM objs_window INTERSECT SELECT oid\n   FROM first_det_in_window INTERSECT SELECT oid\n   FROM fast_risers),\n                                                                   enriched AS\n  (/* Consolidate per-object info needed for final output */  SELECT c.oid,\n                                                                     psn.probability,\n                                                                     fd.first_det_mjd,\n                                                                     fd.first_det_fid,\n                                                                     fd.isdiffpos,\n                                                                     fr.magstat_fid,\n                                                                     fr.dmdt_first\n   FROM candidates c\n   INNER JOIN prob_sn psn ON psn.oid = c.oid\n   INNER JOIN first_det fd ON fd.oid = c.oid\n   INNER JOIN fast_risers fr ON fr.oid = c.oid)\nSELECT e.oid,\n       e.probability,\n       nd.fid, /* filter ID from non_detection */  e.isdiffpos, /* image difference sign from first detection */  e.magstat_fid, /* magstat filter ID */  e.dmdt_first, /* initial rise estimate */  nd.mjd, /* non-detection time */  nd.diffmaglim /* non-detection magnitude limit */\nFROM enriched e\nINNER JOIN non_detection nd ON nd.oid = e.oid /* Include only non-detections up to the first detection time */\nAND nd.mjd <= e.first_det_mjd\nORDER BY e.oid\nLIMIT 100;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nReturn, for up to 100 objects:\n- Only objects whose top-ranked (ranking=1) stamp classifier class is 'SN'.\n- With first detection in the first two days of September (MJD in [60188.0, 60190.0)).\n- That qualify as fast risers (same-filter initial rise rate at least 0.25 mag/day brighter).\n- Output per object and associated non-detection light-curve rows: oid, probability (from stamp classifier), filter ID (from non_detection), image difference (isdiffpos of the first detection), magstat.fid as magstat_fid, initial rise estimate (dmdt_first), and non-detection time and limit.\n- Order by oid, limit 100.\n\nSchema/tables/columns used\n- probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n- object(oid, firstmjd, \u2026)\n- detection(oid, mjd, fid, isdiffpos, \u2026)\n- magstat(oid, fid, dmdt_first, \u2026)\n- non_detection(oid, fid, mjd, diffmaglim)\n\nFixed constants\n- MJD window for \u201cfirst two days of September\u201d: start_mjd = 60188.0, end_mjd = 60190.0 (use [start_mjd, end_mjd) for inclusive 1\u20132 September).\n- Fast riser threshold: dmdt_first <= -0.25 mag/day (brightening rate; negative sign indicates brightening).\n\nHigh-level structure (use CTEs, nested subqueries, INTERSECT, JOINs)\n1) Subquery: top-ranked SNs in stamp classifier\n- From probability, select only:\n  - classifier_name = 'stamp_classifier'\n  - class_name = 'SN'\n  - ranking = 1\n- Columns: oid, probability\n- Purpose: enforce \u201chighest probability in stamp classifier is SN\u201d and bring the probability value.\n- Note: deliberately override the default classifier_name (the user explicitly requests stamp_classifier).\n\n2) Subquery: objects with first detection in date window (object-level)\n- From object, filter: firstmjd >= 60188.0 AND firstmjd < 60190.0\n- Columns: oid, firstmjd\n- Purpose: fast prefilter by index and align with \u201cfirst detection in the first 2 days of September.\u201d\n\n3) Subquery: first detection per object (detection-level)\n- From detection, restricted to oids in step (2) to leverage ix_ndetection_oid:\n  - For each oid, select the earliest detection row:\n    - Use a grouped subquery to compute MIN(mjd) per oid, then join back to detection on (oid, mjd) to retrieve fid and isdiffpos.\n  - Columns: oid, mjd AS first_det_mjd, fid AS first_det_fid, isdiffpos\n- Purpose: obtain the exact first detection time/fid/isdiffpos from the light-curve table.\n\n4) Subquery: date-window validation at detection-level\n- From step (3), keep only rows with first_det_mjd >= 60188.0 AND first_det_mjd < 60190.0\n- Columns: oid\n- Purpose: ensure the first detection timing itself is in the window (tightens against any discrepancies with object.firstmjd).\n\n5) Subquery: fast risers in the same filter as first detection\n- Join magstat (ms) to first-detection rows (step 3) on:\n  - ms.oid = first_det.oid AND ms.fid = first_det.first_det_fid\n- Filter on fast-riser condition:\n  - ms.dmdt_first <= -0.25\n- Columns: oid, ms.fid AS magstat_fid, ms.dmdt_first AS initial_rise_estimate\n- Purpose: enforce the \u201cfast riser\u201d criterion in the same filter as the first detection and retrieve initial rise estimate.\n\n6) Candidate set via INTERSECT (enforce all criteria)\n- Build the final candidate oids as the intersection of:\n  - A: SELECT oid FROM step (1)  -- top-ranked SNs in stamp classifier\n  - B: SELECT oid FROM step (2)  -- object.firstmjd in window\n  - C: SELECT oid FROM step (4)  -- detection-level first detection in window\n  - D: SELECT oid FROM step (5)  -- fast risers in same filter as first detection\n- Columns: oid\n- Purpose: explicit logical AND across all constraints using INTERSECT to ensure only oids satisfying all conditions pass.\n\n7) Subquery: enrich candidate objects with probability, first detection info, and rise estimate\n- Start from candidate oids (step 6).\n- INNER JOIN to step (1) to attach probability (from stamp classifier, class 'SN', ranking=1).\n- INNER JOIN to step (3) to attach first_det_fid and isdiffpos (image difference sign).\n- INNER JOIN to step (5) to attach magstat_fid and initial_rise_estimate (dmdt_first).\n- Columns to carry forward for final output:\n  - oid\n  - probability (from step 1)\n  - first_det_fid (from step 3)  [used only to bind to magstat; not required in final output unless desired]\n  - isdiffpos (from step 3)\n  - magstat_fid (from step 5)\n  - initial_rise_estimate (from step 5)\n  - first_det_mjd (from step 3)  [optional, can be used to trim non-detections]\n- Purpose: consolidate per-object metadata needed for the final output.\n\n8) Subquery: light curves including only non-detections\n- From non_detection, INNER JOIN to the enriched candidates (step 7) on oid to include only those objects.\n- Optionally restrict to non-detections prior to first detection:\n  - non_detection.mjd <= first_det_mjd\n  - This matches the \u201clast non-detection before first detection\u201d context and reduces noise; if you prefer all non-detections, omit this condition.\n- Columns (per non-detection light-curve point):\n  - oid\n  - non_detection.mjd AS non_det_mjd\n  - non_detection.fid AS fid  -- this will be the requested \u201cfilter ID\u201d for the light-curve row\n  - non_detection.diffmaglim AS non_det_diffmaglim\n\n9) Final SELECT and projection (JOIN of steps 7 and 8)\n- Start from the non-detection rows (step 8) to actually return \u201clight curves (including only non-detections)\u201d.\n- For each row, include:\n  - oid\n  - probability (stamp classifier, class 'SN', ranking=1)\n  - fid (from non_detection; this is the requested \u201cfilter ID\u201d for the LC row)\n  - isdiffpos (from first detection; the requested \u201cimage difference\u201d sign)\n  - magstat_fid (from magstat; return as 'magstat_fid')\n  - initial_rise_estimate (from magstat.dmdt_first; the initial rise estimate)\n  - non_det_mjd (time of non-detection)\n  - non_det_diffmaglim (limit magnitude in difference image)\n- Order the results by oid (and optionally by non_det_mjd for readability; the user only requested order by oid).\n- Limit 100.\n\n10) Performance and correctness notes\n- The ix_classification_rank1 partial index (ranking = 1) plus ix_probabilities_oid helps step (1).\n- Use object.firstmjd btree index in step (2).\n- Constrain detection by oid (hash index ix_ndetection_oid) via WHERE oid IN (...) from step (2) to avoid full scans in step (3).\n- Constrain magstat by oid (hash index ix_magstats_oid) and fid via the join in step (5). dmdt_first filter can use ix_magstats_dmdt_first.\n- INTERSECT in step (6) enforces all constraints cleanly and can be efficient due to prior filtering.\n- Ensure exact literals for classifier and class names: classifier_name='stamp_classifier', class_name='SN'.\n- Use [60188.0, 60190.0) for the date window to include September 1 and 2 inclusive.\n\nOutput summary\nEach returned row corresponds to a non-detection light-curve point of a qualifying object and includes:\n- oid\n- probability (stamp classifier, class 'SN', ranking=1)\n- fid (from non_detection; \u201cfilter ID\u201d)\n- isdiffpos (from first detection; \u201cimage difference\u201d sign)\n- magstat_fid (from magstat; alias as requested)\n- initial_rise_estimate (magstat.dmdt_first)\n- non_det_mjd\n- non_det_diffmaglim\n\nSorting and limit\n- ORDER BY oid\n- LIMIT 100"
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nReturn, for up to 100 objects:\n- Only objects whose top-ranked (ranking=1) stamp classifier class is 'SN'.\n- With first detection in the first two days of September (MJD in [60188.0, 60190.0)).\n- That qualify as fast risers (same-filter initial rise rate at least 0.25 mag/day brighter).\n- Output per object and associated non-detection light-curve rows: oid, probability (from stamp classifier), filter ID (from non_detection), image difference (isdiffpos of the first detection), magstat.fid as magstat_fid, initial rise estimate (dmdt_first), and non-detection time and limit.\n- Order by oid, limit 100.\n\nSchema/tables/columns used\n- probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n- object(oid, firstmjd, \u2026)\n- detection(oid, mjd, fid, isdiffpos, \u2026)\n- magstat(oid, fid, dmdt_first, \u2026)\n- non_detection(oid, fid, mjd, diffmaglim)\n\nFixed constants\n- MJD window for \u201cfirst two days of September\u201d: start_mjd = 60188.0, end_mjd = 60190.0 (use [start_mjd, end_mjd) for inclusive 1\u20132 September).\n- Fast riser threshold: dmdt_first <= -0.25 mag/day (brightening rate; negative sign indicates brightening).\n\nHigh-level structure (use CTEs, nested subqueries, INTERSECT, JOINs)\n1) Subquery: top-ranked SNs in stamp classifier\n- From probability, select only:\n  - classifier_name = 'stamp_classifier'\n  - class_name = 'SN'\n  - ranking = 1\n- Columns: oid, probability\n- Purpose: enforce \u201chighest probability in stamp classifier is SN\u201d and bring the probability value.\n- Note: deliberately override the default classifier_name (the user explicitly requests stamp_classifier).\n\n2) Subquery: objects with first detection in date window (object-level)\n- From object, filter: firstmjd >= 60188.0 AND firstmjd < 60190.0\n- Columns: oid, firstmjd\n- Purpose: fast prefilter by index and align with \u201cfirst detection in the first 2 days of September.\u201d\n\n3) Subquery: first detection per object (detection-level)\n- From detection, restricted to oids in step (2) to leverage ix_ndetection_oid:\n  - For each oid, select the earliest detection row:\n    - Use a grouped subquery to compute MIN(mjd) per oid, then join back to detection on (oid, mjd) to retrieve fid and isdiffpos.\n  - Columns: oid, mjd AS first_det_mjd, fid AS first_det_fid, isdiffpos\n- Purpose: obtain the exact first detection time/fid/isdiffpos from the light-curve table.\n\n4) Subquery: date-window validation at detection-level\n- From step (3), keep only rows with first_det_mjd >= 60188.0 AND first_det_mjd < 60190.0\n- Columns: oid\n- Purpose: ensure the first detection timing itself is in the window (tightens against any discrepancies with object.firstmjd).\n\n5) Subquery: fast risers in the same filter as first detection\n- Join magstat (ms) to first-detection rows (step 3) on:\n  - ms.oid = first_det.oid AND ms.fid = first_det.first_det_fid\n- Filter on fast-riser condition:\n  - ms.dmdt_first <= -0.25\n- Columns: oid, ms.fid AS magstat_fid, ms.dmdt_first AS initial_rise_estimate\n- Purpose: enforce the \u201cfast riser\u201d criterion in the same filter as the first detection and retrieve initial rise estimate.\n\n6) Candidate set via INTERSECT (enforce all criteria)\n- Build the final candidate oids as the intersection of:\n  - A: SELECT oid FROM step (1)  -- top-ranked SNs in stamp classifier\n  - B: SELECT oid FROM step (2)  -- object.firstmjd in window\n  - C: SELECT oid FROM step (4)  -- detection-level first detection in window\n  - D: SELECT oid FROM step (5)  -- fast risers in same filter as first detection\n- Columns: oid\n- Purpose: explicit logical AND across all constraints using INTERSECT to ensure only oids satisfying all conditions pass.\n\n7) Subquery: enrich candidate objects with probability, first detection info, and rise estimate\n- Start from candidate oids (step 6).\n- INNER JOIN to step (1) to attach probability (from stamp classifier, class 'SN', ranking=1).\n- INNER JOIN to step (3) to attach first_det_fid and isdiffpos (image difference sign).\n- INNER JOIN to step (5) to attach magstat_fid and initial_rise_estimate (dmdt_first).\n- Columns to carry forward for final output:\n  - oid\n  - probability (from step 1)\n  - first_det_fid (from step 3)  [used only to bind to magstat; not required in final output unless desired]\n  - isdiffpos (from step 3)\n  - magstat_fid (from step 5)\n  - initial_rise_estimate (from step 5)\n  - first_det_mjd (from step 3)  [optional, can be used to trim non-detections]\n- Purpose: consolidate per-object metadata needed for the final output.\n\n8) Subquery: light curves including only non-detections\n- From non_detection, INNER JOIN to the enriched candidates (step 7) on oid to include only those objects.\n- Optionally restrict to non-detections prior to first detection:\n  - non_detection.mjd <= first_det_mjd\n  - This matches the \u201clast non-detection before first detection\u201d context and reduces noise; if you prefer all non-detections, omit this condition.\n- Columns (per non-detection light-curve point):\n  - oid\n  - non_detection.mjd AS non_det_mjd\n  - non_detection.fid AS fid  -- this will be the requested \u201cfilter ID\u201d for the light-curve row\n  - non_detection.diffmaglim AS non_det_diffmaglim\n\n9) Final SELECT and projection (JOIN of steps 7 and 8)\n- Start from the non-detection rows (step 8) to actually return \u201clight curves (including only non-detections)\u201d.\n- For each row, include:\n  - oid\n  - probability (stamp classifier, class 'SN', ranking=1)\n  - fid (from non_detection; this is the requested \u201cfilter ID\u201d for the LC row)\n  - isdiffpos (from first detection; the requested \u201cimage difference\u201d sign)\n  - magstat_fid (from magstat; return as 'magstat_fid')\n  - initial_rise_estimate (from magstat.dmdt_first; the initial rise estimate)\n  - non_det_mjd (time of non-detection)\n  - non_det_diffmaglim (limit magnitude in difference image)\n- Order the results by oid (and optionally by non_det_mjd for readability; the user only requested order by oid).\n- Limit 100.\n\n10) Performance and correctness notes\n- The ix_classification_rank1 partial index (ranking = 1) plus ix_probabilities_oid helps step (1).\n- Use object.firstmjd btree index in step (2).\n- Constrain detection by oid (hash index ix_ndetection_oid) via WHERE oid IN (...) from step (2) to avoid full scans in step (3).\n- Constrain magstat by oid (hash index ix_magstats_oid) and fid via the join in step (5). dmdt_first filter can use ix_magstats_dmdt_first.\n- INTERSECT in step (6) enforces all constraints cleanly and can be efficient due to prior filtering.\n- Ensure exact literals for classifier and class names: classifier_name='stamp_classifier', class_name='SN'.\n- Use [60188.0, 60190.0) for the date window to include September 1 and 2 inclusive.\n\nOutput summary\nEach returned row corresponds to a non-detection light-curve point of a qualifying object and includes:\n- oid\n- probability (stamp classifier, class 'SN', ranking=1)\n- fid (from non_detection; \u201cfilter ID\u201d)\n- isdiffpos (from first detection; \u201cimage difference\u201d sign)\n- magstat_fid (from magstat; alias as requested)\n- initial_rise_estimate (magstat.dmdt_first)\n- non_det_mjd\n- non_det_diffmaglim\n\nSorting and limit\n- ORDER BY oid\n- LIMIT 100"
                    },
                    "in_toks": 4555,
                    "out_toks": 7405,
                    "id": "chatcmpl-Cb5qS17g7hPyYKlLfrmYwuya8NB0C",
                    "created": 1762956640,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "/* Objects whose top-ranked stamp classifier class is 'SN',\n   first detection within MJD [60188.0, 60190.0) (Sept 1\u20132),\n   and fast risers (same-filter dmdt_first <= -0.25 mag/day).\n   Return per-object non-detections with requested fields. */ WITH prob_sn AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1),\n                                                                   objs_window AS\n  (SELECT o.oid,\n          o.firstmjd\n   FROM OBJECT o\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n                                                                   min_det AS\n  (/* Earliest detection per object, restrict detection by oid for performance */  SELECT d.oid,\n                                                                                          MIN(d.mjd) AS first_det_mjd\n   FROM detection d\n   WHERE d.oid IN\n       (SELECT oid\n        FROM objs_window)\n   GROUP BY d.oid),\n                                                                   first_det AS\n  (/* Attach first detection fid and image difference sign */  SELECT d.oid,\n                                                                      md.first_det_mjd,\n                                                                      d.fid AS first_det_fid,\n                                                                      d.isdiffpos\n   FROM min_det md\n   INNER JOIN detection d ON d.oid = md.oid\n   AND d.mjd = md.first_det_mjd),\n                                                                   first_det_in_window AS\n  (SELECT fd.oid\n   FROM first_det fd\n   WHERE fd.first_det_mjd >= 60188.0\n     AND fd.first_det_mjd < 60190.0),\n                                                                   fast_risers AS\n  (/* Fast riser in the same filter as the first detection */  SELECT fd.oid,\n                                                                      ms.fid AS magstat_fid,\n                                                                      ms.dmdt_first\n   FROM first_det fd\n   INNER JOIN magstat ms ON ms.oid = fd.oid\n   AND ms.fid = fd.first_det_fid\n   WHERE ms.dmdt_first <= -0.25),\n                                                                   candidates AS\n  (/* Enforce all criteria via INTERSECT */  SELECT oid\n   FROM prob_sn INTERSECT SELECT oid\n   FROM objs_window INTERSECT SELECT oid\n   FROM first_det_in_window INTERSECT SELECT oid\n   FROM fast_risers),\n                                                                   enriched AS\n  (/* Consolidate per-object info needed for final output */  SELECT c.oid,\n                                                                     psn.probability,\n                                                                     fd.first_det_mjd,\n                                                                     fd.first_det_fid,\n                                                                     fd.isdiffpos,\n                                                                     fr.magstat_fid,\n                                                                     fr.dmdt_first\n   FROM candidates c\n   INNER JOIN prob_sn psn ON psn.oid = c.oid\n   INNER JOIN first_det fd ON fd.oid = c.oid\n   INNER JOIN fast_risers fr ON fr.oid = c.oid)\nSELECT e.oid,\n       e.probability,\n       nd.fid, /* filter ID from non_detection */  e.isdiffpos, /* image difference sign from first detection */  e.magstat_fid, /* magstat filter ID */  e.dmdt_first, /* initial rise estimate */  nd.mjd, /* non-detection time */  nd.diffmaglim /* non-detection magnitude limit */\nFROM enriched e\nINNER JOIN non_detection nd ON nd.oid = e.oid /* Include only non-detections up to the first detection time */\nAND nd.mjd <= e.first_det_mjd\nORDER BY e.oid\nLIMIT 100;"
                        },
                        "in_toks": 5109,
                        "out_toks": 5548,
                        "id": "chatcmpl-Cb5t2tCnn33Rq3kaWi0tHMvHGTdEe",
                        "created": 1762956800,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "2": {
            "req_id": "16",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "non_detection",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'non_detection', 'magstat']"
                },
                "in_toks": 692,
                "out_toks": 1627,
                "id": "chatcmpl-CSsWU7nd3bwFLAGtWN787u9mVaNLs",
                "created": 1760998806,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Stamp-classifier SN fast risers with first detection in MJD [60188.0, 60190.0)\n-- Return non-detections (light curve limits), including magstat filter and initial rise\nWITH sc AS\n  (-- Top-ranked Stamp Classifier = SN\n SELECT p.oid,\n        p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1),\n     obj AS\n  (-- Objects with first detection in the first 2 days of September\n SELECT o.oid,\n        o.firstmjd\n   FROM OBJECT o\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n     fast AS\n  (-- Per-band first detection window and initial rise estimate\n SELECT m.oid,\n        m.fid AS magstat_fid,\n        m.firstmjd AS magstat_firstmjd,\n        CASE\n            WHEN m.dmdt_first IS NOT NULL THEN m.dmdt_first\n            WHEN m.dt_first > 0\n                 AND m.dm_first IS NOT NULL\n                 AND m.dm_first < 0 THEN (-m.dm_first) / m.dt_first\n            ELSE NULL\n        END AS initial_rise\n   FROM magstat m\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0),\n     candidates AS\n  (-- Combine constraints: stamp SN (top), object-level first detection in window, fast rise\n SELECT sc.oid,\n        sc.probability,\n        f.magstat_fid,\n        f.magstat_firstmjd,\n        f.initial_rise\n   FROM sc\n   JOIN obj o ON o.oid = sc.oid\n   JOIN fast f ON f.oid = sc.oid\n   WHERE f.initial_rise IS NOT NULL\n     AND f.initial_rise >= 0.25)\nSELECT c.oid,\n       c.probability,\n       n.fid,\n       c.magstat_fid,\n       c.initial_rise,\n       n.mjd,\n       n.diffmaglim\nFROM candidates c\nJOIN non_detection n ON n.oid = c.oid\nAND n.fid = c.magstat_fid\nAND n.mjd <= c.magstat_firstmjd -- only non-detections up to the first detection in that band\nORDER BY c.oid\nLIMIT 100;",
            "sql_response": {
                "responses": {
                    "0": "-- Stamp-classifier SN fast risers with first detection in MJD [60188.0, 60190.0)\n-- Return non-detections (light curve limits), including magstat filter and initial rise\nWITH sc AS\n  (-- Top-ranked Stamp Classifier = SN\n SELECT p.oid,\n        p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1),\n     obj AS\n  (-- Objects with first detection in the first 2 days of September\n SELECT o.oid,\n        o.firstmjd\n   FROM OBJECT o\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n     fast AS\n  (-- Per-band first detection window and initial rise estimate\n SELECT m.oid,\n        m.fid AS magstat_fid,\n        m.firstmjd AS magstat_firstmjd,\n        CASE\n            WHEN m.dmdt_first IS NOT NULL THEN m.dmdt_first\n            WHEN m.dt_first > 0\n                 AND m.dm_first IS NOT NULL\n                 AND m.dm_first < 0 THEN (-m.dm_first) / m.dt_first\n            ELSE NULL\n        END AS initial_rise\n   FROM magstat m\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0),\n     candidates AS\n  (-- Combine constraints: stamp SN (top), object-level first detection in window, fast rise\n SELECT sc.oid,\n        sc.probability,\n        f.magstat_fid,\n        f.magstat_firstmjd,\n        f.initial_rise\n   FROM sc\n   JOIN obj o ON o.oid = sc.oid\n   JOIN fast f ON f.oid = sc.oid\n   WHERE f.initial_rise IS NOT NULL\n     AND f.initial_rise >= 0.25)\nSELECT c.oid,\n       c.probability,\n       n.fid,\n       c.magstat_fid,\n       c.initial_rise,\n       n.mjd,\n       n.diffmaglim\nFROM candidates c\nJOIN non_detection n ON n.oid = c.oid\nAND n.fid = c.magstat_fid\nAND n.mjd <= c.magstat_firstmjd -- only non-detections up to the first detection in that band\nORDER BY c.oid\nLIMIT 100;"
                },
                "in_toks": 3590,
                "out_toks": 4500,
                "id": "chatcmpl-CbGpUVZPC4E7oqJhNn85NNEHkul1e",
                "created": 1762998864,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2049,
                "out_toks": 1231,
                "id": "chatcmpl-CSxRpcCHsPKFbKbGPHwHUmV16GX7q",
                "created": 1761017737,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Stamp-classifier SN fast risers in first 2 days of September (MJD [60188.0, 60190.0))\nWITH S AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'SN'),\n     O AS\n  (SELECT o.oid,\n          o.firstmjd\n   FROM OBJECT o\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n     M_window AS\n  (SELECT m.oid,\n          m.fid,\n          m.firstmjd,\n          m.dm_first,\n          m.dt_first,\n          m.dmdt_first\n   FROM magstat m\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0),\n     Oids_in_window AS\n  (SELECT oid\n   FROM O INTERSECT SELECT oid\n   FROM M_window),\n     R1 AS\n  (-- Use provided dmdt_first (rate) when available\n SELECT m.oid,\n        m.fid,\n        m.firstmjd,\n        m.dm_first,\n        m.dt_first,\n        m.dmdt_first AS initial_rise\n   FROM magstat m\n   INNER JOIN Oids_in_window w ON w.oid = m.oid\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0\n     AND m.dmdt_first IS NOT NULL\n     AND m.dmdt_first >= 0.25\n     AND m.dt_first > 0\n     AND (m.dm_first IS NULL\n          OR m.dm_first < 0)-- ensure brightening if available\n),\n     R2 AS\n  (-- Fall back to dm_first and dt_first to compute rate\n SELECT m.oid,\n        m.fid,\n        m.firstmjd,\n        m.dm_first,\n        m.dt_first,\n        (-m.dm_first) / m.dt_first AS initial_rise\n   FROM magstat m\n   INNER JOIN Oids_in_window w ON w.oid = m.oid\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0\n     AND m.dm_first IS NOT NULL\n     AND m.dt_first IS NOT NULL\n     AND m.dt_first > 0\n     AND m.dm_first < 0\n     AND (-m.dm_first) / m.dt_first >= 0.25),\n     R_fast AS\n  (SELECT DISTINCT r.oid,\n                   r.fid,\n                   r.firstmjd,\n                   r.dm_first,\n                   r.dt_first,\n                   r.initial_rise\n   FROM\n     (SELECT *\n      FROM R1\n      UNION SELECT *\n      FROM R2) r),\n     Candidates AS\n  (SELECT s.oid,\n          s.probability,\n          rf.fid AS magstat_fid,\n          rf.firstmjd AS magstat_firstmjd,\n          rf.dm_first,\n          rf.initial_rise\n   FROM S s\n   INNER JOIN O o ON o.oid = s.oid\n   INNER JOIN R_fast rf ON rf.oid = s.oid),\n     N AS\n  (SELECT c.oid,\n          c.probability,\n          n.fid,\n          c.dm_first,\n          c.magstat_fid,\n          c.initial_rise,\n          n.mjd,\n          n.diffmaglim\n   FROM non_detection n\n   INNER JOIN Candidates c ON n.oid = c.oid\n   AND n.fid = c.magstat_fid\n   AND n.mjd <= c.magstat_firstmjd -- only non-detections up to first detection\n)\nSELECT oid,\n       probability,\n       fid,\n       dm_first,\n       magstat_fid,\n       initial_rise,\n       mjd,\n       diffmaglim\nFROM N\nORDER BY oid,\n         mjd\nLIMIT 100;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query for the ALeRCE database\n\nGoal\nRetrieve up to 100 rows listing:\n- oid (object identifier),\n- the probability from the stamp classifier (for the top-ranked class, which must be 'SN'),\n- the non-detection light-curve points (only non-detections),\n- the non_detection filter ID (as fid),\n- the image-difference at first detection (magstat.dm_first),\n- the magstat filter ID (as magstat_fid),\n- an initial rise estimate per filter (from magstat), \nfor objects:\n- whose highest-probability stamp-classifier class is 'SN',\n- whose first detection occurred within the first two days of September (MJD in [60188.0, 60190.0)),\n- that qualify as fast risers (first detection brighter than last non-detection in the same filter by at least 0.25 mag/day).\n\nImportant defaults and overrides\n- Because the request explicitly asks for stamp classifier probabilities, override the default probability.classifier_name='lc_classifier' and use classifier_name='stamp_classifier'. Keep probability.ranking=1 (default retained).\n- Use exact class name 'SN' for the stamp classifier.\n- No spatial filtering, so no Q3C functions are needed.\n\nStep-by-step query construction (no SQL, just structure and logic)\n\n1) Define the date window constants\n- September 1 MJD: 60188.0\n- September 2 MJD: 60189.0\n- Use closed-open interval [60188.0, 60190.0) for \u201cfirst 2 days of September.\u201d\n\n2) Subquery S (stamp-classifier SN, rank-1 objects)\n- From probability\n- Filters:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.ranking = 1\n  - probability.class_name = 'SN'\n- Columns to output: S.oid, S.probability\n- Index use: ix_classification_rank1 on probability.ranking, ix_probabilities_probability (optional), and hash on oid for later joins.\n\n3) Subquery O (objects with first detection in first 2 days of September)\n- From object\n- Filters:\n  - object.firstmjd >= 60188.0\n  - object.firstmjd < 60190.0\n- Columns to output: O.oid, O.firstmjd\n- Index use: ix_object_firstmjd\n\n4) Subquery M_window (per-filter magstat rows whose first detection is in the same 2-day window)\n- From magstat\n- Filters:\n  - magstat.firstmjd >= 60188.0\n  - magstat.firstmjd < 60190.0\n- Columns to output: M_window.oid, M_window.fid, M_window.firstmjd, M_window.dm_first, M_window.dt_first, M_window.dmdt_first\n- Index use: ix_magstats_firstmjd\n\n5) Subquery Oids_in_window (INTERSECT to ensure the object and at least one of its band-wise first detections lie in the window)\n- Define two OID sets:\n  - Set A: SELECT oid FROM O (step 3)\n  - Set B: SELECT oid FROM M_window (step 4)\n- INTERSECT A and B to get Oids_in_window(oid)\n- This guarantees we consider objects whose first detection, and a band-wise first detection row, both lie in the required window.\n\n6) Subquery R1 (fast-riser criterion using magstat.dmdt_first)\n- From magstat AS m\n- Inner join Oids_in_window on m.oid\n- Filters:\n  - m.firstmjd >= 60188.0 AND m.firstmjd < 60190.0  (ensure same window for the band)\n  - m.dmdt_first IS NOT NULL\n  - m.dmdt_first >= 0.25\n  - Optional brightness-direction check to enforce \u201cbrighter\u201d: m.dm_first IS NULL OR m.dm_first < 0\n  - m.dt_first > 0 (defensive, ensures well-defined timing context)\n- Output columns:\n  - R1.oid, R1.fid, R1.firstmjd, R1.dm_first, R1.dt_first,\n  - initial_rise_est = m.dmdt_first\n\n7) Subquery R2 (fast-riser criterion using dm_first and dt_first when dmdt_first is unavailable or as a consistency path)\n- From magstat AS m\n- Inner join Oids_in_window on m.oid\n- Filters:\n  - m.firstmjd >= 60188.0 AND m.firstmjd < 60190.0\n  - m.dm_first IS NOT NULL\n  - m.dt_first IS NOT NULL AND m.dt_first > 0\n  - m.dm_first < 0  (first detection brighter than last non-detection)\n  - (-m.dm_first) / m.dt_first >= 0.25  (rate of brightening in mag/day)\n- Output columns:\n  - R2.oid, R2.fid, R2.firstmjd, R2.dm_first, R2.dt_first,\n  - initial_rise_est = (-m.dm_first) / m.dt_first\n\n8) Subquery R_fast (UNION of fast-riser sets)\n- UNION (not UNION ALL) of R1 and R2 on the common column list:\n  - oid, fid, firstmjd, dm_first, dt_first, initial_rise_est\n- This yields unique (oid, fid) pairs (per filter) that satisfy at least one fast-riser definition path and supplies the initial rise estimate.\n\n9) Subquery Candidates (objects satisfying both stamp-classifier SN and fast-riser conditions in the 2-day window)\n- INNER JOIN:\n  - S (step 2) on S.oid\n  - O (step 3) on O.oid = S.oid\n  - R_fast (step 8) on R_fast.oid = S.oid\n- This enforces:\n  - stamp-classifier rank-1 class = 'SN'\n  - object first detection in the 2-day window\n  - a qualifying fast-riser filter in the same window\n- Columns to prepare for final selection:\n  - Candidates.oid,\n  - Candidates.stamp_probability = S.probability,\n  - Candidates.magstat_fid = R_fast.fid,\n  - Candidates.magstat_firstmjd = R_fast.firstmjd,\n  - Candidates.image_difference = R_fast.dm_first,\n  - Candidates.initial_rise = R_fast.initial_rise_est\n\n10) Subquery N (non-detection light curves for the qualifying objects and filters)\n- From non_detection AS n\n- INNER JOIN Candidates on n.oid = Candidates.oid\n- Filter for same filter to match the fast-riser band:\n  - n.fid = Candidates.magstat_fid\n- \u201cLight curves (including only non-detections)\u201d means return non_detection rows. You can either:\n  - include all non_detections for those (oid, fid), or\n  - restrict to n.mjd <= Candidates.magstat_firstmjd if you only want non-detections up to (and including) the first detection epoch.\n- Columns to output from N:\n  - n.oid (implicit via join),\n  - n.fid AS fid,\n  - n.mjd,\n  - n.diffmaglim\n- Index use: ix_non_detection_oid\n\n11) Final result assembly\n- FROM N (step 10)\n- SELECT columns:\n  - oid = Candidates.oid\n  - probability = Candidates.stamp_probability  (from probability.classifier_name='stamp_classifier', class_name='SN', ranking=1)\n  - fid = n.fid  (non_detection filter ID)\n  - image_difference = Candidates.image_difference  (magstat.dm_first)\n  - magstat_fid = Candidates.magstat_fid  (magstat.fid)\n  - initial_rise = Candidates.initial_rise  (m.dmdt_first if available, else (-m.dm_first)/m.dt_first)\n  - plus the non-detection light-curve fields:\n    - n.mjd\n    - n.diffmaglim\n- ORDER BY oid ASC (optionally add n.mjd ASC as secondary sort if desired)\n- LIMIT 100\n\n12) Notes on correctness and performance\n- The explicit overrides ensure we use the stamp classifier instead of the lc_classifier default.\n- Ranking=1 guarantees the \u201chighest probability\u201d condition.\n- Intersecting O and M_window via Oids_in_window ensures both object-level and band-level first detections fall in the date window.\n- The UNION of R1 and R2 accommodates both native dmdt_first and a computed rate from dm_first/dt_first, enforcing the fast-riser definition and the correct brightening direction (dm_first < 0).\n- The join to non_detection on the matching fid ensures \u201csame filter\u201d consistency required by the fast-riser definition.\n- Use existing indexes: ix_classification_rank1, ix_object_firstmjd, ix_magstats_firstmjd, ix_magstats_dmdt_first, ix_non_detection_oid.\n\nThis plan yields rows with:\n- oid,\n- stamp-classifier probability,\n- non-detection light-curve points (mjd, diffmaglim, fid),\n- magstat-derived image difference (dm_first),\n- magstat filter ID (magstat_fid),\n- initial rise estimate per filter,\nrestricted to the required September window, fast-riser definition, ordered by oid, limited to 100 rows."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query for the ALeRCE database\n\nGoal\nRetrieve up to 100 rows listing:\n- oid (object identifier),\n- the probability from the stamp classifier (for the top-ranked class, which must be 'SN'),\n- the non-detection light-curve points (only non-detections),\n- the non_detection filter ID (as fid),\n- the image-difference at first detection (magstat.dm_first),\n- the magstat filter ID (as magstat_fid),\n- an initial rise estimate per filter (from magstat), \nfor objects:\n- whose highest-probability stamp-classifier class is 'SN',\n- whose first detection occurred within the first two days of September (MJD in [60188.0, 60190.0)),\n- that qualify as fast risers (first detection brighter than last non-detection in the same filter by at least 0.25 mag/day).\n\nImportant defaults and overrides\n- Because the request explicitly asks for stamp classifier probabilities, override the default probability.classifier_name='lc_classifier' and use classifier_name='stamp_classifier'. Keep probability.ranking=1 (default retained).\n- Use exact class name 'SN' for the stamp classifier.\n- No spatial filtering, so no Q3C functions are needed.\n\nStep-by-step query construction (no SQL, just structure and logic)\n\n1) Define the date window constants\n- September 1 MJD: 60188.0\n- September 2 MJD: 60189.0\n- Use closed-open interval [60188.0, 60190.0) for \u201cfirst 2 days of September.\u201d\n\n2) Subquery S (stamp-classifier SN, rank-1 objects)\n- From probability\n- Filters:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.ranking = 1\n  - probability.class_name = 'SN'\n- Columns to output: S.oid, S.probability\n- Index use: ix_classification_rank1 on probability.ranking, ix_probabilities_probability (optional), and hash on oid for later joins.\n\n3) Subquery O (objects with first detection in first 2 days of September)\n- From object\n- Filters:\n  - object.firstmjd >= 60188.0\n  - object.firstmjd < 60190.0\n- Columns to output: O.oid, O.firstmjd\n- Index use: ix_object_firstmjd\n\n4) Subquery M_window (per-filter magstat rows whose first detection is in the same 2-day window)\n- From magstat\n- Filters:\n  - magstat.firstmjd >= 60188.0\n  - magstat.firstmjd < 60190.0\n- Columns to output: M_window.oid, M_window.fid, M_window.firstmjd, M_window.dm_first, M_window.dt_first, M_window.dmdt_first\n- Index use: ix_magstats_firstmjd\n\n5) Subquery Oids_in_window (INTERSECT to ensure the object and at least one of its band-wise first detections lie in the window)\n- Define two OID sets:\n  - Set A: SELECT oid FROM O (step 3)\n  - Set B: SELECT oid FROM M_window (step 4)\n- INTERSECT A and B to get Oids_in_window(oid)\n- This guarantees we consider objects whose first detection, and a band-wise first detection row, both lie in the required window.\n\n6) Subquery R1 (fast-riser criterion using magstat.dmdt_first)\n- From magstat AS m\n- Inner join Oids_in_window on m.oid\n- Filters:\n  - m.firstmjd >= 60188.0 AND m.firstmjd < 60190.0  (ensure same window for the band)\n  - m.dmdt_first IS NOT NULL\n  - m.dmdt_first >= 0.25\n  - Optional brightness-direction check to enforce \u201cbrighter\u201d: m.dm_first IS NULL OR m.dm_first < 0\n  - m.dt_first > 0 (defensive, ensures well-defined timing context)\n- Output columns:\n  - R1.oid, R1.fid, R1.firstmjd, R1.dm_first, R1.dt_first,\n  - initial_rise_est = m.dmdt_first\n\n7) Subquery R2 (fast-riser criterion using dm_first and dt_first when dmdt_first is unavailable or as a consistency path)\n- From magstat AS m\n- Inner join Oids_in_window on m.oid\n- Filters:\n  - m.firstmjd >= 60188.0 AND m.firstmjd < 60190.0\n  - m.dm_first IS NOT NULL\n  - m.dt_first IS NOT NULL AND m.dt_first > 0\n  - m.dm_first < 0  (first detection brighter than last non-detection)\n  - (-m.dm_first) / m.dt_first >= 0.25  (rate of brightening in mag/day)\n- Output columns:\n  - R2.oid, R2.fid, R2.firstmjd, R2.dm_first, R2.dt_first,\n  - initial_rise_est = (-m.dm_first) / m.dt_first\n\n8) Subquery R_fast (UNION of fast-riser sets)\n- UNION (not UNION ALL) of R1 and R2 on the common column list:\n  - oid, fid, firstmjd, dm_first, dt_first, initial_rise_est\n- This yields unique (oid, fid) pairs (per filter) that satisfy at least one fast-riser definition path and supplies the initial rise estimate.\n\n9) Subquery Candidates (objects satisfying both stamp-classifier SN and fast-riser conditions in the 2-day window)\n- INNER JOIN:\n  - S (step 2) on S.oid\n  - O (step 3) on O.oid = S.oid\n  - R_fast (step 8) on R_fast.oid = S.oid\n- This enforces:\n  - stamp-classifier rank-1 class = 'SN'\n  - object first detection in the 2-day window\n  - a qualifying fast-riser filter in the same window\n- Columns to prepare for final selection:\n  - Candidates.oid,\n  - Candidates.stamp_probability = S.probability,\n  - Candidates.magstat_fid = R_fast.fid,\n  - Candidates.magstat_firstmjd = R_fast.firstmjd,\n  - Candidates.image_difference = R_fast.dm_first,\n  - Candidates.initial_rise = R_fast.initial_rise_est\n\n10) Subquery N (non-detection light curves for the qualifying objects and filters)\n- From non_detection AS n\n- INNER JOIN Candidates on n.oid = Candidates.oid\n- Filter for same filter to match the fast-riser band:\n  - n.fid = Candidates.magstat_fid\n- \u201cLight curves (including only non-detections)\u201d means return non_detection rows. You can either:\n  - include all non_detections for those (oid, fid), or\n  - restrict to n.mjd <= Candidates.magstat_firstmjd if you only want non-detections up to (and including) the first detection epoch.\n- Columns to output from N:\n  - n.oid (implicit via join),\n  - n.fid AS fid,\n  - n.mjd,\n  - n.diffmaglim\n- Index use: ix_non_detection_oid\n\n11) Final result assembly\n- FROM N (step 10)\n- SELECT columns:\n  - oid = Candidates.oid\n  - probability = Candidates.stamp_probability  (from probability.classifier_name='stamp_classifier', class_name='SN', ranking=1)\n  - fid = n.fid  (non_detection filter ID)\n  - image_difference = Candidates.image_difference  (magstat.dm_first)\n  - magstat_fid = Candidates.magstat_fid  (magstat.fid)\n  - initial_rise = Candidates.initial_rise  (m.dmdt_first if available, else (-m.dm_first)/m.dt_first)\n  - plus the non-detection light-curve fields:\n    - n.mjd\n    - n.diffmaglim\n- ORDER BY oid ASC (optionally add n.mjd ASC as secondary sort if desired)\n- LIMIT 100\n\n12) Notes on correctness and performance\n- The explicit overrides ensure we use the stamp classifier instead of the lc_classifier default.\n- Ranking=1 guarantees the \u201chighest probability\u201d condition.\n- Intersecting O and M_window via Oids_in_window ensures both object-level and band-level first detections fall in the date window.\n- The UNION of R1 and R2 accommodates both native dmdt_first and a computed rate from dm_first/dt_first, enforcing the fast-riser definition and the correct brightening direction (dm_first < 0).\n- The join to non_detection on the matching fid ensures \u201csame filter\u201d consistency required by the fast-riser definition.\n- Use existing indexes: ix_classification_rank1, ix_object_firstmjd, ix_magstats_firstmjd, ix_magstats_dmdt_first, ix_non_detection_oid.\n\nThis plan yields rows with:\n- oid,\n- stamp-classifier probability,\n- non-detection light-curve points (mjd, diffmaglim, fid),\n- magstat-derived image difference (dm_first),\n- magstat filter ID (magstat_fid),\n- initial rise estimate per filter,\nrestricted to the required September window, fast-riser definition, ordered by oid, limited to 100 rows."
                    },
                    "in_toks": 4007,
                    "out_toks": 7270,
                    "id": "chatcmpl-Cb5uE8BM5zAeMNWQKKA9AMjAbsdL5",
                    "created": 1762956874,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Stamp-classifier SN fast risers in first 2 days of September (MJD [60188.0, 60190.0))\nWITH S AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'SN'),\n     O AS\n  (SELECT o.oid,\n          o.firstmjd\n   FROM OBJECT o\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n     M_window AS\n  (SELECT m.oid,\n          m.fid,\n          m.firstmjd,\n          m.dm_first,\n          m.dt_first,\n          m.dmdt_first\n   FROM magstat m\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0),\n     Oids_in_window AS\n  (SELECT oid\n   FROM O INTERSECT SELECT oid\n   FROM M_window),\n     R1 AS\n  (-- Use provided dmdt_first (rate) when available\n SELECT m.oid,\n        m.fid,\n        m.firstmjd,\n        m.dm_first,\n        m.dt_first,\n        m.dmdt_first AS initial_rise\n   FROM magstat m\n   INNER JOIN Oids_in_window w ON w.oid = m.oid\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0\n     AND m.dmdt_first IS NOT NULL\n     AND m.dmdt_first >= 0.25\n     AND m.dt_first > 0\n     AND (m.dm_first IS NULL\n          OR m.dm_first < 0)-- ensure brightening if available\n),\n     R2 AS\n  (-- Fall back to dm_first and dt_first to compute rate\n SELECT m.oid,\n        m.fid,\n        m.firstmjd,\n        m.dm_first,\n        m.dt_first,\n        (-m.dm_first) / m.dt_first AS initial_rise\n   FROM magstat m\n   INNER JOIN Oids_in_window w ON w.oid = m.oid\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0\n     AND m.dm_first IS NOT NULL\n     AND m.dt_first IS NOT NULL\n     AND m.dt_first > 0\n     AND m.dm_first < 0\n     AND (-m.dm_first) / m.dt_first >= 0.25),\n     R_fast AS\n  (SELECT DISTINCT r.oid,\n                   r.fid,\n                   r.firstmjd,\n                   r.dm_first,\n                   r.dt_first,\n                   r.initial_rise\n   FROM\n     (SELECT *\n      FROM R1\n      UNION SELECT *\n      FROM R2) r),\n     Candidates AS\n  (SELECT s.oid,\n          s.probability,\n          rf.fid AS magstat_fid,\n          rf.firstmjd AS magstat_firstmjd,\n          rf.dm_first,\n          rf.initial_rise\n   FROM S s\n   INNER JOIN O o ON o.oid = s.oid\n   INNER JOIN R_fast rf ON rf.oid = s.oid),\n     N AS\n  (SELECT c.oid,\n          c.probability,\n          n.fid,\n          c.dm_first,\n          c.magstat_fid,\n          c.initial_rise,\n          n.mjd,\n          n.diffmaglim\n   FROM non_detection n\n   INNER JOIN Candidates c ON n.oid = c.oid\n   AND n.fid = c.magstat_fid\n   AND n.mjd <= c.magstat_firstmjd -- only non-detections up to first detection\n)\nSELECT oid,\n       probability,\n       fid,\n       dm_first,\n       magstat_fid,\n       initial_rise,\n       mjd,\n       diffmaglim\nFROM N\nORDER BY oid,\n         mjd\nLIMIT 100;"
                        },
                        "in_toks": 4681,
                        "out_toks": 3444,
                        "id": "chatcmpl-Cb5wPvbZU19ob8rwQ2AEfKsVrSi82",
                        "created": 1762957009,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "3": {
            "req_id": "16",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "magstat",
                "non_detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'magstat', 'non_detection']"
                },
                "in_toks": 692,
                "out_toks": 3227,
                "id": "chatcmpl-CSsWqic1R1snaIHN93TgPdWlqbugL",
                "created": 1760998828,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query:\n-- - Uses object.firstmjd to ensure the first detection is within 2024-09-01/02 (MJD [60188.0, 60190.0))\n-- - Restricts probability to top-ranked SN in the stamp classifier (3 conditions as required)\n-- - Filters fast risers via magstat (dmdt_first >= 0.25)\n-- - Returns only non-detections prior to the first detection in the same filter; also bounds ND by < 60190 to prune scans\n-- - Returns: oid, probability, ND filter id (fid), ND diffmaglim, magstat_fid, and dmdt_first\n-- - Ordered by oid, limited to 100 rows\n WITH sn_candidates AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1),\n      early_objects AS\n  (SELECT o.oid\n   FROM OBJECT o\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n      candidates AS\n  (SELECT sc.oid,\n          sc.probability\n   FROM sn_candidates sc\n   INNER JOIN early_objects eo USING (oid)),\n      fast_risers_ms AS\n  (SELECT m.oid,\n          m.fid AS magstat_fid,\n          m.firstmjd,\n          m.dmdt_first\n   FROM magstat m\n   WHERE m.dmdt_first >= 0.25)\nSELECT nd.oid,\n       c.probability,\n       nd.fid,\n       nd.diffmaglim,\n       fm.magstat_fid,\n       fm.dmdt_first\nFROM candidates c\nINNER JOIN fast_risers_ms fm ON c.oid = fm.oid\nINNER JOIN non_detection nd ON nd.oid = fm.oid\nAND nd.fid = fm.magstat_fid\nAND nd.mjd < fm.firstmjd\nAND nd.mjd < 60190.0\nORDER BY nd.oid\nLIMIT 100;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query:\n-- - Uses object.firstmjd to ensure the first detection is within 2024-09-01/02 (MJD [60188.0, 60190.0))\n-- - Restricts probability to top-ranked SN in the stamp classifier (3 conditions as required)\n-- - Filters fast risers via magstat (dmdt_first >= 0.25)\n-- - Returns only non-detections prior to the first detection in the same filter; also bounds ND by < 60190 to prune scans\n-- - Returns: oid, probability, ND filter id (fid), ND diffmaglim, magstat_fid, and dmdt_first\n-- - Ordered by oid, limited to 100 rows\n WITH sn_candidates AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1),\n      early_objects AS\n  (SELECT o.oid\n   FROM OBJECT o\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n      candidates AS\n  (SELECT sc.oid,\n          sc.probability\n   FROM sn_candidates sc\n   INNER JOIN early_objects eo USING (oid)),\n      fast_risers_ms AS\n  (SELECT m.oid,\n          m.fid AS magstat_fid,\n          m.firstmjd,\n          m.dmdt_first\n   FROM magstat m\n   WHERE m.dmdt_first >= 0.25)\nSELECT nd.oid,\n       c.probability,\n       nd.fid,\n       nd.diffmaglim,\n       fm.magstat_fid,\n       fm.dmdt_first\nFROM candidates c\nINNER JOIN fast_risers_ms fm ON c.oid = fm.oid\nINNER JOIN non_detection nd ON nd.oid = fm.oid\nAND nd.fid = fm.magstat_fid\nAND nd.mjd < fm.firstmjd\nAND nd.mjd < 60190.0\nORDER BY nd.oid\nLIMIT 100;"
                },
                "in_toks": 2930,
                "out_toks": 3917,
                "id": "chatcmpl-CbGqtYGib1fveG6PYNnC1SeggbAHF",
                "created": 1762998951,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2049,
                "out_toks": 911,
                "id": "chatcmpl-CSxS101WZM6sF8jQIWqn9AyM0pQn9",
                "created": 1761017749,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- SN fast-risers from stamp_classifier on 2024-09-01/02 (MJD [60188.0, 60190.0))\n-- Return only non-detections prior to first detection in the same filter\nWITH sn_candidates AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'SN'),\n     ms_day1 AS\n  (SELECT m.oid,\n          m.fid AS magstat_fid,\n          m.firstmjd,\n          m.dmdt_first,\n          m.dm_first,\n          m.dt_first\n   FROM magstat m\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60189.0\n     AND m.dmdt_first >= 0.25),\n     ms_day2 AS\n  (SELECT m.oid,\n          m.fid AS magstat_fid,\n          m.firstmjd,\n          m.dmdt_first,\n          m.dm_first,\n          m.dt_first\n   FROM magstat m\n   WHERE m.firstmjd >= 60189.0\n     AND m.firstmjd < 60190.0\n     AND m.dmdt_first >= 0.25),\n     fast_risers_ms AS\n  (SELECT *\n   FROM ms_day1\n   UNION ALL SELECT *\n   FROM ms_day2),\n     selected_oids AS\n  (SELECT oid\n   FROM sn_candidates INTERSECT SELECT oid\n   FROM fast_risers_ms),\n     nd_pre_first AS\n  (SELECT nd.oid,\n          nd.fid,\n          nd.mjd,\n          nd.diffmaglim,\n          fm.magstat_fid,\n          fm.firstmjd,\n          fm.dmdt_first\n   FROM non_detection nd\n   INNER JOIN fast_risers_ms fm ON nd.oid = fm.oid\n   AND nd.fid = fm.magstat_fid\n   AND nd.mjd < fm.firstmjd)\nSELECT ndf.oid,\n       sc.probability,\n       ndf.fid,\n       ndf.diffmaglim,\n       ndf.magstat_fid,\n       ndf.dmdt_first\nFROM nd_pre_first ndf\nINNER JOIN selected_oids so ON ndf.oid = so.oid\nINNER JOIN sn_candidates sc ON ndf.oid = sc.oid\nORDER BY ndf.oid\nLIMIT 100;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nSelect objects whose stamp_classifier most-probable class (ranking = 1) is 'SN', whose first detection (per filter) occurs on 2024-09-01 or 2024-09-02 (MJD in [60188.0, 60190.0)), and that qualify as fast risers (brightening rate \u2265 0.25 mag/day in the same filter). Return only non-detections (light-curve upper limits) associated with those objects in the same filter prior to first detection. Output columns: oid, stamp-classifier probability, non_detection.fid (as fid), non_detection.diffmaglim (as image difference), magstat.fid (as magstat_fid), and an initial rise estimate. Order by oid; limit 100.\n\nKey schema elements used\n- probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n- magstat(oid, fid, firstmjd, dmdt_first, dm_first, dt_first, \u2026)\n- non_detection(oid, fid, mjd, diffmaglim)\n- object not strictly required for selection, but can be joined if needed; here we do not need columns from object.\n\nConstants\n- September 1 MJD = 60188.0\n- September 2 MJD = 60189.0\n- Two-day window: [60188.0, 60190.0) inclusive of Sep 1\u20132.\n- Fast riser threshold: \u2265 0.25 mag/day; use magstat.dmdt_first \u2265 0.25 as the initial rise estimate (consistent with definition \u201crate w.r.t. last non-detection in same filter\u201d). If needed, it can also be recomputed as -(dm_first/dt_first), but dmdt_first should be used directly.\n\nStep-by-step plan (use CTEs for clarity; do not return SQL)\n\n1) Subquery sn_candidates (stamp-classifier SN, highest probability)\n- FROM probability p\n- WHERE\n  - p.classifier_name = 'stamp_classifier'  (explicitly override default classifier)\n  - p.ranking = 1  (highest-probability class only)\n  - p.class_name = 'SN'\n- SELECT\n  - p.oid\n  - p.probability AS stamp_probability\n  - Optionally p.classifier_version (only if you need it; not required here)\nNotes:\n- Index usage: ix_probabilities_ranking supports the ranking filter; filtering by classifier_name and class_name will still be efficient on modest cardinalities.\n\n2) Day-sliced magstat selection per filter (two CTEs + UNION to define the two-day window)\nCreate two day-part subqueries to force a UNION as requested:\n- ms_day1\n  - FROM magstat m\n  - WHERE m.firstmjd >= 60188.0 AND m.firstmjd < 60189.0\n  - AND m.dmdt_first >= 0.25  (fast riser threshold in same filter)\n  - SELECT\n    - m.oid\n    - m.fid AS magstat_fid\n    - m.firstmjd\n    - m.dmdt_first\n    - m.dm_first\n    - m.dt_first\n- ms_day2\n  - FROM magstat m\n  - WHERE m.firstmjd >= 60189.0 AND m.firstmjd < 60190.0\n  - AND m.dmdt_first >= 0.25\n  - SELECT same columns as ms_day1\n- fast_risers_ms\n  - UNION ALL ms_day1 and ms_day2, preserving columns above\nNotes:\n- This captures per-band first detections on Sep 1\u20132 and applies the fast-riser constraint per filter.\n- Indexes: ix_magstats_firstmjd and ix_magstats_dmdt_first help.\n\n3) Intersection of OIDs meeting both the stamp-classifier and fast-riser conditions\n- selected_oids\n  - SELECT oid FROM sn_candidates\n  - INTERSECT\n  - SELECT oid FROM fast_risers_ms\nNotes:\n- Ensures objects simultaneously satisfy: SN at ranking=1 in stamp_classifier and fast-riser per magstat (in at least one filter within the date window).\n\n4) Non-detections prior to first detection in same filter (pre-detection LC subset)\n- nd_pre_first\n  - FROM non_detection nd\n  - INNER JOIN fast_risers_ms fm\n    - ON nd.oid = fm.oid\n    - AND nd.fid = fm.magstat_fid\n    - AND nd.mjd < fm.firstmjd\n  - This produces all non-detection points for the same filter and object prior to the first detection used to qualify the fast rise.\n  - SELECT\n    - nd.oid\n    - nd.fid AS fid  (requested \u201cfilter ID\u201d)\n    - nd.diffmaglim AS image_difference  (requested \u201cimage difference\u201d)\n    - fm.magstat_fid\n    - fm.dmdt_first AS initial_rise_estimate\n    - Optionally fm.firstmjd (not requested; omit in final projection)\nNotes:\n- Index: ix_non_detection_oid supports joining on oid; the additional filters (fid, mjd < firstmjd) keep it selective.\n- This satisfies \u201clight curves (including only non-detections)\u201d and keeps them relevant (pre-first-detection).\n\n5) Enforce that the non-detection rows belong to objects in the intersection\n- Filter nd_pre_first by selected_oids\n  - INNER JOIN selected_oids s ON nd_pre_first.oid = s.oid\nNotes:\n- Guarantees both conditions (SN stamp top class and fast-riser in date window).\n\n6) Attach the stamp-classifier probability to each retained non-detection row\n- Join sn_candidates sc to the filtered nd_pre_first rows\n  - INNER JOIN sn_candidates sc ON nd_pre_first.oid = sc.oid\n- This brings sc.stamp_probability into the final result.\n\n7) Final projection, ordering, and limit\n- SELECT the exact requested columns:\n  - oid\n  - stamp_probability (from sn_candidates)\n  - fid (from non_detection; alias as fid)\n  - image_difference (from non_detection.diffmaglim; alias as image_difference)\n  - magstat_fid (from fast_risers_ms)\n  - initial_rise_estimate (use fast_risers_ms.dmdt_first)\n- ORDER BY oid ASC\n- LIMIT 100\n\n8) Notes and edge cases\n- If you prefer to explicitly compute the initial rise instead of trusting dmdt_first, you can add a computed column -(fm.dm_first / NULLIF(fm.dt_first, 0)) AS initial_rise_estimate, and optionally use GREATEST(dmdt_first, -(dm_first/dt_first)) to remain conservative. Keep the selection threshold consistent with \u2265 0.25.\n- The plan returns one row per non-detection point (pre-first-detection) per filter that qualifies for the object; multiple rows per object are expected if multiple non-detections exist in the relevant filter before first detection.\n- If you also need to include non-detections after first detection, remove the condition nd.mjd < fm.firstmjd; as specified, we include only pre-detection non-detections.\n\nThis plan uses:\n- JOINs: probability \u2194 (selected oids), magstat \u2194 non_detection, and final joins to attach probabilities.\n- INTERSECT: to ensure objects satisfy both stamp-classifier SN top class and fast-riser conditions.\n- UNION: to combine the two daily slices of the first-detection window (Sep 1 and Sep 2).\n- Nested subqueries/CTEs: to structure filtering logically and efficiently."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nSelect objects whose stamp_classifier most-probable class (ranking = 1) is 'SN', whose first detection (per filter) occurs on 2024-09-01 or 2024-09-02 (MJD in [60188.0, 60190.0)), and that qualify as fast risers (brightening rate \u2265 0.25 mag/day in the same filter). Return only non-detections (light-curve upper limits) associated with those objects in the same filter prior to first detection. Output columns: oid, stamp-classifier probability, non_detection.fid (as fid), non_detection.diffmaglim (as image difference), magstat.fid (as magstat_fid), and an initial rise estimate. Order by oid; limit 100.\n\nKey schema elements used\n- probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n- magstat(oid, fid, firstmjd, dmdt_first, dm_first, dt_first, \u2026)\n- non_detection(oid, fid, mjd, diffmaglim)\n- object not strictly required for selection, but can be joined if needed; here we do not need columns from object.\n\nConstants\n- September 1 MJD = 60188.0\n- September 2 MJD = 60189.0\n- Two-day window: [60188.0, 60190.0) inclusive of Sep 1\u20132.\n- Fast riser threshold: \u2265 0.25 mag/day; use magstat.dmdt_first \u2265 0.25 as the initial rise estimate (consistent with definition \u201crate w.r.t. last non-detection in same filter\u201d). If needed, it can also be recomputed as -(dm_first/dt_first), but dmdt_first should be used directly.\n\nStep-by-step plan (use CTEs for clarity; do not return SQL)\n\n1) Subquery sn_candidates (stamp-classifier SN, highest probability)\n- FROM probability p\n- WHERE\n  - p.classifier_name = 'stamp_classifier'  (explicitly override default classifier)\n  - p.ranking = 1  (highest-probability class only)\n  - p.class_name = 'SN'\n- SELECT\n  - p.oid\n  - p.probability AS stamp_probability\n  - Optionally p.classifier_version (only if you need it; not required here)\nNotes:\n- Index usage: ix_probabilities_ranking supports the ranking filter; filtering by classifier_name and class_name will still be efficient on modest cardinalities.\n\n2) Day-sliced magstat selection per filter (two CTEs + UNION to define the two-day window)\nCreate two day-part subqueries to force a UNION as requested:\n- ms_day1\n  - FROM magstat m\n  - WHERE m.firstmjd >= 60188.0 AND m.firstmjd < 60189.0\n  - AND m.dmdt_first >= 0.25  (fast riser threshold in same filter)\n  - SELECT\n    - m.oid\n    - m.fid AS magstat_fid\n    - m.firstmjd\n    - m.dmdt_first\n    - m.dm_first\n    - m.dt_first\n- ms_day2\n  - FROM magstat m\n  - WHERE m.firstmjd >= 60189.0 AND m.firstmjd < 60190.0\n  - AND m.dmdt_first >= 0.25\n  - SELECT same columns as ms_day1\n- fast_risers_ms\n  - UNION ALL ms_day1 and ms_day2, preserving columns above\nNotes:\n- This captures per-band first detections on Sep 1\u20132 and applies the fast-riser constraint per filter.\n- Indexes: ix_magstats_firstmjd and ix_magstats_dmdt_first help.\n\n3) Intersection of OIDs meeting both the stamp-classifier and fast-riser conditions\n- selected_oids\n  - SELECT oid FROM sn_candidates\n  - INTERSECT\n  - SELECT oid FROM fast_risers_ms\nNotes:\n- Ensures objects simultaneously satisfy: SN at ranking=1 in stamp_classifier and fast-riser per magstat (in at least one filter within the date window).\n\n4) Non-detections prior to first detection in same filter (pre-detection LC subset)\n- nd_pre_first\n  - FROM non_detection nd\n  - INNER JOIN fast_risers_ms fm\n    - ON nd.oid = fm.oid\n    - AND nd.fid = fm.magstat_fid\n    - AND nd.mjd < fm.firstmjd\n  - This produces all non-detection points for the same filter and object prior to the first detection used to qualify the fast rise.\n  - SELECT\n    - nd.oid\n    - nd.fid AS fid  (requested \u201cfilter ID\u201d)\n    - nd.diffmaglim AS image_difference  (requested \u201cimage difference\u201d)\n    - fm.magstat_fid\n    - fm.dmdt_first AS initial_rise_estimate\n    - Optionally fm.firstmjd (not requested; omit in final projection)\nNotes:\n- Index: ix_non_detection_oid supports joining on oid; the additional filters (fid, mjd < firstmjd) keep it selective.\n- This satisfies \u201clight curves (including only non-detections)\u201d and keeps them relevant (pre-first-detection).\n\n5) Enforce that the non-detection rows belong to objects in the intersection\n- Filter nd_pre_first by selected_oids\n  - INNER JOIN selected_oids s ON nd_pre_first.oid = s.oid\nNotes:\n- Guarantees both conditions (SN stamp top class and fast-riser in date window).\n\n6) Attach the stamp-classifier probability to each retained non-detection row\n- Join sn_candidates sc to the filtered nd_pre_first rows\n  - INNER JOIN sn_candidates sc ON nd_pre_first.oid = sc.oid\n- This brings sc.stamp_probability into the final result.\n\n7) Final projection, ordering, and limit\n- SELECT the exact requested columns:\n  - oid\n  - stamp_probability (from sn_candidates)\n  - fid (from non_detection; alias as fid)\n  - image_difference (from non_detection.diffmaglim; alias as image_difference)\n  - magstat_fid (from fast_risers_ms)\n  - initial_rise_estimate (use fast_risers_ms.dmdt_first)\n- ORDER BY oid ASC\n- LIMIT 100\n\n8) Notes and edge cases\n- If you prefer to explicitly compute the initial rise instead of trusting dmdt_first, you can add a computed column -(fm.dm_first / NULLIF(fm.dt_first, 0)) AS initial_rise_estimate, and optionally use GREATEST(dmdt_first, -(dm_first/dt_first)) to remain conservative. Keep the selection threshold consistent with \u2265 0.25.\n- The plan returns one row per non-detection point (pre-first-detection) per filter that qualifies for the object; multiple rows per object are expected if multiple non-detections exist in the relevant filter before first detection.\n- If you also need to include non-detections after first detection, remove the condition nd.mjd < fm.firstmjd; as specified, we include only pre-detection non-detections.\n\nThis plan uses:\n- JOINs: probability \u2194 (selected oids), magstat \u2194 non_detection, and final joins to attach probabilities.\n- INTERSECT: to ensure objects satisfy both stamp-classifier SN top class and fast-riser conditions.\n- UNION: to combine the two daily slices of the first-detection window (Sep 1 and Sep 2).\n- Nested subqueries/CTEs: to structure filtering logically and efficiently."
                    },
                    "in_toks": 4007,
                    "out_toks": 7274,
                    "id": "chatcmpl-Cb5xHCfCfxpF2WQF1buwPmTsUnZUR",
                    "created": 1762957063,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- SN fast-risers from stamp_classifier on 2024-09-01/02 (MJD [60188.0, 60190.0))\n-- Return only non-detections prior to first detection in the same filter\nWITH sn_candidates AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'SN'),\n     ms_day1 AS\n  (SELECT m.oid,\n          m.fid AS magstat_fid,\n          m.firstmjd,\n          m.dmdt_first,\n          m.dm_first,\n          m.dt_first\n   FROM magstat m\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60189.0\n     AND m.dmdt_first >= 0.25),\n     ms_day2 AS\n  (SELECT m.oid,\n          m.fid AS magstat_fid,\n          m.firstmjd,\n          m.dmdt_first,\n          m.dm_first,\n          m.dt_first\n   FROM magstat m\n   WHERE m.firstmjd >= 60189.0\n     AND m.firstmjd < 60190.0\n     AND m.dmdt_first >= 0.25),\n     fast_risers_ms AS\n  (SELECT *\n   FROM ms_day1\n   UNION ALL SELECT *\n   FROM ms_day2),\n     selected_oids AS\n  (SELECT oid\n   FROM sn_candidates INTERSECT SELECT oid\n   FROM fast_risers_ms),\n     nd_pre_first AS\n  (SELECT nd.oid,\n          nd.fid,\n          nd.mjd,\n          nd.diffmaglim,\n          fm.magstat_fid,\n          fm.firstmjd,\n          fm.dmdt_first\n   FROM non_detection nd\n   INNER JOIN fast_risers_ms fm ON nd.oid = fm.oid\n   AND nd.fid = fm.magstat_fid\n   AND nd.mjd < fm.firstmjd)\nSELECT ndf.oid,\n       sc.probability,\n       ndf.fid,\n       ndf.diffmaglim,\n       ndf.magstat_fid,\n       ndf.dmdt_first\nFROM nd_pre_first ndf\nINNER JOIN selected_oids so ON ndf.oid = so.oid\nINNER JOIN sn_candidates sc ON ndf.oid = sc.oid\nORDER BY ndf.oid\nLIMIT 100;"
                        },
                        "in_toks": 4301,
                        "out_toks": 3009,
                        "id": "chatcmpl-Cb5zRGCyYYjO2putBEHbgGuFYokCa",
                        "created": 1762957197,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "4": {
            "req_id": "16",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection",
                "non_detection",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'detection', 'non_detection', 'magstat']"
                },
                "in_toks": 692,
                "out_toks": 2271,
                "id": "chatcmpl-CSsXgoCsGy8hrm2MIiBSeElpgHk9w",
                "created": 1760998880,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Fast, selective query:\n-- 1) Filter to objects with top-ranked 'SN' in the stamp_classifier (group to one row per oid).\n-- 2) Restrict to objects with first detection in [60188.0, 60190.0) and keep diffpos.\n-- 3) Get the band of the first detection per object from magstat using DISTINCT ON (avoids float equality join).\n-- 4) Keep only \"fast risers\" via dmdt_first or dm_first/dt_first.\n-- 5) Join to non_detection to return only non-detection light-curve rows in that band.\nWITH s_stamp AS\n  (SELECT p.oid,\n          MAX(p.probability) AS probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1\n   GROUP BY p.oid),\n     candidate AS\n  (SELECT o.oid,\n          o.firstmjd,\n          o.diffpos,\n          s.probability\n   FROM OBJECT o\n   JOIN s_stamp s ON s.oid = o.oid\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n     ms_first AS\n  (-- Earliest band per object (band of first detection)\n SELECT DISTINCT ON (ms.oid) ms.oid,\n                    ms.fid AS magstat_fid,\n                    ms.dmdt_first,\n                    ms.dm_first,\n                    ms.dt_first\n   FROM magstat ms\n   JOIN candidate c ON c.oid = ms.oid\n   ORDER BY ms.oid,\n            ms.firstmjd ASC),\n     fast_risers AS\n  (SELECT mf.*\n   FROM ms_first mf\n   WHERE (mf.dmdt_first <= -0.25)\n     OR (mf.dt_first > 0\n         AND (-mf.dm_first / mf.dt_first) >= 0.25))\nSELECT c.oid,\n       c.probability,\n       nd.fid,\n       c.diffpos,\n       fr.magstat_fid,\n       fr.dmdt_first AS initial_rise_estimate,\n       nd.mjd,\n       nd.diffmaglim\nFROM candidate c\nJOIN fast_risers fr ON fr.oid = c.oid\nJOIN non_detection nd ON nd.oid = c.oid\nAND nd.fid = fr.magstat_fid\nORDER BY c.oid\nLIMIT 100;",
            "sql_response": {
                "responses": {
                    "0": "-- Fast, selective query:\n-- 1) Filter to objects with top-ranked 'SN' in the stamp_classifier (group to one row per oid).\n-- 2) Restrict to objects with first detection in [60188.0, 60190.0) and keep diffpos.\n-- 3) Get the band of the first detection per object from magstat using DISTINCT ON (avoids float equality join).\n-- 4) Keep only \"fast risers\" via dmdt_first or dm_first/dt_first.\n-- 5) Join to non_detection to return only non-detection light-curve rows in that band.\nWITH s_stamp AS\n  (SELECT p.oid,\n          MAX(p.probability) AS probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1\n   GROUP BY p.oid),\n     candidate AS\n  (SELECT o.oid,\n          o.firstmjd,\n          o.diffpos,\n          s.probability\n   FROM OBJECT o\n   JOIN s_stamp s ON s.oid = o.oid\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n     ms_first AS\n  (-- Earliest band per object (band of first detection)\n SELECT DISTINCT ON (ms.oid) ms.oid,\n                    ms.fid AS magstat_fid,\n                    ms.dmdt_first,\n                    ms.dm_first,\n                    ms.dt_first\n   FROM magstat ms\n   JOIN candidate c ON c.oid = ms.oid\n   ORDER BY ms.oid,\n            ms.firstmjd ASC),\n     fast_risers AS\n  (SELECT mf.*\n   FROM ms_first mf\n   WHERE (mf.dmdt_first <= -0.25)\n     OR (mf.dt_first > 0\n         AND (-mf.dm_first / mf.dt_first) >= 0.25))\nSELECT c.oid,\n       c.probability,\n       nd.fid,\n       c.diffpos,\n       fr.magstat_fid,\n       fr.dmdt_first AS initial_rise_estimate,\n       nd.mjd,\n       nd.diffmaglim\nFROM candidate c\nJOIN fast_risers fr ON fr.oid = c.oid\nJOIN non_detection nd ON nd.oid = c.oid\nAND nd.fid = fr.magstat_fid\nORDER BY c.oid\nLIMIT 100;"
                },
                "in_toks": 3705,
                "out_toks": 3146,
                "id": "chatcmpl-CbGs7bDlHEyYRvN9R8mksPQN1NRlW",
                "created": 1762999027,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2597,
                "out_toks": 1231,
                "id": "chatcmpl-CSxSBrPy41unGBMqQ4QpbzTWVS4qg",
                "created": 1761017759,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Objects with top stamp_classifier class 'SN', first detection in [60188.0, 60190.0),\n-- fast risers in the band of first detection, returning only non-detection light-curve rows.\nWITH S_stamp AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'SN'),\n     S_date AS\n  (SELECT o.oid,\n          o.firstmjd,\n          o.diffpos\n   FROM OBJECT o\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n     S_first_band AS\n  (-- Identify the band of the first detection by matching magstat.firstmjd to object.firstmjd\n SELECT ms.oid,\n        ms.fid AS magstat_fid,\n        ms.dmdt_first,\n        ms.dm_first,\n        ms.dt_first\n   FROM magstat ms\n   INNER JOIN OBJECT o ON o.oid = ms.oid\n   AND o.firstmjd = ms.firstmjd),\n     S_fast_by_dmdt AS\n  (-- Fast riser via lower-limit rate (brightening: negative magnitude rate)\n SELECT DISTINCT fb.oid,\n                 fb.magstat_fid,\n                 fb.dmdt_first,\n                 fb.dm_first,\n                 fb.dt_first\n   FROM S_first_band fb\n   WHERE fb.dmdt_first <= -0.25),\n     S_fast_by_ratio AS\n  (-- Fast riser via derived rate using dm_first and dt_first (brightening >= 0.25 mag/day)\n SELECT DISTINCT fb.oid,\n                 fb.magstat_fid,\n                 fb.dmdt_first,\n                 fb.dm_first,\n                 fb.dt_first\n   FROM S_first_band fb\n   WHERE fb.dt_first > 0\n     AND (-fb.dm_first / fb.dt_first) >= 0.25),\n     S_fast AS\n  (SELECT DISTINCT *\n   FROM\n     (SELECT *\n      FROM S_fast_by_dmdt\n      UNION SELECT *\n      FROM S_fast_by_ratio) u),\n     E_oids AS (\n                  (SELECT oid\n                   FROM S_stamp) INTERSECT\n                  (SELECT oid\n                   FROM S_date) INTERSECT\n                  (SELECT oid\n                   FROM S_fast))\nSELECT e.oid,\n       sst.probability,\n       nd.fid,\n       sdt.diffpos,\n       sfa.magstat_fid,\n       sfa.dmdt_first AS initial_rise_estimate,\n       nd.mjd,\n       nd.diffmaglim\nFROM E_oids e\nINNER JOIN S_stamp sst ON sst.oid = e.oid\nINNER JOIN S_date sdt ON sdt.oid = e.oid\nINNER JOIN S_fast sfa ON sfa.oid = e.oid\nINNER JOIN non_detection nd ON nd.oid = e.oid\nAND nd.fid = sfa.magstat_fid\nORDER BY e.oid\nLIMIT 100;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nReturn a light-curve result set (only non-detections) for objects that:\n- have their top stamp_classifier class as 'SN',\n- had their first detection in the first two days of September (MJD in [60188.0, 60190.0)),\n- qualify as fast risers (per-band, same band as the first detection),\nand include, per row:\n- oid,\n- stamp-classifier probability,\n- non_detection filter ID (as fid),\n- image difference sign of the first detection (object.diffpos),\n- the magstat filter ID as magstat_fid,\n- the initial rise estimate (from magstat),\n- all non_detection columns (to represent the \u201clight curve\u201d of non-detections).\nOrder by oid and limit to 100 rows.\n\nNotes and conventions\n- Use probability.classifier_name='stamp_classifier' and probability.ranking=1 explicitly (user-specified classifier differs from default).\n- Use the exact class name 'SN'.\n- MJD window: [60188.0, 60190.0) for \u201cfirst 2 days of September\u201d.\n- \u201cImage difference\u201d will be returned as object.diffpos (sign of the first detection).\n- The fast-riser criterion is enforced using magstat, matched to the band where the first detection occurred: object.firstmjd = magstat.firstmjd. Use magstat.dmdt_first as \u201cinitial rise estimate\u201d; enforce brightening rate threshold via that column. To be robust, also allow a derived rate using magstat.dm_first and magstat.dt_first.\n- Return only non-detection rows (from non_detection), restricting to the same band as the first detection for physical consistency.\n\nHigh-level structure and join order\n- Build small candidate sets with subqueries/CTEs and intersect their oids.\n- Then join the intersected oid set to probability (to fetch the probability value), object (for diffpos), magstat (for dmdt_first and magstat_fid), and finally non_detection (for the LC rows).\n- Avoid scanning detection; use object.firstmjd and magstat.firstmjd equality to identify the band of first detection.\n\nStep-by-step subtasks and nested subqueries\n\n1) Define constants\n- Define the September window:\n  - start_mjd = 60188.0\n  - end_mjd = 60190.0\n\n2) Subquery S_stamp (top stamp SN objects)\n- From probability:\n  - Filter: probability.classifier_name = 'stamp_classifier'\n  - Filter: probability.ranking = 1\n  - Filter: probability.class_name = 'SN'\n- Select: probability.oid, probability.probability AS stamp_prob\n- This subquery captures \u201chighest probability in the stamp classifier is SN\u201d and retains the probability value to return later.\n- Index use: ix_probabilities_ranking (ranking), and ix_probabilities_oid for subsequent joins.\n\n3) Subquery S_date (objects with first detection in first two days of September)\n- From object:\n  - Filter: object.firstmjd >= 60188.0\n  - Filter: object.firstmjd < 60190.0\n- Select: object.oid, object.firstmjd, object.diffpos\n- Index use: ix_object_firstmjd.\n\n4) Subquery S_first_band (identify the band corresponding to the first detection)\n- From magstat INNER JOIN object ON magstat.oid = object.oid AND magstat.firstmjd = object.firstmjd\n  - This ensures we are in the band where the first detection happened (band-level firstmjd equals object-level firstmjd).\n- Select:\n  - magstat.oid,\n  - magstat.fid AS magstat_fid,\n  - magstat.dmdt_first,\n  - magstat.dm_first,\n  - magstat.dt_first\n- Index use: ix_magstats_firstmjd and ix_magstats_oid.\n\n5) Fast-riser filtering (use UNION to combine two consistent implementations)\n- Implement two alternative fast-riser detections in the first-detection band and UNION them:\n  a) S_fast_by_dmdt:\n     - Start from S_first_band.\n     - Filter: magstat.dmdt_first <= -0.25\n       (Brightening is decreasing magnitude; negative rate of magnitude change of at least 0.25 mag/day.)\n     - Select: oid, magstat_fid, dmdt_first, dm_first, dt_first.\n  b) S_fast_by_ratio:\n     - Start from S_first_band.\n     - Filter: dt_first > 0\n     - Filter: (-dm_first / dt_first) >= 0.25\n       (Derived brightening rate at least 0.25 mag/day.)\n     - Select: oid, magstat_fid, dmdt_first, dm_first, dt_first.\n- S_fast = DISTINCT UNION of S_fast_by_dmdt and S_fast_by_ratio.\n- This UNION ensures we consider either the precomputed lower-limit rate or the derived rate.\n\n6) Intersect object sets to get eligible oids\n- E_oids = (SELECT oid FROM S_stamp)\n  INTERSECT\n  (SELECT oid FROM S_date)\n  INTERSECT\n  (SELECT oid FROM S_fast)\n- This yields only objects that satisfy all three conditions: top stamp SN, first detection date window, and fast riser.\n\n7) Assemble final result rows (join to add attributes and light-curve non-detections)\n- Build a final subquery that:\n  - Starts from E_oids as the driving (small) set.\n  - INNER JOIN S_stamp ON oid to retrieve stamp_prob.\n  - INNER JOIN S_date ON oid to attach object.diffpos (image difference sign) and firstmjd (if needed downstream).\n  - INNER JOIN S_fast ON oid to attach magstat_fid and the initial rise metrics (dmdt_first, dm_first, dt_first).\n    - Note: If S_fast contains multiple rows per oid due to both methods matching, you can prefer one by aggregating or keep as-is; since we require the band of first detection, and S_fast is derived from S_first_band, there should typically be one row per oid. If duplicates might arise, use DISTINCT before joining.\n  - INNER JOIN non_detection ND ON ND.oid = E_oids.oid AND ND.fid = S_fast.magstat_fid\n    - This restricts non-detections to the same filter as the first detection (consistent with the fast-riser definition).\n    - Optionally, to focus on the pre-detection non-detections only, you could add ND.mjd <= S_date.firstmjd; however, the user asked for light curves \u201cincluding only non-detections\u201d without a time restriction, so omit unless needed.\n\n8) Select list\n- Include:\n  - E_oids.oid AS oid\n  - S_stamp.stamp_prob AS probability\n  - ND.fid AS fid\n  - S_date.diffpos AS image_difference\n  - S_fast.magstat_fid AS magstat_fid\n  - S_fast.dmdt_first AS initial_rise_estimate\n- Also include all columns from non_detection to provide the non-detection light curve points:\n  - ND.oid, ND.fid, ND.mjd, ND.diffmaglim\n  - As the user did not specify every non_detection column explicitly and requested the light curve of non-detections, select ND.* alongside the additional requested fields. Ensure that aliasing avoids duplicate oid columns ambiguity in client consumption.\n- If necessary, avoid duplicate columns by aliasing ND.oid as oid and omitting extra duplicates from other joined tables in the final projection.\n\n9) Sorting and limiting\n- ORDER BY oid ASC (as requested).\n- LIMIT 100 (as requested).\n\n10) Performance considerations\n- The plan minimizes heavy scans by:\n  - Using probability filters with ranking=1 and class_name='SN' to reduce the set early (leveraging indexes on ranking and oid).\n  - Using object.firstmjd btree index for the date window.\n  - Using magstat.firstmjd join to object.firstmjd to find the first-detection band, leveraging magstat\u2019s indexes.\n  - Joining non_detection last and restricting to the same fid as the first detection to reduce row explosion.\n- Avoids filtering on detection (table) parameters other than oid by not using detection at all.\n\n11) Summary of all tables, columns, and conditions used\n- probability:\n  - Filters: classifier_name='stamp_classifier', ranking=1, class_name='SN'\n  - Output: probability (as probability), oid\n- object:\n  - Filters: firstmjd >= 60188.0 AND firstmjd < 60190.0\n  - Output: oid, diffpos (as image_difference), firstmjd\n- magstat:\n  - Join: magstat.oid = object.oid AND magstat.firstmjd = object.firstmjd\n  - Fast-riser filters (combined via UNION):\n    - dmdt_first <= -0.25\n    - OR (dt_first > 0 AND (-dm_first / dt_first) >= 0.25)\n  - Output: fid AS magstat_fid, dmdt_first AS initial_rise_estimate, dm_first, dt_first\n- non_detection:\n  - Join: non_detection.oid = E_oids.oid AND non_detection.fid = magstat.fid\n  - Output: ND.* for light-curve non-detection points, plus ND.fid as fid\n\n12) Final constraints\n- Use INTERSECT across S_stamp, S_date, and S_fast to ensure all conditions are simultaneously satisfied.\n- Use UNION across S_fast_by_dmdt and S_fast_by_ratio to be inclusive in identifying fast risers.\n- Order final results by oid and limit to 100 rows."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nReturn a light-curve result set (only non-detections) for objects that:\n- have their top stamp_classifier class as 'SN',\n- had their first detection in the first two days of September (MJD in [60188.0, 60190.0)),\n- qualify as fast risers (per-band, same band as the first detection),\nand include, per row:\n- oid,\n- stamp-classifier probability,\n- non_detection filter ID (as fid),\n- image difference sign of the first detection (object.diffpos),\n- the magstat filter ID as magstat_fid,\n- the initial rise estimate (from magstat),\n- all non_detection columns (to represent the \u201clight curve\u201d of non-detections).\nOrder by oid and limit to 100 rows.\n\nNotes and conventions\n- Use probability.classifier_name='stamp_classifier' and probability.ranking=1 explicitly (user-specified classifier differs from default).\n- Use the exact class name 'SN'.\n- MJD window: [60188.0, 60190.0) for \u201cfirst 2 days of September\u201d.\n- \u201cImage difference\u201d will be returned as object.diffpos (sign of the first detection).\n- The fast-riser criterion is enforced using magstat, matched to the band where the first detection occurred: object.firstmjd = magstat.firstmjd. Use magstat.dmdt_first as \u201cinitial rise estimate\u201d; enforce brightening rate threshold via that column. To be robust, also allow a derived rate using magstat.dm_first and magstat.dt_first.\n- Return only non-detection rows (from non_detection), restricting to the same band as the first detection for physical consistency.\n\nHigh-level structure and join order\n- Build small candidate sets with subqueries/CTEs and intersect their oids.\n- Then join the intersected oid set to probability (to fetch the probability value), object (for diffpos), magstat (for dmdt_first and magstat_fid), and finally non_detection (for the LC rows).\n- Avoid scanning detection; use object.firstmjd and magstat.firstmjd equality to identify the band of first detection.\n\nStep-by-step subtasks and nested subqueries\n\n1) Define constants\n- Define the September window:\n  - start_mjd = 60188.0\n  - end_mjd = 60190.0\n\n2) Subquery S_stamp (top stamp SN objects)\n- From probability:\n  - Filter: probability.classifier_name = 'stamp_classifier'\n  - Filter: probability.ranking = 1\n  - Filter: probability.class_name = 'SN'\n- Select: probability.oid, probability.probability AS stamp_prob\n- This subquery captures \u201chighest probability in the stamp classifier is SN\u201d and retains the probability value to return later.\n- Index use: ix_probabilities_ranking (ranking), and ix_probabilities_oid for subsequent joins.\n\n3) Subquery S_date (objects with first detection in first two days of September)\n- From object:\n  - Filter: object.firstmjd >= 60188.0\n  - Filter: object.firstmjd < 60190.0\n- Select: object.oid, object.firstmjd, object.diffpos\n- Index use: ix_object_firstmjd.\n\n4) Subquery S_first_band (identify the band corresponding to the first detection)\n- From magstat INNER JOIN object ON magstat.oid = object.oid AND magstat.firstmjd = object.firstmjd\n  - This ensures we are in the band where the first detection happened (band-level firstmjd equals object-level firstmjd).\n- Select:\n  - magstat.oid,\n  - magstat.fid AS magstat_fid,\n  - magstat.dmdt_first,\n  - magstat.dm_first,\n  - magstat.dt_first\n- Index use: ix_magstats_firstmjd and ix_magstats_oid.\n\n5) Fast-riser filtering (use UNION to combine two consistent implementations)\n- Implement two alternative fast-riser detections in the first-detection band and UNION them:\n  a) S_fast_by_dmdt:\n     - Start from S_first_band.\n     - Filter: magstat.dmdt_first <= -0.25\n       (Brightening is decreasing magnitude; negative rate of magnitude change of at least 0.25 mag/day.)\n     - Select: oid, magstat_fid, dmdt_first, dm_first, dt_first.\n  b) S_fast_by_ratio:\n     - Start from S_first_band.\n     - Filter: dt_first > 0\n     - Filter: (-dm_first / dt_first) >= 0.25\n       (Derived brightening rate at least 0.25 mag/day.)\n     - Select: oid, magstat_fid, dmdt_first, dm_first, dt_first.\n- S_fast = DISTINCT UNION of S_fast_by_dmdt and S_fast_by_ratio.\n- This UNION ensures we consider either the precomputed lower-limit rate or the derived rate.\n\n6) Intersect object sets to get eligible oids\n- E_oids = (SELECT oid FROM S_stamp)\n  INTERSECT\n  (SELECT oid FROM S_date)\n  INTERSECT\n  (SELECT oid FROM S_fast)\n- This yields only objects that satisfy all three conditions: top stamp SN, first detection date window, and fast riser.\n\n7) Assemble final result rows (join to add attributes and light-curve non-detections)\n- Build a final subquery that:\n  - Starts from E_oids as the driving (small) set.\n  - INNER JOIN S_stamp ON oid to retrieve stamp_prob.\n  - INNER JOIN S_date ON oid to attach object.diffpos (image difference sign) and firstmjd (if needed downstream).\n  - INNER JOIN S_fast ON oid to attach magstat_fid and the initial rise metrics (dmdt_first, dm_first, dt_first).\n    - Note: If S_fast contains multiple rows per oid due to both methods matching, you can prefer one by aggregating or keep as-is; since we require the band of first detection, and S_fast is derived from S_first_band, there should typically be one row per oid. If duplicates might arise, use DISTINCT before joining.\n  - INNER JOIN non_detection ND ON ND.oid = E_oids.oid AND ND.fid = S_fast.magstat_fid\n    - This restricts non-detections to the same filter as the first detection (consistent with the fast-riser definition).\n    - Optionally, to focus on the pre-detection non-detections only, you could add ND.mjd <= S_date.firstmjd; however, the user asked for light curves \u201cincluding only non-detections\u201d without a time restriction, so omit unless needed.\n\n8) Select list\n- Include:\n  - E_oids.oid AS oid\n  - S_stamp.stamp_prob AS probability\n  - ND.fid AS fid\n  - S_date.diffpos AS image_difference\n  - S_fast.magstat_fid AS magstat_fid\n  - S_fast.dmdt_first AS initial_rise_estimate\n- Also include all columns from non_detection to provide the non-detection light curve points:\n  - ND.oid, ND.fid, ND.mjd, ND.diffmaglim\n  - As the user did not specify every non_detection column explicitly and requested the light curve of non-detections, select ND.* alongside the additional requested fields. Ensure that aliasing avoids duplicate oid columns ambiguity in client consumption.\n- If necessary, avoid duplicate columns by aliasing ND.oid as oid and omitting extra duplicates from other joined tables in the final projection.\n\n9) Sorting and limiting\n- ORDER BY oid ASC (as requested).\n- LIMIT 100 (as requested).\n\n10) Performance considerations\n- The plan minimizes heavy scans by:\n  - Using probability filters with ranking=1 and class_name='SN' to reduce the set early (leveraging indexes on ranking and oid).\n  - Using object.firstmjd btree index for the date window.\n  - Using magstat.firstmjd join to object.firstmjd to find the first-detection band, leveraging magstat\u2019s indexes.\n  - Joining non_detection last and restricting to the same fid as the first detection to reduce row explosion.\n- Avoids filtering on detection (table) parameters other than oid by not using detection at all.\n\n11) Summary of all tables, columns, and conditions used\n- probability:\n  - Filters: classifier_name='stamp_classifier', ranking=1, class_name='SN'\n  - Output: probability (as probability), oid\n- object:\n  - Filters: firstmjd >= 60188.0 AND firstmjd < 60190.0\n  - Output: oid, diffpos (as image_difference), firstmjd\n- magstat:\n  - Join: magstat.oid = object.oid AND magstat.firstmjd = object.firstmjd\n  - Fast-riser filters (combined via UNION):\n    - dmdt_first <= -0.25\n    - OR (dt_first > 0 AND (-dm_first / dt_first) >= 0.25)\n  - Output: fid AS magstat_fid, dmdt_first AS initial_rise_estimate, dm_first, dt_first\n- non_detection:\n  - Join: non_detection.oid = E_oids.oid AND non_detection.fid = magstat.fid\n  - Output: ND.* for light-curve non-detection points, plus ND.fid as fid\n\n12) Final constraints\n- Use INTERSECT across S_stamp, S_date, and S_fast to ensure all conditions are simultaneously satisfied.\n- Use UNION across S_fast_by_dmdt and S_fast_by_ratio to be inclusive in identifying fast risers.\n- Order final results by oid and limit to 100 rows."
                    },
                    "in_toks": 4555,
                    "out_toks": 7577,
                    "id": "chatcmpl-Cb60IEm7K57JvLGLTaDpsAoN9DypS",
                    "created": 1762957250,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Objects with top stamp_classifier class 'SN', first detection in [60188.0, 60190.0),\n-- fast risers in the band of first detection, returning only non-detection light-curve rows.\nWITH S_stamp AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'SN'),\n     S_date AS\n  (SELECT o.oid,\n          o.firstmjd,\n          o.diffpos\n   FROM OBJECT o\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n     S_first_band AS\n  (-- Identify the band of the first detection by matching magstat.firstmjd to object.firstmjd\n SELECT ms.oid,\n        ms.fid AS magstat_fid,\n        ms.dmdt_first,\n        ms.dm_first,\n        ms.dt_first\n   FROM magstat ms\n   INNER JOIN OBJECT o ON o.oid = ms.oid\n   AND o.firstmjd = ms.firstmjd),\n     S_fast_by_dmdt AS\n  (-- Fast riser via lower-limit rate (brightening: negative magnitude rate)\n SELECT DISTINCT fb.oid,\n                 fb.magstat_fid,\n                 fb.dmdt_first,\n                 fb.dm_first,\n                 fb.dt_first\n   FROM S_first_band fb\n   WHERE fb.dmdt_first <= -0.25),\n     S_fast_by_ratio AS\n  (-- Fast riser via derived rate using dm_first and dt_first (brightening >= 0.25 mag/day)\n SELECT DISTINCT fb.oid,\n                 fb.magstat_fid,\n                 fb.dmdt_first,\n                 fb.dm_first,\n                 fb.dt_first\n   FROM S_first_band fb\n   WHERE fb.dt_first > 0\n     AND (-fb.dm_first / fb.dt_first) >= 0.25),\n     S_fast AS\n  (SELECT DISTINCT *\n   FROM\n     (SELECT *\n      FROM S_fast_by_dmdt\n      UNION SELECT *\n      FROM S_fast_by_ratio) u),\n     E_oids AS (\n                  (SELECT oid\n                   FROM S_stamp) INTERSECT\n                  (SELECT oid\n                   FROM S_date) INTERSECT\n                  (SELECT oid\n                   FROM S_fast))\nSELECT e.oid,\n       sst.probability,\n       nd.fid,\n       sdt.diffpos,\n       sfa.magstat_fid,\n       sfa.dmdt_first AS initial_rise_estimate,\n       nd.mjd,\n       nd.diffmaglim\nFROM E_oids e\nINNER JOIN S_stamp sst ON sst.oid = e.oid\nINNER JOIN S_date sdt ON sdt.oid = e.oid\nINNER JOIN S_fast sfa ON sfa.oid = e.oid\nINNER JOIN non_detection nd ON nd.oid = e.oid\nAND nd.fid = sfa.magstat_fid\nORDER BY e.oid\nLIMIT 100;"
                        },
                        "in_toks": 5280,
                        "out_toks": 3618,
                        "id": "chatcmpl-Cb62k6umEz6YcQY6FRrhsu5mMGC9h",
                        "created": 1762957402,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "5": {
            "req_id": "16",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "non_detection",
                "detection",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'non_detection', 'detection', 'magstat']"
                },
                "in_toks": 692,
                "out_toks": 1695,
                "id": "chatcmpl-CZMFLpjUrbQls7ZvfGPm0uZMKbWHB",
                "created": 1762543031,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Get top-SN stamp-classified objects with first detection on Sep 1\u20132 (MJD 60188\u201360190),\n-- that are fast risers per-band, then fetch only their non-detections in the same band.\n-- Limit early (before joining non_detection) to avoid timeouts, and again at the end for safety.\n WITH eligible_fast AS\n  (SELECT e.oid,\n          e.probability,\n          m.fid AS magstat_fid,\n          m.dmdt_first AS initial_rise_estimate\n   FROM\n     (SELECT p.oid,\n             p.probability\n      FROM probability p\n      JOIN OBJECT o ON o.oid = p.oid\n      WHERE p.classifier_name = 'stamp_classifier' -- classifier filter\n\n        AND p.class_name = 'SN' -- top class must be SN\n\n        AND p.ranking = 1 -- highest probability class\n\n        AND o.firstmjd >= 60188.0 -- first detection: Sep 1 (MJD)\n\n        AND o.firstmjd < 60190.0 -- first detection: up to Sep 2 (MJD)\n) e\n   JOIN magstat m ON m.oid = e.oid\n   WHERE m.dt_first > 0\n     AND m.dm_first IS NOT NULL\n     AND (-m.dm_first / m.dt_first) >= 0.25 -- fast-riser threshold\n\n   ORDER BY e.oid\n   LIMIT 100 -- limit early to reduce non_detection join size\n)\nSELECT ef.oid,\n       ef.probability,\n       nd.fid,\n       nd.diffmaglim,\n       ef.magstat_fid,\n       ef.initial_rise_estimate\nFROM eligible_fast ef\nJOIN non_detection nd ON nd.oid = ef.oid\nAND nd.fid = ef.magstat_fid\nORDER BY ef.oid\nLIMIT 100;",
            "sql_response": {
                "responses": {
                    "0": "-- Get top-SN stamp-classified objects with first detection on Sep 1\u20132 (MJD 60188\u201360190),\n-- that are fast risers per-band, then fetch only their non-detections in the same band.\n-- Limit early (before joining non_detection) to avoid timeouts, and again at the end for safety.\n WITH eligible_fast AS\n  (SELECT e.oid,\n          e.probability,\n          m.fid AS magstat_fid,\n          m.dmdt_first AS initial_rise_estimate\n   FROM\n     (SELECT p.oid,\n             p.probability\n      FROM probability p\n      JOIN OBJECT o ON o.oid = p.oid\n      WHERE p.classifier_name = 'stamp_classifier' -- classifier filter\n\n        AND p.class_name = 'SN' -- top class must be SN\n\n        AND p.ranking = 1 -- highest probability class\n\n        AND o.firstmjd >= 60188.0 -- first detection: Sep 1 (MJD)\n\n        AND o.firstmjd < 60190.0 -- first detection: up to Sep 2 (MJD)\n) e\n   JOIN magstat m ON m.oid = e.oid\n   WHERE m.dt_first > 0\n     AND m.dm_first IS NOT NULL\n     AND (-m.dm_first / m.dt_first) >= 0.25 -- fast-riser threshold\n\n   ORDER BY e.oid\n   LIMIT 100 -- limit early to reduce non_detection join size\n)\nSELECT ef.oid,\n       ef.probability,\n       nd.fid,\n       nd.diffmaglim,\n       ef.magstat_fid,\n       ef.initial_rise_estimate\nFROM eligible_fast ef\nJOIN non_detection nd ON nd.oid = ef.oid\nAND nd.fid = ef.magstat_fid\nORDER BY ef.oid\nLIMIT 100;"
                },
                "in_toks": 3223,
                "out_toks": 2779,
                "id": "chatcmpl-CbGtDFTttMhHOlygigxt6uo2rRUjn",
                "created": 1762999095,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2597,
                "out_toks": 1295,
                "id": "chatcmpl-CZYDhbMJqvAdoZchSXFzhc0NcAQ75",
                "created": 1762589057,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Eligible objects: top stamp-classifier class 'SN', first detection on Sep 1\u20132, and fast risers per-band\nWITH S AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'SN'),\n     D AS\n  (SELECT o.oid,\n          o.firstmjd\n   FROM OBJECT o\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n     FR AS\n  (-- fast risers per-band (same filter)\n SELECT m.oid,\n        m.fid AS magstat_fid,\n        m.dmdt_first AS initial_rise_estimate,\n        m.dm_first,\n        m.dt_first\n   FROM magstat m\n   WHERE m.dt_first > 0\n     AND m.dm_first IS NOT NULL\n     AND (-m.dm_first / m.dt_first) >= 0.25),\n     E AS\n  (-- eligible oids present in all three sets\n SELECT oid\n   FROM S INTERSECT SELECT oid\n   FROM D INTERSECT SELECT DISTINCT oid\n   FROM FR),\n     EF AS\n  (-- keep only fast-riser bands for eligible objects\n SELECT fr.oid,\n        fr.magstat_fid,\n        fr.initial_rise_estimate\n   FROM FR fr\n   INNER JOIN E USING (oid))\nSELECT e.oid,\n       s.probability,\n       nd.fid,\n       nd.diffmaglim,\n       ef.magstat_fid,\n       ef.initial_rise_estimate\nFROM E e\nINNER JOIN S s USING (oid)\nINNER JOIN EF ef USING (oid)\nINNER JOIN non_detection nd ON nd.oid = ef.oid\nAND nd.fid = ef.magstat_fid\nORDER BY e.oid\nLIMIT 100;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query over the ALeRCE database\n\nGoal\nRetrieve, for objects with top stamp-classifier class SN, whose first detection (object-level) occurred on Sep 1\u20132 (MJD in [60188.0, 60190.0)), and that qualify as fast risers (per-band initial rise \u2265 0.25 mag/day between the last non-detection and the first detection in the same filter), the following:\n- oid\n- stamp-classifier probability\n- non-detection light-curve entries only: fid and diffmaglim\n- magstat fid as magstat_fid\n- initial rise estimate (from magstat)\nOrder results by oid; limit 100.\n\nKey schema facts to use\n- object.firstmjd is indexed (ix_object_firstmjd).\n- probability has a partial index on ranking=1 (ix_classification_rank1) and hash index on oid (ix_probabilities_oid).\n- magstat has indexes on dmdt_first, firstmjd (ix_magstats_dmdt_first, ix_magstats_firstmjd).\n- non_detection has a hash index on oid (ix_non_detection_oid).\n- Use probability with explicit conditions overriding defaults: classifier_name='stamp_classifier' and ranking=1, class_name='SN'.\n- Fast-riser condition must be computed in-band. Use magstat fields that link first detection to last non-detection in the same fid:\n  - dm_first (mag change at first detection vs last non-detection)\n  - dt_first (time from last non-detection to first detection)\n  - dmdt_first (lower limit for rate of magnitude change)\n  The strict condition is: -dm_first / dt_first \u2265 0.25, with dt_first > 0.\n\nHigh-level structure\nUse nested CTEs/subqueries to:\n- Select stamp-classifier SN objects (top class).\n- Select objects with first detections in the date window.\n- Select fast-riser objects per fid from magstat (build per-fid sets and UNION them).\n- INTERSECT the three sets of oids to get eligible objects.\n- Join eligible objects to:\n  - stamp-classifier probabilities,\n  - per-fid magstat fast-riser rows,\n  - non_detection light-curve rows restricted to the fast-riser fid,\nand project required columns.\n- ORDER BY oid and LIMIT 100.\n\nDetailed steps\n\n1) Define constants (no code, just for clarity)\n- start_mjd = 60188.0\n- end_mjd = 60190.0\n- fast_rise_threshold = 0.25 (mag/day)\n\n2) Subquery/CTE S: stamp SN objects (top class)\n- From table: probability\n- Filters:\n  - probability.classifier_name = 'stamp_classifier'  [explicit override of default]\n  - probability.ranking = 1                           [top-probability class only]\n  - probability.class_name = 'SN'\n- Columns to select:\n  - probability.oid\n  - probability.probability AS stamp_probability\n  - probability.classifier_version (optional metadata)\n- Rationale: S is the set of objects whose highest-probability stamp class is SN; use ix_classification_rank1 and filter by classifier_name/class_name.\n\n3) Subquery/CTE D: objects with first detection in Sep 1\u20132 (object-level)\n- From table: object\n- Filters:\n  - object.firstmjd >= start_mjd\n  - object.firstmjd < end_mjd\n- Columns to select:\n  - object.oid\n  - object.firstmjd (for possible diagnostics/inspection)\n- Rationale: constrains on object-level first detection time; uses ix_object_firstmjd.\n\n4) Subqueries/CTEs for fast risers per fid in magstat (in-band condition), then UNION\n\nFor each fid in {1, 2, 3}:\n- From table: magstat\n- Filters:\n  - magstat.fid = <fid>\n  - magstat.dt_first > 0 (avoid division by zero)\n  - magstat.dm_first IS NOT NULL\n  - Computed fast-riser condition: (-magstat.dm_first / magstat.dt_first) >= fast_rise_threshold\n    Note: This enforces that the first detection is brighter than the last non-detection by at least 0.25 mag/day. Both are in the same filter by construction of magstat.\n  - Optionally keep magstat.dmdt_first to return as initial rise estimate; it is the lower-limit rate and is indexed.\n- Columns to select:\n  - magstat.oid\n  - magstat.fid AS magstat_fid\n  - magstat.dmdt_first AS initial_rise_estimate\n  - magstat.dm_first\n  - magstat.dt_first\n  - magstat.firstmjd (optional; could be used for diagnostics)\n- CTEs: FR_g for fid=1, FR_r for fid=2, FR_i for fid=3\n- UNION ALL the three CTEs into a single CTE FR_all_fast_risers with the same columns.\n- Rationale: per-fid evaluation ensures the \u201csame filter\u201d constraint; UNION consolidates eligible per-band entries; magstat indices assist performance.\n\n5) Build oid sets and INTERSECT to get the eligible object list E\n- Set S_oids: SELECT DISTINCT oid FROM S\n- Set D_oids: SELECT DISTINCT oid FROM D\n- Set F_oids: SELECT DISTINCT oid FROM FR_all_fast_risers\n- INTERSECT:\n  - E_oids = S_oids INTERSECT D_oids\n  - E_oids = E_oids INTERSECT F_oids\n- Result CTE E: SELECT oid FROM E_oids\n- Rationale: makes the logical conjunction explicit using INTERSECT; keeps plan tidy and index-friendly.\n\n6) Prepare per-object, per-fid fast-riser details for eligible objects\n- Subquery/CTE EF: INNER JOIN E with FR_all_fast_risers on oid to keep only fast-riser fid rows for eligible objects.\n- Columns to keep:\n  - EF.oid\n  - EF.magstat_fid\n  - EF.initial_rise_estimate\n  - EF.dm_first\n  - EF.dt_first\n\n7) Join to non_detection to get light-curve (only non-detections) in the fast-riser filter\n- Join EF to non_detection ND:\n  - ND.oid = EF.oid\n  - ND.fid = EF.magstat_fid\n- This restricts non-detection rows to the same fid(s) where the object qualifies as fast riser.\n- Columns from ND to include:\n  - ND.fid AS fid\n  - ND.mjd (optional but typical for light curves)\n  - ND.diffmaglim AS diffmaglim (limit in the difference image; used here as the \u201cimage difference\u201d field)\n- Note: We join on oid (hashed index) and fid to remain within the same band.\n\n8) Join back the stamp-classifier probability\n- Join E to S on oid to bring stamp_probability for each eligible object.\n- If multiple ND rows per object/fid exist (which is expected), stamp_probability will repeat per row, which is acceptable.\n\n9) Final projection (columns to return)\n- E.oid\n- S.stamp_probability AS probability\n- ND.fid AS fid\n- ND.diffmaglim AS diffmaglim  [the requested \u201cimage difference\u201d field]\n- EF.magstat_fid AS magstat_fid\n- EF.initial_rise_estimate AS initial_rise_estimate\nOptional (if you want minimal but informative LC context): ND.mjd\nNote: Do not bring detection table rows; the request is \u201cincluding only non-detections.\u201d\n\n10) Sorting and limiting\n- ORDER BY oid (as requested)\n- LIMIT 100\n\n11) Performance and correctness notes\n- The probability filter uses ranking=1 and classifier_name='stamp_classifier', class_name='SN' to ensure \u201chighest probability in the stamp classifier is SN.\u201d\n- The date constraint on object.firstmjd enforces \u201cfirst detection in the first 2 days of September.\u201d\n- The fast-riser condition is enforced per-band in magstat with (-dm_first/dt_first) >= 0.25 and dt_first > 0, inherently using the last non-detection in the same filter.\n- By joining non_detection on (oid, fid=magstat_fid), only non-detection light-curve points in the qualifying band(s) are returned.\n- Index usage:\n  - probability: ix_classification_rank1, ix_probabilities_oid\n  - object: ix_object_firstmjd\n  - magstat: ix_magstats_dmdt_first (if also filtering by dmdt_first), plus filters on dt_first and fid\n  - non_detection: ix_non_detection_oid\n- If an object qualifies in multiple filters, EF will hold multiple magstat_fid rows, producing multiple LC series (intended).\n- If desired, you can also constrain magstat.firstmjd to be within [60188.0, 60190.0) to require the per-band first detection itself to be in that window; the request only specifies object-level first detection in that window, so this is not required.\n\n12) Summary of the joins/intersections/unions used\n- UNION ALL: combine fast-riser per-fid subqueries (FR_g, FR_r, FR_i) into FR_all_fast_risers.\n- INTERSECT: enforce objects are simultaneously in S (stamp SN), D (date window), and F (fast riser).\n- INNER JOINs:\n  - E with S to attach stamp probabilities,\n  - E with FR_all_fast_risers to attach magstat fid and rise estimate,\n  - EF with non_detection on (oid, fid) to get only non-detections in the qualifying band(s).\n\nThis plan produces exactly the requested fields and constraints, ordered by oid and limited to 100 rows."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query over the ALeRCE database\n\nGoal\nRetrieve, for objects with top stamp-classifier class SN, whose first detection (object-level) occurred on Sep 1\u20132 (MJD in [60188.0, 60190.0)), and that qualify as fast risers (per-band initial rise \u2265 0.25 mag/day between the last non-detection and the first detection in the same filter), the following:\n- oid\n- stamp-classifier probability\n- non-detection light-curve entries only: fid and diffmaglim\n- magstat fid as magstat_fid\n- initial rise estimate (from magstat)\nOrder results by oid; limit 100.\n\nKey schema facts to use\n- object.firstmjd is indexed (ix_object_firstmjd).\n- probability has a partial index on ranking=1 (ix_classification_rank1) and hash index on oid (ix_probabilities_oid).\n- magstat has indexes on dmdt_first, firstmjd (ix_magstats_dmdt_first, ix_magstats_firstmjd).\n- non_detection has a hash index on oid (ix_non_detection_oid).\n- Use probability with explicit conditions overriding defaults: classifier_name='stamp_classifier' and ranking=1, class_name='SN'.\n- Fast-riser condition must be computed in-band. Use magstat fields that link first detection to last non-detection in the same fid:\n  - dm_first (mag change at first detection vs last non-detection)\n  - dt_first (time from last non-detection to first detection)\n  - dmdt_first (lower limit for rate of magnitude change)\n  The strict condition is: -dm_first / dt_first \u2265 0.25, with dt_first > 0.\n\nHigh-level structure\nUse nested CTEs/subqueries to:\n- Select stamp-classifier SN objects (top class).\n- Select objects with first detections in the date window.\n- Select fast-riser objects per fid from magstat (build per-fid sets and UNION them).\n- INTERSECT the three sets of oids to get eligible objects.\n- Join eligible objects to:\n  - stamp-classifier probabilities,\n  - per-fid magstat fast-riser rows,\n  - non_detection light-curve rows restricted to the fast-riser fid,\nand project required columns.\n- ORDER BY oid and LIMIT 100.\n\nDetailed steps\n\n1) Define constants (no code, just for clarity)\n- start_mjd = 60188.0\n- end_mjd = 60190.0\n- fast_rise_threshold = 0.25 (mag/day)\n\n2) Subquery/CTE S: stamp SN objects (top class)\n- From table: probability\n- Filters:\n  - probability.classifier_name = 'stamp_classifier'  [explicit override of default]\n  - probability.ranking = 1                           [top-probability class only]\n  - probability.class_name = 'SN'\n- Columns to select:\n  - probability.oid\n  - probability.probability AS stamp_probability\n  - probability.classifier_version (optional metadata)\n- Rationale: S is the set of objects whose highest-probability stamp class is SN; use ix_classification_rank1 and filter by classifier_name/class_name.\n\n3) Subquery/CTE D: objects with first detection in Sep 1\u20132 (object-level)\n- From table: object\n- Filters:\n  - object.firstmjd >= start_mjd\n  - object.firstmjd < end_mjd\n- Columns to select:\n  - object.oid\n  - object.firstmjd (for possible diagnostics/inspection)\n- Rationale: constrains on object-level first detection time; uses ix_object_firstmjd.\n\n4) Subqueries/CTEs for fast risers per fid in magstat (in-band condition), then UNION\n\nFor each fid in {1, 2, 3}:\n- From table: magstat\n- Filters:\n  - magstat.fid = <fid>\n  - magstat.dt_first > 0 (avoid division by zero)\n  - magstat.dm_first IS NOT NULL\n  - Computed fast-riser condition: (-magstat.dm_first / magstat.dt_first) >= fast_rise_threshold\n    Note: This enforces that the first detection is brighter than the last non-detection by at least 0.25 mag/day. Both are in the same filter by construction of magstat.\n  - Optionally keep magstat.dmdt_first to return as initial rise estimate; it is the lower-limit rate and is indexed.\n- Columns to select:\n  - magstat.oid\n  - magstat.fid AS magstat_fid\n  - magstat.dmdt_first AS initial_rise_estimate\n  - magstat.dm_first\n  - magstat.dt_first\n  - magstat.firstmjd (optional; could be used for diagnostics)\n- CTEs: FR_g for fid=1, FR_r for fid=2, FR_i for fid=3\n- UNION ALL the three CTEs into a single CTE FR_all_fast_risers with the same columns.\n- Rationale: per-fid evaluation ensures the \u201csame filter\u201d constraint; UNION consolidates eligible per-band entries; magstat indices assist performance.\n\n5) Build oid sets and INTERSECT to get the eligible object list E\n- Set S_oids: SELECT DISTINCT oid FROM S\n- Set D_oids: SELECT DISTINCT oid FROM D\n- Set F_oids: SELECT DISTINCT oid FROM FR_all_fast_risers\n- INTERSECT:\n  - E_oids = S_oids INTERSECT D_oids\n  - E_oids = E_oids INTERSECT F_oids\n- Result CTE E: SELECT oid FROM E_oids\n- Rationale: makes the logical conjunction explicit using INTERSECT; keeps plan tidy and index-friendly.\n\n6) Prepare per-object, per-fid fast-riser details for eligible objects\n- Subquery/CTE EF: INNER JOIN E with FR_all_fast_risers on oid to keep only fast-riser fid rows for eligible objects.\n- Columns to keep:\n  - EF.oid\n  - EF.magstat_fid\n  - EF.initial_rise_estimate\n  - EF.dm_first\n  - EF.dt_first\n\n7) Join to non_detection to get light-curve (only non-detections) in the fast-riser filter\n- Join EF to non_detection ND:\n  - ND.oid = EF.oid\n  - ND.fid = EF.magstat_fid\n- This restricts non-detection rows to the same fid(s) where the object qualifies as fast riser.\n- Columns from ND to include:\n  - ND.fid AS fid\n  - ND.mjd (optional but typical for light curves)\n  - ND.diffmaglim AS diffmaglim (limit in the difference image; used here as the \u201cimage difference\u201d field)\n- Note: We join on oid (hashed index) and fid to remain within the same band.\n\n8) Join back the stamp-classifier probability\n- Join E to S on oid to bring stamp_probability for each eligible object.\n- If multiple ND rows per object/fid exist (which is expected), stamp_probability will repeat per row, which is acceptable.\n\n9) Final projection (columns to return)\n- E.oid\n- S.stamp_probability AS probability\n- ND.fid AS fid\n- ND.diffmaglim AS diffmaglim  [the requested \u201cimage difference\u201d field]\n- EF.magstat_fid AS magstat_fid\n- EF.initial_rise_estimate AS initial_rise_estimate\nOptional (if you want minimal but informative LC context): ND.mjd\nNote: Do not bring detection table rows; the request is \u201cincluding only non-detections.\u201d\n\n10) Sorting and limiting\n- ORDER BY oid (as requested)\n- LIMIT 100\n\n11) Performance and correctness notes\n- The probability filter uses ranking=1 and classifier_name='stamp_classifier', class_name='SN' to ensure \u201chighest probability in the stamp classifier is SN.\u201d\n- The date constraint on object.firstmjd enforces \u201cfirst detection in the first 2 days of September.\u201d\n- The fast-riser condition is enforced per-band in magstat with (-dm_first/dt_first) >= 0.25 and dt_first > 0, inherently using the last non-detection in the same filter.\n- By joining non_detection on (oid, fid=magstat_fid), only non-detection light-curve points in the qualifying band(s) are returned.\n- Index usage:\n  - probability: ix_classification_rank1, ix_probabilities_oid\n  - object: ix_object_firstmjd\n  - magstat: ix_magstats_dmdt_first (if also filtering by dmdt_first), plus filters on dt_first and fid\n  - non_detection: ix_non_detection_oid\n- If an object qualifies in multiple filters, EF will hold multiple magstat_fid rows, producing multiple LC series (intended).\n- If desired, you can also constrain magstat.firstmjd to be within [60188.0, 60190.0) to require the per-band first detection itself to be in that window; the request only specifies object-level first detection in that window, so this is not required.\n\n12) Summary of the joins/intersections/unions used\n- UNION ALL: combine fast-riser per-fid subqueries (FR_g, FR_r, FR_i) into FR_all_fast_risers.\n- INTERSECT: enforce objects are simultaneously in S (stamp SN), D (date window), and F (fast riser).\n- INNER JOINs:\n  - E with S to attach stamp probabilities,\n  - E with FR_all_fast_risers to attach magstat fid and rise estimate,\n  - EF with non_detection on (oid, fid) to get only non-detections in the qualifying band(s).\n\nThis plan produces exactly the requested fields and constraints, ordered by oid and limited to 100 rows."
                    },
                    "in_toks": 4555,
                    "out_toks": 8761,
                    "id": "chatcmpl-Cb63gXvJ86PBWxD12x8NnFdnpv9JG",
                    "created": 1762957460,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Eligible objects: top stamp-classifier class 'SN', first detection on Sep 1\u20132, and fast risers per-band\nWITH S AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'SN'),\n     D AS\n  (SELECT o.oid,\n          o.firstmjd\n   FROM OBJECT o\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n     FR AS\n  (-- fast risers per-band (same filter)\n SELECT m.oid,\n        m.fid AS magstat_fid,\n        m.dmdt_first AS initial_rise_estimate,\n        m.dm_first,\n        m.dt_first\n   FROM magstat m\n   WHERE m.dt_first > 0\n     AND m.dm_first IS NOT NULL\n     AND (-m.dm_first / m.dt_first) >= 0.25),\n     E AS\n  (-- eligible oids present in all three sets\n SELECT oid\n   FROM S INTERSECT SELECT oid\n   FROM D INTERSECT SELECT DISTINCT oid\n   FROM FR),\n     EF AS\n  (-- keep only fast-riser bands for eligible objects\n SELECT fr.oid,\n        fr.magstat_fid,\n        fr.initial_rise_estimate\n   FROM FR fr\n   INNER JOIN E USING (oid))\nSELECT e.oid,\n       s.probability,\n       nd.fid,\n       nd.diffmaglim,\n       ef.magstat_fid,\n       ef.initial_rise_estimate\nFROM E e\nINNER JOIN S s USING (oid)\nINNER JOIN EF ef USING (oid)\nINNER JOIN non_detection nd ON nd.oid = ef.oid\nAND nd.fid = ef.magstat_fid\nORDER BY e.oid\nLIMIT 100;"
                        },
                        "in_toks": 5312,
                        "out_toks": 2806,
                        "id": "chatcmpl-Cb67W40C87qYbDhWBRRTffuHeMFea",
                        "created": 1762957698,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "6": {
            "req_id": "16",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "non_detection",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'non_detection', 'magstat']"
                },
                "in_toks": 692,
                "out_toks": 2267,
                "id": "chatcmpl-CZMG0vHZ45FXBbkXsQi543NY5a0Pl",
                "created": 1762543072,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Stamp-classifier SN rank-1 objects, first detection on 2023-09-01 to 2023-09-02 (MJD ~ 60188\u201360190),\n-- and fast risers; return only non-detections before first detection, with requested fields.\nWITH sp AS\n  (-- Aggregate stamp-classifier SN probabilities across versions; keep only rank-1 (top class)\n SELECT p.oid,\n        MAX(p.probability) AS stamp_probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1\n   GROUP BY p.oid),\n     fe AS\n  (-- Per-filter entries whose per-filter firstmjd equals object's overall firstmjd in the target date window,\n -- and that qualify as fast risers by either dmdt_first or dm_first/dt_first >= 0.25\n SELECT m.oid,\n        m.fid AS magstat_fid,\n        m.firstmjd,\n        CASE\n            WHEN m.dmdt_first IS NOT NULL\n                 AND m.dmdt_first >= 0.25 THEN m.dmdt_first\n            WHEN m.dt_first IS NOT NULL\n                 AND m.dt_first > 0\n                 AND m.dm_first IS NOT NULL\n                 AND (m.dm_first / m.dt_first) >= 0.25 THEN (m.dm_first / m.dt_first)\n            ELSE NULL\n        END AS initial_rise_estimate\n   FROM magstat m\n   JOIN OBJECT o ON o.oid = m.oid\n   AND o.firstmjd = m.firstmjd\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0)\nSELECT fe.oid AS oid,\n       sp.stamp_probability AS probability,\n       nd.fid AS fid,\n       nd.diffmaglim AS diffmaglim, -- difference-image 5-sigma limiting magnitude\n fe.magstat_fid AS magstat_fid,\n fe.initial_rise_estimate AS initial_rise_estimate\nFROM fe\nJOIN sp ON sp.oid = fe.oid\nJOIN non_detection nd ON nd.oid = fe.oid\nAND nd.fid = fe.magstat_fid\nAND nd.mjd < fe.firstmjd\nWHERE fe.initial_rise_estimate IS NOT NULL\nORDER BY fe.oid\nLIMIT 100;",
            "sql_response": {
                "responses": {
                    "0": "-- Stamp-classifier SN rank-1 objects, first detection on 2023-09-01 to 2023-09-02 (MJD ~ 60188\u201360190),\n-- and fast risers; return only non-detections before first detection, with requested fields.\nWITH sp AS\n  (-- Aggregate stamp-classifier SN probabilities across versions; keep only rank-1 (top class)\n SELECT p.oid,\n        MAX(p.probability) AS stamp_probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1\n   GROUP BY p.oid),\n     fe AS\n  (-- Per-filter entries whose per-filter firstmjd equals object's overall firstmjd in the target date window,\n -- and that qualify as fast risers by either dmdt_first or dm_first/dt_first >= 0.25\n SELECT m.oid,\n        m.fid AS magstat_fid,\n        m.firstmjd,\n        CASE\n            WHEN m.dmdt_first IS NOT NULL\n                 AND m.dmdt_first >= 0.25 THEN m.dmdt_first\n            WHEN m.dt_first IS NOT NULL\n                 AND m.dt_first > 0\n                 AND m.dm_first IS NOT NULL\n                 AND (m.dm_first / m.dt_first) >= 0.25 THEN (m.dm_first / m.dt_first)\n            ELSE NULL\n        END AS initial_rise_estimate\n   FROM magstat m\n   JOIN OBJECT o ON o.oid = m.oid\n   AND o.firstmjd = m.firstmjd\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0)\nSELECT fe.oid AS oid,\n       sp.stamp_probability AS probability,\n       nd.fid AS fid,\n       nd.diffmaglim AS diffmaglim, -- difference-image 5-sigma limiting magnitude\n fe.magstat_fid AS magstat_fid,\n fe.initial_rise_estimate AS initial_rise_estimate\nFROM fe\nJOIN sp ON sp.oid = fe.oid\nJOIN non_detection nd ON nd.oid = fe.oid\nAND nd.fid = fe.magstat_fid\nAND nd.mjd < fe.firstmjd\nWHERE fe.initial_rise_estimate IS NOT NULL\nORDER BY fe.oid\nLIMIT 100;"
                },
                "in_toks": 3272,
                "out_toks": 2513,
                "id": "chatcmpl-CbGu9An0s4BYO2uHufUbWZS8lgSEw",
                "created": 1762999153,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2049,
                "out_toks": 655,
                "id": "chatcmpl-CZYEvgyd01aLdEL9H6zL6nXYpEOxw",
                "created": 1762589133,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "/* Stamp-classifier SN rank-1 probabilities per object (aggregate across versions) */ WITH sp AS\n  (SELECT p.oid,\n          MAX(p.probability) AS stamp_probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1\n   GROUP BY p.oid), /* Fast-riser candidates from magstat using dmdt_first */ fr_dmdt AS\n  (SELECT m.oid,\n          m.fid,\n          m.firstmjd,\n          m.dmdt_first AS initial_rise_estimate\n   FROM magstat m\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0\n     AND m.dmdt_first IS NOT NULL\n     AND m.dmdt_first >= 0.25), /* Fast-riser candidates from magstat using dm_first/dt_first */ fr_dm_over_dt AS\n  (SELECT m.oid,\n          m.fid,\n          m.firstmjd,\n          (m.dm_first / m.dt_first) AS initial_rise_estimate\n   FROM magstat m\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0\n     AND m.dt_first IS NOT NULL\n     AND m.dt_first > 0\n     AND m.dm_first IS NOT NULL\n     AND (m.dm_first / m.dt_first) >= 0.25), /* Union both fast-riser definitions */ fr_candidates AS\n  (SELECT *\n   FROM fr_dmdt\n   UNION SELECT *\n   FROM fr_dm_over_dt), /* Keep only the per-filter first detection that equals the object's overall first detection */ fe AS\n  (SELECT fc.oid,\n          fc.fid AS magstat_fid,\n          fc.firstmjd,\n          fc.initial_rise_estimate\n   FROM fr_candidates fc\n   INNER JOIN OBJECT o ON o.oid = fc.oid\n   AND o.firstmjd = fc.firstmjd), /* Candidate oids satisfying: SN rank-1 in stamp classifier AND fast-riser at first detection */ cs AS (\n                                                                                                                                            (SELECT oid\n                                                                                                                                             FROM sp) INTERSECT\n                                                                                                                                            (SELECT oid\n                                                                                                                                             FROM fe)), /* Non-detections before the first detection in the same filter */ nd_pre AS\n  (SELECT nd.oid,\n          nd.fid,\n          nd.mjd,\n          nd.diffmaglim,\n          fe.magstat_fid,\n          fe.initial_rise_estimate\n   FROM cs\n   INNER JOIN fe ON fe.oid = cs.oid\n   INNER JOIN non_detection nd ON nd.oid = cs.oid\n   AND nd.fid = fe.magstat_fid\n   AND nd.mjd < fe.firstmjd)\nSELECT cs.oid AS oid,\n       sp.stamp_probability AS probability,\n       nd_pre.fid AS fid,\n       nd_pre.diffmaglim AS diffmaglim,\n       nd_pre.magstat_fid AS magstat_fid,\n       nd_pre.initial_rise_estimate AS initial_rise_estimate\nFROM cs\nINNER JOIN sp ON sp.oid = cs.oid\nINNER JOIN nd_pre ON nd_pre.oid = cs.oid\nORDER BY oid\nLIMIT 100;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal: Return up to 100 rows containing, for each qualifying object: oid, its highest (rank-1) SN probability from the stamp classifier, the non-detection light-curve points (only non-detection epochs), the non-detection filter ID and diff image limit, plus the magstat filter ID (as magstat_fid) and the initial rise estimate, for objects:\n- whose highest-probability class in the stamp classifier (ranking=1) is 'SN',\n- whose first detection occurred on September 1\u20132 (MJD in [60188.0, 60190.0)),\n- that qualify as fast risers (rise rate \u2265 0.25 mag/day in the same filter used for first detection and last non-detection).\n\nUse JOINs, nested subqueries, UNIONs, and INTERSECTs per below. Do not return any detections; only non_detection records should appear.\n\nConstants\n- Define time window for the first detection:\n  - mjd_start = 60188.0\n  - mjd_end = 60190.0\n\nStep 1 \u2014 Stamp-classifier SN objects (probabilities)\n- Build a subquery sp (stamp SN probabilities) from table probability with:\n  - probability.classifier_name = 'stamp_classifier'  (explicit override of default)\n  - probability.class_name = 'SN'\n  - probability.ranking = 1  (keep default ranking=1)\n- To avoid duplicates across classifier_version, produce one probability per oid by aggregating:\n  - SELECT oid, MAX(probability) AS stamp_probability\n  - GROUP BY oid\n- Output columns:\n  - sp.oid\n  - sp.stamp_probability\n\nStep 2 \u2014 Fast-riser per-filter candidates using magstat (two equivalent rise-rate definitions)\n- Build two subqueries on magstat, both constrained to the MJD window [mjd_start, mjd_end) and same column set, then UNION them to cover cases where one set of columns may be null:\n  - Columns returned in both: oid, fid, firstmjd, initial_rise_estimate\n  - Subquery fr_dmdt (rise from magstat.dmdt_first):\n    - FROM magstat m\n    - WHERE m.firstmjd >= mjd_start AND m.firstmjd < mjd_end\n    - AND m.dmdt_first IS NOT NULL\n    - AND m.dmdt_first >= 0.25\n    - SELECT m.oid, m.fid, m.firstmjd, m.dmdt_first AS initial_rise_estimate\n  - Subquery fr_dm_over_dt (rise from magstat.dm_first / magstat.dt_first):\n    - FROM magstat m\n    - WHERE m.firstmjd >= mjd_start AND m.firstmjd < mjd_end\n    - AND m.dt_first IS NOT NULL AND m.dt_first > 0\n    - AND m.dm_first IS NOT NULL\n    - AND (m.dm_first / m.dt_first) >= 0.25\n    - SELECT m.oid, m.fid, m.firstmjd, (m.dm_first / m.dt_first) AS initial_rise_estimate\n  - fr_candidates = fr_dmdt UNION (not ALL) fr_dm_over_dt\n- This step enforces the fast-riser definition in the same filter as the first detection (magstat row encodes per-filter first detection).\n\nStep 3 \u2014 Earliest qualifying first detection per object (per-filter)\n- Derive the earliest qualifying per-object, per-filter row from fr_candidates:\n  - Use DISTINCT ON (oid) \u2026 ORDER BY oid, firstmjd ASC\n  - Keep the earliest firstmjd row per oid (and its corresponding fid and initial_rise_estimate)\n- Name this subquery fe (fast-riser earliest)\n- Output columns:\n  - fe.oid\n  - fe.fid AS magstat_fid\n  - fe.firstmjd\n  - fe.initial_rise_estimate\n\nStep 4 \u2014 Object-level first detection in time window (sanity gate)\n- Build a subquery ow (object window) to ensure the object\u2019s overall first detection is in the requested dates (optional but strengthens the constraint and enables INTERSECT):\n  - FROM object o\n  - WHERE o.firstmjd >= mjd_start AND o.firstmjd < mjd_end\n  - SELECT o.oid\n\nStep 5 \u2014 Final candidate set of oids (INTERSECT of conditions)\n- Produce the definitive set of oids that satisfy all constraints:\n  - cs = (SELECT oid FROM sp)          -- SN rank-1 in stamp classifier\n    INTERSECT\n    (SELECT oid FROM fe)               -- fast-riser per-filter earliest first detection in window\n    INTERSECT\n    (SELECT oid FROM ow)               -- object-level first detection in the window\n- Name this result set cs (candidate_oids)\n\nStep 6 \u2014 Non-detection light-curve points before first detection (same filter)\n- Build a subquery nd_pre for the non-detections relevant to the first detection filter:\n  - JOIN cs to fe to get per-oid magstat_fid and firstmjd:\n    - FROM cs\n    - INNER JOIN fe ON fe.oid = cs.oid\n  - INNER JOIN non_detection nd ON:\n    - nd.oid = cs.oid\n    - nd.fid = fe.magstat_fid  (same filter as the first detection used to assess the rise)\n    - nd.mjd < fe.firstmjd     (only non-detections before the first detection)\n  - SELECT:\n    - nd.oid\n    - nd.fid AS fid            (requested \u201cfilter ID\u201d from non_detection)\n    - nd.mjd\n    - nd.diffmaglim AS image_difference_limit\n\nStep 7 \u2014 Assemble final output with all requested columns\n- Base FROM cs\n- INNER JOIN sp ON sp.oid = cs.oid\n- INNER JOIN fe ON fe.oid = cs.oid\n- INNER JOIN nd_pre np ON np.oid = cs.oid  (can be implemented by embedding nd_pre as a subquery)\n- SELECT and alias exactly the requested fields:\n  - cs.oid AS oid\n  - sp.stamp_probability AS probability\n  - np.fid AS fid\n  - np.image_difference_limit AS diffmaglim  (the \u201cimage difference\u201d requested; this is the 5-sigma diff image limit)\n  - fe.magstat_fid AS magstat_fid\n  - fe.initial_rise_estimate AS initial_rise_estimate\n  - Optionally include np.mjd if you want the time of each non-detection point (not explicitly required but typically useful for \u201clight curves\u201d)\n- Note: If multiple classifier_version rows existed per oid in probability (even after MAX aggregation), or many non-detections exist per object, the result will have multiple rows per oid (one per non-detection). This matches the requirement \u201clight curves (including only non-detections).\u201d\n\nStep 8 \u2014 Ordering and limiting\n- ORDER BY oid\n- LIMIT 100\n\nPerformance and index usage notes\n- probability: filter by ranking=1 and classifier_name='stamp_classifier' and class_name='SN'; use ix_classification_rank1 and ix_probabilities_oid.\n- magstat: filter by firstmjd (ix_magstats_firstmjd) and by dmdt_first (ix_magstats_dmdt_first); DISTINCT ON uses ORDER BY (oid, firstmjd) which benefits from ix_magstats_firstmjd combined with hashing on oid via ix_magstats_oid for joins.\n- object: filter by firstmjd (ix_object_firstmjd).\n- non_detection: join by oid (ix_non_detection_oid) and filter by fid; consider also filtering by nd.mjd < fe.firstmjd at join time.\n\nSummary of the nested subqueries and set operations\n- sp: aggregated stamp-classifier SN probabilities (ranking=1), per oid.\n- fr_dmdt and fr_dm_over_dt: two alternative fast-riser definitions UNIONed into fr_candidates.\n- fe: earliest qualifying per-oid first detection (per magstat filter) from fr_candidates via DISTINCT ON.\n- ow: object-level first detection within the date window.\n- cs: INTERSECT of oids from sp, fe, and ow.\n- nd_pre: non-detection records per candidate oid, same filter as fe.magstat_fid, restricted to before fe.firstmjd.\n- Final SELECT: JOIN cs with sp, fe, and nd_pre; select requested columns; ORDER BY oid; LIMIT 100."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\nGoal: Return up to 100 rows containing, for each qualifying object: oid, its highest (rank-1) SN probability from the stamp classifier, the non-detection light-curve points (only non-detection epochs), the non-detection filter ID and diff image limit, plus the magstat filter ID (as magstat_fid) and the initial rise estimate, for objects:\n- whose highest-probability class in the stamp classifier (ranking=1) is 'SN',\n- whose first detection occurred on September 1\u20132 (MJD in [60188.0, 60190.0)),\n- that qualify as fast risers (rise rate \u2265 0.25 mag/day in the same filter used for first detection and last non-detection).\n\nUse JOINs, nested subqueries, UNIONs, and INTERSECTs per below. Do not return any detections; only non_detection records should appear.\n\nConstants\n- Define time window for the first detection:\n  - mjd_start = 60188.0\n  - mjd_end = 60190.0\n\nStep 1 \u2014 Stamp-classifier SN objects (probabilities)\n- Build a subquery sp (stamp SN probabilities) from table probability with:\n  - probability.classifier_name = 'stamp_classifier'  (explicit override of default)\n  - probability.class_name = 'SN'\n  - probability.ranking = 1  (keep default ranking=1)\n- To avoid duplicates across classifier_version, produce one probability per oid by aggregating:\n  - SELECT oid, MAX(probability) AS stamp_probability\n  - GROUP BY oid\n- Output columns:\n  - sp.oid\n  - sp.stamp_probability\n\nStep 2 \u2014 Fast-riser per-filter candidates using magstat (two equivalent rise-rate definitions)\n- Build two subqueries on magstat, both constrained to the MJD window [mjd_start, mjd_end) and same column set, then UNION them to cover cases where one set of columns may be null:\n  - Columns returned in both: oid, fid, firstmjd, initial_rise_estimate\n  - Subquery fr_dmdt (rise from magstat.dmdt_first):\n    - FROM magstat m\n    - WHERE m.firstmjd >= mjd_start AND m.firstmjd < mjd_end\n    - AND m.dmdt_first IS NOT NULL\n    - AND m.dmdt_first >= 0.25\n    - SELECT m.oid, m.fid, m.firstmjd, m.dmdt_first AS initial_rise_estimate\n  - Subquery fr_dm_over_dt (rise from magstat.dm_first / magstat.dt_first):\n    - FROM magstat m\n    - WHERE m.firstmjd >= mjd_start AND m.firstmjd < mjd_end\n    - AND m.dt_first IS NOT NULL AND m.dt_first > 0\n    - AND m.dm_first IS NOT NULL\n    - AND (m.dm_first / m.dt_first) >= 0.25\n    - SELECT m.oid, m.fid, m.firstmjd, (m.dm_first / m.dt_first) AS initial_rise_estimate\n  - fr_candidates = fr_dmdt UNION (not ALL) fr_dm_over_dt\n- This step enforces the fast-riser definition in the same filter as the first detection (magstat row encodes per-filter first detection).\n\nStep 3 \u2014 Earliest qualifying first detection per object (per-filter)\n- Derive the earliest qualifying per-object, per-filter row from fr_candidates:\n  - Use DISTINCT ON (oid) \u2026 ORDER BY oid, firstmjd ASC\n  - Keep the earliest firstmjd row per oid (and its corresponding fid and initial_rise_estimate)\n- Name this subquery fe (fast-riser earliest)\n- Output columns:\n  - fe.oid\n  - fe.fid AS magstat_fid\n  - fe.firstmjd\n  - fe.initial_rise_estimate\n\nStep 4 \u2014 Object-level first detection in time window (sanity gate)\n- Build a subquery ow (object window) to ensure the object\u2019s overall first detection is in the requested dates (optional but strengthens the constraint and enables INTERSECT):\n  - FROM object o\n  - WHERE o.firstmjd >= mjd_start AND o.firstmjd < mjd_end\n  - SELECT o.oid\n\nStep 5 \u2014 Final candidate set of oids (INTERSECT of conditions)\n- Produce the definitive set of oids that satisfy all constraints:\n  - cs = (SELECT oid FROM sp)          -- SN rank-1 in stamp classifier\n    INTERSECT\n    (SELECT oid FROM fe)               -- fast-riser per-filter earliest first detection in window\n    INTERSECT\n    (SELECT oid FROM ow)               -- object-level first detection in the window\n- Name this result set cs (candidate_oids)\n\nStep 6 \u2014 Non-detection light-curve points before first detection (same filter)\n- Build a subquery nd_pre for the non-detections relevant to the first detection filter:\n  - JOIN cs to fe to get per-oid magstat_fid and firstmjd:\n    - FROM cs\n    - INNER JOIN fe ON fe.oid = cs.oid\n  - INNER JOIN non_detection nd ON:\n    - nd.oid = cs.oid\n    - nd.fid = fe.magstat_fid  (same filter as the first detection used to assess the rise)\n    - nd.mjd < fe.firstmjd     (only non-detections before the first detection)\n  - SELECT:\n    - nd.oid\n    - nd.fid AS fid            (requested \u201cfilter ID\u201d from non_detection)\n    - nd.mjd\n    - nd.diffmaglim AS image_difference_limit\n\nStep 7 \u2014 Assemble final output with all requested columns\n- Base FROM cs\n- INNER JOIN sp ON sp.oid = cs.oid\n- INNER JOIN fe ON fe.oid = cs.oid\n- INNER JOIN nd_pre np ON np.oid = cs.oid  (can be implemented by embedding nd_pre as a subquery)\n- SELECT and alias exactly the requested fields:\n  - cs.oid AS oid\n  - sp.stamp_probability AS probability\n  - np.fid AS fid\n  - np.image_difference_limit AS diffmaglim  (the \u201cimage difference\u201d requested; this is the 5-sigma diff image limit)\n  - fe.magstat_fid AS magstat_fid\n  - fe.initial_rise_estimate AS initial_rise_estimate\n  - Optionally include np.mjd if you want the time of each non-detection point (not explicitly required but typically useful for \u201clight curves\u201d)\n- Note: If multiple classifier_version rows existed per oid in probability (even after MAX aggregation), or many non-detections exist per object, the result will have multiple rows per oid (one per non-detection). This matches the requirement \u201clight curves (including only non-detections).\u201d\n\nStep 8 \u2014 Ordering and limiting\n- ORDER BY oid\n- LIMIT 100\n\nPerformance and index usage notes\n- probability: filter by ranking=1 and classifier_name='stamp_classifier' and class_name='SN'; use ix_classification_rank1 and ix_probabilities_oid.\n- magstat: filter by firstmjd (ix_magstats_firstmjd) and by dmdt_first (ix_magstats_dmdt_first); DISTINCT ON uses ORDER BY (oid, firstmjd) which benefits from ix_magstats_firstmjd combined with hashing on oid via ix_magstats_oid for joins.\n- object: filter by firstmjd (ix_object_firstmjd).\n- non_detection: join by oid (ix_non_detection_oid) and filter by fid; consider also filtering by nd.mjd < fe.firstmjd at join time.\n\nSummary of the nested subqueries and set operations\n- sp: aggregated stamp-classifier SN probabilities (ranking=1), per oid.\n- fr_dmdt and fr_dm_over_dt: two alternative fast-riser definitions UNIONed into fr_candidates.\n- fe: earliest qualifying per-oid first detection (per magstat filter) from fr_candidates via DISTINCT ON.\n- ow: object-level first detection within the date window.\n- cs: INTERSECT of oids from sp, fe, and ow.\n- nd_pre: non-detection records per candidate oid, same filter as fe.magstat_fid, restricted to before fe.firstmjd.\n- Final SELECT: JOIN cs with sp, fe, and nd_pre; select requested columns; ORDER BY oid; LIMIT 100."
                    },
                    "in_toks": 4007,
                    "out_toks": 7769,
                    "id": "chatcmpl-Cb69SzqW7nszmYbWZ0Gff4578KmpL",
                    "created": 1762957818,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "/* Stamp-classifier SN rank-1 probabilities per object (aggregate across versions) */ WITH sp AS\n  (SELECT p.oid,\n          MAX(p.probability) AS stamp_probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1\n   GROUP BY p.oid), /* Fast-riser candidates from magstat using dmdt_first */ fr_dmdt AS\n  (SELECT m.oid,\n          m.fid,\n          m.firstmjd,\n          m.dmdt_first AS initial_rise_estimate\n   FROM magstat m\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0\n     AND m.dmdt_first IS NOT NULL\n     AND m.dmdt_first >= 0.25), /* Fast-riser candidates from magstat using dm_first/dt_first */ fr_dm_over_dt AS\n  (SELECT m.oid,\n          m.fid,\n          m.firstmjd,\n          (m.dm_first / m.dt_first) AS initial_rise_estimate\n   FROM magstat m\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0\n     AND m.dt_first IS NOT NULL\n     AND m.dt_first > 0\n     AND m.dm_first IS NOT NULL\n     AND (m.dm_first / m.dt_first) >= 0.25), /* Union both fast-riser definitions */ fr_candidates AS\n  (SELECT *\n   FROM fr_dmdt\n   UNION SELECT *\n   FROM fr_dm_over_dt), /* Keep only the per-filter first detection that equals the object's overall first detection */ fe AS\n  (SELECT fc.oid,\n          fc.fid AS magstat_fid,\n          fc.firstmjd,\n          fc.initial_rise_estimate\n   FROM fr_candidates fc\n   INNER JOIN OBJECT o ON o.oid = fc.oid\n   AND o.firstmjd = fc.firstmjd), /* Candidate oids satisfying: SN rank-1 in stamp classifier AND fast-riser at first detection */ cs AS (\n                                                                                                                                            (SELECT oid\n                                                                                                                                             FROM sp) INTERSECT\n                                                                                                                                            (SELECT oid\n                                                                                                                                             FROM fe)), /* Non-detections before the first detection in the same filter */ nd_pre AS\n  (SELECT nd.oid,\n          nd.fid,\n          nd.mjd,\n          nd.diffmaglim,\n          fe.magstat_fid,\n          fe.initial_rise_estimate\n   FROM cs\n   INNER JOIN fe ON fe.oid = cs.oid\n   INNER JOIN non_detection nd ON nd.oid = cs.oid\n   AND nd.fid = fe.magstat_fid\n   AND nd.mjd < fe.firstmjd)\nSELECT cs.oid AS oid,\n       sp.stamp_probability AS probability,\n       nd_pre.fid AS fid,\n       nd_pre.diffmaglim AS diffmaglim,\n       nd_pre.magstat_fid AS magstat_fid,\n       nd_pre.initial_rise_estimate AS initial_rise_estimate\nFROM cs\nINNER JOIN sp ON sp.oid = cs.oid\nINNER JOIN nd_pre ON nd_pre.oid = cs.oid\nORDER BY oid\nLIMIT 100;"
                        },
                        "in_toks": 4475,
                        "out_toks": 5914,
                        "id": "chatcmpl-Cb6CdKWZ58NN0fYnhUpnHV7JUgREZ",
                        "created": 1762958015,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "7": {
            "req_id": "16",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection",
                "non_detection",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'detection', 'non_detection', 'magstat']"
                },
                "in_toks": 692,
                "out_toks": 2527,
                "id": "chatcmpl-CZMH17wfQOYG7oWkKLdnaTcafOEZA",
                "created": 1762543135,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Fast, band-aware query:\n-- 1) pick per-oid highest-probability 'SN' from the stamp classifier (ranking=1),\n-- 2) select fast-riser magstat entries in the first two days of September (MJD [60188, 60190)),\n-- 3) limit early to 100 candidate (oid, band) pairs to avoid expanding over all non-detections,\n-- 4) return only non-detections (light curves), with requested columns.\n WITH p_sn AS\n  (SELECT oid,\n          probability\n   FROM\n     (SELECT p.oid,\n             p.probability,\n             ROW_NUMBER() OVER (PARTITION BY p.oid\n                                ORDER BY p.probability DESC, p.classifier_version DESC) AS rn\n      FROM probability p\n      WHERE p.classifier_name = 'stamp_classifier' -- classifier filter\n\n        AND p.class_name = 'SN' -- class filter\n\n        AND p.ranking = 1 -- highest-probability class for that classifier\n) t\n   WHERE rn = 1),\n      ms_fast AS\n  (SELECT oid,\n          fid AS magstat_fid,\n          dmdt_first\n   FROM magstat\n   WHERE firstmjd >= 60188.0\n     AND firstmjd < 60190.0\n     AND dmdt_first <= -0.25 -- fast-riser criterion\n),\n      candidates AS\n  (SELECT m.oid,\n          p.probability,\n          m.magstat_fid,\n          m.dmdt_first\n   FROM ms_fast m\n   JOIN p_sn p USING (oid)\n   ORDER BY m.oid\n   LIMIT 100 -- limit early to reduce join size\n)\nSELECT c.oid,\n       c.probability,\n       nd.fid, -- non-detection filter ID\n nd.diffmaglim, -- non-detection limiting diff magnitude (image difference)\n c.magstat_fid,\n c.dmdt_first, -- initial rise estimate\n nd.mjd\nFROM candidates c\nJOIN non_detection nd ON nd.oid = c.oid\nAND nd.fid = c.magstat_fid\nORDER BY c.oid,\n         nd.mjd\nLIMIT 100; -- final cap on returned rows",
            "sql_response": {
                "responses": {
                    "0": "-- Fast, band-aware query:\n-- 1) pick per-oid highest-probability 'SN' from the stamp classifier (ranking=1),\n-- 2) select fast-riser magstat entries in the first two days of September (MJD [60188, 60190)),\n-- 3) limit early to 100 candidate (oid, band) pairs to avoid expanding over all non-detections,\n-- 4) return only non-detections (light curves), with requested columns.\n WITH p_sn AS\n  (SELECT oid,\n          probability\n   FROM\n     (SELECT p.oid,\n             p.probability,\n             ROW_NUMBER() OVER (PARTITION BY p.oid\n                                ORDER BY p.probability DESC, p.classifier_version DESC) AS rn\n      FROM probability p\n      WHERE p.classifier_name = 'stamp_classifier' -- classifier filter\n\n        AND p.class_name = 'SN' -- class filter\n\n        AND p.ranking = 1 -- highest-probability class for that classifier\n) t\n   WHERE rn = 1),\n      ms_fast AS\n  (SELECT oid,\n          fid AS magstat_fid,\n          dmdt_first\n   FROM magstat\n   WHERE firstmjd >= 60188.0\n     AND firstmjd < 60190.0\n     AND dmdt_first <= -0.25 -- fast-riser criterion\n),\n      candidates AS\n  (SELECT m.oid,\n          p.probability,\n          m.magstat_fid,\n          m.dmdt_first\n   FROM ms_fast m\n   JOIN p_sn p USING (oid)\n   ORDER BY m.oid\n   LIMIT 100 -- limit early to reduce join size\n)\nSELECT c.oid,\n       c.probability,\n       nd.fid, -- non-detection filter ID\n nd.diffmaglim, -- non-detection limiting diff magnitude (image difference)\n c.magstat_fid,\n c.dmdt_first, -- initial rise estimate\n nd.mjd\nFROM candidates c\nJOIN non_detection nd ON nd.oid = c.oid\nAND nd.fid = c.magstat_fid\nORDER BY c.oid,\n         nd.mjd\nLIMIT 100; -- final cap on returned rows"
                },
                "in_toks": 3075,
                "out_toks": 4213,
                "id": "chatcmpl-CbGv7XwwWx0eNQPpKrfpbpkrox32X",
                "created": 1762999213,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2597,
                "out_toks": 911,
                "id": "chatcmpl-CZYFAczYw64jxCIGWDt9RKTUgHbhA",
                "created": 1762589148,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Objects whose highest-probability stamp classification is 'SN',\n-- with first detection between 60188.0 and 60190.0 MJD and fast-riser criterion (dmdt_first <= -0.25),\n-- returning non-detection light curves in the same band, and requested columns.\nWITH p_sn AS\n  (SELECT DISTINCT ON (oid) oid,\n                      probability,\n                      classifier_version\n   FROM probability\n   WHERE classifier_name = 'stamp_classifier'\n     AND ranking = 1\n     AND class_name = 'SN'\n   ORDER BY oid,\n            probability DESC,\n            classifier_version DESC),\n     ms_fast AS\n  (SELECT oid,\n          fid AS magstat_fid,\n          dmdt_first,\n          firstmjd\n   FROM magstat\n   WHERE firstmjd >= 60188.0\n     AND firstmjd < 60190.0\n     AND dmdt_first <= -0.25),\n     candidate_oids AS\n  (SELECT oid\n   FROM p_sn INTERSECT SELECT oid\n   FROM ms_fast)\nSELECT co.oid,\n       psn.probability,\n       nd.fid,\n       nd.diffmaglim,\n       msf.magstat_fid,\n       msf.dmdt_first,\n       nd.mjd\nFROM candidate_oids co\nINNER JOIN p_sn psn USING (oid)\nINNER JOIN ms_fast msf USING (oid)\nINNER JOIN non_detection nd ON nd.oid = co.oid\nAND nd.fid = msf.magstat_fid\nORDER BY co.oid\nLIMIT 100;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Define constants for the time window\n- Start of window: 60188.0 (MJD for 2025-09-01)\n- End of window: 60190.0 (exclusive; covers 2025-09-01 and 2025-09-02)\n\n2) Build a subquery of objects whose highest-probability class in the stamp classifier is SN\n- Source table: probability\n- Filters:\n  - probability.classifier_name = 'stamp_classifier'  [user explicitly requires stamp classifier; overrides default lc_classifier]\n  - probability.ranking = 1  [highest-probability class per classifier version]\n  - probability.class_name = 'SN'\n- Output columns:\n  - oid\n  - probability (as stamp_probability)\n  - classifier_version (optional, in case you want to de-duplicate by version)\n- Note on duplicates across classifier_version:\n  - If multiple classifier_version rows occur per oid (each with ranking = 1 and class_name = 'SN'), either keep all or deduplicate to one row per oid. If deduplicating, select the row with the highest probability per oid (e.g., using a per-oid ordering by probability DESC and classifier_version DESC).\n\n3) Build a subquery of per-band \u201cfast risers\u201d with first detection in the first two days of September\n- Source table: magstat\n- Filters:\n  - magstat.firstmjd >= 60188.0 AND magstat.firstmjd < 60190.0  [first detection in band is within the 2-day window]\n  - magstat.dmdt_first <= -0.25  [fast riser: at least 0.25 mag/day brighter; negative sign indicates getting brighter in magnitudes]\n- Output columns:\n  - oid\n  - fid AS magstat_fid\n  - dmdt_first AS initial_rise_estimate\n  - firstmjd (optional, if you want it available downstream)\n- Rationale:\n  - Fast riser is defined per filter; dmdt_first is the rate estimate at first detection in that filter, computed relative to the last non-detection in the same filter.\n\n4) Intersect the two object sets to enforce both conditions at the object level\n- Subquery A (from step 2): select distinct oid from probability where classifier_name='stamp_classifier' AND ranking=1 AND class_name='SN'\n- Subquery B (from step 3): select distinct oid from magstat where firstmjd in [60188.0, 60190.0) AND dmdt_first <= -0.25\n- Intersect:\n  - candidate_oids = (A) INTERSECT (B)\n- Output:\n  - oid\n\n5) Reattach per-band fast-riser details and stamp-classifier probability to the intersected oids\n- Join candidate_oids to the fast-riser magstat subquery (step 3) on oid to recover:\n  - magstat_fid\n  - initial_rise_estimate\n- Join candidate_oids to the stamp-classifier subquery (step 2) on oid to recover:\n  - stamp_probability\n  - (optionally) classifier_version if needed\n- This yields, per object and per fast-riser band, the stamp SN probability and the rise estimate.\n\n6) Restrict light curves to non-detections only and in the same band as the fast-riser detection\n- Source table: non_detection\n- Join conditions:\n  - non_detection.oid = candidate_oids.oid\n  - non_detection.fid = magstat.magstat_fid  [enforces \u201csame filter\u201d as used for fast-riser criterion]\n- No time filtering for the LC is strictly required by the user; include all non-detection epochs. If you wish to only show the pre-detection LC, you may add non_detection.mjd < magstat.firstmjd, but this was not requested.\n\n7) Final projection (columns to return)\n- object identifier: oid (from probability or magstat join)\n- probability in the stamp classifier: probability.probability AS probability\n- non-detection light curve data (only):\n  - non_detection.fid AS fid  [filter ID of each non-detection epoch]\n  - non_detection.diffmaglim AS diffmaglim  [5-sigma limiting magnitude in the difference image; serves as the \u201cimage difference\u201d limit]\n- per-band magstat info used for fast-riser selection:\n  - magstat.fid AS magstat_fid\n  - magstat.dmdt_first AS initial_rise_estimate\n- Optional but often useful:\n  - non_detection.mjd (timestamp of each non-detection point) if you want explicit LC timing\n\n8) Result set shaping\n- Ordering: ORDER BY oid ASC\n- Limiting: LIMIT 100\n\n9) Query structure (nested subqueries, joins, and set operations)\n- Subquery P_SN: probability filtered to stamp_classifier, class_name='SN', ranking=1; select (oid, probability [, classifier_version])\n- Subquery MS_FAST: magstat filtered to fast-riser criterion and date window; select (oid, fid AS magstat_fid, dmdt_first AS initial_rise_estimate [, firstmjd])\n- Subquery OIDS_SN: select distinct oid from P_SN\n- Subquery OIDS_FAST: select distinct oid from MS_FAST\n- Subquery CANDIDATE_OIDS: OIDS_SN INTERSECT OIDS_FAST\n- Final assembly:\n  - CANDIDATE_OIDS\n    INNER JOIN P_SN USING (oid)\n    INNER JOIN MS_FAST USING (oid)\n    INNER JOIN non_detection ND\n      ON ND.oid = CANDIDATE_OIDS.oid\n     AND ND.fid = MS_FAST.magstat_fid\n- Final SELECT the columns listed in step 7\n- ORDER BY oid; LIMIT 100\n\n10) Index and performance notes\n- probability: ranking filter benefits from ix_classification_rank1 (partial index on ranking=1). Hash index on oid (ix_probabilities_oid) helps joins on oid.\n- magstat: dmdt_first and firstmjd filters use ix_magstats_dmdt_first and ix_magstats_firstmjd.\n- non_detection: join on oid uses ix_non_detection_oid.\n- Keep the INTERSECT to combine the object sets before joining to non_detection to minimize LC row expansion early."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\n1) Define constants for the time window\n- Start of window: 60188.0 (MJD for 2025-09-01)\n- End of window: 60190.0 (exclusive; covers 2025-09-01 and 2025-09-02)\n\n2) Build a subquery of objects whose highest-probability class in the stamp classifier is SN\n- Source table: probability\n- Filters:\n  - probability.classifier_name = 'stamp_classifier'  [user explicitly requires stamp classifier; overrides default lc_classifier]\n  - probability.ranking = 1  [highest-probability class per classifier version]\n  - probability.class_name = 'SN'\n- Output columns:\n  - oid\n  - probability (as stamp_probability)\n  - classifier_version (optional, in case you want to de-duplicate by version)\n- Note on duplicates across classifier_version:\n  - If multiple classifier_version rows occur per oid (each with ranking = 1 and class_name = 'SN'), either keep all or deduplicate to one row per oid. If deduplicating, select the row with the highest probability per oid (e.g., using a per-oid ordering by probability DESC and classifier_version DESC).\n\n3) Build a subquery of per-band \u201cfast risers\u201d with first detection in the first two days of September\n- Source table: magstat\n- Filters:\n  - magstat.firstmjd >= 60188.0 AND magstat.firstmjd < 60190.0  [first detection in band is within the 2-day window]\n  - magstat.dmdt_first <= -0.25  [fast riser: at least 0.25 mag/day brighter; negative sign indicates getting brighter in magnitudes]\n- Output columns:\n  - oid\n  - fid AS magstat_fid\n  - dmdt_first AS initial_rise_estimate\n  - firstmjd (optional, if you want it available downstream)\n- Rationale:\n  - Fast riser is defined per filter; dmdt_first is the rate estimate at first detection in that filter, computed relative to the last non-detection in the same filter.\n\n4) Intersect the two object sets to enforce both conditions at the object level\n- Subquery A (from step 2): select distinct oid from probability where classifier_name='stamp_classifier' AND ranking=1 AND class_name='SN'\n- Subquery B (from step 3): select distinct oid from magstat where firstmjd in [60188.0, 60190.0) AND dmdt_first <= -0.25\n- Intersect:\n  - candidate_oids = (A) INTERSECT (B)\n- Output:\n  - oid\n\n5) Reattach per-band fast-riser details and stamp-classifier probability to the intersected oids\n- Join candidate_oids to the fast-riser magstat subquery (step 3) on oid to recover:\n  - magstat_fid\n  - initial_rise_estimate\n- Join candidate_oids to the stamp-classifier subquery (step 2) on oid to recover:\n  - stamp_probability\n  - (optionally) classifier_version if needed\n- This yields, per object and per fast-riser band, the stamp SN probability and the rise estimate.\n\n6) Restrict light curves to non-detections only and in the same band as the fast-riser detection\n- Source table: non_detection\n- Join conditions:\n  - non_detection.oid = candidate_oids.oid\n  - non_detection.fid = magstat.magstat_fid  [enforces \u201csame filter\u201d as used for fast-riser criterion]\n- No time filtering for the LC is strictly required by the user; include all non-detection epochs. If you wish to only show the pre-detection LC, you may add non_detection.mjd < magstat.firstmjd, but this was not requested.\n\n7) Final projection (columns to return)\n- object identifier: oid (from probability or magstat join)\n- probability in the stamp classifier: probability.probability AS probability\n- non-detection light curve data (only):\n  - non_detection.fid AS fid  [filter ID of each non-detection epoch]\n  - non_detection.diffmaglim AS diffmaglim  [5-sigma limiting magnitude in the difference image; serves as the \u201cimage difference\u201d limit]\n- per-band magstat info used for fast-riser selection:\n  - magstat.fid AS magstat_fid\n  - magstat.dmdt_first AS initial_rise_estimate\n- Optional but often useful:\n  - non_detection.mjd (timestamp of each non-detection point) if you want explicit LC timing\n\n8) Result set shaping\n- Ordering: ORDER BY oid ASC\n- Limiting: LIMIT 100\n\n9) Query structure (nested subqueries, joins, and set operations)\n- Subquery P_SN: probability filtered to stamp_classifier, class_name='SN', ranking=1; select (oid, probability [, classifier_version])\n- Subquery MS_FAST: magstat filtered to fast-riser criterion and date window; select (oid, fid AS magstat_fid, dmdt_first AS initial_rise_estimate [, firstmjd])\n- Subquery OIDS_SN: select distinct oid from P_SN\n- Subquery OIDS_FAST: select distinct oid from MS_FAST\n- Subquery CANDIDATE_OIDS: OIDS_SN INTERSECT OIDS_FAST\n- Final assembly:\n  - CANDIDATE_OIDS\n    INNER JOIN P_SN USING (oid)\n    INNER JOIN MS_FAST USING (oid)\n    INNER JOIN non_detection ND\n      ON ND.oid = CANDIDATE_OIDS.oid\n     AND ND.fid = MS_FAST.magstat_fid\n- Final SELECT the columns listed in step 7\n- ORDER BY oid; LIMIT 100\n\n10) Index and performance notes\n- probability: ranking filter benefits from ix_classification_rank1 (partial index on ranking=1). Hash index on oid (ix_probabilities_oid) helps joins on oid.\n- magstat: dmdt_first and firstmjd filters use ix_magstats_dmdt_first and ix_magstats_firstmjd.\n- non_detection: join on oid uses ix_non_detection_oid.\n- Keep the INTERSECT to combine the object sets before joining to non_detection to minimize LC row expansion early."
                    },
                    "in_toks": 4555,
                    "out_toks": 7182,
                    "id": "chatcmpl-Cb6EpI1JCuHH9hvdiL4QENa4krQDR",
                    "created": 1762958151,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Objects whose highest-probability stamp classification is 'SN',\n-- with first detection between 60188.0 and 60190.0 MJD and fast-riser criterion (dmdt_first <= -0.25),\n-- returning non-detection light curves in the same band, and requested columns.\nWITH p_sn AS\n  (SELECT DISTINCT ON (oid) oid,\n                      probability,\n                      classifier_version\n   FROM probability\n   WHERE classifier_name = 'stamp_classifier'\n     AND ranking = 1\n     AND class_name = 'SN'\n   ORDER BY oid,\n            probability DESC,\n            classifier_version DESC),\n     ms_fast AS\n  (SELECT oid,\n          fid AS magstat_fid,\n          dmdt_first,\n          firstmjd\n   FROM magstat\n   WHERE firstmjd >= 60188.0\n     AND firstmjd < 60190.0\n     AND dmdt_first <= -0.25),\n     candidate_oids AS\n  (SELECT oid\n   FROM p_sn INTERSECT SELECT oid\n   FROM ms_fast)\nSELECT co.oid,\n       psn.probability,\n       nd.fid,\n       nd.diffmaglim,\n       msf.magstat_fid,\n       msf.dmdt_first,\n       nd.mjd\nFROM candidate_oids co\nINNER JOIN p_sn psn USING (oid)\nINNER JOIN ms_fast msf USING (oid)\nINNER JOIN non_detection nd ON nd.oid = co.oid\nAND nd.fid = msf.magstat_fid\nORDER BY co.oid\nLIMIT 100;"
                        },
                        "in_toks": 4565,
                        "out_toks": 3354,
                        "id": "chatcmpl-Cb6IQUEjxzE1YUQOTiJwZsrTia4Gd",
                        "created": 1762958374,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "8": {
            "req_id": "16",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "magstat",
                "non_detection",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'magstat', 'non_detection', 'detection']"
                },
                "in_toks": 692,
                "out_toks": 1951,
                "id": "chatcmpl-CZMI2y8axCkX04moWYZe8H5i2BDGD",
                "created": 1762543198,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Objects classified as SN by the stamp classifier (top-1)\nWITH p_sn AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE classifier_name = 'stamp_classifier'\n     AND class_name = 'SN'\n     AND ranking = 1), -- Fast risers per filter whose first detection is in the first two days of September (MJD in [60188, 60190))\n-- Also require at least one prior non-detection in the same filter\nf_fast AS\n  (SELECT m.oid,\n          m.fid,\n          m.firstmjd,\n          m.dmdt_first\n   FROM magstat m\n   JOIN p_sn p ON p.oid = m.oid\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0\n     AND m.dmdt_first IS NOT NULL\n     AND m.dmdt_first >= 0.25\n     AND m.ndet > 0\n     AND EXISTS\n       (SELECT 1\n        FROM non_detection nd\n        WHERE nd.oid = m.oid\n          AND nd.fid = m.fid\n          AND nd.mjd < m.firstmjd)), -- Keep (oid, fid) with fast-rise attributes\nb AS\n  (SELECT f.oid,\n          f.fid AS magstat_fid,\n          f.firstmjd,\n          f.dmdt_first AS initial_rise_estimate\n   FROM f_fast f), -- First detection row to retrieve image-difference flag (match fid and firstmjd)\nd_first AS\n  (SELECT d.oid,\n          d.fid,\n          d.mjd,\n          d.isdiffpos\n   FROM detection d\n   JOIN b ON b.oid = d.oid\n   AND b.magstat_fid = d.fid\n   AND b.firstmjd = d.mjd), -- Pre-limit the number of oids to reduce workload before expanding to non-detections\nsel_oids AS\n  (SELECT DISTINCT b.oid\n   FROM b\n   ORDER BY b.oid\n   LIMIT 100)\nSELECT p.oid,\n       p.probability, -- stamp-classifier probability\n nd.fid, -- non-detection filter ID\n d.isdiffpos, -- image-difference flag for the first detection\n b.magstat_fid, -- magstat filter ID\n b.initial_rise_estimate,\n nd.mjd, -- non-detection time\n nd.diffmaglim -- non-detection limiting magnitude\nFROM sel_oids s\nJOIN p_sn p ON p.oid = s.oid\nJOIN b ON b.oid = s.oid\nLEFT JOIN d_first d ON d.oid = b.oid\nAND d.fid = b.magstat_fid -- Only non-detections up to (and including) first detection to optimize and meet \"only non-detections\"\nJOIN non_detection nd ON nd.oid = b.oid\nAND nd.fid = b.magstat_fid\nAND nd.mjd <= b.firstmjd\nORDER BY p.oid\nLIMIT 100;",
            "sql_response": {
                "responses": {
                    "0": "-- Objects classified as SN by the stamp classifier (top-1)\nWITH p_sn AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE classifier_name = 'stamp_classifier'\n     AND class_name = 'SN'\n     AND ranking = 1), -- Fast risers per filter whose first detection is in the first two days of September (MJD in [60188, 60190))\n-- Also require at least one prior non-detection in the same filter\nf_fast AS\n  (SELECT m.oid,\n          m.fid,\n          m.firstmjd,\n          m.dmdt_first\n   FROM magstat m\n   JOIN p_sn p ON p.oid = m.oid\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0\n     AND m.dmdt_first IS NOT NULL\n     AND m.dmdt_first >= 0.25\n     AND m.ndet > 0\n     AND EXISTS\n       (SELECT 1\n        FROM non_detection nd\n        WHERE nd.oid = m.oid\n          AND nd.fid = m.fid\n          AND nd.mjd < m.firstmjd)), -- Keep (oid, fid) with fast-rise attributes\nb AS\n  (SELECT f.oid,\n          f.fid AS magstat_fid,\n          f.firstmjd,\n          f.dmdt_first AS initial_rise_estimate\n   FROM f_fast f), -- First detection row to retrieve image-difference flag (match fid and firstmjd)\nd_first AS\n  (SELECT d.oid,\n          d.fid,\n          d.mjd,\n          d.isdiffpos\n   FROM detection d\n   JOIN b ON b.oid = d.oid\n   AND b.magstat_fid = d.fid\n   AND b.firstmjd = d.mjd), -- Pre-limit the number of oids to reduce workload before expanding to non-detections\nsel_oids AS\n  (SELECT DISTINCT b.oid\n   FROM b\n   ORDER BY b.oid\n   LIMIT 100)\nSELECT p.oid,\n       p.probability, -- stamp-classifier probability\n nd.fid, -- non-detection filter ID\n d.isdiffpos, -- image-difference flag for the first detection\n b.magstat_fid, -- magstat filter ID\n b.initial_rise_estimate,\n nd.mjd, -- non-detection time\n nd.diffmaglim -- non-detection limiting magnitude\nFROM sel_oids s\nJOIN p_sn p ON p.oid = s.oid\nJOIN b ON b.oid = s.oid\nLEFT JOIN d_first d ON d.oid = b.oid\nAND d.fid = b.magstat_fid -- Only non-detections up to (and including) first detection to optimize and meet \"only non-detections\"\nJOIN non_detection nd ON nd.oid = b.oid\nAND nd.fid = b.magstat_fid\nAND nd.mjd <= b.firstmjd\nORDER BY p.oid\nLIMIT 100;"
                },
                "in_toks": 3661,
                "out_toks": 4189,
                "id": "chatcmpl-CbGwOgYz2hWnCmGFWflvQHQ4dE1nm",
                "created": 1762999292,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2597,
                "out_toks": 1103,
                "id": "chatcmpl-CZYFcWIm3Y4lyjtOXNYqYHgg40IBm",
                "created": 1762589176,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Objects classified as SN by the stamp classifier (top-1)\nWITH p_sn AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE classifier_name = 'stamp_classifier'\n     AND class_name = 'SN'\n     AND ranking = 1), -- Fast risers in the first two days of September (per filter), requiring a prior non-detection\nf_fast AS\n  (SELECT m.oid,\n          m.fid,\n          m.firstmjd,\n          m.dmdt_first\n   FROM magstat m\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0\n     AND m.dmdt_first IS NOT NULL\n     AND m.dmdt_first >= 0.25\n     AND m.ndet > 0\n     AND EXISTS\n       (SELECT 1\n        FROM non_detection nd\n        WHERE nd.oid = m.oid\n          AND nd.fid = m.fid\n          AND nd.mjd < m.firstmjd)), -- Keep only fast-riser (oid, fid) pairs that are also SN by stamp classifier\nb AS\n  (SELECT f.oid,\n          f.fid AS magstat_fid,\n          f.firstmjd,\n          f.dmdt_first AS initial_rise_estimate\n   FROM f_fast f\n   INNER JOIN p_sn p ON p.oid = f.oid), -- First detection row (to retrieve the image-difference flag) matching magstat.firstmjd and fid\nd_first AS\n  (SELECT d.oid,\n          d.fid,\n          d.mjd,\n          d.isdiffpos\n   FROM detection d\n   INNER JOIN b ON b.oid = d.oid\n   AND b.magstat_fid = d.fid\n   AND b.firstmjd = d.mjd), -- All non-detections (light curve points) for the selected (oid, fid)\nnd_all AS\n  (SELECT nd.oid,\n          nd.fid,\n          nd.mjd,\n          nd.diffmaglim\n   FROM non_detection nd\n   INNER JOIN b ON b.oid = nd.oid\n   AND b.magstat_fid = nd.fid)\nSELECT p.oid,\n       p.probability, -- stamp-classifier probability\n nd.fid, -- non_detection filter ID\n d.isdiffpos, -- image-difference flag for the first detection\n b.magstat_fid, -- magstat filter ID\n b.initial_rise_estimate,\n nd.mjd, -- non-detection time\n nd.diffmaglim -- non-detection limiting magnitude\nFROM nd_all nd\nINNER JOIN b ON b.oid = nd.oid\nAND b.magstat_fid = nd.fid\nINNER JOIN p_sn p ON p.oid = nd.oid\nLEFT JOIN d_first d ON d.oid = nd.oid\nAND d.fid = nd.fid\nORDER BY p.oid\nLIMIT 100;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nReturn, for up to 100 qualifying rows: the object identifiers, the top-1 stamp-classifier probability for class 'SN', and the light-curve points consisting only of non-detections, for objects that:\n- have highest probability in the stamp classifier = 'SN' (ranking = 1),\n- had their first detection (in the same filter) in the first two days of September (MJD in [60188.0, 60190.0)),\n- qualify as fast risers (initial rise rate \u2265 0.25 mag/day using same-filter pre/post events).\nAdditionally return: oid, stamp probability, the non_detection filter id (fid), the first-detection image-difference flag, the magstat filter id as magstat_fid, and the initial rise estimate. Order by oid and limit 100.\n\nKey schema references\n- probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n- magstat(oid, fid, firstmjd, dmdt_first, dt_first, dm_first, ndet, ... )\n- non_detection(oid, fid, mjd, diffmaglim)\n- detection(candid, oid, mjd, fid, isdiffpos, ...)\n\nDefault probability conditions overridden\n- Use classifier_name = 'stamp_classifier' (not 'lc_classifier') with ranking = 1 and class_name = 'SN'.\n\nTemporal window for \u201cfirst 2 days of September\u201d\n- Use MJD in [60188.0, 60190.0).\n- Apply to magstat.firstmjd to ensure filter-specific first detection timing.\n\nFast riser definition\n- Use magstat.dmdt_first \u2265 0.25 (same-filter estimate from last non-detection to first detection).\n- Ensure same-filter constraint by operating at magstat.fid level.\n- Ensure last non-detection exists by requiring at least one non_detection row with same fid and mjd < magstat.firstmjd (via EXISTS or inner join).\n\nSet-building and filtering steps\n\n1) Subquery P_SN (stamp-classifier, top-1 class SN)\n- From probability p:\n  - p.classifier_name = 'stamp_classifier'\n  - p.class_name = 'SN'\n  - p.ranking = 1\n- Columns: p.oid, p.probability AS stamp_prob, p.classifier_version (keep if needed), p.class_name.\n- This is the set of OIDs whose highest-probability stamp classification is SN.\n\n2) Subquery F_fast (fast-riser candidates at filter level)\n- From magstat m:\n  - m.firstmjd >= 60188.0 AND m.firstmjd < 60190.0\n  - m.dmdt_first IS NOT NULL AND m.dmdt_first >= 0.25\n  - Optionally m.ndet > 0 to ensure detections exist in that filter\n  - EXISTS(\n      SELECT 1\n      FROM non_detection nd\n      WHERE nd.oid = m.oid\n        AND nd.fid = m.fid\n        AND nd.mjd < m.firstmjd\n    )  to confirm a valid \u201clast non-detection\u201d exists\n- Columns: m.oid, m.fid AS magstat_fid, m.firstmjd, m.dmdt_first AS initial_rise_estimate.\n\n3) Intersect the object sets (ensure both stamp SN and fast-riser criteria)\n- Build two OID-only sets:\n  - O_P = SELECT DISTINCT p.oid FROM P_SN p\n  - O_F = SELECT DISTINCT m.oid FROM F_fast m\n- Compute O_base = O_P INTERSECT O_F\n  - This ensures we only keep objects that satisfy both conditions at the OID level.\n- Note: F_fast remains the authoritative list of (oid, fid) pairs (since fast-riser criteria are filter-specific). We will later restrict F_fast to OIDs in O_base.\n\n4) Base (oid, fid) pairs for final expansion\n- B = SELECT f.* FROM F_fast f INNER JOIN O_base o USING (oid)\n  - Columns retained: oid, magstat_fid (= fid), firstmjd, initial_rise_estimate.\n\nFirst detection \u201cimage difference\u201d (isdiffpos) and non-detection light curve\n\n5) Subquery D_first (first detection row per (oid, fid))\n- From detection d INNER JOIN B b ON d.oid = b.oid AND d.fid = b.magstat_fid AND d.mjd = b.firstmjd\n  - This uses magstat.firstmjd (first detection time in that filter) to fetch the exact detection row.\n- Columns: d.oid, d.fid, d.mjd, d.isdiffpos AS image_difference.\n- Note: detection is large; we filter only by OIDs in B and exact fid/mjd to stay selective.\n\n6) Subqueries for non-detection light curves (only non-detections), then UNION\n- We want all non-detection points in the same filter, optionally split around the first detection and recombined via UNION ALL (this also demonstrates explicit UNION use).\n- ND_before:\n  - From non_detection nd INNER JOIN B b ON nd.oid = b.oid AND nd.fid = b.magstat_fid\n  - Condition: nd.mjd <= b.firstmjd\n  - Columns: nd.oid, nd.fid, nd.mjd, nd.diffmaglim\n- ND_after:\n  - From non_detection nd INNER JOIN B b ON nd.oid = b.oid AND nd.fid = b.magstat_fid\n  - Condition: nd.mjd > b.firstmjd\n  - Columns: nd.oid, nd.fid, nd.mjd, nd.diffmaglim\n- ND_all = ND_before UNION ALL ND_after\n  - This yields all non-detections for the selected (oid, fid), preserving LC points purely from non_detection.\n\nFinal assembly and projection\n\n7) Join everything to assemble the final rows\n- Start from ND_all (as it is potentially multi-row per object).\n- INNER JOIN B b USING (oid, fid = magstat_fid) to bring firstmjd and initial_rise_estimate.\n- INNER JOIN P_SN p USING (oid) to bring stamp_prob.\n- LEFT (or INNER) JOIN D_first d ON (d.oid = b.oid AND d.fid = b.magstat_fid) to bring image_difference; inner join is acceptable if a matching first detection row exists; left join if you want to keep rows even if the exact detection record is missing.\n- Project the following columns:\n  - p.oid\n  - p.probability AS stamp_prob\n  - ND_all.fid AS fid           (the light-curve non-detection filter id)\n  - d.image_difference          (d.isdiffpos)\n  - b.magstat_fid               (alias as magstat_fid)\n  - b.initial_rise_estimate     (m.dmdt_first)\n  - ND_all.mjd, ND_all.diffmaglim  (non-detection LC)\n  - Optionally include p.class_name (should be 'SN') and p.classifier_version for traceability.\n\n8) Ordering and limiting\n- ORDER BY p.oid ASC (you may optionally add ND_all.mjd to obtain time-ordered LC within OID).\n- LIMIT 100.\n\nPerformance and index notes\n- probability: use ranking = 1 and classifier_name = 'stamp_classifier' (uses ix_classification_rank1 and btree on ranking).\n- magstat: filter on firstmjd (ix_magstats_firstmjd) and dmdt_first (ix_magstats_dmdt_first).\n- detection: join strictly by oid (ix_ndetection_oid) and exact fid/mjd to stay selective.\n- non_detection: join by oid (ix_non_detection_oid) and filter by fid; mjd constraint partitions the data logically; consider also filtering to a reasonable mjd range if desired.\n\nEdge considerations\n- If equality join on d.mjd = b.firstmjd risks floating precision mismatch, consider joining to the minimal d.mjd \u2265 b.firstmjd per (oid, fid); however magstat.firstmjd is intended to match the first detection epoch.\n- If you intend \u201cfirst detection in first 2 days of September\u201d to mean object-level first detection (any filter), replace the magstat.firstmjd filter with object.firstmjd in the filtering set, but keep same-filter constraints for the fast-riser test via magstat.\n\nThis plan uses:\n- JOINs to connect probability, magstat, detection, and non_detection.\n- INTERSECT to enforce objects satisfy both \u201cstamp SN top-1\u201d and \u201cfast riser in time window\u201d.\n- UNION ALL to collate non-detection light-curve points on both sides of the first detection into a single LC set while ensuring only non-detections are included."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nReturn, for up to 100 qualifying rows: the object identifiers, the top-1 stamp-classifier probability for class 'SN', and the light-curve points consisting only of non-detections, for objects that:\n- have highest probability in the stamp classifier = 'SN' (ranking = 1),\n- had their first detection (in the same filter) in the first two days of September (MJD in [60188.0, 60190.0)),\n- qualify as fast risers (initial rise rate \u2265 0.25 mag/day using same-filter pre/post events).\nAdditionally return: oid, stamp probability, the non_detection filter id (fid), the first-detection image-difference flag, the magstat filter id as magstat_fid, and the initial rise estimate. Order by oid and limit 100.\n\nKey schema references\n- probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n- magstat(oid, fid, firstmjd, dmdt_first, dt_first, dm_first, ndet, ... )\n- non_detection(oid, fid, mjd, diffmaglim)\n- detection(candid, oid, mjd, fid, isdiffpos, ...)\n\nDefault probability conditions overridden\n- Use classifier_name = 'stamp_classifier' (not 'lc_classifier') with ranking = 1 and class_name = 'SN'.\n\nTemporal window for \u201cfirst 2 days of September\u201d\n- Use MJD in [60188.0, 60190.0).\n- Apply to magstat.firstmjd to ensure filter-specific first detection timing.\n\nFast riser definition\n- Use magstat.dmdt_first \u2265 0.25 (same-filter estimate from last non-detection to first detection).\n- Ensure same-filter constraint by operating at magstat.fid level.\n- Ensure last non-detection exists by requiring at least one non_detection row with same fid and mjd < magstat.firstmjd (via EXISTS or inner join).\n\nSet-building and filtering steps\n\n1) Subquery P_SN (stamp-classifier, top-1 class SN)\n- From probability p:\n  - p.classifier_name = 'stamp_classifier'\n  - p.class_name = 'SN'\n  - p.ranking = 1\n- Columns: p.oid, p.probability AS stamp_prob, p.classifier_version (keep if needed), p.class_name.\n- This is the set of OIDs whose highest-probability stamp classification is SN.\n\n2) Subquery F_fast (fast-riser candidates at filter level)\n- From magstat m:\n  - m.firstmjd >= 60188.0 AND m.firstmjd < 60190.0\n  - m.dmdt_first IS NOT NULL AND m.dmdt_first >= 0.25\n  - Optionally m.ndet > 0 to ensure detections exist in that filter\n  - EXISTS(\n      SELECT 1\n      FROM non_detection nd\n      WHERE nd.oid = m.oid\n        AND nd.fid = m.fid\n        AND nd.mjd < m.firstmjd\n    )  to confirm a valid \u201clast non-detection\u201d exists\n- Columns: m.oid, m.fid AS magstat_fid, m.firstmjd, m.dmdt_first AS initial_rise_estimate.\n\n3) Intersect the object sets (ensure both stamp SN and fast-riser criteria)\n- Build two OID-only sets:\n  - O_P = SELECT DISTINCT p.oid FROM P_SN p\n  - O_F = SELECT DISTINCT m.oid FROM F_fast m\n- Compute O_base = O_P INTERSECT O_F\n  - This ensures we only keep objects that satisfy both conditions at the OID level.\n- Note: F_fast remains the authoritative list of (oid, fid) pairs (since fast-riser criteria are filter-specific). We will later restrict F_fast to OIDs in O_base.\n\n4) Base (oid, fid) pairs for final expansion\n- B = SELECT f.* FROM F_fast f INNER JOIN O_base o USING (oid)\n  - Columns retained: oid, magstat_fid (= fid), firstmjd, initial_rise_estimate.\n\nFirst detection \u201cimage difference\u201d (isdiffpos) and non-detection light curve\n\n5) Subquery D_first (first detection row per (oid, fid))\n- From detection d INNER JOIN B b ON d.oid = b.oid AND d.fid = b.magstat_fid AND d.mjd = b.firstmjd\n  - This uses magstat.firstmjd (first detection time in that filter) to fetch the exact detection row.\n- Columns: d.oid, d.fid, d.mjd, d.isdiffpos AS image_difference.\n- Note: detection is large; we filter only by OIDs in B and exact fid/mjd to stay selective.\n\n6) Subqueries for non-detection light curves (only non-detections), then UNION\n- We want all non-detection points in the same filter, optionally split around the first detection and recombined via UNION ALL (this also demonstrates explicit UNION use).\n- ND_before:\n  - From non_detection nd INNER JOIN B b ON nd.oid = b.oid AND nd.fid = b.magstat_fid\n  - Condition: nd.mjd <= b.firstmjd\n  - Columns: nd.oid, nd.fid, nd.mjd, nd.diffmaglim\n- ND_after:\n  - From non_detection nd INNER JOIN B b ON nd.oid = b.oid AND nd.fid = b.magstat_fid\n  - Condition: nd.mjd > b.firstmjd\n  - Columns: nd.oid, nd.fid, nd.mjd, nd.diffmaglim\n- ND_all = ND_before UNION ALL ND_after\n  - This yields all non-detections for the selected (oid, fid), preserving LC points purely from non_detection.\n\nFinal assembly and projection\n\n7) Join everything to assemble the final rows\n- Start from ND_all (as it is potentially multi-row per object).\n- INNER JOIN B b USING (oid, fid = magstat_fid) to bring firstmjd and initial_rise_estimate.\n- INNER JOIN P_SN p USING (oid) to bring stamp_prob.\n- LEFT (or INNER) JOIN D_first d ON (d.oid = b.oid AND d.fid = b.magstat_fid) to bring image_difference; inner join is acceptable if a matching first detection row exists; left join if you want to keep rows even if the exact detection record is missing.\n- Project the following columns:\n  - p.oid\n  - p.probability AS stamp_prob\n  - ND_all.fid AS fid           (the light-curve non-detection filter id)\n  - d.image_difference          (d.isdiffpos)\n  - b.magstat_fid               (alias as magstat_fid)\n  - b.initial_rise_estimate     (m.dmdt_first)\n  - ND_all.mjd, ND_all.diffmaglim  (non-detection LC)\n  - Optionally include p.class_name (should be 'SN') and p.classifier_version for traceability.\n\n8) Ordering and limiting\n- ORDER BY p.oid ASC (you may optionally add ND_all.mjd to obtain time-ordered LC within OID).\n- LIMIT 100.\n\nPerformance and index notes\n- probability: use ranking = 1 and classifier_name = 'stamp_classifier' (uses ix_classification_rank1 and btree on ranking).\n- magstat: filter on firstmjd (ix_magstats_firstmjd) and dmdt_first (ix_magstats_dmdt_first).\n- detection: join strictly by oid (ix_ndetection_oid) and exact fid/mjd to stay selective.\n- non_detection: join by oid (ix_non_detection_oid) and filter by fid; mjd constraint partitions the data logically; consider also filtering to a reasonable mjd range if desired.\n\nEdge considerations\n- If equality join on d.mjd = b.firstmjd risks floating precision mismatch, consider joining to the minimal d.mjd \u2265 b.firstmjd per (oid, fid); however magstat.firstmjd is intended to match the first detection epoch.\n- If you intend \u201cfirst detection in first 2 days of September\u201d to mean object-level first detection (any filter), replace the magstat.firstmjd filter with object.firstmjd in the filtering set, but keep same-filter constraints for the fast-riser test via magstat.\n\nThis plan uses:\n- JOINs to connect probability, magstat, detection, and non_detection.\n- INTERSECT to enforce objects satisfy both \u201cstamp SN top-1\u201d and \u201cfast riser in time window\u201d.\n- UNION ALL to collate non-detection light-curve points on both sides of the first detection into a single LC set while ensuring only non-detections are included."
                    },
                    "in_toks": 4555,
                    "out_toks": 8087,
                    "id": "chatcmpl-Cb6KKNvt0LTBBL1iCSIRyZDAir2bG",
                    "created": 1762958492,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Objects classified as SN by the stamp classifier (top-1)\nWITH p_sn AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE classifier_name = 'stamp_classifier'\n     AND class_name = 'SN'\n     AND ranking = 1), -- Fast risers in the first two days of September (per filter), requiring a prior non-detection\nf_fast AS\n  (SELECT m.oid,\n          m.fid,\n          m.firstmjd,\n          m.dmdt_first\n   FROM magstat m\n   WHERE m.firstmjd >= 60188.0\n     AND m.firstmjd < 60190.0\n     AND m.dmdt_first IS NOT NULL\n     AND m.dmdt_first >= 0.25\n     AND m.ndet > 0\n     AND EXISTS\n       (SELECT 1\n        FROM non_detection nd\n        WHERE nd.oid = m.oid\n          AND nd.fid = m.fid\n          AND nd.mjd < m.firstmjd)), -- Keep only fast-riser (oid, fid) pairs that are also SN by stamp classifier\nb AS\n  (SELECT f.oid,\n          f.fid AS magstat_fid,\n          f.firstmjd,\n          f.dmdt_first AS initial_rise_estimate\n   FROM f_fast f\n   INNER JOIN p_sn p ON p.oid = f.oid), -- First detection row (to retrieve the image-difference flag) matching magstat.firstmjd and fid\nd_first AS\n  (SELECT d.oid,\n          d.fid,\n          d.mjd,\n          d.isdiffpos\n   FROM detection d\n   INNER JOIN b ON b.oid = d.oid\n   AND b.magstat_fid = d.fid\n   AND b.firstmjd = d.mjd), -- All non-detections (light curve points) for the selected (oid, fid)\nnd_all AS\n  (SELECT nd.oid,\n          nd.fid,\n          nd.mjd,\n          nd.diffmaglim\n   FROM non_detection nd\n   INNER JOIN b ON b.oid = nd.oid\n   AND b.magstat_fid = nd.fid)\nSELECT p.oid,\n       p.probability, -- stamp-classifier probability\n nd.fid, -- non_detection filter ID\n d.isdiffpos, -- image-difference flag for the first detection\n b.magstat_fid, -- magstat filter ID\n b.initial_rise_estimate,\n nd.mjd, -- non-detection time\n nd.diffmaglim -- non-detection limiting magnitude\nFROM nd_all nd\nINNER JOIN b ON b.oid = nd.oid\nAND b.magstat_fid = nd.fid\nINNER JOIN p_sn p ON p.oid = nd.oid\nLEFT JOIN d_first d ON d.oid = nd.oid\nAND d.fid = nd.fid\nORDER BY p.oid\nLIMIT 100;"
                        },
                        "in_toks": 5086,
                        "out_toks": 4000,
                        "id": "chatcmpl-Cb6OXuaMdBKH6twiNN1rLZ3nL9zlS",
                        "created": 1762958753,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "9": {
            "req_id": "16",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "non_detection",
                "detection",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'non_detection', 'detection', 'magstat']"
                },
                "in_toks": 692,
                "out_toks": 1439,
                "id": "chatcmpl-CZMJ3ZJhPsPpwVZqapNGWhmIt75Ln",
                "created": 1762543261,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2597,
                "out_toks": 847,
                "id": "chatcmpl-CZYG9v6eubQmGgAIQwEO1fKyAp3dg",
                "created": 1762589209,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Objects whose highest-probability class in the stamp classifier is 'SN',\n-- first detected in the first two days of September (MJD [60188.0, 60190.0)),\n-- and are fast risers (dmdt_first >= 0.25) in the same filter as their first detection.\n-- Return: oid, probability (stamp classifier), non-detection light curve (fid, diffmaglim, mjd),\n-- magstat filter as magstat_fid, and dmdt_first (initial rise estimate).\nWITH s1 AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'SN'),\n     s2 AS\n  (SELECT s1.oid,\n          s1.probability,\n          o.firstmjd\n   FROM s1\n   INNER JOIN OBJECT o ON o.oid = s1.oid\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n     s3 AS\n  (SELECT s2.oid,\n          s2.probability,\n          s2.firstmjd,\n          m.fid AS magstat_fid,\n          m.dmdt_first\n   FROM s2\n   INNER JOIN magstat m ON m.oid = s2.oid\n   AND m.firstmjd = s2.firstmjd\n   WHERE m.dmdt_first >= 0.25)\nSELECT s3.oid,\n       s3.probability,\n       nd.fid,\n       nd.diffmaglim,\n       nd.mjd,\n       s3.magstat_fid,\n       s3.dmdt_first\nFROM s3\nINNER JOIN non_detection nd ON nd.oid = s3.oid\nAND nd.fid = s3.magstat_fid\nAND nd.mjd <= s3.firstmjd\nORDER BY s3.oid\nLIMIT 100;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Set fixed parameters\n- Time window for \u201cfirst 2 days of September\u201d: firstmjd in [60188.0, 60190.0). Use:\n  - lower_bound = 60188.0\n  - upper_bound = 60190.0\n- Fast-riser threshold: dmdt_first >= 0.25 (mag/day)\n\n2) Subquery S1: select oids with highest-probability SN in the stamp classifier\n- From: probability p\n- Filters (override the general default because the user asked for stamp classifier):\n  - p.classifier_name = 'stamp_classifier'\n  - p.ranking = 1\n  - p.class_name = 'SN'\n- Output: p.oid, p.probability\n- Notes:\n  - This enforces \u201chighest probability in the stamp classifier is obtained for class SN.\u201d\n  - Index usage: ix_classification_rank1 (ranking = 1)\n\n3) Subquery S2: restrict to objects first detected in the target time window\n- From: S1 INNER JOIN object o ON o.oid = S1.oid\n- Filters:\n  - o.firstmjd >= 60188.0 AND o.firstmjd < 60190.0\n- Output: o.oid, o.firstmjd, S1.probability\n- Notes:\n  - Satisfies \u201chad their first detection in the first 2 days of September.\u201d\n  - Index usage: ix_object_firstmjd\n\n4) Subquery S3: enforce fast-riser condition in the band of the first detection\n- From: S2 INNER JOIN magstat m ON m.oid = S2.oid\n- Filters:\n  - m.firstmjd = S2.firstmjd  (ensures we use the same filter where the object\u2019s first detection occurred)\n  - m.dmdt_first >= 0.25      (fast-riser criterion)\n- Output: S2.oid, S2.probability, S2.firstmjd, m.fid AS magstat_fid, m.dmdt_first AS initial_rise_estimate\n- Notes:\n  - This leverages the precomputed \u201cinitial rise\u201d quantities per band.\n  - Index usage: ix_magstats_firstmjd, ix_magstats_dmdt_first\n\n5) Final selection with non-detections light curves\n- From: S3 INNER JOIN non_detection nd ON nd.oid = S3.oid\n- Filters for the light curve content (only non-detections; constrain to the same band and up to the first detection to reflect pre-detection light curve consistent with fast-riser definition):\n  - nd.fid = S3.magstat_fid\n  - nd.mjd <= S3.firstmjd\n- Output columns (as requested):\n  - oid = S3.oid\n  - probability = S3.probability  (probability from the stamp classifier)\n  - fid = nd.fid                  (filter ID of non-detection)\n  - diffmaglim = nd.diffmaglim    (\u201cimage difference\u201d 5-sigma mag limit in the difference image)\n  - mjd = nd.mjd                  (to provide the non-detection light curve timing)\n  - magstat_fid = S3.magstat_fid  (filter ID used in magstat for the initial detection/fast-rise computation)\n  - initial_rise_estimate = S3.initial_rise_estimate (magstat.dmdt_first)\n- Ordering and limit:\n  - ORDER BY S3.oid\n  - LIMIT 100\n- Notes:\n  - This returns the requested identifiers, stamp-classifier probabilities, and non-detection-only light curves tied to the same filter as the initial detection, including the initial rise estimate and the requested filter identifiers.\n  - Index usage: ix_non_detection_oid (join on oid)\n\n6) Summary of join structure and constraints\n- S1 (probability, filtered to rank-1 SN in stamp) \n  INNER JOIN object (firstmjd window) \u2192 S2\n  INNER JOIN magstat (same firstmjd band; dmdt_first >= 0.25) \u2192 S3\n  INNER JOIN non_detection (same fid as magstat; mjd \u2264 firstmjd) \u2192 final\n- Apply ORDER BY oid, LIMIT 100 on the final result set."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\n1) Set fixed parameters\n- Time window for \u201cfirst 2 days of September\u201d: firstmjd in [60188.0, 60190.0). Use:\n  - lower_bound = 60188.0\n  - upper_bound = 60190.0\n- Fast-riser threshold: dmdt_first >= 0.25 (mag/day)\n\n2) Subquery S1: select oids with highest-probability SN in the stamp classifier\n- From: probability p\n- Filters (override the general default because the user asked for stamp classifier):\n  - p.classifier_name = 'stamp_classifier'\n  - p.ranking = 1\n  - p.class_name = 'SN'\n- Output: p.oid, p.probability\n- Notes:\n  - This enforces \u201chighest probability in the stamp classifier is obtained for class SN.\u201d\n  - Index usage: ix_classification_rank1 (ranking = 1)\n\n3) Subquery S2: restrict to objects first detected in the target time window\n- From: S1 INNER JOIN object o ON o.oid = S1.oid\n- Filters:\n  - o.firstmjd >= 60188.0 AND o.firstmjd < 60190.0\n- Output: o.oid, o.firstmjd, S1.probability\n- Notes:\n  - Satisfies \u201chad their first detection in the first 2 days of September.\u201d\n  - Index usage: ix_object_firstmjd\n\n4) Subquery S3: enforce fast-riser condition in the band of the first detection\n- From: S2 INNER JOIN magstat m ON m.oid = S2.oid\n- Filters:\n  - m.firstmjd = S2.firstmjd  (ensures we use the same filter where the object\u2019s first detection occurred)\n  - m.dmdt_first >= 0.25      (fast-riser criterion)\n- Output: S2.oid, S2.probability, S2.firstmjd, m.fid AS magstat_fid, m.dmdt_first AS initial_rise_estimate\n- Notes:\n  - This leverages the precomputed \u201cinitial rise\u201d quantities per band.\n  - Index usage: ix_magstats_firstmjd, ix_magstats_dmdt_first\n\n5) Final selection with non-detections light curves\n- From: S3 INNER JOIN non_detection nd ON nd.oid = S3.oid\n- Filters for the light curve content (only non-detections; constrain to the same band and up to the first detection to reflect pre-detection light curve consistent with fast-riser definition):\n  - nd.fid = S3.magstat_fid\n  - nd.mjd <= S3.firstmjd\n- Output columns (as requested):\n  - oid = S3.oid\n  - probability = S3.probability  (probability from the stamp classifier)\n  - fid = nd.fid                  (filter ID of non-detection)\n  - diffmaglim = nd.diffmaglim    (\u201cimage difference\u201d 5-sigma mag limit in the difference image)\n  - mjd = nd.mjd                  (to provide the non-detection light curve timing)\n  - magstat_fid = S3.magstat_fid  (filter ID used in magstat for the initial detection/fast-rise computation)\n  - initial_rise_estimate = S3.initial_rise_estimate (magstat.dmdt_first)\n- Ordering and limit:\n  - ORDER BY S3.oid\n  - LIMIT 100\n- Notes:\n  - This returns the requested identifiers, stamp-classifier probabilities, and non-detection-only light curves tied to the same filter as the initial detection, including the initial rise estimate and the requested filter identifiers.\n  - Index usage: ix_non_detection_oid (join on oid)\n\n6) Summary of join structure and constraints\n- S1 (probability, filtered to rank-1 SN in stamp) \n  INNER JOIN object (firstmjd window) \u2192 S2\n  INNER JOIN magstat (same firstmjd band; dmdt_first >= 0.25) \u2192 S3\n  INNER JOIN non_detection (same fid as magstat; mjd \u2264 firstmjd) \u2192 final\n- Apply ORDER BY oid, LIMIT 100 on the final result set."
                    },
                    "in_toks": 4555,
                    "out_toks": 6560,
                    "id": "chatcmpl-Cb6PtaRQTY31L7GsnpwLIx7EPT1rD",
                    "created": 1762958837,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Objects whose highest-probability class in the stamp classifier is 'SN',\n-- first detected in the first two days of September (MJD [60188.0, 60190.0)),\n-- and are fast risers (dmdt_first >= 0.25) in the same filter as their first detection.\n-- Return: oid, probability (stamp classifier), non-detection light curve (fid, diffmaglim, mjd),\n-- magstat filter as magstat_fid, and dmdt_first (initial rise estimate).\nWITH s1 AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'SN'),\n     s2 AS\n  (SELECT s1.oid,\n          s1.probability,\n          o.firstmjd\n   FROM s1\n   INNER JOIN OBJECT o ON o.oid = s1.oid\n   WHERE o.firstmjd >= 60188.0\n     AND o.firstmjd < 60190.0),\n     s3 AS\n  (SELECT s2.oid,\n          s2.probability,\n          s2.firstmjd,\n          m.fid AS magstat_fid,\n          m.dmdt_first\n   FROM s2\n   INNER JOIN magstat m ON m.oid = s2.oid\n   AND m.firstmjd = s2.firstmjd\n   WHERE m.dmdt_first >= 0.25)\nSELECT s3.oid,\n       s3.probability,\n       nd.fid,\n       nd.diffmaglim,\n       nd.mjd,\n       s3.magstat_fid,\n       s3.dmdt_first\nFROM s3\nINNER JOIN non_detection nd ON nd.oid = s3.oid\nAND nd.fid = s3.magstat_fid\nAND nd.mjd <= s3.firstmjd\nORDER BY s3.oid\nLIMIT 100;"
                        },
                        "in_toks": 4135,
                        "out_toks": 2888,
                        "id": "chatcmpl-Cb6SA5bSnwEoTEiNYB16Ypl8t7PNP",
                        "created": 1762958978,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": false
        }
    },
    "19": {
        "0": {
            "req_id": "19",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']",
                    "1": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 664,
                "out_toks": 1126,
                "id": "chatcmpl-CSnSQX7JhQ2bzdV9fJncCGsRe0F3y",
                "created": 1760979334,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "/* Objects that first appeared between 2021-03-01 and 2021-04-01 (MJD [59274.0, 59305.0))\n   With at most one detection (ndet <= 1)\n   Classified as 'asteroid' by the stamp classifier with probability > 0.7\n   Optimization: filter each table separately, then join; enforce ranking=1 on probability */ WITH o_filtered AS\n  (SELECT oid,\n          meanra,\n          meandec,\n          ndet,\n          firstmjd\n   FROM OBJECT\n   WHERE firstmjd >= 59274.0\n     AND firstmjd < 59305.0\n     AND ndet <= 1),\n                                                                                                   p_filtered AS\n  (SELECT oid,\n          class_name,\n          probability\n   FROM probability\n   WHERE classifier_name = 'stamp_classifier' -- classifier filter\n\n     AND class_name = 'asteroid' -- class filter\n\n     AND ranking = 1 -- best-ranked class per classifier/version\n\n     AND probability > 0.7 -- probability threshold\n)\nSELECT o.oid,\n       o.meanra,\n       o.meandec,\n       o.ndet,\n       o.firstmjd,\n       p.class_name,\n       p.probability\nFROM o_filtered AS o\nJOIN p_filtered AS p USING (oid);",
            "sql_response": {
                "responses": {
                    "0": "/* Objects that first appeared between 2021-03-01 and 2021-04-01 (MJD [59274.0, 59305.0))\n   With at most one detection (ndet <= 1)\n   Classified as 'asteroid' by the stamp classifier with probability > 0.7\n   Optimization: filter each table separately, then join; enforce ranking=1 on probability */ WITH o_filtered AS\n  (SELECT oid,\n          meanra,\n          meandec,\n          ndet,\n          firstmjd\n   FROM OBJECT\n   WHERE firstmjd >= 59274.0\n     AND firstmjd < 59305.0\n     AND ndet <= 1),\n                                                                                                   p_filtered AS\n  (SELECT oid,\n          class_name,\n          probability\n   FROM probability\n   WHERE classifier_name = 'stamp_classifier' -- classifier filter\n\n     AND class_name = 'asteroid' -- class filter\n\n     AND ranking = 1 -- best-ranked class per classifier/version\n\n     AND probability > 0.7 -- probability threshold\n)\nSELECT o.oid,\n       o.meanra,\n       o.meandec,\n       o.ndet,\n       o.firstmjd,\n       p.class_name,\n       p.probability\nFROM o_filtered AS o\nJOIN p_filtered AS p USING (oid);"
                },
                "in_toks": 1586,
                "out_toks": 1693,
                "id": "chatcmpl-CbGxuSvFlHT7mBhkuisD0DgH4UySD",
                "created": 1762999386,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1186,
                "out_toks": 463,
                "id": "chatcmpl-CSni221yuVmm1XAtZXr39IDU1CpFb",
                "created": 1760980302,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects that first appeared between 2021-03-01 and 2021-04-01 (MJD [59274.0, 59305.0))\n-- With at most one detection (ndet <= 1)\n-- Classified as 'asteroid' by the stamp classifier with probability > 0.7\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd < 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects that first appeared between 2021-03-01 and 2021-04-01 (MJD [59274.0, 59305.0))\n-- With at most one detection (ndet <= 1)\n-- Classified as 'asteroid' by the stamp classifier with probability > 0.7\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd < 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7;\n```"
                },
                "in_toks": 2553,
                "out_toks": 1939,
                "id": "chatcmpl-CSqsqlxtLmrqyf9GTNzXDXkT3AFhv",
                "created": 1760992504,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "1": {
            "req_id": "19",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']",
                    "1": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 664,
                "out_toks": 1126,
                "id": "chatcmpl-CSnSQX7JhQ2bzdV9fJncCGsRe0F3y",
                "created": 1760979334,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1186,
                "out_toks": 207,
                "id": "chatcmpl-CSniAc6sZDyt30XqoCYkpJW5Rkq2x",
                "created": 1760980310,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects with at most one detection, first detected between 2021-03-01 and 2021-04-01 (MJD in [59274.0, 59305.0)),\n-- and classified as 'asteroid' by the stamp classifier with probability > 0.7 (top-ranked class).\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd < 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7\n    AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with at most one detection, first detected between 2021-03-01 and 2021-04-01 (MJD in [59274.0, 59305.0)),\n-- and classified as 'asteroid' by the stamp classifier with probability > 0.7 (top-ranked class).\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd < 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7\n    AND p.ranking = 1;\n```"
                },
                "in_toks": 2553,
                "out_toks": 1883,
                "id": "chatcmpl-CSqt34GqLBfkrgrEbsFCRVm78Aab2",
                "created": 1760992517,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "19",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 664,
                "out_toks": 723,
                "id": "chatcmpl-CSsYLhyLqAFBEOq3AVb0Wb3KYJFC7",
                "created": 1760998921,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1186,
                "out_toks": 207,
                "id": "chatcmpl-CSxSPahSowp5UmPbHukWX952qs9sD",
                "created": 1761017773,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects with first detection between 2021-03-01 (MJD 59274.0) and 2021-04-01 (MJD 59305.0),\n-- at most one detection, and classified as 'asteroid' by the stamp classifier with probability > 0.7.\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd < 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7\n    AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with first detection between 2021-03-01 (MJD 59274.0) and 2021-04-01 (MJD 59305.0),\n-- at most one detection, and classified as 'asteroid' by the stamp classifier with probability > 0.7.\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd < 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7\n    AND p.ranking = 1;\n```"
                },
                "in_toks": 2553,
                "out_toks": 1688,
                "id": "chatcmpl-CSxlFUgJT7Ud69u1LS8orPS42FQMA",
                "created": 1761018941,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "19",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 664,
                "out_toks": 595,
                "id": "chatcmpl-CSsYVDDUoQp9JlgDlIuRHBq0BMr29",
                "created": 1760998931,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1186,
                "out_toks": 463,
                "id": "chatcmpl-CSxSSrQwA2gcyP4sm2r0V2Kuthe4D",
                "created": 1761017776,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects that first appeared between 2021-03-01 (MJD 59274.0) and 2021-04-01 (MJD 59305.0),\n-- have at most one detection, and are classified as 'asteroid' by the stamp classifier\n-- with probability > 0.7. Ranking = 1 ensures the top stamp classification.\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd <= 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7\n    AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects that first appeared between 2021-03-01 (MJD 59274.0) and 2021-04-01 (MJD 59305.0),\n-- have at most one detection, and are classified as 'asteroid' by the stamp classifier\n-- with probability > 0.7. Ranking = 1 ensures the top stamp classification.\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd <= 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7\n    AND p.ranking = 1;\n```"
                },
                "in_toks": 2553,
                "out_toks": 1894,
                "id": "chatcmpl-CSxlgww2E7rXXn9t5NVVRsKi5mxs8",
                "created": 1761018968,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "19",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "step"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'step']"
                },
                "in_toks": 664,
                "out_toks": 1494,
                "id": "chatcmpl-CSsYdRGWZLZlNt60xOhFEsgJsihte",
                "created": 1760998939,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1258,
                "out_toks": 527,
                "id": "chatcmpl-CSxSXeFdJXuBZxjLIikId0cId49Cb",
                "created": 1761017781,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects with first detection between 2021-03-01 and 2021-04-01 (MJD in [59274.0, 59305.0))\n-- At most one detection (ndet <= 1)\n-- Classified as 'asteroid' by the stamp classifier with probability > 0.7 and top-ranked (ranking = 1)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd < 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7\n    AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with first detection between 2021-03-01 and 2021-04-01 (MJD in [59274.0, 59305.0))\n-- At most one detection (ndet <= 1)\n-- Classified as 'asteroid' by the stamp classifier with probability > 0.7 and top-ranked (ranking = 1)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd < 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7\n    AND p.ranking = 1;\n```"
                },
                "in_toks": 2625,
                "out_toks": 1700,
                "id": "chatcmpl-CSxlyXYiC1eXRLm1DwmTv56tq0a8W",
                "created": 1761018986,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "19",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 664,
                "out_toks": 723,
                "id": "chatcmpl-CZMJpZFY2zMkPT2ZfDhln49J17LAR",
                "created": 1762543309,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1186,
                "out_toks": 271,
                "id": "chatcmpl-CZYGO6R3dL76XZW7TwYcYIvOGankN",
                "created": 1762589224,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects first detected between 2021-03-01 (MJD 59274.0) and 2021-04-01 (MJD 59305.0),\n-- with at most one detection, classified as 'asteroid' by the stamp classifier\n-- with probability > 0.7. Ranking=1 ensures the top class per classifier version.\n-- DISTINCT ON returns one row per object (highest probability if multiple versions exist).\nSELECT DISTINCT ON (o.oid)\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd BETWEEN 59274.0 AND 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.ranking = 1\n    AND p.probability > 0.7\nORDER BY o.oid, p.probability DESC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects first detected between 2021-03-01 (MJD 59274.0) and 2021-04-01 (MJD 59305.0),\n-- with at most one detection, classified as 'asteroid' by the stamp classifier\n-- with probability > 0.7. Ranking=1 ensures the top class per classifier version.\n-- DISTINCT ON returns one row per object (highest probability if multiple versions exist).\nSELECT DISTINCT ON (o.oid)\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd BETWEEN 59274.0 AND 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.ranking = 1\n    AND p.probability > 0.7\nORDER BY o.oid, p.probability DESC;\n```"
                },
                "in_toks": 2553,
                "out_toks": 2879,
                "id": "chatcmpl-CZZiCqbcn5irBVwjXOuBXoOAJMZWH",
                "created": 1762594792,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "19",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 664,
                "out_toks": 723,
                "id": "chatcmpl-CZMK6Jcdttnt8fW4tUZgksQL66rip",
                "created": 1762543326,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1186,
                "out_toks": 207,
                "id": "chatcmpl-CZYGTZ5QnVN9oc8LkT61tck0bIha8",
                "created": 1762589229,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects that first appeared between 2021-03-01 and 2021-04-01 (MJD in [59274.0, 59305.0) ),\n-- have at most one detection, and are classified as 'asteroid' by the stamp classifier\n-- with probability > 0.7. Returns requested columns only.\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd < 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7\n    AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects that first appeared between 2021-03-01 and 2021-04-01 (MJD in [59274.0, 59305.0) ),\n-- have at most one detection, and are classified as 'asteroid' by the stamp classifier\n-- with probability > 0.7. Returns requested columns only.\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd < 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7\n    AND p.ranking = 1;\n```"
                },
                "in_toks": 2553,
                "out_toks": 1824,
                "id": "chatcmpl-CZZvpTn60aVymvqz6RlazAFyD2LcX",
                "created": 1762595637,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "19",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "step"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'step']"
                },
                "in_toks": 664,
                "out_toks": 1110,
                "id": "chatcmpl-CZMKPvUaAgoYyWcjhaEwzS4HEq3iL",
                "created": 1762543345,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1258,
                "out_toks": 207,
                "id": "chatcmpl-CZYGXFO4GpmyACadRXTUza1ojPGBf",
                "created": 1762589233,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects with first detection in March 2021 (MJD in [59274.0, 59305.0))\n-- At most one detection (ndet <= 1)\n-- Classified as 'asteroid' by the stamp classifier with probability > 0.7\n-- Returns: oid, meanra, meandec, ndet, firstmjd, class_name, probability\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd < 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7\n    AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with first detection in March 2021 (MJD in [59274.0, 59305.0))\n-- At most one detection (ndet <= 1)\n-- Classified as 'asteroid' by the stamp classifier with probability > 0.7\n-- Returns: oid, meanra, meandec, ndet, firstmjd, class_name, probability\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd < 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7\n    AND p.ranking = 1;\n```"
                },
                "in_toks": 2625,
                "out_toks": 2089,
                "id": "chatcmpl-CZZlJ3KGwGydZi3jP71NTcca3X5SA",
                "created": 1762594985,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "19",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 664,
                "out_toks": 1363,
                "id": "chatcmpl-CZMKqVzpcMhrGkLVakqO8FpUEBDTB",
                "created": 1762543372,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1186,
                "out_toks": 271,
                "id": "chatcmpl-CZYGdVSccx6P1fAyjSRE4n0ewb9L2",
                "created": 1762589239,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects first detected between 2021-03-01 (MJD 59274.0) and 2021-04-01 (MJD 59305.0)\n-- Half-open interval [59274.0, 59305.0)\n-- At most one detection (ndet <= 1)\n-- Classified as 'asteroid' by the stamp_classifier with probability > 0.7\n-- Keep only the most likely class per classifier/version (ranking = 1)\nSELECT\n  o.oid,\n  o.meanra,\n  o.meandec,\n  o.ndet,\n  o.firstmjd,\n  p.class_name,\n  p.probability\nFROM object AS o\nINNER JOIN probability AS p\n  ON p.oid = o.oid\nWHERE\n  o.firstmjd >= 59274.0\n  AND o.firstmjd < 59305.0\n  AND o.ndet <= 1\n  AND p.classifier_name = 'stamp_classifier'\n  AND p.class_name = 'asteroid'\n  AND p.probability > 0.7\n  AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects first detected between 2021-03-01 (MJD 59274.0) and 2021-04-01 (MJD 59305.0)\n-- Half-open interval [59274.0, 59305.0)\n-- At most one detection (ndet <= 1)\n-- Classified as 'asteroid' by the stamp_classifier with probability > 0.7\n-- Keep only the most likely class per classifier/version (ranking = 1)\nSELECT\n  o.oid,\n  o.meanra,\n  o.meandec,\n  o.ndet,\n  o.firstmjd,\n  p.class_name,\n  p.probability\nFROM object AS o\nINNER JOIN probability AS p\n  ON p.oid = o.oid\nWHERE\n  o.firstmjd >= 59274.0\n  AND o.firstmjd < 59305.0\n  AND o.ndet <= 1\n  AND p.classifier_name = 'stamp_classifier'\n  AND p.class_name = 'asteroid'\n  AND p.probability > 0.7\n  AND p.ranking = 1;\n```"
                },
                "in_toks": 2553,
                "out_toks": 2301,
                "id": "chatcmpl-CZZwa0rszOdPa3kfagY3M57i2Fzmj",
                "created": 1762595684,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "19",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 664,
                "out_toks": 1043,
                "id": "chatcmpl-CZMLIEiBdh7Ie53XQIdEvgJRr4LCL",
                "created": 1762543400,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimize by filtering each table separately, then joining small result sets\n-- - Restrict objects by firstmjd window and ndet <= 1\n-- - Restrict probabilities to the stamp classifier, asteroid class, prob > 0.7, and ranking = 1\n-- - Use DISTINCT ON to keep a single probability row per oid (highest prob if multiple versions exist)\nWITH obj AS\n  (SELECT oid,\n          meanra,\n          meandec,\n          ndet,\n          firstmjd\n   FROM OBJECT\n   WHERE firstmjd >= 59274.0 -- 2021-03-01\n\n     AND firstmjd < 59305.0 -- 2021-04-01 (exclusive)\n\n     AND ndet <= 1),\n     prob AS\n  (SELECT DISTINCT ON (oid) oid,\n                      class_name,\n                      probability\n   FROM probability\n   WHERE classifier_name = 'stamp_classifier'\n     AND class_name = 'asteroid'\n     AND probability > 0.7\n     AND ranking = 1\n   ORDER BY oid,\n            probability DESC)\nSELECT o.oid,\n       o.meanra,\n       o.meandec,\n       o.ndet,\n       o.firstmjd,\n       p.class_name,\n       p.probability\nFROM obj AS o\nJOIN prob AS p USING (oid);",
            "sql_response": {
                "responses": {
                    "0": "-- Optimize by filtering each table separately, then joining small result sets\n-- - Restrict objects by firstmjd window and ndet <= 1\n-- - Restrict probabilities to the stamp classifier, asteroid class, prob > 0.7, and ranking = 1\n-- - Use DISTINCT ON to keep a single probability row per oid (highest prob if multiple versions exist)\nWITH obj AS\n  (SELECT oid,\n          meanra,\n          meandec,\n          ndet,\n          firstmjd\n   FROM OBJECT\n   WHERE firstmjd >= 59274.0 -- 2021-03-01\n\n     AND firstmjd < 59305.0 -- 2021-04-01 (exclusive)\n\n     AND ndet <= 1),\n     prob AS\n  (SELECT DISTINCT ON (oid) oid,\n                      class_name,\n                      probability\n   FROM probability\n   WHERE classifier_name = 'stamp_classifier'\n     AND class_name = 'asteroid'\n     AND probability > 0.7\n     AND ranking = 1\n   ORDER BY oid,\n            probability DESC)\nSELECT o.oid,\n       o.meanra,\n       o.meandec,\n       o.ndet,\n       o.firstmjd,\n       p.class_name,\n       p.probability\nFROM obj AS o\nJOIN prob AS p USING (oid);"
                },
                "in_toks": 1592,
                "out_toks": 1448,
                "id": "chatcmpl-CbGyaNBwCbggUixRDhGl852wjxXnS",
                "created": 1762999428,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1186,
                "out_toks": 271,
                "id": "chatcmpl-CZYGidaaqSIz1ipZMrXL3tmPEPpmx",
                "created": 1762589244,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects with first detection between 2021-03-01 (MJD 59274.0) and 2021-04-01 (MJD 59305.0),\n-- with at most one detection, and classified as 'asteroid' by the stamp classifier\n-- with probability > 0.7. Return requested columns.\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd < 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with first detection between 2021-03-01 (MJD 59274.0) and 2021-04-01 (MJD 59305.0),\n-- with at most one detection, and classified as 'asteroid' by the stamp classifier\n-- with probability > 0.7. Return requested columns.\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    p.class_name,\n    p.probability\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 59274.0\n    AND o.firstmjd < 59305.0\n    AND o.ndet <= 1\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.7;\n```"
                },
                "in_toks": 2553,
                "out_toks": 2198,
                "id": "chatcmpl-CZZlTUsRjUaPiTrMyENYcKIS9KhD7",
                "created": 1762594995,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        }
    },
    "14": {
        "0": {
            "req_id": "14",
            "experiment_id": "run_0",
            "pred_tables": [
                "detection",
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'ps1_ztf']",
                    "1": "['detection', 'ps1_ztf', 'probability']"
                },
                "in_toks": 783,
                "out_toks": 2924,
                "id": "chatcmpl-CSnSaxZCD2j4aOmq1qw2AHRbFOJ9t",
                "created": 1760979344,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1895,
                "out_toks": 783,
                "id": "chatcmpl-CSniEOjCwgYB7CgAf618snHVhbkxQ",
                "created": 1760980314,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and scope\n- Return per-detection rows (not just per-object) for a specific list of object identifiers (oids).\n- Output columns:\n  - detection.oid (unique object identifier)\n  - detection.candid (candidate identifier)\n  - detection.fid (filter identifier, 1=g, 2=r, 3=i)\n  - detection.mjd (modified julian date)\n  - detection.magpsf (magnitude; PSF difference magnitude)\n  - detection.sigmapsf (magnitude error; PSF difference magnitude error)\n  - detection.has_stamp (whether the candidate has an associated image stamp)\n  - detection.drb (deep learning real-bogus score)\n  - ps1_ztf.sgscore1 (star/galaxy score of the nearest PS1 source)\n  - ps1_ztf.distpsnr1 (distance to nearest PS1 source; arcseconds)\n- Filters to apply:\n  - detection.drb > 0.5\n  - AND (ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1)\n- Limit the search to the provided list of oids only.\n- No probability or classifier tables are needed for this query.\n- No spatial (Q3C) operations are needed.\n\n2) Identify the relevant tables and columns\n- detection table (indexed by oid):\n  - Required columns: oid, candid, fid, mjd, magpsf, sigmapsf, has_stamp, drb\n  - Additional join keys: oid, candid\n- ps1_ztf table:\n  - Required columns: oid, candid, sgscore1, distpsnr1\n  - Join keys: (oid, candid) \u2014 primary key in ps1_ztf is (oid, candid)\n- No other tables are required.\n\n3) Define the input filter for the object list\n- Explicitly filter detection rows by the given list of oids using WHERE detection.oid IN (...)\n- OID list (exact strings, single quoted):\n  - 'ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni', 'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi', 'ZTF22aawasao', 'ZTF23aaxgvnt'\n- This leverages the hash index on detection.oid and limits the detection set before applying other filters (important because the guidance recommends avoiding heavy filters on detection beyond oid).\n\n4) Build a base subquery for detection to minimize filtering on detection\n- Create a subquery (or CTE) that:\n  - Selects only from detection\n  - Applies only the oid IN (...) filter (to respect the guideline of avoiding filters on detection other than oid as much as possible)\n  - Projects the columns needed later (oid, candid, fid, mjd, magpsf, sigmapsf, has_stamp, drb)\n\n5) Join with ps1_ztf to add Pan-STARRS nearest-source features\n- Perform an INNER JOIN between the detection subquery and ps1_ztf using:\n  - detection_subquery.oid = ps1_ztf.oid\n  - detection_subquery.candid = ps1_ztf.candid\n- INNER JOIN ensures that only detections with PS1 crossmatch information are returned, which is necessary to evaluate sgscore1 and distpsnr1.\n\n6) Apply the scientific filters on the joined result\n- Apply:\n  - drb > 0.5\n  - AND (sgscore1 < 0.5 OR distpsnr1 < 1)\n- Null handling:\n  - The comparisons sgscore1 < 0.5 and distpsnr1 < 1 naturally evaluate to false if the respective value is NULL, so no special handling is necessary unless you want to include NULLs explicitly (not requested).\n\n7) Select the final columns for output\n- From the joined dataset, project exactly the requested fields:\n  - detection.oid\n  - detection.candid\n  - detection.fid\n  - detection.mjd\n  - detection.magpsf as the \u201cmagnitude\u201d\n  - detection.sigmapsf as the \u201cmagnitude error\u201d\n  - detection.has_stamp\n  - detection.drb\n  - ps1_ztf.sgscore1\n  - ps1_ztf.distpsnr1\n- Note: If the user intended apparent (corrected) magnitudes, substitute magpsf with magpsf_corr and sigmapsf with sigmapsf_corr; however, since not specified, default to magpsf and sigmapsf as per the detection schema descriptions.\n\n8) Optional ordering or limiting\n- The user did not specify an order; you can omit ORDER BY. If deterministic ordering is needed, consider ORDER BY detection.oid, detection.mjd or detection.candid.\n\n9) Performance considerations and constraints compliance\n- Using the detection.oid IN (...) predicate first leverages ix_ndetection_oid and keeps compliance with the recommendation to avoid heavy non-oid filters on detection.\n- Joining on (oid, candid) aligns with ps1_ztf\u2019s primary key, ensuring efficient join performance.\n- Applying the drb and PS1 filters after restricting by oids prevents scanning unnecessary detection rows.\n\n10) Validation checklist\n- Verify all table and column names exactly match the schema:\n  - detection: oid, candid, fid, mjd, magpsf, sigmapsf, has_stamp, drb\n  - ps1_ztf: oid, candid, sgscore1, distpsnr1\n- Confirm that distpsnr1 is interpreted in arcseconds (as per schema notes).\n- Ensure the OID strings are correctly quoted and separated by commas in the IN list.\n- No use of probability or classifier tables is needed for this task.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and scope\n- Return per-detection rows (not just per-object) for a specific list of object identifiers (oids).\n- Output columns:\n  - detection.oid (unique object identifier)\n  - detection.candid (candidate identifier)\n  - detection.fid (filter identifier, 1=g, 2=r, 3=i)\n  - detection.mjd (modified julian date)\n  - detection.magpsf (magnitude; PSF difference magnitude)\n  - detection.sigmapsf (magnitude error; PSF difference magnitude error)\n  - detection.has_stamp (whether the candidate has an associated image stamp)\n  - detection.drb (deep learning real-bogus score)\n  - ps1_ztf.sgscore1 (star/galaxy score of the nearest PS1 source)\n  - ps1_ztf.distpsnr1 (distance to nearest PS1 source; arcseconds)\n- Filters to apply:\n  - detection.drb > 0.5\n  - AND (ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1)\n- Limit the search to the provided list of oids only.\n- No probability or classifier tables are needed for this query.\n- No spatial (Q3C) operations are needed.\n\n2) Identify the relevant tables and columns\n- detection table (indexed by oid):\n  - Required columns: oid, candid, fid, mjd, magpsf, sigmapsf, has_stamp, drb\n  - Additional join keys: oid, candid\n- ps1_ztf table:\n  - Required columns: oid, candid, sgscore1, distpsnr1\n  - Join keys: (oid, candid) \u2014 primary key in ps1_ztf is (oid, candid)\n- No other tables are required.\n\n3) Define the input filter for the object list\n- Explicitly filter detection rows by the given list of oids using WHERE detection.oid IN (...)\n- OID list (exact strings, single quoted):\n  - 'ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni', 'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi', 'ZTF22aawasao', 'ZTF23aaxgvnt'\n- This leverages the hash index on detection.oid and limits the detection set before applying other filters (important because the guidance recommends avoiding heavy filters on detection beyond oid).\n\n4) Build a base subquery for detection to minimize filtering on detection\n- Create a subquery (or CTE) that:\n  - Selects only from detection\n  - Applies only the oid IN (...) filter (to respect the guideline of avoiding filters on detection other than oid as much as possible)\n  - Projects the columns needed later (oid, candid, fid, mjd, magpsf, sigmapsf, has_stamp, drb)\n\n5) Join with ps1_ztf to add Pan-STARRS nearest-source features\n- Perform an INNER JOIN between the detection subquery and ps1_ztf using:\n  - detection_subquery.oid = ps1_ztf.oid\n  - detection_subquery.candid = ps1_ztf.candid\n- INNER JOIN ensures that only detections with PS1 crossmatch information are returned, which is necessary to evaluate sgscore1 and distpsnr1.\n\n6) Apply the scientific filters on the joined result\n- Apply:\n  - drb > 0.5\n  - AND (sgscore1 < 0.5 OR distpsnr1 < 1)\n- Null handling:\n  - The comparisons sgscore1 < 0.5 and distpsnr1 < 1 naturally evaluate to false if the respective value is NULL, so no special handling is necessary unless you want to include NULLs explicitly (not requested).\n\n7) Select the final columns for output\n- From the joined dataset, project exactly the requested fields:\n  - detection.oid\n  - detection.candid\n  - detection.fid\n  - detection.mjd\n  - detection.magpsf as the \u201cmagnitude\u201d\n  - detection.sigmapsf as the \u201cmagnitude error\u201d\n  - detection.has_stamp\n  - detection.drb\n  - ps1_ztf.sgscore1\n  - ps1_ztf.distpsnr1\n- Note: If the user intended apparent (corrected) magnitudes, substitute magpsf with magpsf_corr and sigmapsf with sigmapsf_corr; however, since not specified, default to magpsf and sigmapsf as per the detection schema descriptions.\n\n8) Optional ordering or limiting\n- The user did not specify an order; you can omit ORDER BY. If deterministic ordering is needed, consider ORDER BY detection.oid, detection.mjd or detection.candid.\n\n9) Performance considerations and constraints compliance\n- Using the detection.oid IN (...) predicate first leverages ix_ndetection_oid and keeps compliance with the recommendation to avoid heavy non-oid filters on detection.\n- Joining on (oid, candid) aligns with ps1_ztf\u2019s primary key, ensuring efficient join performance.\n- Applying the drb and PS1 filters after restricting by oids prevents scanning unnecessary detection rows.\n\n10) Validation checklist\n- Verify all table and column names exactly match the schema:\n  - detection: oid, candid, fid, mjd, magpsf, sigmapsf, has_stamp, drb\n  - ps1_ztf: oid, candid, sgscore1, distpsnr1\n- Confirm that distpsnr1 is interpreted in arcseconds (as per schema notes).\n- Ensure the OID strings are correctly quoted and separated by commas in the IN list.\n- No use of probability or classifier tables is needed for this task."
                },
                "in_toks": 3503,
                "out_toks": 3059,
                "id": "chatcmpl-CSqt4JkDAFrlopOPc5h3UZV1df8Ax",
                "created": 1760992518,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return per-detection rows for the given oids with ZTF DRB and Pan-STARRS nearest-source features\n-- Filters:\n--   - det.drb > 0.5\n--   - ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1 (arcsec)\nWITH det AS (\n    SELECT\n        oid,\n        candid,\n        fid,\n        mjd,\n        magpsf,\n        sigmapsf,\n        has_stamp,\n        drb\n    FROM detection\n    WHERE oid IN (\n        'ZTF23aavzgjg',\n        'ZTF23aaynzyk',\n        'ZTF23aavqxos',\n        'ZTF23aaknyni',\n        'ZTF23aavsdtc',\n        'ZTF18aandkua',\n        'ZTF23aaxfewt',\n        'ZTF23aavshwi',\n        'ZTF22aawasao',\n        'ZTF23aaxgvnt'\n    )\n)\nSELECT\n    det.oid,\n    det.candid,\n    det.fid,\n    det.mjd,\n    det.magpsf,\n    det.sigmapsf,\n    det.has_stamp,\n    det.drb,\n    ps1_ztf.sgscore1,\n    ps1_ztf.distpsnr1\nFROM det\nINNER JOIN ps1_ztf\n    ON ps1_ztf.oid = det.oid\n   AND ps1_ztf.candid = det.candid\nWHERE det.drb > 0.5\n  AND (ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return per-detection rows for the given oids with ZTF DRB and Pan-STARRS nearest-source features\n-- Filters:\n--   - det.drb > 0.5\n--   - ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1 (arcsec)\nWITH det AS (\n    SELECT\n        oid,\n        candid,\n        fid,\n        mjd,\n        magpsf,\n        sigmapsf,\n        has_stamp,\n        drb\n    FROM detection\n    WHERE oid IN (\n        'ZTF23aavzgjg',\n        'ZTF23aaynzyk',\n        'ZTF23aavqxos',\n        'ZTF23aaknyni',\n        'ZTF23aavsdtc',\n        'ZTF18aandkua',\n        'ZTF23aaxfewt',\n        'ZTF23aavshwi',\n        'ZTF22aawasao',\n        'ZTF23aaxgvnt'\n    )\n)\nSELECT\n    det.oid,\n    det.candid,\n    det.fid,\n    det.mjd,\n    det.magpsf,\n    det.sigmapsf,\n    det.has_stamp,\n    det.drb,\n    ps1_ztf.sgscore1,\n    ps1_ztf.distpsnr1\nFROM det\nINNER JOIN ps1_ztf\n    ON ps1_ztf.oid = det.oid\n   AND ps1_ztf.candid = det.candid\nWHERE det.drb > 0.5\n  AND (ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1);\n```"
                },
                "in_toks": 3446,
                "out_toks": 1465,
                "id": "chatcmpl-CSr6qLbekUv6aI2SvhbSs6JDaFUPm",
                "created": 1760993372,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "14",
            "experiment_id": "run_1",
            "pred_tables": [
                "detection",
                "ps1_ztf",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'ps1_ztf']",
                    "1": "['detection', 'ps1_ztf', 'probability']"
                },
                "in_toks": 783,
                "out_toks": 2924,
                "id": "chatcmpl-CSnSaxZCD2j4aOmq1qw2AHRbFOJ9t",
                "created": 1760979344,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 2080,
                "out_toks": 591,
                "id": "chatcmpl-CSniRx6u6hZMxMbeiRTRhpzofSeDf",
                "created": 1760980327,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Map the user request to concrete tables and columns\n- Source tables:\n  - detection: contains object detections and required photometry/quality fields.\n  - ps1_ztf: contains Pan-STARRS crossmatch information per (oid, candid).\n- Required output fields and their columns:\n  - unique object identifier \u2192 detection.oid\n  - candidate identifier \u2192 detection.candid\n  - filter identifier \u2192 detection.fid\n  - modified julian date \u2192 detection.mjd\n  - magnitude \u2192 detection.magpsf (PSF difference magnitude; use this unless \u201ccorrected\u201d magnitude is explicitly requested, in which case replace with detection.magpsf_corr)\n  - magnitude error \u2192 detection.sigmapsf (use detection.sigmapsf_corr if using corrected magnitude)\n  - whether the object has stamps \u2192 detection.has_stamp\n  - deep learning real-bogus score \u2192 detection.drb\n  - star-galaxy score of the nearest PS1 object \u2192 ps1_ztf.sgscore1\n  - distance to the nearest PS1 source (arcsec) \u2192 ps1_ztf.distpsnr1\n\n2) Define the input object list\n- Target OIDs to include: ['ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni', 'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi', 'ZTF22aawasao', 'ZTF23aaxgvnt'].\n- Use either:\n  - A WHERE IN filter on detection.oid, or\n  - A small inline CTE listing the OIDs (WITH oids(oid) AS (VALUES (...))) and inner join detection to this CTE on oid, which can help constrain the detection table early.\n\n3) Build the base dataset from detection\n- Start from detection (alias d).\n- Filter by the provided OID list:\n  - d.oid IN (<list>) or via an INNER JOIN to the OID CTE.\n- Rationale: detection has an index on oid (ix_ndetection_oid), so this filter is efficient.\n\n4) Join to PS1 crossmatch table\n- Perform an INNER JOIN from detection to ps1_ztf (alias p) on both:\n  - d.oid = p.oid\n  - d.candid = p.candid\n- Rationale: ps1_ztf has PRIMARY KEY (oid, candid), so this join is selective and ensures you get the PS1 fields (sgscore1, distpsnr1) for the same alert/detection.\n\n5) Apply the filtering conditions\n- Deep learning real-bogus threshold:\n  - d.drb > 0.5\n- PS1-based condition (logical OR):\n  - (p.sgscore1 < 0.5 OR p.distpsnr1 < 1)\n- Note:\n  - distpsnr1 is in arcseconds (as required).\n  - Using INNER JOIN naturally excludes detections without PS1 matches; this is appropriate because the filter depends on PS1 fields.\n\n6) Select the requested columns\n- Include exactly the fields requested:\n  - d.oid\n  - d.candid\n  - d.fid\n  - d.mjd\n  - d.magpsf AS magnitude (or substitute d.magpsf_corr if \u201ccorrected\u201d is desired)\n  - d.sigmapsf AS magnitude_error (or d.sigmapsf_corr if using corrected magnitude)\n  - d.has_stamp\n  - d.drb\n  - p.sgscore1\n  - p.distpsnr1\n- No need for SELECT * since the user specified the fields.\n\n7) Optional ordering for readability (not required)\n- ORDER BY d.oid, d.mjd ASC (or by d.candid if per-candidate grouping is preferred).\n\n8) Notes on defaults and non-applicable context\n- The probability table and its default filters (ranking = 1 and classifier_name = 'lc_classifier') are not needed here; do not include it.\n- No spatial filtering is requested; Q3C functions are not applicable.\n- The detection table guidance about avoiding filters other than oid is for performance; here, filtering on d.drb is necessary per the user\u2019s criteria and acceptable, especially after constraining by oid.\n\n9) Validation checklist\n- Ensure the OID list is quoted exactly as provided (e.g., 'ZTF23aavzgjg').\n- Verify that joins are exactly on (oid, candid) to get the correct PS1 match for each detection.\n- Confirm magnitude choice (magpsf vs magpsf_corr) matches user expectations; use magpsf by default since \u201ccorrected\u201d wasn\u2019t requested.\n- Be aware that NULL values in d.drb, p.sgscore1, or p.distpsnr1 will naturally exclude rows due to the filter conditions, which is consistent with the request.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Map the user request to concrete tables and columns\n- Source tables:\n  - detection: contains object detections and required photometry/quality fields.\n  - ps1_ztf: contains Pan-STARRS crossmatch information per (oid, candid).\n- Required output fields and their columns:\n  - unique object identifier \u2192 detection.oid\n  - candidate identifier \u2192 detection.candid\n  - filter identifier \u2192 detection.fid\n  - modified julian date \u2192 detection.mjd\n  - magnitude \u2192 detection.magpsf (PSF difference magnitude; use this unless \u201ccorrected\u201d magnitude is explicitly requested, in which case replace with detection.magpsf_corr)\n  - magnitude error \u2192 detection.sigmapsf (use detection.sigmapsf_corr if using corrected magnitude)\n  - whether the object has stamps \u2192 detection.has_stamp\n  - deep learning real-bogus score \u2192 detection.drb\n  - star-galaxy score of the nearest PS1 object \u2192 ps1_ztf.sgscore1\n  - distance to the nearest PS1 source (arcsec) \u2192 ps1_ztf.distpsnr1\n\n2) Define the input object list\n- Target OIDs to include: ['ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni', 'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi', 'ZTF22aawasao', 'ZTF23aaxgvnt'].\n- Use either:\n  - A WHERE IN filter on detection.oid, or\n  - A small inline CTE listing the OIDs (WITH oids(oid) AS (VALUES (...))) and inner join detection to this CTE on oid, which can help constrain the detection table early.\n\n3) Build the base dataset from detection\n- Start from detection (alias d).\n- Filter by the provided OID list:\n  - d.oid IN (<list>) or via an INNER JOIN to the OID CTE.\n- Rationale: detection has an index on oid (ix_ndetection_oid), so this filter is efficient.\n\n4) Join to PS1 crossmatch table\n- Perform an INNER JOIN from detection to ps1_ztf (alias p) on both:\n  - d.oid = p.oid\n  - d.candid = p.candid\n- Rationale: ps1_ztf has PRIMARY KEY (oid, candid), so this join is selective and ensures you get the PS1 fields (sgscore1, distpsnr1) for the same alert/detection.\n\n5) Apply the filtering conditions\n- Deep learning real-bogus threshold:\n  - d.drb > 0.5\n- PS1-based condition (logical OR):\n  - (p.sgscore1 < 0.5 OR p.distpsnr1 < 1)\n- Note:\n  - distpsnr1 is in arcseconds (as required).\n  - Using INNER JOIN naturally excludes detections without PS1 matches; this is appropriate because the filter depends on PS1 fields.\n\n6) Select the requested columns\n- Include exactly the fields requested:\n  - d.oid\n  - d.candid\n  - d.fid\n  - d.mjd\n  - d.magpsf AS magnitude (or substitute d.magpsf_corr if \u201ccorrected\u201d is desired)\n  - d.sigmapsf AS magnitude_error (or d.sigmapsf_corr if using corrected magnitude)\n  - d.has_stamp\n  - d.drb\n  - p.sgscore1\n  - p.distpsnr1\n- No need for SELECT * since the user specified the fields.\n\n7) Optional ordering for readability (not required)\n- ORDER BY d.oid, d.mjd ASC (or by d.candid if per-candidate grouping is preferred).\n\n8) Notes on defaults and non-applicable context\n- The probability table and its default filters (ranking = 1 and classifier_name = 'lc_classifier') are not needed here; do not include it.\n- No spatial filtering is requested; Q3C functions are not applicable.\n- The detection table guidance about avoiding filters other than oid is for performance; here, filtering on d.drb is necessary per the user\u2019s criteria and acceptable, especially after constraining by oid.\n\n9) Validation checklist\n- Ensure the OID list is quoted exactly as provided (e.g., 'ZTF23aavzgjg').\n- Verify that joins are exactly on (oid, candid) to get the correct PS1 match for each detection.\n- Confirm magnitude choice (magpsf vs magpsf_corr) matches user expectations; use magpsf by default since \u201ccorrected\u201d wasn\u2019t requested.\n- Be aware that NULL values in d.drb, p.sgscore1, or p.distpsnr1 will naturally exclude rows due to the filter conditions, which is consistent with the request."
                },
                "in_toks": 3687,
                "out_toks": 3108,
                "id": "chatcmpl-CSqt6nTr13TiNOdJTQRy7b20KdghH",
                "created": 1760992520,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return detections for given OIDs with DRB > 0.5 and (PS1 sgscore1 < 0.5 OR distpsnr1 < 1 arcsec)\nWITH oids(oid) AS (\n    VALUES\n        ('ZTF23aavzgjg'),\n        ('ZTF23aaynzyk'),\n        ('ZTF23aavqxos'),\n        ('ZTF23aaknyni'),\n        ('ZTF23aavsdtc'),\n        ('ZTF18aandkua'),\n        ('ZTF23aaxfewt'),\n        ('ZTF23aavshwi'),\n        ('ZTF22aawasao'),\n        ('ZTF23aaxgvnt')\n)\nSELECT\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd,\n    d.magpsf,\n    d.sigmapsf,\n    d.has_stamp,\n    d.drb,\n    p.sgscore1,\n    p.distpsnr1\nFROM detection AS d\nINNER JOIN oids AS o\n    ON d.oid = o.oid\nINNER JOIN ps1_ztf AS p\n    ON p.oid = d.oid\n   AND p.candid = d.candid\nWHERE d.drb > 0.5\n  AND (p.sgscore1 < 0.5 OR p.distpsnr1 < 1)\nORDER BY d.oid, d.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return detections for given OIDs with DRB > 0.5 and (PS1 sgscore1 < 0.5 OR distpsnr1 < 1 arcsec)\nWITH oids(oid) AS (\n    VALUES\n        ('ZTF23aavzgjg'),\n        ('ZTF23aaynzyk'),\n        ('ZTF23aavqxos'),\n        ('ZTF23aaknyni'),\n        ('ZTF23aavsdtc'),\n        ('ZTF18aandkua'),\n        ('ZTF23aaxfewt'),\n        ('ZTF23aavshwi'),\n        ('ZTF22aawasao'),\n        ('ZTF23aaxgvnt')\n)\nSELECT\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd,\n    d.magpsf,\n    d.sigmapsf,\n    d.has_stamp,\n    d.drb,\n    p.sgscore1,\n    p.distpsnr1\nFROM detection AS d\nINNER JOIN oids AS o\n    ON d.oid = o.oid\nINNER JOIN ps1_ztf AS p\n    ON p.oid = d.oid\n   AND p.candid = d.candid\nWHERE d.drb > 0.5\n  AND (p.sgscore1 < 0.5 OR p.distpsnr1 < 1)\nORDER BY d.oid, d.mjd;\n```"
                },
                "in_toks": 3239,
                "out_toks": 1336,
                "id": "chatcmpl-CSr6xwsye5yMx6SA86snE9wlzXq0p",
                "created": 1760993379,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "14",
            "experiment_id": "run_2",
            "pred_tables": [
                "detection",
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'ps1_ztf']"
                },
                "in_toks": 783,
                "out_toks": 1236,
                "id": "chatcmpl-CSsYvwY3sjE0eRk4ljRbkXJR7AYFx",
                "created": 1760998957,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1895,
                "out_toks": 655,
                "id": "chatcmpl-CSxSd9uiBqzRdDvCMu7keTBzEhwiM",
                "created": 1761017787,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Map requested outputs to table/column names\n- Unique object identifier \u2192 detection.oid\n- Candidate identifier \u2192 detection.candid\n- Filter identifier \u2192 detection.fid (1=g; 2=r; 3=i)\n- Modified Julian Date \u2192 detection.mjd\n- Magnitude \u2192 detection.magpsf (PSF difference magnitude; always present)\n- Magnitude error \u2192 detection.sigmapsf\n- Whether the object has stamps \u2192 detection.has_stamp\n- Deep learning real-bogus score \u2192 detection.drb\n- Star/galaxy score of the nearest PS1 object \u2192 ps1_ztf.sgscore1\n- Distance to the nearest PS1 source \u2192 ps1_ztf.distpsnr1 (in arcseconds)\n\n2) Input OID list handling\n- Define the provided OIDs inline so the planner can prune detection early. Use a small CTE (WITH ... VALUES) named oids(oid) containing:\n  - 'ZTF23aavzgjg'\n  - 'ZTF23aaynzyk'\n  - 'ZTF23aavqxos'\n  - 'ZTF23aaknyni'\n  - 'ZTF23aavsdtc'\n  - 'ZTF18aandkua'\n  - 'ZTF23aaxfewt'\n  - 'ZTF23aavshwi'\n  - 'ZTF22aawasao'\n  - 'ZTF23aaxgvnt'\n\n3) Base table selection and early restriction\n- Start from detection (alias d), which contains the time-resolved measurements and all requested per-candidate fields.\n- INNER JOIN oids CTE to detection on d.oid = oids.oid to restrict by object identifier first. This leverages the detection.oid hash index and respects the \u201cavoid filters on detection other than oid\u201d guidance by applying the most selective condition first.\n\n4) Join to Pan-STARRS crossmatch table for nearest-object info\n- INNER JOIN ps1_ztf (alias p) to detection on:\n  - p.oid = d.oid\n  - p.candid = d.candid\n- Rationale: ps1_ztf rows are keyed per (oid, candid). This ensures the nearest-object parameters (sgscore1, distpsnr1) correspond to the same alert candidate as the detection row. The PRIMARY KEY (oid, candid) in ps1_ztf supports an efficient join.\n\n5) Apply required filtering conditions\n- Deep learning real-bogus threshold:\n  - d.drb > 0.5\n- Pan-STARRS nearest-object constraint (logical OR):\n  - p.sgscore1 < 0.5 OR p.distpsnr1 < 1\n- Notes:\n  - distpsnr1 is in arcseconds, so \u201c< 1\u201d matches \u201csmaller than 1 arcsec.\u201d\n  - If either sgscore1 or distpsnr1 is NULL, the OR condition will still pass if the other term is non-NULL and satisfies its threshold.\n\n6) Select the required columns\n- From detection (alias d):\n  - d.oid\n  - d.candid\n  - d.fid\n  - d.mjd\n  - d.magpsf AS magnitude\n  - d.sigmapsf AS magnitude_error\n  - d.has_stamp\n  - d.drb\n- From ps1_ztf (alias p):\n  - p.sgscore1\n  - p.distpsnr1\n- Use explicit table aliases to avoid ambiguity.\n\n7) Optional ordering (not required by the user, but useful)\n- If desired, ORDER BY d.oid, d.mjd to group results per object chronologically.\n\n8) Performance considerations\n- The detection table has an index on oid (ix_ndetection_oid); joining to the oids CTE first ensures early pruning.\n- The ps1_ztf table has a PRIMARY KEY (oid, candid), enabling efficient join on both columns.\n- Keeping filters on detection besides oid to a minimum helps; here, d.drb > 0.5 is necessary but will be applied after the oid restriction because of the join to the oids CTE.\n\n9) Alternatives/clarifications (if needed)\n- If the user intended \u201cmagnitude\u201d and \u201cmagnitude error\u201d to be the corrected apparent values, substitute:\n  - d.magpsf_corr AS magnitude\n  - d.sigmapsf_corr AS magnitude_error\n  - And optionally include d.corrected to indicate correction status.\n- If results should include candidates lacking a ps1_ztf row (not typical here because the filter uses sgscore1/distpsnr1), switch to LEFT JOIN and adapt the WHERE clause to check the OR condition only when values are present. By default, use INNER JOIN to enforce the PS1-based criteria.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Map requested outputs to table/column names\n- Unique object identifier \u2192 detection.oid\n- Candidate identifier \u2192 detection.candid\n- Filter identifier \u2192 detection.fid (1=g; 2=r; 3=i)\n- Modified Julian Date \u2192 detection.mjd\n- Magnitude \u2192 detection.magpsf (PSF difference magnitude; always present)\n- Magnitude error \u2192 detection.sigmapsf\n- Whether the object has stamps \u2192 detection.has_stamp\n- Deep learning real-bogus score \u2192 detection.drb\n- Star/galaxy score of the nearest PS1 object \u2192 ps1_ztf.sgscore1\n- Distance to the nearest PS1 source \u2192 ps1_ztf.distpsnr1 (in arcseconds)\n\n2) Input OID list handling\n- Define the provided OIDs inline so the planner can prune detection early. Use a small CTE (WITH ... VALUES) named oids(oid) containing:\n  - 'ZTF23aavzgjg'\n  - 'ZTF23aaynzyk'\n  - 'ZTF23aavqxos'\n  - 'ZTF23aaknyni'\n  - 'ZTF23aavsdtc'\n  - 'ZTF18aandkua'\n  - 'ZTF23aaxfewt'\n  - 'ZTF23aavshwi'\n  - 'ZTF22aawasao'\n  - 'ZTF23aaxgvnt'\n\n3) Base table selection and early restriction\n- Start from detection (alias d), which contains the time-resolved measurements and all requested per-candidate fields.\n- INNER JOIN oids CTE to detection on d.oid = oids.oid to restrict by object identifier first. This leverages the detection.oid hash index and respects the \u201cavoid filters on detection other than oid\u201d guidance by applying the most selective condition first.\n\n4) Join to Pan-STARRS crossmatch table for nearest-object info\n- INNER JOIN ps1_ztf (alias p) to detection on:\n  - p.oid = d.oid\n  - p.candid = d.candid\n- Rationale: ps1_ztf rows are keyed per (oid, candid). This ensures the nearest-object parameters (sgscore1, distpsnr1) correspond to the same alert candidate as the detection row. The PRIMARY KEY (oid, candid) in ps1_ztf supports an efficient join.\n\n5) Apply required filtering conditions\n- Deep learning real-bogus threshold:\n  - d.drb > 0.5\n- Pan-STARRS nearest-object constraint (logical OR):\n  - p.sgscore1 < 0.5 OR p.distpsnr1 < 1\n- Notes:\n  - distpsnr1 is in arcseconds, so \u201c< 1\u201d matches \u201csmaller than 1 arcsec.\u201d\n  - If either sgscore1 or distpsnr1 is NULL, the OR condition will still pass if the other term is non-NULL and satisfies its threshold.\n\n6) Select the required columns\n- From detection (alias d):\n  - d.oid\n  - d.candid\n  - d.fid\n  - d.mjd\n  - d.magpsf AS magnitude\n  - d.sigmapsf AS magnitude_error\n  - d.has_stamp\n  - d.drb\n- From ps1_ztf (alias p):\n  - p.sgscore1\n  - p.distpsnr1\n- Use explicit table aliases to avoid ambiguity.\n\n7) Optional ordering (not required by the user, but useful)\n- If desired, ORDER BY d.oid, d.mjd to group results per object chronologically.\n\n8) Performance considerations\n- The detection table has an index on oid (ix_ndetection_oid); joining to the oids CTE first ensures early pruning.\n- The ps1_ztf table has a PRIMARY KEY (oid, candid), enabling efficient join on both columns.\n- Keeping filters on detection besides oid to a minimum helps; here, d.drb > 0.5 is necessary but will be applied after the oid restriction because of the join to the oids CTE.\n\n9) Alternatives/clarifications (if needed)\n- If the user intended \u201cmagnitude\u201d and \u201cmagnitude error\u201d to be the corrected apparent values, substitute:\n  - d.magpsf_corr AS magnitude\n  - d.sigmapsf_corr AS magnitude_error\n  - And optionally include d.corrected to indicate correction status.\n- If results should include candidates lacking a ps1_ztf row (not typical here because the filter uses sgscore1/distpsnr1), switch to LEFT JOIN and adapt the WHERE clause to check the OR condition only when values are present. By default, use INNER JOIN to enforce the PS1-based criteria."
                },
                "in_toks": 3503,
                "out_toks": 3832,
                "id": "chatcmpl-CSxmFfcdiP6pCZt1x9ygL1MVafCjC",
                "created": 1761019003,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* Return detections for the given OIDs with DRB > 0.5 and (sgscore1 < 0.5 OR distpsnr1 < 1\") */\nWITH oids(oid) AS (\n  VALUES\n    ('ZTF23aavzgjg'),\n    ('ZTF23aaynzyk'),\n    ('ZTF23aavqxos'),\n    ('ZTF23aaknyni'),\n    ('ZTF23aavsdtc'),\n    ('ZTF18aandkua'),\n    ('ZTF23aaxfewt'),\n    ('ZTF23aavshwi'),\n    ('ZTF22aawasao'),\n    ('ZTF23aaxgvnt')\n)\nSELECT\n  d.oid,\n  d.candid,\n  d.fid,        -- 1=g; 2=r; 3=i\n  d.mjd,\n  d.magpsf,\n  d.sigmapsf,\n  d.has_stamp,\n  d.drb,\n  p.sgscore1,\n  p.distpsnr1\nFROM oids\nINNER JOIN detection AS d\n  ON d.oid = oids.oid\nINNER JOIN ps1_ztf AS p\n  ON p.oid = d.oid\n AND p.candid = d.candid\nWHERE d.drb > 0.5\n  AND (p.sgscore1 < 0.5 OR p.distpsnr1 < 1)\nORDER BY d.oid, d.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* Return detections for the given OIDs with DRB > 0.5 and (sgscore1 < 0.5 OR distpsnr1 < 1\") */\nWITH oids(oid) AS (\n  VALUES\n    ('ZTF23aavzgjg'),\n    ('ZTF23aaynzyk'),\n    ('ZTF23aavqxos'),\n    ('ZTF23aaknyni'),\n    ('ZTF23aavsdtc'),\n    ('ZTF18aandkua'),\n    ('ZTF23aaxfewt'),\n    ('ZTF23aavshwi'),\n    ('ZTF22aawasao'),\n    ('ZTF23aaxgvnt')\n)\nSELECT\n  d.oid,\n  d.candid,\n  d.fid,        -- 1=g; 2=r; 3=i\n  d.mjd,\n  d.magpsf,\n  d.sigmapsf,\n  d.has_stamp,\n  d.drb,\n  p.sgscore1,\n  p.distpsnr1\nFROM oids\nINNER JOIN detection AS d\n  ON d.oid = oids.oid\nINNER JOIN ps1_ztf AS p\n  ON p.oid = d.oid\n AND p.candid = d.candid\nWHERE d.drb > 0.5\n  AND (p.sgscore1 < 0.5 OR p.distpsnr1 < 1)\nORDER BY d.oid, d.mjd;\n```"
                },
                "in_toks": 3195,
                "out_toks": 2114,
                "id": "chatcmpl-CSyRrBb4MujTqq8maoPmgxh6lBbY6",
                "created": 1761021583,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "14",
            "experiment_id": "run_3",
            "pred_tables": [
                "detection",
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'ps1_ztf']"
                },
                "in_toks": 783,
                "out_toks": 1492,
                "id": "chatcmpl-CSsZBjTIgPee8X4aXWmxuCfmkzqtf",
                "created": 1760998973,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1895,
                "out_toks": 527,
                "id": "chatcmpl-CSxSnLpXvBIaCM7n6A9AiMh1YhM9b",
                "created": 1761017797,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\nReturn, for a specific list of object IDs (oids), per-detection rows including:\n- object identifier (oid)\n- candidate identifier (candid)\n- filter identifier (fid)\n- modified julian date (mjd)\n- magnitude and magnitude error\n- whether the candidate has stamps\n- deep learning real-bogus score (drb)\n- PS1 nearest-object star/galaxy score (sgscore1)\n- PS1 distance to nearest source (distpsnr1, in arcsec)\nOnly include rows where drb > 0.5 AND (sgscore1 < 0.5 OR distpsnr1 < 1).\n\nTables and columns to use\n- detection\n  - oid (VARCHAR): unique object identifier\n  - candid (BIGINT): candidate identifier\n  - fid (INTEGER): filter id\n  - mjd (DOUBLE PRECISION): MJD of detection\n  - magpsf (DOUBLE PRECISION): PSF difference magnitude\n  - sigmapsf (DOUBLE PRECISION): PSF difference magnitude error\n  - has_stamp (BOOLEAN): whether the candidate has an associated image stamp\n  - drb (DOUBLE PRECISION): deep learning real-bogus score\n- ps1_ztf\n  - oid (VARCHAR)\n  - candid (BIGINT)\n  - sgscore1 (DOUBLE PRECISION): PS1 star/galaxy score for nearest source\n  - distpsnr1 (DOUBLE PRECISION): PS1 distance to nearest source [arcsec]\n\nImportant constraints and guidance\n- Avoid filtering on detection on any parameter other than oid when scanning the table. Restrict detection first by oid, then apply additional filters in the outer query.\n- Use INNER JOIN between detection and ps1_ztf on (oid, candid) to ensure PS1 features exist for each detection.\n- The user explicitly specified the columns to return, so do not use SELECT *.\n- No spatial constraints are required; Q3C functions are not needed.\n- The probability and object tables are not needed for this request.\n\nStep-by-step plan\n\n1) Define the input list of object identifiers\n- Create a literal list (for a WHERE ... IN (...) clause) with the following oids:\n  - 'ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni',\n    'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi',\n    'ZTF22aawasao', 'ZTF23aaxgvnt'\n\n2) Pre-filter detections only by oid\n- Build a subquery or CTE (e.g., filtered_detections) selecting from detection with the condition detection.oid IN (<list from step 1>).\n- Do not apply any other filters at this stage to align with the \u201cavoid filters on detection other than oid\u201d guidance.\n\n3) Join detections with PS1 features\n- INNER JOIN ps1_ztf p to the filtered detections d on (d.oid = p.oid AND d.candid = p.candid).\n- Rationale: ps1_ztf\u2019s primary key is (oid, candid), ensuring a single PS1 row per detection. INNER JOIN keeps only rows with available PS1 nearest-source info.\n\n4) Apply science filters (post-join)\n- Deep learning real-bogus threshold: d.drb > 0.5.\n- PS1 condition: (p.sgscore1 < 0.5 OR p.distpsnr1 < 1).\n- Note on NULL handling: rows with NULL in drb, sgscore1, or distpsnr1 will fail the comparisons and be excluded automatically, matching the intent.\n\n5) Select the requested output columns (only)\n- d.oid                                      as unique object identifier\n- d.candid                                   as candidate identifier\n- d.fid                                      as filter identifier\n- d.mjd                                      as modified julian date\n- d.magpsf                                   as magnitude\n- d.sigmapsf                                 as magnitude error\n- d.has_stamp                                as whether the object has stamps\n- d.drb                                      as deep learning real-bogus score\n- p.sgscore1                                 as PS1 star/galaxy score of nearest object\n- p.distpsnr1                                as PS1 distance to nearest source (arcsec)\n\n6) Optional ordering (if desired)\n- If a stable order is desired, order by d.oid, then d.mjd or d.candid. The user did not request ordering, so this can be omitted.\n\n7) Performance considerations\n- The detection table has an index on oid; filtering by the IN list first ensures efficient access.\n- The join on (oid, candid) leverages ps1_ztf\u2019s primary key for efficient lookups.\n- Applying the drb and PS1 constraints after the OID pre-filter keeps scans focused.\n\n8) Sanity checks\n- Confirm that magnitude fields requested are magpsf and sigmapsf. If the user intended corrected magnitudes, substitute with magpsf_corr and sigmapsf_corr accordingly; otherwise use magpsf/sigmapsf as specified above.\n- Ensure units: distpsnr1 is in arcseconds; the threshold 1 is directly comparable.\n- Expect multiple rows per oid (one per detection meeting criteria). The join cannot duplicate rows because ps1_ztf has a single row per (oid, candid).",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\nReturn, for a specific list of object IDs (oids), per-detection rows including:\n- object identifier (oid)\n- candidate identifier (candid)\n- filter identifier (fid)\n- modified julian date (mjd)\n- magnitude and magnitude error\n- whether the candidate has stamps\n- deep learning real-bogus score (drb)\n- PS1 nearest-object star/galaxy score (sgscore1)\n- PS1 distance to nearest source (distpsnr1, in arcsec)\nOnly include rows where drb > 0.5 AND (sgscore1 < 0.5 OR distpsnr1 < 1).\n\nTables and columns to use\n- detection\n  - oid (VARCHAR): unique object identifier\n  - candid (BIGINT): candidate identifier\n  - fid (INTEGER): filter id\n  - mjd (DOUBLE PRECISION): MJD of detection\n  - magpsf (DOUBLE PRECISION): PSF difference magnitude\n  - sigmapsf (DOUBLE PRECISION): PSF difference magnitude error\n  - has_stamp (BOOLEAN): whether the candidate has an associated image stamp\n  - drb (DOUBLE PRECISION): deep learning real-bogus score\n- ps1_ztf\n  - oid (VARCHAR)\n  - candid (BIGINT)\n  - sgscore1 (DOUBLE PRECISION): PS1 star/galaxy score for nearest source\n  - distpsnr1 (DOUBLE PRECISION): PS1 distance to nearest source [arcsec]\n\nImportant constraints and guidance\n- Avoid filtering on detection on any parameter other than oid when scanning the table. Restrict detection first by oid, then apply additional filters in the outer query.\n- Use INNER JOIN between detection and ps1_ztf on (oid, candid) to ensure PS1 features exist for each detection.\n- The user explicitly specified the columns to return, so do not use SELECT *.\n- No spatial constraints are required; Q3C functions are not needed.\n- The probability and object tables are not needed for this request.\n\nStep-by-step plan\n\n1) Define the input list of object identifiers\n- Create a literal list (for a WHERE ... IN (...) clause) with the following oids:\n  - 'ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni',\n    'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi',\n    'ZTF22aawasao', 'ZTF23aaxgvnt'\n\n2) Pre-filter detections only by oid\n- Build a subquery or CTE (e.g., filtered_detections) selecting from detection with the condition detection.oid IN (<list from step 1>).\n- Do not apply any other filters at this stage to align with the \u201cavoid filters on detection other than oid\u201d guidance.\n\n3) Join detections with PS1 features\n- INNER JOIN ps1_ztf p to the filtered detections d on (d.oid = p.oid AND d.candid = p.candid).\n- Rationale: ps1_ztf\u2019s primary key is (oid, candid), ensuring a single PS1 row per detection. INNER JOIN keeps only rows with available PS1 nearest-source info.\n\n4) Apply science filters (post-join)\n- Deep learning real-bogus threshold: d.drb > 0.5.\n- PS1 condition: (p.sgscore1 < 0.5 OR p.distpsnr1 < 1).\n- Note on NULL handling: rows with NULL in drb, sgscore1, or distpsnr1 will fail the comparisons and be excluded automatically, matching the intent.\n\n5) Select the requested output columns (only)\n- d.oid                                      as unique object identifier\n- d.candid                                   as candidate identifier\n- d.fid                                      as filter identifier\n- d.mjd                                      as modified julian date\n- d.magpsf                                   as magnitude\n- d.sigmapsf                                 as magnitude error\n- d.has_stamp                                as whether the object has stamps\n- d.drb                                      as deep learning real-bogus score\n- p.sgscore1                                 as PS1 star/galaxy score of nearest object\n- p.distpsnr1                                as PS1 distance to nearest source (arcsec)\n\n6) Optional ordering (if desired)\n- If a stable order is desired, order by d.oid, then d.mjd or d.candid. The user did not request ordering, so this can be omitted.\n\n7) Performance considerations\n- The detection table has an index on oid; filtering by the IN list first ensures efficient access.\n- The join on (oid, candid) leverages ps1_ztf\u2019s primary key for efficient lookups.\n- Applying the drb and PS1 constraints after the OID pre-filter keeps scans focused.\n\n8) Sanity checks\n- Confirm that magnitude fields requested are magpsf and sigmapsf. If the user intended corrected magnitudes, substitute with magpsf_corr and sigmapsf_corr accordingly; otherwise use magpsf/sigmapsf as specified above.\n- Ensure units: distpsnr1 is in arcseconds; the threshold 1 is directly comparable.\n- Expect multiple rows per oid (one per detection meeting criteria). The join cannot duplicate rows because ps1_ztf has a single row per (oid, candid)."
                },
                "in_toks": 3503,
                "out_toks": 3406,
                "id": "chatcmpl-CSxmnLzjNc4XCfyXQvEP2ErPFPlxe",
                "created": 1761019037,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* \nReturn per-detection rows for the given oids, joined with PS1 nearest-source info.\nScience cuts: drb > 0.5 AND (sgscore1 < 0.5 OR distpsnr1 < 1)\nOnly filter detection by oid in the initial step for performance.\n*/\nWITH filtered_detections AS (\n  SELECT\n    oid,\n    candid,\n    fid,\n    mjd,\n    magpsf,\n    sigmapsf,\n    has_stamp,\n    drb\n  FROM detection\n  WHERE oid IN (\n    'ZTF23aavzgjg',\n    'ZTF23aaynzyk',\n    'ZTF23aavqxos',\n    'ZTF23aaknyni',\n    'ZTF23aavsdtc',\n    'ZTF18aandkua',\n    'ZTF23aaxfewt',\n    'ZTF23aavshwi',\n    'ZTF22aawasao',\n    'ZTF23aaxgvnt'\n  )\n)\nSELECT\n  d.oid,\n  d.candid,\n  d.fid,\n  d.mjd,\n  d.magpsf,\n  d.sigmapsf,\n  d.has_stamp,\n  d.drb,\n  p.sgscore1,\n  p.distpsnr1\nFROM filtered_detections d\nINNER JOIN ps1_ztf p\n  ON p.oid = d.oid\n AND p.candid = d.candid\nWHERE d.drb > 0.5\n  AND (p.sgscore1 < 0.5 OR p.distpsnr1 < 1);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* \nReturn per-detection rows for the given oids, joined with PS1 nearest-source info.\nScience cuts: drb > 0.5 AND (sgscore1 < 0.5 OR distpsnr1 < 1)\nOnly filter detection by oid in the initial step for performance.\n*/\nWITH filtered_detections AS (\n  SELECT\n    oid,\n    candid,\n    fid,\n    mjd,\n    magpsf,\n    sigmapsf,\n    has_stamp,\n    drb\n  FROM detection\n  WHERE oid IN (\n    'ZTF23aavzgjg',\n    'ZTF23aaynzyk',\n    'ZTF23aavqxos',\n    'ZTF23aaknyni',\n    'ZTF23aavsdtc',\n    'ZTF18aandkua',\n    'ZTF23aaxfewt',\n    'ZTF23aavshwi',\n    'ZTF22aawasao',\n    'ZTF23aaxgvnt'\n  )\n)\nSELECT\n  d.oid,\n  d.candid,\n  d.fid,\n  d.mjd,\n  d.magpsf,\n  d.sigmapsf,\n  d.has_stamp,\n  d.drb,\n  p.sgscore1,\n  p.distpsnr1\nFROM filtered_detections d\nINNER JOIN ps1_ztf p\n  ON p.oid = d.oid\n AND p.candid = d.candid\nWHERE d.drb > 0.5\n  AND (p.sgscore1 < 0.5 OR p.distpsnr1 < 1);\n```"
                },
                "in_toks": 3345,
                "out_toks": 1182,
                "id": "chatcmpl-CSySAol7ewJvAqPnD9ACu0kcFc1uf",
                "created": 1761021602,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "14",
            "experiment_id": "run_4",
            "pred_tables": [
                "detection",
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'ps1_ztf']"
                },
                "in_toks": 783,
                "out_toks": 852,
                "id": "chatcmpl-CSsZYJuDOsrC32SHPqruehTnaRFlH",
                "created": 1760998996,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1895,
                "out_toks": 463,
                "id": "chatcmpl-CSxSvQq5X50HqpfuZcMbDHhGxkD8m",
                "created": 1761017805,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3503,
                "out_toks": 4000,
                "id": "chatcmpl-CSxnJHmHvfDVqr25BYSzB8nDRDZoF",
                "created": 1761019069,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* For the given list of oids, return selected detection-level fields with filters:\n   - drb > 0.5\n   - AND distance to nearest reference source < 1 arcsec (using distnr as proxy)\n   NOTE: The provided schema does not include Pan-STARRS-specific distance (e.g., distpsnr1)\n         nor star-galaxy score (e.g., sgscore1). Therefore, we return distnr and cannot\n         return a star-galaxy score column or filter on it.\n*/\nWITH oids(oid) AS (\n    VALUES\n        ('ZTF23aavzgjg'),\n        ('ZTF23aaynzyk'),\n        ('ZTF23aavqxos'),\n        ('ZTF23aaknyni'),\n        ('ZTF23aavsdtc'),\n        ('ZTF18aandkua'),\n        ('ZTF23aaxfewt'),\n        ('ZTF23aavshwi'),\n        ('ZTF22aawasao'),\n        ('ZTF23aaxgvnt')\n)\nSELECT\n    d.oid,               -- unique object identifier\n    d.candid,            -- candidate identifier\n    d.fid,               -- filter identifier\n    d.mjd,               -- modified julian date\n    d.magpsf,            -- magnitude (PSF difference magnitude)\n    d.sigmapsf,          -- magnitude error\n    d.has_stamp,         -- whether the object has stamps\n    d.drb,               -- deep learning real bogus score\n    d.distnr             -- distance to the nearest source in the reference image (used as proxy for Pan-STARRS)\nFROM detection d\nINNER JOIN oids o USING (oid)\nWHERE\n    d.drb > 0.5\n    AND d.distnr < 1  -- assuming units are arcseconds\n;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* For the given list of oids, return selected detection-level fields with filters:\n   - drb > 0.5\n   - AND distance to nearest reference source < 1 arcsec (using distnr as proxy)\n   NOTE: The provided schema does not include Pan-STARRS-specific distance (e.g., distpsnr1)\n         nor star-galaxy score (e.g., sgscore1). Therefore, we return distnr and cannot\n         return a star-galaxy score column or filter on it.\n*/\nWITH oids(oid) AS (\n    VALUES\n        ('ZTF23aavzgjg'),\n        ('ZTF23aaynzyk'),\n        ('ZTF23aavqxos'),\n        ('ZTF23aaknyni'),\n        ('ZTF23aavsdtc'),\n        ('ZTF18aandkua'),\n        ('ZTF23aaxfewt'),\n        ('ZTF23aavshwi'),\n        ('ZTF22aawasao'),\n        ('ZTF23aaxgvnt')\n)\nSELECT\n    d.oid,               -- unique object identifier\n    d.candid,            -- candidate identifier\n    d.fid,               -- filter identifier\n    d.mjd,               -- modified julian date\n    d.magpsf,            -- magnitude (PSF difference magnitude)\n    d.sigmapsf,          -- magnitude error\n    d.has_stamp,         -- whether the object has stamps\n    d.drb,               -- deep learning real bogus score\n    d.distnr             -- distance to the nearest source in the reference image (used as proxy for Pan-STARRS)\nFROM detection d\nINNER JOIN oids o USING (oid)\nWHERE\n    d.drb > 0.5\n    AND d.distnr < 1  -- assuming units are arcseconds\n;\n```"
                },
                "in_toks": 3170,
                "out_toks": 3788,
                "id": "chatcmpl-CSySPtVEJfNjOypOk8XzSN4uI4exC",
                "created": 1761021617,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "14",
            "experiment_id": "run_5",
            "pred_tables": [
                "detection",
                "ps1_ztf",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'ps1_ztf', 'dataquality']"
                },
                "in_toks": 783,
                "out_toks": 1560,
                "id": "chatcmpl-CZMLcynvI8w6xxpQyQWRKtVRSeMCx",
                "created": 1762543420,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 2693,
                "out_toks": 591,
                "id": "chatcmpl-CZYGnDOaOyhkuES8zsr8xuhSinnyi",
                "created": 1762589249,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Identify inputs and scope\n- Input list of object identifiers (oids):\n  - ['ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni', 'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi', 'ZTF22aawasao', 'ZTF23aaxgvnt']\n- Return, per qualifying detection (alert/candidate) for those objects:\n  - detection.oid (unique object identifier)\n  - detection.candid (candidate identifier)\n  - detection.fid (filter identifier: 1=g; 2=r; 3=i)\n  - detection.mjd (modified julian date)\n  - magnitude and magnitude error: use detection.magpsf_corr and detection.sigmapsf_corr (apparent magnitude and its error for point-like source)\n  - detection.has_stamp (whether the candidate has an associated image stamp)\n  - detection.drb (deep learning real-bogus score)\n  - ps1_ztf.sgscore1 (star/galaxy score of nearest PS1 source)\n  - ps1_ztf.distpsnr1 (distance to nearest PS1 source, in arcsec)\n\n2) Identify required tables, join keys, and relevant columns\n- detection (main light-curve/detections table)\n  - Required columns: oid, candid, fid, mjd, magpsf_corr, sigmapsf_corr, has_stamp, drb\n  - Filtering columns: oid (primary filter), drb (threshold > 0.5)\n  - Note: There is an index ix_ndetection_oid on detection(oid), which will be used when filtering by oid.\n- ps1_ztf (nearest Pan-STARRS neighbor information per candidate)\n  - Required columns: oid, candid, sgscore1, distpsnr1\n  - Join to detection by (oid, candid)\n- No other tables are needed for this request (dataquality is not required; probability/object tables are not involved).\n\n3) Build a prefiltered detections subset\n- Create a subquery/CTE that selects from detection only rows matching:\n  - detection.oid in the provided list (leverages ix_ndetection_oid)\n  - detection.drb > 0.5 (deep learning real-bogus score threshold)\n- Select only the needed columns from detection to reduce row width:\n  - oid, candid, fid, mjd, magpsf_corr, sigmapsf_corr, has_stamp, drb\n\n4) Join with Pan-STARRS crossmatch table\n- Use an INNER JOIN from the prefiltered detection subset to ps1_ztf on:\n  - detection.oid = ps1_ztf.oid\n  - detection.candid = ps1_ztf.candid\n- INNER JOIN is appropriate because the filter conditions depend on ps1_ztf fields; rows lacking PS1 info cannot satisfy the PS1-related predicate.\n\n5) Apply Pan-STARRS-based filter conditions\n- Keep rows where either of the following holds:\n  - ps1_ztf.sgscore1 < 0.5 (likely not a star)\n  - OR ps1_ztf.distpsnr1 < 1 (nearest PS1 source within 1 arcsec)\n- Units: ps1_ztf.distpsnr1 is in arcseconds, so compare directly to 1.\n\n6) Select and alias the output columns\n- From detection:\n  - oid\n  - candid\n  - fid\n  - mjd\n  - magpsf_corr as the \u201cmagnitude\u201d\n  - sigmapsf_corr as the \u201cmagnitude error\u201d\n  - has_stamp\n  - drb\n- From ps1_ztf:\n  - sgscore1\n  - distpsnr1\n- If you need explicit aliases for readability, alias magnitude and magnitude error as mag and mag_err, respectively.\n\n7) Optional result ordering (if desired for readability; not required by the user)\n- ORDER BY detection.oid, detection.mjd, detection.candid\n\n8) Notes for performance and correctness\n- Filtering by detection.oid first uses the existing hash index (ix_ndetection_oid) and sharply reduces the detection rows before applying drb and join conditions, which is consistent with the guidance to avoid broad filters on detection beyond oid.\n- The choice of magpsf_corr and sigmapsf_corr returns apparent magnitudes and their errors (point-source assumption), which are typically preferred over raw difference magnitudes for science usage. If uncorrected magnitudes are desired instead, swap to magpsf and sigmapsf.\n- No probability table or classifier-related constraints are needed for this query.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Identify inputs and scope\n- Input list of object identifiers (oids):\n  - ['ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni', 'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi', 'ZTF22aawasao', 'ZTF23aaxgvnt']\n- Return, per qualifying detection (alert/candidate) for those objects:\n  - detection.oid (unique object identifier)\n  - detection.candid (candidate identifier)\n  - detection.fid (filter identifier: 1=g; 2=r; 3=i)\n  - detection.mjd (modified julian date)\n  - magnitude and magnitude error: use detection.magpsf_corr and detection.sigmapsf_corr (apparent magnitude and its error for point-like source)\n  - detection.has_stamp (whether the candidate has an associated image stamp)\n  - detection.drb (deep learning real-bogus score)\n  - ps1_ztf.sgscore1 (star/galaxy score of nearest PS1 source)\n  - ps1_ztf.distpsnr1 (distance to nearest PS1 source, in arcsec)\n\n2) Identify required tables, join keys, and relevant columns\n- detection (main light-curve/detections table)\n  - Required columns: oid, candid, fid, mjd, magpsf_corr, sigmapsf_corr, has_stamp, drb\n  - Filtering columns: oid (primary filter), drb (threshold > 0.5)\n  - Note: There is an index ix_ndetection_oid on detection(oid), which will be used when filtering by oid.\n- ps1_ztf (nearest Pan-STARRS neighbor information per candidate)\n  - Required columns: oid, candid, sgscore1, distpsnr1\n  - Join to detection by (oid, candid)\n- No other tables are needed for this request (dataquality is not required; probability/object tables are not involved).\n\n3) Build a prefiltered detections subset\n- Create a subquery/CTE that selects from detection only rows matching:\n  - detection.oid in the provided list (leverages ix_ndetection_oid)\n  - detection.drb > 0.5 (deep learning real-bogus score threshold)\n- Select only the needed columns from detection to reduce row width:\n  - oid, candid, fid, mjd, magpsf_corr, sigmapsf_corr, has_stamp, drb\n\n4) Join with Pan-STARRS crossmatch table\n- Use an INNER JOIN from the prefiltered detection subset to ps1_ztf on:\n  - detection.oid = ps1_ztf.oid\n  - detection.candid = ps1_ztf.candid\n- INNER JOIN is appropriate because the filter conditions depend on ps1_ztf fields; rows lacking PS1 info cannot satisfy the PS1-related predicate.\n\n5) Apply Pan-STARRS-based filter conditions\n- Keep rows where either of the following holds:\n  - ps1_ztf.sgscore1 < 0.5 (likely not a star)\n  - OR ps1_ztf.distpsnr1 < 1 (nearest PS1 source within 1 arcsec)\n- Units: ps1_ztf.distpsnr1 is in arcseconds, so compare directly to 1.\n\n6) Select and alias the output columns\n- From detection:\n  - oid\n  - candid\n  - fid\n  - mjd\n  - magpsf_corr as the \u201cmagnitude\u201d\n  - sigmapsf_corr as the \u201cmagnitude error\u201d\n  - has_stamp\n  - drb\n- From ps1_ztf:\n  - sgscore1\n  - distpsnr1\n- If you need explicit aliases for readability, alias magnitude and magnitude error as mag and mag_err, respectively.\n\n7) Optional result ordering (if desired for readability; not required by the user)\n- ORDER BY detection.oid, detection.mjd, detection.candid\n\n8) Notes for performance and correctness\n- Filtering by detection.oid first uses the existing hash index (ix_ndetection_oid) and sharply reduces the detection rows before applying drb and join conditions, which is consistent with the guidance to avoid broad filters on detection beyond oid.\n- The choice of magpsf_corr and sigmapsf_corr returns apparent magnitudes and their errors (point-source assumption), which are typically preferred over raw difference magnitudes for science usage. If uncorrected magnitudes are desired instead, swap to magpsf and sigmapsf.\n- No probability table or classifier-related constraints are needed for this query."
                },
                "in_toks": 4300,
                "out_toks": 3257,
                "id": "chatcmpl-CZZxXz88uFzpxV241AKrij61r9MlF",
                "created": 1762595743,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return detections for given oids with drb > 0.5 and either sgscore1 < 0.5 or distpsnr1 < 1 arcsec\nWITH det AS (\n    SELECT\n        d.oid,\n        d.candid,\n        d.fid,\n        d.mjd,\n        d.magpsf_corr,\n        d.sigmapsf_corr,\n        d.has_stamp,\n        d.drb\n    FROM detection d\n    WHERE d.oid IN (\n        'ZTF23aavzgjg',\n        'ZTF23aaynzyk',\n        'ZTF23aavqxos',\n        'ZTF23aaknyni',\n        'ZTF23aavsdtc',\n        'ZTF18aandkua',\n        'ZTF23aaxfewt',\n        'ZTF23aavshwi',\n        'ZTF22aawasao',\n        'ZTF23aaxgvnt'\n    )\n      AND d.drb > 0.5\n)\nSELECT\n    det.oid,\n    det.candid,\n    det.fid,\n    det.mjd,\n    det.magpsf_corr,\n    det.sigmapsf_corr,\n    det.has_stamp,\n    det.drb,\n    ps.sgscore1,\n    ps.distpsnr1\nFROM det\nINNER JOIN ps1_ztf ps\n    ON ps.oid = det.oid\n   AND ps.candid = det.candid\nWHERE (ps.sgscore1 < 0.5 OR ps.distpsnr1 < 1)\nORDER BY det.oid, det.mjd, det.candid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return detections for given oids with drb > 0.5 and either sgscore1 < 0.5 or distpsnr1 < 1 arcsec\nWITH det AS (\n    SELECT\n        d.oid,\n        d.candid,\n        d.fid,\n        d.mjd,\n        d.magpsf_corr,\n        d.sigmapsf_corr,\n        d.has_stamp,\n        d.drb\n    FROM detection d\n    WHERE d.oid IN (\n        'ZTF23aavzgjg',\n        'ZTF23aaynzyk',\n        'ZTF23aavqxos',\n        'ZTF23aaknyni',\n        'ZTF23aavsdtc',\n        'ZTF18aandkua',\n        'ZTF23aaxfewt',\n        'ZTF23aavshwi',\n        'ZTF22aawasao',\n        'ZTF23aaxgvnt'\n    )\n      AND d.drb > 0.5\n)\nSELECT\n    det.oid,\n    det.candid,\n    det.fid,\n    det.mjd,\n    det.magpsf_corr,\n    det.sigmapsf_corr,\n    det.has_stamp,\n    det.drb,\n    ps.sgscore1,\n    ps.distpsnr1\nFROM det\nINNER JOIN ps1_ztf ps\n    ON ps.oid = det.oid\n   AND ps.candid = det.candid\nWHERE (ps.sgscore1 < 0.5 OR ps.distpsnr1 < 1)\nORDER BY det.oid, det.mjd, det.candid;\n```"
                },
                "in_toks": 3196,
                "out_toks": 1694,
                "id": "chatcmpl-CZb4Bi3uNcfC1vYTHBSTdxtV5Rape",
                "created": 1762599999,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "14",
            "experiment_id": "run_6",
            "pred_tables": [
                "detection",
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'ps1_ztf']"
                },
                "in_toks": 783,
                "out_toks": 1172,
                "id": "chatcmpl-CZMM6oak0csmNCrvh2X7v10VuAkoJ",
                "created": 1762543450,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1895,
                "out_toks": 463,
                "id": "chatcmpl-CZYGvPOOdIShceCQRPMCqMEfBv7aT",
                "created": 1762589257,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Define input and scope\n- Input: the list of object identifiers (oids)\n  ['ZTF23aavzgjg','ZTF23aaynzyk','ZTF23aavqxos','ZTF23aaknyni','ZTF23aavsdtc','ZTF18aandkua','ZTF23aaxfewt','ZTF23aavshwi','ZTF22aawasao','ZTF23aaxgvnt']\n- No sky-region constraints; Q3C functions are not required.\n- No probability/classification tables are needed for this request.\n\n2) Identify all required output fields and map to columns\n- Unique object identifier: detection.oid\n- Candidate identifier: detection.candid\n- Filter identifier: detection.fid (1=g, 2=r, 3=i)\n- Modified Julian Date: detection.mjd\n- Magnitude: prefer corrected apparent magnitude when available; otherwise fall back to PSF difference magnitude\n  - Primary: detection.magpsf_corr\n  - Fallback: detection.magpsf\n- Magnitude error: prefer corrected error when available; otherwise fall back to PSF error\n  - Primary: detection.sigmapsf_corr (point-like source)\n  - Fallback: detection.sigmapsf\n- Whether the object has stamps: detection.has_stamp\n- Deep learning real-bogus score: detection.drb\n- Star-galaxy score of nearest PS1 object: ps1_ztf.sgscore1\n- Distance to nearest PS1 source (arcsec): ps1_ztf.distpsnr1\n\n3) Choose base table and restrict early for performance\n- Base table: detection (it has the per-candidate info needed).\n- First restriction should be on detection.oid using the given list to leverage index ix_ndetection_oid.\n\n4) Join to Pan-STARRS crossmatch table to get nearest-object metrics\n- Join detection to ps1_ztf on both oid and candid to match the PS1 association for the same alert:\n  - Join condition: detection.oid = ps1_ztf.oid AND detection.candid = ps1_ztf.candid\n- This ensures sgscore1 and distpsnr1 correspond to the same candidate as the detection row.\n\n5) Apply filtering conditions\n- Only keep rows with deep learning real-bogus score greater than 0.5:\n  - detection.drb > 0.5\n- And that either satisfy:\n  - ps1_ztf.sgscore1 < 0.5\n  - OR ps1_ztf.distpsnr1 < 1.0\n- Note: apply the oid filter first (WHERE detection.oid IN (...)), then the drb and PS1 conditions to minimize scanning on unindexed detection columns.\n\n6) Define the selected columns (projection)\n- detection.oid AS oid\n- detection.candid AS candid\n- detection.fid AS fid\n- detection.mjd AS mjd\n- Magnitude: use a coalesce-style selection to prefer corrected magnitude when present\n  - magnitude = COALESCE(detection.magpsf_corr, detection.magpsf)\n- Magnitude error: similarly prefer corrected error\n  - magnitude_error = COALESCE(detection.sigmapsf_corr, detection.sigmapsf)\n- detection.has_stamp AS has_stamp\n- detection.drb AS drb\n- ps1_ztf.sgscore1 AS sgscore1\n- ps1_ztf.distpsnr1 AS distpsnr1\n\n7) Optional result ordering (if needed)\n- ORDER BY detection.oid ASC, detection.mjd ASC (or detection.candid ASC), to group detections per object chronologically.\n\n8) Constraints and correctness checks\n- Ensure the list of oids is correctly quoted as text literals in the IN clause.\n- No probability table is used; thus, the default probability constraints are not applicable here.\n- Units:\n  - distpsnr1 is in arcseconds; the threshold \u201c< 1\u201d matches the user\u2019s requirement.\n  - fid values map to filters: 1=g, 2=r, 3=i.\n- Expect multiple rows per oid (one per qualifying detection/candid); if only one detection per object is desired, introduce an additional step (e.g., window function to select latest mjd per oid), but this was not requested.\n\n9) Index usage and performance notes\n- detection.oid has a hash index (ix_ndetection_oid) that will be used by the initial WHERE detection.oid IN (...)\n- ps1_ztf has a primary key on (oid, candid); the join on these keys is index-friendly.\n- Avoid additional filters on detection before the oid restriction to prevent full scans as per the \u201cavoid filters on detection other than oid\u201d guidance. The drb filter is necessary but applied after the oid constraint.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Define input and scope\n- Input: the list of object identifiers (oids)\n  ['ZTF23aavzgjg','ZTF23aaynzyk','ZTF23aavqxos','ZTF23aaknyni','ZTF23aavsdtc','ZTF18aandkua','ZTF23aaxfewt','ZTF23aavshwi','ZTF22aawasao','ZTF23aaxgvnt']\n- No sky-region constraints; Q3C functions are not required.\n- No probability/classification tables are needed for this request.\n\n2) Identify all required output fields and map to columns\n- Unique object identifier: detection.oid\n- Candidate identifier: detection.candid\n- Filter identifier: detection.fid (1=g, 2=r, 3=i)\n- Modified Julian Date: detection.mjd\n- Magnitude: prefer corrected apparent magnitude when available; otherwise fall back to PSF difference magnitude\n  - Primary: detection.magpsf_corr\n  - Fallback: detection.magpsf\n- Magnitude error: prefer corrected error when available; otherwise fall back to PSF error\n  - Primary: detection.sigmapsf_corr (point-like source)\n  - Fallback: detection.sigmapsf\n- Whether the object has stamps: detection.has_stamp\n- Deep learning real-bogus score: detection.drb\n- Star-galaxy score of nearest PS1 object: ps1_ztf.sgscore1\n- Distance to nearest PS1 source (arcsec): ps1_ztf.distpsnr1\n\n3) Choose base table and restrict early for performance\n- Base table: detection (it has the per-candidate info needed).\n- First restriction should be on detection.oid using the given list to leverage index ix_ndetection_oid.\n\n4) Join to Pan-STARRS crossmatch table to get nearest-object metrics\n- Join detection to ps1_ztf on both oid and candid to match the PS1 association for the same alert:\n  - Join condition: detection.oid = ps1_ztf.oid AND detection.candid = ps1_ztf.candid\n- This ensures sgscore1 and distpsnr1 correspond to the same candidate as the detection row.\n\n5) Apply filtering conditions\n- Only keep rows with deep learning real-bogus score greater than 0.5:\n  - detection.drb > 0.5\n- And that either satisfy:\n  - ps1_ztf.sgscore1 < 0.5\n  - OR ps1_ztf.distpsnr1 < 1.0\n- Note: apply the oid filter first (WHERE detection.oid IN (...)), then the drb and PS1 conditions to minimize scanning on unindexed detection columns.\n\n6) Define the selected columns (projection)\n- detection.oid AS oid\n- detection.candid AS candid\n- detection.fid AS fid\n- detection.mjd AS mjd\n- Magnitude: use a coalesce-style selection to prefer corrected magnitude when present\n  - magnitude = COALESCE(detection.magpsf_corr, detection.magpsf)\n- Magnitude error: similarly prefer corrected error\n  - magnitude_error = COALESCE(detection.sigmapsf_corr, detection.sigmapsf)\n- detection.has_stamp AS has_stamp\n- detection.drb AS drb\n- ps1_ztf.sgscore1 AS sgscore1\n- ps1_ztf.distpsnr1 AS distpsnr1\n\n7) Optional result ordering (if needed)\n- ORDER BY detection.oid ASC, detection.mjd ASC (or detection.candid ASC), to group detections per object chronologically.\n\n8) Constraints and correctness checks\n- Ensure the list of oids is correctly quoted as text literals in the IN clause.\n- No probability table is used; thus, the default probability constraints are not applicable here.\n- Units:\n  - distpsnr1 is in arcseconds; the threshold \u201c< 1\u201d matches the user\u2019s requirement.\n  - fid values map to filters: 1=g, 2=r, 3=i.\n- Expect multiple rows per oid (one per qualifying detection/candid); if only one detection per object is desired, introduce an additional step (e.g., window function to select latest mjd per oid), but this was not requested.\n\n9) Index usage and performance notes\n- detection.oid has a hash index (ix_ndetection_oid) that will be used by the initial WHERE detection.oid IN (...)\n- ps1_ztf has a primary key on (oid, candid); the join on these keys is index-friendly.\n- Avoid additional filters on detection before the oid restriction to prevent full scans as per the \u201cavoid filters on detection other than oid\u201d guidance. The drb filter is necessary but applied after the oid constraint."
                },
                "in_toks": 3503,
                "out_toks": 3581,
                "id": "chatcmpl-CZZmjzU3SkZvbyIgsRUFbbkVv13BK",
                "created": 1762595073,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return per-candidate detections for the specified oids, preferring corrected magnitudes when available.\n-- Apply filters: drb > 0.5 AND (sgscore1 < 0.5 OR distpsnr1 < 1.0)\nSELECT\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd,\n    COALESCE(d.magpsf_corr, d.magpsf) AS magnitud,           -- preferred magnitude\n    COALESCE(d.sigmapsf_corr, d.sigmapsf) AS magnitud_error, -- preferred magnitude error\n    d.has_stamp,\n    d.drb,\n    p.sgscore1,\n    p.distpsnr1\nFROM detection AS d\nINNER JOIN ps1_ztf AS p\n    ON d.oid = p.oid\n   AND d.candid = p.candid\nWHERE\n    d.oid IN (\n        'ZTF23aavzgjg',\n        'ZTF23aaynzyk',\n        'ZTF23aavqxos',\n        'ZTF23aaknyni',\n        'ZTF23aavsdtc',\n        'ZTF18aandkua',\n        'ZTF23aaxfewt',\n        'ZTF23aavshwi',\n        'ZTF22aawasao',\n        'ZTF23aaxgvnt'\n    )\n    AND d.drb > 0.5\n    AND (\n        p.sgscore1 < 0.5\n        OR p.distpsnr1 < 1.0\n    )\nORDER BY d.oid ASC, d.mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return per-candidate detections for the specified oids, preferring corrected magnitudes when available.\n-- Apply filters: drb > 0.5 AND (sgscore1 < 0.5 OR distpsnr1 < 1.0)\nSELECT\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd,\n    COALESCE(d.magpsf_corr, d.magpsf) AS magnitud,           -- preferred magnitude\n    COALESCE(d.sigmapsf_corr, d.sigmapsf) AS magnitud_error, -- preferred magnitude error\n    d.has_stamp,\n    d.drb,\n    p.sgscore1,\n    p.distpsnr1\nFROM detection AS d\nINNER JOIN ps1_ztf AS p\n    ON d.oid = p.oid\n   AND d.candid = p.candid\nWHERE\n    d.oid IN (\n        'ZTF23aavzgjg',\n        'ZTF23aaynzyk',\n        'ZTF23aavqxos',\n        'ZTF23aaknyni',\n        'ZTF23aavsdtc',\n        'ZTF18aandkua',\n        'ZTF23aaxfewt',\n        'ZTF23aavshwi',\n        'ZTF22aawasao',\n        'ZTF23aaxgvnt'\n    )\n    AND d.drb > 0.5\n    AND (\n        p.sgscore1 < 0.5\n        OR p.distpsnr1 < 1.0\n    )\nORDER BY d.oid ASC, d.mjd ASC;\n```"
                },
                "in_toks": 3200,
                "out_toks": 2402,
                "id": "chatcmpl-CZawc1QsqN7ymQAGHcRkLcoNrp4y1",
                "created": 1762599530,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "14",
            "experiment_id": "run_7",
            "pred_tables": [
                "detection",
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'ps1_ztf']"
                },
                "in_toks": 783,
                "out_toks": 980,
                "id": "chatcmpl-CZMMPe2zPwgeGMwuP8ZTJJkkFNuoH",
                "created": 1762543469,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1895,
                "out_toks": 975,
                "id": "chatcmpl-CZYH5kILCBBhs2JHtkjotu4kW8DWZ",
                "created": 1762589267,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify inputs and required outputs\n- Input list of object identifiers (oid):\n  - 'ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni', 'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi', 'ZTF22aawasao', 'ZTF23aaxgvnt'\n- Output columns needed:\n  - detection.oid (unique object identifier)\n  - detection.candid (candidate identifier)\n  - detection.fid (filter identifier)\n  - detection.mjd (modified julian date)\n  - detection.magpsf (magnitude)\n  - detection.sigmapsf (magnitude error)\n  - detection.has_stamp (whether the candidate has stamps)\n  - detection.drb (deep learning real-bogus score)\n  - ps1_ztf.sgscore1 (star-galaxy score of the nearest PS1 source)\n  - ps1_ztf.distpsnr1 (distance to the nearest PS1 source, in arcsec)\n\n2) Identify tables and join keys\n- detection table (primary source of candidate photometry and metadata)\n  - Key columns needed: oid, candid\n  - Other used columns: fid, mjd, magpsf, sigmapsf, has_stamp, drb\n  - Note: has an index on oid (ix_ndetection_oid); for performance, first constrain by oid.\n- ps1_ztf table (PS1 cross-match metrics per (oid, candid))\n  - Join keys: (oid, candid)\n  - Columns used: sgscore1, distpsnr1\n\n3) Define filter criteria\n- Restrict to the given list of detection.oid values.\n- Enforce deep learning real-bogus score threshold: detection.drb > 0.5.\n  - This condition should be applied after pre-filtering detection by oid to respect the guideline of avoiding filters on detection other than oid when possible.\n- PS1 constraints (require a matching ps1_ztf row via INNER JOIN):\n  - ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1\n  - Units: distpsnr1 is in arcseconds (threshold is 1 arcsec).\n  - Null handling: rows with NULL sgscore1 and NULL distpsnr1 will not pass the OR condition and will be excluded.\n\n4) Query structure and steps\n- Step A: Build a subquery (or CTE) over detection to pre-filter by the list of oids only.\n  - Select the columns needed for the final output and the join keys (oid, candid).\n  - Do not apply the drb filter here if aiming to minimize non-oid filters on detection at the earliest stage. Alternatively, you can apply drb > 0.5 in the outer query after joining.\n- Step B: INNER JOIN the pre-filtered detection rows to ps1_ztf on both oid and candid.\n  - Join condition: detection.oid = ps1_ztf.oid AND detection.candid = ps1_ztf.candid.\n  - INNER JOIN ensures only rows with PS1 cross-match information are kept, which is needed to evaluate sgscore1/distpsnr1 conditions.\n- Step C: Apply the remaining WHERE conditions:\n  - detection.drb > 0.5\n  - (ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1)\n- Step D: SELECT the requested columns explicitly, optionally aliasing for readability:\n  - detection.oid\n  - detection.candid\n  - detection.fid\n  - detection.mjd\n  - detection.magpsf AS magnitude\n  - detection.sigmapsf AS magnitude_error\n  - detection.has_stamp\n  - detection.drb\n  - ps1_ztf.sgscore1\n  - ps1_ztf.distpsnr1\n- Step E (optional): ORDER BY for readability/reproducibility, e.g., detection.oid ASC, detection.mjd ASC, detection.candid ASC.\n\n5) Performance and correctness notes\n- Filtering detection by oid first leverages the hash index ix_ndetection_oid.\n- Joining on (oid, candid) is required because ps1_ztf is keyed by both and provides candidate-level PS1 context.\n- The conditions on sgscore1/distpsnr1 necessitate the INNER JOIN to ps1_ztf; detections without a PS1 entry will be excluded.\n- The magnitude fields chosen are magpsf and sigmapsf from detection, as the user did not explicitly request corrected magnitudes (magpsf_corr, sigmapsf_corr). If corrected magnitudes are preferred, replace magpsf/sigmapsf with magpsf_corr/sigmapsf_corr accordingly.\n- No probability or object table usage is required for this request; therefore, default conditions for the probability table do not apply.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify inputs and required outputs\n- Input list of object identifiers (oid):\n  - 'ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni', 'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi', 'ZTF22aawasao', 'ZTF23aaxgvnt'\n- Output columns needed:\n  - detection.oid (unique object identifier)\n  - detection.candid (candidate identifier)\n  - detection.fid (filter identifier)\n  - detection.mjd (modified julian date)\n  - detection.magpsf (magnitude)\n  - detection.sigmapsf (magnitude error)\n  - detection.has_stamp (whether the candidate has stamps)\n  - detection.drb (deep learning real-bogus score)\n  - ps1_ztf.sgscore1 (star-galaxy score of the nearest PS1 source)\n  - ps1_ztf.distpsnr1 (distance to the nearest PS1 source, in arcsec)\n\n2) Identify tables and join keys\n- detection table (primary source of candidate photometry and metadata)\n  - Key columns needed: oid, candid\n  - Other used columns: fid, mjd, magpsf, sigmapsf, has_stamp, drb\n  - Note: has an index on oid (ix_ndetection_oid); for performance, first constrain by oid.\n- ps1_ztf table (PS1 cross-match metrics per (oid, candid))\n  - Join keys: (oid, candid)\n  - Columns used: sgscore1, distpsnr1\n\n3) Define filter criteria\n- Restrict to the given list of detection.oid values.\n- Enforce deep learning real-bogus score threshold: detection.drb > 0.5.\n  - This condition should be applied after pre-filtering detection by oid to respect the guideline of avoiding filters on detection other than oid when possible.\n- PS1 constraints (require a matching ps1_ztf row via INNER JOIN):\n  - ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1\n  - Units: distpsnr1 is in arcseconds (threshold is 1 arcsec).\n  - Null handling: rows with NULL sgscore1 and NULL distpsnr1 will not pass the OR condition and will be excluded.\n\n4) Query structure and steps\n- Step A: Build a subquery (or CTE) over detection to pre-filter by the list of oids only.\n  - Select the columns needed for the final output and the join keys (oid, candid).\n  - Do not apply the drb filter here if aiming to minimize non-oid filters on detection at the earliest stage. Alternatively, you can apply drb > 0.5 in the outer query after joining.\n- Step B: INNER JOIN the pre-filtered detection rows to ps1_ztf on both oid and candid.\n  - Join condition: detection.oid = ps1_ztf.oid AND detection.candid = ps1_ztf.candid.\n  - INNER JOIN ensures only rows with PS1 cross-match information are kept, which is needed to evaluate sgscore1/distpsnr1 conditions.\n- Step C: Apply the remaining WHERE conditions:\n  - detection.drb > 0.5\n  - (ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1)\n- Step D: SELECT the requested columns explicitly, optionally aliasing for readability:\n  - detection.oid\n  - detection.candid\n  - detection.fid\n  - detection.mjd\n  - detection.magpsf AS magnitude\n  - detection.sigmapsf AS magnitude_error\n  - detection.has_stamp\n  - detection.drb\n  - ps1_ztf.sgscore1\n  - ps1_ztf.distpsnr1\n- Step E (optional): ORDER BY for readability/reproducibility, e.g., detection.oid ASC, detection.mjd ASC, detection.candid ASC.\n\n5) Performance and correctness notes\n- Filtering detection by oid first leverages the hash index ix_ndetection_oid.\n- Joining on (oid, candid) is required because ps1_ztf is keyed by both and provides candidate-level PS1 context.\n- The conditions on sgscore1/distpsnr1 necessitate the INNER JOIN to ps1_ztf; detections without a PS1 entry will be excluded.\n- The magnitude fields chosen are magpsf and sigmapsf from detection, as the user did not explicitly request corrected magnitudes (magpsf_corr, sigmapsf_corr). If corrected magnitudes are preferred, replace magpsf/sigmapsf with magpsf_corr/sigmapsf_corr accordingly.\n- No probability or object table usage is required for this request; therefore, default conditions for the probability table do not apply."
                },
                "in_toks": 3503,
                "out_toks": 3449,
                "id": "chatcmpl-CZZyyRbCcGMbaqeEbeMO9K1NrDvhv",
                "created": 1762595832,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return detections for given oids with DRB > 0.5 and PS1 constraints:\n-- sgscore1 < 0.5 OR distpsnr1 < 1 arcsec.\nWITH d AS (\n  SELECT\n    oid,\n    candid,\n    fid,\n    mjd,\n    magpsf,\n    sigmapsf,\n    has_stamp,\n    drb\n  FROM detection\n  WHERE oid IN (\n    'ZTF23aavzgjg',\n    'ZTF23aaynzyk',\n    'ZTF23aavqxos',\n    'ZTF23aaknyni',\n    'ZTF23aavsdtc',\n    'ZTF18aandkua',\n    'ZTF23aaxfewt',\n    'ZTF23aavshwi',\n    'ZTF22aawasao',\n    'ZTF23aaxgvnt'\n  )\n)\nSELECT\n  d.oid,\n  d.candid,\n  d.fid,\n  d.mjd,\n  d.magpsf,\n  d.sigmapsf,\n  d.has_stamp,\n  d.drb,\n  p.sgscore1,\n  p.distpsnr1\nFROM d\nINNER JOIN ps1_ztf p\n  ON p.oid = d.oid\n AND p.candid = d.candid\nWHERE d.drb > 0.5\n  AND (p.sgscore1 < 0.5 OR p.distpsnr1 < 1)\nORDER BY d.oid ASC, d.mjd ASC, d.candid ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return detections for given oids with DRB > 0.5 and PS1 constraints:\n-- sgscore1 < 0.5 OR distpsnr1 < 1 arcsec.\nWITH d AS (\n  SELECT\n    oid,\n    candid,\n    fid,\n    mjd,\n    magpsf,\n    sigmapsf,\n    has_stamp,\n    drb\n  FROM detection\n  WHERE oid IN (\n    'ZTF23aavzgjg',\n    'ZTF23aaynzyk',\n    'ZTF23aavqxos',\n    'ZTF23aaknyni',\n    'ZTF23aavsdtc',\n    'ZTF18aandkua',\n    'ZTF23aaxfewt',\n    'ZTF23aavshwi',\n    'ZTF22aawasao',\n    'ZTF23aaxgvnt'\n  )\n)\nSELECT\n  d.oid,\n  d.candid,\n  d.fid,\n  d.mjd,\n  d.magpsf,\n  d.sigmapsf,\n  d.has_stamp,\n  d.drb,\n  p.sgscore1,\n  p.distpsnr1\nFROM d\nINNER JOIN ps1_ztf p\n  ON p.oid = d.oid\n AND p.candid = d.candid\nWHERE d.drb > 0.5\n  AND (p.sgscore1 < 0.5 OR p.distpsnr1 < 1)\nORDER BY d.oid ASC, d.mjd ASC, d.candid ASC;\n```"
                },
                "in_toks": 3260,
                "out_toks": 1682,
                "id": "chatcmpl-CZawcI8o1XmbnlLPHj74uVPnN2esU",
                "created": 1762599530,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "14",
            "experiment_id": "run_8",
            "pred_tables": [
                "detection",
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'ps1_ztf']"
                },
                "in_toks": 783,
                "out_toks": 1108,
                "id": "chatcmpl-CZMMeyCzGVACMFkCR4GKdKqotmuHT",
                "created": 1762543484,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1895,
                "out_toks": 463,
                "id": "chatcmpl-CZYHNn5cQw4EIZt8oc1nN1eK1sJs9",
                "created": 1762589285,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\nRetrieve, for a specific list of object oids, all detections that:\n- have deep learning real-bogus score (drb) > 0.5, and\n- either Pan-STARRS star-galaxy score (sgscore1) < 0.5 or distance to nearest PS1 source (distpsnr1) < 1 arcsec,\nand return the following columns: unique object identifier, candidate identifier, filter identifier, modified julian date, magnitude, magnitude error, has_stamp, drb, sgscore1, distpsnr1.\n\nTables and columns to use\n- detection d\n  - d.oid (unique object identifier)\n  - d.candid (candidate identifier)\n  - d.fid (filter identifier: 1=g, 2=r, 3=i)\n  - d.mjd (modified julian date)\n  - d.magpsf (PSF difference magnitude)\n  - d.sigmapsf (PSF difference magnitude error)\n  - d.has_stamp (whether the candidate has an associated image stamp)\n  - d.drb (deep learning real-bogus score)\n- ps1_ztf p\n  - p.oid\n  - p.candid\n  - p.sgscore1 (PS1 star/galaxy score of the closest source)\n  - p.distpsnr1 (distance to the closest PS1 source, in arcseconds)\n\nJoin keys\n- Join detection to ps1_ztf on both oid and candid:\n  - d.oid = p.oid\n  - d.candid = p.candid\n  This uses ps1_ztf\u2019s primary key (oid, candid) and preserves one-to-one matching per detection.\n\nInput list (target oids)\n- Use a CTE to declare the list of target oids to avoid scanning the entire detection table and to leverage the detection.oid hash index:\n  - WITH target_oids(oid) AS (VALUES ('ZTF23aavzgjg'), ('ZTF23aaynzyk'), ..., ('ZTF23aaxgvnt'))\n- The list to include:\n  - ZTF23aavzgjg\n  - ZTF23aaynzyk\n  - ZTF23aavqxos\n  - ZTF23aaknyni\n  - ZTF23aavsdtc\n  - ZTF18aandkua\n  - ZTF23aaxfewt\n  - ZTF23aavshwi\n  - ZTF22aawasao\n  - ZTF23aaxgvnt\n\nFiltering logic\n- First restrict detection rows to the target oids via an inner join with the CTE (this adheres to the guidance to avoid general filtering on detection beyond oid by reducing the candidate set early).\n- Then apply the required filters:\n  - d.drb > 0.5\n  - (p.sgscore1 < 0.5 OR p.distpsnr1 < 1.0)\n- Use an INNER JOIN to ps1_ztf so that sgscore1 and distpsnr1 exist for the logical condition; detections without a PS1 match will be excluded, which is appropriate since the condition depends on PS1 fields.\n- Note on NULLs: Rows where both p.sgscore1 and p.distpsnr1 are NULL will be excluded by the condition, as intended.\n\nProjection (columns to return)\n- Select exactly the requested fields, using the exact column names:\n  - d.oid AS oid\n  - d.candid AS candid\n  - d.fid AS fid\n  - d.mjd AS mjd\n  - d.magpsf AS magpsf           (magnitude)\n  - d.sigmapsf AS sigmapsf       (magnitude error)\n  - d.has_stamp AS has_stamp\n  - d.drb AS drb\n  - p.sgscore1 AS sgscore1\n  - p.distpsnr1 AS distpsnr1\n- Rationale: magpsf and sigmapsf are the standard per-detection PSF magnitude and error. If corrected magnitudes were desired, the columns would be magpsf_corr and sigmapsf_corr, but the request didn\u2019t specify correction.\n\nFROM/JOIN structure\n- WITH target_oids AS (... list of oids ...)\n- FROM detection d\n  INNER JOIN target_oids t ON d.oid = t.oid\n  INNER JOIN ps1_ztf p ON p.oid = d.oid AND p.candid = d.candid\n\nWHERE clause\n- d.drb > 0.5\n- (p.sgscore1 < 0.5 OR p.distpsnr1 < 1.0)\n\nOrdering (optional but recommended for readability)\n- ORDER BY d.oid, d.mjd ASC, d.fid ASC\n\nPerformance considerations\n- The detection table has a hash index on oid (ix_ndetection_oid); joining to the target_oids CTE first ensures the planner uses this index to quickly subset detections.\n- The join to ps1_ztf on its primary key (oid, candid) is efficient.\n- Filtering on d.drb after restricting by oid keeps compliance with the guidance to avoid broad filters on detection.\n- No need for DISTINCT because ps1_ztf has a PRIMARY KEY (oid, candid), so the join is one-to-one.\n\nAssumptions and notes\n- Units: p.distpsnr1 is in arcseconds; the threshold is 1.0.\n- The query returns all detections per listed oid that satisfy the conditions (not just the most recent).\n- No use of probability or object tables is required for this task; thus, the default probability conditions are not applicable here.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\nRetrieve, for a specific list of object oids, all detections that:\n- have deep learning real-bogus score (drb) > 0.5, and\n- either Pan-STARRS star-galaxy score (sgscore1) < 0.5 or distance to nearest PS1 source (distpsnr1) < 1 arcsec,\nand return the following columns: unique object identifier, candidate identifier, filter identifier, modified julian date, magnitude, magnitude error, has_stamp, drb, sgscore1, distpsnr1.\n\nTables and columns to use\n- detection d\n  - d.oid (unique object identifier)\n  - d.candid (candidate identifier)\n  - d.fid (filter identifier: 1=g, 2=r, 3=i)\n  - d.mjd (modified julian date)\n  - d.magpsf (PSF difference magnitude)\n  - d.sigmapsf (PSF difference magnitude error)\n  - d.has_stamp (whether the candidate has an associated image stamp)\n  - d.drb (deep learning real-bogus score)\n- ps1_ztf p\n  - p.oid\n  - p.candid\n  - p.sgscore1 (PS1 star/galaxy score of the closest source)\n  - p.distpsnr1 (distance to the closest PS1 source, in arcseconds)\n\nJoin keys\n- Join detection to ps1_ztf on both oid and candid:\n  - d.oid = p.oid\n  - d.candid = p.candid\n  This uses ps1_ztf\u2019s primary key (oid, candid) and preserves one-to-one matching per detection.\n\nInput list (target oids)\n- Use a CTE to declare the list of target oids to avoid scanning the entire detection table and to leverage the detection.oid hash index:\n  - WITH target_oids(oid) AS (VALUES ('ZTF23aavzgjg'), ('ZTF23aaynzyk'), ..., ('ZTF23aaxgvnt'))\n- The list to include:\n  - ZTF23aavzgjg\n  - ZTF23aaynzyk\n  - ZTF23aavqxos\n  - ZTF23aaknyni\n  - ZTF23aavsdtc\n  - ZTF18aandkua\n  - ZTF23aaxfewt\n  - ZTF23aavshwi\n  - ZTF22aawasao\n  - ZTF23aaxgvnt\n\nFiltering logic\n- First restrict detection rows to the target oids via an inner join with the CTE (this adheres to the guidance to avoid general filtering on detection beyond oid by reducing the candidate set early).\n- Then apply the required filters:\n  - d.drb > 0.5\n  - (p.sgscore1 < 0.5 OR p.distpsnr1 < 1.0)\n- Use an INNER JOIN to ps1_ztf so that sgscore1 and distpsnr1 exist for the logical condition; detections without a PS1 match will be excluded, which is appropriate since the condition depends on PS1 fields.\n- Note on NULLs: Rows where both p.sgscore1 and p.distpsnr1 are NULL will be excluded by the condition, as intended.\n\nProjection (columns to return)\n- Select exactly the requested fields, using the exact column names:\n  - d.oid AS oid\n  - d.candid AS candid\n  - d.fid AS fid\n  - d.mjd AS mjd\n  - d.magpsf AS magpsf           (magnitude)\n  - d.sigmapsf AS sigmapsf       (magnitude error)\n  - d.has_stamp AS has_stamp\n  - d.drb AS drb\n  - p.sgscore1 AS sgscore1\n  - p.distpsnr1 AS distpsnr1\n- Rationale: magpsf and sigmapsf are the standard per-detection PSF magnitude and error. If corrected magnitudes were desired, the columns would be magpsf_corr and sigmapsf_corr, but the request didn\u2019t specify correction.\n\nFROM/JOIN structure\n- WITH target_oids AS (... list of oids ...)\n- FROM detection d\n  INNER JOIN target_oids t ON d.oid = t.oid\n  INNER JOIN ps1_ztf p ON p.oid = d.oid AND p.candid = d.candid\n\nWHERE clause\n- d.drb > 0.5\n- (p.sgscore1 < 0.5 OR p.distpsnr1 < 1.0)\n\nOrdering (optional but recommended for readability)\n- ORDER BY d.oid, d.mjd ASC, d.fid ASC\n\nPerformance considerations\n- The detection table has a hash index on oid (ix_ndetection_oid); joining to the target_oids CTE first ensures the planner uses this index to quickly subset detections.\n- The join to ps1_ztf on its primary key (oid, candid) is efficient.\n- Filtering on d.drb after restricting by oid keeps compliance with the guidance to avoid broad filters on detection.\n- No need for DISTINCT because ps1_ztf has a PRIMARY KEY (oid, candid), so the join is one-to-one.\n\nAssumptions and notes\n- Units: p.distpsnr1 is in arcseconds; the threshold is 1.0.\n- The query returns all detections per listed oid that satisfy the conditions (not just the most recent).\n- No use of probability or object tables is required for this task; thus, the default probability conditions are not applicable here."
                },
                "in_toks": 3503,
                "out_toks": 3837,
                "id": "chatcmpl-CZZn98sACtKlM4TTv7odP9FlEEIEL",
                "created": 1762595099,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return detections for the given oids with drb > 0.5 and (sgscore1 < 0.5 OR distpsnr1 < 1.0)\nWITH target_oids(oid) AS (\n    VALUES\n        ('ZTF23aavzgjg'),\n        ('ZTF23aaynzyk'),\n        ('ZTF23aavqxos'),\n        ('ZTF23aaknyni'),\n        ('ZTF23aavsdtc'),\n        ('ZTF18aandkua'),\n        ('ZTF23aaxfewt'),\n        ('ZTF23aavshwi'),\n        ('ZTF22aawasao'),\n        ('ZTF23aaxgvnt')\n)\nSELECT\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd,\n    d.magpsf,\n    d.sigmapsf,\n    d.has_stamp,\n    d.drb,\n    p.sgscore1,\n    p.distpsnr1\nFROM target_oids t\nINNER JOIN detection d\n    ON d.oid = t.oid\nINNER JOIN ps1_ztf p\n    ON p.oid = d.oid\n   AND p.candid = d.candid\nWHERE\n    d.drb > 0.5\n    AND (p.sgscore1 < 0.5 OR p.distpsnr1 < 1.0)\nORDER BY d.oid, d.mjd ASC, d.fid ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return detections for the given oids with drb > 0.5 and (sgscore1 < 0.5 OR distpsnr1 < 1.0)\nWITH target_oids(oid) AS (\n    VALUES\n        ('ZTF23aavzgjg'),\n        ('ZTF23aaynzyk'),\n        ('ZTF23aavqxos'),\n        ('ZTF23aaknyni'),\n        ('ZTF23aavsdtc'),\n        ('ZTF18aandkua'),\n        ('ZTF23aaxfewt'),\n        ('ZTF23aavshwi'),\n        ('ZTF22aawasao'),\n        ('ZTF23aaxgvnt')\n)\nSELECT\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd,\n    d.magpsf,\n    d.sigmapsf,\n    d.has_stamp,\n    d.drb,\n    p.sgscore1,\n    p.distpsnr1\nFROM target_oids t\nINNER JOIN detection d\n    ON d.oid = t.oid\nINNER JOIN ps1_ztf p\n    ON p.oid = d.oid\n   AND p.candid = d.candid\nWHERE\n    d.drb > 0.5\n    AND (p.sgscore1 < 0.5 OR p.distpsnr1 < 1.0)\nORDER BY d.oid, d.mjd ASC, d.fid ASC;\n```"
                },
                "in_toks": 3392,
                "out_toks": 1600,
                "id": "chatcmpl-CZaweYSHF9aSRvWxp1EldEl8WdKQk",
                "created": 1762599532,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "14",
            "experiment_id": "run_9",
            "pred_tables": [
                "detection",
                "probability",
                "ps1_ztf",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'probability', 'ps1_ztf', 'dataquality']"
                },
                "in_toks": 783,
                "out_toks": 1948,
                "id": "chatcmpl-CZMN3nz7wTU1BLAVkkxgRcD9K8Tjp",
                "created": 1762543509,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 2877,
                "out_toks": 975,
                "id": "chatcmpl-CZYHVFTcmcLjmJWiT5GxcrMCkvyby",
                "created": 1762589293,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the SQL query\n\n1) Clarify inputs and goal\n- Input list of object IDs (oids): ['ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni', 'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi', 'ZTF22aawasao', 'ZTF23aaxgvnt'].\n- Return, for detections belonging to those oids:\n  - detection.oid (unique object identifier)\n  - detection.candid (candidate identifier)\n  - detection.fid (filter identifier; 1=g, 2=r, 3=i)\n  - detection.mjd (modified julian date)\n  - detection.magpsf (magnitude)\n  - detection.sigmapsf (magnitude error)\n  - detection.has_stamp (whether the candidate has a stamp)\n  - detection.drb (deep learning real bogus score)\n  - ps1_ztf.sgscore1 (star/galaxy score of the nearest PS1 source)\n  - ps1_ztf.distpsnr1 (distance to nearest PS1 source, in arcsec)\n- Apply filters:\n  - detection.drb > 0.5\n  - (ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1)\n  - detection.oid in the given list\n\n2) Identify required tables and columns\n- detection table (main light-curve detections; indexed by oid):\n  - Columns needed: oid, candid, fid, mjd, magpsf, sigmapsf, has_stamp, drb\n- ps1_ztf table (PS1 nearest-neighbor info; 1:1 per (oid, candid)):\n  - Columns needed: sgscore1, distpsnr1\n  - Join keys available: oid, candid\n- No need for probability, dataquality, or Q3C functions for this request.\n\n3) Determine join strategy\n- Use an INNER JOIN between detection and ps1_ztf on both keys:\n  - detection.oid = ps1_ztf.oid\n  - detection.candid = ps1_ztf.candid\n- Rationale: We must return sgscore1 and distpsnr1 and apply filters on them; this requires that a matching ps1_ztf row exists for each detection.\n\n4) Define row filtering criteria (WHERE clause)\n- Restrict to the provided set of oids:\n  - detection.oid IN ('ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni', 'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi', 'ZTF22aawasao', 'ZTF23aaxgvnt')\n- Deep learning real-bogus score threshold:\n  - detection.drb > 0.5\n- PS1 nearest-neighbor conditions (either/or):\n  - ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1\n- Null handling: Using direct comparisons ensures rows with NULL sgscore1 or NULL distpsnr1 will pass only if the other predicate is true; otherwise they are excluded.\n\n5) Select the required output columns\n- From detection:\n  - oid, candid, fid, mjd, magpsf, sigmapsf, has_stamp, drb\n- From ps1_ztf:\n  - sgscore1, distpsnr1\n- No wildcard selection; explicitly list columns to return exactly what the user requested.\n\n6) Optional result ordering (for readability; not required by the user)\n- ORDER BY detection.oid ASC, detection.mjd ASC.\n\n7) Performance and correctness considerations\n- The detection table has an index on oid (ix_ndetection_oid), which will efficiently support the IN filter on the oid list.\n- ps1_ztf has a composite primary key on (oid, candid), enabling efficient join lookups.\n- Filtering on detection.drb has no dedicated index; however, with a small oid list, this is acceptable.\n- Units are consistent: ps1_ztf.distpsnr1 is in arcseconds, matching the < 1 arcsec requirement. No unit conversion needed.\n- If the user intended corrected magnitudes, alternative columns are detection.magpsf_corr and detection.sigmapsf_corr; default here is to use magpsf and sigmapsf as \u201cmagnitude\u201d and \u201cmagnitude error\u201d since no correction was specified.\n\n8) Final assembly steps\n- FROM detection as the primary table.\n- INNER JOIN ps1_ztf ON detection.oid = ps1_ztf.oid AND detection.candid = ps1_ztf.candid.\n- WHERE clause implementing:\n  - detection.oid IN (list of 10 OIDs),\n  - detection.drb > 0.5,\n  - (ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1).\n- SELECT the 10 specified columns from the two tables.\n- Optionally add ORDER BY detection.oid, detection.mjd.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the SQL query\n\n1) Clarify inputs and goal\n- Input list of object IDs (oids): ['ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni', 'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi', 'ZTF22aawasao', 'ZTF23aaxgvnt'].\n- Return, for detections belonging to those oids:\n  - detection.oid (unique object identifier)\n  - detection.candid (candidate identifier)\n  - detection.fid (filter identifier; 1=g, 2=r, 3=i)\n  - detection.mjd (modified julian date)\n  - detection.magpsf (magnitude)\n  - detection.sigmapsf (magnitude error)\n  - detection.has_stamp (whether the candidate has a stamp)\n  - detection.drb (deep learning real bogus score)\n  - ps1_ztf.sgscore1 (star/galaxy score of the nearest PS1 source)\n  - ps1_ztf.distpsnr1 (distance to nearest PS1 source, in arcsec)\n- Apply filters:\n  - detection.drb > 0.5\n  - (ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1)\n  - detection.oid in the given list\n\n2) Identify required tables and columns\n- detection table (main light-curve detections; indexed by oid):\n  - Columns needed: oid, candid, fid, mjd, magpsf, sigmapsf, has_stamp, drb\n- ps1_ztf table (PS1 nearest-neighbor info; 1:1 per (oid, candid)):\n  - Columns needed: sgscore1, distpsnr1\n  - Join keys available: oid, candid\n- No need for probability, dataquality, or Q3C functions for this request.\n\n3) Determine join strategy\n- Use an INNER JOIN between detection and ps1_ztf on both keys:\n  - detection.oid = ps1_ztf.oid\n  - detection.candid = ps1_ztf.candid\n- Rationale: We must return sgscore1 and distpsnr1 and apply filters on them; this requires that a matching ps1_ztf row exists for each detection.\n\n4) Define row filtering criteria (WHERE clause)\n- Restrict to the provided set of oids:\n  - detection.oid IN ('ZTF23aavzgjg', 'ZTF23aaynzyk', 'ZTF23aavqxos', 'ZTF23aaknyni', 'ZTF23aavsdtc', 'ZTF18aandkua', 'ZTF23aaxfewt', 'ZTF23aavshwi', 'ZTF22aawasao', 'ZTF23aaxgvnt')\n- Deep learning real-bogus score threshold:\n  - detection.drb > 0.5\n- PS1 nearest-neighbor conditions (either/or):\n  - ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1\n- Null handling: Using direct comparisons ensures rows with NULL sgscore1 or NULL distpsnr1 will pass only if the other predicate is true; otherwise they are excluded.\n\n5) Select the required output columns\n- From detection:\n  - oid, candid, fid, mjd, magpsf, sigmapsf, has_stamp, drb\n- From ps1_ztf:\n  - sgscore1, distpsnr1\n- No wildcard selection; explicitly list columns to return exactly what the user requested.\n\n6) Optional result ordering (for readability; not required by the user)\n- ORDER BY detection.oid ASC, detection.mjd ASC.\n\n7) Performance and correctness considerations\n- The detection table has an index on oid (ix_ndetection_oid), which will efficiently support the IN filter on the oid list.\n- ps1_ztf has a composite primary key on (oid, candid), enabling efficient join lookups.\n- Filtering on detection.drb has no dedicated index; however, with a small oid list, this is acceptable.\n- Units are consistent: ps1_ztf.distpsnr1 is in arcseconds, matching the < 1 arcsec requirement. No unit conversion needed.\n- If the user intended corrected magnitudes, alternative columns are detection.magpsf_corr and detection.sigmapsf_corr; default here is to use magpsf and sigmapsf as \u201cmagnitude\u201d and \u201cmagnitude error\u201d since no correction was specified.\n\n8) Final assembly steps\n- FROM detection as the primary table.\n- INNER JOIN ps1_ztf ON detection.oid = ps1_ztf.oid AND detection.candid = ps1_ztf.candid.\n- WHERE clause implementing:\n  - detection.oid IN (list of 10 OIDs),\n  - detection.drb > 0.5,\n  - (ps1_ztf.sgscore1 < 0.5 OR ps1_ztf.distpsnr1 < 1).\n- SELECT the 10 specified columns from the two tables.\n- Optionally add ORDER BY detection.oid, detection.mjd."
                },
                "in_toks": 4484,
                "out_toks": 3260,
                "id": "chatcmpl-CZa1GvFIOw5IGeb1VdgT8UsTjp032",
                "created": 1762595974,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Detections for the specified oids with DRB > 0.5 and PS1 proximity/sgscore conditions\nSELECT\n  d.oid,\n  d.candid,\n  d.fid,\n  d.mjd,\n  d.magpsf,\n  d.sigmapsf,\n  d.has_stamp,\n  d.drb,\n  p.sgscore1,\n  p.distpsnr1\nFROM detection AS d\nINNER JOIN ps1_ztf AS p\n  ON d.oid = p.oid\n AND d.candid = p.candid\nWHERE d.oid IN (\n  'ZTF23aavzgjg',\n  'ZTF23aaynzyk',\n  'ZTF23aavqxos',\n  'ZTF23aaknyni',\n  'ZTF23aavsdtc',\n  'ZTF18aandkua',\n  'ZTF23aaxfewt',\n  'ZTF23aavshwi',\n  'ZTF22aawasao',\n  'ZTF23aaxgvnt'\n)\n  AND d.drb > 0.5\n  AND (\n    p.sgscore1 < 0.5\n    OR p.distpsnr1 < 1\n  )\nORDER BY d.oid ASC, d.mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Detections for the specified oids with DRB > 0.5 and PS1 proximity/sgscore conditions\nSELECT\n  d.oid,\n  d.candid,\n  d.fid,\n  d.mjd,\n  d.magpsf,\n  d.sigmapsf,\n  d.has_stamp,\n  d.drb,\n  p.sgscore1,\n  p.distpsnr1\nFROM detection AS d\nINNER JOIN ps1_ztf AS p\n  ON d.oid = p.oid\n AND d.candid = p.candid\nWHERE d.oid IN (\n  'ZTF23aavzgjg',\n  'ZTF23aaynzyk',\n  'ZTF23aavqxos',\n  'ZTF23aaknyni',\n  'ZTF23aavsdtc',\n  'ZTF18aandkua',\n  'ZTF23aaxfewt',\n  'ZTF23aavshwi',\n  'ZTF22aawasao',\n  'ZTF23aaxgvnt'\n)\n  AND d.drb > 0.5\n  AND (\n    p.sgscore1 < 0.5\n    OR p.distpsnr1 < 1\n  )\nORDER BY d.oid ASC, d.mjd ASC;\n```"
                },
                "in_toks": 3327,
                "out_toks": 1564,
                "id": "chatcmpl-CZb00seVZ2wbBz9QwK9cDTDlBow3A",
                "created": 1762599740,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "30": {
        "0": {
            "req_id": "30",
            "experiment_id": "run_0",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']",
                    "1": "['probability', 'taxonomy']"
                },
                "in_toks": 622,
                "out_toks": 1312,
                "id": "chatcmpl-CSnT1K1XVHTXXGavAXXMxEVktHVrZ",
                "created": 1760979371,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 662,
                "out_toks": 207,
                "id": "chatcmpl-CSnibxxrPNpw0EkvDCWxwKhQ6kDII",
                "created": 1760980337,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Predicted class per object from the light curve classifier (top-ranked class)\nSELECT\n    oid,\n    class_name,\n    probability\nFROM probability\nWHERE classifier_name = 'lc_classifier'\n  AND ranking = 1\nORDER BY oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Predicted class per object from the light curve classifier (top-ranked class)\nSELECT\n    oid,\n    class_name,\n    probability\nFROM probability\nWHERE classifier_name = 'lc_classifier'\n  AND ranking = 1\nORDER BY oid;\n```"
                },
                "in_toks": 1979,
                "out_toks": 511,
                "id": "chatcmpl-CSqtA3cUK23OhrKa3MaqMUecCivV6",
                "created": 1760992524,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "30",
            "experiment_id": "run_1",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']",
                    "1": "['probability', 'taxonomy']"
                },
                "in_toks": 622,
                "out_toks": 1312,
                "id": "chatcmpl-CSnT1K1XVHTXXGavAXXMxEVktHVrZ",
                "created": 1760979371,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 662,
                "out_toks": 399,
                "id": "chatcmpl-CSnifIzyBwVwgYZJjnHdtzCBODMWI",
                "created": 1760980341,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Predicted class for each object according to the light curve classifier (top-1 class)\nSELECT\n    oid,\n    class_name,\n    probability\nFROM probability\nWHERE classifier_name = 'lc_classifier'\n  AND ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Predicted class for each object according to the light curve classifier (top-1 class)\nSELECT\n    oid,\n    class_name,\n    probability\nFROM probability\nWHERE classifier_name = 'lc_classifier'\n  AND ranking = 1;\n```"
                },
                "in_toks": 1979,
                "out_toks": 318,
                "id": "chatcmpl-CSqtKXES7XxfI56C02nqugm2zrtIt",
                "created": 1760992534,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "30",
            "experiment_id": "run_2",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']"
                },
                "in_toks": 622,
                "out_toks": 336,
                "id": "chatcmpl-CSsZiAciHneqbKLvBN3A9WtdiPb7D",
                "created": 1760999006,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 662,
                "out_toks": 271,
                "id": "chatcmpl-CSxT3YH0XszV2WXd3N9vSdqEAHgB8",
                "created": 1761017813,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Predicted class for each object from the light curve classifier (top-1 per object)\nSELECT\n    probability.oid,\n    probability.class_name,\n    probability.probability\nFROM probability\nWHERE probability.classifier_name = 'lc_classifier'\n  AND probability.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Predicted class for each object from the light curve classifier (top-1 per object)\nSELECT\n    probability.oid,\n    probability.class_name,\n    probability.probability\nFROM probability\nWHERE probability.classifier_name = 'lc_classifier'\n  AND probability.ranking = 1;\n```"
                },
                "in_toks": 1979,
                "out_toks": 840,
                "id": "chatcmpl-CSxntQslAcAsu8ZWOy8zZHUYp66Yq",
                "created": 1761019105,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "30",
            "experiment_id": "run_3",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']"
                },
                "in_toks": 622,
                "out_toks": 400,
                "id": "chatcmpl-CSsZnmYNyCfsll8ZesboTgMdoTav5",
                "created": 1760999011,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 662,
                "out_toks": 207,
                "id": "chatcmpl-CSxT7JCXmqhDrfmO7LKQN5tdNQTKF",
                "created": 1761017817,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Predicted class per object using the light curve classifier (top-ranked class per object)\nSELECT\n    p.oid,\n    p.class_name,\n    p.probability\nFROM probability AS p\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Predicted class per object using the light curve classifier (top-ranked class per object)\nSELECT\n    p.oid,\n    p.class_name,\n    p.probability\nFROM probability AS p\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1;\n```"
                },
                "in_toks": 1979,
                "out_toks": 521,
                "id": "chatcmpl-CSxo7nv5kY9j0vZrMLVBMLVkiVYq9",
                "created": 1761019119,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "30",
            "experiment_id": "run_4",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']"
                },
                "in_toks": 622,
                "out_toks": 656,
                "id": "chatcmpl-CSsZu85PGjeDJw2N5HLTlp53b0mYH",
                "created": 1760999018,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 662,
                "out_toks": 335,
                "id": "chatcmpl-CSxT9TCZTDPpad6NcNlygJVIM0d2x",
                "created": 1761017819,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Predicted class per object from the light curve classifier (lc_classifier)\n-- Default conditions: use only the most likely class (ranking = 1)\nSELECT\n    oid,\n    class_name,\n    probability\nFROM probability\nWHERE\n    classifier_name = 'lc_classifier'\n    AND ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Predicted class per object from the light curve classifier (lc_classifier)\n-- Default conditions: use only the most likely class (ranking = 1)\nSELECT\n    oid,\n    class_name,\n    probability\nFROM probability\nWHERE\n    classifier_name = 'lc_classifier'\n    AND ranking = 1;\n```"
                },
                "in_toks": 1979,
                "out_toks": 844,
                "id": "chatcmpl-CSxoHrJ99YDtFhOXmztUm3M9srVPw",
                "created": 1761019129,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "30",
            "experiment_id": "run_5",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']"
                },
                "in_toks": 622,
                "out_toks": 272,
                "id": "chatcmpl-CZMNwc0GNGYbT2lMasjz0TiGM0zlg",
                "created": 1762543564,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 662,
                "out_toks": 271,
                "id": "chatcmpl-CZYHiWvh1xkOw4uTMeeIBECeDamRD",
                "created": 1762589306,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Predicted top class per object from the light curve classifier\nSELECT\n    p.oid,\n    p.class_name,\n    p.probability\nFROM probability AS p\nWHERE\n    p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Predicted top class per object from the light curve classifier\nSELECT\n    p.oid,\n    p.class_name,\n    p.probability\nFROM probability AS p\nWHERE\n    p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1;\n```"
                },
                "in_toks": 1979,
                "out_toks": 326,
                "id": "chatcmpl-CZZqLoAbuDnaiV0OckTLC2moRhPx4",
                "created": 1762595297,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "30",
            "experiment_id": "run_6",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']"
                },
                "in_toks": 622,
                "out_toks": 400,
                "id": "chatcmpl-CZMO3dbQFqrwc8KGUjSX8vXFfQh9G",
                "created": 1762543571,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 662,
                "out_toks": 207,
                "id": "chatcmpl-CZYHmwan97UZzNaq7bOmb15UNrQ9J",
                "created": 1762589310,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return the predicted class for each object using the Light Curve Classifier (top-ranked class per object)\nSELECT\n    p.oid,\n    p.class_name,\n    p.probability\nFROM probability AS p\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return the predicted class for each object using the Light Curve Classifier (top-ranked class per object)\nSELECT\n    p.oid,\n    p.class_name,\n    p.probability\nFROM probability AS p\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier';\n```"
                },
                "in_toks": 1979,
                "out_toks": 718,
                "id": "chatcmpl-CZa2o3DrDXvo44Ufx2Melw5NWl962",
                "created": 1762596070,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "30",
            "experiment_id": "run_7",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']"
                },
                "in_toks": 622,
                "out_toks": 464,
                "id": "chatcmpl-CZMOCpi9LzVelBLXYiKxNmvce76qN",
                "created": 1762543580,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 662,
                "out_toks": 271,
                "id": "chatcmpl-CZYHqLOs0mBMqPngEoR7NLzsjlJZW",
                "created": 1762589314,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Top-1 predicted class per object from the light curve classifier\nSELECT\n    p.oid,\n    p.class_name,\n    p.probability\nFROM probability AS p\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Top-1 predicted class per object from the light curve classifier\nSELECT\n    p.oid,\n    p.class_name,\n    p.probability\nFROM probability AS p\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1;\n```"
                },
                "in_toks": 1979,
                "out_toks": 517,
                "id": "chatcmpl-CZZqcvwEejKGaxCkboze59TMmKmG2",
                "created": 1762595314,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "30",
            "experiment_id": "run_8",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']"
                },
                "in_toks": 622,
                "out_toks": 720,
                "id": "chatcmpl-CZMOR2mbuFuD9lkEaMaml11PUkTwV",
                "created": 1762543595,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 662,
                "out_toks": 271,
                "id": "chatcmpl-CZYI1aAnKCUOzfuTvczGEueDD7AHX",
                "created": 1762589325,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Predicted (rank-1) class per object from the light curve classifier\nSELECT\n    oid,\n    class_name,\n    probability\nFROM probability\nWHERE classifier_name = 'lc_classifier'\n  AND ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Predicted (rank-1) class per object from the light curve classifier\nSELECT\n    oid,\n    class_name,\n    probability\nFROM probability\nWHERE classifier_name = 'lc_classifier'\n  AND ranking = 1;\n```"
                },
                "in_toks": 1979,
                "out_toks": 636,
                "id": "chatcmpl-CZa3GkIMUMRmaN1KsffM3F4qdZFBm",
                "created": 1762596098,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "30",
            "experiment_id": "run_9",
            "pred_tables": [
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy']"
                },
                "in_toks": 622,
                "out_toks": 720,
                "id": "chatcmpl-CZMOizP0usbD397XFzxpFZKm3GZir",
                "created": 1762543612,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 662,
                "out_toks": 335,
                "id": "chatcmpl-CZYI9Mr9x2Pu9dHy5FqlxfZ9qlamb",
                "created": 1762589333,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Predicted class per object using the light curve classifier (top-ranked class)\nSELECT\n    p.oid,\n    p.class_name,\n    p.probability\nFROM probability AS p\nWHERE\n    p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Predicted class per object using the light curve classifier (top-ranked class)\nSELECT\n    p.oid,\n    p.class_name,\n    p.probability\nFROM probability AS p\nWHERE\n    p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1;\n```"
                },
                "in_toks": 1979,
                "out_toks": 521,
                "id": "chatcmpl-CZZqxYcNYdri70Z1WXbDRLWK76kAv",
                "created": 1762595335,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "22": {
        "0": {
            "req_id": "22",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']",
                    "1": "['object', 'probability']"
                },
                "in_toks": 607,
                "out_toks": 1568,
                "id": "chatcmpl-CSnTHr0Ax5CW65adJ7RN0lYjuKyPg",
                "created": 1760979387,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1084,
                "out_toks": 207,
                "id": "chatcmpl-CSnilQMNk2e7IzEV1eCzfk6aoEyOE",
                "created": 1760980347,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects whose first detection (firstmjd) is between 2018-06-01 and 2018-07-01 (MJD in [58239.0, 58270.0))\n-- Restricted to classifications from the light curve classifier (lc_classifier) with ranking = 1 (most likely class)\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 58239.0\n    AND o.firstmjd < 58270.0\n    AND p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\nORDER BY o.firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects whose first detection (firstmjd) is between 2018-06-01 and 2018-07-01 (MJD in [58239.0, 58270.0))\n-- Restricted to classifications from the light curve classifier (lc_classifier) with ranking = 1 (most likely class)\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 58239.0\n    AND o.firstmjd < 58270.0\n    AND p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\nORDER BY o.firstmjd ASC;\n```"
                },
                "in_toks": 2438,
                "out_toks": 1252,
                "id": "chatcmpl-CSqs15Gehy5ufXRihoMoKZH4Jd61E",
                "created": 1760992453,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "22",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']",
                    "1": "['object', 'probability']"
                },
                "in_toks": 607,
                "out_toks": 1568,
                "id": "chatcmpl-CSnTHr0Ax5CW65adJ7RN0lYjuKyPg",
                "created": 1760979387,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1084,
                "out_toks": 271,
                "id": "chatcmpl-CSniqq8eNGw10WcauTZ7W6G8NcAlw",
                "created": 1760980352,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects first detected between 2018-06-01 (MJD 58239.0) inclusive and 2018-07-01 (MJD 58270.0) exclusive\n-- Restricted to the most likely class (ranking=1) from the light curve classifier ('lc_classifier')\nSELECT\n  o.*,\n  p.*\nFROM object AS o\nINNER JOIN probability AS p\n  ON p.oid = o.oid\nWHERE\n  o.firstmjd >= 58239.0\n  AND o.firstmjd < 58270.0\n  AND p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects first detected between 2018-06-01 (MJD 58239.0) inclusive and 2018-07-01 (MJD 58270.0) exclusive\n-- Restricted to the most likely class (ranking=1) from the light curve classifier ('lc_classifier')\nSELECT\n  o.*,\n  p.*\nFROM object AS o\nINNER JOIN probability AS p\n  ON p.oid = o.oid\nWHERE\n  o.firstmjd >= 58239.0\n  AND o.firstmjd < 58270.0\n  AND p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1;\n```"
                },
                "in_toks": 2438,
                "out_toks": 1240,
                "id": "chatcmpl-CSqs1x9u4rgP3q3ZQbXMWyC1QVYK3",
                "created": 1760992453,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "22",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']"
                },
                "in_toks": 607,
                "out_toks": 1168,
                "id": "chatcmpl-CSsa9gra1m9ooyj1IIidf42yn8sLY",
                "created": 1760999033,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1084,
                "out_toks": 463,
                "id": "chatcmpl-CSxTEwg62kNcSBYINIpfRVxOsMXDg",
                "created": 1761017824,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects with first detections between 2018-06-01 (MJD 58239.0) and 2018-07-01 (MJD 58270.0, exclusive)\n-- Filter to top-ranked ('ranking' = 1) classifications from the light curve classifier ('lc_classifier')\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\n    AND p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\nWHERE\n    o.firstmjd >= 58239.0\n    AND o.firstmjd < 58270.0;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with first detections between 2018-06-01 (MJD 58239.0) and 2018-07-01 (MJD 58270.0, exclusive)\n-- Filter to top-ranked ('ranking' = 1) classifications from the light curve classifier ('lc_classifier')\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\n    AND p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\nWHERE\n    o.firstmjd >= 58239.0\n    AND o.firstmjd < 58270.0;\n```"
                },
                "in_toks": 2438,
                "out_toks": 922,
                "id": "chatcmpl-CSxoUaTQp6FxykHhMASW0cvOHHk6J",
                "created": 1761019142,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "22",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 607,
                "out_toks": 979,
                "id": "chatcmpl-CSsaQ0RLrp9ejjga9gBjHKESylKFC",
                "created": 1760999050,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1129,
                "out_toks": 335,
                "id": "chatcmpl-CSxTKN1AgQtP91augXJCvQCQa8QC3",
                "created": 1761017830,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects first detected between 2018-06-01 (MJD 58239.0) inclusive and 2018-07-01 (MJD 58270.0) exclusive\n-- Restricted to classifications by the light curve classifier (lc_classifier) with top-ranked class (ranking = 1)\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 58239.0\n    AND o.firstmjd < 58270.0\n    AND p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects first detected between 2018-06-01 (MJD 58239.0) inclusive and 2018-07-01 (MJD 58270.0) exclusive\n-- Restricted to classifications by the light curve classifier (lc_classifier) with top-ranked class (ranking = 1)\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 58239.0\n    AND o.firstmjd < 58270.0\n    AND p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1;\n```"
                },
                "in_toks": 2483,
                "out_toks": 1115,
                "id": "chatcmpl-CSxogA0D9cdg95qWbTEoL8nxo1QLo",
                "created": 1761019154,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "22",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']"
                },
                "in_toks": 607,
                "out_toks": 464,
                "id": "chatcmpl-CSsaesFvIQZrDXKtQIcqcc4xbJVNZ",
                "created": 1760999064,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1084,
                "out_toks": 335,
                "id": "chatcmpl-CSxTPe0shwNJlnWYT3PA0fRzF16vv",
                "created": 1761017835,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects whose first detection (firstmjd) occurred between 2018-06-01 (MJD 58239.0)\n-- and 2018-07-01 (MJD 58270.0), with classifications from the light curve classifier\n-- considering only the top-ranked class (ranking = 1).\nSELECT *\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\nWHERE o.firstmjd >= 58239.0\n  AND o.firstmjd <= 58270.0\n  AND p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects whose first detection (firstmjd) occurred between 2018-06-01 (MJD 58239.0)\n-- and 2018-07-01 (MJD 58270.0), with classifications from the light curve classifier\n-- considering only the top-ranked class (ranking = 1).\nSELECT *\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\nWHERE o.firstmjd >= 58239.0\n  AND o.firstmjd <= 58270.0\n  AND p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1;\n```"
                },
                "in_toks": 2438,
                "out_toks": 722,
                "id": "chatcmpl-CSxoyroemG8sN4E0P9QC0uArBScV9",
                "created": 1761019172,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "22",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']"
                },
                "in_toks": 607,
                "out_toks": 656,
                "id": "chatcmpl-CZMOvRG9KtNwCBFvZkt7iTlc5gZc0",
                "created": 1762543625,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1084,
                "out_toks": 271,
                "id": "chatcmpl-CZYIEmjf22LslSzQtODXLl7rMH5mt",
                "created": 1762589338,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects first detected between 2018-06-01 (MJD 58239.0) and 2018-07-01 (MJD 58270.0)\n-- Restricted to sources classified by the light curve classifier (lc_classifier) with top-ranked class (ranking=1)\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\n   AND p.classifier_name = 'lc_classifier'\n   AND p.ranking = 1\nWHERE\n    o.firstmjd BETWEEN 58239.0 AND 58270.0;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects first detected between 2018-06-01 (MJD 58239.0) and 2018-07-01 (MJD 58270.0)\n-- Restricted to sources classified by the light curve classifier (lc_classifier) with top-ranked class (ranking=1)\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\n   AND p.classifier_name = 'lc_classifier'\n   AND p.ranking = 1\nWHERE\n    o.firstmjd BETWEEN 58239.0 AND 58270.0;\n```"
                },
                "in_toks": 2438,
                "out_toks": 1232,
                "id": "chatcmpl-CZa3cVIDmzelIT9ELgsf3fyfP6SbS",
                "created": 1762596120,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "22",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']"
                },
                "in_toks": 607,
                "out_toks": 528,
                "id": "chatcmpl-CZMP8e4mjco3k5RxKZ4N8aF7nZgYP",
                "created": 1762543638,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1084,
                "out_toks": 207,
                "id": "chatcmpl-CZYITUWJJUCKwHGntinN8Wh9nbJqM",
                "created": 1762589353,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects with first detection between 2018-06-01 (MJD 58239.0) and 2018-07-01 (MJD 58270.0)\n-- Classified by the light curve classifier (lc_classifier) with top-ranked class (ranking = 1)\nSELECT\n  o.*,\n  p.*\nFROM object AS o\nINNER JOIN probability AS p\n  ON p.oid = o.oid\nWHERE\n  o.firstmjd BETWEEN 58239.0 AND 58270.0\n  AND p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with first detection between 2018-06-01 (MJD 58239.0) and 2018-07-01 (MJD 58270.0)\n-- Classified by the light curve classifier (lc_classifier) with top-ranked class (ranking = 1)\nSELECT\n  o.*,\n  p.*\nFROM object AS o\nINNER JOIN probability AS p\n  ON p.oid = o.oid\nWHERE\n  o.firstmjd BETWEEN 58239.0 AND 58270.0\n  AND p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1;\n```"
                },
                "in_toks": 2438,
                "out_toks": 1359,
                "id": "chatcmpl-CZZqz7e1QMbpGlzJ387CmTqndj0xL",
                "created": 1762595337,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "22",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']"
                },
                "in_toks": 607,
                "out_toks": 656,
                "id": "chatcmpl-CZMPJuRJBEN7vjXxbvqErWXHTq6N1",
                "created": 1762543649,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1084,
                "out_toks": 399,
                "id": "chatcmpl-CZYIXyKzdFpz3uLwHZTzFQrkm076z",
                "created": 1762589357,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects with first detection between 2018-06-01 (MJD 58239.0) and 2018-07-01 (MJD 58270.0),\n-- classified by the light curve classifier (lc_classifier) with top-ranked class (ranking = 1)\nSELECT\n    object.*,\n    probability.*\nFROM object\nINNER JOIN probability\n    ON probability.oid = object.oid\nWHERE\n    probability.ranking = 1\n    AND probability.classifier_name = 'lc_classifier'\n    AND object.firstmjd BETWEEN 58239.0 AND 58270.0\nORDER BY\n    object.firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with first detection between 2018-06-01 (MJD 58239.0) and 2018-07-01 (MJD 58270.0),\n-- classified by the light curve classifier (lc_classifier) with top-ranked class (ranking = 1)\nSELECT\n    object.*,\n    probability.*\nFROM object\nINNER JOIN probability\n    ON probability.oid = object.oid\nWHERE\n    probability.ranking = 1\n    AND probability.classifier_name = 'lc_classifier'\n    AND object.firstmjd BETWEEN 58239.0 AND 58270.0\nORDER BY\n    object.firstmjd ASC;\n```"
                },
                "in_toks": 2438,
                "out_toks": 981,
                "id": "chatcmpl-CZZrV0OoF0NWpF94Kx8AGm7bQ0qJ4",
                "created": 1762595369,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "22",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']"
                },
                "in_toks": 607,
                "out_toks": 656,
                "id": "chatcmpl-CZMPbJ7M4bCkRNj2Q7aqiiHVYVQwX",
                "created": 1762543667,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1084,
                "out_toks": 271,
                "id": "chatcmpl-CZYIgm0sbVKtkSwR3o6oFrE6L37na",
                "created": 1762589366,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects whose first detection occurred between 2018-06-01 (MJD 58239.0) and 2018-07-01 (MJD 58270.0)\n-- Filter to the most likely class (ranking=1) from the light curve classifier ('lc_classifier')\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 58239.0\n    AND o.firstmjd < 58270.0\n    AND p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\nORDER BY o.firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects whose first detection occurred between 2018-06-01 (MJD 58239.0) and 2018-07-01 (MJD 58270.0)\n-- Filter to the most likely class (ranking=1) from the light curve classifier ('lc_classifier')\nSELECT\n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    o.firstmjd >= 58239.0\n    AND o.firstmjd < 58270.0\n    AND p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\nORDER BY o.firstmjd ASC;\n```"
                },
                "in_toks": 2438,
                "out_toks": 1055,
                "id": "chatcmpl-CZa4MX5EGpiGBqc4VIvfbQJFNQVdf",
                "created": 1762596166,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "22",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']"
                },
                "in_toks": 607,
                "out_toks": 400,
                "id": "chatcmpl-CZMPxpjdt5QBWgqPea5G3cWHaJUGn",
                "created": 1762543689,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1084,
                "out_toks": 399,
                "id": "chatcmpl-CZYIm85NGpTTqJxe6vQa6wuBfxLwL",
                "created": 1762589372,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects first detected between 2018-06-01 (MJD 58239.0) and 2018-07-01 (MJD 58270.0)\n-- and classified by the light curve classifier (lc_classifier) with top-ranked class (ranking = 1)\nSELECT \n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE \n    o.firstmjd BETWEEN 58239.0 AND 58270.0\n    AND p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects first detected between 2018-06-01 (MJD 58239.0) and 2018-07-01 (MJD 58270.0)\n-- and classified by the light curve classifier (lc_classifier) with top-ranked class (ranking = 1)\nSELECT \n    o.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE \n    o.firstmjd BETWEEN 58239.0 AND 58270.0\n    AND p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1;\n```"
                },
                "in_toks": 2438,
                "out_toks": 1039,
                "id": "chatcmpl-CZZrxhYLjaJqjFL2xipPcjwps3M4T",
                "created": 1762595397,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "12": {
        "0": {
            "req_id": "12",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']",
                    "1": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 653,
                "out_toks": 2150,
                "id": "chatcmpl-CSnTT8yCeNaCUKhjsuJkwTEJHOpEw",
                "created": 1760979399,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1175,
                "out_toks": 463,
                "id": "chatcmpl-CSniwbd3kEFM91KNxcaDCHl5BS2Y7",
                "created": 1760980358,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n/* SNe are the Supernova classes in lc_classifier: SNIa, SNIbc, SNII, SLSN */\n/* First occurrence window: MJD 59988.0 (Feb 13) to 60197.0 (Sep 10) */\n/* Spatial filter: inside the given polygon using Q3C */\nSELECT\n  o.oid,\n  o.meanra,\n  o.meandec\nFROM object o\nWHERE\n  o.firstmjd BETWEEN 59988.0 AND 60197.0\n  AND q3c_poly_query(o.meanra, o.meandec, '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon)\n  AND EXISTS (\n    SELECT 1\n    FROM probability p\n    WHERE\n      p.oid = o.oid\n      AND p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n      AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n  );\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* SNe are the Supernova classes in lc_classifier: SNIa, SNIbc, SNII, SLSN */\n/* First occurrence window: MJD 59988.0 (Feb 13) to 60197.0 (Sep 10) */\n/* Spatial filter: inside the given polygon using Q3C */\nSELECT\n  o.oid,\n  o.meanra,\n  o.meandec\nFROM object o\nWHERE\n  o.firstmjd BETWEEN 59988.0 AND 60197.0\n  AND q3c_poly_query(o.meanra, o.meandec, '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon)\n  AND EXISTS (\n    SELECT 1\n    FROM probability p\n    WHERE\n      p.oid = o.oid\n      AND p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n      AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n  );\n```"
                },
                "in_toks": 2528,
                "out_toks": 2098,
                "id": "chatcmpl-CSqs1SlM0kQmCpf6cL0wXh31Q7Bmr",
                "created": 1760992453,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "12",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']",
                    "1": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 653,
                "out_toks": 2150,
                "id": "chatcmpl-CSnTT8yCeNaCUKhjsuJkwTEJHOpEw",
                "created": 1760979399,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1175,
                "out_toks": 463,
                "id": "chatcmpl-CSnj5giFmfRp81QRGeVR65pDbeR7A",
                "created": 1760980367,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- SNe = {'SNIa','SNIbc','SNII','SLSN'} in lc_classifier (top-1 only)\n-- firstmjd between 2023-02-13 (MJD 59988.0) and 2023-09-10 (MJD 60197.0)\n-- Spatial filter: objects within the given polygon via q3c_poly_query\nSELECT DISTINCT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(\n        o.meanra,\n        o.meandec,\n        '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon\n    );\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- SNe = {'SNIa','SNIbc','SNII','SLSN'} in lc_classifier (top-1 only)\n-- firstmjd between 2023-02-13 (MJD 59988.0) and 2023-09-10 (MJD 60197.0)\n-- Spatial filter: objects within the given polygon via q3c_poly_query\nSELECT DISTINCT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(\n        o.meanra,\n        o.meandec,\n        '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon\n    );\n```"
                },
                "in_toks": 2528,
                "out_toks": 1468,
                "id": "chatcmpl-CSqs1foLEahcITRQbTHGPAk4Hhoh4",
                "created": 1760992453,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "12",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 653,
                "out_toks": 915,
                "id": "chatcmpl-CSsajCReXtqsTgJGivZAm9mZth8ey",
                "created": 1760999069,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1175,
                "out_toks": 463,
                "id": "chatcmpl-CSxTVW2iAqVXg95ZGVhfn6i92xV6o",
                "created": 1761017841,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- SNe (SNIa, SNIbc, SNII, SLSN) with first detection between MJD 59988.0 (Feb 13) and 60197.0 (Sep 10)\n-- within the specified polygon, returning oid, meanra, meandec.\nSELECT DISTINCT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'lc_classifier'  -- default condition\n    AND p.ranking = 1                    -- default condition (most likely class)\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')  -- all SuperNova types\n    AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(\n        o.meanra,\n        o.meandec,\n        '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon\n    );\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- SNe (SNIa, SNIbc, SNII, SLSN) with first detection between MJD 59988.0 (Feb 13) and 60197.0 (Sep 10)\n-- within the specified polygon, returning oid, meanra, meandec.\nSELECT DISTINCT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'lc_classifier'  -- default condition\n    AND p.ranking = 1                    -- default condition (most likely class)\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')  -- all SuperNova types\n    AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(\n        o.meanra,\n        o.meandec,\n        '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon\n    );\n```"
                },
                "in_toks": 2528,
                "out_toks": 1787,
                "id": "chatcmpl-CSxp92SioDsNPsbiDqgfK1xd6NrVT",
                "created": 1761019183,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "12",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 653,
                "out_toks": 1107,
                "id": "chatcmpl-CSsawkymy7yhZCZAR76pal0lEoQr0",
                "created": 1760999082,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1175,
                "out_toks": 335,
                "id": "chatcmpl-CSxTak8Y9f1vemdDEAHHENquiLdcc",
                "created": 1761017846,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return oids, meanra, meandec for SuperNovae (SNIa, SNIbc, SNII, SLSN)\n-- First detection between 2023-02-13 (MJD 59988.0) and 2023-09-10 (MJD 60197.0)\n-- Spatial filter: within the given spherical polygon\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'lc_classifier'            -- default classifier\n    AND p.ranking = 1                               -- most likely class\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')  -- all SNe types\n    AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(\n        o.meanra,\n        o.meandec,\n        '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon\n    );\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return oids, meanra, meandec for SuperNovae (SNIa, SNIbc, SNII, SLSN)\n-- First detection between 2023-02-13 (MJD 59988.0) and 2023-09-10 (MJD 60197.0)\n-- Spatial filter: within the given spherical polygon\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'lc_classifier'            -- default classifier\n    AND p.ranking = 1                               -- most likely class\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')  -- all SNe types\n    AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(\n        o.meanra,\n        o.meandec,\n        '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon\n    );\n```"
                },
                "in_toks": 2528,
                "out_toks": 1543,
                "id": "chatcmpl-CSxh4FXbsD0uFhJAkNAniRyzltATr",
                "created": 1761018682,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "12",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 653,
                "out_toks": 787,
                "id": "chatcmpl-CSsbBK9rhJUzT0UjYhQYfnqccdJQV",
                "created": 1760999097,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1175,
                "out_toks": 719,
                "id": "chatcmpl-CSxTee6SmnWo1gTFMliNjnQRDie2E",
                "created": 1761017850,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return SNe (SNIa, SNIbc, SNII, SLSN) with top-ranked lc_classifier probabilities\n-- First detection between MJD 59988.0 (Feb 13) and 60197.0 (Sep 10), inclusive\n-- Within the specified spherical polygon\nSELECT DISTINCT\n  o.oid,\n  o.meanra,\n  o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n  ON p.oid = o.oid\nWHERE\n  p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n  AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n  AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n  AND q3c_poly_query(o.meanra, o.meandec, '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return SNe (SNIa, SNIbc, SNII, SLSN) with top-ranked lc_classifier probabilities\n-- First detection between MJD 59988.0 (Feb 13) and 60197.0 (Sep 10), inclusive\n-- Within the specified spherical polygon\nSELECT DISTINCT\n  o.oid,\n  o.meanra,\n  o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n  ON p.oid = o.oid\nWHERE\n  p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n  AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n  AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n  AND q3c_poly_query(o.meanra, o.meandec, '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon);\n```"
                },
                "in_toks": 2528,
                "out_toks": 1890,
                "id": "chatcmpl-CSxhTqP0IKV7C5H3xYm5etoR9cJqb",
                "created": 1761018707,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "12",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 653,
                "out_toks": 979,
                "id": "chatcmpl-CZMQCaZj68BBqgdmGqhgTmIYyL7G2",
                "created": 1762543704,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1175,
                "out_toks": 463,
                "id": "chatcmpl-CZYIweKZaF7wBm5ZAE0yk6ezDUwZR",
                "created": 1762589382,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- SNe classes in 'lc_classifier' are: 'SNIa', 'SNIbc', 'SNII', 'SLSN'\n-- MJD range: February 13 = 59988.0, September 10 = 60197.0\nSELECT DISTINCT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(o.meanra, o.meandec, '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- SNe classes in 'lc_classifier' are: 'SNIa', 'SNIbc', 'SNII', 'SLSN'\n-- MJD range: February 13 = 59988.0, September 10 = 60197.0\nSELECT DISTINCT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(o.meanra, o.meandec, '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon);\n```"
                },
                "in_toks": 2528,
                "out_toks": 1690,
                "id": "chatcmpl-CZa4wWwBweMjDscm4H6AKIxrqTGdz",
                "created": 1762596202,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "12",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 653,
                "out_toks": 723,
                "id": "chatcmpl-CZMQa0dagmQ4DwVdDU4BWwUKE1mkY",
                "created": 1762543728,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1175,
                "out_toks": 463,
                "id": "chatcmpl-CZYJ5aIH9otFN1VKEFSLaJbxOyDZJ",
                "created": 1762589391,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- SNe = {'SNIa','SNIbc','SNII','SLSN'} from lc_classifier with ranking=1\n-- firstmjd between 2023-02-13 (MJD 59988.0) and 2023-09-10 (MJD 60197.0)\n-- spatial filter: objects inside given polygon (RA,Dec) in degrees\nSELECT DISTINCT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(o.meanra, o.meandec, '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- SNe = {'SNIa','SNIbc','SNII','SLSN'} from lc_classifier with ranking=1\n-- firstmjd between 2023-02-13 (MJD 59988.0) and 2023-09-10 (MJD 60197.0)\n-- spatial filter: objects inside given polygon (RA,Dec) in degrees\nSELECT DISTINCT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(o.meanra, o.meandec, '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon);\n```"
                },
                "in_toks": 2528,
                "out_toks": 1525,
                "id": "chatcmpl-CZZsLSMffJpw6DBOHQYYznRUtKrgi",
                "created": 1762595421,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "12",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 653,
                "out_toks": 787,
                "id": "chatcmpl-CZMQsbgZLjd6DJ4CdMKcXBmD3Ax9r",
                "created": 1762543746,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1175,
                "out_toks": 399,
                "id": "chatcmpl-CZYJEjr3no8Qt62nkKSu60iko71JT",
                "created": 1762589400,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- SNe = {'SNIa','SNIbc','SNII','SLSN'} using lc_classifier with top rank (ranking=1)\n-- Time window: firstmjd between 59988.0 (Feb 13) and 60197.0 (Sep 10)\n-- Spatial filter: objects within the given spherical polygon using Q3C\nSELECT DISTINCT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(o.meanra, o.meandec, '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- SNe = {'SNIa','SNIbc','SNII','SLSN'} using lc_classifier with top rank (ranking=1)\n-- Time window: firstmjd between 59988.0 (Feb 13) and 60197.0 (Sep 10)\n-- Spatial filter: objects within the given spherical polygon using Q3C\nSELECT DISTINCT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(o.meanra, o.meandec, '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon);\n```"
                },
                "in_toks": 2528,
                "out_toks": 1966,
                "id": "chatcmpl-CZZsUKJpx3MM8TloqVLgdounLO1mT",
                "created": 1762595430,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "12",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 653,
                "out_toks": 1235,
                "id": "chatcmpl-CZMRBmZexmVpotZlT2UXVsUqmif4R",
                "created": 1762543765,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1175,
                "out_toks": 463,
                "id": "chatcmpl-CZYJQ1hQgDbGXJN1rv4rcxaUfHkHG",
                "created": 1762589412,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- SNe = ('SNIa','SNIbc','SNII','SLSN')\n-- MJD window: Feb 13 = 59988.0, Sep 10 = 60197.0 (inclusive)\nSELECT DISTINCT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(\n        o.meanra,\n        o.meandec,\n        '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon\n    );\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- SNe = ('SNIa','SNIbc','SNII','SLSN')\n-- MJD window: Feb 13 = 59988.0, Sep 10 = 60197.0 (inclusive)\nSELECT DISTINCT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(\n        o.meanra,\n        o.meandec,\n        '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon\n    );\n```"
                },
                "in_toks": 2528,
                "out_toks": 1880,
                "id": "chatcmpl-CZZsXibzXubEakEGJYKqrwZYOgSmw",
                "created": 1762595433,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "12",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 653,
                "out_toks": 723,
                "id": "chatcmpl-CZMRZ9TIYSUeyrudm4Vdmjqlk5lgY",
                "created": 1762543789,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1175,
                "out_toks": 399,
                "id": "chatcmpl-CZYJaNUzSN96hbXqcT19DxLC6XUgx",
                "created": 1762589422,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- SNe = {'SNIa','SNIbc','SNII','SLSN'}\n-- MJD window: 2023-02-13 (59988.0) to 2023-09-10 (60197.0)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object o\nWHERE\n    o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(\n        o.meanra,\n        o.meandec,\n        '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon\n    )\n    AND EXISTS (\n        SELECT 1\n        FROM probability p\n        WHERE\n            p.oid = o.oid\n            AND p.ranking = 1\n            AND p.classifier_name = 'lc_classifier'\n            AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    );\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- SNe = {'SNIa','SNIbc','SNII','SLSN'}\n-- MJD window: 2023-02-13 (59988.0) to 2023-09-10 (60197.0)\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec\nFROM object o\nWHERE\n    o.firstmjd BETWEEN 59988.0 AND 60197.0\n    AND q3c_poly_query(\n        o.meanra,\n        o.meandec,\n        '((-20, -20), (-2, -20), (20, 1), (10, 10))'::polygon\n    )\n    AND EXISTS (\n        SELECT 1\n        FROM probability p\n        WHERE\n            p.oid = o.oid\n            AND p.ranking = 1\n            AND p.classifier_name = 'lc_classifier'\n            AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    );\n```"
                },
                "in_toks": 2528,
                "out_toks": 2599,
                "id": "chatcmpl-CZZtBSGCOrSJG9hNfMWoh6FPuYAx3",
                "created": 1762595473,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "57": {
        "0": {
            "req_id": "57",
            "experiment_id": "run_0",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']",
                    "1": "['object']"
                },
                "in_toks": 727,
                "out_toks": 920,
                "id": "chatcmpl-CSnTrN76BI08i8wmTdm7ETTg9J4MO",
                "created": 1760979423,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized by performing two independent Q3C cone searches and UNION ALL.\n-- This avoids a join that can disable index usage and cause timeouts.\n-- We keep lastmjd only to sort, then project requested columns.\nWITH hits AS\n  (SELECT 'id_1'::text AS identifier,\n          354.67::double precision AS ra,\n          15.954::double precision AS dec,\n          (30.0/3600.0)::double precision AS radius_deg,\n          o.oid,\n          o.ndet,\n          o.meanra,\n          o.meandec,\n          o.firstmjd,\n          o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n   UNION ALL SELECT 'id_2'::text AS identifier,\n                    20.7993::double precision AS ra,\n                    1.00331::double precision AS dec,\n                    (20.0/3600.0)::double precision AS radius_deg,\n                    o.oid,\n                    o.ndet,\n                    o.meanra,\n                    o.meandec,\n                    o.firstmjd,\n                    o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0))\nSELECT identifier,\n       ra, dec, radius_deg,\n                oid,\n                ndet,\n                meanra,\n                meandec,\n                firstmjd\nFROM hits\nORDER BY lastmjd DESC;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized by performing two independent Q3C cone searches and UNION ALL.\n-- This avoids a join that can disable index usage and cause timeouts.\n-- We keep lastmjd only to sort, then project requested columns.\nWITH hits AS\n  (SELECT 'id_1'::text AS identifier,\n          354.67::double precision AS ra,\n          15.954::double precision AS dec,\n          (30.0/3600.0)::double precision AS radius_deg,\n          o.oid,\n          o.ndet,\n          o.meanra,\n          o.meandec,\n          o.firstmjd,\n          o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n   UNION ALL SELECT 'id_2'::text AS identifier,\n                    20.7993::double precision AS ra,\n                    1.00331::double precision AS dec,\n                    (20.0/3600.0)::double precision AS radius_deg,\n                    o.oid,\n                    o.ndet,\n                    o.meanra,\n                    o.meandec,\n                    o.firstmjd,\n                    o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0))\nSELECT identifier,\n       ra, dec, radius_deg,\n                oid,\n                ndet,\n                meanra,\n                meandec,\n                firstmjd\nFROM hits\nORDER BY lastmjd DESC;"
                },
                "in_toks": 1544,
                "out_toks": 2226,
                "id": "chatcmpl-CbGz0zOJIKnklNf299M9kWpvyUxLX",
                "created": 1762999454,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1020,
                "out_toks": 335,
                "id": "chatcmpl-CSnjDeH4adwUjkOqJ3XXKFdeTghON",
                "created": 1760980375,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find ZTF objects within specified radii of two input sources using Q3C cone searches\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        -- radius in degrees: 30 arcsec = 30/3600 deg; 20 arcsec = 20/3600 deg\n        ('id_1', 354.67,   15.954,   30.0/3600.0),\n        ('id_2',  20.7993,  1.00331, 20.0/3600.0)\n)\nSELECT\n    -- Input object info\n    c.identifier,\n    c.ra,\n    c.dec,\n    c.radius_deg,\n    -- Matched ZTF object info\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd\nFROM object o\nINNER JOIN catalog c\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find ZTF objects within specified radii of two input sources using Q3C cone searches\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        -- radius in degrees: 30 arcsec = 30/3600 deg; 20 arcsec = 20/3600 deg\n        ('id_1', 354.67,   15.954,   30.0/3600.0),\n        ('id_2',  20.7993,  1.00331, 20.0/3600.0)\n)\nSELECT\n    -- Input object info\n    c.identifier,\n    c.ra,\n    c.dec,\n    c.radius_deg,\n    -- Matched ZTF object info\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd\nFROM object o\nINNER JOIN catalog c\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```"
                },
                "in_toks": 2338,
                "out_toks": 2036,
                "id": "chatcmpl-CSqs1Ep5eCUhRjU6qQjaTLoUM4XHa",
                "created": 1760992453,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "1": {
            "req_id": "57",
            "experiment_id": "run_1",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']",
                    "1": "['object']"
                },
                "in_toks": 727,
                "out_toks": 920,
                "id": "chatcmpl-CSnTrN76BI08i8wmTdm7ETTg9J4MO",
                "created": 1760979423,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query: use two independent q3c index-accelerated searches and UNION ALL,\n-- then sort by last detection date. This avoids the join over a function that caused timeouts.\nWITH sel AS\n  (-- Search around id_1: (RA, Dec) = (354.67, 15.954) within 30 arcsec (30/3600 deg)\n SELECT 'id_1'::text AS identifier,\n        354.67::double precision AS ra,\n        15.954::double precision AS dec,\n        (30.0/3600.0)::double precision AS radius_deg,\n        o.oid,\n        o.ndet,\n        o.meanra,\n        o.meandec,\n        o.firstmjd,\n        o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n   UNION ALL -- Search around id_2: (RA, Dec) = (20.7993, 1.00331) within 20 arcsec (20/3600 deg)\n SELECT 'id_2'::text AS identifier,\n        20.7993::double precision AS ra,\n        1.00331::double precision AS dec,\n        (20.0/3600.0)::double precision AS radius_deg,\n        o.oid,\n        o.ndet,\n        o.meanra,\n        o.meandec,\n        o.firstmjd,\n        o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0))\nSELECT identifier,\n       ra, dec, radius_deg,\n                oid,\n                ndet,\n                meanra,\n                meandec,\n                firstmjd\nFROM sel\nORDER BY lastmjd DESC;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query: use two independent q3c index-accelerated searches and UNION ALL,\n-- then sort by last detection date. This avoids the join over a function that caused timeouts.\nWITH sel AS\n  (-- Search around id_1: (RA, Dec) = (354.67, 15.954) within 30 arcsec (30/3600 deg)\n SELECT 'id_1'::text AS identifier,\n        354.67::double precision AS ra,\n        15.954::double precision AS dec,\n        (30.0/3600.0)::double precision AS radius_deg,\n        o.oid,\n        o.ndet,\n        o.meanra,\n        o.meandec,\n        o.firstmjd,\n        o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n   UNION ALL -- Search around id_2: (RA, Dec) = (20.7993, 1.00331) within 20 arcsec (20/3600 deg)\n SELECT 'id_2'::text AS identifier,\n        20.7993::double precision AS ra,\n        1.00331::double precision AS dec,\n        (20.0/3600.0)::double precision AS radius_deg,\n        o.oid,\n        o.ndet,\n        o.meanra,\n        o.meandec,\n        o.firstmjd,\n        o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0))\nSELECT identifier,\n       ra, dec, radius_deg,\n                oid,\n                ndet,\n                meanra,\n                meandec,\n                firstmjd\nFROM sel\nORDER BY lastmjd DESC;"
                },
                "in_toks": 1535,
                "out_toks": 1782,
                "id": "chatcmpl-CbGzcOh9EuVSK8wDZgvGmDhilp3Ug",
                "created": 1762999492,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1020,
                "out_toks": 463,
                "id": "chatcmpl-CSnjLAg4dFpPbeGKgACJmOtBwkmhu",
                "created": 1760980383,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find ZTF objects within 30\" of id_1 (354.67, 15.954) or 20\" of id_2 (20.7993, 1.00331)\n-- Radii are provided in degrees (arcsec/3600)\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        ('id_1', 354.67, 15.954, 30.0/3600.0),\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0)\n)\nSELECT\n    c.identifier,\n    c.ra,\n    c.dec,\n    c.radius_deg,\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd\nFROM catalog c\nINNER JOIN object o\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find ZTF objects within 30\" of id_1 (354.67, 15.954) or 20\" of id_2 (20.7993, 1.00331)\n-- Radii are provided in degrees (arcsec/3600)\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        ('id_1', 354.67, 15.954, 30.0/3600.0),\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0)\n)\nSELECT\n    c.identifier,\n    c.ra,\n    c.dec,\n    c.radius_deg,\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd\nFROM catalog c\nINNER JOIN object o\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```"
                },
                "in_toks": 2338,
                "out_toks": 1960,
                "id": "chatcmpl-CSqsHDvwmXVGGOWJTOCiLikslVXxv",
                "created": 1760992469,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "2": {
            "req_id": "57",
            "experiment_id": "run_2",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 727,
                "out_toks": 524,
                "id": "chatcmpl-CSsbMyAXNmT9jhPYZqS1ndKqbngPL",
                "created": 1760999108,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "/* Optimized cone searches using constants so the Q3C index on object(meanra, meandec) can be used efficiently.\n   We union the two small searches instead of joining against a VALUES CTE to avoid a full table scan.\n   Sorted by last detection date (lastmjd) in descending order as requested. */\nSELECT 'id_1'::text AS identifier,\n       354.67::double precision AS ra,\n       15.954::double precision AS dec,\n       (30.0/3600.0)::double precision AS radius_deg, -- 30 arcsec in degrees\n o.oid AS ztf_oid,\n o.ndet,\n o.meanra,\n o.meandec,\n o.firstmjd\nFROM OBJECT o\nWHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\nUNION ALL\nSELECT 'id_2'::text AS identifier,\n       20.7993::double precision AS ra,\n       1.00331::double precision AS dec,\n       (20.0/3600.0)::double precision AS radius_deg, -- 20 arcsec in degrees\n o.oid AS ztf_oid,\n o.ndet,\n o.meanra,\n o.meandec,\n o.firstmjd\nFROM OBJECT o\nWHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0)\nORDER BY o.lastmjd DESC;",
            "sql_response": {
                "responses": {
                    "0": "/* Optimized cone searches using constants so the Q3C index on object(meanra, meandec) can be used efficiently.\n   We union the two small searches instead of joining against a VALUES CTE to avoid a full table scan.\n   Sorted by last detection date (lastmjd) in descending order as requested. */\nSELECT 'id_1'::text AS identifier,\n       354.67::double precision AS ra,\n       15.954::double precision AS dec,\n       (30.0/3600.0)::double precision AS radius_deg, -- 30 arcsec in degrees\n o.oid AS ztf_oid,\n o.ndet,\n o.meanra,\n o.meandec,\n o.firstmjd\nFROM OBJECT o\nWHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\nUNION ALL\nSELECT 'id_2'::text AS identifier,\n       20.7993::double precision AS ra,\n       1.00331::double precision AS dec,\n       (20.0/3600.0)::double precision AS radius_deg, -- 20 arcsec in degrees\n o.oid AS ztf_oid,\n o.ndet,\n o.meanra,\n o.meandec,\n o.firstmjd\nFROM OBJECT o\nWHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0)\nORDER BY o.lastmjd DESC;"
                },
                "in_toks": 1503,
                "out_toks": 2021,
                "id": "chatcmpl-CbGzxumtZDopbSJCUQbAsJ9ROs3bh",
                "created": 1762999513,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1020,
                "out_toks": 527,
                "id": "chatcmpl-CSxTmdLUqvtu5MZHApuMdi99eaSFH",
                "created": 1761017858,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n/* Cone search around two input positions using Q3C, returning input metadata and matched ZTF object info */\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        ('id_1', 354.67, 15.954, 30.0/3600.0),   -- 30 arcsec in degrees\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0) -- 20 arcsec in degrees\n)\nSELECT\n    c.identifier,\n    c.ra,\n    c.dec,\n    c.radius_deg,\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd\nFROM object o\nINNER JOIN catalog c\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* Cone search around two input positions using Q3C, returning input metadata and matched ZTF object info */\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        ('id_1', 354.67, 15.954, 30.0/3600.0),   -- 30 arcsec in degrees\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0) -- 20 arcsec in degrees\n)\nSELECT\n    c.identifier,\n    c.ra,\n    c.dec,\n    c.radius_deg,\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd\nFROM object o\nINNER JOIN catalog c\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```"
                },
                "in_toks": 2338,
                "out_toks": 1878,
                "id": "chatcmpl-CSxhoI3B5Tm8Kp48LleRDeVRnkn1V",
                "created": 1761018728,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "3": {
            "req_id": "57",
            "experiment_id": "run_3",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 727,
                "out_toks": 332,
                "id": "chatcmpl-CSsbTInbpmO5XSHWjq8IvI0zNrBup",
                "created": 1760999115,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "/* Optimized query: use two separate q3c_radial_query filters with constants and UNION ALL\n   to avoid a join over the full object table. This leverages the q3c index on (meanra, meandec)\n   and sorts by last detection date (lastmjd) descending. */ WITH matches AS\n  (SELECT 'id_1'::text AS identifier,\n          354.67::double precision AS ra,\n          15.954::double precision AS dec,\n          (30.0/3600.0)::double precision AS radius_deg,\n          o.oid,\n          o.ndet,\n          o.meanra,\n          o.meandec,\n          o.firstmjd,\n          o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n   UNION ALL SELECT 'id_2'::text AS identifier,\n                    20.7993::double precision AS ra,\n                    1.00331::double precision AS dec,\n                    (20.0/3600.0)::double precision AS radius_deg,\n                    o.oid,\n                    o.ndet,\n                    o.meanra,\n                    o.meandec,\n                    o.firstmjd,\n                    o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0))\nSELECT identifier,\n       ra, dec, radius_deg,\n                oid,\n                ndet,\n                meanra,\n                meandec,\n                firstmjd\nFROM matches\nORDER BY lastmjd DESC;",
            "sql_response": {
                "responses": {
                    "0": "/* Optimized query: use two separate q3c_radial_query filters with constants and UNION ALL\n   to avoid a join over the full object table. This leverages the q3c index on (meanra, meandec)\n   and sorts by last detection date (lastmjd) descending. */ WITH matches AS\n  (SELECT 'id_1'::text AS identifier,\n          354.67::double precision AS ra,\n          15.954::double precision AS dec,\n          (30.0/3600.0)::double precision AS radius_deg,\n          o.oid,\n          o.ndet,\n          o.meanra,\n          o.meandec,\n          o.firstmjd,\n          o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n   UNION ALL SELECT 'id_2'::text AS identifier,\n                    20.7993::double precision AS ra,\n                    1.00331::double precision AS dec,\n                    (20.0/3600.0)::double precision AS radius_deg,\n                    o.oid,\n                    o.ndet,\n                    o.meanra,\n                    o.meandec,\n                    o.firstmjd,\n                    o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0))\nSELECT identifier,\n       ra, dec, radius_deg,\n                oid,\n                ndet,\n                meanra,\n                meandec,\n                firstmjd\nFROM matches\nORDER BY lastmjd DESC;"
                },
                "in_toks": 1580,
                "out_toks": 3269,
                "id": "chatcmpl-CbH0SzlrkEqpIU2OCApbc7iR4eygH",
                "created": 1762999544,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1020,
                "out_toks": 207,
                "id": "chatcmpl-CSxTspua4o6ur2MUrrAHni76AhPDF",
                "created": 1761017864,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find ZTF objects within 30\" of id_1 (354.67, 15.954) or 20\" of id_2 (20.7993, 1.00331)\n-- Returns input identifier, input coordinates, search radius (deg), and matched ZTF object info\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        ('id_1', 354.67, 15.954, 30.0/3600.0),  -- 30 arcsec in degrees\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0) -- 20 arcsec in degrees\n)\nSELECT\n    c.identifier,\n    c.ra,\n    c.dec,\n    c.radius_deg,\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd\nFROM catalog c\nINNER JOIN object o\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find ZTF objects within 30\" of id_1 (354.67, 15.954) or 20\" of id_2 (20.7993, 1.00331)\n-- Returns input identifier, input coordinates, search radius (deg), and matched ZTF object info\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        ('id_1', 354.67, 15.954, 30.0/3600.0),  -- 30 arcsec in degrees\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0) -- 20 arcsec in degrees\n)\nSELECT\n    c.identifier,\n    c.ra,\n    c.dec,\n    c.radius_deg,\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd\nFROM catalog c\nINNER JOIN object o\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```"
                },
                "in_toks": 2338,
                "out_toks": 1791,
                "id": "chatcmpl-CSxiEqmz8KoQT7N5pMXxFanOVoggb",
                "created": 1761018754,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "4": {
            "req_id": "57",
            "experiment_id": "run_4",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 727,
                "out_toks": 396,
                "id": "chatcmpl-CSsbYvJpMi2OoU4RtaBpuG6UmB6sK",
                "created": 1760999120,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized cone searches executed separately to leverage Q3C index per branch, then UNION ALL and sort by last detection date\n\nSELECT s.identifier, -- input identifier\n s.ra, -- input RA (deg)\n s.dec, -- input Dec (deg)\n s.radius_deg, -- search radius (deg)\n s.oid, -- ZTF object identifier\n s.ndet, -- number of detections\n s.meanra, -- mean RA (deg)\n s.meandec, -- mean Dec (deg)\n s.firstmjd -- first detection date (MJD)\nFROM\n  (SELECT 'id_1'::text AS identifier,\n          354.67::double precision AS ra,\n          15.954::double precision AS dec,\n          (30.0/3600.0)::double precision AS radius_deg, -- 30 arcsec in degrees\n o.oid,\n o.ndet,\n o.meanra,\n o.meandec,\n o.firstmjd,\n o.lastmjd\n   FROM OBJECT AS o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n   UNION ALL SELECT 'id_2'::text AS identifier,\n                    20.7993::double precision AS ra,\n                    1.00331::double precision AS dec,\n                    (20.0/3600.0)::double precision AS radius_deg, -- 20 arcsec in degrees\n o.oid,\n o.ndet,\n o.meanra,\n o.meandec,\n o.firstmjd,\n o.lastmjd\n   FROM OBJECT AS o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0)) AS s\nORDER BY s.lastmjd DESC;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized cone searches executed separately to leverage Q3C index per branch, then UNION ALL and sort by last detection date\n\nSELECT s.identifier, -- input identifier\n s.ra, -- input RA (deg)\n s.dec, -- input Dec (deg)\n s.radius_deg, -- search radius (deg)\n s.oid, -- ZTF object identifier\n s.ndet, -- number of detections\n s.meanra, -- mean RA (deg)\n s.meandec, -- mean Dec (deg)\n s.firstmjd -- first detection date (MJD)\nFROM\n  (SELECT 'id_1'::text AS identifier,\n          354.67::double precision AS ra,\n          15.954::double precision AS dec,\n          (30.0/3600.0)::double precision AS radius_deg, -- 30 arcsec in degrees\n o.oid,\n o.ndet,\n o.meanra,\n o.meandec,\n o.firstmjd,\n o.lastmjd\n   FROM OBJECT AS o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n   UNION ALL SELECT 'id_2'::text AS identifier,\n                    20.7993::double precision AS ra,\n                    1.00331::double precision AS dec,\n                    (20.0/3600.0)::double precision AS radius_deg, -- 20 arcsec in degrees\n o.oid,\n o.ndet,\n o.meanra,\n o.meandec,\n o.firstmjd,\n o.lastmjd\n   FROM OBJECT AS o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0)) AS s\nORDER BY s.lastmjd DESC;"
                },
                "in_toks": 1496,
                "out_toks": 2233,
                "id": "chatcmpl-CbH1pzOXVqaNmBfK0ET42Os0zbrmV",
                "created": 1762999629,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1020,
                "out_toks": 271,
                "id": "chatcmpl-CSxTvkWLSAoFtlQFQs6Bk1TPIseHv",
                "created": 1761017867,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Cone search around two input positions using Q3C; radii given in arcseconds are converted to degrees\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        ('id_1', 354.67, 15.954, 30.0/3600.0),  -- 30 arcsec\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0) -- 20 arcsec\n)\nSELECT\n    c.identifier,\n    c.ra,\n    c.dec,\n    c.radius_deg,\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd\nFROM catalog AS c\nINNER JOIN object AS o\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Cone search around two input positions using Q3C; radii given in arcseconds are converted to degrees\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        ('id_1', 354.67, 15.954, 30.0/3600.0),  -- 30 arcsec\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0) -- 20 arcsec\n)\nSELECT\n    c.identifier,\n    c.ra,\n    c.dec,\n    c.radius_deg,\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd\nFROM catalog AS c\nINNER JOIN object AS o\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```"
                },
                "in_toks": 2338,
                "out_toks": 1557,
                "id": "chatcmpl-CSxiWZwKKJ56irG57vMdpRrU0ayFo",
                "created": 1761018772,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "5": {
            "req_id": "57",
            "experiment_id": "run_5",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 727,
                "out_toks": 460,
                "id": "chatcmpl-CZMS4nGdXgzQ1EZJtb2zJ3ws4EKlw",
                "created": 1762543820,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "WITH results AS\n  (-- Use two separate q3c_radial_query filters so the q3c index on (meanra, meandec) is fully used.\n -- 30 arcsec = 30/3600 deg; 20 arcsec = 20/3600 deg.\n SELECT 'id_1'::text AS identifier, -- input object identifier\n 354.67::double precision AS ra, -- input object RA [deg]\n 15.954::double precision AS dec, -- input object Dec [deg]\n (30.0/3600.0)::double precision AS radius_deg, -- search radius [deg]\n o.oid, -- ZTF identifier\n o.ndet, -- number of detections\n o.meanra, -- mean RA [deg]\n o.meandec, -- mean Dec [deg]\n o.firstmjd, -- first detection date [MJD]\n o.lastmjd -- last detection date [MJD] (for sorting)\n\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n   UNION ALL SELECT 'id_2'::text AS identifier,\n                    20.7993::double precision AS ra,\n                    1.00331::double precision AS dec,\n                    (20.0/3600.0)::double precision AS radius_deg,\n                    o.oid,\n                    o.ndet,\n                    o.meanra,\n                    o.meandec,\n                    o.firstmjd,\n                    o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0))\nSELECT identifier,\n       ra, dec, radius_deg,\n                oid,\n                ndet,\n                meanra,\n                meandec,\n                firstmjd\nFROM results\nORDER BY lastmjd DESC;",
            "sql_response": {
                "responses": {
                    "0": "WITH results AS\n  (-- Use two separate q3c_radial_query filters so the q3c index on (meanra, meandec) is fully used.\n -- 30 arcsec = 30/3600 deg; 20 arcsec = 20/3600 deg.\n SELECT 'id_1'::text AS identifier, -- input object identifier\n 354.67::double precision AS ra, -- input object RA [deg]\n 15.954::double precision AS dec, -- input object Dec [deg]\n (30.0/3600.0)::double precision AS radius_deg, -- search radius [deg]\n o.oid, -- ZTF identifier\n o.ndet, -- number of detections\n o.meanra, -- mean RA [deg]\n o.meandec, -- mean Dec [deg]\n o.firstmjd, -- first detection date [MJD]\n o.lastmjd -- last detection date [MJD] (for sorting)\n\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n   UNION ALL SELECT 'id_2'::text AS identifier,\n                    20.7993::double precision AS ra,\n                    1.00331::double precision AS dec,\n                    (20.0/3600.0)::double precision AS radius_deg,\n                    o.oid,\n                    o.ndet,\n                    o.meanra,\n                    o.meandec,\n                    o.firstmjd,\n                    o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0))\nSELECT identifier,\n       ra, dec, radius_deg,\n                oid,\n                ndet,\n                meanra,\n                meandec,\n                firstmjd\nFROM results\nORDER BY lastmjd DESC;"
                },
                "in_toks": 1654,
                "out_toks": 1801,
                "id": "chatcmpl-CbH2ODVMoxuNM1xBltfxnzQoeEf3s",
                "created": 1762999664,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1020,
                "out_toks": 399,
                "id": "chatcmpl-CZYJqqAm0hbXihURTesiqdAdlPtVF",
                "created": 1762589438,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find ZTF objects within 30\" of id_1 or 20\" of id_2 using Q3C cone searches.\n-- Radii are specified in degrees: 30\"/3600 = 0.008333..., 20\"/3600 = 0.005555...\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        ('id_1', 354.67, 15.954, 30.0/3600.0),\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0)\n)\nSELECT\n    c.identifier,      -- input object identifier\n    c.ra,              -- input object RA [deg]\n    c.dec,             -- input object Dec [deg]\n    c.radius_deg,      -- search radius used [deg]\n    o.oid,             -- ZTF identifier\n    o.ndet,            -- number of detections\n    o.meanra,          -- mean RA [deg]\n    o.meandec,         -- mean Dec [deg]\n    o.firstmjd         -- first detection date [MJD]\nFROM catalog c\nINNER JOIN object o\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find ZTF objects within 30\" of id_1 or 20\" of id_2 using Q3C cone searches.\n-- Radii are specified in degrees: 30\"/3600 = 0.008333..., 20\"/3600 = 0.005555...\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        ('id_1', 354.67, 15.954, 30.0/3600.0),\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0)\n)\nSELECT\n    c.identifier,      -- input object identifier\n    c.ra,              -- input object RA [deg]\n    c.dec,             -- input object Dec [deg]\n    c.radius_deg,      -- search radius used [deg]\n    o.oid,             -- ZTF identifier\n    o.ndet,            -- number of detections\n    o.meanra,          -- mean RA [deg]\n    o.meandec,         -- mean Dec [deg]\n    o.firstmjd         -- first detection date [MJD]\nFROM catalog c\nINNER JOIN object o\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```"
                },
                "in_toks": 2338,
                "out_toks": 2988,
                "id": "chatcmpl-CZZtoc6jck5Yayxtc7jX3nYfb9VJP",
                "created": 1762595512,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "6": {
            "req_id": "57",
            "experiment_id": "run_6",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 727,
                "out_toks": 524,
                "id": "chatcmpl-CZMSJgzqvEpzvdJ1xJLE62ZYevzUF",
                "created": 1762543835,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query: use two separate q3c radial lookups (UNION ALL) to leverage the q3c index and avoid an expensive join over the full object table\n-- Returns per requested: input identifier/coords/radius, and matched ZTF oid/ndet/meanra/meandec/firstmjd\n-- Sorted by last detection date (lastmjd) in descending order\nWITH results AS\n  (SELECT 'id_1'::text AS identifier,\n          354.67::double precision AS ra,\n          15.954::double precision AS dec,\n          (30.0/3600.0)::double precision AS radius_deg,\n          o.oid,\n          o.ndet,\n          o.meanra,\n          o.meandec,\n          o.firstmjd,\n          o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n   UNION ALL SELECT 'id_2'::text AS identifier,\n                    20.7993::double precision AS ra,\n                    1.00331::double precision AS dec,\n                    (20.0/3600.0)::double precision AS radius_deg,\n                    o.oid,\n                    o.ndet,\n                    o.meanra,\n                    o.meandec,\n                    o.firstmjd,\n                    o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0))\nSELECT identifier,\n       ra, dec, radius_deg,\n                oid,\n                ndet,\n                meanra,\n                meandec,\n                firstmjd\nFROM results\nORDER BY lastmjd DESC;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query: use two separate q3c radial lookups (UNION ALL) to leverage the q3c index and avoid an expensive join over the full object table\n-- Returns per requested: input identifier/coords/radius, and matched ZTF oid/ndet/meanra/meandec/firstmjd\n-- Sorted by last detection date (lastmjd) in descending order\nWITH results AS\n  (SELECT 'id_1'::text AS identifier,\n          354.67::double precision AS ra,\n          15.954::double precision AS dec,\n          (30.0/3600.0)::double precision AS radius_deg,\n          o.oid,\n          o.ndet,\n          o.meanra,\n          o.meandec,\n          o.firstmjd,\n          o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n   UNION ALL SELECT 'id_2'::text AS identifier,\n                    20.7993::double precision AS ra,\n                    1.00331::double precision AS dec,\n                    (20.0/3600.0)::double precision AS radius_deg,\n                    o.oid,\n                    o.ndet,\n                    o.meanra,\n                    o.meandec,\n                    o.firstmjd,\n                    o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0))\nSELECT identifier,\n       ra, dec, radius_deg,\n                oid,\n                ndet,\n                meanra,\n                meandec,\n                firstmjd\nFROM results\nORDER BY lastmjd DESC;"
                },
                "in_toks": 1615,
                "out_toks": 2263,
                "id": "chatcmpl-CbH3FF1LiXtbkJbI84jCt2d31kAHt",
                "created": 1762999717,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1020,
                "out_toks": 335,
                "id": "chatcmpl-CZYJzP0dCGKGzGniLjhKpckGE63jJ",
                "created": 1762589447,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find ZTF objects within 30\" of id_1 or 20\" of id_2, returning input and matched object info\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        ('id_1', 354.67, 15.954, 30.0/3600.0),   -- 30 arcsec in degrees\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0) -- 20 arcsec in degrees\n)\nSELECT\n    c.identifier,        -- input object identifier\n    c.ra,                -- input RA (deg)\n    c.dec,               -- input Dec (deg)\n    c.radius_deg,        -- search radius (deg)\n    o.oid,               -- ZTF identifier\n    o.ndet,              -- number of detections\n    o.meanra,            -- mean RA (deg)\n    o.meandec,           -- mean Dec (deg)\n    o.firstmjd           -- first detection MJD\nFROM catalog c\nINNER JOIN object o\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find ZTF objects within 30\" of id_1 or 20\" of id_2, returning input and matched object info\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        ('id_1', 354.67, 15.954, 30.0/3600.0),   -- 30 arcsec in degrees\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0) -- 20 arcsec in degrees\n)\nSELECT\n    c.identifier,        -- input object identifier\n    c.ra,                -- input RA (deg)\n    c.dec,               -- input Dec (deg)\n    c.radius_deg,        -- search radius (deg)\n    o.oid,               -- ZTF identifier\n    o.ndet,              -- number of detections\n    o.meanra,            -- mean RA (deg)\n    o.meandec,           -- mean Dec (deg)\n    o.firstmjd           -- first detection MJD\nFROM catalog c\nINNER JOIN object o\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```"
                },
                "in_toks": 2338,
                "out_toks": 1881,
                "id": "chatcmpl-CZZeBjO21oyrHp9e9eAwi7QVI7deS",
                "created": 1762594543,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "7": {
            "req_id": "57",
            "experiment_id": "run_7",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 727,
                "out_toks": 332,
                "id": "chatcmpl-CZMSUlTn6jorjloReBaIhggIMGiIZ",
                "created": 1762543846,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized: split into two independent q3c lookups (one per input), enabling use of the q3c index on object(meanra, meandec).\n-- Returns input identifier/coords/radius and matched ZTF object info, sorted by last detection date (descending).\n\nSELECT s.identifier,\n       s.ra,\n       s.dec,\n       s.radius_deg,\n       s.oid,\n       s.ndet,\n       s.meanra,\n       s.meandec,\n       s.firstmjd\nFROM\n  (SELECT 'id_1'::text AS identifier,\n          354.67::double precision AS ra,\n          15.954::double precision AS dec,\n          (30.0/3600.0)::double precision AS radius_deg,\n          o.oid,\n          o.ndet,\n          o.meanra,\n          o.meandec,\n          o.firstmjd,\n          o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67::double precision, 15.954::double precision, (30.0/3600.0)::double precision)\n   UNION ALL SELECT 'id_2'::text AS identifier,\n                    20.7993::double precision AS ra,\n                    1.00331::double precision AS dec,\n                    (20.0/3600.0)::double precision AS radius_deg,\n                    o.oid,\n                    o.ndet,\n                    o.meanra,\n                    o.meandec,\n                    o.firstmjd,\n                    o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993::double precision, 1.00331::double precision, (20.0/3600.0)::double precision)) AS s\nORDER BY s.lastmjd DESC;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized: split into two independent q3c lookups (one per input), enabling use of the q3c index on object(meanra, meandec).\n-- Returns input identifier/coords/radius and matched ZTF object info, sorted by last detection date (descending).\n\nSELECT s.identifier,\n       s.ra,\n       s.dec,\n       s.radius_deg,\n       s.oid,\n       s.ndet,\n       s.meanra,\n       s.meandec,\n       s.firstmjd\nFROM\n  (SELECT 'id_1'::text AS identifier,\n          354.67::double precision AS ra,\n          15.954::double precision AS dec,\n          (30.0/3600.0)::double precision AS radius_deg,\n          o.oid,\n          o.ndet,\n          o.meanra,\n          o.meandec,\n          o.firstmjd,\n          o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67::double precision, 15.954::double precision, (30.0/3600.0)::double precision)\n   UNION ALL SELECT 'id_2'::text AS identifier,\n                    20.7993::double precision AS ra,\n                    1.00331::double precision AS dec,\n                    (20.0/3600.0)::double precision AS radius_deg,\n                    o.oid,\n                    o.ndet,\n                    o.meanra,\n                    o.meandec,\n                    o.firstmjd,\n                    o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993::double precision, 1.00331::double precision, (20.0/3600.0)::double precision)) AS s\nORDER BY s.lastmjd DESC;"
                },
                "in_toks": 1651,
                "out_toks": 1561,
                "id": "chatcmpl-CbH4GUWF5ryeeLKBbG9b5gsUls0Vc",
                "created": 1762999780,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1020,
                "out_toks": 335,
                "id": "chatcmpl-CZYK6GsTSpUMUWbK3GNTt0gTLMVzK",
                "created": 1762589454,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find ZTF objects within 30\" of id_1 or 20\" of id_2, returning input identifiers/coords/radius and matched object info.\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES \n        ('id_1', 354.67, 15.954, 30.0/3600.0),  -- 30 arcsec in degrees\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0) -- 20 arcsec in degrees\n)\nSELECT\n    c.identifier,          -- input object identifier\n    c.ra,                  -- input RA (deg)\n    c.dec,                 -- input Dec (deg)\n    c.radius_deg,          -- search radius used (deg)\n    o.oid,                 -- ZTF identifier\n    o.ndet,                -- number of detections\n    o.meanra,              -- mean RA (deg)\n    o.meandec,             -- mean Dec (deg)\n    o.firstmjd             -- first detection date (MJD)\nFROM catalog c\nJOIN object o\n  ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;  -- sort by last detection date (most recent first)\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find ZTF objects within 30\" of id_1 or 20\" of id_2, returning input identifiers/coords/radius and matched object info.\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES \n        ('id_1', 354.67, 15.954, 30.0/3600.0),  -- 30 arcsec in degrees\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0) -- 20 arcsec in degrees\n)\nSELECT\n    c.identifier,          -- input object identifier\n    c.ra,                  -- input RA (deg)\n    c.dec,                 -- input Dec (deg)\n    c.radius_deg,          -- search radius used (deg)\n    o.oid,                 -- ZTF identifier\n    o.ndet,                -- number of detections\n    o.meanra,              -- mean RA (deg)\n    o.meandec,             -- mean Dec (deg)\n    o.firstmjd             -- first detection date (MJD)\nFROM catalog c\nJOIN object o\n  ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;  -- sort by last detection date (most recent first)\n```"
                },
                "in_toks": 2338,
                "out_toks": 1964,
                "id": "chatcmpl-CZZeBftyPE5wJWo0snkocWjDLOjoP",
                "created": 1762594543,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "8": {
            "req_id": "57",
            "experiment_id": "run_8",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 727,
                "out_toks": 396,
                "id": "chatcmpl-CZMSaJpafttUMmxsLeum4igKJFto8",
                "created": 1762543852,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "WITH inputs (source_id, ra, dec, radius_deg) AS (\n                                                 VALUES -- 30 arcsec = 30/3600 deg\n ('id_1',\n  354.67::double precision,\n  15.954::double precision,\n  30.0/3600.0), -- 20 arcsec = 20/3600 deg\n ('id_2',\n  20.7993::double precision,\n  1.00331::double precision,\n  20.0/3600.0)), -- Use a LATERAL join so each small cone search uses the q3c index on object(meanra, meandec)\nmatches AS\n  (SELECT i.source_id,\n          i.ra,\n          i.dec,\n          i.radius_deg,\n          o.oid,\n          o.ndet,\n          o.meanra,\n          o.meandec,\n          o.firstmjd,\n          o.lastmjd\n   FROM inputs i\n   JOIN LATERAL\n     (SELECT oid,\n             ndet,\n             meanra,\n             meandec,\n             firstmjd,\n             lastmjd\n      FROM OBJECT\n      WHERE q3c_radial_query(meanra, meandec, i.ra, i.dec, i.radius_deg) -- radius in degrees\n) o ON TRUE)\nSELECT -- Input object info\n source_id,\n ra, dec, radius_deg, -- Matched ZTF object info\n oid,\n ndet,\n meanra,\n meandec,\n firstmjd\nFROM matches\nORDER BY lastmjd DESC;",
            "sql_response": {
                "responses": {
                    "0": "WITH inputs (source_id, ra, dec, radius_deg) AS (\n                                                 VALUES -- 30 arcsec = 30/3600 deg\n ('id_1',\n  354.67::double precision,\n  15.954::double precision,\n  30.0/3600.0), -- 20 arcsec = 20/3600 deg\n ('id_2',\n  20.7993::double precision,\n  1.00331::double precision,\n  20.0/3600.0)), -- Use a LATERAL join so each small cone search uses the q3c index on object(meanra, meandec)\nmatches AS\n  (SELECT i.source_id,\n          i.ra,\n          i.dec,\n          i.radius_deg,\n          o.oid,\n          o.ndet,\n          o.meanra,\n          o.meandec,\n          o.firstmjd,\n          o.lastmjd\n   FROM inputs i\n   JOIN LATERAL\n     (SELECT oid,\n             ndet,\n             meanra,\n             meandec,\n             firstmjd,\n             lastmjd\n      FROM OBJECT\n      WHERE q3c_radial_query(meanra, meandec, i.ra, i.dec, i.radius_deg) -- radius in degrees\n) o ON TRUE)\nSELECT -- Input object info\n source_id,\n ra, dec, radius_deg, -- Matched ZTF object info\n oid,\n ndet,\n meanra,\n meandec,\n firstmjd\nFROM matches\nORDER BY lastmjd DESC;"
                },
                "in_toks": 1527,
                "out_toks": 2135,
                "id": "chatcmpl-CbH51fonmpa2K8lUtejteBcEq4boP",
                "created": 1762999827,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1020,
                "out_toks": 335,
                "id": "chatcmpl-CZYKD2MGOjfgvBIRqLYEUAXSsRvL5",
                "created": 1762589461,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find ZTF objects within specified cone searches around two input positions\nWITH catalog (source_id, ra, dec, radius_deg) AS (\n    VALUES\n        -- 30 arcsec = 30/3600 deg\n        ('id_1', 354.67, 15.954, 30.0/3600.0),\n        -- 20 arcsec = 20/3600 deg\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0)\n)\nSELECT\n    -- Input object info\n    c.source_id,\n    c.ra,\n    c.dec,\n    c.radius_deg,\n    -- Matched ZTF object info\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd\nFROM catalog c\nINNER JOIN object o\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find ZTF objects within specified cone searches around two input positions\nWITH catalog (source_id, ra, dec, radius_deg) AS (\n    VALUES\n        -- 30 arcsec = 30/3600 deg\n        ('id_1', 354.67, 15.954, 30.0/3600.0),\n        -- 20 arcsec = 20/3600 deg\n        ('id_2', 20.7993, 1.00331, 20.0/3600.0)\n)\nSELECT\n    -- Input object info\n    c.source_id,\n    c.ra,\n    c.dec,\n    c.radius_deg,\n    -- Matched ZTF object info\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd\nFROM catalog c\nINNER JOIN object o\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```"
                },
                "in_toks": 2338,
                "out_toks": 2154,
                "id": "chatcmpl-CZZfa9Ojv4Nibhq8HzWz9ZAqRClul",
                "created": 1762594630,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "9": {
            "req_id": "57",
            "experiment_id": "run_9",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 727,
                "out_toks": 268,
                "id": "chatcmpl-CZMSkpR6htXmgXj1qqXvA5vTO1lzZ",
                "created": 1762543862,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "/* Optimized: run two separate index-accelerated Q3C cone searches and UNION ALL the results.\n   This avoids a broad JOIN on a VALUES table that can prevent index use and cause timeouts.\n   Radii converted to degrees: 30\" = 30/3600 deg, 20\" = 20/3600 deg.\n   Sorted by last detection date (lastmjd) descending, which is kept only for ordering in the subquery. */\nSELECT identifier,\n       ra, dec, radius_deg,\n                oid,\n                ndet,\n                meanra,\n                meandec,\n                firstmjd\nFROM\n  (SELECT 'id_1' AS identifier,\n          354.67::double precision AS ra,\n          15.954::double precision AS dec,\n          (30.0/3600.0)::double precision AS radius_deg,\n          o.oid,\n          o.ndet,\n          o.meanra,\n          o.meandec,\n          o.firstmjd,\n          o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n   UNION ALL SELECT 'id_2' AS identifier,\n                    20.7993::double precision AS ra,\n                    1.00331::double precision AS dec,\n                    (20.0/3600.0)::double precision AS radius_deg,\n                    o.oid,\n                    o.ndet,\n                    o.meanra,\n                    o.meandec,\n                    o.firstmjd,\n                    o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0)) s\nORDER BY s.lastmjd DESC;",
            "sql_response": {
                "responses": {
                    "0": "/* Optimized: run two separate index-accelerated Q3C cone searches and UNION ALL the results.\n   This avoids a broad JOIN on a VALUES table that can prevent index use and cause timeouts.\n   Radii converted to degrees: 30\" = 30/3600 deg, 20\" = 20/3600 deg.\n   Sorted by last detection date (lastmjd) descending, which is kept only for ordering in the subquery. */\nSELECT identifier,\n       ra, dec, radius_deg,\n                oid,\n                ndet,\n                meanra,\n                meandec,\n                firstmjd\nFROM\n  (SELECT 'id_1' AS identifier,\n          354.67::double precision AS ra,\n          15.954::double precision AS dec,\n          (30.0/3600.0)::double precision AS radius_deg,\n          o.oid,\n          o.ndet,\n          o.meanra,\n          o.meandec,\n          o.firstmjd,\n          o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 354.67, 15.954, 30.0/3600.0)\n   UNION ALL SELECT 'id_2' AS identifier,\n                    20.7993::double precision AS ra,\n                    1.00331::double precision AS dec,\n                    (20.0/3600.0)::double precision AS radius_deg,\n                    o.oid,\n                    o.ndet,\n                    o.meanra,\n                    o.meandec,\n                    o.firstmjd,\n                    o.lastmjd\n   FROM OBJECT o\n   WHERE q3c_radial_query(o.meanra, o.meandec, 20.7993, 1.00331, 20.0/3600.0)) s\nORDER BY s.lastmjd DESC;"
                },
                "in_toks": 1674,
                "out_toks": 2783,
                "id": "chatcmpl-CbH5eCNo5Gi3M68WtltsgJRSCxOT2",
                "created": 1762999866,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1020,
                "out_toks": 399,
                "id": "chatcmpl-CZYKJ69Sk0w6zfoG78pO9d5IFDNYl",
                "created": 1762589467,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n/* Find ZTF objects within 30\" of id_1 or 20\" of id_2 using Q3C cone searches.\n   Radii are converted from arcseconds to degrees (30\"/3600 = 0.008333..., 20\"/3600 = 0.005555...). */\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        ('id_1', 354.67,   15.954,   30.0/3600.0),\n        ('id_2',  20.7993,  1.00331, 20.0/3600.0)\n)\nSELECT\n    c.identifier,       -- input object identifier\n    c.ra,               -- input object RA (deg)\n    c.dec,              -- input object Dec (deg)\n    c.radius_deg,       -- search radius used (deg)\n    o.oid,              -- ZTF object identifier\n    o.ndet,             -- number of detections\n    o.meanra,           -- mean RA (deg)\n    o.meandec,          -- mean Dec (deg)\n    o.firstmjd          -- first detection date (MJD)\nFROM catalog c\nINNER JOIN object o\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* Find ZTF objects within 30\" of id_1 or 20\" of id_2 using Q3C cone searches.\n   Radii are converted from arcseconds to degrees (30\"/3600 = 0.008333..., 20\"/3600 = 0.005555...). */\nWITH catalog (identifier, ra, dec, radius_deg) AS (\n    VALUES\n        ('id_1', 354.67,   15.954,   30.0/3600.0),\n        ('id_2',  20.7993,  1.00331, 20.0/3600.0)\n)\nSELECT\n    c.identifier,       -- input object identifier\n    c.ra,               -- input object RA (deg)\n    c.dec,              -- input object Dec (deg)\n    c.radius_deg,       -- search radius used (deg)\n    o.oid,              -- ZTF object identifier\n    o.ndet,             -- number of detections\n    o.meanra,           -- mean RA (deg)\n    o.meandec,          -- mean Dec (deg)\n    o.firstmjd          -- first detection date (MJD)\nFROM catalog c\nINNER JOIN object o\n    ON q3c_radial_query(o.meanra, o.meandec, c.ra, c.dec, c.radius_deg)\nORDER BY o.lastmjd DESC;\n```"
                },
                "in_toks": 2338,
                "out_toks": 1972,
                "id": "chatcmpl-CZZg1zYA3WLVfy55L2OhH5BtDYQI0",
                "created": 1762594657,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        }
    },
    "75": {
        "0": {
            "req_id": "75",
            "experiment_id": "run_0",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']",
                    "1": "['ss_ztf']"
                },
                "in_toks": 608,
                "out_toks": 158,
                "id": "chatcmpl-CSnTzmuoNRyJay6wdbfDZeFV5Mfq0",
                "created": 1760979431,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 581,
                "out_toks": 207,
                "id": "chatcmpl-CSnjV5EXuiXEaUOR7kEVW7bqEYxT3",
                "created": 1760980393,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get at most 100 rows from ss_ztf where the nearest Solar System object is known\n-- Note: ssnamenr is a VARCHAR and can be the literal 'null' when unknown, so filter both NULL and 'null'\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get at most 100 rows from ss_ztf where the nearest Solar System object is known\n-- Note: ssnamenr is a VARCHAR and can be the literal 'null' when unknown, so filter both NULL and 'null'\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```"
                },
                "in_toks": 1899,
                "out_toks": 411,
                "id": "chatcmpl-CSqsNpO9815DbPuL3g5aYYKmKeyaH",
                "created": 1760992475,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "75",
            "experiment_id": "run_1",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']",
                    "1": "['ss_ztf']"
                },
                "in_toks": 608,
                "out_toks": 158,
                "id": "chatcmpl-CSnTzmuoNRyJay6wdbfDZeFV5Mfq0",
                "created": 1760979431,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 581,
                "out_toks": 207,
                "id": "chatcmpl-CSnja45eqxleoyX3ipJQvjSAKves3",
                "created": 1760980398,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return up to 100 rows from ss_ztf where the nearest Solar System object name is present\n-- Some rows may use the literal string 'null' to denote no known object, so exclude both NULL and 'null'\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return up to 100 rows from ss_ztf where the nearest Solar System object name is present\n-- Some rows may use the literal string 'null' to denote no known object, so exclude both NULL and 'null'\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```"
                },
                "in_toks": 1899,
                "out_toks": 601,
                "id": "chatcmpl-CSqsNyBrUkkZkvsdvql073OkYe12B",
                "created": 1760992475,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "75",
            "experiment_id": "run_2",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']"
                },
                "in_toks": 608,
                "out_toks": 79,
                "id": "chatcmpl-CSsbdUWPuEulendLVoNgJkqAfXBZy",
                "created": 1760999125,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 581,
                "out_toks": 207,
                "id": "chatcmpl-CSxTz8klxORBWZuqJzOY5HnHuf1GA",
                "created": 1761017871,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get at most 100 rows from ss_ztf with a known (non-null and not literal 'null') nearest Solar System object\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get at most 100 rows from ss_ztf with a known (non-null and not literal 'null') nearest Solar System object\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```"
                },
                "in_toks": 1899,
                "out_toks": 519,
                "id": "chatcmpl-CSxisHwZoJP3dFjjLfCom0KnMsptE",
                "created": 1761018794,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "75",
            "experiment_id": "run_3",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']"
                },
                "in_toks": 608,
                "out_toks": 79,
                "id": "chatcmpl-CSsbgwjGX329imyGjBYAqbaVrlxMo",
                "created": 1760999128,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 581,
                "out_toks": 143,
                "id": "chatcmpl-CSxU1eLfHMNLsQ8l4LzmkyQ6NeLsD",
                "created": 1761017873,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get at most 100 rows from ss_ztf where the nearest known Solar System object name is not null\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\nLIMIT 100;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get at most 100 rows from ss_ztf where the nearest known Solar System object name is not null\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\nLIMIT 100;\n```"
                },
                "in_toks": 1899,
                "out_toks": 249,
                "id": "chatcmpl-CSxj1WgkIFc6JXpebKIMlBjnttBrr",
                "created": 1761018803,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "75",
            "experiment_id": "run_4",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']"
                },
                "in_toks": 608,
                "out_toks": 79,
                "id": "chatcmpl-CSsbjzJtJJ2jdTU8NsR84NsHV41BW",
                "created": 1760999131,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 581,
                "out_toks": 143,
                "id": "chatcmpl-CSxU36P95zj6weHenxCmKcTcyyhmJ",
                "created": 1761017875,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return up to 100 ss_ztf rows with a known (non-null) nearest Solar System object\n-- Exclude both SQL NULL and the literal 'null' string sometimes used as a placeholder\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return up to 100 ss_ztf rows with a known (non-null) nearest Solar System object\n-- Exclude both SQL NULL and the literal 'null' string sometimes used as a placeholder\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```"
                },
                "in_toks": 1899,
                "out_toks": 788,
                "id": "chatcmpl-CSxj8AwoHE1niFGd1WGt00bVczYvd",
                "created": 1761018810,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "75",
            "experiment_id": "run_5",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']"
                },
                "in_toks": 608,
                "out_toks": 79,
                "id": "chatcmpl-CZMSroAlybp8tRV1DRSEQtB1DaSAc",
                "created": 1762543869,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 581,
                "out_toks": 143,
                "id": "chatcmpl-CZYKU5JbxRhb6FUWqoNBbjrnCFPSe",
                "created": 1762589478,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get at most 100 rows from ss_ztf where the nearest Solar System object name is present\n-- Note: ssnamenr may be the literal string 'null' when no SS object is known, so exclude both SQL NULL and 'null'\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get at most 100 rows from ss_ztf where the nearest Solar System object name is present\n-- Note: ssnamenr may be the literal string 'null' when no SS object is known, so exclude both SQL NULL and 'null'\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```"
                },
                "in_toks": 1899,
                "out_toks": 478,
                "id": "chatcmpl-CZZeB5GSXwAWJc7gqoKJVRhPaO0Wm",
                "created": 1762594543,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "75",
            "experiment_id": "run_6",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']"
                },
                "in_toks": 608,
                "out_toks": 143,
                "id": "chatcmpl-CZMSuhfXQuqxEa69hhWgIuKDAFQm4",
                "created": 1762543872,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 581,
                "out_toks": 335,
                "id": "chatcmpl-CZYKZJMDiwGpDTM5T5YVo910uBUWu",
                "created": 1762589483,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return at most 100 rows where the nearest Solar System object name is present.\n-- Note: Some rows may store the literal string 'null' when unknown; exclude those too.\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return at most 100 rows where the nearest Solar System object name is present.\n-- Note: Some rows may store the literal string 'null' when unknown; exclude those too.\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```"
                },
                "in_toks": 1899,
                "out_toks": 719,
                "id": "chatcmpl-CZZgHavUwYHhEUMjcPQ5UnqiSWMwZ",
                "created": 1762594673,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "75",
            "experiment_id": "run_7",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']"
                },
                "in_toks": 608,
                "out_toks": 79,
                "id": "chatcmpl-CZMSyRg3FfbeWxfwdvLwP2ruzxHHz",
                "created": 1762543876,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 581,
                "out_toks": 143,
                "id": "chatcmpl-CZYKeN5iejvhtmVxJtD2SHozayg3D",
                "created": 1762589488,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get at most 100 rows from ss_ztf with a known (non-null and not the literal 'null') nearest Solar System object name\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get at most 100 rows from ss_ztf with a known (non-null and not the literal 'null') nearest Solar System object name\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```"
                },
                "in_toks": 1899,
                "out_toks": 457,
                "id": "chatcmpl-CZZeB8vRWeoLuyMjleCOy3hMg0XbN",
                "created": 1762594543,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "75",
            "experiment_id": "run_8",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']"
                },
                "in_toks": 608,
                "out_toks": 79,
                "id": "chatcmpl-CZMT02zcFTApIYg3iIA4md24kO6Te",
                "created": 1762543878,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 581,
                "out_toks": 143,
                "id": "chatcmpl-CZYKhtU5A6ZztTdHoI7esGgvJrVIe",
                "created": 1762589491,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get at most 100 rows from ss_ztf with a known (non-null) nearest Solar System object\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get at most 100 rows from ss_ztf with a known (non-null) nearest Solar System object\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```"
                },
                "in_toks": 1899,
                "out_toks": 450,
                "id": "chatcmpl-CZZgrnvPv4BY0HcQEXsi6SlOTo8IE",
                "created": 1762594709,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "75",
            "experiment_id": "run_9",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']"
                },
                "in_toks": 608,
                "out_toks": 79,
                "id": "chatcmpl-CZMT4hcQSaB4grjyRVFFreag9ikcp",
                "created": 1762543882,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 581,
                "out_toks": 143,
                "id": "chatcmpl-CZYKkXZVWERmYHkRdA1imoXUmyWrS",
                "created": 1762589494,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get up to 100 rows with a known (non-null and not the literal 'null') nearest Solar System object\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get up to 100 rows with a known (non-null and not the literal 'null') nearest Solar System object\nSELECT *\nFROM ss_ztf\nWHERE ssnamenr IS NOT NULL\n  AND ssnamenr <> 'null'\nLIMIT 100;\n```"
                },
                "in_toks": 1899,
                "out_toks": 451,
                "id": "chatcmpl-CZZehtsucUhUYnPCU07N0UnYmIiuN",
                "created": 1762594575,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "43": {
        "0": {
            "req_id": "43",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'dataquality']",
                    "1": "['dataquality']"
                },
                "in_toks": 645,
                "out_toks": 1245,
                "id": "chatcmpl-CSnU2YDKqfTC2K9BrST7YIvROtgzj",
                "created": 1760979434,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1735,
                "out_toks": 335,
                "id": "chatcmpl-CSnjezfIavaHfxZz5fSOHv7XvIDsR",
                "created": 1760980402,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- r-band epochs (fid = 2) for specified ZTF objects, returning identifiers, positions, and peak-pixel S/N\nSELECT\n    dq.oid,\n    dq.candid,\n    dq.xpos,\n    dq.ypos,\n    dq.scorr\nFROM dataquality AS dq\nWHERE dq.oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\n  AND dq.fid = 2\nORDER BY dq.oid, dq.candid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- r-band epochs (fid = 2) for specified ZTF objects, returning identifiers, positions, and peak-pixel S/N\nSELECT\n    dq.oid,\n    dq.candid,\n    dq.xpos,\n    dq.ypos,\n    dq.scorr\nFROM dataquality AS dq\nWHERE dq.oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\n  AND dq.fid = 2\nORDER BY dq.oid, dq.candid;\n```"
                },
                "in_toks": 3053,
                "out_toks": 756,
                "id": "chatcmpl-CSqsVQlRlV0XjE22vqJwPaEb8UdEt",
                "created": 1760992483,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "43",
            "experiment_id": "run_1",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'dataquality']",
                    "1": "['dataquality']"
                },
                "in_toks": 645,
                "out_toks": 1245,
                "id": "chatcmpl-CSnU2YDKqfTC2K9BrST7YIvROtgzj",
                "created": 1760979434,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1253,
                "out_toks": 271,
                "id": "chatcmpl-CSnjkKG5OGLbCpAVD607n1gEaaTh3",
                "created": 1760980408,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- r-band (fid=2) epochs for specified ZTF objects with requested columns\nSELECT\n    oid,       -- ZTF object identifier\n    candid,    -- candidate identifier\n    xpos,      -- x-image position [pixels]\n    ypos,      -- y-image position [pixels]\n    scorr      -- peak-pixel signal-to-noise ratio\nFROM dataquality\nWHERE fid = 2\n  AND oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\nORDER BY oid, candid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- r-band (fid=2) epochs for specified ZTF objects with requested columns\nSELECT\n    oid,       -- ZTF object identifier\n    candid,    -- candidate identifier\n    xpos,      -- x-image position [pixels]\n    ypos,      -- y-image position [pixels]\n    scorr      -- peak-pixel signal-to-noise ratio\nFROM dataquality\nWHERE fid = 2\n  AND oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\nORDER BY oid, candid;\n```"
                },
                "in_toks": 2571,
                "out_toks": 893,
                "id": "chatcmpl-CSqsVCJixdwBcJsxCvOLI3eO7dNjO",
                "created": 1760992483,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "43",
            "experiment_id": "run_2",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']"
                },
                "in_toks": 645,
                "out_toks": 589,
                "id": "chatcmpl-CSsblC71Z0IvUuebWU6vBmyv66dFA",
                "created": 1760999133,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1253,
                "out_toks": 271,
                "id": "chatcmpl-CSxU6DOIMLDaiTZIrc0OGr44vSGjA",
                "created": 1761017878,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- r-band is fid = 2\n-- Return ZTF identifier (oid), candidate identifier (candid), x/y positions, and peak-pixel S/N\nSELECT\n    oid,\n    candid,\n    xpos,\n    ypos,\n    scorr\nFROM dataquality\nWHERE fid = 2\n  AND oid IN ('ZTF20acwrybw', 'ZTF22abugigx');\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- r-band is fid = 2\n-- Return ZTF identifier (oid), candidate identifier (candid), x/y positions, and peak-pixel S/N\nSELECT\n    oid,\n    candid,\n    xpos,\n    ypos,\n    scorr\nFROM dataquality\nWHERE fid = 2\n  AND oid IN ('ZTF20acwrybw', 'ZTF22abugigx');\n```"
                },
                "in_toks": 2571,
                "out_toks": 865,
                "id": "chatcmpl-CSxjO38nqLFtjCcJX3HqAQXN8RlMn",
                "created": 1761018826,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "43",
            "experiment_id": "run_3",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']"
                },
                "in_toks": 645,
                "out_toks": 589,
                "id": "chatcmpl-CSsbtxqni2wWxavmMbFQ1XMTGDD3C",
                "created": 1760999141,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1253,
                "out_toks": 207,
                "id": "chatcmpl-CSxUAN9Anv4KJDUaM2L7gekXzXfL1",
                "created": 1761017882,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- r-band corresponds to fid = 2\n-- Return ZTF identifier (oid), candidate identifier (candid), x/y image positions (xpos, ypos), and peak-pixel S/N (scorr)\nSELECT\n    oid,\n    candid,\n    xpos,\n    ypos,\n    scorr\nFROM dataquality\nWHERE oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\n  AND fid = 2\nORDER BY oid, candid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- r-band corresponds to fid = 2\n-- Return ZTF identifier (oid), candidate identifier (candid), x/y image positions (xpos, ypos), and peak-pixel S/N (scorr)\nSELECT\n    oid,\n    candid,\n    xpos,\n    ypos,\n    scorr\nFROM dataquality\nWHERE oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\n  AND fid = 2\nORDER BY oid, candid;\n```"
                },
                "in_toks": 2571,
                "out_toks": 689,
                "id": "chatcmpl-CSxjdRNrRhzfmzbkNpNJvOT8J5Yur",
                "created": 1761018841,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "43",
            "experiment_id": "run_4",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']"
                },
                "in_toks": 645,
                "out_toks": 589,
                "id": "chatcmpl-CSsc0kHioIGamdoAwkoaHwebAFR0H",
                "created": 1760999148,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1253,
                "out_toks": 207,
                "id": "chatcmpl-CSxUEt9cPux5uMrWSUQbWoKlpKbsM",
                "created": 1761017886,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- r-band (fid=2) epochs in dataquality for the specified ZTF objects\n-- Returning: ZTF identifier (oid), candidate identifier (candid),\n-- x- and y-image positions (xpos, ypos), and peak-pixel S/N (scorr)\nSELECT\n    oid,\n    candid,\n    xpos,\n    ypos,\n    scorr\nFROM dataquality\nWHERE oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\n  AND fid = 2;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- r-band (fid=2) epochs in dataquality for the specified ZTF objects\n-- Returning: ZTF identifier (oid), candidate identifier (candid),\n-- x- and y-image positions (xpos, ypos), and peak-pixel S/N (scorr)\nSELECT\n    oid,\n    candid,\n    xpos,\n    ypos,\n    scorr\nFROM dataquality\nWHERE oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\n  AND fid = 2;\n```"
                },
                "in_toks": 2571,
                "out_toks": 568,
                "id": "chatcmpl-CSxjn4R5AnXgN3AQnvkaS02s3oPVt",
                "created": 1761018851,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "43",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'dataquality']"
                },
                "in_toks": 645,
                "out_toks": 848,
                "id": "chatcmpl-CZMT8DV4untMsIoYsHnIkjpz7Cxr4",
                "created": 1762543886,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1735,
                "out_toks": 271,
                "id": "chatcmpl-CZYKo5RIcl4KukKpMZyZjsYQsqXc4",
                "created": 1762589498,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- r-band epochs (fid = 2) for the specified ZTF objects, returning requested columns\nSELECT\n    oid,          -- ZTF identifier\n    candid,       -- candidate identifier\n    xpos,         -- x-image position [pixels]\n    ypos,         -- y-image position [pixels]\n    scorr         -- peak-pixel S/N in matched-filtered detection image\nFROM dataquality\nWHERE fid = 2\n  AND oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\nORDER BY oid, candid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- r-band epochs (fid = 2) for the specified ZTF objects, returning requested columns\nSELECT\n    oid,          -- ZTF identifier\n    candid,       -- candidate identifier\n    xpos,         -- x-image position [pixels]\n    ypos,         -- y-image position [pixels]\n    scorr         -- peak-pixel S/N in matched-filtered detection image\nFROM dataquality\nWHERE fid = 2\n  AND oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\nORDER BY oid, candid;\n```"
                },
                "in_toks": 3053,
                "out_toks": 642,
                "id": "chatcmpl-CZZhM5EuMIiNNaNfkxvkwFTycgmcq",
                "created": 1762594740,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "43",
            "experiment_id": "run_6",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']"
                },
                "in_toks": 645,
                "out_toks": 269,
                "id": "chatcmpl-CZMTPmtersaao1osbrnu3aruZ2bRu",
                "created": 1762543903,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1253,
                "out_toks": 399,
                "id": "chatcmpl-CZYKu8cH7MxSJBeOLJ99niXBsDdOf",
                "created": 1762589504,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- r-band is fid = 2\nSELECT\n    oid,\n    candid,\n    xpos,\n    ypos,\n    scorr\nFROM dataquality\nWHERE fid = 2\n  AND oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\nORDER BY oid, candid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- r-band is fid = 2\nSELECT\n    oid,\n    candid,\n    xpos,\n    ypos,\n    scorr\nFROM dataquality\nWHERE fid = 2\n  AND oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\nORDER BY oid, candid;\n```"
                },
                "in_toks": 2571,
                "out_toks": 654,
                "id": "chatcmpl-CZZeifmhea5Oecl1MIbu0sOXktVQl",
                "created": 1762594576,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "43",
            "experiment_id": "run_7",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']"
                },
                "in_toks": 645,
                "out_toks": 717,
                "id": "chatcmpl-CZMTXjRTjkaDTfZQ32JnZy0RE6paC",
                "created": 1762543911,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1253,
                "out_toks": 271,
                "id": "chatcmpl-CZYKzXsu7v4Kh38RwBZB9TqHe3kYD",
                "created": 1762589509,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- r-band corresponds to fid = 2\nSELECT\n    oid,\n    candid,\n    xpos,\n    ypos,\n    scorr\nFROM dataquality\nWHERE oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\n  AND fid = 2;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- r-band corresponds to fid = 2\nSELECT\n    oid,\n    candid,\n    xpos,\n    ypos,\n    scorr\nFROM dataquality\nWHERE oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\n  AND fid = 2;\n```"
                },
                "in_toks": 2571,
                "out_toks": 649,
                "id": "chatcmpl-CZZhmNmOjcJHfVikW1IBRspsTCI2C",
                "created": 1762594766,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "43",
            "experiment_id": "run_8",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']"
                },
                "in_toks": 645,
                "out_toks": 397,
                "id": "chatcmpl-CZMTmlKSU1nQfyeVEElbBV9MarHwb",
                "created": 1762543926,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1253,
                "out_toks": 271,
                "id": "chatcmpl-CZYL3nwjwpLxOdBKQGRCkVDgJK8Vf",
                "created": 1762589513,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- r-band (fid=2) data quality epochs for the specified ZTF objects\n-- Returning: ZTF identifier (oid), candidate identifier (candid), x- and y-image positions (xpos, ypos), and peak-pixel S/N (scorr)\nSELECT\n    dq.oid,\n    dq.candid,\n    dq.xpos,\n    dq.ypos,\n    dq.scorr\nFROM dataquality AS dq\nWHERE dq.oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\n  AND dq.fid = 2;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- r-band (fid=2) data quality epochs for the specified ZTF objects\n-- Returning: ZTF identifier (oid), candidate identifier (candid), x- and y-image positions (xpos, ypos), and peak-pixel S/N (scorr)\nSELECT\n    dq.oid,\n    dq.candid,\n    dq.xpos,\n    dq.ypos,\n    dq.scorr\nFROM dataquality AS dq\nWHERE dq.oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\n  AND dq.fid = 2;\n```"
                },
                "in_toks": 2571,
                "out_toks": 773,
                "id": "chatcmpl-CZZf9oEho8nuQ1spp0lMXvrzSHIqv",
                "created": 1762594603,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "43",
            "experiment_id": "run_9",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']"
                },
                "in_toks": 645,
                "out_toks": 461,
                "id": "chatcmpl-CZMTuxXtTAfjRWD7KwQckhk8lpBXY",
                "created": 1762543934,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1253,
                "out_toks": 207,
                "id": "chatcmpl-CZYL7PXJwYjuhGdYGuLDAyPPGXKRi",
                "created": 1762589517,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- r-band (fid=2) epochs in dataquality for the specified ZTF objects\nSELECT\n    oid,          -- ZTF identifier\n    candid,       -- candidate identifier\n    xpos,         -- x-image position [pixels]\n    ypos,         -- y-image position [pixels]\n    scorr         -- peak-pixel S/N\nFROM dataquality\nWHERE fid = 2\n  AND oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\nORDER BY oid, candid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- r-band (fid=2) epochs in dataquality for the specified ZTF objects\nSELECT\n    oid,          -- ZTF identifier\n    candid,       -- candidate identifier\n    xpos,         -- x-image position [pixels]\n    ypos,         -- y-image position [pixels]\n    scorr         -- peak-pixel S/N\nFROM dataquality\nWHERE fid = 2\n  AND oid IN ('ZTF20acwrybw', 'ZTF22abugigx')\nORDER BY oid, candid;\n```"
                },
                "in_toks": 2571,
                "out_toks": 762,
                "id": "chatcmpl-CZZiAr228dcPTt8Nk2iWn38smB4s7",
                "created": 1762594790,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "89": {
        "0": {
            "req_id": "89",
            "experiment_id": "run_0",
            "pred_tables": [
                "probability",
                "taxonomy",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'dataquality']",
                    "1": "['probability', 'taxonomy', 'dataquality']"
                },
                "in_toks": 624,
                "out_toks": 1384,
                "id": "chatcmpl-CSnUGTdg660K3arQq3RdKhQyan2uo",
                "created": 1760979448,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Get top 50 ZTF objects with SN class from the stamp classifier (ranking = 1) and probability > 0.7,\n-- then return all rows from the dataquality table for those objects. Use DISTINCT ON to pick the best\n-- probability per oid before limiting, and avoid ordering the large final join to prevent timeouts.\nWITH top_oids AS\n  (SELECT s.oid\n   FROM\n     (SELECT DISTINCT ON (p.oid) p.oid,\n                         p.probability\n      FROM probability AS p\n      WHERE p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'SN'\n        AND p.ranking = 1\n        AND p.probability > 0.7\n        AND p.oid LIKE 'ZTF%'\n      ORDER BY p.oid,\n               p.probability DESC) AS s\n   ORDER BY s.probability DESC\n   LIMIT 50)\nSELECT dq.*\nFROM dataquality AS dq\nJOIN top_oids AS t ON dq.oid = t.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Get top 50 ZTF objects with SN class from the stamp classifier (ranking = 1) and probability > 0.7,\n-- then return all rows from the dataquality table for those objects. Use DISTINCT ON to pick the best\n-- probability per oid before limiting, and avoid ordering the large final join to prevent timeouts.\nWITH top_oids AS\n  (SELECT s.oid\n   FROM\n     (SELECT DISTINCT ON (p.oid) p.oid,\n                         p.probability\n      FROM probability AS p\n      WHERE p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'SN'\n        AND p.ranking = 1\n        AND p.probability > 0.7\n        AND p.oid LIKE 'ZTF%'\n      ORDER BY p.oid,\n               p.probability DESC) AS s\n   ORDER BY s.probability DESC\n   LIMIT 50)\nSELECT dq.*\nFROM dataquality AS dq\nJOIN top_oids AS t ON dq.oid = t.oid;"
                },
                "in_toks": 2073,
                "out_toks": 2086,
                "id": "chatcmpl-CbH6ROnjMw40ZwJLmAVme1ZIyeQuK",
                "created": 1762999915,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1461,
                "out_toks": 911,
                "id": "chatcmpl-CSnjobFZzCVZoHbgdq3jGeOC6c1fL",
                "created": 1760980412,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify goal and output\n- Goal: Retrieve all rows from the dataquality table for ZTF objects whose stamp-based classification indicates supernovae with probability > 0.7, considering only the most likely class per classifier (ranking = 1), and return results for at most 50 unique objects (oids).\n- Output: Only columns from dataquality (i.e., dataquality.*), as explicitly requested.\n\n2) Identify relevant tables and columns\n- probability\n  - oid (VARCHAR): unique object identifier; foreign key to object(oid).\n  - class_name (VARCHAR): must be 'SN' for supernova in stamp classifier.\n  - classifier_name (VARCHAR): must be 'stamp_classifier' (overrides default 'lc_classifier').\n  - classifier_version (VARCHAR): multiple versions may exist; not filtered explicitly, but we will deduplicate oids.\n  - probability (DOUBLE PRECISION): threshold > 0.7.\n  - ranking (INTEGER): use default condition ranking = 1 to select the most likely class.\n- dataquality\n  - oid (VARCHAR): used for joining to probability-derived oids.\n  - candid (BIGINT), fid (INTEGER), and all other columns: will be returned (select dataquality.*).\n\n3) Default probability conditions and explicit overrides\n- Apply default: probability.ranking = 1.\n- Override classifier: probability.classifier_name = 'stamp_classifier'.\n- Class filter: probability.class_name = 'SN'.\n- Probability threshold: probability.probability > 0.7 (strictly greater, as requested).\n- ZTF object restriction: probability.oid LIKE 'ZTF%' to ensure only ZTF objects are selected.\n\n4) Build a base filtered set from probability\n- Create a subquery (S1) on probability with the following WHERE conditions:\n  - classifier_name = 'stamp_classifier'\n  - class_name = 'SN'\n  - ranking = 1\n  - probability > 0.7\n  - oid LIKE 'ZTF%'\n- Columns selected in S1: oid, probability (and optionally classifier_version if needed for diagnostics), but the main outputs will use only oid.\n\n5) Deduplicate oids and establish ordering metric\n- Because probability may contain multiple rows per oid (e.g., across classifier_version), deduplicate to unique oids with an ordering metric:\n  - Create an aggregation subquery (S2) grouping by oid, computing MAX(probability) AS max_prob across the filtered S1 rows.\n- Purpose: ensures one row per oid and lets us rank objects by their highest qualifying probability in the stamp classifier.\n\n6) Limit to at most 50 objects with highest probabilities\n- Create a subquery (S3) selecting from S2:\n  - ORDER BY max_prob DESC (secondary tie-breaker by oid ASC for determinism).\n  - LIMIT 50.\n- Columns in S3: oid, max_prob (max_prob can be kept to order/join but will not be returned in final output).\n\n7) Join selected oids to dataquality\n- Perform an INNER JOIN from dataquality dq to S3 on dq.oid = S3.oid.\n- This returns all detection-level rows in dataquality for the selected set of at most 50 objects.\n- The output should include only dataquality.* (as explicitly requested).\n\n8) Final ordering of results (optional but recommended)\n- Apply a deterministic ORDER BY for readability, e.g.:\n  - ORDER BY S3.max_prob DESC, dq.oid ASC, dq.candid ASC\n- Note: Ordering does not change the content, just presentation.\n\n9) Performance and index considerations\n- probability table:\n  - The partial index ix_classification_rank1 on (ranking) WHERE (ranking = 1) will be used due to ranking = 1 filter.\n  - The btree index ix_probabilities_probability helps with probability > 0.7.\n  - Ensure equality filters on classifier_name and class_name are applied together with ranking to keep the filtered set small before aggregation.\n- Join strategy:\n  - Keep the set of oids limited first (S3 with LIMIT 50) and then join to dataquality to avoid scanning large portions of dataquality.\n- dataquality table:\n  - The join uses dq.oid; ensure there is an index on dataquality.oid if available (not specified in schema), otherwise expect a hash join or nested loop depending on planner.\n\n10) Summary of logical flow\n- S1: Filter probability to stamp SN, ranking=1, probability>0.7, ZTF oids.\n- S2: From S1, GROUP BY oid, compute MAX(probability) AS max_prob for deduplication and scoring.\n- S3: Order S2 by max_prob DESC, LIMIT 50 to retain at most 50 oids.\n- Final: INNER JOIN dataquality dq with S3 on oid; SELECT dq.*; optionally order results for readability.\n\nNotes\n- Use exact values for class and classifier names: class_name = 'SN' and classifier_name = 'stamp_classifier'.\n- Keep strict inequality: probability > 0.7 as requested.\n- Do not include any columns from probability in the final SELECT, since the user requested only dataquality columns.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify goal and output\n- Goal: Retrieve all rows from the dataquality table for ZTF objects whose stamp-based classification indicates supernovae with probability > 0.7, considering only the most likely class per classifier (ranking = 1), and return results for at most 50 unique objects (oids).\n- Output: Only columns from dataquality (i.e., dataquality.*), as explicitly requested.\n\n2) Identify relevant tables and columns\n- probability\n  - oid (VARCHAR): unique object identifier; foreign key to object(oid).\n  - class_name (VARCHAR): must be 'SN' for supernova in stamp classifier.\n  - classifier_name (VARCHAR): must be 'stamp_classifier' (overrides default 'lc_classifier').\n  - classifier_version (VARCHAR): multiple versions may exist; not filtered explicitly, but we will deduplicate oids.\n  - probability (DOUBLE PRECISION): threshold > 0.7.\n  - ranking (INTEGER): use default condition ranking = 1 to select the most likely class.\n- dataquality\n  - oid (VARCHAR): used for joining to probability-derived oids.\n  - candid (BIGINT), fid (INTEGER), and all other columns: will be returned (select dataquality.*).\n\n3) Default probability conditions and explicit overrides\n- Apply default: probability.ranking = 1.\n- Override classifier: probability.classifier_name = 'stamp_classifier'.\n- Class filter: probability.class_name = 'SN'.\n- Probability threshold: probability.probability > 0.7 (strictly greater, as requested).\n- ZTF object restriction: probability.oid LIKE 'ZTF%' to ensure only ZTF objects are selected.\n\n4) Build a base filtered set from probability\n- Create a subquery (S1) on probability with the following WHERE conditions:\n  - classifier_name = 'stamp_classifier'\n  - class_name = 'SN'\n  - ranking = 1\n  - probability > 0.7\n  - oid LIKE 'ZTF%'\n- Columns selected in S1: oid, probability (and optionally classifier_version if needed for diagnostics), but the main outputs will use only oid.\n\n5) Deduplicate oids and establish ordering metric\n- Because probability may contain multiple rows per oid (e.g., across classifier_version), deduplicate to unique oids with an ordering metric:\n  - Create an aggregation subquery (S2) grouping by oid, computing MAX(probability) AS max_prob across the filtered S1 rows.\n- Purpose: ensures one row per oid and lets us rank objects by their highest qualifying probability in the stamp classifier.\n\n6) Limit to at most 50 objects with highest probabilities\n- Create a subquery (S3) selecting from S2:\n  - ORDER BY max_prob DESC (secondary tie-breaker by oid ASC for determinism).\n  - LIMIT 50.\n- Columns in S3: oid, max_prob (max_prob can be kept to order/join but will not be returned in final output).\n\n7) Join selected oids to dataquality\n- Perform an INNER JOIN from dataquality dq to S3 on dq.oid = S3.oid.\n- This returns all detection-level rows in dataquality for the selected set of at most 50 objects.\n- The output should include only dataquality.* (as explicitly requested).\n\n8) Final ordering of results (optional but recommended)\n- Apply a deterministic ORDER BY for readability, e.g.:\n  - ORDER BY S3.max_prob DESC, dq.oid ASC, dq.candid ASC\n- Note: Ordering does not change the content, just presentation.\n\n9) Performance and index considerations\n- probability table:\n  - The partial index ix_classification_rank1 on (ranking) WHERE (ranking = 1) will be used due to ranking = 1 filter.\n  - The btree index ix_probabilities_probability helps with probability > 0.7.\n  - Ensure equality filters on classifier_name and class_name are applied together with ranking to keep the filtered set small before aggregation.\n- Join strategy:\n  - Keep the set of oids limited first (S3 with LIMIT 50) and then join to dataquality to avoid scanning large portions of dataquality.\n- dataquality table:\n  - The join uses dq.oid; ensure there is an index on dataquality.oid if available (not specified in schema), otherwise expect a hash join or nested loop depending on planner.\n\n10) Summary of logical flow\n- S1: Filter probability to stamp SN, ranking=1, probability>0.7, ZTF oids.\n- S2: From S1, GROUP BY oid, compute MAX(probability) AS max_prob for deduplication and scoring.\n- S3: Order S2 by max_prob DESC, LIMIT 50 to retain at most 50 oids.\n- Final: INNER JOIN dataquality dq with S3 on oid; SELECT dq.*; optionally order results for readability.\n\nNotes\n- Use exact values for class and classifier names: class_name = 'SN' and classifier_name = 'stamp_classifier'.\n- Keep strict inequality: probability > 0.7 as requested.\n- Do not include any columns from probability in the final SELECT, since the user requested only dataquality columns."
                },
                "in_toks": 3069,
                "out_toks": 3911,
                "id": "chatcmpl-CSqsWQu0tdazP9FxbLS9KfkMzEcSz",
                "created": 1760992484,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find at most 50 ZTF objects with SN class from the stamp classifier, probability > 0.7 (ranking = 1),\n-- then return all rows from the dataquality table for those objects.\nWITH filtered AS (\n  SELECT\n    p.oid,\n    p.probability\n  FROM probability AS p\n  WHERE\n    p.classifier_name = 'stamp_classifier' -- override default lc_classifier\n    AND p.class_name = 'SN'                 -- supernova class\n    AND p.ranking = 1                       -- most likely class per classifier\n    AND p.probability > 0.7                 -- probability threshold\n    AND p.oid LIKE 'ZTF%'                   -- ensure ZTF objects\n),\nranked AS (\n  SELECT\n    oid,\n    MAX(probability) AS max_prob\n  FROM filtered\n  GROUP BY oid\n),\ntop_oids AS (\n  SELECT\n    oid,\n    max_prob\n  FROM ranked\n  ORDER BY max_prob DESC, oid ASC\n  LIMIT 50\n)\nSELECT\n  dq.*\nFROM dataquality AS dq\nINNER JOIN top_oids AS t\n  ON dq.oid = t.oid\nORDER BY t.max_prob DESC, dq.oid ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find at most 50 ZTF objects with SN class from the stamp classifier, probability > 0.7 (ranking = 1),\n-- then return all rows from the dataquality table for those objects.\nWITH filtered AS (\n  SELECT\n    p.oid,\n    p.probability\n  FROM probability AS p\n  WHERE\n    p.classifier_name = 'stamp_classifier' -- override default lc_classifier\n    AND p.class_name = 'SN'                 -- supernova class\n    AND p.ranking = 1                       -- most likely class per classifier\n    AND p.probability > 0.7                 -- probability threshold\n    AND p.oid LIKE 'ZTF%'                   -- ensure ZTF objects\n),\nranked AS (\n  SELECT\n    oid,\n    MAX(probability) AS max_prob\n  FROM filtered\n  GROUP BY oid\n),\ntop_oids AS (\n  SELECT\n    oid,\n    max_prob\n  FROM ranked\n  ORDER BY max_prob DESC, oid ASC\n  LIMIT 50\n)\nSELECT\n  dq.*\nFROM dataquality AS dq\nINNER JOIN top_oids AS t\n  ON dq.oid = t.oid\nORDER BY t.max_prob DESC, dq.oid ASC;\n```"
                },
                "in_toks": 3116,
                "out_toks": 1933,
                "id": "chatcmpl-CSr7CoocToBJiI11yf2DAjcV1cfNa",
                "created": 1760993394,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "1": {
            "req_id": "89",
            "experiment_id": "run_1",
            "pred_tables": [
                "probability",
                "taxonomy",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'dataquality']",
                    "1": "['probability', 'taxonomy', 'dataquality']"
                },
                "in_toks": 624,
                "out_toks": 1384,
                "id": "chatcmpl-CSnUGTdg660K3arQq3RdKhQyan2uo",
                "created": 1760979448,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return all columns from dataquality for at most 50 ZTF objects\n-- that have SN probability > 0.7 with ranking=1 in the stamp classifier.\n-- Optimization: first preselect up to 50 matching oids (no global sort),\n-- then join to dataquality to fetch all their rows.\nWITH selected_oids AS\n  (SELECT p.oid\n   FROM probability AS p\n   WHERE p.classifier_name = 'stamp_classifier' -- use stamp classifier\n\n     AND p.class_name = 'SN' -- supernova class\n\n     AND p.ranking = 1 -- most likely class\n\n     AND p.probability > 0.7 -- probability threshold\n\n     AND p.oid LIKE 'ZTF%' -- restrict to ZTF objects\n\n   GROUP BY p.oid -- collapse versions per object\n\n   LIMIT 50)\nSELECT dq.*\nFROM dataquality AS dq\nJOIN selected_oids AS so ON dq.oid = so.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Return all columns from dataquality for at most 50 ZTF objects\n-- that have SN probability > 0.7 with ranking=1 in the stamp classifier.\n-- Optimization: first preselect up to 50 matching oids (no global sort),\n-- then join to dataquality to fetch all their rows.\nWITH selected_oids AS\n  (SELECT p.oid\n   FROM probability AS p\n   WHERE p.classifier_name = 'stamp_classifier' -- use stamp classifier\n\n     AND p.class_name = 'SN' -- supernova class\n\n     AND p.ranking = 1 -- most likely class\n\n     AND p.probability > 0.7 -- probability threshold\n\n     AND p.oid LIKE 'ZTF%' -- restrict to ZTF objects\n\n   GROUP BY p.oid -- collapse versions per object\n\n   LIMIT 50)\nSELECT dq.*\nFROM dataquality AS dq\nJOIN selected_oids AS so ON dq.oid = so.oid;"
                },
                "in_toks": 1940,
                "out_toks": 2329,
                "id": "chatcmpl-CbH774qG1KRYZl9lDQ3HLyab5akJm",
                "created": 1762999957,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1461,
                "out_toks": 1231,
                "id": "chatcmpl-CSnk0liCw79xtHbk1mRHMS4kvjwYR",
                "created": 1760980424,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve all rows/columns from the dataquality table for at most 50 distinct ZTF objects whose stamp classifier assigns a probability > 0.7 of being supernovae (class_name 'SN').\n\nKey schema elements and constraints to use\n- probability table (classification outputs):\n  - Columns: oid, class_name, classifier_name, classifier_version, probability, ranking\n  - Primary key includes classifier_version; there can be multiple rows per oid across versions.\n  - Indexes: ix_probabilities_probability (btree), ix_probabilities_ranking (btree), ix_classification_rank1 (partial on ranking=1), ix_probabilities_oid (hash)\n- dataquality table (per detection/candidate quality metrics):\n  - Columns: candid (PK), oid, fid, plus many quality columns\n  - Foreign key (candid, oid) references detection(candid, oid)\n- Default conditions when using probability:\n  - Enforce ranking = 1 unless user explicitly overrides. The user explicitly specified classifier_name as stamp_classifier (so override default classifier_name), but did not override the ranking default; therefore apply ranking = 1.\n- Class mapping for stamp classifier:\n  - Supernovae class_name is 'SN'.\n- ZTF objects criterion:\n  - Filter oids by prefix: probability.oid LIKE 'ZTF%'.\n\nHigh-level approach\n- First, identify up to 50 distinct object IDs (oid) from probability that satisfy:\n  - classifier_name = 'stamp_classifier'\n  - class_name = 'SN'\n  - ranking = 1\n  - probability > 0.7\n  - oid LIKE 'ZTF%'\n- Handle multiple classifier_version rows per oid by collapsing to one row per oid (choose the maximum probability across versions per oid after filtering) and select the top 50 by this probability metric.\n- Then join those 50 oids to dataquality on oid and return dataquality.* for all detections belonging to those objects.\n\nDetailed steps\n\n1) Build the candidate objects subquery from probability\n- Source table: probability\n- Filters:\n  - probability.classifier_name = 'stamp_classifier'  // override the default lc_classifier per user request\n  - probability.class_name = 'SN'  // supernovae in the stamp classifier\n  - probability.ranking = 1  // apply default condition to keep the most likely class per classifier version\n  - probability.probability > 0.7  // per user threshold\n  - probability.oid LIKE 'ZTF%'  // ensure ZTF objects\n- Collapse multiple classifier_version entries per oid:\n  - Group by probability.oid\n  - Compute max(probability.probability) as prob_sn over the filtered rows to retain the strongest SN probability per oid across versions.\n  - Having prob_sn > 0.7 (the filter already ensures this, but keeping the condition at the grouped level is safe).\n- Order and limit:\n  - Order by prob_sn DESC to prioritize the most confident objects.\n  - Limit to 50 rows (i.e., at most 50 distinct oids).\n- Output columns from this subquery:\n  - oid\n  - prob_sn (the aggregated maximum probability for documentation/sorting; optional to project if you plan to order final results)\n\n2) Join the 50 candidate oids to dataquality to return all per-detection rows\n- Source table: dataquality (alias d)\n- Join: INNER JOIN on d.oid = candidates.oid\n- Projection: select d.* (all columns from dataquality), as requested.\n- Note: This can return multiple rows per oid (one per detection/candid). The \u201cat most 50 objects\u201d constraint applies to the candidate list; the final row count may exceed 50 because of multiple detections per object.\n\n3) Optional result ordering\n- If a stable and meaningful ordering is desired:\n  - Order by candidates.prob_sn DESC, then d.oid, then d.candid (or another relevant temporal/index column in dataquality).\n- If no ordering is needed, omit ORDER BY to allow the planner to optimize.\n\n4) Performance considerations\n- Using probability.ranking = 1 leverages the partial index ix_classification_rank1.\n- Filtering on probability.probability > 0.7 uses ix_probabilities_probability.\n- oid LIKE 'ZTF%' is not indexed; acceptable given preceding filters but can be kept as a secondary filter.\n- Aggregation over a filtered subset reduces the cost of GROUP BY.\n- Joining via a 50-row candidate set to dataquality is efficient.\n\n5) Summary of all conditions, tables, join keys, and outputs\n- Tables used:\n  - probability (filtered and aggregated in a subquery)\n  - dataquality (joined on oid)\n- Conditions:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.class_name = 'SN'\n  - probability.ranking = 1\n  - probability.probability > 0.7\n  - probability.oid LIKE 'ZTF%'\n- Grouping and limiting:\n  - GROUP BY probability.oid\n  - MAX(probability.probability) as prob_sn\n  - ORDER BY prob_sn DESC\n  - LIMIT 50\n- Join:\n  - INNER JOIN dataquality d ON d.oid = candidates.oid\n- Selected columns:\n  - dataquality.* (all columns from the dataquality table)\n\n6) Edge cases and notes\n- If there are no matching objects after applying ranking = 1, consider whether the user intended to include cases where SN is not the top-ranked class; by default we keep ranking = 1 as per instructions unless explicitly overridden.\n- If you prefer to use the latest classifier_version instead of max(probability), you would need a deterministic way to identify \u201clatest\u201d (e.g., max(classifier_version)), which is not specified here. Using MAX(probability) is robust and aligns with the user\u2019s emphasis on high probability.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve all rows/columns from the dataquality table for at most 50 distinct ZTF objects whose stamp classifier assigns a probability > 0.7 of being supernovae (class_name 'SN').\n\nKey schema elements and constraints to use\n- probability table (classification outputs):\n  - Columns: oid, class_name, classifier_name, classifier_version, probability, ranking\n  - Primary key includes classifier_version; there can be multiple rows per oid across versions.\n  - Indexes: ix_probabilities_probability (btree), ix_probabilities_ranking (btree), ix_classification_rank1 (partial on ranking=1), ix_probabilities_oid (hash)\n- dataquality table (per detection/candidate quality metrics):\n  - Columns: candid (PK), oid, fid, plus many quality columns\n  - Foreign key (candid, oid) references detection(candid, oid)\n- Default conditions when using probability:\n  - Enforce ranking = 1 unless user explicitly overrides. The user explicitly specified classifier_name as stamp_classifier (so override default classifier_name), but did not override the ranking default; therefore apply ranking = 1.\n- Class mapping for stamp classifier:\n  - Supernovae class_name is 'SN'.\n- ZTF objects criterion:\n  - Filter oids by prefix: probability.oid LIKE 'ZTF%'.\n\nHigh-level approach\n- First, identify up to 50 distinct object IDs (oid) from probability that satisfy:\n  - classifier_name = 'stamp_classifier'\n  - class_name = 'SN'\n  - ranking = 1\n  - probability > 0.7\n  - oid LIKE 'ZTF%'\n- Handle multiple classifier_version rows per oid by collapsing to one row per oid (choose the maximum probability across versions per oid after filtering) and select the top 50 by this probability metric.\n- Then join those 50 oids to dataquality on oid and return dataquality.* for all detections belonging to those objects.\n\nDetailed steps\n\n1) Build the candidate objects subquery from probability\n- Source table: probability\n- Filters:\n  - probability.classifier_name = 'stamp_classifier'  // override the default lc_classifier per user request\n  - probability.class_name = 'SN'  // supernovae in the stamp classifier\n  - probability.ranking = 1  // apply default condition to keep the most likely class per classifier version\n  - probability.probability > 0.7  // per user threshold\n  - probability.oid LIKE 'ZTF%'  // ensure ZTF objects\n- Collapse multiple classifier_version entries per oid:\n  - Group by probability.oid\n  - Compute max(probability.probability) as prob_sn over the filtered rows to retain the strongest SN probability per oid across versions.\n  - Having prob_sn > 0.7 (the filter already ensures this, but keeping the condition at the grouped level is safe).\n- Order and limit:\n  - Order by prob_sn DESC to prioritize the most confident objects.\n  - Limit to 50 rows (i.e., at most 50 distinct oids).\n- Output columns from this subquery:\n  - oid\n  - prob_sn (the aggregated maximum probability for documentation/sorting; optional to project if you plan to order final results)\n\n2) Join the 50 candidate oids to dataquality to return all per-detection rows\n- Source table: dataquality (alias d)\n- Join: INNER JOIN on d.oid = candidates.oid\n- Projection: select d.* (all columns from dataquality), as requested.\n- Note: This can return multiple rows per oid (one per detection/candid). The \u201cat most 50 objects\u201d constraint applies to the candidate list; the final row count may exceed 50 because of multiple detections per object.\n\n3) Optional result ordering\n- If a stable and meaningful ordering is desired:\n  - Order by candidates.prob_sn DESC, then d.oid, then d.candid (or another relevant temporal/index column in dataquality).\n- If no ordering is needed, omit ORDER BY to allow the planner to optimize.\n\n4) Performance considerations\n- Using probability.ranking = 1 leverages the partial index ix_classification_rank1.\n- Filtering on probability.probability > 0.7 uses ix_probabilities_probability.\n- oid LIKE 'ZTF%' is not indexed; acceptable given preceding filters but can be kept as a secondary filter.\n- Aggregation over a filtered subset reduces the cost of GROUP BY.\n- Joining via a 50-row candidate set to dataquality is efficient.\n\n5) Summary of all conditions, tables, join keys, and outputs\n- Tables used:\n  - probability (filtered and aggregated in a subquery)\n  - dataquality (joined on oid)\n- Conditions:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.class_name = 'SN'\n  - probability.ranking = 1\n  - probability.probability > 0.7\n  - probability.oid LIKE 'ZTF%'\n- Grouping and limiting:\n  - GROUP BY probability.oid\n  - MAX(probability.probability) as prob_sn\n  - ORDER BY prob_sn DESC\n  - LIMIT 50\n- Join:\n  - INNER JOIN dataquality d ON d.oid = candidates.oid\n- Selected columns:\n  - dataquality.* (all columns from the dataquality table)\n\n6) Edge cases and notes\n- If there are no matching objects after applying ranking = 1, consider whether the user intended to include cases where SN is not the top-ranked class; by default we keep ranking = 1 as per instructions unless explicitly overridden.\n- If you prefer to use the latest classifier_version instead of max(probability), you would need a deterministic way to identify \u201clatest\u201d (e.g., max(classifier_version)), which is not specified here. Using MAX(probability) is robust and aligns with the user\u2019s emphasis on high probability."
                },
                "in_toks": 3069,
                "out_toks": 3676,
                "id": "chatcmpl-CSqsYmWGR3FgCUBZWcrK1fqRkPFpY",
                "created": 1760992486,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all columns from the dataquality table for at most 50 distinct ZTF objects\n-- with SN probability > 0.7 from the stamp classifier (most likely class: ranking = 1)\nSELECT\n  dq.*\nFROM dataquality AS dq\nINNER JOIN (\n  SELECT\n    p.oid,\n    MAX(p.probability) AS prob_sn\n  FROM probability AS p\n  WHERE\n    p.classifier_name = 'stamp_classifier'  -- override default lc_classifier\n    AND p.class_name = 'SN'\n    AND p.ranking = 1                        -- apply default ranking = 1\n    AND p.probability > 0.7\n    AND p.oid LIKE 'ZTF%'                   -- ensure ZTF objects\n  GROUP BY p.oid\n  ORDER BY prob_sn DESC\n  LIMIT 50\n) AS cand\n  ON dq.oid = cand.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the dataquality table for at most 50 distinct ZTF objects\n-- with SN probability > 0.7 from the stamp classifier (most likely class: ranking = 1)\nSELECT\n  dq.*\nFROM dataquality AS dq\nINNER JOIN (\n  SELECT\n    p.oid,\n    MAX(p.probability) AS prob_sn\n  FROM probability AS p\n  WHERE\n    p.classifier_name = 'stamp_classifier'  -- override default lc_classifier\n    AND p.class_name = 'SN'\n    AND p.ranking = 1                        -- apply default ranking = 1\n    AND p.probability > 0.7\n    AND p.oid LIKE 'ZTF%'                   -- ensure ZTF objects\n  GROUP BY p.oid\n  ORDER BY prob_sn DESC\n  LIMIT 50\n) AS cand\n  ON dq.oid = cand.oid;\n```"
                },
                "in_toks": 3265,
                "out_toks": 1738,
                "id": "chatcmpl-CSr6v8ePFQZ7POFa5MZa1408yYSpu",
                "created": 1760993377,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "2": {
            "req_id": "89",
            "experiment_id": "run_2",
            "pred_tables": [
                "probability",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'dataquality']"
                },
                "in_toks": 624,
                "out_toks": 1489,
                "id": "chatcmpl-CSsc7SJ0VlpjwJbojH0xICmCPFvh9",
                "created": 1760999155,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Find up to 50 ZTF objects where the stamp classifier assigns class 'SN' with probability > 0.7 (top-ranked),\n-- then return all dataquality rows for those objects. Use DISTINCT ON to avoid expensive GROUP BY across versions.\nWITH sn_per_oid AS\n  (SELECT DISTINCT ON (p.oid) p.oid,\n                      p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier' -- classifier constraint\n\n     AND p.class_name = 'SN' -- supernova class\n\n     AND p.ranking = 1 -- top-ranked class\n\n     AND p.probability > 0.7 -- probability threshold\n\n     AND p.oid LIKE 'ZTF%' -- restrict to ZTF objects\n\n   ORDER BY p.oid,\n            p.probability DESC -- keep the highest probability per oid\n),\n     top_50 AS\n  (SELECT oid\n   FROM sn_per_oid\n   ORDER BY probability DESC\n   LIMIT 50)\nSELECT d.*\nFROM dataquality d\nJOIN top_50 t ON d.oid = t.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Find up to 50 ZTF objects where the stamp classifier assigns class 'SN' with probability > 0.7 (top-ranked),\n-- then return all dataquality rows for those objects. Use DISTINCT ON to avoid expensive GROUP BY across versions.\nWITH sn_per_oid AS\n  (SELECT DISTINCT ON (p.oid) p.oid,\n                      p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier' -- classifier constraint\n\n     AND p.class_name = 'SN' -- supernova class\n\n     AND p.ranking = 1 -- top-ranked class\n\n     AND p.probability > 0.7 -- probability threshold\n\n     AND p.oid LIKE 'ZTF%' -- restrict to ZTF objects\n\n   ORDER BY p.oid,\n            p.probability DESC -- keep the highest probability per oid\n),\n     top_50 AS\n  (SELECT oid\n   FROM sn_per_oid\n   ORDER BY probability DESC\n   LIMIT 50)\nSELECT d.*\nFROM dataquality d\nJOIN top_50 t ON d.oid = t.oid;"
                },
                "in_toks": 1881,
                "out_toks": 1653,
                "id": "chatcmpl-CbH7kUrZ8A707LfwkX34kWe7G1tFX",
                "created": 1762999996,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1416,
                "out_toks": 1935,
                "id": "chatcmpl-CSxUHz1CLGsAZix509tv0ggfxwdB5",
                "created": 1761017889,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 50 objects where the stamp classifier assigns class 'SN' with probability > 0.7 (and is the top-ranked class),\n-- then return all dataquality rows for those objects.\nWITH top_objects AS (\n    SELECT\n        p.oid,\n        MAX(p.probability) AS max_prob\n    FROM probability p\n    WHERE\n        p.classifier_name = 'stamp_classifier' -- use stamp-based classifier\n        AND p.class_name = 'SN'                -- supernovae in stamp classifier\n        AND p.ranking = 1                      -- top-ranked class per default condition\n        AND p.probability > 0.7\n    GROUP BY p.oid\n    ORDER BY max_prob DESC\n    LIMIT 50\n)\nSELECT d.*\nFROM dataquality d\nINNER JOIN top_objects t\n    ON d.oid = t.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 50 objects where the stamp classifier assigns class 'SN' with probability > 0.7 (and is the top-ranked class),\n-- then return all dataquality rows for those objects.\nWITH top_objects AS (\n    SELECT\n        p.oid,\n        MAX(p.probability) AS max_prob\n    FROM probability p\n    WHERE\n        p.classifier_name = 'stamp_classifier' -- use stamp-based classifier\n        AND p.class_name = 'SN'                -- supernovae in stamp classifier\n        AND p.ranking = 1                      -- top-ranked class per default condition\n        AND p.probability > 0.7\n    GROUP BY p.oid\n    ORDER BY max_prob DESC\n    LIMIT 50\n)\nSELECT d.*\nFROM dataquality d\nINNER JOIN top_objects t\n    ON d.oid = t.oid;\n```"
                },
                "in_toks": 2734,
                "out_toks": 2626,
                "id": "chatcmpl-CSxjyoV4TkFDbvFFC9FGuYmGbBa01",
                "created": 1761018862,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "3": {
            "req_id": "89",
            "experiment_id": "run_3",
            "pred_tables": [
                "probability",
                "taxonomy",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'dataquality']"
                },
                "in_toks": 624,
                "out_toks": 788,
                "id": "chatcmpl-CSscTVnpIvyQG6MuYNsUAbJJv8cBH",
                "created": 1760999177,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return all dataquality rows for up to 50 ZTF objects with P(SN | stamp_classifier) > 0.7\n-- Optimization notes:\n--  - Use latest classifier_version from taxonomy to reduce the probability search space\n--  - Keep required probability filters (classifier_name, class_name, ranking=1, probability>0.7)\n--  - Avoid ORDER BY to prevent expensive sorts; the user only requested \"at most 50\" objects\n WITH latest AS\n  (SELECT t.classifier_version\n   FROM taxonomy t\n   WHERE t.classifier_name = 'stamp_classifier'\n   ORDER BY t.classifier_version DESC\n   LIMIT 1),\n      selected_oids AS\n  (SELECT p.oid\n   FROM probability p\n   JOIN latest l ON p.classifier_version = l.classifier_version\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1\n     AND p.probability > 0.7\n     AND p.oid LIKE 'ZTF%'\n   LIMIT 50)\nSELECT dq.*\nFROM dataquality dq\nJOIN selected_oids so ON dq.oid = so.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Return all dataquality rows for up to 50 ZTF objects with P(SN | stamp_classifier) > 0.7\n-- Optimization notes:\n--  - Use latest classifier_version from taxonomy to reduce the probability search space\n--  - Keep required probability filters (classifier_name, class_name, ranking=1, probability>0.7)\n--  - Avoid ORDER BY to prevent expensive sorts; the user only requested \"at most 50\" objects\n WITH latest AS\n  (SELECT t.classifier_version\n   FROM taxonomy t\n   WHERE t.classifier_name = 'stamp_classifier'\n   ORDER BY t.classifier_version DESC\n   LIMIT 1),\n      selected_oids AS\n  (SELECT p.oid\n   FROM probability p\n   JOIN latest l ON p.classifier_version = l.classifier_version\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1\n     AND p.probability > 0.7\n     AND p.oid LIKE 'ZTF%'\n   LIMIT 50)\nSELECT dq.*\nFROM dataquality dq\nJOIN selected_oids so ON dq.oid = so.oid;"
                },
                "in_toks": 1968,
                "out_toks": 3392,
                "id": "chatcmpl-CbH8Jo7m4c5ovWDDry81wQJaH83nH",
                "created": 1763000031,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1461,
                "out_toks": 1807,
                "id": "chatcmpl-CSxUYSnZHSwaejPKdetbzzjnF4jtp",
                "created": 1761017906,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the target and base tables\n- You need to select all columns from the dataquality table for objects (oids) that satisfy a classification probability constraint.\n- The classification constraints live in the probability table (columns: oid, class_name, classifier_name, classifier_version, probability, ranking).\n- Join key: oid (dataquality.oid joins to probability.oid).\n- No spatial filtering is required; Q3C functions are not needed.\n\n2) Apply classifier and class constraints\n- The user explicitly requests the stamp-based classifier, so set:\n  - probability.classifier_name = 'stamp_classifier'\n- The target class is supernovae in the stamp classifier, which corresponds to:\n  - probability.class_name = 'SN'\n\n3) Apply default and user-specific probability constraints\n- Default condition to keep only the most likely class per classifier and version:\n  - probability.ranking = 1\n- User-specified probability threshold:\n  - probability.probability > 0.7\n\n4) Restrict to ZTF objects\n- Ensure the objects are ZTF by filtering the identifier:\n  - probability.oid LIKE 'ZTF%'\n\n5) Select at most 50 distinct objects (oids)\n- Because the result must contain at most 50 ZTF objects, limit the number of distinct oids, not the number of rows in dataquality.\n- Use a subquery or CTE (e.g., selected_oids) that:\n  - Filters probability rows using the conditions in steps 2\u20134.\n  - Deduplicates to unique oids in case multiple classifier_version rows exist for the same oid.\n  - Orders candidates by highest probability first to return the most confident objects (useful, though not strictly required by the user).\n  - Applies LIMIT 50 after deduplication so you truly get at most 50 distinct oids.\n- Two acceptable deduplication strategies:\n  - DISTINCT ON (oid) with ORDER BY probability DESC to pick the highest-probability row per oid, then LIMIT 50.\n  - Or GROUP BY oid with MAX(probability) and ORDER BY MAX(probability) DESC, then LIMIT 50.\n\n6) Retrieve all dataquality rows for those objects\n- Join the deduplicated list of up to 50 oids to dataquality:\n  - INNER JOIN dataquality dq ON dq.oid = selected_oids.oid\n- Select all columns from dataquality (dq.*) as requested.\n- Note: An object can have multiple detections; expect multiple dataquality rows per oid.\n\n7) Optional ordering of the final result\n- Optionally order the final output for readability, e.g., by dq.oid, dq.fid, dq.candid. Not required by the user.\n\n8) Performance and index considerations\n- Filtering with probability.ranking = 1 and probability.probability > 0.7 leverages existing btree indexes (ix_classification_rank1 and ix_probabilities_probability).\n- Hash index on probability.oid (ix_probabilities_oid) benefits the join from selected oids to dataquality (via dq.oid).\n- Apply LIMIT in the subquery (on distinct oids) rather than on the final SELECT to avoid truncating dataquality rows mid-object.\n\n9) Summary of constraints to include\n- From probability:\n  - classifier_name = 'stamp_classifier'\n  - class_name = 'SN'\n  - ranking = 1\n  - probability > 0.7\n  - oid LIKE 'ZTF%'\n- Limit to at most 50 distinct oids after deduplication and probability-based ordering.\n- Join those oids to dataquality and return dq.*.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the target and base tables\n- You need to select all columns from the dataquality table for objects (oids) that satisfy a classification probability constraint.\n- The classification constraints live in the probability table (columns: oid, class_name, classifier_name, classifier_version, probability, ranking).\n- Join key: oid (dataquality.oid joins to probability.oid).\n- No spatial filtering is required; Q3C functions are not needed.\n\n2) Apply classifier and class constraints\n- The user explicitly requests the stamp-based classifier, so set:\n  - probability.classifier_name = 'stamp_classifier'\n- The target class is supernovae in the stamp classifier, which corresponds to:\n  - probability.class_name = 'SN'\n\n3) Apply default and user-specific probability constraints\n- Default condition to keep only the most likely class per classifier and version:\n  - probability.ranking = 1\n- User-specified probability threshold:\n  - probability.probability > 0.7\n\n4) Restrict to ZTF objects\n- Ensure the objects are ZTF by filtering the identifier:\n  - probability.oid LIKE 'ZTF%'\n\n5) Select at most 50 distinct objects (oids)\n- Because the result must contain at most 50 ZTF objects, limit the number of distinct oids, not the number of rows in dataquality.\n- Use a subquery or CTE (e.g., selected_oids) that:\n  - Filters probability rows using the conditions in steps 2\u20134.\n  - Deduplicates to unique oids in case multiple classifier_version rows exist for the same oid.\n  - Orders candidates by highest probability first to return the most confident objects (useful, though not strictly required by the user).\n  - Applies LIMIT 50 after deduplication so you truly get at most 50 distinct oids.\n- Two acceptable deduplication strategies:\n  - DISTINCT ON (oid) with ORDER BY probability DESC to pick the highest-probability row per oid, then LIMIT 50.\n  - Or GROUP BY oid with MAX(probability) and ORDER BY MAX(probability) DESC, then LIMIT 50.\n\n6) Retrieve all dataquality rows for those objects\n- Join the deduplicated list of up to 50 oids to dataquality:\n  - INNER JOIN dataquality dq ON dq.oid = selected_oids.oid\n- Select all columns from dataquality (dq.*) as requested.\n- Note: An object can have multiple detections; expect multiple dataquality rows per oid.\n\n7) Optional ordering of the final result\n- Optionally order the final output for readability, e.g., by dq.oid, dq.fid, dq.candid. Not required by the user.\n\n8) Performance and index considerations\n- Filtering with probability.ranking = 1 and probability.probability > 0.7 leverages existing btree indexes (ix_classification_rank1 and ix_probabilities_probability).\n- Hash index on probability.oid (ix_probabilities_oid) benefits the join from selected oids to dataquality (via dq.oid).\n- Apply LIMIT in the subquery (on distinct oids) rather than on the final SELECT to avoid truncating dataquality rows mid-object.\n\n9) Summary of constraints to include\n- From probability:\n  - classifier_name = 'stamp_classifier'\n  - class_name = 'SN'\n  - ranking = 1\n  - probability > 0.7\n  - oid LIKE 'ZTF%'\n- Limit to at most 50 distinct oids after deduplication and probability-based ordering.\n- Join those oids to dataquality and return dq.*."
                },
                "in_toks": 3069,
                "out_toks": 2751,
                "id": "chatcmpl-CSxkZ1QDakpDThPGPJ43aa9cgPkpN",
                "created": 1761018899,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find at most 50 ZTF objects with P(SN | stamp_classifier) > 0.7 (ranking = 1), then return all rows from dataquality for those objects\nWITH selected_oids AS (\n  SELECT\n    p.oid,\n    MAX(p.probability) AS maxprob\n  FROM probability p\n  WHERE\n    p.classifier_name = 'stamp_classifier' -- user-requested classifier\n    AND p.class_name = 'SN'                -- supernova class in the stamp classifier\n    AND p.ranking = 1                      -- default: keep the most likely class per classifier/version\n    AND p.probability > 0.7\n    AND p.oid LIKE 'ZTF%'                  -- ensure ZTF objects\n  GROUP BY p.oid\n  ORDER BY maxprob DESC\n  LIMIT 50\n)\nSELECT dq.*\nFROM dataquality dq\nINNER JOIN selected_oids so\n  ON dq.oid = so.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find at most 50 ZTF objects with P(SN | stamp_classifier) > 0.7 (ranking = 1), then return all rows from dataquality for those objects\nWITH selected_oids AS (\n  SELECT\n    p.oid,\n    MAX(p.probability) AS maxprob\n  FROM probability p\n  WHERE\n    p.classifier_name = 'stamp_classifier' -- user-requested classifier\n    AND p.class_name = 'SN'                -- supernova class in the stamp classifier\n    AND p.ranking = 1                      -- default: keep the most likely class per classifier/version\n    AND p.probability > 0.7\n    AND p.oid LIKE 'ZTF%'                  -- ensure ZTF objects\n  GROUP BY p.oid\n  ORDER BY maxprob DESC\n  LIMIT 50\n)\nSELECT dq.*\nFROM dataquality dq\nINNER JOIN selected_oids so\n  ON dq.oid = so.oid;\n```"
                },
                "in_toks": 2788,
                "out_toks": 2263,
                "id": "chatcmpl-CSyT6zTovrMb5QctfGKCkoKSAFmQ4",
                "created": 1761021660,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "4": {
            "req_id": "89",
            "experiment_id": "run_4",
            "pred_tables": [
                "probability",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'dataquality']"
                },
                "in_toks": 624,
                "out_toks": 593,
                "id": "chatcmpl-CSscdBT90CblVDRPuVOgRcWIB5bQQ",
                "created": 1760999187,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return all rows from dataquality for up to 50 ZTF objects with P(SN) > 0.7\n-- under the stamp classifier, using ranking=1 per the probability table guidelines.\nWITH top_oids AS\n  (SELECT oid\n   FROM\n     (SELECT DISTINCT ON (p.oid) p.oid,\n                         p.probability\n      FROM probability p\n      WHERE p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'SN'\n        AND p.ranking = 1\n        AND p.probability > 0.7\n        AND p.oid LIKE 'ZTF%'\n      ORDER BY p.oid,\n               p.probability DESC) s\n   ORDER BY s.probability DESC,\n            s.oid\n   LIMIT 50)\nSELECT dq.*\nFROM dataquality dq\nJOIN top_oids t ON t.oid = dq.oid\nORDER BY dq.oid,\n         dq.candid;",
            "sql_response": {
                "responses": {
                    "0": "-- Return all rows from dataquality for up to 50 ZTF objects with P(SN) > 0.7\n-- under the stamp classifier, using ranking=1 per the probability table guidelines.\nWITH top_oids AS\n  (SELECT oid\n   FROM\n     (SELECT DISTINCT ON (p.oid) p.oid,\n                         p.probability\n      FROM probability p\n      WHERE p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'SN'\n        AND p.ranking = 1\n        AND p.probability > 0.7\n        AND p.oid LIKE 'ZTF%'\n      ORDER BY p.oid,\n               p.probability DESC) s\n   ORDER BY s.probability DESC,\n            s.oid\n   LIMIT 50)\nSELECT dq.*\nFROM dataquality dq\nJOIN top_oids t ON t.oid = dq.oid\nORDER BY dq.oid,\n         dq.candid;"
                },
                "in_toks": 2131,
                "out_toks": 1680,
                "id": "chatcmpl-CbH97BaP3f6aOyRE9qB2ysgYmMF7R",
                "created": 1763000081,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1416,
                "out_toks": 1231,
                "id": "chatcmpl-CSxUpeYhkMmlilQHLw0xSjccsNlga",
                "created": 1761017923,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the core tables and relationships\n- Use table probability to select ZTF objects (oid) meeting the classifier/probability criteria.\n  - Relevant columns: oid, class_name, classifier_name, classifier_version, probability, ranking.\n- Use table dataquality to return all requested columns for detections associated with those objects.\n  - Relevant columns: all columns (SELECT d.*), with join key d.oid.\n- Relationship:\n  - probability.oid references object(oid) (object table not needed here).\n  - dataquality rows reference objects via dataquality.oid.\n  - We will join probability-derived oids to dataquality on oid.\n\n2) Apply mandatory and user-specified probability filters\n- Default rules (from General Context):\n  - probability.ranking = 1 (keep the most likely class per classifier and version).\n- Override default classifier (user-specified):\n  - probability.classifier_name = 'stamp_classifier' (not 'lc_classifier').\n- User-specified class and threshold:\n  - probability.class_name = 'SN'.\n  - probability.probability > 0.7.\n- Optional (to enforce \u201cZTF objects\u201d explicitly if needed):\n  - probability.oid LIKE 'ZTF%'.\n\n3) Handle potential multiple classifier versions per object\n- An object (oid) may have multiple rows with ranking = 1 across different classifier_version values.\n- Deduplicate to one row per oid by selecting the highest probability per oid among the filtered rows.\n  - Use a window function (e.g., row_number() over partition by oid order by probability desc) and keep rn = 1, or DISTINCT ON (oid) ordered by probability desc.\n  - This produces a set of unique oids with their top probability for the SN class under the stamp_classifier.\n\n4) Limit to at most 50 objects with a deterministic ordering\n- Order the deduplicated oids by probability desc (and optionally by oid for tie-breaking) to select the \u201ctop\u201d objects by SN probability.\n- Apply LIMIT 50 to the unique oids (not to the joined dataquality rows) so we get at most 50 objects, even if each object has many dataquality rows.\n\n5) Join to dataquality and return all columns\n- Join dataquality d to the limited set of oids (from step 4) on d.oid = selected_oid.\n- Return all columns from dataquality:\n  - SELECT d.* (as per the instruction to return all columns from dataquality).\n- Note: This will return all dataquality detections for those up-to-50 objects, resulting in potentially more than 50 rows total (which matches the request to return all dataquality columns for such objects).\n\n6) Final filtering/ordering considerations\n- No additional filters on dataquality are specified; include all available rows for the selected oids.\n- Sorting of the final result is not requested; if needed for reproducibility, you may add ORDER BY d.oid, d.candid (or similar), but it\u2019s optional.\n\n7) Performance and index usage\n- Filters on probability will leverage:\n  - ix_probabilities_ranking on ranking = 1.\n  - ix_probabilities_probability on probability > 0.7.\n  - There is no index on classifier_name/class_name, but the combination with ranking/probability filters should remain efficient.\n- Joining from a small, limited subquery of up to 50 oids to dataquality is efficient.\n\n8) Summary of logical subqueries/steps\n- Subquery A (probability filter):\n  - FROM probability\n  - WHERE classifier_name = 'stamp_classifier'\n    AND class_name = 'SN'\n    AND ranking = 1\n    AND probability > 0.7\n    [AND oid LIKE 'ZTF%']\n- Subquery B (per-oid best probability and limit):\n  - From A, pick highest probability per oid (window function or DISTINCT ON).\n  - ORDER BY probability DESC (and oid for ties).\n  - LIMIT 50 to yield the final set of oids.\n- Main query:\n  - JOIN dataquality d ON d.oid IN (Subquery B oids).\n  - SELECT d.* to return all columns from dataquality for those objects.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the core tables and relationships\n- Use table probability to select ZTF objects (oid) meeting the classifier/probability criteria.\n  - Relevant columns: oid, class_name, classifier_name, classifier_version, probability, ranking.\n- Use table dataquality to return all requested columns for detections associated with those objects.\n  - Relevant columns: all columns (SELECT d.*), with join key d.oid.\n- Relationship:\n  - probability.oid references object(oid) (object table not needed here).\n  - dataquality rows reference objects via dataquality.oid.\n  - We will join probability-derived oids to dataquality on oid.\n\n2) Apply mandatory and user-specified probability filters\n- Default rules (from General Context):\n  - probability.ranking = 1 (keep the most likely class per classifier and version).\n- Override default classifier (user-specified):\n  - probability.classifier_name = 'stamp_classifier' (not 'lc_classifier').\n- User-specified class and threshold:\n  - probability.class_name = 'SN'.\n  - probability.probability > 0.7.\n- Optional (to enforce \u201cZTF objects\u201d explicitly if needed):\n  - probability.oid LIKE 'ZTF%'.\n\n3) Handle potential multiple classifier versions per object\n- An object (oid) may have multiple rows with ranking = 1 across different classifier_version values.\n- Deduplicate to one row per oid by selecting the highest probability per oid among the filtered rows.\n  - Use a window function (e.g., row_number() over partition by oid order by probability desc) and keep rn = 1, or DISTINCT ON (oid) ordered by probability desc.\n  - This produces a set of unique oids with their top probability for the SN class under the stamp_classifier.\n\n4) Limit to at most 50 objects with a deterministic ordering\n- Order the deduplicated oids by probability desc (and optionally by oid for tie-breaking) to select the \u201ctop\u201d objects by SN probability.\n- Apply LIMIT 50 to the unique oids (not to the joined dataquality rows) so we get at most 50 objects, even if each object has many dataquality rows.\n\n5) Join to dataquality and return all columns\n- Join dataquality d to the limited set of oids (from step 4) on d.oid = selected_oid.\n- Return all columns from dataquality:\n  - SELECT d.* (as per the instruction to return all columns from dataquality).\n- Note: This will return all dataquality detections for those up-to-50 objects, resulting in potentially more than 50 rows total (which matches the request to return all dataquality columns for such objects).\n\n6) Final filtering/ordering considerations\n- No additional filters on dataquality are specified; include all available rows for the selected oids.\n- Sorting of the final result is not requested; if needed for reproducibility, you may add ORDER BY d.oid, d.candid (or similar), but it\u2019s optional.\n\n7) Performance and index usage\n- Filters on probability will leverage:\n  - ix_probabilities_ranking on ranking = 1.\n  - ix_probabilities_probability on probability > 0.7.\n  - There is no index on classifier_name/class_name, but the combination with ranking/probability filters should remain efficient.\n- Joining from a small, limited subquery of up to 50 oids to dataquality is efficient.\n\n8) Summary of logical subqueries/steps\n- Subquery A (probability filter):\n  - FROM probability\n  - WHERE classifier_name = 'stamp_classifier'\n    AND class_name = 'SN'\n    AND ranking = 1\n    AND probability > 0.7\n    [AND oid LIKE 'ZTF%']\n- Subquery B (per-oid best probability and limit):\n  - From A, pick highest probability per oid (window function or DISTINCT ON).\n  - ORDER BY probability DESC (and oid for ties).\n  - LIMIT 50 to yield the final set of oids.\n- Main query:\n  - JOIN dataquality d ON d.oid IN (Subquery B oids).\n  - SELECT d.* to return all columns from dataquality for those objects."
                },
                "in_toks": 3024,
                "out_toks": 2745,
                "id": "chatcmpl-CSxlKhf3K8Pe7n2UZzahX1nFL4HpN",
                "created": 1761018946,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 50 ZTF objects with P(SN) > 0.7 under the stamp classifier (ranking=1),\n-- and return all per-detection columns for those objects.\n-- NOTE: The provided schema does not include a 'dataquality' table; using 'detection' instead.\n\nWITH filtered AS (\n    SELECT\n        p.oid,\n        p.probability\n    FROM probability p\n    WHERE\n        p.classifier_name = 'stamp_classifier'  -- user-specified classifier\n        AND p.class_name = 'SN'                 -- supernovae class\n        AND p.ranking = 1                       -- default condition: most likely class\n        AND p.probability > 0.7\n        AND p.oid LIKE 'ZTF%'                   -- ensure ZTF objects\n),\ndedup AS (\n    -- Keep the highest probability per oid (in case multiple versions exist)\n    SELECT DISTINCT ON (oid)\n        oid,\n        probability\n    FROM filtered\n    ORDER BY oid, probability DESC\n),\ntop50 AS (\n    -- Select at most 50 objects by highest probability\n    SELECT\n        oid\n    FROM dedup\n    ORDER BY probability DESC, oid\n    LIMIT 50\n)\nSELECT\n    d.*  -- return all columns from the detection table for the selected objects\nFROM detection d\nINNER JOIN top50 t\n    ON t.oid = d.oid\nORDER BY d.oid, d.mjd, d.candid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 50 ZTF objects with P(SN) > 0.7 under the stamp classifier (ranking=1),\n-- and return all per-detection columns for those objects.\n-- NOTE: The provided schema does not include a 'dataquality' table; using 'detection' instead.\n\nWITH filtered AS (\n    SELECT\n        p.oid,\n        p.probability\n    FROM probability p\n    WHERE\n        p.classifier_name = 'stamp_classifier'  -- user-specified classifier\n        AND p.class_name = 'SN'                 -- supernovae class\n        AND p.ranking = 1                       -- default condition: most likely class\n        AND p.probability > 0.7\n        AND p.oid LIKE 'ZTF%'                   -- ensure ZTF objects\n),\ndedup AS (\n    -- Keep the highest probability per oid (in case multiple versions exist)\n    SELECT DISTINCT ON (oid)\n        oid,\n        probability\n    FROM filtered\n    ORDER BY oid, probability DESC\n),\ntop50 AS (\n    -- Select at most 50 objects by highest probability\n    SELECT\n        oid\n    FROM dedup\n    ORDER BY probability DESC, oid\n    LIMIT 50\n)\nSELECT\n    d.*  -- return all columns from the detection table for the selected objects\nFROM detection d\nINNER JOIN top50 t\n    ON t.oid = d.oid\nORDER BY d.oid, d.mjd, d.candid;\n```"
                },
                "in_toks": 2910,
                "out_toks": 2177,
                "id": "chatcmpl-CSyTR1HfxRTqRqSAmtiHCSXkLuzcx",
                "created": 1761021681,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "5": {
            "req_id": "89",
            "experiment_id": "run_5",
            "pred_tables": [
                "probability",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'dataquality']"
                },
                "in_toks": 624,
                "out_toks": 593,
                "id": "chatcmpl-CZMUBV6DZXn5YKf8VyFamCNklnvyS",
                "created": 1762543951,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Find up to 50 ZTF objects whose top-ranked stamp classifier label is 'SN' with probability > 0.7,\n-- then return all columns from dataquality for those objects.\n-- Optimizations:\n--  - Preselect a small set of oids without ORDER BY to avoid expensive sorts.\n--  - Keep the required probability conditions (>=3) including ranking=1.\n--  - Restrict to ZTF oids to narrow the search space.\nWITH selected_oids AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1\n     AND p.probability > 0.7\n     AND p.oid LIKE 'ZTF%'\n   LIMIT 50)\nSELECT d.*\nFROM dataquality d\nJOIN selected_oids s ON s.oid = d.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Find up to 50 ZTF objects whose top-ranked stamp classifier label is 'SN' with probability > 0.7,\n-- then return all columns from dataquality for those objects.\n-- Optimizations:\n--  - Preselect a small set of oids without ORDER BY to avoid expensive sorts.\n--  - Keep the required probability conditions (>=3) including ranking=1.\n--  - Restrict to ZTF oids to narrow the search space.\nWITH selected_oids AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1\n     AND p.probability > 0.7\n     AND p.oid LIKE 'ZTF%'\n   LIMIT 50)\nSELECT d.*\nFROM dataquality d\nJOIN selected_oids s ON s.oid = d.oid;"
                },
                "in_toks": 1918,
                "out_toks": 2569,
                "id": "chatcmpl-CbH9Sirf7fJWR85Wpn6PjQZPdoyz1",
                "created": 1763000102,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1416,
                "out_toks": 1487,
                "id": "chatcmpl-CZYLBFZOlMZeuCn1AgEalEVdylrRv",
                "created": 1762589521,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve at most 50 ZTF objects (by oid) that have probability > 0.7 of being supernovae according to the stamp classifier, and return all columns from the dataquality table for those objects.\n\nKey schema elements and constraints to use\n- probability table (classification results):\n  - Columns: oid, class_name, classifier_name, classifier_version, probability, ranking\n  - Defaults to apply (per instructions): ranking = 1 (keep only top-ranked class per classifier/version)\n  - User-specified classifier/class override defaults: classifier_name = 'stamp_classifier' and class_name = 'SN'\n- dataquality table (image/photometry data at detection level):\n  - Columns: candid (PK), oid, fid, xpos, ypos, chipsf, sky, fwhm, classtar, mindtoedge, seeratio, aimage, bimage, aimagerat, bimagerat, nneg, nbad, sumrat, scorr, dsnrms, ssnrms, magzpsci, magzpsciunc, magzpscirms, nmatches, clrcoeff, clrcounc, zpclrcov, zpmed, clrmed, clrrms, exptime\n  - Foreign key (candid, oid) -> detection(candid, oid)\n- Join key between the two: oid\n- Class names for stamp classifier: 'SN' (supernovae), 'AGN', 'VS', 'asteroid', 'bogus'\n\nHigh-level approach\n- First, select the set of up to 50 distinct oids from probability that satisfy:\n  - classifier_name = 'stamp_classifier'\n  - class_name = 'SN'\n  - ranking = 1 (default condition)\n  - probability > 0.7\n  - If multiple classifier_version rows exist for an oid, deduplicate per oid by aggregating and using the maximum probability across versions to rank objects.\n- Then, join those oids to dataquality on oid and return all columns from dataquality for the matched objects.\n\nDetailed steps\n\n1) Build the classification filter subquery (candidate objects)\n- From probability p\n- WHERE conditions:\n  - p.classifier_name = 'stamp_classifier'  // user explicitly requested stamp classifier\n  - p.class_name = 'SN'                     // supernovae in stamp classifier are labeled 'SN'\n  - p.ranking = 1                           // apply default condition to keep the top-ranked class per classifier/version\n  - p.probability > 0.7                     // user-specified threshold\n- Handle multiple classifier versions:\n  - Group by p.oid and compute p_sn_max = MAX(p.probability) to capture the best available version per oid\n- Sort and limit to enforce \u201cat most 50 objects\u201d and favor the highest probabilities:\n  - ORDER BY p_sn_max DESC (optionally add a deterministic tiebreaker such as oid ASC)\n  - LIMIT 50\n- Output columns from this subquery:\n  - oid\n  - p_sn_max (optional; useful for ordering the final result, but not strictly required)\n\n2) Join the selected objects to dataquality\n- Use the result of step 1 (call it selected_oids) and INNER JOIN dataquality d ON d.oid = selected_oids.oid\n- SELECT all columns from dataquality as requested: d.* (the entire row for each detection associated with those objects)\n- Note: dataquality contains multiple rows per oid (one per detection/candid). This join intentionally returns all those rows for the selected oids.\n\n3) Optional result ordering\n- If you want the output grouped by highest SN probability and then by object/detection:\n  - ORDER BY selected_oids.p_sn_max DESC, d.oid ASC, d.candid ASC\n- If ordering is not specified, you may omit this, but applying a deterministic ORDER BY is recommended when using LIMIT in the subquery.\n\n4) Constraints and defaults applied summary\n- Classifier: classifier_name = 'stamp_classifier' (explicitly requested; overrides the default 'lc_classifier')\n- Class: class_name = 'SN' (exact string for supernovae in the stamp classifier)\n- Ranking: ranking = 1 (default condition maintained, since the user did not override ranking)\n- Probability threshold: probability > 0.7 (explicitly requested)\n- Limit to 50 distinct oids applied in the subquery prior to joining to dataquality to ensure \u201cat most 50 objects,\u201d not \u201cat most 50 dataquality rows\u201d\n\n5) Performance and index considerations\n- The following conditions enable efficient filtering:\n  - ranking = 1 leverages the partial index ix_classification_rank1 on probability\n  - probability > 0.7 can use ix_probabilities_probability\n  - An additional filter on classifier_name and class_name will further reduce rows; although no specific index is listed for these columns, the ranking/ probability indices significantly narrow the scan.\n- The join from selected_oids (which has at most 50 rows) to dataquality on oid is efficient.\n- Aggregation by oid with MAX(probability) ensures deduplication across classifier_version without exploding rows.\n\n6) Final shape of the query (no SQL, structural outline)\n- WITH selected_oids AS (\n  - SELECT p.oid, MAX(p.probability) AS p_sn_max\n  - FROM probability p\n  - WHERE p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND p.probability > 0.7\n  - GROUP BY p.oid\n  - ORDER BY p_sn_max DESC, p.oid ASC\n  - LIMIT 50\n)\n- SELECT d.*\n- FROM dataquality d\n- INNER JOIN selected_oids s ON d.oid = s.oid\n- [OPTIONAL] ORDER BY s.p_sn_max DESC, d.oid ASC, d.candid ASC\n\n7) Output\n- All columns from dataquality for all detections belonging to at most 50 objects that satisfy the specified stamp classifier SN probability criterion.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve at most 50 ZTF objects (by oid) that have probability > 0.7 of being supernovae according to the stamp classifier, and return all columns from the dataquality table for those objects.\n\nKey schema elements and constraints to use\n- probability table (classification results):\n  - Columns: oid, class_name, classifier_name, classifier_version, probability, ranking\n  - Defaults to apply (per instructions): ranking = 1 (keep only top-ranked class per classifier/version)\n  - User-specified classifier/class override defaults: classifier_name = 'stamp_classifier' and class_name = 'SN'\n- dataquality table (image/photometry data at detection level):\n  - Columns: candid (PK), oid, fid, xpos, ypos, chipsf, sky, fwhm, classtar, mindtoedge, seeratio, aimage, bimage, aimagerat, bimagerat, nneg, nbad, sumrat, scorr, dsnrms, ssnrms, magzpsci, magzpsciunc, magzpscirms, nmatches, clrcoeff, clrcounc, zpclrcov, zpmed, clrmed, clrrms, exptime\n  - Foreign key (candid, oid) -> detection(candid, oid)\n- Join key between the two: oid\n- Class names for stamp classifier: 'SN' (supernovae), 'AGN', 'VS', 'asteroid', 'bogus'\n\nHigh-level approach\n- First, select the set of up to 50 distinct oids from probability that satisfy:\n  - classifier_name = 'stamp_classifier'\n  - class_name = 'SN'\n  - ranking = 1 (default condition)\n  - probability > 0.7\n  - If multiple classifier_version rows exist for an oid, deduplicate per oid by aggregating and using the maximum probability across versions to rank objects.\n- Then, join those oids to dataquality on oid and return all columns from dataquality for the matched objects.\n\nDetailed steps\n\n1) Build the classification filter subquery (candidate objects)\n- From probability p\n- WHERE conditions:\n  - p.classifier_name = 'stamp_classifier'  // user explicitly requested stamp classifier\n  - p.class_name = 'SN'                     // supernovae in stamp classifier are labeled 'SN'\n  - p.ranking = 1                           // apply default condition to keep the top-ranked class per classifier/version\n  - p.probability > 0.7                     // user-specified threshold\n- Handle multiple classifier versions:\n  - Group by p.oid and compute p_sn_max = MAX(p.probability) to capture the best available version per oid\n- Sort and limit to enforce \u201cat most 50 objects\u201d and favor the highest probabilities:\n  - ORDER BY p_sn_max DESC (optionally add a deterministic tiebreaker such as oid ASC)\n  - LIMIT 50\n- Output columns from this subquery:\n  - oid\n  - p_sn_max (optional; useful for ordering the final result, but not strictly required)\n\n2) Join the selected objects to dataquality\n- Use the result of step 1 (call it selected_oids) and INNER JOIN dataquality d ON d.oid = selected_oids.oid\n- SELECT all columns from dataquality as requested: d.* (the entire row for each detection associated with those objects)\n- Note: dataquality contains multiple rows per oid (one per detection/candid). This join intentionally returns all those rows for the selected oids.\n\n3) Optional result ordering\n- If you want the output grouped by highest SN probability and then by object/detection:\n  - ORDER BY selected_oids.p_sn_max DESC, d.oid ASC, d.candid ASC\n- If ordering is not specified, you may omit this, but applying a deterministic ORDER BY is recommended when using LIMIT in the subquery.\n\n4) Constraints and defaults applied summary\n- Classifier: classifier_name = 'stamp_classifier' (explicitly requested; overrides the default 'lc_classifier')\n- Class: class_name = 'SN' (exact string for supernovae in the stamp classifier)\n- Ranking: ranking = 1 (default condition maintained, since the user did not override ranking)\n- Probability threshold: probability > 0.7 (explicitly requested)\n- Limit to 50 distinct oids applied in the subquery prior to joining to dataquality to ensure \u201cat most 50 objects,\u201d not \u201cat most 50 dataquality rows\u201d\n\n5) Performance and index considerations\n- The following conditions enable efficient filtering:\n  - ranking = 1 leverages the partial index ix_classification_rank1 on probability\n  - probability > 0.7 can use ix_probabilities_probability\n  - An additional filter on classifier_name and class_name will further reduce rows; although no specific index is listed for these columns, the ranking/ probability indices significantly narrow the scan.\n- The join from selected_oids (which has at most 50 rows) to dataquality on oid is efficient.\n- Aggregation by oid with MAX(probability) ensures deduplication across classifier_version without exploding rows.\n\n6) Final shape of the query (no SQL, structural outline)\n- WITH selected_oids AS (\n  - SELECT p.oid, MAX(p.probability) AS p_sn_max\n  - FROM probability p\n  - WHERE p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.ranking = 1\n    AND p.probability > 0.7\n  - GROUP BY p.oid\n  - ORDER BY p_sn_max DESC, p.oid ASC\n  - LIMIT 50\n)\n- SELECT d.*\n- FROM dataquality d\n- INNER JOIN selected_oids s ON d.oid = s.oid\n- [OPTIONAL] ORDER BY s.p_sn_max DESC, d.oid ASC, d.candid ASC\n\n7) Output\n- All columns from dataquality for all detections belonging to at most 50 objects that satisfy the specified stamp classifier SN probability criterion."
                },
                "in_toks": 3024,
                "out_toks": 3655,
                "id": "chatcmpl-CZZfOgJGCqyZLKSpJKrQzVmJn4O32",
                "created": 1762594618,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all rows from dataquality for at most 50 ZTF objects whose top-ranked\n-- stamp classifier label is 'SN' with probability > 0.7.\n-- Default conditions applied for probability: ranking = 1.\nWITH selected_oids AS (\n    SELECT\n        p.oid,\n        MAX(p.probability) AS p_sn_max\n    FROM probability p\n    WHERE\n        p.classifier_name = 'stamp_classifier' -- override default lc_classifier\n        AND p.class_name = 'SN'\n        AND p.ranking = 1\n        AND p.probability > 0.7\n    GROUP BY p.oid\n    ORDER BY p_sn_max DESC, p.oid ASC\n    LIMIT 50\n)\nSELECT\n    d.*\nFROM dataquality d\nINNER JOIN selected_oids s\n    ON d.oid = s.oid\nORDER BY s.p_sn_max DESC, d.oid ASC, d.candid ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all rows from dataquality for at most 50 ZTF objects whose top-ranked\n-- stamp classifier label is 'SN' with probability > 0.7.\n-- Default conditions applied for probability: ranking = 1.\nWITH selected_oids AS (\n    SELECT\n        p.oid,\n        MAX(p.probability) AS p_sn_max\n    FROM probability p\n    WHERE\n        p.classifier_name = 'stamp_classifier' -- override default lc_classifier\n        AND p.class_name = 'SN'\n        AND p.ranking = 1\n        AND p.probability > 0.7\n    GROUP BY p.oid\n    ORDER BY p_sn_max DESC, p.oid ASC\n    LIMIT 50\n)\nSELECT\n    d.*\nFROM dataquality d\nINNER JOIN selected_oids s\n    ON d.oid = s.oid\nORDER BY s.p_sn_max DESC, d.oid ASC, d.candid ASC;\n```"
                },
                "in_toks": 3308,
                "out_toks": 1171,
                "id": "chatcmpl-CZawcu2BBhXYplaLPpvualWWCvGTI",
                "created": 1762599530,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "6": {
            "req_id": "89",
            "experiment_id": "run_6",
            "pred_tables": [
                "probability",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'dataquality']"
                },
                "in_toks": 624,
                "out_toks": 721,
                "id": "chatcmpl-CZMUQxuYLeL3WEunQM79yDYv4YnTH",
                "created": 1762543966,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return all dataquality rows for up to 50 ZTF objects with SN probability > 0.7\n-- from the stamp classifier, considering only the top-ranked class (ranking=1).\n-- Optimized by avoiding ORDER BY and aggregation; select any 50 matching oids first.\nWITH sn50 AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier' -- classifier filter\n\n     AND p.class_name = 'SN' -- class filter (supernovae)\n\n     AND p.ranking = 1 -- only top-ranked class per classifier\n\n     AND p.probability > 0.7 -- probability threshold\n\n     AND p.oid LIKE 'ZTF%' -- ZTF objects only\n\n   LIMIT 50)\nSELECT dq.*\nFROM dataquality dq\nWHERE dq.oid IN\n    (SELECT oid\n     FROM sn50);",
            "sql_response": {
                "responses": {
                    "0": "-- Return all dataquality rows for up to 50 ZTF objects with SN probability > 0.7\n-- from the stamp classifier, considering only the top-ranked class (ranking=1).\n-- Optimized by avoiding ORDER BY and aggregation; select any 50 matching oids first.\nWITH sn50 AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier' -- classifier filter\n\n     AND p.class_name = 'SN' -- class filter (supernovae)\n\n     AND p.ranking = 1 -- only top-ranked class per classifier\n\n     AND p.probability > 0.7 -- probability threshold\n\n     AND p.oid LIKE 'ZTF%' -- ZTF objects only\n\n   LIMIT 50)\nSELECT dq.*\nFROM dataquality dq\nWHERE dq.oid IN\n    (SELECT oid\n     FROM sn50);"
                },
                "in_toks": 1854,
                "out_toks": 1603,
                "id": "chatcmpl-CbH9yFV3FqCivbaZkfBNOLzrf5Biw",
                "created": 1763000134,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1416,
                "out_toks": 1167,
                "id": "chatcmpl-CZYLjrQx2te6YVhQ2nhGoQVWnMtFx",
                "created": 1762589555,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and outputs\n- Goal: Retrieve all rows from the dataquality table for up to 50 distinct ZTF objects whose stamp classifier assigns a supernova ('SN') probability greater than 0.7.\n- Output: All columns from dataquality (i.e., SELECT dq.*).\n- Limit semantics: Limit to at most 50 distinct objects (oids), not 50 dataquality rows. Return all dataquality rows for those selected oids.\n\n2) Identify the relevant tables and columns\n- probability: columns oid, class_name, classifier_name, classifier_version, probability, ranking.\n- dataquality: columns candid (PK), oid, fid, xpos, ypos, chipsf, sky, fwhm, classtar, mindtoedge, seeratio, aimage, bimage, aimagerat, bimagerat, nneg, nbad, sumrat, scorr, dsnrms, ssnrms, magzpsci, magzpsciunc, magzpscirms, nmatches, clrcoeff, clrcounc, zpclrcov, zpmed, clrmed, clrrms, exptime.\n- Relationship: dataquality.oid matches probability.oid.\n\n3) Apply mandatory/default conditions for the probability table, adapting to the user\u2019s explicit request\n- Use classifier_name = 'stamp_classifier' (explicitly requested; overrides the default lc_classifier).\n- Keep the default ranking = 1 (since the user did not specify otherwise; and if SN probability > 0.7, it will naturally be rank 1).\n- Use class_name = 'SN' (stamp classifier class names: 'SN', 'AGN', 'VS', 'asteroid', 'bogus').\n- Use probability > 0.7 (strictly greater than 0.7 as requested).\n- Because the user asked for \u201cZTF objects,\u201d constrain to ZTF oids: oid LIKE 'ZTF%' (assuming ALeRCE oids for ZTF begin with 'ZTF').\n\n4) Build a subquery that selects up to 50 distinct oids satisfying the conditions, preferring the best-scoring version per object\n- Start from probability.\n- Filters:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.class_name = 'SN'\n  - probability.ranking = 1\n  - probability.probability > 0.7\n  - probability.oid LIKE 'ZTF%'\n- Handle multiple classifier versions per object:\n  - Reduce to one row per oid by taking the maximum probability across versions: GROUP BY oid and compute max(probability) AS sn_prob.\n- Order and limit:\n  - ORDER BY sn_prob DESC to pick the strongest SN candidates first.\n  - LIMIT 50 to restrict to at most 50 distinct oids.\n- Alias this result as sn50(oid, sn_prob).\n\n5) Join the selected object set to dataquality to retrieve all quality rows for those objects\n- FROM dataquality dq\n- INNER JOIN sn50 ON dq.oid = sn50.oid\n- SELECT dq.* to return all dataquality columns.\n- Do not apply an additional LIMIT at this stage (to avoid dropping rows for selected objects).\n\n6) Optional ordering of final results\n- If a stable presentation is desired, you can ORDER BY dq.oid, dq.candid (or any sensible combination). Not required by the user.\n\n7) Performance and index considerations\n- The probability filters will benefit from:\n  - Partial index on ranking = 1 (ix_classification_rank1).\n  - Btree index on probability (ix_probabilities_probability).\n- Restricting to 50 oids in the subquery ensures the subsequent join to dataquality remains efficient even without an index on dataquality.oid (if available, an index on dataquality.oid would help, but is not required due to the small join set).\n- Using an INNER JOIN with a derived subquery of 50 oids (sn50) or a WHERE oid IN (SELECT ...) are both acceptable; the join approach is recommended for clarity.\n\n8) Final checks\n- Ensure exact string literals for classifier and class: 'stamp_classifier' and 'SN'.\n- Ensure strict inequality probability > 0.7.\n- Ensure the limit of 50 applies at the object (oid) selection subquery, not to the final dataquality rows.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and outputs\n- Goal: Retrieve all rows from the dataquality table for up to 50 distinct ZTF objects whose stamp classifier assigns a supernova ('SN') probability greater than 0.7.\n- Output: All columns from dataquality (i.e., SELECT dq.*).\n- Limit semantics: Limit to at most 50 distinct objects (oids), not 50 dataquality rows. Return all dataquality rows for those selected oids.\n\n2) Identify the relevant tables and columns\n- probability: columns oid, class_name, classifier_name, classifier_version, probability, ranking.\n- dataquality: columns candid (PK), oid, fid, xpos, ypos, chipsf, sky, fwhm, classtar, mindtoedge, seeratio, aimage, bimage, aimagerat, bimagerat, nneg, nbad, sumrat, scorr, dsnrms, ssnrms, magzpsci, magzpsciunc, magzpscirms, nmatches, clrcoeff, clrcounc, zpclrcov, zpmed, clrmed, clrrms, exptime.\n- Relationship: dataquality.oid matches probability.oid.\n\n3) Apply mandatory/default conditions for the probability table, adapting to the user\u2019s explicit request\n- Use classifier_name = 'stamp_classifier' (explicitly requested; overrides the default lc_classifier).\n- Keep the default ranking = 1 (since the user did not specify otherwise; and if SN probability > 0.7, it will naturally be rank 1).\n- Use class_name = 'SN' (stamp classifier class names: 'SN', 'AGN', 'VS', 'asteroid', 'bogus').\n- Use probability > 0.7 (strictly greater than 0.7 as requested).\n- Because the user asked for \u201cZTF objects,\u201d constrain to ZTF oids: oid LIKE 'ZTF%' (assuming ALeRCE oids for ZTF begin with 'ZTF').\n\n4) Build a subquery that selects up to 50 distinct oids satisfying the conditions, preferring the best-scoring version per object\n- Start from probability.\n- Filters:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.class_name = 'SN'\n  - probability.ranking = 1\n  - probability.probability > 0.7\n  - probability.oid LIKE 'ZTF%'\n- Handle multiple classifier versions per object:\n  - Reduce to one row per oid by taking the maximum probability across versions: GROUP BY oid and compute max(probability) AS sn_prob.\n- Order and limit:\n  - ORDER BY sn_prob DESC to pick the strongest SN candidates first.\n  - LIMIT 50 to restrict to at most 50 distinct oids.\n- Alias this result as sn50(oid, sn_prob).\n\n5) Join the selected object set to dataquality to retrieve all quality rows for those objects\n- FROM dataquality dq\n- INNER JOIN sn50 ON dq.oid = sn50.oid\n- SELECT dq.* to return all dataquality columns.\n- Do not apply an additional LIMIT at this stage (to avoid dropping rows for selected objects).\n\n6) Optional ordering of final results\n- If a stable presentation is desired, you can ORDER BY dq.oid, dq.candid (or any sensible combination). Not required by the user.\n\n7) Performance and index considerations\n- The probability filters will benefit from:\n  - Partial index on ranking = 1 (ix_classification_rank1).\n  - Btree index on probability (ix_probabilities_probability).\n- Restricting to 50 oids in the subquery ensures the subsequent join to dataquality remains efficient even without an index on dataquality.oid (if available, an index on dataquality.oid would help, but is not required due to the small join set).\n- Using an INNER JOIN with a derived subquery of 50 oids (sn50) or a WHERE oid IN (SELECT ...) are both acceptable; the join approach is recommended for clarity.\n\n8) Final checks\n- Ensure exact string literals for classifier and class: 'stamp_classifier' and 'SN'.\n- Ensure strict inequality probability > 0.7.\n- Ensure the limit of 50 applies at the object (oid) selection subquery, not to the final dataquality rows."
                },
                "in_toks": 3024,
                "out_toks": 3930,
                "id": "chatcmpl-CZZieRRfOrOdYUDjfhMI11PCQ8vSZ",
                "created": 1762594820,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all rows from dataquality for up to 50 ZTF objects with SN probability > 0.7\n-- according to the stamp classifier, considering only top-ranked class per classifier output.\nWITH sn50 AS (\n    SELECT\n        p.oid,\n        MAX(p.probability) AS sn_prob\n    FROM probability p\n    WHERE\n        p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'SN'\n        AND p.ranking = 1\n        AND p.probability > 0.7\n        AND p.oid LIKE 'ZTF%'\n    GROUP BY p.oid\n    ORDER BY sn_prob DESC\n    LIMIT 50\n)\nSELECT\n    dq.*\nFROM dataquality dq\nINNER JOIN sn50 ON dq.oid = sn50.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all rows from dataquality for up to 50 ZTF objects with SN probability > 0.7\n-- according to the stamp classifier, considering only top-ranked class per classifier output.\nWITH sn50 AS (\n    SELECT\n        p.oid,\n        MAX(p.probability) AS sn_prob\n    FROM probability p\n    WHERE\n        p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'SN'\n        AND p.ranking = 1\n        AND p.probability > 0.7\n        AND p.oid LIKE 'ZTF%'\n    GROUP BY p.oid\n    ORDER BY sn_prob DESC\n    LIMIT 50\n)\nSELECT\n    dq.*\nFROM dataquality dq\nINNER JOIN sn50 ON dq.oid = sn50.oid;\n```"
                },
                "in_toks": 2943,
                "out_toks": 1779,
                "id": "chatcmpl-CZb4aNdEldgTzuvE8CsN5XLafoGKe",
                "created": 1762600024,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "7": {
            "req_id": "89",
            "experiment_id": "run_7",
            "pred_tables": [
                "probability",
                "dataquality",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'dataquality', 'taxonomy']"
                },
                "in_toks": 624,
                "out_toks": 916,
                "id": "chatcmpl-CZMUiIJdefpqEwLfizcpy6HBvn0vW",
                "created": 1762543984,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return all dataquality rows for up to 50 ZTF objects with SN probability > 0.7 in the stamp classifier (ranking = 1)\n-- Optimized: avoid ORDER BY/DISTINCT ON; select 50 oids first, then join to dataquality\n\nSELECT dq.*\nFROM dataquality dq\nJOIN\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.probability > 0.7\n     AND p.ranking = 1\n   LIMIT 50) top_oids ON dq.oid = top_oids.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Return all dataquality rows for up to 50 ZTF objects with SN probability > 0.7 in the stamp classifier (ranking = 1)\n-- Optimized: avoid ORDER BY/DISTINCT ON; select 50 oids first, then join to dataquality\n\nSELECT dq.*\nFROM dataquality dq\nJOIN\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.probability > 0.7\n     AND p.ranking = 1\n   LIMIT 50) top_oids ON dq.oid = top_oids.oid;"
                },
                "in_toks": 1909,
                "out_toks": 1878,
                "id": "chatcmpl-CbHAHKaGdknk330COeK5fGgKoITcT",
                "created": 1763000153,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1461,
                "out_toks": 975,
                "id": "chatcmpl-CZYM1bTPfbJZGoNLOwXlbbTyM82VK",
                "created": 1762589573,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Interpret the user request and map to schema entities\n- Target rows to return: all columns from the dataquality table (i.e., SELECT dq.*).\n- Selection criterion: ZTF objects (identified by probability.oid and dataquality.oid) that, in the stamp classifier, have probability > 0.7 of being a supernova.\n- Classifier and class to use:\n  - classifier_name must be 'stamp_classifier' (explicitly requested by user, overriding the default lc_classifier).\n  - class_name must be 'SN' (per the documented classes for stamp_classifier: 'SN', 'AGN', 'VS', 'asteroid', 'bogus').\n- Default probability conditions:\n  - Keep probability.ranking = 1 (default applies because the user did not override ranking).\n- Row limit:\n  - \u201cAt most 50 ZTF objects\u201d means limit to 50 distinct oids that satisfy the classification criterion. Then return all dataquality rows for those 50 objects.\n\n2) Identify required tables and columns\n- probability table (alias p):\n  - Columns needed for filtering and object selection: p.oid, p.class_name, p.classifier_name, p.probability, p.ranking.\n- dataquality table (alias dq):\n  - Columns to return: all columns (dq.*).\n  - Column for joining: dq.oid.\n- No spatial filtering (Q3C not needed). taxonomy table not needed.\n\n3) Build the filtered candidate set of objects (limit to 50 distinct oids)\n- Use probability filters:\n  - p.classifier_name = 'stamp_classifier'\n  - p.class_name = 'SN'\n  - p.probability > 0.7\n  - p.ranking = 1\n- Ensure selected objects have at least one dataquality row by joining probability to dataquality on oid for this candidate selection (this guarantees that the final result contains up to 50 objects with dataquality).\n- Select distinct p.oid from the joined set.\n- Optionally order the candidates by p.probability DESC to prefer the highest-probability objects before applying the limit (not required, but typically desirable).\n- Apply LIMIT 50 to the distinct oids (this enforces \u201cat most 50 ZTF objects\u201d).\n\n4) Retrieve all dataquality rows for the selected objects\n- Join dataquality dq to the 50-oid candidate set on dq.oid = candidate.oid.\n- Select dq.* to return all columns from dataquality.\n- Optional output ordering (not required, but helpful): ORDER BY dq.oid, dq.candid to group detections per object.\n\n5) Index and performance considerations (implicit in the design)\n- Use p.ranking = 1 to leverage the partial index ix_classification_rank1 on probability.\n- Join on p.oid to dq.oid (probability has ix_probabilities_oid).\n- Filtering by p.classifier_name, p.class_name, and p.probability will also benefit from the primary key index on probability (composite on oid, class_name, classifier_name, classifier_version) and the btree on probability.\n\n6) Summary of the query structure\n- Create a derived table or CTE that selects DISTINCT p.oid from probability p INNER JOIN dataquality dq ON dq.oid = p.oid with the filters:\n  - p.classifier_name = 'stamp_classifier'\n  - p.class_name = 'SN'\n  - p.probability > 0.7\n  - p.ranking = 1\n  - ORDER BY p.probability DESC (optional)\n  - LIMIT 50\n- Join dataquality dq against that 50-oid set on dq.oid to return dq.*.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Interpret the user request and map to schema entities\n- Target rows to return: all columns from the dataquality table (i.e., SELECT dq.*).\n- Selection criterion: ZTF objects (identified by probability.oid and dataquality.oid) that, in the stamp classifier, have probability > 0.7 of being a supernova.\n- Classifier and class to use:\n  - classifier_name must be 'stamp_classifier' (explicitly requested by user, overriding the default lc_classifier).\n  - class_name must be 'SN' (per the documented classes for stamp_classifier: 'SN', 'AGN', 'VS', 'asteroid', 'bogus').\n- Default probability conditions:\n  - Keep probability.ranking = 1 (default applies because the user did not override ranking).\n- Row limit:\n  - \u201cAt most 50 ZTF objects\u201d means limit to 50 distinct oids that satisfy the classification criterion. Then return all dataquality rows for those 50 objects.\n\n2) Identify required tables and columns\n- probability table (alias p):\n  - Columns needed for filtering and object selection: p.oid, p.class_name, p.classifier_name, p.probability, p.ranking.\n- dataquality table (alias dq):\n  - Columns to return: all columns (dq.*).\n  - Column for joining: dq.oid.\n- No spatial filtering (Q3C not needed). taxonomy table not needed.\n\n3) Build the filtered candidate set of objects (limit to 50 distinct oids)\n- Use probability filters:\n  - p.classifier_name = 'stamp_classifier'\n  - p.class_name = 'SN'\n  - p.probability > 0.7\n  - p.ranking = 1\n- Ensure selected objects have at least one dataquality row by joining probability to dataquality on oid for this candidate selection (this guarantees that the final result contains up to 50 objects with dataquality).\n- Select distinct p.oid from the joined set.\n- Optionally order the candidates by p.probability DESC to prefer the highest-probability objects before applying the limit (not required, but typically desirable).\n- Apply LIMIT 50 to the distinct oids (this enforces \u201cat most 50 ZTF objects\u201d).\n\n4) Retrieve all dataquality rows for the selected objects\n- Join dataquality dq to the 50-oid candidate set on dq.oid = candidate.oid.\n- Select dq.* to return all columns from dataquality.\n- Optional output ordering (not required, but helpful): ORDER BY dq.oid, dq.candid to group detections per object.\n\n5) Index and performance considerations (implicit in the design)\n- Use p.ranking = 1 to leverage the partial index ix_classification_rank1 on probability.\n- Join on p.oid to dq.oid (probability has ix_probabilities_oid).\n- Filtering by p.classifier_name, p.class_name, and p.probability will also benefit from the primary key index on probability (composite on oid, class_name, classifier_name, classifier_version) and the btree on probability.\n\n6) Summary of the query structure\n- Create a derived table or CTE that selects DISTINCT p.oid from probability p INNER JOIN dataquality dq ON dq.oid = p.oid with the filters:\n  - p.classifier_name = 'stamp_classifier'\n  - p.class_name = 'SN'\n  - p.probability > 0.7\n  - p.ranking = 1\n  - ORDER BY p.probability DESC (optional)\n  - LIMIT 50\n- Join dataquality dq against that 50-oid set on dq.oid to return dq.*."
                },
                "in_toks": 3069,
                "out_toks": 3406,
                "id": "chatcmpl-CZZfxX8rzlzPW3izuF1FfpHOqhXWA",
                "created": 1762594653,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all dataquality rows for up to 50 ZTF objects that have SN probability > 0.7 in the stamp classifier (ranking = 1)\nWITH ranked_oids AS (\n  SELECT DISTINCT ON (p.oid) p.oid, p.probability\n  FROM probability p\n  WHERE p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.probability > 0.7\n    AND p.ranking = 1\n  ORDER BY p.oid, p.probability DESC\n),\ntop_oids AS (\n  SELECT oid\n  FROM ranked_oids\n  ORDER BY probability DESC\n  LIMIT 50\n)\nSELECT dq.*\nFROM dataquality dq\nINNER JOIN top_oids t ON t.oid = dq.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all dataquality rows for up to 50 ZTF objects that have SN probability > 0.7 in the stamp classifier (ranking = 1)\nWITH ranked_oids AS (\n  SELECT DISTINCT ON (p.oid) p.oid, p.probability\n  FROM probability p\n  WHERE p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'SN'\n    AND p.probability > 0.7\n    AND p.ranking = 1\n  ORDER BY p.oid, p.probability DESC\n),\ntop_oids AS (\n  SELECT oid\n  FROM ranked_oids\n  ORDER BY probability DESC\n  LIMIT 50\n)\nSELECT dq.*\nFROM dataquality dq\nINNER JOIN top_oids t ON t.oid = dq.oid;\n```"
                },
                "in_toks": 2803,
                "out_toks": 2868,
                "id": "chatcmpl-CZaxQM1jU0IFXkVzEL0mjiCYG2ssP",
                "created": 1762599580,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "8": {
            "req_id": "89",
            "experiment_id": "run_8",
            "pred_tables": [
                "probability",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'dataquality']"
                },
                "in_toks": 624,
                "out_toks": 977,
                "id": "chatcmpl-CZMUyj53oRPe38OsjPwwTu9xAO42O",
                "created": 1762544000,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return all columns from dataquality for at most 50 ZTF objects\n-- classified as supernovae (SN) by the stamp classifier with probability > 0.7.\n-- Optimization notes:\n--  - Use DISTINCT to pick unique object ids (oids) and LIMIT 50 early to reduce join size.\n--  - Include ranking=1 per guidelines to use the top-ranked class per object.\n--  - Avoid ORDER BY to prevent large sorts that can cause timeouts.\n WITH candidate_oids AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1\n     AND p.probability > 0.7\n     AND p.oid LIKE 'ZTF%'\n   LIMIT 50)\nSELECT dq.*\nFROM dataquality dq\nJOIN candidate_oids c ON dq.oid = c.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Return all columns from dataquality for at most 50 ZTF objects\n-- classified as supernovae (SN) by the stamp classifier with probability > 0.7.\n-- Optimization notes:\n--  - Use DISTINCT to pick unique object ids (oids) and LIMIT 50 early to reduce join size.\n--  - Include ranking=1 per guidelines to use the top-ranked class per object.\n--  - Avoid ORDER BY to prevent large sorts that can cause timeouts.\n WITH candidate_oids AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.class_name = 'SN'\n     AND p.ranking = 1\n     AND p.probability > 0.7\n     AND p.oid LIKE 'ZTF%'\n   LIMIT 50)\nSELECT dq.*\nFROM dataquality dq\nJOIN candidate_oids c ON dq.oid = c.oid;"
                },
                "in_toks": 1985,
                "out_toks": 2894,
                "id": "chatcmpl-CbHAfxuOAoKrkfter9PTqhthxIo4y",
                "created": 1763000177,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1416,
                "out_toks": 1359,
                "id": "chatcmpl-CZYMDnAJgKLEWkiAxcDRBk5XSqyM2",
                "created": 1762589585,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the goal and outputs\n- Goal: Retrieve at most 50 unique ZTF objects whose stamp-based classification indicates they are supernovae with probability > 0.7, and return all dataquality rows (all columns) associated with those objects.\n- Output: All columns from the dataquality table for the selected objects (i.e., dataquality.*).\n- Scope: No spatial constraints; no need to use Q3C functions.\n\n2) Choose the driving table and enforce default probability-table conditions\n- Driving table: probability (contains classifier results and probabilities).\n- Apply the default probability conditions unless explicitly overridden:\n  - Use ranking = 1 (keep only the top-ranked class per row).\n  - Override the default classifier_name for this request to classifier_name = 'stamp_classifier' (because the user explicitly asks for the stamp classifier).\n- Additional request-specific filters on probability:\n  - class_name = 'SN' (supernovae class in stamp_classifier).\n  - probability > 0.7.\n- Restrict to ZTF objects:\n  - Filter oid to ZTF objects using oid LIKE 'ZTF%'.\n\n3) Deduplicate by object and rank by probability before limiting\n- Rationale: The probability table can contain multiple rows per oid due to different classifier_version values. We must ensure we return at most 50 distinct objects (not rows).\n- Create a subquery that:\n  - Starts from probability filtered by:\n    - classifier_name = 'stamp_classifier'\n    - class_name = 'SN'\n    - ranking = 1\n    - probability > 0.7\n    - oid LIKE 'ZTF%'\n  - Aggregates by oid to deduplicate and capture the best available probability per object across versions:\n    - For each oid, compute sn_prob = MAX(probability) from the filtered rows.\n  - Orders objects by sn_prob DESC so that, if more than 50 objects satisfy the threshold, the highest-probability objects are preferred.\n  - Limits to 50 distinct oids.\n- Name this subquery something like top_sn (columns: oid, sn_prob).\n\n4) Join to dataquality to get all requested columns\n- Perform an INNER JOIN from dataquality (alias dq) to the deduplicated list of 50 objects (top_sn) on dq.oid = top_sn.oid.\n- This ensures:\n  - Only dataquality rows for the selected objects are returned.\n  - All columns from dataquality are included in the final result.\n\n5) Select and optionally order the final output\n- Select: dq.* (all columns from the dataquality table), because the user explicitly asked for \u201call columns from the dataquality table.\u201d\n- Optional ordering (for readability, not required):\n  - ORDER BY top_sn.sn_prob DESC, dq.oid, dq.candid (or another stable dq column such as fid) so that rows are grouped by object and roughly by most probable objects first.\n\n6) Confirm correctness of classifier and class names\n- classifier_name must be exactly 'stamp_classifier'.\n- class_name must be exactly 'SN'.\n- Apply single quotes for string literals in conditions.\n\n7) Index and performance considerations\n- Filtering by ranking = 1 will use the partial index ix_classification_rank1 on probability.\n- Filtering by probability > 0.7 can leverage ix_probabilities_probability.\n- Joining on oid and filtering by oid uses ix_probabilities_oid (hash) and the join to dataquality on dq.oid can use dataquality\u2019s primary/foreign key relationships (dq.oid is part of the foreign key via detection; dq.oid is a regular column, but the join on dq.oid to top_sn.oid is straightforward).\n- Applying the LIMIT 50 to the set of distinct oids (in the subquery) ensures the join does not explode rows unnecessarily.\n\n8) Edge cases and notes\n- By keeping ranking = 1, we only include objects where the stamp classifier\u2019s top class is 'SN'. If the intent were to include objects with SN probability > 0.7 even if SN is not rank 1, the ranking = 1 filter would need to be removed; however, per the default rules, we keep ranking = 1 since the user did not explicitly override ranking behavior.\n- Multiple dataquality rows per object (different candids, filters fid, etc.) will be returned; this matches the \u201creturn all columns from dataquality for such objects\u201d requirement.\n- The LIMIT is applied at the object selection (top_sn) stage to guarantee \u201cat most 50 ZTF objects,\u201d not merely 50 dataquality rows.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the goal and outputs\n- Goal: Retrieve at most 50 unique ZTF objects whose stamp-based classification indicates they are supernovae with probability > 0.7, and return all dataquality rows (all columns) associated with those objects.\n- Output: All columns from the dataquality table for the selected objects (i.e., dataquality.*).\n- Scope: No spatial constraints; no need to use Q3C functions.\n\n2) Choose the driving table and enforce default probability-table conditions\n- Driving table: probability (contains classifier results and probabilities).\n- Apply the default probability conditions unless explicitly overridden:\n  - Use ranking = 1 (keep only the top-ranked class per row).\n  - Override the default classifier_name for this request to classifier_name = 'stamp_classifier' (because the user explicitly asks for the stamp classifier).\n- Additional request-specific filters on probability:\n  - class_name = 'SN' (supernovae class in stamp_classifier).\n  - probability > 0.7.\n- Restrict to ZTF objects:\n  - Filter oid to ZTF objects using oid LIKE 'ZTF%'.\n\n3) Deduplicate by object and rank by probability before limiting\n- Rationale: The probability table can contain multiple rows per oid due to different classifier_version values. We must ensure we return at most 50 distinct objects (not rows).\n- Create a subquery that:\n  - Starts from probability filtered by:\n    - classifier_name = 'stamp_classifier'\n    - class_name = 'SN'\n    - ranking = 1\n    - probability > 0.7\n    - oid LIKE 'ZTF%'\n  - Aggregates by oid to deduplicate and capture the best available probability per object across versions:\n    - For each oid, compute sn_prob = MAX(probability) from the filtered rows.\n  - Orders objects by sn_prob DESC so that, if more than 50 objects satisfy the threshold, the highest-probability objects are preferred.\n  - Limits to 50 distinct oids.\n- Name this subquery something like top_sn (columns: oid, sn_prob).\n\n4) Join to dataquality to get all requested columns\n- Perform an INNER JOIN from dataquality (alias dq) to the deduplicated list of 50 objects (top_sn) on dq.oid = top_sn.oid.\n- This ensures:\n  - Only dataquality rows for the selected objects are returned.\n  - All columns from dataquality are included in the final result.\n\n5) Select and optionally order the final output\n- Select: dq.* (all columns from the dataquality table), because the user explicitly asked for \u201call columns from the dataquality table.\u201d\n- Optional ordering (for readability, not required):\n  - ORDER BY top_sn.sn_prob DESC, dq.oid, dq.candid (or another stable dq column such as fid) so that rows are grouped by object and roughly by most probable objects first.\n\n6) Confirm correctness of classifier and class names\n- classifier_name must be exactly 'stamp_classifier'.\n- class_name must be exactly 'SN'.\n- Apply single quotes for string literals in conditions.\n\n7) Index and performance considerations\n- Filtering by ranking = 1 will use the partial index ix_classification_rank1 on probability.\n- Filtering by probability > 0.7 can leverage ix_probabilities_probability.\n- Joining on oid and filtering by oid uses ix_probabilities_oid (hash) and the join to dataquality on dq.oid can use dataquality\u2019s primary/foreign key relationships (dq.oid is part of the foreign key via detection; dq.oid is a regular column, but the join on dq.oid to top_sn.oid is straightforward).\n- Applying the LIMIT 50 to the set of distinct oids (in the subquery) ensures the join does not explode rows unnecessarily.\n\n8) Edge cases and notes\n- By keeping ranking = 1, we only include objects where the stamp classifier\u2019s top class is 'SN'. If the intent were to include objects with SN probability > 0.7 even if SN is not rank 1, the ranking = 1 filter would need to be removed; however, per the default rules, we keep ranking = 1 since the user did not explicitly override ranking behavior.\n- Multiple dataquality rows per object (different candids, filters fid, etc.) will be returned; this matches the \u201creturn all columns from dataquality for such objects\u201d requirement.\n- The LIMIT is applied at the object selection (top_sn) stage to guarantee \u201cat most 50 ZTF objects,\u201d not merely 50 dataquality rows."
                },
                "in_toks": 3024,
                "out_toks": 3712,
                "id": "chatcmpl-CZZj1zr9Uxs3QzYhkuvkehzWzX7QC",
                "created": 1762594843,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all columns from the dataquality table for at most 50 ZTF objects\n-- whose top-ranked ('ranking' = 1) stamp_classifier class is 'SN' with probability > 0.7\nWITH top_sn AS (\n  SELECT\n    p.oid,\n    MAX(p.probability) AS sn_prob\n  FROM probability p\n  WHERE\n    p.classifier_name = 'stamp_classifier'  -- explicitly use the stamp classifier\n    AND p.class_name = 'SN'                 -- supernovae class\n    AND p.ranking = 1                       -- default condition: only top-ranked class per object\n    AND p.probability > 0.7\n    AND p.oid LIKE 'ZTF%'                   -- restrict to ZTF objects\n  GROUP BY p.oid\n  ORDER BY sn_prob DESC\n  LIMIT 50                                   -- at most 50 distinct objects\n)\nSELECT\n  dq.*                                        -- all columns from dataquality\nFROM dataquality dq\nINNER JOIN top_sn t\n  ON dq.oid = t.oid\nORDER BY\n  t.sn_prob DESC,\n  dq.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the dataquality table for at most 50 ZTF objects\n-- whose top-ranked ('ranking' = 1) stamp_classifier class is 'SN' with probability > 0.7\nWITH top_sn AS (\n  SELECT\n    p.oid,\n    MAX(p.probability) AS sn_prob\n  FROM probability p\n  WHERE\n    p.classifier_name = 'stamp_classifier'  -- explicitly use the stamp classifier\n    AND p.class_name = 'SN'                 -- supernovae class\n    AND p.ranking = 1                       -- default condition: only top-ranked class per object\n    AND p.probability > 0.7\n    AND p.oid LIKE 'ZTF%'                   -- restrict to ZTF objects\n  GROUP BY p.oid\n  ORDER BY sn_prob DESC\n  LIMIT 50                                   -- at most 50 distinct objects\n)\nSELECT\n  dq.*                                        -- all columns from dataquality\nFROM dataquality dq\nINNER JOIN top_sn t\n  ON dq.oid = t.oid\nORDER BY\n  t.sn_prob DESC,\n  dq.oid;\n```"
                },
                "in_toks": 2981,
                "out_toks": 1785,
                "id": "chatcmpl-CZb4ajmZolIJR9y0qAk4mMAGCHPDH",
                "created": 1762600024,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "9": {
            "req_id": "89",
            "experiment_id": "run_9",
            "pred_tables": [
                "probability",
                "taxonomy",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'dataquality']"
                },
                "in_toks": 624,
                "out_toks": 724,
                "id": "chatcmpl-CZMVJk24s0psuVbES98X6cOY5ctfE",
                "created": 1762544021,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1461,
                "out_toks": 1359,
                "id": "chatcmpl-CZYMsdIW8sYjwj9MJ6Y9pT6jYXMdf",
                "created": 1762589626,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3069,
                "out_toks": 4000,
                "id": "chatcmpl-CZZiBX5FaNpLfQQZzBuy3eCcPOE2e",
                "created": 1762594791,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all columns from the 'dataquality' table for up to 50 objects\n-- with stamp classifier ('stamp_classifier') probability > 0.7 for class 'SN'\n-- Assumes 'dataquality' has an 'oid' column referencing object(oid)\nWITH top_sn AS (\n    SELECT DISTINCT p.oid\n    FROM probability p\n    WHERE p.classifier_name = 'stamp_classifier' -- user-specified classifier\n      AND p.class_name = 'SN'                    -- supernovae in stamp classifier\n      AND p.probability > 0.7\n      AND p.ranking = 1                          -- default condition for ranking\n    LIMIT 50\n)\nSELECT dq.*\nFROM dataquality dq\nINNER JOIN top_sn t ON t.oid = dq.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the 'dataquality' table for up to 50 objects\n-- with stamp classifier ('stamp_classifier') probability > 0.7 for class 'SN'\n-- Assumes 'dataquality' has an 'oid' column referencing object(oid)\nWITH top_sn AS (\n    SELECT DISTINCT p.oid\n    FROM probability p\n    WHERE p.classifier_name = 'stamp_classifier' -- user-specified classifier\n      AND p.class_name = 'SN'                    -- supernovae in stamp classifier\n      AND p.probability > 0.7\n      AND p.ranking = 1                          -- default condition for ranking\n    LIMIT 50\n)\nSELECT dq.*\nFROM dataquality dq\nINNER JOIN top_sn t ON t.oid = dq.oid;\n```"
                },
                "in_toks": 3012,
                "out_toks": 1647,
                "id": "chatcmpl-CZaxO1pbOmbrYsM4BfcVvDypf0VFV",
                "created": 1762599578,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "72": {
        "0": {
            "req_id": "72",
            "experiment_id": "run_0",
            "pred_tables": [
                "information_schema.tables"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['information_schema.tables']",
                    "1": "['reference']"
                },
                "in_toks": 613,
                "out_toks": 2714,
                "id": "chatcmpl-CSnUTHpAHQ3XNm5fM93yLij4GpQuI",
                "created": 1760979461,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 423,
                "out_toks": 463,
                "id": "chatcmpl-CSnkGFThiq2uLqtlRYWia5F9NIqsj",
                "created": 1760980440,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all columns from the 'reference' table for the specified ZTF object and reference identifier\nSELECT\n    r.*\nFROM\n    reference r\nINNER JOIN\n    object o\n    ON o.oid = r.oid\nWHERE\n    o.oid = 'ZTF20actnuls'\n    AND r.rfid = 712120223;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the 'reference' table for the specified ZTF object and reference identifier\nSELECT\n    r.*\nFROM\n    reference r\nINNER JOIN\n    object o\n    ON o.oid = r.oid\nWHERE\n    o.oid = 'ZTF20actnuls'\n    AND r.rfid = 712120223;\n```"
                },
                "in_toks": 1742,
                "out_toks": 1943,
                "id": "chatcmpl-CSqseLAdiW3jbPXm0ihc0Ishp16Ki",
                "created": 1760992492,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "72",
            "experiment_id": "run_1",
            "pred_tables": [
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['information_schema.tables']",
                    "1": "['reference']"
                },
                "in_toks": 613,
                "out_toks": 2714,
                "id": "chatcmpl-CSnUTHpAHQ3XNm5fM93yLij4GpQuI",
                "created": 1760979461,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 790,
                "out_toks": 207,
                "id": "chatcmpl-CSnkPYSzFsY1BZ70Y4N7dLCQk2vcW",
                "created": 1760980449,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all columns from the 'reference' table for the specified object and reference ID\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the 'reference' table for the specified object and reference ID\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```"
                },
                "in_toks": 2108,
                "out_toks": 313,
                "id": "chatcmpl-CSqsfng9tm31pfEVyjVpfIEP6uuSN",
                "created": 1760992493,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "72",
            "experiment_id": "run_2",
            "pred_tables": [
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['reference']"
                },
                "in_toks": 613,
                "out_toks": 1036,
                "id": "chatcmpl-CSsclxJeDvhKPIUbqdsrzgouyVbx7",
                "created": 1760999195,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 790,
                "out_toks": 143,
                "id": "chatcmpl-CSxV00DTyNfC3bNy0FOs591ZLn9hM",
                "created": 1761017934,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All columns from 'reference' for the given ZTF object and reference identifier\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All columns from 'reference' for the given ZTF object and reference identifier\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```"
                },
                "in_toks": 2108,
                "out_toks": 632,
                "id": "chatcmpl-CSxlwqRdBtrwylZmkLhq32TIrRp3T",
                "created": 1761018984,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "72",
            "experiment_id": "run_3",
            "pred_tables": [
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['reference']"
                },
                "in_toks": 613,
                "out_toks": 1036,
                "id": "chatcmpl-CSscyFHQC22jeeMSRRiLwyBdXypjl",
                "created": 1760999208,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 790,
                "out_toks": 143,
                "id": "chatcmpl-CSxV3BAeGOj8VXIMiNxKU4wl8dkPH",
                "created": 1761017937,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all columns for the specified ZTF object and reference identifier\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns for the specified ZTF object and reference identifier\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```"
                },
                "in_toks": 2108,
                "out_toks": 373,
                "id": "chatcmpl-CSxmBo8DJmqafNbZ8pinDCQd4ZOYE",
                "created": 1761018999,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "72",
            "experiment_id": "run_4",
            "pred_tables": [
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['reference']"
                },
                "in_toks": 613,
                "out_toks": 1804,
                "id": "chatcmpl-CSsdCHD1WKRXbQi3G4SQQLsrFuHrr",
                "created": 1760999222,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 790,
                "out_toks": 207,
                "id": "chatcmpl-CSxV6hM5ARrptmhbKnL4dVSzZlsIy",
                "created": 1761017940,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all columns from the 'reference' table for the specified object and reference identifier\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the 'reference' table for the specified object and reference identifier\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```"
                },
                "in_toks": 2108,
                "out_toks": 249,
                "id": "chatcmpl-CSxmLINbtAQcRAthHggu4KaUKQsoa",
                "created": 1761019009,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "72",
            "experiment_id": "run_5",
            "pred_tables": [
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['reference']"
                },
                "in_toks": 613,
                "out_toks": 908,
                "id": "chatcmpl-CZMVYv9heK0fDzyPbcMxdRxEAe7Np",
                "created": 1762544036,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 790,
                "out_toks": 143,
                "id": "chatcmpl-CZYO6KeQq6TFh3AHDuX7stsn9mV0E",
                "created": 1762589702,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all columns for the given ZTF object and reference identifier\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns for the given ZTF object and reference identifier\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```"
                },
                "in_toks": 2108,
                "out_toks": 501,
                "id": "chatcmpl-CZZkkbKYfp5AMrF2JfQcjA7d4IAx0",
                "created": 1762594950,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "72",
            "experiment_id": "run_6",
            "pred_tables": [
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['reference']"
                },
                "in_toks": 613,
                "out_toks": 1356,
                "id": "chatcmpl-CZMVvj2Wo8XdN3Blvt4STTjawfr5o",
                "created": 1762544059,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 790,
                "out_toks": 271,
                "id": "chatcmpl-CZYOBgoPNU7vUjNxPtXlWpdeT3Oeo",
                "created": 1762589707,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all columns from the 'reference' table for the given object and reference identifier (rfid)\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the 'reference' table for the given object and reference identifier (rfid)\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```"
                },
                "in_toks": 2108,
                "out_toks": 380,
                "id": "chatcmpl-CZZjbxoqjkT6d1MIbpWwhiWEW1Eml",
                "created": 1762594879,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "72",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'reference']"
                },
                "in_toks": 613,
                "out_toks": 1167,
                "id": "chatcmpl-CZMWM9UEMjiUifIdRcvdxSswtgv2X",
                "created": 1762544086,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1272,
                "out_toks": 143,
                "id": "chatcmpl-CZYOIBvLj99oI8rPLqzvTlmAegYS8",
                "created": 1762589714,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all columns from the 'reference' table for the specified object and reference ID\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the 'reference' table for the specified object and reference ID\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```"
                },
                "in_toks": 2590,
                "out_toks": 377,
                "id": "chatcmpl-CZZeBwXtlCPyzXm9ylvCdtZJt19DK",
                "created": 1762594543,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "72",
            "experiment_id": "run_8",
            "pred_tables": [
                "information_schema.tables"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['information_schema.tables']"
                },
                "in_toks": 613,
                "out_toks": 1358,
                "id": "chatcmpl-CZMWh82dG7ZnuydQ0Tej65py1fAkD",
                "created": 1762544107,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized approach: first isolate the exact rfid for the given oid from the detection table,\n-- then join to reference. This minimizes scans and avoids a correlated subquery.\nWITH det AS\n  (SELECT DISTINCT rfid\n   FROM detection\n   WHERE oid = 'ZTF20actnuls'\n     AND rfid = 712120223)\nSELECT r.*\nFROM reference r\nJOIN det USING (rfid);",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized approach: first isolate the exact rfid for the given oid from the detection table,\n-- then join to reference. This minimizes scans and avoids a correlated subquery.\nWITH det AS\n  (SELECT DISTINCT rfid\n   FROM detection\n   WHERE oid = 'ZTF20actnuls'\n     AND rfid = 712120223)\nSELECT r.*\nFROM reference r\nJOIN det USING (rfid);"
                },
                "in_toks": 753,
                "out_toks": 2016,
                "id": "chatcmpl-CbHBHuesnuko299PMCmqh49s1X7jw",
                "created": 1763000215,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 423,
                "out_toks": 847,
                "id": "chatcmpl-CZYOQGxnNYF0d1kDA543wJmHdJDqt",
                "created": 1762589722,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all columns from the 'reference' table for the given ZTF object and reference identifier\nSELECT r.*\nFROM reference r\nWHERE r.rfid = 712120223\n  AND EXISTS (\n    SELECT 1\n    FROM detection d\n    WHERE d.oid = 'ZTF20actnuls'\n      AND d.rfid = r.rfid\n  );\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the 'reference' table for the given ZTF object and reference identifier\nSELECT r.*\nFROM reference r\nWHERE r.rfid = 712120223\n  AND EXISTS (\n    SELECT 1\n    FROM detection d\n    WHERE d.oid = 'ZTF20actnuls'\n      AND d.rfid = r.rfid\n  );\n```"
                },
                "in_toks": 1742,
                "out_toks": 2970,
                "id": "chatcmpl-CZZl6jZXKj9XVPZ1riNlxslDlKhF4",
                "created": 1762594972,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "9": {
            "req_id": "72",
            "experiment_id": "run_9",
            "pred_tables": [
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['reference']"
                },
                "in_toks": 613,
                "out_toks": 588,
                "id": "chatcmpl-CZMX3L1fxhQm1NqRXd6MmuA5zbGWt",
                "created": 1762544129,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 790,
                "out_toks": 143,
                "id": "chatcmpl-CZYP2PWwbYKd8BuEwA7M9GoUswNul",
                "created": 1762589760,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all columns from the 'reference' table for the specified object and reference ID\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the 'reference' table for the specified object and reference ID\nSELECT *\nFROM reference\nWHERE oid = 'ZTF20actnuls'\n  AND rfid = 712120223;\n```"
                },
                "in_toks": 2108,
                "out_toks": 313,
                "id": "chatcmpl-CZZjwSRn43IkiYFmpJjdcvlXIQ0QI",
                "created": 1762594900,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "103": {
        "0": {
            "req_id": "103",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "probability",
                "ps1_ztf",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'ps1_ztf', 'taxonomy']",
                    "1": "['object', 'probability', 'ps1_ztf']"
                },
                "in_toks": 675,
                "out_toks": 1969,
                "id": "chatcmpl-CSnV139LSHlJeHUJ6Iclw5v48MdUC",
                "created": 1760979495,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1951,
                "out_toks": 783,
                "id": "chatcmpl-CSnkSa6hdVdH1V3yS69OT7HEsxIIC",
                "created": 1760980452,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3829,
                "out_toks": 4000,
                "id": "chatcmpl-CSqsiBYCOxEJ95uJ2CamcieiT4SCi",
                "created": 1760992496,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return up to 200 objects with nearest PS1 source farther than 5 arcsec\n-- and light-curve classifier non-supernova class with probability > 0.7.\n-- Defaults applied: ranking = 1 and classifier_name = 'lc_classifier'.\nSELECT\n    o.*,\n    p.*,\n    ps1.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nINNER JOIN ps1_ztf AS ps1\n    ON ps1.oid = o.oid\nWHERE\n    p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.probability > 0.7\n    AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    -- Assume distpsnr1 is the nearest PS1 source distance in arcseconds\n    AND ps1.distpsnr1 > 5\nORDER BY\n    ps1.distpsnr1\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return up to 200 objects with nearest PS1 source farther than 5 arcsec\n-- and light-curve classifier non-supernova class with probability > 0.7.\n-- Defaults applied: ranking = 1 and classifier_name = 'lc_classifier'.\nSELECT\n    o.*,\n    p.*,\n    ps1.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nINNER JOIN ps1_ztf AS ps1\n    ON ps1.oid = o.oid\nWHERE\n    p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.probability > 0.7\n    AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    -- Assume distpsnr1 is the nearest PS1 source distance in arcseconds\n    AND ps1.distpsnr1 > 5\nORDER BY\n    ps1.distpsnr1\nLIMIT 200;\n```"
                },
                "in_toks": 3062,
                "out_toks": 1827,
                "id": "chatcmpl-CSr7Co6Gj3Tgsp6eQN1CSoAumBIIp",
                "created": 1760993394,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "103",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "probability",
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'ps1_ztf', 'taxonomy']",
                    "1": "['object', 'probability', 'ps1_ztf']"
                },
                "in_toks": 675,
                "out_toks": 1969,
                "id": "chatcmpl-CSnV139LSHlJeHUJ6Iclw5v48MdUC",
                "created": 1760979495,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1905,
                "out_toks": 719,
                "id": "chatcmpl-CSnkfIdOZMJTrMZrmv1zdRETi3kXV",
                "created": 1760980465,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3784,
                "out_toks": 4000,
                "id": "chatcmpl-CSqsqHLwMaDZNYDzI2AMqd7luOlZS",
                "created": 1760992504,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 200 ZTF objects whose nearest PS1 source is farther than 5 arcsec\n-- and whose top-ranked lc_classifier class (non-SN) has probability > 0.7.\n-- Returns all columns from object, probability, and ps1_ztf. Ordered by PS1 distance.\nSELECT\n    o.*,\n    p.*,\n    ps.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nINNER JOIN ps1_ztf AS ps\n    ON ps.oid = o.oid\nWHERE\n    -- Default probability conditions: top-ranked class from the light curve classifier\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    -- Exclude supernova classes; require high probability (> 0.7)\n    AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND p.probability > 0.7\n    -- Distance to nearest PS1 source in arcsec (assumed column: distpsnr1)\n    AND ps.distpsnr1 > 5\nORDER BY\n    ps.distpsnr1 ASC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 200 ZTF objects whose nearest PS1 source is farther than 5 arcsec\n-- and whose top-ranked lc_classifier class (non-SN) has probability > 0.7.\n-- Returns all columns from object, probability, and ps1_ztf. Ordered by PS1 distance.\nSELECT\n    o.*,\n    p.*,\n    ps.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nINNER JOIN ps1_ztf AS ps\n    ON ps.oid = o.oid\nWHERE\n    -- Default probability conditions: top-ranked class from the light curve classifier\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    -- Exclude supernova classes; require high probability (> 0.7)\n    AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND p.probability > 0.7\n    -- Distance to nearest PS1 source in arcsec (assumed column: distpsnr1)\n    AND ps.distpsnr1 > 5\nORDER BY\n    ps.distpsnr1 ASC\nLIMIT 200;\n```"
                },
                "in_toks": 3062,
                "out_toks": 1806,
                "id": "chatcmpl-CSr757RGOiqjrDiV1keGCdywSDlpU",
                "created": 1760993387,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "103",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "probability",
                "ps1_ztf",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'ps1_ztf', 'taxonomy']"
                },
                "in_toks": 675,
                "out_toks": 1178,
                "id": "chatcmpl-CSsdokd1k3P9g7wCPQt4ggJ75tztJ",
                "created": 1760999260,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1951,
                "out_toks": 591,
                "id": "chatcmpl-CSxV91F48zG7FQYEitrrnJmAtReib",
                "created": 1761017943,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3829,
                "out_toks": 4000,
                "id": "chatcmpl-CSxmUOguHMs6DtDK6JipDyKUmbiH8",
                "created": 1761019018,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 200 ZTF objects whose nearest PS1 source distance > 5 arcsec\n-- and whose top-1 lc_classifier class is non-SN with probability > 0.7.\n-- Return all columns from object, probability, and a derived ps1_ztf table\n-- (computed from detection.distnr as the nearest PS1 distance per object).\n\nWITH ps1_ztf AS (\n    SELECT\n        d.oid,\n        MIN(d.distnr) AS nearest_ps1_dist\n    FROM detection d\n    WHERE d.distnr IS NOT NULL\n    GROUP BY d.oid\n)\nSELECT\n    o.*,\n    p.*,\n    pz.*\nFROM ps1_ztf pz\nINNER JOIN object o\n    ON o.oid = pz.oid\nINNER JOIN probability p\n    ON p.oid = o.oid\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND p.probability > 0.7\n    AND pz.nearest_ps1_dist > 5.0\nORDER BY\n    pz.nearest_ps1_dist ASC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 200 ZTF objects whose nearest PS1 source distance > 5 arcsec\n-- and whose top-1 lc_classifier class is non-SN with probability > 0.7.\n-- Return all columns from object, probability, and a derived ps1_ztf table\n-- (computed from detection.distnr as the nearest PS1 distance per object).\n\nWITH ps1_ztf AS (\n    SELECT\n        d.oid,\n        MIN(d.distnr) AS nearest_ps1_dist\n    FROM detection d\n    WHERE d.distnr IS NOT NULL\n    GROUP BY d.oid\n)\nSELECT\n    o.*,\n    p.*,\n    pz.*\nFROM ps1_ztf pz\nINNER JOIN object o\n    ON o.oid = pz.oid\nINNER JOIN probability p\n    ON p.oid = o.oid\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND p.probability > 0.7\n    AND pz.nearest_ps1_dist > 5.0\nORDER BY\n    pz.nearest_ps1_dist ASC\nLIMIT 200;\n```"
                },
                "in_toks": 3062,
                "out_toks": 3549,
                "id": "chatcmpl-CSyTn05AWK3CXy25fhKWaqU5btfl0",
                "created": 1761021703,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "103",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'ps1_ztf']"
                },
                "in_toks": 675,
                "out_toks": 1242,
                "id": "chatcmpl-CSse2DLbnwfLeZi0AtPNVAeEbP6jn",
                "created": 1760999274,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1950,
                "out_toks": 655,
                "id": "chatcmpl-CSxVHqQ6adxJLzvscEhwUbJLOTFLP",
                "created": 1761017951,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3829,
                "out_toks": 4000,
                "id": "chatcmpl-CSxn2XIVZ0BTMLVgvM8gjsVVpCGgx",
                "created": 1761019052,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 200 ZTF objects with nearest PS1 source farther than 5 arcsec\n-- and with lc_classifier non-SN class probability > 0.7 (using rank-1 classes).\nSELECT\n  o.*,\n  p.*,\n  x.*\nFROM object AS o\nINNER JOIN probability AS p\n  ON p.oid = o.oid\nINNER JOIN ps1_ztf AS x\n  ON x.oid = o.oid\nWHERE\n  p.classifier_name = 'lc_classifier'       -- light curve classifier\n  AND p.ranking = 1                          -- most likely class\n  AND p.class_name NOT IN ('SNIa','SNIbc','SNII','SLSN')  -- exclude supernova classes\n  AND p.probability > 0.7\n  -- q3c_dist returns degrees; 5 arcsec = 5/3600 degrees\n  AND q3c_dist(o.meanra, o.meandec, x.ra, x.dec) > (5.0 / 3600.0)\nORDER BY\n  q3c_dist(o.meanra, o.meandec, x.ra, x.dec) ASC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 200 ZTF objects with nearest PS1 source farther than 5 arcsec\n-- and with lc_classifier non-SN class probability > 0.7 (using rank-1 classes).\nSELECT\n  o.*,\n  p.*,\n  x.*\nFROM object AS o\nINNER JOIN probability AS p\n  ON p.oid = o.oid\nINNER JOIN ps1_ztf AS x\n  ON x.oid = o.oid\nWHERE\n  p.classifier_name = 'lc_classifier'       -- light curve classifier\n  AND p.ranking = 1                          -- most likely class\n  AND p.class_name NOT IN ('SNIa','SNIbc','SNII','SLSN')  -- exclude supernova classes\n  AND p.probability > 0.7\n  -- q3c_dist returns degrees; 5 arcsec = 5/3600 degrees\n  AND q3c_dist(o.meanra, o.meandec, x.ra, x.dec) > (5.0 / 3600.0)\nORDER BY\n  q3c_dist(o.meanra, o.meandec, x.ra, x.dec) ASC\nLIMIT 200;\n```"
                },
                "in_toks": 3062,
                "out_toks": 2379,
                "id": "chatcmpl-CSyUOHIDhg3F2DacoWKt6nuJCkVCE",
                "created": 1761021740,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "103",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "probability",
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'ps1_ztf']"
                },
                "in_toks": 675,
                "out_toks": 1111,
                "id": "chatcmpl-CSseIIDoxzBMyo2zBI4PyFjRnWIxP",
                "created": 1760999290,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1905,
                "out_toks": 463,
                "id": "chatcmpl-CSxVON3Z28Ou7iUju0Uw7DIaBH3zi",
                "created": 1761017958,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3784,
                "out_toks": 4000,
                "id": "chatcmpl-CSxnnLk5uhfisx0Tz8H8NwsQ6kT6q",
                "created": 1761019099,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 200 ZTF objects whose nearest PS1 counterpart is farther than 5 arcsec,\n-- and whose most likely lc_classifier class (ranking=1) is non-supernova with probability > 0.7.\n-- Return all columns from object, probability, and ps1_ztf, ordered by PS1 nearest distance.\nSELECT\n    o.*,\n    pr.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS pr\n    ON pr.oid = o.oid\n    AND pr.ranking = 1  -- default condition: most likely class\n    AND pr.classifier_name = 'lc_classifier'  -- default condition: light curve classifier\n    AND pr.probability > 0.7\n    AND pr.class_name NOT IN ('SNIa','SNIbc','SNII','SLSN')  -- exclude supernova classes\nINNER JOIN ps1_ztf AS p\n    ON p.oid = o.oid\nWHERE\n    -- 5 arcsec = 5/3600 degrees; use Q3C to compute the angular separation to the PS1 match\n    q3c_dist(o.meanra, o.meandec, p.ra, p.dec) > (5.0/3600.0)\nORDER BY\n    q3c_dist(o.meanra, o.meandec, p.ra, p.dec) ASC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 200 ZTF objects whose nearest PS1 counterpart is farther than 5 arcsec,\n-- and whose most likely lc_classifier class (ranking=1) is non-supernova with probability > 0.7.\n-- Return all columns from object, probability, and ps1_ztf, ordered by PS1 nearest distance.\nSELECT\n    o.*,\n    pr.*,\n    p.*\nFROM object AS o\nINNER JOIN probability AS pr\n    ON pr.oid = o.oid\n    AND pr.ranking = 1  -- default condition: most likely class\n    AND pr.classifier_name = 'lc_classifier'  -- default condition: light curve classifier\n    AND pr.probability > 0.7\n    AND pr.class_name NOT IN ('SNIa','SNIbc','SNII','SLSN')  -- exclude supernova classes\nINNER JOIN ps1_ztf AS p\n    ON p.oid = o.oid\nWHERE\n    -- 5 arcsec = 5/3600 degrees; use Q3C to compute the angular separation to the PS1 match\n    q3c_dist(o.meanra, o.meandec, p.ra, p.dec) > (5.0/3600.0)\nORDER BY\n    q3c_dist(o.meanra, o.meandec, p.ra, p.dec) ASC\nLIMIT 200;\n```"
                },
                "in_toks": 3062,
                "out_toks": 2355,
                "id": "chatcmpl-CSyK6GoJHxyZuhfF3Qe4UHA7cnIBL",
                "created": 1761021102,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "103",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "probability",
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'ps1_ztf']"
                },
                "in_toks": 675,
                "out_toks": 599,
                "id": "chatcmpl-CZMXJLDdKMpTVi0nisVTWWpFjW31a",
                "created": 1762544145,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1905,
                "out_toks": 911,
                "id": "chatcmpl-CZYP5nULVR69vZ5HyUyP34lPz0AJk",
                "created": 1762589763,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3784,
                "out_toks": 4000,
                "id": "chatcmpl-CZZecFNbs5I4YwA9TXS5Mzvo098Nt",
                "created": 1762594570,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return up to 200 objects whose nearest PS1 source is > 5 arcsec away\n-- and whose top light curve classifier class (lc_classifier, ranking=1)\n-- is NOT a supernova class with probability > 0.7.\n-- Assumes ps1_ztf has a column 'distpsnr1' in arcseconds; adjust the column\n-- name or units if your schema differs.\nSELECT\n    o.*,\n    p.*,\n    ps.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nINNER JOIN ps1_ztf AS ps\n    ON ps.oid = o.oid\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND p.probability > 0.7\n    AND ps.distpsnr1 > 5  -- arcseconds\nORDER BY\n    ps.distpsnr1 ASC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return up to 200 objects whose nearest PS1 source is > 5 arcsec away\n-- and whose top light curve classifier class (lc_classifier, ranking=1)\n-- is NOT a supernova class with probability > 0.7.\n-- Assumes ps1_ztf has a column 'distpsnr1' in arcseconds; adjust the column\n-- name or units if your schema differs.\nSELECT\n    o.*,\n    p.*,\n    ps.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nINNER JOIN ps1_ztf AS ps\n    ON ps.oid = o.oid\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND p.probability > 0.7\n    AND ps.distpsnr1 > 5  -- arcseconds\nORDER BY\n    ps.distpsnr1 ASC\nLIMIT 200;\n```"
                },
                "in_toks": 3062,
                "out_toks": 2225,
                "id": "chatcmpl-CZay9ieS3t4KKMGqjw19lg6BwixGc",
                "created": 1762599625,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "103",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "probability",
                "ps1_ztf",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'ps1_ztf', 'taxonomy']"
                },
                "in_toks": 675,
                "out_toks": 1626,
                "id": "chatcmpl-CZMXYNAMXQnQBwNGVIXidrpGKXenP",
                "created": 1762544160,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1951,
                "out_toks": 1295,
                "id": "chatcmpl-CZYPRw8kKYRBiI8OavVbveFGJ2LNC",
                "created": 1762589785,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3829,
                "out_toks": 4000,
                "id": "chatcmpl-CZZmrKxXfarsAbu9XdhZ8HWRIPgbV",
                "created": 1762595081,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 200 ZTF objects whose nearest PS1 source is farther than 5 arcsec\n-- and whose top lc_classifier class (ranking=1) is non-supernova with probability > 0.7.\n-- Return all columns from object, probability, and ps1_ztf, ordered by the nearest PS1 distance.\nSELECT\n    o.*,\n    p.*,\n    ps1.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nINNER JOIN ps1_ztf AS ps1\n    ON ps1.oid = o.oid\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND p.probability > 0.7\n    AND ps1.dist > 5  -- assumes 'dist' (in arcsec) is the nearest PS1 source separation\nORDER BY\n    ps1.dist ASC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 200 ZTF objects whose nearest PS1 source is farther than 5 arcsec\n-- and whose top lc_classifier class (ranking=1) is non-supernova with probability > 0.7.\n-- Return all columns from object, probability, and ps1_ztf, ordered by the nearest PS1 distance.\nSELECT\n    o.*,\n    p.*,\n    ps1.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nINNER JOIN ps1_ztf AS ps1\n    ON ps1.oid = o.oid\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND p.probability > 0.7\n    AND ps1.dist > 5  -- assumes 'dist' (in arcsec) is the nearest PS1 source separation\nORDER BY\n    ps1.dist ASC\nLIMIT 200;\n```"
                },
                "in_toks": 3062,
                "out_toks": 1711,
                "id": "chatcmpl-CZazz9mudOLrfBGrM2vCHKRaQ08qn",
                "created": 1762599739,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "103",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "probability",
                "ps1_ztf",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'ps1_ztf', 'taxonomy']"
                },
                "in_toks": 675,
                "out_toks": 922,
                "id": "chatcmpl-CZMYEzOvKhKJLfJGkpT9hNNoTq1lN",
                "created": 1762544202,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1951,
                "out_toks": 847,
                "id": "chatcmpl-CZYPpUWP5SG5gPfeBTTJOEYFCHqjc",
                "created": 1762589809,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3829,
                "out_toks": 4000,
                "id": "chatcmpl-CZZkNhW434o1eG70X5VBxrRje1yT3",
                "created": 1762594927,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 200 unique ZTF objects whose nearest PS1 source is > 5 arcsec away\n-- and whose most likely lc_classifier class (ranking=1) is NOT a supernova\n-- with probability > 0.7. Return all columns from object, probability, and ps1_ztf.\n-- Note: Assuming ps1_ztf has columns (oid, distpsnr1) where distpsnr1 is in arcsec.\n\nSELECT *\nFROM (\n    SELECT DISTINCT ON (o.oid) o.*, p.*, ps1.*\n    FROM object AS o\n    INNER JOIN probability AS p\n        ON p.oid = o.oid\n    INNER JOIN ps1_ztf AS ps1\n        ON ps1.oid = o.oid\n    WHERE\n        p.classifier_name = 'lc_classifier'  -- default classifier\n        AND p.ranking = 1                    -- default: only most likely class\n        AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')  -- exclude supernovae\n        AND p.probability > 0.7\n        AND ps1.distpsnr1 > 5  -- arcsec\n    ORDER BY o.oid, ps1.distpsnr1 ASC\n) AS s\nORDER BY distpsnr1 ASC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 200 unique ZTF objects whose nearest PS1 source is > 5 arcsec away\n-- and whose most likely lc_classifier class (ranking=1) is NOT a supernova\n-- with probability > 0.7. Return all columns from object, probability, and ps1_ztf.\n-- Note: Assuming ps1_ztf has columns (oid, distpsnr1) where distpsnr1 is in arcsec.\n\nSELECT *\nFROM (\n    SELECT DISTINCT ON (o.oid) o.*, p.*, ps1.*\n    FROM object AS o\n    INNER JOIN probability AS p\n        ON p.oid = o.oid\n    INNER JOIN ps1_ztf AS ps1\n        ON ps1.oid = o.oid\n    WHERE\n        p.classifier_name = 'lc_classifier'  -- default classifier\n        AND p.ranking = 1                    -- default: only most likely class\n        AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')  -- exclude supernovae\n        AND p.probability > 0.7\n        AND ps1.distpsnr1 > 5  -- arcsec\n    ORDER BY o.oid, ps1.distpsnr1 ASC\n) AS s\nORDER BY distpsnr1 ASC\nLIMIT 200;\n```"
                },
                "in_toks": 3062,
                "out_toks": 3501,
                "id": "chatcmpl-CZaySQvpsqflUbDem9yLL6TadKQGf",
                "created": 1762599644,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "103",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "probability",
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'ps1_ztf']"
                },
                "in_toks": 675,
                "out_toks": 663,
                "id": "chatcmpl-CZMYXjVAn5Oc7hBBCnOQGlAChlgE6",
                "created": 1762544221,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1905,
                "out_toks": 655,
                "id": "chatcmpl-CZYQXcdOT0GxbFycNiNhr2XNBq140",
                "created": 1762589853,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3784,
                "out_toks": 4000,
                "id": "chatcmpl-CZZfUnF75TQjQll5lLLhzb710mHDm",
                "created": 1762594624,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 200 ZTF objects with nearest PS1 source distance > 5 arcsec\n-- and lc_classifier non-supernova class probability > 0.7.\n-- Returns all columns from object, probability, and a per-object PS1 distance CTE named ps1_ztf.\nWITH ps1_ztf AS (\n    SELECT\n        d.oid,\n        MIN(d.distnr) AS distnr  -- nearest PS1/reference catalog source distance (arcsec) per object\n    FROM detection d\n    GROUP BY d.oid\n)\nSELECT\n    o.*,\n    p.*,\n    ps1_ztf.*\nFROM ps1_ztf\nINNER JOIN object o\n    ON o.oid = ps1_ztf.oid\nINNER JOIN probability p\n    ON p.oid = o.oid\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND p.probability > 0.7\n    AND ps1_ztf.distnr > 5\nORDER BY\n    ps1_ztf.distnr\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 200 ZTF objects with nearest PS1 source distance > 5 arcsec\n-- and lc_classifier non-supernova class probability > 0.7.\n-- Returns all columns from object, probability, and a per-object PS1 distance CTE named ps1_ztf.\nWITH ps1_ztf AS (\n    SELECT\n        d.oid,\n        MIN(d.distnr) AS distnr  -- nearest PS1/reference catalog source distance (arcsec) per object\n    FROM detection d\n    GROUP BY d.oid\n)\nSELECT\n    o.*,\n    p.*,\n    ps1_ztf.*\nFROM ps1_ztf\nINNER JOIN object o\n    ON o.oid = ps1_ztf.oid\nINNER JOIN probability p\n    ON p.oid = o.oid\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND p.probability > 0.7\n    AND ps1_ztf.distnr > 5\nORDER BY\n    ps1_ztf.distnr\nLIMIT 200;\n```"
                },
                "in_toks": 3062,
                "out_toks": 2387,
                "id": "chatcmpl-CZaxyect3O3fnOadIRS2Nypq03hbK",
                "created": 1762599614,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "103",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "probability",
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'ps1_ztf']"
                },
                "in_toks": 675,
                "out_toks": 855,
                "id": "chatcmpl-CZMYlhprFdfsQQ8x3yqCLGE19t1Hq",
                "created": 1762544235,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1905,
                "out_toks": 1167,
                "id": "chatcmpl-CZYQiU8aboxpAYtC8ev6b6lFs2LfX",
                "created": 1762589864,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3784,
                "out_toks": 4000,
                "id": "chatcmpl-CZZnOIuQMjCuAMf6Q07shsVTk0Xxl",
                "created": 1762595114,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Objects with nearest PS1 source farther than 5 arcsec\n-- and top-ranked lc_classifier class (non-SN) with probability > 0.7\nSELECT\n    o.*,\n    p.*,\n    ps.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nINNER JOIN ps1_ztf AS ps\n    ON ps.oid = o.oid\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND p.probability > 0.7\n    AND ps.distpsnr1 > 5  -- distance to nearest PS1 source in arcsec\nORDER BY\n    ps.distpsnr1 ASC\nLIMIT 200;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with nearest PS1 source farther than 5 arcsec\n-- and top-ranked lc_classifier class (non-SN) with probability > 0.7\nSELECT\n    o.*,\n    p.*,\n    ps.*\nFROM object AS o\nINNER JOIN probability AS p\n    ON p.oid = o.oid\nINNER JOIN ps1_ztf AS ps\n    ON ps.oid = o.oid\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND p.class_name NOT IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n    AND p.probability > 0.7\n    AND ps.distpsnr1 > 5  -- distance to nearest PS1 source in arcsec\nORDER BY\n    ps.distpsnr1 ASC\nLIMIT 200;\n```"
                },
                "in_toks": 3062,
                "out_toks": 2117,
                "id": "chatcmpl-CZay1O7980sjRSQvtZSpFze3Pfxf2",
                "created": 1762599617,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "54": {
        "0": {
            "req_id": "54",
            "experiment_id": "run_0",
            "pred_tables": [
                "non_detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['non_detection']",
                    "1": "['object', 'non_detection']"
                },
                "in_toks": 640,
                "out_toks": 861,
                "id": "chatcmpl-CSnVEQJARqe5JzaZ3nYnD4CR8zKkU",
                "created": 1760979508,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 569,
                "out_toks": 79,
                "id": "chatcmpl-CSnkp4I2QkNJqC8k9pTJpdbkvss4s",
                "created": 1760980475,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Non-detections for specified ZTF objects with 5-sigma mag limit fainter than 19.5 (i.e., larger magnitudes)\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Non-detections for specified ZTF objects with 5-sigma mag limit fainter than 19.5 (i.e., larger magnitudes)\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5;\n```"
                },
                "in_toks": 1899,
                "out_toks": 594,
                "id": "chatcmpl-CSqt134IAAOtUI7pkC7YtG2998PGA",
                "created": 1760992515,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "54",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "non_detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['non_detection']",
                    "1": "['object', 'non_detection']"
                },
                "in_toks": 640,
                "out_toks": 861,
                "id": "chatcmpl-CSnVEQJARqe5JzaZ3nYnD4CR8zKkU",
                "created": 1760979508,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1051,
                "out_toks": 143,
                "id": "chatcmpl-CSnktxZF4h9slGxc1hvsX2BPh1KUW",
                "created": 1760980479,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find non-detection epochs for the given ZTF objects with 5-sigma limits fainter (i.e., larger magnitudes) than 19.5\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5\nORDER BY oid, mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find non-detection epochs for the given ZTF objects with 5-sigma limits fainter (i.e., larger magnitudes) than 19.5\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5\nORDER BY oid, mjd;\n```"
                },
                "in_toks": 2381,
                "out_toks": 411,
                "id": "chatcmpl-CSqt8qf98v0qWyIAeTmYJNlkQ5eQx",
                "created": 1760992522,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "54",
            "experiment_id": "run_2",
            "pred_tables": [
                "non_detection",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['non_detection', 'object']"
                },
                "in_toks": 640,
                "out_toks": 400,
                "id": "chatcmpl-CSsecpgbEt6i8q6MDAha1HlXJoFHu",
                "created": 1760999310,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1051,
                "out_toks": 335,
                "id": "chatcmpl-CSxVZNw7YYtis9cJR6RslRdLCCAWi",
                "created": 1761017969,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all non-detection epochs for the given objects where the 5-sigma magnitude limit is fainter (> larger mag) than 19.5\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all non-detection epochs for the given objects where the 5-sigma magnitude limit is fainter (> larger mag) than 19.5\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5;\n```"
                },
                "in_toks": 2381,
                "out_toks": 530,
                "id": "chatcmpl-CSxh5DHio00VDD2f78VXsjrdvnlSP",
                "created": 1761018683,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "54",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "non_detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'non_detection']"
                },
                "in_toks": 640,
                "out_toks": 592,
                "id": "chatcmpl-CSseheGESAI3H0vccNamsfx5sBwFw",
                "created": 1760999315,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1051,
                "out_toks": 143,
                "id": "chatcmpl-CSxVc3nZ3NxB7YLVZsLQqZtOQ9uck",
                "created": 1761017972,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all non-detection epochs for the specified ZTF objects\n-- \"Fainter\" magnitude limit means larger numeric value, so use diffmaglim > 19.5\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5\nORDER BY oid, mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all non-detection epochs for the specified ZTF objects\n-- \"Fainter\" magnitude limit means larger numeric value, so use diffmaglim > 19.5\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5\nORDER BY oid, mjd;\n```"
                },
                "in_toks": 2381,
                "out_toks": 478,
                "id": "chatcmpl-CSxhIvGPQySG5sBOC1AsQ7Ovgegt6",
                "created": 1761018696,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "54",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "non_detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'non_detection']"
                },
                "in_toks": 640,
                "out_toks": 400,
                "id": "chatcmpl-CSseofK2H1gKcw7EFHxNV8sUm194X",
                "created": 1760999322,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1051,
                "out_toks": 271,
                "id": "chatcmpl-CSxVeGB9SMAkc5xdm6d4owUiX9Vbp",
                "created": 1761017974,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Non-detections for the specified ZTF objects with 5-sigma limits fainter (i.e., larger magnitude) than 19.5\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5\nORDER BY oid, mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Non-detections for the specified ZTF objects with 5-sigma limits fainter (i.e., larger magnitude) than 19.5\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5\nORDER BY oid, mjd;\n```"
                },
                "in_toks": 2381,
                "out_toks": 537,
                "id": "chatcmpl-CSxhSiwHikW1pBPtgC9eZCXttriSx",
                "created": 1761018706,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "54",
            "experiment_id": "run_5",
            "pred_tables": [
                "non_detection",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['non_detection', 'object']"
                },
                "in_toks": 640,
                "out_toks": 464,
                "id": "chatcmpl-CZMZ4giJtP1yYMPOUD7Mr4hbAP3NA",
                "created": 1762544254,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1051,
                "out_toks": 143,
                "id": "chatcmpl-CZYR8yNLZMZhHAVv7c1KuKY1QKydB",
                "created": 1762589890,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Retrieve all non-detection epochs for the specified objects\n-- with 5-sigma magnitude limits fainter (i.e., larger) than 19.5\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Retrieve all non-detection epochs for the specified objects\n-- with 5-sigma magnitude limits fainter (i.e., larger) than 19.5\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5;\n```"
                },
                "in_toks": 2381,
                "out_toks": 468,
                "id": "chatcmpl-CZZlLFiNLOKtnKesws8TYKmg6VzlH",
                "created": 1762594987,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "54",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "non_detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'non_detection']"
                },
                "in_toks": 640,
                "out_toks": 336,
                "id": "chatcmpl-CZMZExBLcDHUthSOWeGEgRproaVE9",
                "created": 1762544264,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1051,
                "out_toks": 271,
                "id": "chatcmpl-CZYRCTBHDRCUVamLjCAo4vDydUH79",
                "created": 1762589894,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all non-detection epochs for the specified ZTF objects\n-- with 5-sigma magnitude limits fainter than 19.5 (i.e., larger magnitudes)\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all non-detection epochs for the specified ZTF objects\n-- with 5-sigma magnitude limits fainter than 19.5 (i.e., larger magnitudes)\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5;\n```"
                },
                "in_toks": 2381,
                "out_toks": 471,
                "id": "chatcmpl-CZZjiToX5yuyPgHfINmNwJFDs09Gs",
                "created": 1762594886,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "54",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "non_detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'non_detection']"
                },
                "in_toks": 640,
                "out_toks": 400,
                "id": "chatcmpl-CZMZLC8AZ01DB51d51PWBGaL4PiH6",
                "created": 1762544271,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1051,
                "out_toks": 207,
                "id": "chatcmpl-CZYRI3t2r7gFlkOWKZiEDoAacqUxp",
                "created": 1762589900,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all non-detection epochs for the specified objects where the 5-sigma limit is fainter (i.e., larger) than 19.5 mag\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all non-detection epochs for the specified objects where the 5-sigma limit is fainter (i.e., larger) than 19.5 mag\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5;\n```"
                },
                "in_toks": 2381,
                "out_toks": 468,
                "id": "chatcmpl-CZZqFBhXZ7j0Guqzgb9K3MQhDwsBW",
                "created": 1762595291,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "54",
            "experiment_id": "run_8",
            "pred_tables": [
                "non_detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['non_detection']"
                },
                "in_toks": 640,
                "out_toks": 717,
                "id": "chatcmpl-CZMZUPp01xiPpfMWVpiSpx6h3IcEx",
                "created": 1762544280,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 569,
                "out_toks": 15,
                "id": "chatcmpl-CZYRMLpBe1Y7mGTsRyaKgs8V82nqh",
                "created": 1762589904,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Non-detections for the specified ZTF objects with 5-sigma limits fainter (i.e., larger magnitude) than 19.5\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Non-detections for the specified ZTF objects with 5-sigma limits fainter (i.e., larger magnitude) than 19.5\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5;\n```"
                },
                "in_toks": 1899,
                "out_toks": 594,
                "id": "chatcmpl-CZZlkFAuPERPGNgvZtWTcy5cjk6PM",
                "created": 1762595012,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "54",
            "experiment_id": "run_9",
            "pred_tables": [
                "non_detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['non_detection']"
                },
                "in_toks": 640,
                "out_toks": 397,
                "id": "chatcmpl-CZMZxB2SoSqn51y71QtxlKILQUUCr",
                "created": 1762544309,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 569,
                "out_toks": 143,
                "id": "chatcmpl-CZYRO0Y4DCR75M50RpJ8Xa87p1UG5",
                "created": 1762589906,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- 'Fainter' magnitudes correspond to larger numeric values, so we use 'diffmaglim > 19.5'\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- 'Fainter' magnitudes correspond to larger numeric values, so we use 'diffmaglim > 19.5'\nSELECT *\nFROM non_detection\nWHERE oid IN ('ZTF23abtcveg', 'ZTF23abudlls')\n  AND diffmaglim > 19.5;\n```"
                },
                "in_toks": 1899,
                "out_toks": 332,
                "id": "chatcmpl-CZZkH3yH3grHpp5QJ2jwN6kBWDyTP",
                "created": 1762594921,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "99": {
        "0": {
            "req_id": "99",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'forced_photometry']",
                    "1": "['object', 'probability', 'taxonomy', 'forced_photometry']"
                },
                "in_toks": 645,
                "out_toks": 1522,
                "id": "chatcmpl-CSnVQJ8DIbVN2NQooz0LrlR4vFlaz",
                "created": 1760979520,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1859,
                "out_toks": 847,
                "id": "chatcmpl-CSnkwmcSK2zS9FSrTYEYYsZ1UxF3l",
                "created": 1760980482,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3739,
                "out_toks": 4000,
                "id": "chatcmpl-CSqtBGCAKDDm4lIEyCHwYPSIvt759",
                "created": 1760992525,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find at most 10 objects with first detection after MJD 60310\n-- and stamp classifier probability 1 for class 'asteroid',\n-- then return all forced_photometry rows for those objects\nWITH selected_oids AS (\n  SELECT o.oid, o.firstmjd\n  FROM object o\n  INNER JOIN probability p\n    ON p.oid = o.oid\n  WHERE o.firstmjd > 60310\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability = 1\n    AND p.ranking = 1\n  ORDER BY o.firstmjd ASC\n  LIMIT 10\n)\nSELECT fp.*\nFROM forced_photometry fp\nINNER JOIN selected_oids s\n  ON s.oid = fp.oid\nORDER BY s.firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find at most 10 objects with first detection after MJD 60310\n-- and stamp classifier probability 1 for class 'asteroid',\n-- then return all forced_photometry rows for those objects\nWITH selected_oids AS (\n  SELECT o.oid, o.firstmjd\n  FROM object o\n  INNER JOIN probability p\n    ON p.oid = o.oid\n  WHERE o.firstmjd > 60310\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.class_name = 'asteroid'\n    AND p.probability = 1\n    AND p.ranking = 1\n  ORDER BY o.firstmjd ASC\n  LIMIT 10\n)\nSELECT fp.*\nFROM forced_photometry fp\nINNER JOIN selected_oids s\n  ON s.oid = fp.oid\nORDER BY s.firstmjd ASC;\n```"
                },
                "in_toks": 3033,
                "out_toks": 1347,
                "id": "chatcmpl-CSr6DDk0Yas1BJGhjvtCYLvNsDNzm",
                "created": 1760993333,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "99",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'forced_photometry']",
                    "1": "['object', 'probability', 'taxonomy', 'forced_photometry']"
                },
                "in_toks": 645,
                "out_toks": 1522,
                "id": "chatcmpl-CSnVQJ8DIbVN2NQooz0LrlR4vFlaz",
                "created": 1760979520,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1859,
                "out_toks": 1167,
                "id": "chatcmpl-CSnl8nbH2v1xh1wHOXv05lmNHLWkN",
                "created": 1760980494,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3739,
                "out_toks": 4000,
                "id": "chatcmpl-CSqtHQI1muEa4Es3jiFw5l2865F5Y",
                "created": 1760992531,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all forced_photometry rows for up to 10 objects whose first detection (firstmjd) > 60310\n-- and whose most likely stamp_classifier class is 'asteroid' with probability 1.\nWITH selected_oids AS (\n    SELECT o.oid, o.firstmjd\n    FROM object o\n    WHERE o.firstmjd > 60310\n      AND EXISTS (\n          SELECT 1\n          FROM probability p\n          WHERE p.oid = o.oid\n            AND p.classifier_name = 'stamp_classifier' -- user-specified classifier\n            AND p.class_name = 'asteroid'              -- user-specified class\n            AND p.probability = 1                      -- user-specified probability\n            AND p.ranking = 1                          -- default condition: keep top-ranked class\n      )\n    ORDER BY o.firstmjd\n    LIMIT 10\n)\nSELECT fp.*\nFROM forced_photometry fp\nINNER JOIN selected_oids s ON s.oid = fp.oid\nORDER BY s.firstmjd, fp.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all forced_photometry rows for up to 10 objects whose first detection (firstmjd) > 60310\n-- and whose most likely stamp_classifier class is 'asteroid' with probability 1.\nWITH selected_oids AS (\n    SELECT o.oid, o.firstmjd\n    FROM object o\n    WHERE o.firstmjd > 60310\n      AND EXISTS (\n          SELECT 1\n          FROM probability p\n          WHERE p.oid = o.oid\n            AND p.classifier_name = 'stamp_classifier' -- user-specified classifier\n            AND p.class_name = 'asteroid'              -- user-specified class\n            AND p.probability = 1                      -- user-specified probability\n            AND p.ranking = 1                          -- default condition: keep top-ranked class\n      )\n    ORDER BY o.firstmjd\n    LIMIT 10\n)\nSELECT fp.*\nFROM forced_photometry fp\nINNER JOIN selected_oids s ON s.oid = fp.oid\nORDER BY s.firstmjd, fp.oid;\n```"
                },
                "in_toks": 3033,
                "out_toks": 2667,
                "id": "chatcmpl-CSr7CtMIiRAnPzP047nNjPJ1VZAw3",
                "created": 1760993394,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "99",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "probability",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'forced_photometry']"
                },
                "in_toks": 645,
                "out_toks": 598,
                "id": "chatcmpl-CSsetEk5IgK8pUhvBAxQfYeRNq06W",
                "created": 1760999327,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1814,
                "out_toks": 1679,
                "id": "chatcmpl-CSxViCwwMIbFUtaYEkdQsbuXFhhbS",
                "created": 1761017978,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3694,
                "out_toks": 4000,
                "id": "chatcmpl-CSxhccIR5MpesJbUP6uybIEixhQ8J",
                "created": 1761018716,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Select at most 10 objects with first detection after MJD 60310\n-- and with probability 1 of being 'asteroid' in the 'stamp_classifier',\n-- then return all forced photometry rows for those objects.\nWITH top_objects AS (\n  SELECT o.oid, o.firstmjd\n  FROM object o\n  WHERE o.firstmjd > 60310\n    AND EXISTS (\n      SELECT 1\n      FROM probability p\n      WHERE p.oid = o.oid\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'asteroid'\n        AND p.probability = 1\n        AND p.ranking = 1\n    )\n  ORDER BY o.firstmjd ASC\n  LIMIT 10\n)\nSELECT fp.*\nFROM forced_photometry fp\nINNER JOIN top_objects t ON t.oid = fp.oid\nORDER BY t.firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Select at most 10 objects with first detection after MJD 60310\n-- and with probability 1 of being 'asteroid' in the 'stamp_classifier',\n-- then return all forced photometry rows for those objects.\nWITH top_objects AS (\n  SELECT o.oid, o.firstmjd\n  FROM object o\n  WHERE o.firstmjd > 60310\n    AND EXISTS (\n      SELECT 1\n      FROM probability p\n      WHERE p.oid = o.oid\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'asteroid'\n        AND p.probability = 1\n        AND p.ranking = 1\n    )\n  ORDER BY o.firstmjd ASC\n  LIMIT 10\n)\nSELECT fp.*\nFROM forced_photometry fp\nINNER JOIN top_objects t ON t.oid = fp.oid\nORDER BY t.firstmjd ASC;\n```"
                },
                "in_toks": 3033,
                "out_toks": 2701,
                "id": "chatcmpl-CSyKUjKPnQhb5rpMGrlVCGAhFifvD",
                "created": 1761021126,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "99",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "probability",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'forced_photometry']"
                },
                "in_toks": 645,
                "out_toks": 598,
                "id": "chatcmpl-CSsf3CQ97NyBC0uTwtoYZGb9B1hH8",
                "created": 1760999337,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1814,
                "out_toks": 911,
                "id": "chatcmpl-CSxW21IOrFf0HziSFvNSXQOLHBNko",
                "created": 1761017998,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3694,
                "out_toks": 4000,
                "id": "chatcmpl-CSxiK2Cb0K0JnqFjJSo5aM1J33mqT",
                "created": 1761018760,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all forced photometry rows for up to 10 objects with first detection after MJD 60310\n-- and stamp classifier probability 1 for class 'asteroid', ordered by first detection date.\nWITH selected_oids AS (\n    SELECT o.oid, o.firstmjd\n    FROM object o\n    WHERE o.firstmjd > 60310\n      AND EXISTS (\n          SELECT 1\n          FROM probability p\n          WHERE p.oid = o.oid\n            AND p.classifier_name = 'stamp_classifier'\n            AND p.class_name = 'asteroid'\n            AND p.probability = 1\n            AND p.ranking = 1\n      )\n    ORDER BY o.firstmjd ASC\n    LIMIT 10\n)\nSELECT fp.*\nFROM forced_photometry fp\nINNER JOIN selected_oids s ON s.oid = fp.oid\nORDER BY s.firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all forced photometry rows for up to 10 objects with first detection after MJD 60310\n-- and stamp classifier probability 1 for class 'asteroid', ordered by first detection date.\nWITH selected_oids AS (\n    SELECT o.oid, o.firstmjd\n    FROM object o\n    WHERE o.firstmjd > 60310\n      AND EXISTS (\n          SELECT 1\n          FROM probability p\n          WHERE p.oid = o.oid\n            AND p.classifier_name = 'stamp_classifier'\n            AND p.class_name = 'asteroid'\n            AND p.probability = 1\n            AND p.ranking = 1\n      )\n    ORDER BY o.firstmjd ASC\n    LIMIT 10\n)\nSELECT fp.*\nFROM forced_photometry fp\nINNER JOIN selected_oids s ON s.oid = fp.oid\nORDER BY s.firstmjd ASC;\n```"
                },
                "in_toks": 3033,
                "out_toks": 2186,
                "id": "chatcmpl-CSyL9hLVhxnsoH6UQbh06YGVtH2s3",
                "created": 1761021167,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "99",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "probability",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'forced_photometry']"
                },
                "in_toks": 645,
                "out_toks": 470,
                "id": "chatcmpl-CSsfBu79keGbkGD0LR5Ayc2PsMS7p",
                "created": 1760999345,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1814,
                "out_toks": 783,
                "id": "chatcmpl-CSxWCcb3Cj7Y4exmZq3522FTNRA0D",
                "created": 1761018008,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3694,
                "out_toks": 4000,
                "id": "chatcmpl-CSxj3juVLTBaBHQSfBS0D9XSuZoH8",
                "created": 1761018805,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Select up to 10 objects with first detection later than MJD 60310\n-- and with probability 1 of being 'asteroid' according to the stamp classifier.\n-- Then return all forced photometry rows for those objects, ordered by first detection date.\nWITH selected_oids AS (\n    SELECT\n        o.oid,\n        o.firstmjd\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE\n        o.firstmjd > 60310\n        AND p.classifier_name = 'stamp_classifier'  -- use the stamp-based classifier\n        AND p.class_name = 'asteroid'\n        AND p.probability = 1\n        AND p.ranking = 1  -- keep only the top-ranked class\n    ORDER BY o.firstmjd ASC\n    LIMIT 10\n)\nSELECT\n    fp.*\nFROM forced_photometry fp\nINNER JOIN selected_oids so\n    ON so.oid = fp.oid\nORDER BY so.firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Select up to 10 objects with first detection later than MJD 60310\n-- and with probability 1 of being 'asteroid' according to the stamp classifier.\n-- Then return all forced photometry rows for those objects, ordered by first detection date.\nWITH selected_oids AS (\n    SELECT\n        o.oid,\n        o.firstmjd\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE\n        o.firstmjd > 60310\n        AND p.classifier_name = 'stamp_classifier'  -- use the stamp-based classifier\n        AND p.class_name = 'asteroid'\n        AND p.probability = 1\n        AND p.ranking = 1  -- keep only the top-ranked class\n    ORDER BY o.firstmjd ASC\n    LIMIT 10\n)\nSELECT\n    fp.*\nFROM forced_photometry fp\nINNER JOIN selected_oids so\n    ON so.oid = fp.oid\nORDER BY so.firstmjd ASC;\n```"
                },
                "in_toks": 3033,
                "out_toks": 2533,
                "id": "chatcmpl-CSyLWTkttlO3cHxb7SukvuzYNPZh0",
                "created": 1761021190,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "99",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "probability",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'forced_photometry']"
                },
                "in_toks": 645,
                "out_toks": 470,
                "id": "chatcmpl-CZMaHd7vmUQ37ISTYwWUHavbCUnVA",
                "created": 1762544329,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1814,
                "out_toks": 847,
                "id": "chatcmpl-CZYRRFHXETF5PJ5wihsmmHSI9kanA",
                "created": 1762589909,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3694,
                "out_toks": 4000,
                "id": "chatcmpl-CZZqZSjEi9WcSOaMfTSEqWs2vu6DX",
                "created": 1762595311,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Select at most 10 objects with first detection after MJD 60310\n-- and with probability 1 of being 'asteroid' in the stamp classifier,\n-- then return all forced photometry rows for those objects.\nWITH selected_oids AS (\n    SELECT o.oid, o.firstmjd\n    FROM object o\n    INNER JOIN probability p ON p.oid = o.oid\n    WHERE o.firstmjd > 60310\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.class_name = 'asteroid'\n      AND p.probability = 1\n      AND p.ranking = 1\n    ORDER BY o.firstmjd\n    LIMIT 10\n)\nSELECT fp.*\nFROM forced_photometry fp\nINNER JOIN selected_oids s ON fp.oid = s.oid\nORDER BY s.firstmjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Select at most 10 objects with first detection after MJD 60310\n-- and with probability 1 of being 'asteroid' in the stamp classifier,\n-- then return all forced photometry rows for those objects.\nWITH selected_oids AS (\n    SELECT o.oid, o.firstmjd\n    FROM object o\n    INNER JOIN probability p ON p.oid = o.oid\n    WHERE o.firstmjd > 60310\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.class_name = 'asteroid'\n      AND p.probability = 1\n      AND p.ranking = 1\n    ORDER BY o.firstmjd\n    LIMIT 10\n)\nSELECT fp.*\nFROM forced_photometry fp\nINNER JOIN selected_oids s ON fp.oid = s.oid\nORDER BY s.firstmjd;\n```"
                },
                "in_toks": 3033,
                "out_toks": 1792,
                "id": "chatcmpl-CZb1EMZeM6KEkp7IgyX4dZyP1KiQJ",
                "created": 1762599816,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "99",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "probability",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'forced_photometry']"
                },
                "in_toks": 645,
                "out_toks": 790,
                "id": "chatcmpl-CZMakkdMh7Edrz42rNa1fFvDBp7aI",
                "created": 1762544358,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1814,
                "out_toks": 655,
                "id": "chatcmpl-CZYRdi45j53UrxexT0hmyKoRTpQtJ",
                "created": 1762589921,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3694,
                "out_toks": 4000,
                "id": "chatcmpl-CZZmOSAlcinHmLKGwb1q4tLZqCq9N",
                "created": 1762595052,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all forced_photometry rows for up to 10 ZTF objects\n-- with first detection later than MJD 60310 and classified as 'asteroid'\n-- by the stamp_classifier with probability 1 (and ranking=1).\nWITH top_oids AS (\n  SELECT o.oid, o.firstmjd\n  FROM object o\n  WHERE o.firstmjd > 60310\n    AND EXISTS (\n      SELECT 1\n      FROM probability p\n      WHERE p.oid = o.oid\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'asteroid'\n        AND p.probability = 1\n        AND p.ranking = 1\n    )\n  ORDER BY o.firstmjd\n  LIMIT 10\n)\nSELECT f.*\nFROM forced_photometry f\nINNER JOIN top_oids t ON t.oid = f.oid\nORDER BY t.firstmjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all forced_photometry rows for up to 10 ZTF objects\n-- with first detection later than MJD 60310 and classified as 'asteroid'\n-- by the stamp_classifier with probability 1 (and ranking=1).\nWITH top_oids AS (\n  SELECT o.oid, o.firstmjd\n  FROM object o\n  WHERE o.firstmjd > 60310\n    AND EXISTS (\n      SELECT 1\n      FROM probability p\n      WHERE p.oid = o.oid\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'asteroid'\n        AND p.probability = 1\n        AND p.ranking = 1\n    )\n  ORDER BY o.firstmjd\n  LIMIT 10\n)\nSELECT f.*\nFROM forced_photometry f\nINNER JOIN top_oids t ON t.oid = f.oid\nORDER BY t.firstmjd;\n```"
                },
                "in_toks": 3033,
                "out_toks": 2512,
                "id": "chatcmpl-CZayl83tBznBFqNV54OTrrM2iSD1S",
                "created": 1762599663,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "99",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'forced_photometry']"
                },
                "in_toks": 645,
                "out_toks": 601,
                "id": "chatcmpl-CZMbD0nqUzHvmSGmWh6djCkQIXbBM",
                "created": 1762544387,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1859,
                "out_toks": 911,
                "id": "chatcmpl-CZYRlPtHPXEI0gkjMNLudpdGUUqwP",
                "created": 1762589929,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3739,
                "out_toks": 4000,
                "id": "chatcmpl-CZZkZsxaASgEZ3dLjytwTis8RFud9",
                "created": 1762594939,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Select all forced photometry rows for at most 10 objects whose first detection (firstmjd) is > 60310\n-- and whose most likely stamp_classifier class is 'asteroid' with probability 1.\nWITH selected AS (\n    SELECT o.oid, o.firstmjd\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE o.firstmjd > 60310\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.class_name = 'asteroid'\n      AND p.probability = 1\n      AND p.ranking = 1\n    ORDER BY o.firstmjd ASC\n    LIMIT 10\n)\nSELECT fp.*\nFROM forced_photometry fp\nINNER JOIN selected s USING (oid)\nORDER BY s.firstmjd ASC, fp.oid ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Select all forced photometry rows for at most 10 objects whose first detection (firstmjd) is > 60310\n-- and whose most likely stamp_classifier class is 'asteroid' with probability 1.\nWITH selected AS (\n    SELECT o.oid, o.firstmjd\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE o.firstmjd > 60310\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.class_name = 'asteroid'\n      AND p.probability = 1\n      AND p.ranking = 1\n    ORDER BY o.firstmjd ASC\n    LIMIT 10\n)\nSELECT fp.*\nFROM forced_photometry fp\nINNER JOIN selected s USING (oid)\nORDER BY s.firstmjd ASC, fp.oid ASC;\n```"
                },
                "in_toks": 3033,
                "out_toks": 1919,
                "id": "chatcmpl-CZayeOlJZx2Xm4YBMADOGrKDpB4Ib",
                "created": 1762599656,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "99",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'forced_photometry']"
                },
                "in_toks": 645,
                "out_toks": 921,
                "id": "chatcmpl-CZMbipY84Y4ZfqtE8pG7NYnuoHkJa",
                "created": 1762544418,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1859,
                "out_toks": 783,
                "id": "chatcmpl-CZYRyY5oswFUkkSxtoRAHa0jT7gOx",
                "created": 1762589942,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3739,
                "out_toks": 4000,
                "id": "chatcmpl-CZZqpsSLo15ruWh6HPjw05WPRq8ap",
                "created": 1762595327,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all forced_photometry rows for up to 10 objects with firstmjd > 60310\n-- and stamp_classifier probability 1 for class 'asteroid', ordered by firstmjd\nWITH selected AS (\n    SELECT\n        o.oid,\n        o.firstmjd\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE\n        o.firstmjd > 60310\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'asteroid'\n        AND p.probability = 1\n        AND p.ranking = 1  -- keep only the top-ranked stamp classification\n    ORDER BY o.firstmjd ASC\n    LIMIT 10\n)\nSELECT\n    fp.*\nFROM forced_photometry fp\nINNER JOIN selected s\n    ON s.oid = fp.oid\nORDER BY s.firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all forced_photometry rows for up to 10 objects with firstmjd > 60310\n-- and stamp_classifier probability 1 for class 'asteroid', ordered by firstmjd\nWITH selected AS (\n    SELECT\n        o.oid,\n        o.firstmjd\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE\n        o.firstmjd > 60310\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'asteroid'\n        AND p.probability = 1\n        AND p.ranking = 1  -- keep only the top-ranked stamp classification\n    ORDER BY o.firstmjd ASC\n    LIMIT 10\n)\nSELECT\n    fp.*\nFROM forced_photometry fp\nINNER JOIN selected s\n    ON s.oid = fp.oid\nORDER BY s.firstmjd ASC;\n```"
                },
                "in_toks": 3033,
                "out_toks": 2062,
                "id": "chatcmpl-CZb0Eryxw2HTPjXMVu7KfhDAAwvO8",
                "created": 1762599754,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "99",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "probability",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'forced_photometry']"
                },
                "in_toks": 645,
                "out_toks": 598,
                "id": "chatcmpl-CZMc9SuG12dBq7eQVENh0REZHnnbr",
                "created": 1762544445,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1814,
                "out_toks": 911,
                "id": "chatcmpl-CZYS9y88YHTerT0u2MAHIORRe60tQ",
                "created": 1762589953,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3694,
                "out_toks": 4000,
                "id": "chatcmpl-CZZeBokPLDUOuj50XRz1tZKW95cwd",
                "created": 1762594543,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Select up to 10 ZTF objects with first detection date later than MJD=60310\n-- and a stamp classifier probability of 1 for class 'asteroid'.\n-- Then return all columns from the forced_photometry table for those objects,\n-- ordering rows by the object's first detection date.\n-- Note: This assumes a table 'forced_photometry' exists and has a column 'oid'.\nWITH top_objects AS (\n    SELECT\n        o.oid,\n        o.firstmjd\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE\n        o.firstmjd > 60310\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'asteroid'\n        AND p.probability = 1\n        AND p.ranking = 1\n    ORDER BY o.firstmjd\n    LIMIT 10\n)\nSELECT\n    fp.*\nFROM forced_photometry fp\nINNER JOIN top_objects t\n    ON t.oid = fp.oid\nORDER BY t.firstmjd, fp.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Select up to 10 ZTF objects with first detection date later than MJD=60310\n-- and a stamp classifier probability of 1 for class 'asteroid'.\n-- Then return all columns from the forced_photometry table for those objects,\n-- ordering rows by the object's first detection date.\n-- Note: This assumes a table 'forced_photometry' exists and has a column 'oid'.\nWITH top_objects AS (\n    SELECT\n        o.oid,\n        o.firstmjd\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE\n        o.firstmjd > 60310\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.class_name = 'asteroid'\n        AND p.probability = 1\n        AND p.ranking = 1\n    ORDER BY o.firstmjd\n    LIMIT 10\n)\nSELECT\n    fp.*\nFROM forced_photometry fp\nINNER JOIN top_objects t\n    ON t.oid = fp.oid\nORDER BY t.firstmjd, fp.oid;\n```"
                },
                "in_toks": 3033,
                "out_toks": 2226,
                "id": "chatcmpl-CZaziouKaxJSX5MSrUniPY4XXuqbB",
                "created": 1762599722,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "40": {
        "0": {
            "req_id": "40",
            "experiment_id": "run_0",
            "pred_tables": [
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise']",
                    "1": "['allwise']"
                },
                "in_toks": 656,
                "out_toks": 1050,
                "id": "chatcmpl-CSnViDcjNfMpxXKCa0CZ8bCA9KVCP",
                "created": 1760979538,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1166,
                "out_toks": 143,
                "id": "chatcmpl-CSnlOvIWkAh4JVED9g3p20NFhdguK",
                "created": 1760980510,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ALLWISE sources within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0)\nORDER BY q3c_dist(ra, dec, 23.6488, 30.7314) ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE sources within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0)\nORDER BY q3c_dist(ra, dec, 23.6488, 30.7314) ASC;\n```"
                },
                "in_toks": 2484,
                "out_toks": 795,
                "id": "chatcmpl-CSqs1FZJgkuEorrhXDF0BmVgRQNcd",
                "created": 1760992453,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "40",
            "experiment_id": "run_1",
            "pred_tables": [
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise']",
                    "1": "['allwise']"
                },
                "in_toks": 656,
                "out_toks": 1050,
                "id": "chatcmpl-CSnViDcjNfMpxXKCa0CZ8bCA9KVCP",
                "created": 1760979538,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1166,
                "out_toks": 207,
                "id": "chatcmpl-CSnlSUusPt4DkM6njlwaqE3LGIFME",
                "created": 1760980514,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ALLWISE sources within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\n-- 1 arcsec = 1/3600 degrees\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE sources within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\n-- 1 arcsec = 1/3600 degrees\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0);\n```"
                },
                "in_toks": 2484,
                "out_toks": 1167,
                "id": "chatcmpl-CSqs3qUXP7pw79rjmaTH8ha7OXf1p",
                "created": 1760992455,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "40",
            "experiment_id": "run_2",
            "pred_tables": [
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise']"
                },
                "in_toks": 656,
                "out_toks": 205,
                "id": "chatcmpl-CSsfId4LJCN0eaIhQ2Fa5VbsgLEsn",
                "created": 1760999352,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1166,
                "out_toks": 271,
                "id": "chatcmpl-CSxWMaC9JcYuu97rWmAYMTEf0NdHb",
                "created": 1761018018,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ALLWISE objects within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\n-- 1 arcsec = 1/3600 degrees\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE objects within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\n-- 1 arcsec = 1/3600 degrees\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0);\n```"
                },
                "in_toks": 2484,
                "out_toks": 1103,
                "id": "chatcmpl-CSxjccP2ldrIshZn43dvJduV53hJF",
                "created": 1761018840,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "40",
            "experiment_id": "run_3",
            "pred_tables": [
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise']"
                },
                "in_toks": 656,
                "out_toks": 333,
                "id": "chatcmpl-CSsfNzLH587X8YGXeHfrmrNkMAoNE",
                "created": 1760999357,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1166,
                "out_toks": 335,
                "id": "chatcmpl-CSxWPNLAYlMz5rdxqpTbXT5c4kVdh",
                "created": 1761018021,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ALLWISE sources within 1 arcsecond of RA=23.6488 deg, Dec=30.7314 deg\n-- Requested columns: identifier, coordinates, WISE W1/W2 mags (+ uncertainties), 2MASS J mag (+ uncertainty)\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE sources within 1 arcsecond of RA=23.6488 deg, Dec=30.7314 deg\n-- Requested columns: identifier, coordinates, WISE W1/W2 mags (+ uncertainties), 2MASS J mag (+ uncertainty)\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0);\n```"
                },
                "in_toks": 2484,
                "out_toks": 861,
                "id": "chatcmpl-CSxjwDml13rWlc3yR6hMth5ehVt0K",
                "created": 1761018860,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "40",
            "experiment_id": "run_4",
            "pred_tables": [
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise']"
                },
                "in_toks": 656,
                "out_toks": 205,
                "id": "chatcmpl-CSsfTyMHf0wODXh1YeWrVSo0wcRmk",
                "created": 1760999363,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1166,
                "out_toks": 207,
                "id": "chatcmpl-CSxWUfpQNHYeGPPo5Tl3Qx0f0YIqV",
                "created": 1761018026,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ALLWISE cone search: 1 arcsec radius around RA=23.6488 deg, Dec=30.7314 deg\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE cone search: 1 arcsec radius around RA=23.6488 deg, Dec=30.7314 deg\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0);\n```"
                },
                "in_toks": 2484,
                "out_toks": 1156,
                "id": "chatcmpl-CSxkAzaaH04nKTtRlxwdj8JnCsgwy",
                "created": 1761018874,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "40",
            "experiment_id": "run_5",
            "pred_tables": [
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise']"
                },
                "in_toks": 656,
                "out_toks": 205,
                "id": "chatcmpl-CZMcUPuthKP9200Pp8PIBSv3xDJhx",
                "created": 1762544466,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1166,
                "out_toks": 271,
                "id": "chatcmpl-CZYSLuCbY0gm25nVVDLmUDZpiz2LW",
                "created": 1762589965,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ALLWISE objects within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE objects within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0);\n```"
                },
                "in_toks": 2484,
                "out_toks": 962,
                "id": "chatcmpl-CZZoUiAqNA2D2W0InpIK7InGaIzM7",
                "created": 1762595182,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "40",
            "experiment_id": "run_6",
            "pred_tables": [
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise']"
                },
                "in_toks": 656,
                "out_toks": 269,
                "id": "chatcmpl-CZMccpRBioSRFp0AJcEE0zm01ufLz",
                "created": 1762544474,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1166,
                "out_toks": 143,
                "id": "chatcmpl-CZYSPVYo7kSRcw3N7Fb8Rzu9i6F1E",
                "created": 1762589969,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- AllWISE sources within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\n-- 1 arcsec = 1/3600 degrees\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- AllWISE sources within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\n-- 1 arcsec = 1/3600 degrees\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0);\n```"
                },
                "in_toks": 2484,
                "out_toks": 975,
                "id": "chatcmpl-CZZogWin87TMaKbicZf6FJcWHfVYw",
                "created": 1762595194,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "40",
            "experiment_id": "run_7",
            "pred_tables": [
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise']"
                },
                "in_toks": 656,
                "out_toks": 269,
                "id": "chatcmpl-CZMcntgmDoy9RdMd8hBCidZDqJlWJ",
                "created": 1762544485,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1166,
                "out_toks": 207,
                "id": "chatcmpl-CZYSSkRqbfGT0oOytW5K5QlAnjGDq",
                "created": 1762589972,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ALLWISE sources within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\n-- Returns identifier, coordinates, WISE W1/W2 magnitudes with uncertainties, and 2MASS J magnitude with uncertainty\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE sources within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\n-- Returns identifier, coordinates, WISE W1/W2 magnitudes with uncertainties, and 2MASS J magnitude with uncertainty\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0);\n```"
                },
                "in_toks": 2484,
                "out_toks": 1117,
                "id": "chatcmpl-CZZiC73AYiDNww5KHc5CrRwbuDfqa",
                "created": 1762594792,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "40",
            "experiment_id": "run_8",
            "pred_tables": [
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise']"
                },
                "in_toks": 656,
                "out_toks": 269,
                "id": "chatcmpl-CZMcvxBYP8EewZwjyaEKwiQ5JqDBW",
                "created": 1762544493,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1166,
                "out_toks": 271,
                "id": "chatcmpl-CZYSVgEg1dINE4RCp6dJy1n4ZP3J5",
                "created": 1762589975,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ALLWISE objects within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\n-- Returns identifier, coordinates, and requested magnitudes with uncertainties\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, (1.0/3600.0));  -- radius in degrees (1 arcsec)\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE objects within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\n-- Returns identifier, coordinates, and requested magnitudes with uncertainties\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, (1.0/3600.0));  -- radius in degrees (1 arcsec)\n```"
                },
                "in_toks": 2484,
                "out_toks": 921,
                "id": "chatcmpl-CZZshMwQV0prqgCxIvUGtsKE0eCQI",
                "created": 1762595443,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "40",
            "experiment_id": "run_9",
            "pred_tables": [
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise']"
                },
                "in_toks": 656,
                "out_toks": 269,
                "id": "chatcmpl-CZMd18TDOosdXki63SzP4sSfxN9gf",
                "created": 1762544499,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1166,
                "out_toks": 271,
                "id": "chatcmpl-CZYSZ1k8kfmXaDnNVjuI72Hqg3mXD",
                "created": 1762589979,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ALLWISE sources within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\n-- Note: q3c_radial_query radius is in degrees; 1 arcsec = 1/3600 degrees\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0)\nORDER BY q3c_dist(ra, dec, 23.6488, 30.7314);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE sources within 1 arcsec of RA=23.6488 deg, Dec=30.7314 deg\n-- Note: q3c_radial_query radius is in degrees; 1 arcsec = 1/3600 degrees\nSELECT\n    oid_catalog,\n    ra,\n    dec,\n    w1mpro,\n    w1sigmpro,\n    w2mpro,\n    w2sigmpro,\n    j_m_2mass,\n    j_msig_2mass\nFROM allwise\nWHERE q3c_radial_query(ra, dec, 23.6488, 30.7314, 1.0/3600.0)\nORDER BY q3c_dist(ra, dec, 23.6488, 30.7314);\n```"
                },
                "in_toks": 2484,
                "out_toks": 883,
                "id": "chatcmpl-CZZpMx08jsnjE1xLAUXQRur8jqNro",
                "created": 1762595236,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "80": {
        "0": {
            "req_id": "80",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'xmatch']",
                    "1": "['object', 'xmatch']"
                },
                "in_toks": 644,
                "out_toks": 480,
                "id": "chatcmpl-CSnVypuAnMjI42qsT6v4WxgTwDO1T",
                "created": 1760979554,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1050,
                "out_toks": 143,
                "id": "chatcmpl-CSnlWkUaMjCWt812wY2FuCBBXxPoe",
                "created": 1760980518,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all xmatch entries for the specified ZTF objects with distance < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all xmatch entries for the specified ZTF objects with distance < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```"
                },
                "in_toks": 2368,
                "out_toks": 455,
                "id": "chatcmpl-CSqs1m4rUSA8tINTg4VaW06R3f7O9",
                "created": 1760992453,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "80",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'xmatch']",
                    "1": "['object', 'xmatch']"
                },
                "in_toks": 644,
                "out_toks": 480,
                "id": "chatcmpl-CSnVypuAnMjI42qsT6v4WxgTwDO1T",
                "created": 1760979554,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1050,
                "out_toks": 335,
                "id": "chatcmpl-CSnlZwzxIvc9EiohZkGLBzIJ0ufh5",
                "created": 1760980521,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all xmatch rows for the specified ZTF objects with distance < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5\nORDER BY oid, dist;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all xmatch rows for the specified ZTF objects with distance < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5\nORDER BY oid, dist;\n```"
                },
                "in_toks": 2368,
                "out_toks": 461,
                "id": "chatcmpl-CSqs2ifZIEwp0Kap1Tf4bVAB9YTLa",
                "created": 1760992454,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "80",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'xmatch']"
                },
                "in_toks": 644,
                "out_toks": 464,
                "id": "chatcmpl-CSsfWllprHKk4TXA586oWczlKAxSz",
                "created": 1760999366,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1050,
                "out_toks": 207,
                "id": "chatcmpl-CSxWYnfBmMQx8tOYdYhgEEEOhDpig",
                "created": 1761018030,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find xmatch rows for specified ZTF objects with dist < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find xmatch rows for specified ZTF objects with dist < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```"
                },
                "in_toks": 2368,
                "out_toks": 389,
                "id": "chatcmpl-CSxkUC9fmau8qHNWhI6oUGaDaaUSk",
                "created": 1761018894,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "80",
            "experiment_id": "run_3",
            "pred_tables": [
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch']"
                },
                "in_toks": 644,
                "out_toks": 653,
                "id": "chatcmpl-CSsfdscW4Cm28wR7FhjxJmyPRZGEt",
                "created": 1760999373,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 568,
                "out_toks": 271,
                "id": "chatcmpl-CSxWbTNELokFGCjM6iOS48KuGhVlD",
                "created": 1761018033,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all xmatch rows for the specified ZTF objects with dist < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all xmatch rows for the specified ZTF objects with dist < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```"
                },
                "in_toks": 1886,
                "out_toks": 391,
                "id": "chatcmpl-CSxkc72nttX2sLkm7m63O7t3BWTQK",
                "created": 1761018902,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "80",
            "experiment_id": "run_4",
            "pred_tables": [
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch']"
                },
                "in_toks": 644,
                "out_toks": 525,
                "id": "chatcmpl-CSsfmRf2WB7xw6ZM5BqUMAXmAqdTG",
                "created": 1760999382,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 568,
                "out_toks": 143,
                "id": "chatcmpl-CSxWebsDAMCH229QeoHNoYpZQefw9",
                "created": 1761018036,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find all xmatch entries for the specified ZTF objects with dist < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find all xmatch entries for the specified ZTF objects with dist < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```"
                },
                "in_toks": 1886,
                "out_toks": 327,
                "id": "chatcmpl-CSxkl5dh2eaPY3bmxBCQsyBGnCCHX",
                "created": 1761018911,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "80",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'xmatch']"
                },
                "in_toks": 644,
                "out_toks": 464,
                "id": "chatcmpl-CZMdAlMIBNSYDk3suhK8J3fiI1c9F",
                "created": 1762544508,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1050,
                "out_toks": 207,
                "id": "chatcmpl-CZYSehQpbGCllPlHGn79RFSwi0INg",
                "created": 1762589984,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all xmatch rows for the specified ZTF objects with dist < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all xmatch rows for the specified ZTF objects with dist < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```"
                },
                "in_toks": 2368,
                "out_toks": 391,
                "id": "chatcmpl-CZZpigGImgszlEPomDYaxwDYtZtDn",
                "created": 1762595258,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "80",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'xmatch']"
                },
                "in_toks": 644,
                "out_toks": 400,
                "id": "chatcmpl-CZMdMZLc1lKxwYfsn0pz3WewuXGg2",
                "created": 1762544520,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1050,
                "out_toks": 143,
                "id": "chatcmpl-CZYShVtX2eQlpniNyNgqr8UgiLKlf",
                "created": 1762589987,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- XMatch rows for specific ZTF objects with dist < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- XMatch rows for specific ZTF objects with dist < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```"
                },
                "in_toks": 2368,
                "out_toks": 324,
                "id": "chatcmpl-CZZic8e4AKMX5EaZ5N6NsaBVXyzsu",
                "created": 1762594818,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "80",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'xmatch']"
                },
                "in_toks": 644,
                "out_toks": 400,
                "id": "chatcmpl-CZMdWRBo3UaK9jo8u5mC4mNhQfWVK",
                "created": 1762544530,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1050,
                "out_toks": 143,
                "id": "chatcmpl-CZYSjIsmN6AJKHJ7vL23Cw8gt0e0g",
                "created": 1762589989,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Xmatch entries for specific ZTF objects with separation < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Xmatch entries for specific ZTF objects with separation < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```"
                },
                "in_toks": 2368,
                "out_toks": 452,
                "id": "chatcmpl-CZZtIV9qvHaKkWnPOi9lzijx44Ifi",
                "created": 1762595480,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "80",
            "experiment_id": "run_8",
            "pred_tables": [
                "xmatch",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch', 'object']"
                },
                "in_toks": 644,
                "out_toks": 528,
                "id": "chatcmpl-CZMdijr8ytbd4grR0voGIm4Lelmv8",
                "created": 1762544542,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1050,
                "out_toks": 143,
                "id": "chatcmpl-CZYSmkIan6nwqInnxOveexQRLPJME",
                "created": 1762589992,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find all cross-matches for the specified ZTF objects with separation < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find all cross-matches for the specified ZTF objects with separation < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```"
                },
                "in_toks": 2368,
                "out_toks": 327,
                "id": "chatcmpl-CZZpUfJ5L60gxsIfrb2jm4PK1vBTM",
                "created": 1762595244,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "80",
            "experiment_id": "run_9",
            "pred_tables": [
                "xmatch",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch', 'object']"
                },
                "in_toks": 644,
                "out_toks": 784,
                "id": "chatcmpl-CZMe1M3CyGZ65TRkFKTZzsCkWUoAU",
                "created": 1762544561,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1050,
                "out_toks": 143,
                "id": "chatcmpl-CZYSxV2HCK9P1lvgIjyvKK7NiGIWB",
                "created": 1762590003,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find all cross-matches for the specified ZTF objects with separation < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find all cross-matches for the specified ZTF objects with separation < 0.5 arcsec\nSELECT *\nFROM xmatch\nWHERE oid IN ('ZTF22abcmmkz', 'ZTF18abbufof')\n  AND dist < 0.5;\n```"
                },
                "in_toks": 2368,
                "out_toks": 327,
                "id": "chatcmpl-CZZq0qNJMM1bemuwEkfS9wKUfPT5C",
                "created": 1762595276,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "45": {
        "0": {
            "req_id": "45",
            "experiment_id": "run_0",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']",
                    "1": "['object', 'dataquality']"
                },
                "in_toks": 627,
                "out_toks": 861,
                "id": "chatcmpl-CSnW3jIIG21DtCiAuWQVt8JDvEy4W",
                "created": 1760979559,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1235,
                "out_toks": 143,
                "id": "chatcmpl-CSnlduSllatfS56K86gXZ8DTPGwKd",
                "created": 1760980525,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n/* Count dataquality rows per object where the PSF-fit reduced chi-square (chipsf) is at least 5 */\nSELECT\n  oid,\n  COUNT(*)\nFROM dataquality\nWHERE oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND chipsf >= 5\nGROUP BY oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* Count dataquality rows per object where the PSF-fit reduced chi-square (chipsf) is at least 5 */\nSELECT\n  oid,\n  COUNT(*)\nFROM dataquality\nWHERE oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND chipsf >= 5\nGROUP BY oid;\n```"
                },
                "in_toks": 2553,
                "out_toks": 1234,
                "id": "chatcmpl-CSqs2F49WMGoqHjfsmzvaOmgxeYXi",
                "created": 1760992454,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "45",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']",
                    "1": "['object', 'dataquality']"
                },
                "in_toks": 627,
                "out_toks": 861,
                "id": "chatcmpl-CSnW3jIIG21DtCiAuWQVt8JDvEy4W",
                "created": 1760979559,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1717,
                "out_toks": 207,
                "id": "chatcmpl-CSnlhqWYKqWNaVIWR1EfFLzWob4m0",
                "created": 1760980529,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Count rows in dataquality with reduced chi-square (chipsf) >= 5 for the specified ZTF objects\nSELECT\n  oid,\n  COUNT(*)\nFROM dataquality\nWHERE oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND chipsf >= 5\nGROUP BY oid\nORDER BY oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Count rows in dataquality with reduced chi-square (chipsf) >= 5 for the specified ZTF objects\nSELECT\n  oid,\n  COUNT(*)\nFROM dataquality\nWHERE oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND chipsf >= 5\nGROUP BY oid\nORDER BY oid;\n```"
                },
                "in_toks": 3035,
                "out_toks": 1045,
                "id": "chatcmpl-CSqs2mKiJ2bONhns7F6i6HtEBpSFA",
                "created": 1760992454,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "45",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'dataquality']"
                },
                "in_toks": 627,
                "out_toks": 272,
                "id": "chatcmpl-CSsfvCsNW65B2LBdADUyWuroIsPPR",
                "created": 1760999391,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1717,
                "out_toks": 399,
                "id": "chatcmpl-CSxWglmN7JMt92OLUHpHKa22GcRjt",
                "created": 1761018038,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Count rows in dataquality for the specified objects where the reduced chi-square (chipsf) is at least 5\nSELECT\n    oid,\n    COUNT(*) AS count\nFROM dataquality\nWHERE oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND chipsf >= 5\nGROUP BY oid\nORDER BY oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Count rows in dataquality for the specified objects where the reduced chi-square (chipsf) is at least 5\nSELECT\n    oid,\n    COUNT(*) AS count\nFROM dataquality\nWHERE oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND chipsf >= 5\nGROUP BY oid\nORDER BY oid;\n```"
                },
                "in_toks": 3035,
                "out_toks": 1432,
                "id": "chatcmpl-CSxktyRlQhf4ynDeVGlNNRu6uUjXS",
                "created": 1761018919,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "45",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'dataquality']"
                },
                "in_toks": 627,
                "out_toks": 336,
                "id": "chatcmpl-CSsfzAzRyZM2NlztWVKkU0pVlDMQh",
                "created": 1760999395,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1717,
                "out_toks": 335,
                "id": "chatcmpl-CSxWmLr5MG713DuZwBVZZ6kwrGWJd",
                "created": 1761018044,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Count rows in dataquality for the specified objects where the reduced chi-square (chipsf) is at least 5\n-- If you need an exact value of 5 instead of a threshold, replace \">= 5\" with \"= 5\"\nSELECT COUNT(*)\nFROM dataquality\nWHERE oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND chipsf >= 5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Count rows in dataquality for the specified objects where the reduced chi-square (chipsf) is at least 5\n-- If you need an exact value of 5 instead of a threshold, replace \">= 5\" with \"= 5\"\nSELECT COUNT(*)\nFROM dataquality\nWHERE oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND chipsf >= 5;\n```"
                },
                "in_toks": 3035,
                "out_toks": 1507,
                "id": "chatcmpl-CSxlDuRx3O9nNiOHDEYnMbtj1eDcY",
                "created": 1761018939,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "45",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'dataquality']"
                },
                "in_toks": 627,
                "out_toks": 336,
                "id": "chatcmpl-CSsg5fTOvjJ00qkzmYS1OW6BdZbqr",
                "created": 1760999401,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1717,
                "out_toks": 399,
                "id": "chatcmpl-CSxWqmBFCaDVi4XAeF0LcQ2PbQPAL",
                "created": 1761018048,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Count dataquality rows per object with reduced chi-square (chipsf) at least 5\nSELECT\n    dq.oid,\n    COUNT(*) AS count\nFROM dataquality dq\nWHERE dq.oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND dq.chipsf >= 5\nGROUP BY dq.oid\nORDER BY dq.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Count dataquality rows per object with reduced chi-square (chipsf) at least 5\nSELECT\n    dq.oid,\n    COUNT(*) AS count\nFROM dataquality dq\nWHERE dq.oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND dq.chipsf >= 5\nGROUP BY dq.oid\nORDER BY dq.oid;\n```"
                },
                "in_toks": 3035,
                "out_toks": 1054,
                "id": "chatcmpl-CSxlTP4GtlmNGGCRgpXctYYt1zkHc",
                "created": 1761018955,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "45",
            "experiment_id": "run_5",
            "pred_tables": [
                "dataquality",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality', 'object']"
                },
                "in_toks": 627,
                "out_toks": 464,
                "id": "chatcmpl-CZMeUcvYYQJuFuL72OAVuWcH8JtWy",
                "created": 1762544590,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1717,
                "out_toks": 143,
                "id": "chatcmpl-CZYT0M8ZsiBdP6Ne6Ya5XOXC0p2kg",
                "created": 1762590006,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Count rows in dataquality for the specified oids where the reduced chi-square (chipsf) is at least 5\nSELECT\n  oid,\n  COUNT(*)\nFROM dataquality\nWHERE oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND chipsf >= 5\nGROUP BY oid\nORDER BY oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Count rows in dataquality for the specified oids where the reduced chi-square (chipsf) is at least 5\nSELECT\n  oid,\n  COUNT(*)\nFROM dataquality\nWHERE oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND chipsf >= 5\nGROUP BY oid\nORDER BY oid;\n```"
                },
                "in_toks": 3035,
                "out_toks": 1495,
                "id": "chatcmpl-CZZivKGLelaGVRAix5o0L1C98u68E",
                "created": 1762594837,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "45",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'dataquality']"
                },
                "in_toks": 627,
                "out_toks": 464,
                "id": "chatcmpl-CZMekYtYt47cu0NneQ84VPotfd8ej",
                "created": 1762544606,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1717,
                "out_toks": 335,
                "id": "chatcmpl-CZYT4bBIM48YLoRATcilYIjBK3rKE",
                "created": 1762590010,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Count rows in dataquality with reduced chi-square (chipsf) at least 5 for the specified ZTF objects\nSELECT\n  dq.oid,\n  COUNT(*)\nFROM dataquality dq\nWHERE dq.oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND dq.chipsf >= 5\nGROUP BY dq.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Count rows in dataquality with reduced chi-square (chipsf) at least 5 for the specified ZTF objects\nSELECT\n  dq.oid,\n  COUNT(*)\nFROM dataquality dq\nWHERE dq.oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND dq.chipsf >= 5\nGROUP BY dq.oid;\n```"
                },
                "in_toks": 3035,
                "out_toks": 1563,
                "id": "chatcmpl-CZZpf0uPuT1q3j9hXLVE26iPEXJ1P",
                "created": 1762595255,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "45",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'dataquality']"
                },
                "in_toks": 627,
                "out_toks": 336,
                "id": "chatcmpl-CZMew0519kvEEGScn2qn9PfhKIVOn",
                "created": 1762544618,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1717,
                "out_toks": 463,
                "id": "chatcmpl-CZYTB57wAjsb1VMWrQsVr4KrNU8H0",
                "created": 1762590017,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Count rows in dataquality with reduced chi-square (chipsf) at least 5 for the specified ZTF objects\nSELECT\n  dq.oid,\n  COUNT(*) AS row_count\nFROM dataquality dq\nWHERE dq.oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND dq.chipsf >= 5\nGROUP BY dq.oid\nORDER BY dq.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Count rows in dataquality with reduced chi-square (chipsf) at least 5 for the specified ZTF objects\nSELECT\n  dq.oid,\n  COUNT(*) AS row_count\nFROM dataquality dq\nWHERE dq.oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND dq.chipsf >= 5\nGROUP BY dq.oid\nORDER BY dq.oid;\n```"
                },
                "in_toks": 3035,
                "out_toks": 1892,
                "id": "chatcmpl-CZZjaxw8r9CNTqq4sPdai3Kf817W5",
                "created": 1762594878,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "45",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'dataquality']"
                },
                "in_toks": 627,
                "out_toks": 400,
                "id": "chatcmpl-CZMf4FqhPr4lf2A3PKTI2RCriRkGN",
                "created": 1762544626,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1717,
                "out_toks": 335,
                "id": "chatcmpl-CZYTO4jg16y5ExfPUpPWkvvXPX47R",
                "created": 1762590030,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Count rows in dataquality for the specified objects where the reduced chi-square (chipsf)\n-- meets a minimum threshold of 5 (interpreted as chipsf >= 5).\nSELECT\n  dq.oid,\n  COUNT(*)\nFROM dataquality dq\nWHERE dq.oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND dq.chipsf >= 5\nGROUP BY dq.oid\nORDER BY dq.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Count rows in dataquality for the specified objects where the reduced chi-square (chipsf)\n-- meets a minimum threshold of 5 (interpreted as chipsf >= 5).\nSELECT\n  dq.oid,\n  COUNT(*)\nFROM dataquality dq\nWHERE dq.oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND dq.chipsf >= 5\nGROUP BY dq.oid\nORDER BY dq.oid;\n```"
                },
                "in_toks": 3035,
                "out_toks": 1261,
                "id": "chatcmpl-CZZqGtYRVN01U313XkWxQBCFPck4z",
                "created": 1762595292,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "45",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'dataquality']"
                },
                "in_toks": 627,
                "out_toks": 400,
                "id": "chatcmpl-CZMfCE8WUdRwNHkKup3hp22tOnAMT",
                "created": 1762544634,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1717,
                "out_toks": 527,
                "id": "chatcmpl-CZYTUG0ljfCbbLkCgTPEzeEA8rOvZ",
                "created": 1762590036,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Count, per requested object, the number of dataquality rows whose reduced chi-square (chipsf)\n-- equals the per-object minimum, when that minimum is exactly 5.\nWITH per_oid_min AS (\n  SELECT oid, MIN(chipsf) AS min_chipsf\n  FROM dataquality\n  WHERE oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  GROUP BY oid\n)\nSELECT dq.oid, COUNT(*) AS rows_with_min_chipsf_5\nFROM dataquality dq\nINNER JOIN per_oid_min m ON dq.oid = m.oid\nWHERE dq.oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND dq.chipsf = m.min_chipsf\n  AND m.min_chipsf = 5\nGROUP BY dq.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Count, per requested object, the number of dataquality rows whose reduced chi-square (chipsf)\n-- equals the per-object minimum, when that minimum is exactly 5.\nWITH per_oid_min AS (\n  SELECT oid, MIN(chipsf) AS min_chipsf\n  FROM dataquality\n  WHERE oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  GROUP BY oid\n)\nSELECT dq.oid, COUNT(*) AS rows_with_min_chipsf_5\nFROM dataquality dq\nINNER JOIN per_oid_min m ON dq.oid = m.oid\nWHERE dq.oid IN ('ZTF23abjikaf', 'ZTF20achlced')\n  AND dq.chipsf = m.min_chipsf\n  AND m.min_chipsf = 5\nGROUP BY dq.oid;\n```"
                },
                "in_toks": 3035,
                "out_toks": 2301,
                "id": "chatcmpl-CZZpyQop4r3KUDGeAXdVZRYfs04OI",
                "created": 1762595274,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "63": {
        "0": {
            "req_id": "63",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']",
                    "1": "['probability', 'object']"
                },
                "in_toks": 639,
                "out_toks": 1120,
                "id": "chatcmpl-CSnWBWt3tfRnf9RIYF0NqCr7RRyXO",
                "created": 1760979567,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1116,
                "out_toks": 271,
                "id": "chatcmpl-CSnlmriCo2Th5p6cxlhDwUeNT9SrN",
                "created": 1760980534,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Probability rows for specified ZTF objects, from the light curve classifier,\n-- limited to rankings 1 or 2, returning all columns and sorted by ranking.\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Probability rows for specified ZTF objects, from the light curve classifier,\n-- limited to rankings 1 or 2, returning all columns and sorted by ranking.\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```"
                },
                "in_toks": 2434,
                "out_toks": 606,
                "id": "chatcmpl-CSqsBLQ6lyP3oWd4Fb74MSG3pygqJ",
                "created": 1760992463,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "63",
            "experiment_id": "run_1",
            "pred_tables": [
                "probability",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']",
                    "1": "['probability', 'object']"
                },
                "in_toks": 639,
                "out_toks": 1120,
                "id": "chatcmpl-CSnWBWt3tfRnf9RIYF0NqCr7RRyXO",
                "created": 1760979567,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1116,
                "out_toks": 207,
                "id": "chatcmpl-CSnlqSJOXHMpTDxC3AcXGd5h3VthW",
                "created": 1760980538,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all probability rows for the requested objects, restricted to the light curve classifier,\n-- with ranking 1 or 2, sorted by ranking.\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all probability rows for the requested objects, restricted to the light curve classifier,\n-- with ranking 1 or 2, sorted by ranking.\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```"
                },
                "in_toks": 2434,
                "out_toks": 731,
                "id": "chatcmpl-CSqs1dyUb8qjY3AN4ZFACUCF3XlBH",
                "created": 1760992453,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "63",
            "experiment_id": "run_2",
            "pred_tables": [
                "probability",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'object']"
                },
                "in_toks": 639,
                "out_toks": 912,
                "id": "chatcmpl-CSsgBUqokRiEPuN6DuZEmnoVaxFkO",
                "created": 1760999407,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1116,
                "out_toks": 335,
                "id": "chatcmpl-CSxWvK00w1WuVyIdwTnGylVQR21UW",
                "created": 1761018053,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Probability rows for specified oids from the light curve classifier with ranking 1 or 2\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Probability rows for specified oids from the light curve classifier with ranking 1 or 2\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```"
                },
                "in_toks": 2434,
                "out_toks": 721,
                "id": "chatcmpl-CSxlfFxuPb0AOpqWRFJthmeYy6dhv",
                "created": 1761018967,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "63",
            "experiment_id": "run_3",
            "pred_tables": [
                "probability",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'object']"
                },
                "in_toks": 639,
                "out_toks": 912,
                "id": "chatcmpl-CSsgOBpBHSyBUEY7tthTbNHtr3DHL",
                "created": 1760999420,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1116,
                "out_toks": 207,
                "id": "chatcmpl-CSxWzZYUMZz5KalycTML3HyUdeiIX",
                "created": 1761018057,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all lc_classifier probabilities with ranking 1 or 2 for the specified ZTF objects\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all lc_classifier probabilities with ranking 1 or 2 for the specified ZTF objects\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```"
                },
                "in_toks": 2434,
                "out_toks": 593,
                "id": "chatcmpl-CSxltoMAO6ughNurXUEsllhJaseRu",
                "created": 1761018981,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "63",
            "experiment_id": "run_4",
            "pred_tables": [
                "probability",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'object']"
                },
                "in_toks": 639,
                "out_toks": 912,
                "id": "chatcmpl-CSsgclOTeL34voJcBAlan3aWiRzWy",
                "created": 1760999434,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1116,
                "out_toks": 207,
                "id": "chatcmpl-CSxX3omVuWV2IPX8L1XiYy9ZAckrJ",
                "created": 1761018061,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all lc_classifier probability rows with ranking 1 or 2\n-- for the specified ZTF objects, sorted by ranking\nSELECT\n    *\nFROM\n    probability\nWHERE\n    oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n    AND classifier_name = 'lc_classifier'\n    AND ranking IN (1, 2)\nORDER BY\n    ranking;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all lc_classifier probability rows with ranking 1 or 2\n-- for the specified ZTF objects, sorted by ranking\nSELECT\n    *\nFROM\n    probability\nWHERE\n    oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n    AND classifier_name = 'lc_classifier'\n    AND ranking IN (1, 2)\nORDER BY\n    ranking;\n```"
                },
                "in_toks": 2434,
                "out_toks": 480,
                "id": "chatcmpl-CSxm3puetNyby7bUFRX13JTvilWxy",
                "created": 1761018991,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "63",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']"
                },
                "in_toks": 639,
                "out_toks": 784,
                "id": "chatcmpl-CZMfLrDCYSJIWqZIfYRx95iBgVbsa",
                "created": 1762544643,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1116,
                "out_toks": 271,
                "id": "chatcmpl-CZYTbxoJQJC7jHcMmL1Q8tc3g5eHM",
                "created": 1762590043,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All probability rows for the specified ZTF objects from the light curve classifier\n-- with ranking 1 or 2, returning all columns and sorted by ranking\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All probability rows for the specified ZTF objects from the light curve classifier\n-- with ranking 1 or 2, returning all columns and sorted by ranking\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking ASC;\n```"
                },
                "in_toks": 2434,
                "out_toks": 543,
                "id": "chatcmpl-CZZl3YPw0zL2cgidKZXlS5OwNENct",
                "created": 1762594969,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "63",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']"
                },
                "in_toks": 639,
                "out_toks": 656,
                "id": "chatcmpl-CZMfcUCDOEnCNenxPvfqksj8MudTI",
                "created": 1762544660,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1116,
                "out_toks": 207,
                "id": "chatcmpl-CZYTgJAWii2573LlCzepVm1ZFaF6y",
                "created": 1762590048,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all probability rows for specified ZTF objects from the light curve classifier\n-- with ranking 1 or 2, sorted by ranking\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all probability rows for specified ZTF objects from the light curve classifier\n-- with ranking 1 or 2, sorted by ranking\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```"
                },
                "in_toks": 2434,
                "out_toks": 602,
                "id": "chatcmpl-CZZrCHqPCgyvGSX57Darn04vxPsSz",
                "created": 1762595350,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "63",
            "experiment_id": "run_7",
            "pred_tables": [
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability']"
                },
                "in_toks": 639,
                "out_toks": 973,
                "id": "chatcmpl-CZMfs2AdD9fT6hyzJkhGfV3XDjqKZ",
                "created": 1762544676,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 634,
                "out_toks": 143,
                "id": "chatcmpl-CZYTkugj80l95qUa1c7vCkXqUyRq1",
                "created": 1762590052,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all rows from 'probability' for the specified ZTF objects,\n-- restricted to the light curve classifier and rankings 1 or 2, sorted by ranking\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all rows from 'probability' for the specified ZTF objects,\n-- restricted to the light curve classifier and rankings 1 or 2, sorted by ranking\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```"
                },
                "in_toks": 1952,
                "out_toks": 608,
                "id": "chatcmpl-CZZqsUlPr2ifAyAKpSrzLW6nreRC5",
                "created": 1762595330,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "63",
            "experiment_id": "run_8",
            "pred_tables": [
                "probability",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'object']"
                },
                "in_toks": 639,
                "out_toks": 400,
                "id": "chatcmpl-CZMgDCFq45xmQw6IHYt8PQVu1XzhM",
                "created": 1762544697,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1116,
                "out_toks": 271,
                "id": "chatcmpl-CZYTnyGudoILnCHW60TuQbIyBgR9M",
                "created": 1762590055,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all probability rows for the specified objects from the light curve classifier\n-- Include rankings 1 or 2, and sort by ranking as requested\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all probability rows for the specified objects from the light curve classifier\n-- Include rankings 1 or 2, and sort by ranking as requested\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```"
                },
                "in_toks": 2434,
                "out_toks": 668,
                "id": "chatcmpl-CZZleLEyYRZQkiiSyO4EgJiOKoQjw",
                "created": 1762595006,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "63",
            "experiment_id": "run_9",
            "pred_tables": [
                "probability",
                "object",
                "step"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'object', 'step']"
                },
                "in_toks": 639,
                "out_toks": 1683,
                "id": "chatcmpl-CZMgNe6l3WNbwMCoexFEwWMT1wp4g",
                "created": 1762544707,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1188,
                "out_toks": 271,
                "id": "chatcmpl-CZYTsSCoRkXnginv13vwLxoWzbV71",
                "created": 1762590060,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all probability rows for the specified ZTF objects,\n-- restricted to the light curve classifier ('lc_classifier')\n-- with ranking 1 or 2, sorted by ranking.\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all probability rows for the specified ZTF objects,\n-- restricted to the light curve classifier ('lc_classifier')\n-- with ranking 1 or 2, sorted by ranking.\nSELECT *\nFROM probability\nWHERE oid IN ('ZTF21aaobkmg', 'ZTF21aaomuka')\n  AND classifier_name = 'lc_classifier'\n  AND ranking IN (1, 2)\nORDER BY ranking;\n```"
                },
                "in_toks": 2506,
                "out_toks": 609,
                "id": "chatcmpl-CZZrXCtzYD0dOcPR4MGotHp9f5l8x",
                "created": 1762595371,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "73": {
        "0": {
            "req_id": "73",
            "experiment_id": "run_0",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']",
                    "1": "['ss_ztf']"
                },
                "in_toks": 626,
                "out_toks": 1246,
                "id": "chatcmpl-CSnWO66MbClXTFGq1WFIpECsC3j4m",
                "created": 1760979580,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 599,
                "out_toks": 271,
                "id": "chatcmpl-CSnlv7GLDB4OdgYtCdW7TAlGiekJ1",
                "created": 1760980543,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return the ZTF object identifier, MPC name, and MPC magnitude of the nearest known Solar System object\nSELECT\n    oid,\n    ssnamenr,\n    ssmagnr\nFROM ss_ztf\nWHERE oid = 'ZTF21acitntz';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return the ZTF object identifier, MPC name, and MPC magnitude of the nearest known Solar System object\nSELECT\n    oid,\n    ssnamenr,\n    ssmagnr\nFROM ss_ztf\nWHERE oid = 'ZTF21acitntz';\n```"
                },
                "in_toks": 1916,
                "out_toks": 772,
                "id": "chatcmpl-CSqsB5Z8x2bWOczT4RZXrAeTdWBjt",
                "created": 1760992463,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "73",
            "experiment_id": "run_1",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']",
                    "1": "['ss_ztf']"
                },
                "in_toks": 626,
                "out_toks": 1246,
                "id": "chatcmpl-CSnWO66MbClXTFGq1WFIpECsC3j4m",
                "created": 1760979580,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 599,
                "out_toks": 207,
                "id": "chatcmpl-CSnlzxYngN8LE0lQze9sS5TfNGnZK",
                "created": 1760980547,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- MPC name (ssnamenr) and MPC magnitude (ssmagnr) for the nearest known Solar System object of ZTF21acitntz\nSELECT\n    ss_ztf.oid,\n    ss_ztf.ssnamenr,\n    ss_ztf.ssmagnr\nFROM ss_ztf\nWHERE ss_ztf.oid = 'ZTF21acitntz';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- MPC name (ssnamenr) and MPC magnitude (ssmagnr) for the nearest known Solar System object of ZTF21acitntz\nSELECT\n    ss_ztf.oid,\n    ss_ztf.ssnamenr,\n    ss_ztf.ssmagnr\nFROM ss_ztf\nWHERE ss_ztf.oid = 'ZTF21acitntz';\n```"
                },
                "in_toks": 1916,
                "out_toks": 992,
                "id": "chatcmpl-CSqs2tzNiJE3QgVszc0v1SguqGZpQ",
                "created": 1760992454,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "73",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'ss_ztf']"
                },
                "in_toks": 626,
                "out_toks": 658,
                "id": "chatcmpl-CSsgrnakGhJkdIUspS0mYCybTHbOe",
                "created": 1760999449,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1081,
                "out_toks": 335,
                "id": "chatcmpl-CSxX6OfxRKCluZNcAcSfgGUkALVBe",
                "created": 1761018064,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return the ZTF object identifier, MPC name, and MPC magnitude for the nearest known Solar System object\nSELECT\n    ss_ztf.oid,\n    ss_ztf.ssnamenr,\n    ss_ztf.ssmagnr\nFROM ss_ztf\nWHERE ss_ztf.oid = 'ZTF21acitntz';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return the ZTF object identifier, MPC name, and MPC magnitude for the nearest known Solar System object\nSELECT\n    ss_ztf.oid,\n    ss_ztf.ssnamenr,\n    ss_ztf.ssmagnr\nFROM ss_ztf\nWHERE ss_ztf.oid = 'ZTF21acitntz';\n```"
                },
                "in_toks": 2398,
                "out_toks": 663,
                "id": "chatcmpl-CSxmCtUWurIGpVlLPstzAaJXto0g7",
                "created": 1761019000,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "73",
            "experiment_id": "run_3",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']"
                },
                "in_toks": 626,
                "out_toks": 783,
                "id": "chatcmpl-CSsh26wmQBUpVsBt5cdzk4gIxGdVk",
                "created": 1760999460,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 599,
                "out_toks": 207,
                "id": "chatcmpl-CSxXBWWX3YsqJMc1TRbxdEXzZVqcA",
                "created": 1761018069,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return the ZTF object identifier (oid), the MPC name (ssnamenr), and the MPC magnitude (ssmagnr)\nSELECT\n  ss_ztf.oid,\n  ss_ztf.ssnamenr,\n  ss_ztf.ssmagnr\nFROM ss_ztf\nWHERE ss_ztf.oid = 'ZTF21acitntz';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return the ZTF object identifier (oid), the MPC name (ssnamenr), and the MPC magnitude (ssmagnr)\nSELECT\n  ss_ztf.oid,\n  ss_ztf.ssnamenr,\n  ss_ztf.ssmagnr\nFROM ss_ztf\nWHERE ss_ztf.oid = 'ZTF21acitntz';\n```"
                },
                "in_toks": 1916,
                "out_toks": 988,
                "id": "chatcmpl-CSxmNE3bF64XYd3tYt4Tmx8rUvtyi",
                "created": 1761019011,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "73",
            "experiment_id": "run_4",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']"
                },
                "in_toks": 626,
                "out_toks": 974,
                "id": "chatcmpl-CSshDsEb20r3YA2JxuPEFiCgtl8FP",
                "created": 1760999471,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 599,
                "out_toks": 271,
                "id": "chatcmpl-CSxXE5M0jNKKZChVIglfIoZygY8cA",
                "created": 1761018072,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return the ZTF object identifier (oid), MPC name (ssnamenr), and MPC magnitude (ssmagnr)\n-- for the nearest known Solar System object associated with ZTF object 'ZTF21acitntz'\nSELECT\n    ss_ztf.oid,\n    ss_ztf.ssnamenr,\n    ss_ztf.ssmagnr\nFROM ss_ztf\nWHERE ss_ztf.oid = 'ZTF21acitntz';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return the ZTF object identifier (oid), MPC name (ssnamenr), and MPC magnitude (ssmagnr)\n-- for the nearest known Solar System object associated with ZTF object 'ZTF21acitntz'\nSELECT\n    ss_ztf.oid,\n    ss_ztf.ssnamenr,\n    ss_ztf.ssmagnr\nFROM ss_ztf\nWHERE ss_ztf.oid = 'ZTF21acitntz';\n```"
                },
                "in_toks": 1916,
                "out_toks": 815,
                "id": "chatcmpl-CSxhG8vKLE8uVhiW5qgIcLQvR1Ozw",
                "created": 1761018694,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "73",
            "experiment_id": "run_5",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']"
                },
                "in_toks": 626,
                "out_toks": 719,
                "id": "chatcmpl-CZMgztWLk2EHCmDzWvrJWivZDWWJo",
                "created": 1762544745,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 599,
                "out_toks": 335,
                "id": "chatcmpl-CZYTwJksjbIuNePHu3WVRH1qZAcLO",
                "created": 1762590064,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- For the ZTF object 'ZTF21acitntz', return the ZTF object identifier (oid),\n-- the MPC name (ssnamenr), and the MPC magnitude (ssmagnr) of its nearest known Solar System object\nSELECT\n  s.oid,\n  s.ssnamenr,\n  s.ssmagnr\nFROM ss_ztf AS s\nWHERE s.oid = 'ZTF21acitntz';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- For the ZTF object 'ZTF21acitntz', return the ZTF object identifier (oid),\n-- the MPC name (ssnamenr), and the MPC magnitude (ssmagnr) of its nearest known Solar System object\nSELECT\n  s.oid,\n  s.ssnamenr,\n  s.ssmagnr\nFROM ss_ztf AS s\nWHERE s.oid = 'ZTF21acitntz';\n```"
                },
                "in_toks": 1916,
                "out_toks": 936,
                "id": "chatcmpl-CZZmSQ0mHRt3sjDRaHZKsvJ0rlf87",
                "created": 1762595056,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "73",
            "experiment_id": "run_6",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']"
                },
                "in_toks": 626,
                "out_toks": 335,
                "id": "chatcmpl-CZMhBxM0w7GLhLtj7GfCuy5bdbSUb",
                "created": 1762544757,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 599,
                "out_toks": 399,
                "id": "chatcmpl-CZYU14vr1m7Ay34dCwI4g1NHiUGeB",
                "created": 1762590069,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Nearest known Solar System object for the given ZTF object\n-- Returns: ZTF object identifier (oid), MPC name (ssnamenr), and MPC magnitude (ssmagnr)\nSELECT\n    oid,\n    ssnamenr,\n    ssmagnr\nFROM ss_ztf\nWHERE oid = 'ZTF21acitntz';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Nearest known Solar System object for the given ZTF object\n-- Returns: ZTF object identifier (oid), MPC name (ssnamenr), and MPC magnitude (ssmagnr)\nSELECT\n    oid,\n    ssnamenr,\n    ssmagnr\nFROM ss_ztf\nWHERE oid = 'ZTF21acitntz';\n```"
                },
                "in_toks": 1916,
                "out_toks": 661,
                "id": "chatcmpl-CZZs0P7KQhtOIFK4lFl9WVahd7mlh",
                "created": 1762595400,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "73",
            "experiment_id": "run_7",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']"
                },
                "in_toks": 626,
                "out_toks": 399,
                "id": "chatcmpl-CZMhMugP5UtL8Tb4paiYkNUu7jOAv",
                "created": 1762544768,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 599,
                "out_toks": 207,
                "id": "chatcmpl-CZYU6V5BOY4zAkKuMIscluBAIf4PA",
                "created": 1762590074,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Nearest known Solar System object for ZTF object 'ZTF21acitntz'\nSELECT\n    oid,        -- ZTF object identifier\n    ssnamenr,   -- MPC name of nearest known Solar System object\n    ssmagnr     -- MPC magnitude of nearest known Solar System object\nFROM ss_ztf\nWHERE oid = 'ZTF21acitntz';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Nearest known Solar System object for ZTF object 'ZTF21acitntz'\nSELECT\n    oid,        -- ZTF object identifier\n    ssnamenr,   -- MPC name of nearest known Solar System object\n    ssmagnr     -- MPC magnitude of nearest known Solar System object\nFROM ss_ztf\nWHERE oid = 'ZTF21acitntz';\n```"
                },
                "in_toks": 1916,
                "out_toks": 1053,
                "id": "chatcmpl-CZZnVOn6uYhWQl6u3fHn1qkvJHUzN",
                "created": 1762595121,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "73",
            "experiment_id": "run_8",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']"
                },
                "in_toks": 626,
                "out_toks": 591,
                "id": "chatcmpl-CZMhVHB1sgxEuxHdP1EogowDSNL2H",
                "created": 1762544777,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 599,
                "out_toks": 207,
                "id": "chatcmpl-CZYU9YoJ58fpfsdExnYZGC5YdhQ8i",
                "created": 1762590077,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ZTF object 'ZTF21acitntz': return its identifier, the MPC name, and the MPC magnitude\nSELECT\n    oid,\n    ssnamenr,\n    ssmagnr\nFROM ss_ztf\nWHERE oid = 'ZTF21acitntz';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ZTF object 'ZTF21acitntz': return its identifier, the MPC name, and the MPC magnitude\nSELECT\n    oid,\n    ssnamenr,\n    ssmagnr\nFROM ss_ztf\nWHERE oid = 'ZTF21acitntz';\n```"
                },
                "in_toks": 1916,
                "out_toks": 775,
                "id": "chatcmpl-CZZsFG2DaotGdwu6zOTQdtKwE49x6",
                "created": 1762595415,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "73",
            "experiment_id": "run_9",
            "pred_tables": [
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf']"
                },
                "in_toks": 626,
                "out_toks": 463,
                "id": "chatcmpl-CZMheBsd6K17AZFCmv2XxIM18df50",
                "created": 1762544786,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 599,
                "out_toks": 207,
                "id": "chatcmpl-CZYUCKyWLL02i5UOYYXjle9lNcarW",
                "created": 1762590080,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return the ZTF object identifier, MPC name, and MPC magnitude for the nearest known Solar System object\nSELECT\n    oid,\n    ssnamenr,\n    ssmagnr\nFROM ss_ztf\nWHERE oid = 'ZTF21acitntz';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return the ZTF object identifier, MPC name, and MPC magnitude for the nearest known Solar System object\nSELECT\n    oid,\n    ssnamenr,\n    ssmagnr\nFROM ss_ztf\nWHERE oid = 'ZTF21acitntz';\n```"
                },
                "in_toks": 1916,
                "out_toks": 1092,
                "id": "chatcmpl-CZZoHiHun2Mjmmwjz5Hmrsi46sSMJ",
                "created": 1762595169,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "92": {
        "0": {
            "req_id": "92",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "magstat",
                "dataquality",
                "probability",
                "taxonomy",
                "step"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'magstat', 'dataquality', 'probability', 'taxonomy', 'step']",
                    "1": "['object', 'magstat', 'probability', 'taxonomy']"
                },
                "in_toks": 653,
                "out_toks": 3637,
                "id": "chatcmpl-CSnWYdzKv9foKBKWsdlBCk8G3OJGt",
                "created": 1760979590,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return up to 500 ZTF objects ordered by oid\n-- Conditions:\n--   - At least 10 detections in g band (fid=1)\n--   - No dubious points in g band (ndubious=0)\n--   - Only ranking=1 probabilities from the light curve classifier ('lc_classifier')\n--   - Use the latest lc_classifier version available in taxonomy to reduce scan scope\nWITH latest_lc AS\n  (SELECT MAX(t.classifier_version) AS classifier_version\n   FROM taxonomy t\n   WHERE t.classifier_name = 'lc_classifier')\nSELECT p.oid,\n       p.classifier_version,\n       p.class_name,\n       p.probability\nFROM probability p\nJOIN latest_lc l ON p.classifier_version = l.classifier_version\nJOIN magstat m ON m.oid = p.oid\nAND m.fid = 1\nAND m.ndet >= 10\nAND m.ndubious = 0\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\nORDER BY p.oid\nLIMIT 500;",
            "sql_response": {
                "responses": {
                    "0": "-- Return up to 500 ZTF objects ordered by oid\n-- Conditions:\n--   - At least 10 detections in g band (fid=1)\n--   - No dubious points in g band (ndubious=0)\n--   - Only ranking=1 probabilities from the light curve classifier ('lc_classifier')\n--   - Use the latest lc_classifier version available in taxonomy to reduce scan scope\nWITH latest_lc AS\n  (SELECT MAX(t.classifier_version) AS classifier_version\n   FROM taxonomy t\n   WHERE t.classifier_name = 'lc_classifier')\nSELECT p.oid,\n       p.classifier_version,\n       p.class_name,\n       p.probability\nFROM probability p\nJOIN latest_lc l ON p.classifier_version = l.classifier_version\nJOIN magstat m ON m.oid = p.oid\nAND m.fid = 1\nAND m.ndet >= 10\nAND m.ndubious = 0\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\nORDER BY p.oid\nLIMIT 500;"
                },
                "in_toks": 3099,
                "out_toks": 2802,
                "id": "chatcmpl-CbHBh6wq2iHBsK85S9YMMekyNW3Zs",
                "created": 1763000241,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 2761,
                "out_toks": 719,
                "id": "chatcmpl-CSnm3GafMu3uf9FkzRN07emBvomXf",
                "created": 1760980551,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ZTF objects with >=10 detections in g band (fid=1) and no dubious points (ndubious=0)\n-- Only probabilities with ranking=1 for the light curve classifier ('lc_classifier')\n-- Return: oid (ZTF identifier), classifier_version, class_name, probability\n-- At most 500 objects, ordered by oid\nWITH eligible AS (\n    SELECT m.oid\n    FROM magstat m\n    WHERE m.fid = 1\n      AND m.ndet >= 10\n      AND m.ndubious = 0\n),\nrank1 AS (\n    SELECT\n        p.oid,\n        p.classifier_version,\n        p.class_name,\n        p.probability,\n        ROW_NUMBER() OVER (PARTITION BY p.oid ORDER BY p.classifier_version DESC) AS rn\n    FROM probability p\n    INNER JOIN eligible e ON e.oid = p.oid\n    WHERE p.ranking = 1\n      AND p.classifier_name = 'lc_classifier'\n)\nSELECT\n    oid,\n    classifier_version,\n    class_name,\n    probability\nFROM rank1\nWHERE rn = 1\nORDER BY oid\nLIMIT 500;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ZTF objects with >=10 detections in g band (fid=1) and no dubious points (ndubious=0)\n-- Only probabilities with ranking=1 for the light curve classifier ('lc_classifier')\n-- Return: oid (ZTF identifier), classifier_version, class_name, probability\n-- At most 500 objects, ordered by oid\nWITH eligible AS (\n    SELECT m.oid\n    FROM magstat m\n    WHERE m.fid = 1\n      AND m.ndet >= 10\n      AND m.ndubious = 0\n),\nrank1 AS (\n    SELECT\n        p.oid,\n        p.classifier_version,\n        p.class_name,\n        p.probability,\n        ROW_NUMBER() OVER (PARTITION BY p.oid ORDER BY p.classifier_version DESC) AS rn\n    FROM probability p\n    INNER JOIN eligible e ON e.oid = p.oid\n    WHERE p.ranking = 1\n      AND p.classifier_name = 'lc_classifier'\n)\nSELECT\n    oid,\n    classifier_version,\n    class_name,\n    probability\nFROM rank1\nWHERE rn = 1\nORDER BY oid\nLIMIT 500;\n```"
                },
                "in_toks": 4079,
                "out_toks": 2624,
                "id": "chatcmpl-CSqsIvJxXIWenT06d8g87LwEpY7vW",
                "created": 1760992470,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "1": {
            "req_id": "92",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "magstat",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'magstat', 'dataquality', 'probability', 'taxonomy', 'step']",
                    "1": "['object', 'magstat', 'probability', 'taxonomy']"
                },
                "in_toks": 653,
                "out_toks": 3637,
                "id": "chatcmpl-CSnWYdzKv9foKBKWsdlBCk8G3OJGt",
                "created": 1760979590,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1892,
                "out_toks": 335,
                "id": "chatcmpl-CSnmD8XN6MvtZ8zXy14ZxH7KrG8Rg",
                "created": 1760980561,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 500 ZTF objects with >=10 detections in g band (fid=1) and no dubious points (ndubious=0),\n-- and return their top-ranked light curve classifier probabilities.\nSELECT\n    p.oid,\n    p.classifier_version,\n    p.class_name,\n    p.probability\nFROM probability p\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND EXISTS (\n        SELECT 1\n        FROM magstat m\n        WHERE\n            m.oid = p.oid\n            AND m.fid = 1           -- g band\n            AND m.ndet >= 10        -- minimum 10 detections in g\n            AND m.ndubious = 0      -- no dubious points in g\n    )\nORDER BY p.oid\nLIMIT 500;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 500 ZTF objects with >=10 detections in g band (fid=1) and no dubious points (ndubious=0),\n-- and return their top-ranked light curve classifier probabilities.\nSELECT\n    p.oid,\n    p.classifier_version,\n    p.class_name,\n    p.probability\nFROM probability p\nWHERE\n    p.ranking = 1\n    AND p.classifier_name = 'lc_classifier'\n    AND EXISTS (\n        SELECT 1\n        FROM magstat m\n        WHERE\n            m.oid = p.oid\n            AND m.fid = 1           -- g band\n            AND m.ndet >= 10        -- minimum 10 detections in g\n            AND m.ndubious = 0      -- no dubious points in g\n    )\nORDER BY p.oid\nLIMIT 500;\n```"
                },
                "in_toks": 3210,
                "out_toks": 1921,
                "id": "chatcmpl-CSqs2BuPYKNNAChYaBskz3Qx6EUFc",
                "created": 1760992454,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "92",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "magstat",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'magstat', 'detection']"
                },
                "in_toks": 653,
                "out_toks": 1691,
                "id": "chatcmpl-CSshRJQb53TYyf7KMp4CUW9n8p9hW",
                "created": 1760999485,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 2440,
                "out_toks": 847,
                "id": "chatcmpl-CSxXHAqjwZYfkNKV0UQAELrTR2RN8",
                "created": 1761018075,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Select up to 500 ZTF objects (ordered by oid) with at least 10 detections in g-band (fid=1) and no dubious points\nWITH selected_oids AS (\n    SELECT DISTINCT m.oid\n    FROM magstat m\n    WHERE m.fid = 1               -- g band\n      AND m.ndet >= 10            -- minimum 10 detections in g\n      AND m.ndubious = 0          -- no dubious points in that filter\n    ORDER BY m.oid\n    LIMIT 500\n)\n-- Return required columns with probabilities restricted to ranking=1 for the light curve classifier\nSELECT\n    p.oid,\n    p.classifier_version,\n    p.class_name,\n    p.probability\nFROM probability p\nINNER JOIN selected_oids s ON s.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\nORDER BY p.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Select up to 500 ZTF objects (ordered by oid) with at least 10 detections in g-band (fid=1) and no dubious points\nWITH selected_oids AS (\n    SELECT DISTINCT m.oid\n    FROM magstat m\n    WHERE m.fid = 1               -- g band\n      AND m.ndet >= 10            -- minimum 10 detections in g\n      AND m.ndubious = 0          -- no dubious points in that filter\n    ORDER BY m.oid\n    LIMIT 500\n)\n-- Return required columns with probabilities restricted to ranking=1 for the light curve classifier\nSELECT\n    p.oid,\n    p.classifier_version,\n    p.class_name,\n    p.probability\nFROM probability p\nINNER JOIN selected_oids s ON s.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\nORDER BY p.oid;\n```"
                },
                "in_toks": 3758,
                "out_toks": 2005,
                "id": "chatcmpl-CSxhRiMzlK0k9HvdtB1RTUAm4rIe0",
                "created": 1761018705,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "92",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "detection",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection', 'probability', 'taxonomy']"
                },
                "in_toks": 653,
                "out_toks": 1495,
                "id": "chatcmpl-CSsht05lUTbkkXfv9COSMcP3awjGP",
                "created": 1760999513,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Up to 500 ZTF objects (by oid) with at least 10 good g-band detections (corrected AND non-dubious)\n-- and zero dubious detections in g-band. Return lc_classifier rank-1 probabilities.\nWITH p1 AS\n  (-- Pre-filter probability table (3 conditions as required): classifier, ranking, and valid probability\n SELECT oid,\n        classifier_version,\n        class_name,\n        probability\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND ranking = 1\n     AND probability > 0),\n     good_g AS\n  (-- Oids with at least 10 corrected and non-dubious detections in g band\n SELECT d.oid\n   FROM detection d\n   WHERE d.fid = 1\n     AND d.corrected = TRUE\n     AND d.dubious = FALSE\n   GROUP BY d.oid\n   HAVING COUNT(*) >= 10),\n     bad_g AS\n  (-- Oids with ANY dubious detection in g band\n SELECT DISTINCT d.oid\n   FROM detection d\n   WHERE d.fid = 1\n     AND d.dubious = TRUE),\n     cand_oids AS\n  (-- Candidate oids meeting detection criteria, limited to 500 in oid order\n SELECT gg.oid\n   FROM good_g gg\n   LEFT JOIN bad_g bg ON bg.oid = gg.oid\n   WHERE bg.oid IS NULL\n   ORDER BY gg.oid\n   LIMIT 500)\nSELECT p1.oid,\n       p1.classifier_version,\n       p1.class_name,\n       p1.probability\nFROM p1\nJOIN cand_oids co ON co.oid = p1.oid\nORDER BY p1.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Up to 500 ZTF objects (by oid) with at least 10 good g-band detections (corrected AND non-dubious)\n-- and zero dubious detections in g-band. Return lc_classifier rank-1 probabilities.\nWITH p1 AS\n  (-- Pre-filter probability table (3 conditions as required): classifier, ranking, and valid probability\n SELECT oid,\n        classifier_version,\n        class_name,\n        probability\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND ranking = 1\n     AND probability > 0),\n     good_g AS\n  (-- Oids with at least 10 corrected and non-dubious detections in g band\n SELECT d.oid\n   FROM detection d\n   WHERE d.fid = 1\n     AND d.corrected = TRUE\n     AND d.dubious = FALSE\n   GROUP BY d.oid\n   HAVING COUNT(*) >= 10),\n     bad_g AS\n  (-- Oids with ANY dubious detection in g band\n SELECT DISTINCT d.oid\n   FROM detection d\n   WHERE d.fid = 1\n     AND d.dubious = TRUE),\n     cand_oids AS\n  (-- Candidate oids meeting detection criteria, limited to 500 in oid order\n SELECT gg.oid\n   FROM good_g gg\n   LEFT JOIN bad_g bg ON bg.oid = gg.oid\n   WHERE bg.oid IS NULL\n   ORDER BY gg.oid\n   LIMIT 500)\nSELECT p1.oid,\n       p1.classifier_version,\n       p1.class_name,\n       p1.probability\nFROM p1\nJOIN cand_oids co ON co.oid = p1.oid\nORDER BY p1.oid;"
                },
                "in_toks": 2138,
                "out_toks": 4976,
                "id": "chatcmpl-CbHCKhnWlMNY7KaxBWE9ivDCdJqQq",
                "created": 1763000280,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1723,
                "out_toks": 1615,
                "id": "chatcmpl-CSxXRZ99Fc3cEb8f0EZWmiGr0zwbW",
                "created": 1761018085,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Map the user requirements to schema columns and constants\n- ZTF identifier: probability.oid (same as detection.oid and object.oid)\n- g band detections: detection.fid = 1 (1 = g; 2 = r; 3 = i)\n- Non-dubious: detection.dubious = FALSE\n- \u201cNo dubious corrections in that filter\u201d: enforce no dubious detections in g; and count only corrected, non-dubious detections:\n  - corrected detections: detection.corrected = TRUE\n  - no dubious in g: ensure there are zero rows with detection.fid = 1 and detection.dubious = TRUE for the same oid\n- Minimum 10 detections in g: at least 10 detections satisfying (fid = 1 AND corrected = TRUE AND dubious = FALSE)\n- Probabilities filter (as required and per defaults):\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n- Columns to return:\n  - ZTF identifier: probability.oid\n  - classifier version: probability.classifier_version\n  - class name: probability.class_name\n  - probability: probability.probability\n- Sort and limit:\n  - ORDER BY probability.oid ASC\n  - LIMIT 500\n\n2) Build a subquery over detection to identify eligible objects by oid\n- Source: detection d\n- Filter the band first to reduce rows:\n  - WHERE d.fid = 1\n- Grouping key:\n  - GROUP BY d.oid\n- Aggregation-based conditions in HAVING:\n  - COUNT(*) FILTER (WHERE d.corrected = TRUE AND d.dubious = FALSE) >= 10  [minimum 10 good g-band detections]\n  - COUNT(*) FILTER (WHERE d.dubious = TRUE) = 0  [no dubious detections in g band]\n- Output of this subquery:\n  - SELECT d.oid as the set of qualifying ZTF objects in g band\n\nNotes:\n- This respects the \u201cavoid filtering on detection by other parameters than oid\u201d guideline as much as possible by consolidating all detection-level conditions into a single grouped subquery keyed by d.oid (the hash index on detection.oid will help when joining).\n\n3) Join the qualifying oids to the classification probabilities\n- Source: probability p\n- Apply required defaults/filters:\n  - p.classifier_name = 'lc_classifier'\n  - p.ranking = 1\n  - These conditions leverage indexes ix_classification_rank1 (partial on ranking = 1) and ix_probabilities_oid.\n- Join:\n  - INNER JOIN the detection subquery (from step 2) on p.oid = (subquery).oid\n  - This returns only objects that meet the detection criteria and have a top-ranked lc_classifier probability.\n\n4) Select the requested output columns\n- p.oid                              as ZTF identifier\n- p.classifier_version               as classifier version\n- p.class_name                       as class name\n- p.probability                      as probability\n\n5) Sort and limit the result set\n- ORDER BY p.oid ASC  [ordered by their oids]\n- LIMIT 500           [at most 500 ZTF objects]\n\n6) Performance and correctness considerations\n- The detection subquery performs a single scan/group-by over detection restricted to fid = 1, then uses HAVING with filtered counts; this avoids repeated scans or correlated subqueries.\n- No need to reference the object table since all required fields come from detection and probability.\n- There may be multiple rows per oid if multiple lc_classifier versions exist; this matches the user\u2019s request to return classifier version explicitly. If only one version per oid is desired, an extra step to choose a specific p.classifier_version (e.g., latest) would be needed, but the user did not request this.\n- All class names and classifier name literals must match exactly those in the schema: p.classifier_name = 'lc_classifier'.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Map the user requirements to schema columns and constants\n- ZTF identifier: probability.oid (same as detection.oid and object.oid)\n- g band detections: detection.fid = 1 (1 = g; 2 = r; 3 = i)\n- Non-dubious: detection.dubious = FALSE\n- \u201cNo dubious corrections in that filter\u201d: enforce no dubious detections in g; and count only corrected, non-dubious detections:\n  - corrected detections: detection.corrected = TRUE\n  - no dubious in g: ensure there are zero rows with detection.fid = 1 and detection.dubious = TRUE for the same oid\n- Minimum 10 detections in g: at least 10 detections satisfying (fid = 1 AND corrected = TRUE AND dubious = FALSE)\n- Probabilities filter (as required and per defaults):\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking = 1\n- Columns to return:\n  - ZTF identifier: probability.oid\n  - classifier version: probability.classifier_version\n  - class name: probability.class_name\n  - probability: probability.probability\n- Sort and limit:\n  - ORDER BY probability.oid ASC\n  - LIMIT 500\n\n2) Build a subquery over detection to identify eligible objects by oid\n- Source: detection d\n- Filter the band first to reduce rows:\n  - WHERE d.fid = 1\n- Grouping key:\n  - GROUP BY d.oid\n- Aggregation-based conditions in HAVING:\n  - COUNT(*) FILTER (WHERE d.corrected = TRUE AND d.dubious = FALSE) >= 10  [minimum 10 good g-band detections]\n  - COUNT(*) FILTER (WHERE d.dubious = TRUE) = 0  [no dubious detections in g band]\n- Output of this subquery:\n  - SELECT d.oid as the set of qualifying ZTF objects in g band\n\nNotes:\n- This respects the \u201cavoid filtering on detection by other parameters than oid\u201d guideline as much as possible by consolidating all detection-level conditions into a single grouped subquery keyed by d.oid (the hash index on detection.oid will help when joining).\n\n3) Join the qualifying oids to the classification probabilities\n- Source: probability p\n- Apply required defaults/filters:\n  - p.classifier_name = 'lc_classifier'\n  - p.ranking = 1\n  - These conditions leverage indexes ix_classification_rank1 (partial on ranking = 1) and ix_probabilities_oid.\n- Join:\n  - INNER JOIN the detection subquery (from step 2) on p.oid = (subquery).oid\n  - This returns only objects that meet the detection criteria and have a top-ranked lc_classifier probability.\n\n4) Select the requested output columns\n- p.oid                              as ZTF identifier\n- p.classifier_version               as classifier version\n- p.class_name                       as class name\n- p.probability                      as probability\n\n5) Sort and limit the result set\n- ORDER BY p.oid ASC  [ordered by their oids]\n- LIMIT 500           [at most 500 ZTF objects]\n\n6) Performance and correctness considerations\n- The detection subquery performs a single scan/group-by over detection restricted to fid = 1, then uses HAVING with filtered counts; this avoids repeated scans or correlated subqueries.\n- No need to reference the object table since all required fields come from detection and probability.\n- There may be multiple rows per oid if multiple lc_classifier versions exist; this matches the user\u2019s request to return classifier version explicitly. If only one version per oid is desired, an extra step to choose a specific p.classifier_version (e.g., latest) would be needed, but the user did not request this.\n- All class names and classifier name literals must match exactly those in the schema: p.classifier_name = 'lc_classifier'."
                },
                "in_toks": 3331,
                "out_toks": 3657,
                "id": "chatcmpl-CSxhu8hYaxQmXKfm5E12G4Jws844y",
                "created": 1761018734,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 500 ZTF objects with at least 10 good (corrected, non-dubious) g-band detections\n-- and no dubious detections in g, returning lc_classifier rank-1 probabilities\nSELECT\n  p.oid,\n  p.classifier_version,\n  p.class_name,\n  p.probability\nFROM probability p\nINNER JOIN (\n  SELECT d.oid\n  FROM detection d\n  WHERE d.fid = 1 -- g band\n  GROUP BY d.oid\n  HAVING\n    COUNT(*) FILTER (WHERE d.corrected = TRUE AND d.dubious = FALSE) >= 10 -- minimum 10 good g detections\n    AND COUNT(*) FILTER (WHERE d.dubious = TRUE) = 0 -- no dubious in g band\n) g ON g.oid = p.oid\nWHERE\n  p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\nORDER BY p.oid ASC\nLIMIT 500;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 500 ZTF objects with at least 10 good (corrected, non-dubious) g-band detections\n-- and no dubious detections in g, returning lc_classifier rank-1 probabilities\nSELECT\n  p.oid,\n  p.classifier_version,\n  p.class_name,\n  p.probability\nFROM probability p\nINNER JOIN (\n  SELECT d.oid\n  FROM detection d\n  WHERE d.fid = 1 -- g band\n  GROUP BY d.oid\n  HAVING\n    COUNT(*) FILTER (WHERE d.corrected = TRUE AND d.dubious = FALSE) >= 10 -- minimum 10 good g detections\n    AND COUNT(*) FILTER (WHERE d.dubious = TRUE) = 0 -- no dubious in g band\n) g ON g.oid = p.oid\nWHERE\n  p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\nORDER BY p.oid ASC\nLIMIT 500;\n```"
                },
                "in_toks": 2891,
                "out_toks": 1566,
                "id": "chatcmpl-CSyLx6dr0CkKNmCKOq5gZDkWdbIFj",
                "created": 1761021217,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "4": {
            "req_id": "92",
            "experiment_id": "run_4",
            "pred_tables": [
                "probability",
                "taxonomy",
                "step",
                "magstat",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'step', 'magstat', 'detection']"
                },
                "in_toks": 653,
                "out_toks": 2203,
                "id": "chatcmpl-CSsiCKBy00JEWF5JK6U2XX9Y4wNDG",
                "created": 1760999532,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 2030,
                "out_toks": 527,
                "id": "chatcmpl-CSxXfhsJiThCDY6m4MdxunW2xbTpt",
                "created": 1761018099,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 500 ZTF objects (ordered by oid) with at least 10 g-band detections and no dubious points in g,\n-- then return their rank-1 light curve classifier results.\nWITH selected_oids AS (\n    SELECT DISTINCT m.oid\n    FROM magstat m\n    WHERE m.fid = 1              -- g band\n      AND m.ndet >= 10           -- minimum 10 detections in g\n      AND m.ndubious = 0         -- no dubious points in g\n    ORDER BY m.oid\n    LIMIT 500\n)\nSELECT\n    p.oid,\n    p.classifier_version,\n    p.class_name,\n    p.probability\nFROM probability p\nINNER JOIN selected_oids s ON s.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\nORDER BY p.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 500 ZTF objects (ordered by oid) with at least 10 g-band detections and no dubious points in g,\n-- then return their rank-1 light curve classifier results.\nWITH selected_oids AS (\n    SELECT DISTINCT m.oid\n    FROM magstat m\n    WHERE m.fid = 1              -- g band\n      AND m.ndet >= 10           -- minimum 10 detections in g\n      AND m.ndubious = 0         -- no dubious points in g\n    ORDER BY m.oid\n    LIMIT 500\n)\nSELECT\n    p.oid,\n    p.classifier_version,\n    p.class_name,\n    p.probability\nFROM probability p\nINNER JOIN selected_oids s ON s.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\nORDER BY p.oid;\n```"
                },
                "in_toks": 3348,
                "out_toks": 2763,
                "id": "chatcmpl-CSxibVJTEZyPx8nKjk7rEzBMezlt0",
                "created": 1761018777,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "92",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "magstat",
                "probability",
                "taxonomy",
                "step"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'magstat', 'probability', 'taxonomy', 'step']"
                },
                "in_toks": 653,
                "out_toks": 1690,
                "id": "chatcmpl-CZMhvOqZCmtzsbEnqYICBlFYuAxRn",
                "created": 1762544803,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1964,
                "out_toks": 591,
                "id": "chatcmpl-CZYUFwWvrz2hnYl2LBUhQvrWblnDK",
                "created": 1762590083,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 500 objects with at least 10 detections in g-band (fid=1) and no dubious points (ndubious=0),\n-- then return their top lc_classifier probabilities (ranking=1), ordered by oid.\nWITH eligible AS (\n    SELECT DISTINCT m.oid\n    FROM magstat m\n    WHERE m.fid = 1\n      AND m.ndet >= 10\n      AND m.ndubious = 0\n),\nlimited AS (\n    SELECT e.oid\n    FROM eligible e\n    ORDER BY e.oid\n    LIMIT 500\n)\nSELECT\n    p.oid,\n    p.classifier_version,\n    p.class_name,\n    p.probability\nFROM probability p\nINNER JOIN limited l\n    ON l.oid = p.oid\nWHERE p.ranking = 1\n  AND p.classifier_name = 'lc_classifier'\nORDER BY p.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 500 objects with at least 10 detections in g-band (fid=1) and no dubious points (ndubious=0),\n-- then return their top lc_classifier probabilities (ranking=1), ordered by oid.\nWITH eligible AS (\n    SELECT DISTINCT m.oid\n    FROM magstat m\n    WHERE m.fid = 1\n      AND m.ndet >= 10\n      AND m.ndubious = 0\n),\nlimited AS (\n    SELECT e.oid\n    FROM eligible e\n    ORDER BY e.oid\n    LIMIT 500\n)\nSELECT\n    p.oid,\n    p.classifier_version,\n    p.class_name,\n    p.probability\nFROM probability p\nINNER JOIN limited l\n    ON l.oid = p.oid\nWHERE p.ranking = 1\n  AND p.classifier_name = 'lc_classifier'\nORDER BY p.oid;\n```"
                },
                "in_toks": 3282,
                "out_toks": 2252,
                "id": "chatcmpl-CZZsYZtnwO0Pw9x258CkCb7I5wQSy",
                "created": 1762595434,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "92",
            "experiment_id": "run_6",
            "pred_tables": [
                "probability",
                "taxonomy",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'detection']"
                },
                "in_toks": 653,
                "out_toks": 2452,
                "id": "chatcmpl-CZMiOUGCIOv4afrZfGXHnKgW5aVZl",
                "created": 1762544832,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return up to 500 oids (ordered) that have:\n--  - >=10 detections in g band (fid=1)\n--  - no dubious corrections in g band\n--  - probability rows only from lc_classifier with ranking=1\n-- Use correlated subqueries on detection keyed by oid to avoid full-table aggregates and reduce timeouts.\nWITH candidate_oids AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier' -- 1st condition on probability\n\n     AND p.ranking = 1 -- 2nd condition on probability\n\n     AND p.probability >= 0 -- 3rd condition on probability (keeps semantics)\n\n     AND NOT EXISTS\n       (-- ensure no dubious g-band detections\n SELECT 1\n        FROM detection d\n        WHERE d.oid = p.oid\n          AND d.fid = 1\n          AND d.dubious = TRUE)\n     AND\n       (-- ensure at least 10 g-band detections\n SELECT COUNT(*)\n        FROM detection d2\n        WHERE d2.oid = p.oid\n          AND d2.fid = 1) >= 10\n   GROUP BY p.oid\n   ORDER BY p.oid\n   LIMIT 500)\nSELECT p.oid AS ztf_id,\n       p.classifier_version,\n       p.class_name,\n       p.probability\nFROM probability p\nJOIN candidate_oids co USING (oid)\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\nORDER BY p.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Return up to 500 oids (ordered) that have:\n--  - >=10 detections in g band (fid=1)\n--  - no dubious corrections in g band\n--  - probability rows only from lc_classifier with ranking=1\n-- Use correlated subqueries on detection keyed by oid to avoid full-table aggregates and reduce timeouts.\nWITH candidate_oids AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier' -- 1st condition on probability\n\n     AND p.ranking = 1 -- 2nd condition on probability\n\n     AND p.probability >= 0 -- 3rd condition on probability (keeps semantics)\n\n     AND NOT EXISTS\n       (-- ensure no dubious g-band detections\n SELECT 1\n        FROM detection d\n        WHERE d.oid = p.oid\n          AND d.fid = 1\n          AND d.dubious = TRUE)\n     AND\n       (-- ensure at least 10 g-band detections\n SELECT COUNT(*)\n        FROM detection d2\n        WHERE d2.oid = p.oid\n          AND d2.fid = 1) >= 10\n   GROUP BY p.oid\n   ORDER BY p.oid\n   LIMIT 500)\nSELECT p.oid AS ztf_id,\n       p.classifier_version,\n       p.class_name,\n       p.probability\nFROM probability p\nJOIN candidate_oids co USING (oid)\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\nORDER BY p.oid;"
                },
                "in_toks": 1924,
                "out_toks": 4704,
                "id": "chatcmpl-CbHDO6aeNDY90yd4nesOqR36afW54",
                "created": 1763000346,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1241,
                "out_toks": 1359,
                "id": "chatcmpl-CZYUN2OrnQoAAYOd9ZAyInfUpqqzc",
                "created": 1762590091,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve at most 500 ZTF objects (ordered by oid) that:\n  - Have at least 10 detections in the g band (fid = 1).\n  - Have no dubious detections in the g band (dubious = false for all g-band detections).\n- Return columns: ZTF identifier (oid), classifier version, class name, probability.\n- Only include classification probabilities with ranking = 1 for the light curve classifier (classifier_name = 'lc_classifier').\n\nTables and columns involved\n- probability:\n  - oid (VARCHAR)\n  - class_name (VARCHAR)\n  - classifier_name (VARCHAR)\n  - classifier_version (VARCHAR)\n  - probability (DOUBLE PRECISION)\n  - ranking (INTEGER)\n- detection:\n  - oid (VARCHAR)\n  - fid (INTEGER; 1=g, 2=r, 3=i)\n  - dubious (BOOLEAN NOT NULL)\n  - Other columns exist but are not needed for the result.\n\nConstraints and defaults to enforce\n- probability.ranking = 1\n- probability.classifier_name = 'lc_classifier'\n- Detections requirement:\n  - g-band is fid = 1\n  - At least 10 detections in g band per object.\n  - No dubious detections in g band per object (i.e., count of g-band detections with dubious = true must be zero).\n- Ordering and limiting:\n  - ORDER BY oid ASC\n  - LIMIT 500\n\nPerformance considerations\n- The detection table is large and indexed on oid (ix_ndetection_oid). To avoid scanning the entire detection table, first restrict the set of oids using the probability table with the default conditions (ranking = 1 and classifier_name = 'lc_classifier'). Then aggregate detection rows only for that subset via an inner join on oid.\n- The probability table has useful indexes on ranking (including a partial index for ranking = 1) and probability, which will help pre-filtering.\n\nStep-by-step plan\n\n1) Build the base set of candidate objects from the probability table\n- Select the rows that correspond to the light curve classifier and only the top-ranked class per object:\n  - FROM probability p\n  - WHERE p.classifier_name = 'lc_classifier' AND p.ranking = 1\n- This produces one row per object (oid) with the most likely lc_classifier class, and includes the fields needed for the final output (class_name, classifier_version, probability).\n- This subquery will be used both to constrain detection aggregation and to provide the final output columns.\n\n2) Compute per-object g-band detection statistics restricted to the candidate set\n- Join detection to the candidate oid list from step 1 on detection.oid = p.oid to avoid scanning detections for objects not in the candidate set.\n- Group by detection.oid.\n- Compute:\n  - g_det_count = number of detections with fid = 1 (PostgreSQL COUNT(*) FILTER (WHERE d.fid = 1), or SUM(CASE WHEN d.fid = 1 THEN 1 ELSE 0 END))\n  - g_dubious_count = number of detections with fid = 1 AND dubious = true (COUNT(*) FILTER (WHERE d.fid = 1 AND d.dubious = true), or SUM(CASE WHEN d.fid = 1 AND d.dubious THEN 1 ELSE 0 END))\n- Apply HAVING conditions to enforce the user\u2019s requirements:\n  - g_det_count >= 10\n  - g_dubious_count = 0\n- The output of this subquery should be (oid, g_det_count, g_dubious_count) for the oids that pass the constraints.\n\n3) Join the filtered detection stats back to the probability rows\n- INNER JOIN the per-object detection stats from step 2 with the probability rows from step 1 on oid.\n- This yields exactly the objects that meet the g-band detection criteria and have lc_classifier ranking = 1 probabilities.\n\n4) Select only the requested columns\n- Output columns:\n  - ZTF identifier: use probability.oid (rename/alias as needed for clarity)\n  - classifier version: probability.classifier_version\n  - class name: probability.class_name\n  - probability: probability.probability\n- Do not include any other columns.\n\n5) Order and limit the results\n- ORDER BY oid ASC (lexicographic ordering of the ZTF identifiers).\n- LIMIT 500 to return at most 500 objects.\n\n6) Additional implementation notes\n- fid mapping: ensure fid = 1 corresponds to the g band, as specified (1 = g; 2 = r; 3 = i).\n- The interpretation of \u201cno dubious corrections in that filter\u201d is implemented as \u201cno g-band detections with dubious = true.\u201d If a stricter interpretation is needed (e.g., also requiring corrected = true), adjust the detection filters accordingly. As stated, only dubious is enforced.\n- Ensure no other filters are applied to detection in WHERE other than via the inner join on oid; use aggregations with conditional counts instead of WHERE fid = 1 at the row level to keep the grouping centered on oid and to leverage the detection.oid index for the join.\n\nResult structure summary\n- FROM: probability (filtered to lc_classifier, ranking = 1), INNER JOIN with aggregated detection stats per oid (computed over joined subset).\n- WHERE/HAVING: enforce fid = 1 detection count >= 10 and zero dubious g-band detections.\n- SELECT: probability.oid, probability.classifier_version, probability.class_name, probability.probability\n- ORDER BY probability.oid ASC\n- LIMIT 500",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve at most 500 ZTF objects (ordered by oid) that:\n  - Have at least 10 detections in the g band (fid = 1).\n  - Have no dubious detections in the g band (dubious = false for all g-band detections).\n- Return columns: ZTF identifier (oid), classifier version, class name, probability.\n- Only include classification probabilities with ranking = 1 for the light curve classifier (classifier_name = 'lc_classifier').\n\nTables and columns involved\n- probability:\n  - oid (VARCHAR)\n  - class_name (VARCHAR)\n  - classifier_name (VARCHAR)\n  - classifier_version (VARCHAR)\n  - probability (DOUBLE PRECISION)\n  - ranking (INTEGER)\n- detection:\n  - oid (VARCHAR)\n  - fid (INTEGER; 1=g, 2=r, 3=i)\n  - dubious (BOOLEAN NOT NULL)\n  - Other columns exist but are not needed for the result.\n\nConstraints and defaults to enforce\n- probability.ranking = 1\n- probability.classifier_name = 'lc_classifier'\n- Detections requirement:\n  - g-band is fid = 1\n  - At least 10 detections in g band per object.\n  - No dubious detections in g band per object (i.e., count of g-band detections with dubious = true must be zero).\n- Ordering and limiting:\n  - ORDER BY oid ASC\n  - LIMIT 500\n\nPerformance considerations\n- The detection table is large and indexed on oid (ix_ndetection_oid). To avoid scanning the entire detection table, first restrict the set of oids using the probability table with the default conditions (ranking = 1 and classifier_name = 'lc_classifier'). Then aggregate detection rows only for that subset via an inner join on oid.\n- The probability table has useful indexes on ranking (including a partial index for ranking = 1) and probability, which will help pre-filtering.\n\nStep-by-step plan\n\n1) Build the base set of candidate objects from the probability table\n- Select the rows that correspond to the light curve classifier and only the top-ranked class per object:\n  - FROM probability p\n  - WHERE p.classifier_name = 'lc_classifier' AND p.ranking = 1\n- This produces one row per object (oid) with the most likely lc_classifier class, and includes the fields needed for the final output (class_name, classifier_version, probability).\n- This subquery will be used both to constrain detection aggregation and to provide the final output columns.\n\n2) Compute per-object g-band detection statistics restricted to the candidate set\n- Join detection to the candidate oid list from step 1 on detection.oid = p.oid to avoid scanning detections for objects not in the candidate set.\n- Group by detection.oid.\n- Compute:\n  - g_det_count = number of detections with fid = 1 (PostgreSQL COUNT(*) FILTER (WHERE d.fid = 1), or SUM(CASE WHEN d.fid = 1 THEN 1 ELSE 0 END))\n  - g_dubious_count = number of detections with fid = 1 AND dubious = true (COUNT(*) FILTER (WHERE d.fid = 1 AND d.dubious = true), or SUM(CASE WHEN d.fid = 1 AND d.dubious THEN 1 ELSE 0 END))\n- Apply HAVING conditions to enforce the user\u2019s requirements:\n  - g_det_count >= 10\n  - g_dubious_count = 0\n- The output of this subquery should be (oid, g_det_count, g_dubious_count) for the oids that pass the constraints.\n\n3) Join the filtered detection stats back to the probability rows\n- INNER JOIN the per-object detection stats from step 2 with the probability rows from step 1 on oid.\n- This yields exactly the objects that meet the g-band detection criteria and have lc_classifier ranking = 1 probabilities.\n\n4) Select only the requested columns\n- Output columns:\n  - ZTF identifier: use probability.oid (rename/alias as needed for clarity)\n  - classifier version: probability.classifier_version\n  - class name: probability.class_name\n  - probability: probability.probability\n- Do not include any other columns.\n\n5) Order and limit the results\n- ORDER BY oid ASC (lexicographic ordering of the ZTF identifiers).\n- LIMIT 500 to return at most 500 objects.\n\n6) Additional implementation notes\n- fid mapping: ensure fid = 1 corresponds to the g band, as specified (1 = g; 2 = r; 3 = i).\n- The interpretation of \u201cno dubious corrections in that filter\u201d is implemented as \u201cno g-band detections with dubious = true.\u201d If a stricter interpretation is needed (e.g., also requiring corrected = true), adjust the detection filters accordingly. As stated, only dubious is enforced.\n- Ensure no other filters are applied to detection in WHERE other than via the inner join on oid; use aggregations with conditional counts instead of WHERE fid = 1 at the row level to keep the grouping centered on oid and to leverage the detection.oid index for the join.\n\nResult structure summary\n- FROM: probability (filtered to lc_classifier, ranking = 1), INNER JOIN with aggregated detection stats per oid (computed over joined subset).\n- WHERE/HAVING: enforce fid = 1 detection count >= 10 and zero dubious g-band detections.\n- SELECT: probability.oid, probability.classifier_version, probability.class_name, probability.probability\n- ORDER BY probability.oid ASC\n- LIMIT 500"
                },
                "in_toks": 2849,
                "out_toks": 3547,
                "id": "chatcmpl-CZZp8EclthekjQoWukH73pDJrwkAO",
                "created": 1762595222,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 500 objects with >=10 g-band detections and no dubious g-band detections,\n-- returning oid, classifier_version, class_name, and probability for lc_classifier with ranking=1\nWITH lc_rank1 AS (\n    SELECT\n        p.oid,\n        p.class_name,\n        p.classifier_name,\n        p.classifier_version,\n        p.probability,\n        p.ranking\n    FROM probability p\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n),\ng_stats AS (\n    SELECT\n        d.oid,\n        COUNT(*) FILTER (WHERE d.fid = 1) AS g_det_count,\n        COUNT(*) FILTER (WHERE d.fid = 1 AND d.dubious) AS g_dubious_count\n    FROM detection d\n    INNER JOIN lc_rank1 p ON p.oid = d.oid\n    GROUP BY d.oid\n    HAVING COUNT(*) FILTER (WHERE d.fid = 1) >= 10\n       AND COUNT(*) FILTER (WHERE d.fid = 1 AND d.dubious) = 0\n)\nSELECT\n    p.oid,\n    p.classifier_version,\n    p.class_name,\n    p.probability\nFROM lc_rank1 p\nINNER JOIN g_stats g ON g.oid = p.oid\nORDER BY p.oid ASC\nLIMIT 500;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 500 objects with >=10 g-band detections and no dubious g-band detections,\n-- returning oid, classifier_version, class_name, and probability for lc_classifier with ranking=1\nWITH lc_rank1 AS (\n    SELECT\n        p.oid,\n        p.class_name,\n        p.classifier_name,\n        p.classifier_version,\n        p.probability,\n        p.ranking\n    FROM probability p\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n),\ng_stats AS (\n    SELECT\n        d.oid,\n        COUNT(*) FILTER (WHERE d.fid = 1) AS g_det_count,\n        COUNT(*) FILTER (WHERE d.fid = 1 AND d.dubious) AS g_dubious_count\n    FROM detection d\n    INNER JOIN lc_rank1 p ON p.oid = d.oid\n    GROUP BY d.oid\n    HAVING COUNT(*) FILTER (WHERE d.fid = 1) >= 10\n       AND COUNT(*) FILTER (WHERE d.fid = 1 AND d.dubious) = 0\n)\nSELECT\n    p.oid,\n    p.classifier_version,\n    p.class_name,\n    p.probability\nFROM lc_rank1 p\nINNER JOIN g_stats g ON g.oid = p.oid\nORDER BY p.oid ASC\nLIMIT 500;\n```"
                },
                "in_toks": 3230,
                "out_toks": 1328,
                "id": "chatcmpl-CZb1nmPt3wfyGL5ysiuaZlWQduL5c",
                "created": 1762599851,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "7": {
            "req_id": "92",
            "experiment_id": "run_7",
            "pred_tables": [
                "detection",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'probability', 'taxonomy']"
                },
                "in_toks": 653,
                "out_toks": 1940,
                "id": "chatcmpl-CZMjSFsRQazdsspQr3OoNQSaDdAxm",
                "created": 1762544898,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Step 1: Pre-filter to objects that have lc_classifier results with ranking=1 (adds selectivity)\nWITH base_oids AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier' -- condition 1 on probability\n\n     AND p.ranking = 1 -- condition 2 on probability\n\n     AND p.probability >= 0 -- condition 3 on probability (keeps it selective and valid)\n\n   GROUP BY p.oid), -- Step 2: From those objects, keep only the ones with at least 10 g-band detections and zero dubious in g\n-- Avoid filtering detection by any parameter other than oid in WHERE; use conditional aggregates instead\ng_ok AS\n  (SELECT d.oid\n   FROM detection d\n   INNER JOIN base_oids b ON b.oid = d.oid\n   GROUP BY d.oid\n   HAVING COUNT(*) FILTER (\n                           WHERE d.fid = 1) >= 10\n   AND COUNT(*) FILTER (\n                        WHERE d.fid = 1\n                          AND d.dubious) = 0), -- Step 3: Take at most 500 oids ordered by oid\ntop_oids AS\n  (SELECT oid\n   FROM g_ok\n   ORDER BY oid\n   LIMIT 500) -- Step 4: Return lc_classifier probabilities (ranking=1) for the selected objects\n\nSELECT p.oid, -- ZTF identifier\n p.classifier_version, -- classifier version\n p.class_name, -- class name\n p.probability -- probability\nFROM probability p\nINNER JOIN top_oids t ON t.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier' -- condition 1 on probability\n\n  AND p.ranking = 1 -- condition 2 on probability\n\n  AND p.probability >= 0 -- condition 3 on probability\nORDER BY p.oid,\n         p.classifier_version;",
            "sql_response": {
                "responses": {
                    "0": "-- Step 1: Pre-filter to objects that have lc_classifier results with ranking=1 (adds selectivity)\nWITH base_oids AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier' -- condition 1 on probability\n\n     AND p.ranking = 1 -- condition 2 on probability\n\n     AND p.probability >= 0 -- condition 3 on probability (keeps it selective and valid)\n\n   GROUP BY p.oid), -- Step 2: From those objects, keep only the ones with at least 10 g-band detections and zero dubious in g\n-- Avoid filtering detection by any parameter other than oid in WHERE; use conditional aggregates instead\ng_ok AS\n  (SELECT d.oid\n   FROM detection d\n   INNER JOIN base_oids b ON b.oid = d.oid\n   GROUP BY d.oid\n   HAVING COUNT(*) FILTER (\n                           WHERE d.fid = 1) >= 10\n   AND COUNT(*) FILTER (\n                        WHERE d.fid = 1\n                          AND d.dubious) = 0), -- Step 3: Take at most 500 oids ordered by oid\ntop_oids AS\n  (SELECT oid\n   FROM g_ok\n   ORDER BY oid\n   LIMIT 500) -- Step 4: Return lc_classifier probabilities (ranking=1) for the selected objects\n\nSELECT p.oid, -- ZTF identifier\n p.classifier_version, -- classifier version\n p.class_name, -- class name\n p.probability -- probability\nFROM probability p\nINNER JOIN top_oids t ON t.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier' -- condition 1 on probability\n\n  AND p.ranking = 1 -- condition 2 on probability\n\n  AND p.probability >= 0 -- condition 3 on probability\nORDER BY p.oid,\n         p.classifier_version;"
                },
                "in_toks": 1803,
                "out_toks": 2667,
                "id": "chatcmpl-CbHEYA5qRVWi8ZOshzWCxpylZR9VD",
                "created": 1763000418,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1241,
                "out_toks": 911,
                "id": "chatcmpl-CZYUrr9I7eHReKeWZDDeDqwiHkaCl",
                "created": 1762590121,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 2849,
                "out_toks": 4000,
                "id": "chatcmpl-CZZsqg2xwGHrpO6QZWyWrlRvJpc0b",
                "created": 1762595452,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 500 ZTF objects (ordered by oid) with at least 10 g-band detections\n-- and zero dubious detections in g, then return their top lc_classifier probabilities.\nWITH g_candidates AS (\n    SELECT\n        d.oid\n    FROM detection d\n    WHERE d.fid = 1  -- g band\n    GROUP BY d.oid\n    HAVING COUNT(*) >= 10\n       AND SUM(CASE WHEN d.dubious THEN 1 ELSE 0 END) = 0  -- no dubious in g\n),\ntop_oids AS (\n    SELECT oid\n    FROM g_candidates\n    ORDER BY oid\n    LIMIT 500\n)\nSELECT\n    p.oid,                 -- ZTF identifier\n    p.classifier_version,  -- classifier version\n    p.class_name,          -- class name\n    p.probability          -- probability\nFROM probability p\nINNER JOIN top_oids t ON p.oid = t.oid\nWHERE p.ranking = 1\n  AND p.classifier_name = 'lc_classifier'\nORDER BY p.oid, p.classifier_version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 500 ZTF objects (ordered by oid) with at least 10 g-band detections\n-- and zero dubious detections in g, then return their top lc_classifier probabilities.\nWITH g_candidates AS (\n    SELECT\n        d.oid\n    FROM detection d\n    WHERE d.fid = 1  -- g band\n    GROUP BY d.oid\n    HAVING COUNT(*) >= 10\n       AND SUM(CASE WHEN d.dubious THEN 1 ELSE 0 END) = 0  -- no dubious in g\n),\ntop_oids AS (\n    SELECT oid\n    FROM g_candidates\n    ORDER BY oid\n    LIMIT 500\n)\nSELECT\n    p.oid,                 -- ZTF identifier\n    p.classifier_version,  -- classifier version\n    p.class_name,          -- class name\n    p.probability          -- probability\nFROM probability p\nINNER JOIN top_oids t ON p.oid = t.oid\nWHERE p.ranking = 1\n  AND p.classifier_name = 'lc_classifier'\nORDER BY p.oid, p.classifier_version;\n```"
                },
                "in_toks": 3041,
                "out_toks": 2551,
                "id": "chatcmpl-CZaze2lvwD8TG8B3Vj232QKqNnpTy",
                "created": 1762599718,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "8": {
            "req_id": "92",
            "experiment_id": "run_8",
            "pred_tables": [
                "detection",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'probability', 'taxonomy']"
                },
                "in_toks": 653,
                "out_toks": 1428,
                "id": "chatcmpl-CZMk7Sn4DdYKWq31qZdUyZV6tRTcw",
                "created": 1762544939,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query: start from probability (selective), then per-oid summarize detections via LATERAL using only oid in WHERE.\n-- This avoids full-table scans on detection filtered by other columns and stops early after 500 ordered oids.\n WITH p AS\n  (SELECT pr.oid,\n          pr.classifier_version,\n          pr.class_name,\n          pr.probability\n   FROM probability pr\n   WHERE pr.classifier_name = 'lc_classifier' -- light curve classifier\n\n     AND pr.ranking = 1 -- only top-ranked class\n\n     AND pr.probability > 0 -- additional selectivity\n)\nSELECT p.oid,\n       p.classifier_version,\n       p.class_name,\n       p.probability\nFROM p\nJOIN LATERAL\n  (SELECT COUNT(*) FILTER (\n                           WHERE d.fid = 1) AS g_cnt,\n          BOOL_AND(CASE\n                       WHEN d.fid = 1 THEN NOT d.dubious\n                       ELSE TRUE\n                   END) AS g_no_dubious\n   FROM detection d\n   WHERE d.oid = p.oid -- only filter detection by oid for performance\n) g ON g.g_cnt >= 10\nAND g.g_no_dubious\nORDER BY p.oid\nLIMIT 500;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query: start from probability (selective), then per-oid summarize detections via LATERAL using only oid in WHERE.\n-- This avoids full-table scans on detection filtered by other columns and stops early after 500 ordered oids.\n WITH p AS\n  (SELECT pr.oid,\n          pr.classifier_version,\n          pr.class_name,\n          pr.probability\n   FROM probability pr\n   WHERE pr.classifier_name = 'lc_classifier' -- light curve classifier\n\n     AND pr.ranking = 1 -- only top-ranked class\n\n     AND pr.probability > 0 -- additional selectivity\n)\nSELECT p.oid,\n       p.classifier_version,\n       p.class_name,\n       p.probability\nFROM p\nJOIN LATERAL\n  (SELECT COUNT(*) FILTER (\n                           WHERE d.fid = 1) AS g_cnt,\n          BOOL_AND(CASE\n                       WHEN d.fid = 1 THEN NOT d.dubious\n                       ELSE TRUE\n                   END) AS g_no_dubious\n   FROM detection d\n   WHERE d.oid = p.oid -- only filter detection by oid for performance\n) g ON g.g_cnt >= 10\nAND g.g_no_dubious\nORDER BY p.oid\nLIMIT 500;"
                },
                "in_toks": 1749,
                "out_toks": 4498,
                "id": "chatcmpl-CbHFEd7vXNRY5Z7iGllWiCq7Bct8I",
                "created": 1763000460,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1241,
                "out_toks": 1359,
                "id": "chatcmpl-CZYVE2H7xTqLK8gXqrQYMQNBv0T9b",
                "created": 1762590144,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 2849,
                "out_toks": 4000,
                "id": "chatcmpl-CZZeB7KmgBObjgdeihvpbZqR8G4uH",
                "created": 1762594543,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 500 ZTF objects with at least 10 g-band detections and no dubious g-band detections,\n-- returning oid, classifier_version, class_name, and probability for the lc_classifier with ranking=1.\nWITH g_ok AS (\n    SELECT d.oid\n    FROM detection d\n    WHERE d.fid = 1 -- g band\n    GROUP BY d.oid\n    HAVING COUNT(*) >= 10\n       AND SUM(CASE WHEN d.dubious THEN 1 ELSE 0 END) = 0 -- no dubious detections in g\n)\nSELECT o.oid, p.classifier_version, p.class_name, p.probability\nFROM g_ok g\nINNER JOIN object o ON o.oid = g.oid\nINNER JOIN probability p ON p.oid = o.oid\nWHERE p.ranking = 1\n  AND p.classifier_name = 'lc_classifier'\nORDER BY o.oid\nLIMIT 500;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 500 ZTF objects with at least 10 g-band detections and no dubious g-band detections,\n-- returning oid, classifier_version, class_name, and probability for the lc_classifier with ranking=1.\nWITH g_ok AS (\n    SELECT d.oid\n    FROM detection d\n    WHERE d.fid = 1 -- g band\n    GROUP BY d.oid\n    HAVING COUNT(*) >= 10\n       AND SUM(CASE WHEN d.dubious THEN 1 ELSE 0 END) = 0 -- no dubious detections in g\n)\nSELECT o.oid, p.classifier_version, p.class_name, p.probability\nFROM g_ok g\nINNER JOIN object o ON o.oid = g.oid\nINNER JOIN probability p ON p.oid = o.oid\nWHERE p.ranking = 1\n  AND p.classifier_name = 'lc_classifier'\nORDER BY o.oid\nLIMIT 500;\n```"
                },
                "in_toks": 3041,
                "out_toks": 2709,
                "id": "chatcmpl-CZazKf4rAyNkkqGGiXn20HQLBUFrf",
                "created": 1762599698,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "9": {
            "req_id": "92",
            "experiment_id": "run_9",
            "pred_tables": [
                "magstat",
                "dataquality",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat', 'dataquality', 'probability']"
                },
                "in_toks": 653,
                "out_toks": 2069,
                "id": "chatcmpl-CZMkewkXD2jL39PtUI1Vr5CiwRZaZ",
                "created": 1762544972,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 2162,
                "out_toks": 527,
                "id": "chatcmpl-CZYVgYWqVHo6sx1xV7Dq1dSHQYcGM",
                "created": 1762590172,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n/* Select up to 500 ZTF objects (by oid) with at least 10 detections in g-band (fid=1) and no dubious points (ndubious=0) */\nWITH selected_oids AS (\n    SELECT DISTINCT m.oid\n    FROM magstat m\n    WHERE m.fid = 1\n      AND m.ndet >= 10\n      AND m.ndubious = 0\n    ORDER BY m.oid\n    LIMIT 500\n)\nSELECT\n    p.oid,                -- ZTF identifier\n    p.classifier_version, -- classifier version\n    p.class_name,         -- class name\n    p.probability         -- probability\nFROM probability p\nINNER JOIN selected_oids so\n    ON so.oid = p.oid\nWHERE p.ranking = 1\n  AND p.classifier_name = 'lc_classifier'\nORDER BY p.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* Select up to 500 ZTF objects (by oid) with at least 10 detections in g-band (fid=1) and no dubious points (ndubious=0) */\nWITH selected_oids AS (\n    SELECT DISTINCT m.oid\n    FROM magstat m\n    WHERE m.fid = 1\n      AND m.ndet >= 10\n      AND m.ndubious = 0\n    ORDER BY m.oid\n    LIMIT 500\n)\nSELECT\n    p.oid,                -- ZTF identifier\n    p.classifier_version, -- classifier version\n    p.class_name,         -- class name\n    p.probability         -- probability\nFROM probability p\nINNER JOIN selected_oids so\n    ON so.oid = p.oid\nWHERE p.ranking = 1\n  AND p.classifier_name = 'lc_classifier'\nORDER BY p.oid;\n```"
                },
                "in_toks": 3480,
                "out_toks": 2633,
                "id": "chatcmpl-CZZrcmQkNbRqdUfaomJ4JHLKQMHqm",
                "created": 1762595376,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "102": {
        "0": {
            "req_id": "102",
            "experiment_id": "run_0",
            "pred_tables": [
                "probability",
                "taxonomy",
                "allwise",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'allwise', 'magstat']",
                    "1": "['probability', 'allwise', 'magstat', 'taxonomy']"
                },
                "in_toks": 644,
                "out_toks": 3184,
                "id": "chatcmpl-CSnX3KbtvNUUDP0hdZ9lBjFfmn4dw",
                "created": 1760979621,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return all magstat rows for up to 50 ZTF objects that:\n-- (1) have lc_classifier top-ranked class AGN with probability > 0.6, and\n-- (2) have WISE W1 magnitude (w1mpro) between 12 and 13.\n-- Note: W1 magnitude is stored in the allwise table as w1mpro (not in magstat).\nWITH selected_oids AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   JOIN allwise aw ON aw.oid_catalog = p.oid -- join to access W1 magnitude; adjust join if a dedicated xmatch table is required\n\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6\n     AND aw.w1mpro BETWEEN 12 AND 13\n   LIMIT 50 -- limit to at most 50 objects\n)\nSELECT ms.*\nFROM magstat ms\nJOIN selected_oids so ON so.oid = ms.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Return all magstat rows for up to 50 ZTF objects that:\n-- (1) have lc_classifier top-ranked class AGN with probability > 0.6, and\n-- (2) have WISE W1 magnitude (w1mpro) between 12 and 13.\n-- Note: W1 magnitude is stored in the allwise table as w1mpro (not in magstat).\nWITH selected_oids AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   JOIN allwise aw ON aw.oid_catalog = p.oid -- join to access W1 magnitude; adjust join if a dedicated xmatch table is required\n\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6\n     AND aw.w1mpro BETWEEN 12 AND 13\n   LIMIT 50 -- limit to at most 50 objects\n)\nSELECT ms.*\nFROM magstat ms\nJOIN selected_oids so ON so.oid = ms.oid;"
                },
                "in_toks": 2449,
                "out_toks": 2546,
                "id": "chatcmpl-CbHG51aFopd95NHFW3RtuRTtDbwnm",
                "created": 1763000513,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2100,
                "out_toks": 1295,
                "id": "chatcmpl-CSnmIIeBqrhxiujrBjjMLTmjfRsYG",
                "created": 1760980566,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3979,
                "out_toks": 4000,
                "id": "chatcmpl-CSqsKmUn9r909twtxmpw3xgvibbjg",
                "created": 1760992472,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 50 objects whose most likely lc_classifier class is AGN with probability > 0.6\n-- and with WISE W1 magnitude between 12 and 13.\n-- Returns all columns from the 'magstat' table.\nSELECT\n    ms.*\nFROM\n    magstat ms\nWHERE\n    ms.oid IN (\n        SELECT DISTINCT p.oid\n        FROM probability p\n        WHERE\n            p.classifier_name = 'lc_classifier'  -- default classifier\n            AND p.ranking = 1                     -- only the top-ranked class per classifier/version\n            AND p.class_name = 'AGN'\n            AND p.probability > 0.6\n    )\n    AND ms.w1 BETWEEN 12 AND 13  -- adjust column name if W1 magnitude is named differently (e.g., w1mpro)\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 50 objects whose most likely lc_classifier class is AGN with probability > 0.6\n-- and with WISE W1 magnitude between 12 and 13.\n-- Returns all columns from the 'magstat' table.\nSELECT\n    ms.*\nFROM\n    magstat ms\nWHERE\n    ms.oid IN (\n        SELECT DISTINCT p.oid\n        FROM probability p\n        WHERE\n            p.classifier_name = 'lc_classifier'  -- default classifier\n            AND p.ranking = 1                     -- only the top-ranked class per classifier/version\n            AND p.class_name = 'AGN'\n            AND p.probability > 0.6\n    )\n    AND ms.w1 BETWEEN 12 AND 13  -- adjust column name if W1 magnitude is named differently (e.g., w1mpro)\nLIMIT 50;\n```"
                },
                "in_toks": 3032,
                "out_toks": 2688,
                "id": "chatcmpl-CSr7Cpo6ApMvuE40inTLGau3Edb7y",
                "created": 1760993394,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "1": {
            "req_id": "102",
            "experiment_id": "run_1",
            "pred_tables": [
                "probability",
                "allwise",
                "magstat",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'allwise', 'magstat']",
                    "1": "['probability', 'allwise', 'magstat', 'taxonomy']"
                },
                "in_toks": 644,
                "out_toks": 3184,
                "id": "chatcmpl-CSnX3KbtvNUUDP0hdZ9lBjFfmn4dw",
                "created": 1760979621,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return all columns from magstat for up to 50 objects that:\n-- (1) have lc_classifier class 'AGN' with probability > 0.6, and\n-- (2) have WISE W1 magnitude between 12 and 13.\n-- Note: Use the correct table names (magstat, allwise). W1 magnitude is in allwise.\nWITH selected_oids AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   JOIN allwise aw ON aw.oid_catalog = p.oid -- common-sense join to apply W1 filter\n\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6\n     AND aw.w1mpro BETWEEN 12 AND 13\n   LIMIT 50)\nSELECT ms.*\nFROM magstat ms\nJOIN selected_oids so ON so.oid = ms.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Return all columns from magstat for up to 50 objects that:\n-- (1) have lc_classifier class 'AGN' with probability > 0.6, and\n-- (2) have WISE W1 magnitude between 12 and 13.\n-- Note: Use the correct table names (magstat, allwise). W1 magnitude is in allwise.\nWITH selected_oids AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   JOIN allwise aw ON aw.oid_catalog = p.oid -- common-sense join to apply W1 filter\n\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6\n     AND aw.w1mpro BETWEEN 12 AND 13\n   LIMIT 50)\nSELECT ms.*\nFROM magstat ms\nJOIN selected_oids so ON so.oid = ms.oid;"
                },
                "in_toks": 2453,
                "out_toks": 2059,
                "id": "chatcmpl-CbHGXdLW9B633NMwrf2EA9W2lLtvw",
                "created": 1763000541,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2100,
                "out_toks": 1679,
                "id": "chatcmpl-CSnmZAThfRfCFKhTHhsBochTHkjjL",
                "created": 1760980583,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3979,
                "out_toks": 4000,
                "id": "chatcmpl-CSqs2dH4prAxCB7iR8Y2bbTCAbuPa",
                "created": 1760992454,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all columns from magstats for up to 50 objects that:\n-- (1) have lc_classifier rank-1 class 'AGN' with probability > 0.6, and\n-- (2) have WISE W1 magnitude between 12 and 13.\nWITH selected_oids AS (\n  SELECT p.oid\n  FROM probability p\n  INNER JOIN magstats ms ON ms.oid = p.oid\n  WHERE p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.class_name = 'AGN'\n    AND p.probability > 0.6\n    AND ms.w1mpro BETWEEN 12 AND 13\n  GROUP BY p.oid\n  LIMIT 50\n)\nSELECT ms.*\nFROM magstats ms\nINNER JOIN selected_oids so ON so.oid = ms.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from magstats for up to 50 objects that:\n-- (1) have lc_classifier rank-1 class 'AGN' with probability > 0.6, and\n-- (2) have WISE W1 magnitude between 12 and 13.\nWITH selected_oids AS (\n  SELECT p.oid\n  FROM probability p\n  INNER JOIN magstats ms ON ms.oid = p.oid\n  WHERE p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.class_name = 'AGN'\n    AND p.probability > 0.6\n    AND ms.w1mpro BETWEEN 12 AND 13\n  GROUP BY p.oid\n  LIMIT 50\n)\nSELECT ms.*\nFROM magstats ms\nINNER JOIN selected_oids so ON so.oid = ms.oid;\n```"
                },
                "in_toks": 3032,
                "out_toks": 3264,
                "id": "chatcmpl-CSr78ub1PAhHVmzSNrItHKNbcnE4W",
                "created": 1760993390,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "2": {
            "req_id": "102",
            "experiment_id": "run_2",
            "pred_tables": [
                "magstat",
                "probability",
                "taxonomy",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat', 'probability', 'taxonomy', 'allwise']"
                },
                "in_toks": 644,
                "out_toks": 920,
                "id": "chatcmpl-CSsidU3nIW0bQHQl1RfFrsAcYXP2X",
                "created": 1760999559,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return all magstat rows for up to 50 objects with lc_classifier AGN probability > 0.6\n-- and AllWISE W1 magnitude between 12 and 13.\n-- Fixes:\n--  - Use 'magstat' (singular) instead of non-existent 'magstats'.\n--  - Use 'allwise' instead of non-existent 'xmatch_allwise'.\n--  - Do not require ranking=1 (not requested).\n-- Note: This assumes the ZTF oid matches allwise.oid_catalog. If a crossmatch table is required in your setup,\n--       replace the JOIN condition accordingly.\nWITH ranked AS\n  (SELECT p.oid,\n          MAX(p.probability) AS prob\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n   GROUP BY p.oid),\n     selected AS\n  (SELECT r.oid\n   FROM ranked r\n   INNER JOIN allwise w ON w.oid_catalog = r.oid\n   WHERE r.prob > 0.6\n     AND w.w1mpro BETWEEN 12 AND 13\n   ORDER BY r.prob DESC\n   LIMIT 50)\nSELECT m.*\nFROM magstat m\nINNER JOIN selected s ON s.oid = m.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Return all magstat rows for up to 50 objects with lc_classifier AGN probability > 0.6\n-- and AllWISE W1 magnitude between 12 and 13.\n-- Fixes:\n--  - Use 'magstat' (singular) instead of non-existent 'magstats'.\n--  - Use 'allwise' instead of non-existent 'xmatch_allwise'.\n--  - Do not require ranking=1 (not requested).\n-- Note: This assumes the ZTF oid matches allwise.oid_catalog. If a crossmatch table is required in your setup,\n--       replace the JOIN condition accordingly.\nWITH ranked AS\n  (SELECT p.oid,\n          MAX(p.probability) AS prob\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n   GROUP BY p.oid),\n     selected AS\n  (SELECT r.oid\n   FROM ranked r\n   INNER JOIN allwise w ON w.oid_catalog = r.oid\n   WHERE r.prob > 0.6\n     AND w.w1mpro BETWEEN 12 AND 13\n   ORDER BY r.prob DESC\n   LIMIT 50)\nSELECT m.*\nFROM magstat m\nINNER JOIN selected s ON s.oid = m.oid;"
                },
                "in_toks": 2581,
                "out_toks": 2775,
                "id": "chatcmpl-CbHGsYFuzuKUn6heiqpQ2kTP4rLrd",
                "created": 1763000562,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2100,
                "out_toks": 719,
                "id": "chatcmpl-CSxXmKdXxnQsIQ3sZ3z46lunc5s1p",
                "created": 1761018106,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3979,
                "out_toks": 4000,
                "id": "chatcmpl-CSxj01z9kn7xXlKABuDx5qkX4v3lv",
                "created": 1761018802,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 50 oids with lc_classifier rank-1 AGN probability > 0.6 and WISE W1 in [12,13],\n-- then return all columns from the magstats table for those oids.\n-- Note: Assuming the table with per-object magnitude statistics is named 'magstats' (plural).\n--       If your schema uses 'magstat' (singular), replace 'magstats' accordingly.\n-- Note: Assuming AllWISE crossmatch table is 'xmatch_allwise' with W1 magnitude column 'w1mpro'.\nWITH selected AS (\n    SELECT p.oid\n    FROM probability p\n    INNER JOIN xmatch_allwise w ON w.oid = p.oid\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n      AND p.class_name = 'AGN'\n      AND p.probability > 0.6\n      AND w.w1mpro BETWEEN 12 AND 13\n    ORDER BY p.probability DESC\n    LIMIT 50\n)\nSELECT m.*\nFROM magstats m\nINNER JOIN selected s ON s.oid = m.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 50 oids with lc_classifier rank-1 AGN probability > 0.6 and WISE W1 in [12,13],\n-- then return all columns from the magstats table for those oids.\n-- Note: Assuming the table with per-object magnitude statistics is named 'magstats' (plural).\n--       If your schema uses 'magstat' (singular), replace 'magstats' accordingly.\n-- Note: Assuming AllWISE crossmatch table is 'xmatch_allwise' with W1 magnitude column 'w1mpro'.\nWITH selected AS (\n    SELECT p.oid\n    FROM probability p\n    INNER JOIN xmatch_allwise w ON w.oid = p.oid\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n      AND p.class_name = 'AGN'\n      AND p.probability > 0.6\n      AND w.w1mpro BETWEEN 12 AND 13\n    ORDER BY p.probability DESC\n    LIMIT 50\n)\nSELECT m.*\nFROM magstats m\nINNER JOIN selected s ON s.oid = m.oid;\n```"
                },
                "in_toks": 3032,
                "out_toks": 3132,
                "id": "chatcmpl-CSyMMPLuoRhVuWT0dEi2dAUxaT0RP",
                "created": 1761021242,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "3": {
            "req_id": "102",
            "experiment_id": "run_3",
            "pred_tables": [
                "probability",
                "allwise",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'allwise', 'magstat']"
                },
                "in_toks": 644,
                "out_toks": 789,
                "id": "chatcmpl-CSsipbwqWYg9BJxseNk82WAmOB8Wh",
                "created": 1760999571,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Fix: use WISE W1 magnitude from the allwise table (w1mpro) instead of the non-existent m.w1\n-- Join magstat to probability on oid, and to allwise on the catalog identifier to filter by W1 magnitude\n-- Return all magstat columns for ZTF objects with lc_classifier rank-1 AGN probability > 0.6 and W1 between 12 and 13\n\nSELECT m.*\nFROM magstat AS m\nINNER JOIN probability AS p ON p.oid = m.oid\nINNER JOIN allwise AS a ON a.oid_catalog = m.oid -- In the full schema, this join typically goes via an xmatch table\n\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n  AND p.class_name = 'AGN'\n  AND p.probability > 0.6\n  AND a.w1mpro BETWEEN 12 AND 13\nLIMIT 50;",
            "sql_response": {
                "responses": {
                    "0": "-- Fix: use WISE W1 magnitude from the allwise table (w1mpro) instead of the non-existent m.w1\n-- Join magstat to probability on oid, and to allwise on the catalog identifier to filter by W1 magnitude\n-- Return all magstat columns for ZTF objects with lc_classifier rank-1 AGN probability > 0.6 and W1 between 12 and 13\n\nSELECT m.*\nFROM magstat AS m\nINNER JOIN probability AS p ON p.oid = m.oid\nINNER JOIN allwise AS a ON a.oid_catalog = m.oid -- In the full schema, this join typically goes via an xmatch table\n\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n  AND p.class_name = 'AGN'\n  AND p.probability > 0.6\n  AND a.w1mpro BETWEEN 12 AND 13\nLIMIT 50;"
                },
                "in_toks": 2356,
                "out_toks": 1439,
                "id": "chatcmpl-CbHHID3EUAWnT5IiDry1g7cHhcJn0",
                "created": 1763000588,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2055,
                "out_toks": 1359,
                "id": "chatcmpl-CSxXxTeR6DyXr9iUAfMbkpdOajlsK",
                "created": 1761018117,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3934,
                "out_toks": 4000,
                "id": "chatcmpl-CSxjl83fJQCkvzcvPFUjWMs3EOTgP",
                "created": 1761018849,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Returns up to 50 objects with lc_classifier rank-1 AGN probability > 0.6\n-- and WISE W1 magnitude between 12 and 13.\n-- NOTE: Adjust m.w1 to the correct W1 magnitude column name if different (e.g., w1mpro).\nSELECT\n    m.*\nFROM\n    magstat AS m\nINNER JOIN\n    probability AS p\n    ON p.oid = m.oid\nWHERE\n    p.classifier_name = 'lc_classifier'   -- default classifier\n    AND p.ranking = 1                      -- only the most likely class\n    AND p.class_name = 'AGN'\n    AND p.probability > 0.6\n    AND m.w1 BETWEEN 12 AND 13\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Returns up to 50 objects with lc_classifier rank-1 AGN probability > 0.6\n-- and WISE W1 magnitude between 12 and 13.\n-- NOTE: Adjust m.w1 to the correct W1 magnitude column name if different (e.g., w1mpro).\nSELECT\n    m.*\nFROM\n    magstat AS m\nINNER JOIN\n    probability AS p\n    ON p.oid = m.oid\nWHERE\n    p.classifier_name = 'lc_classifier'   -- default classifier\n    AND p.ranking = 1                      -- only the most likely class\n    AND p.class_name = 'AGN'\n    AND p.probability > 0.6\n    AND m.w1 BETWEEN 12 AND 13\nLIMIT 50;\n```"
                },
                "in_toks": 3032,
                "out_toks": 1968,
                "id": "chatcmpl-CSyN0XkvmdHwZwCAoZWlVwAyfR4b2",
                "created": 1761021282,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "4": {
            "req_id": "102",
            "experiment_id": "run_4",
            "pred_tables": [
                "magstat",
                "probability",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat', 'probability', 'allwise']"
                },
                "in_toks": 644,
                "out_toks": 789,
                "id": "chatcmpl-CSsizaq26Am4ca5ViuIgzgrfp87lj",
                "created": 1760999581,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Corrected query:\n-- - Use the correct table name 'magstat' (not 'magstats').\n-- - WISE W1 magnitude comes from the 'allwise' table as 'w1mpro'.\n-- - Select up to 50 distinct objects (oids) matching the conditions, then\n--   return all magstat rows for those objects.\nWITH target_oids AS\n  (SELECT DISTINCT p.oid\n   FROM probability AS p\n   INNER JOIN allwise AS aw ON aw.oid_catalog = p.oid -- assuming oid matches oid_catalog for crossmatch\n\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6\n     AND aw.w1mpro BETWEEN 12 AND 13\n   LIMIT 50)\nSELECT ms.*\nFROM magstat AS ms\nINNER JOIN target_oids AS t ON t.oid = ms.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Corrected query:\n-- - Use the correct table name 'magstat' (not 'magstats').\n-- - WISE W1 magnitude comes from the 'allwise' table as 'w1mpro'.\n-- - Select up to 50 distinct objects (oids) matching the conditions, then\n--   return all magstat rows for those objects.\nWITH target_oids AS\n  (SELECT DISTINCT p.oid\n   FROM probability AS p\n   INNER JOIN allwise AS aw ON aw.oid_catalog = p.oid -- assuming oid matches oid_catalog for crossmatch\n\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6\n     AND aw.w1mpro BETWEEN 12 AND 13\n   LIMIT 50)\nSELECT ms.*\nFROM magstat AS ms\nINNER JOIN target_oids AS t ON t.oid = ms.oid;"
                },
                "in_toks": 2377,
                "out_toks": 2129,
                "id": "chatcmpl-CbHHXlnldU28xOjAVQeBR22BaSEH3",
                "created": 1763000603,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2055,
                "out_toks": 527,
                "id": "chatcmpl-CSxYCAjwcZtuighIblSOVkwAYec0T",
                "created": 1761018132,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3934,
                "out_toks": 4000,
                "id": "chatcmpl-CSxkMUcaYEldZkcMKtdCrvBVRhAin",
                "created": 1761018886,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 50 objects with rank-1 AGN classification by the lc_classifier,\n-- probability > 0.6, and WISE W1 magnitude between 12 and 13.\n-- Assumes a table named 'magstats' with columns 'oid' and 'w1'.\nSELECT DISTINCT ms.*\nFROM magstats AS ms\nINNER JOIN probability AS p\n  ON p.oid = ms.oid\nWHERE p.classifier_name = 'lc_classifier'  -- default classifier as requested\n  AND p.ranking = 1                        -- use only top-ranked class per object\n  AND p.class_name = 'AGN'                 -- AGN class\n  AND p.probability > 0.6                  -- probability threshold\n  AND ms.w1 BETWEEN 12 AND 13              -- WISE W1 magnitude constraint\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 50 objects with rank-1 AGN classification by the lc_classifier,\n-- probability > 0.6, and WISE W1 magnitude between 12 and 13.\n-- Assumes a table named 'magstats' with columns 'oid' and 'w1'.\nSELECT DISTINCT ms.*\nFROM magstats AS ms\nINNER JOIN probability AS p\n  ON p.oid = ms.oid\nWHERE p.classifier_name = 'lc_classifier'  -- default classifier as requested\n  AND p.ranking = 1                        -- use only top-ranked class per object\n  AND p.class_name = 'AGN'                 -- AGN class\n  AND p.probability > 0.6                  -- probability threshold\n  AND ms.w1 BETWEEN 12 AND 13              -- WISE W1 magnitude constraint\nLIMIT 50;\n```"
                },
                "in_toks": 3032,
                "out_toks": 2685,
                "id": "chatcmpl-CSyNJj9bLZi6zgYvUNQARyTNydmwA",
                "created": 1761021301,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "5": {
            "req_id": "102",
            "experiment_id": "run_5",
            "pred_tables": [
                "probability",
                "taxonomy",
                "allwise",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'allwise', 'magstat']"
                },
                "in_toks": 644,
                "out_toks": 920,
                "id": "chatcmpl-CZMlSUFwW3Yg7L1IKimlBLkm9CDIS",
                "created": 1762545022,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Corrected query:\n-- - Use the correct table name 'magstat' (not 'magstats').\n-- - WISE W1 magnitude comes from the 'allwise' table ('w1mpro'), not from 'magstat'.\n-- - No need to require ranking = 1 (not requested).\n-- - Select up to 50 DISTINCT objects (by oid) that satisfy the conditions, then return all magstat rows for those objects.\nWITH candidate_probs AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability AS p\n   JOIN allwise AS aw ON aw.oid_catalog = p.oid -- assumed cross-match key to ZTF oid\n\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6\n     AND aw.w1mpro BETWEEN 12 AND 13),\n     top_oids AS\n  (SELECT oid,\n          MAX(probability) AS max_prob\n   FROM candidate_probs\n   GROUP BY oid\n   ORDER BY MAX(probability) DESC\n   LIMIT 50)\nSELECT ms.*\nFROM magstat AS ms\nJOIN top_oids AS t ON t.oid = ms.oid\nORDER BY t.max_prob DESC,\n         ms.oid,\n         ms.fid;",
            "sql_response": {
                "responses": {
                    "0": "-- Corrected query:\n-- - Use the correct table name 'magstat' (not 'magstats').\n-- - WISE W1 magnitude comes from the 'allwise' table ('w1mpro'), not from 'magstat'.\n-- - No need to require ranking = 1 (not requested).\n-- - Select up to 50 DISTINCT objects (by oid) that satisfy the conditions, then return all magstat rows for those objects.\nWITH candidate_probs AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability AS p\n   JOIN allwise AS aw ON aw.oid_catalog = p.oid -- assumed cross-match key to ZTF oid\n\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6\n     AND aw.w1mpro BETWEEN 12 AND 13),\n     top_oids AS\n  (SELECT oid,\n          MAX(probability) AS max_prob\n   FROM candidate_probs\n   GROUP BY oid\n   ORDER BY MAX(probability) DESC\n   LIMIT 50)\nSELECT ms.*\nFROM magstat AS ms\nJOIN top_oids AS t ON t.oid = ms.oid\nORDER BY t.max_prob DESC,\n         ms.oid,\n         ms.fid;"
                },
                "in_toks": 2403,
                "out_toks": 3490,
                "id": "chatcmpl-CbHHsPa3bBh5lwr1BJclhvZb7Sm7L",
                "created": 1763000624,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2100,
                "out_toks": 783,
                "id": "chatcmpl-CZYVq7mzeiApx0YNHFnuYC0F0o3LI",
                "created": 1762590182,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3979,
                "out_toks": 4000,
                "id": "chatcmpl-CZZtNxIJ6c8gIuVxgVeIb7oo3s2aY",
                "created": 1762595485,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 50 objects with lc_classifier rank-1 AGN probability > 0.6\n-- and WISE W1 magnitude between 12 and 13.\n-- Assumes the time-independent stats table is named 'magstats' and the W1 column is 'w1mag'.\nSELECT\n    ms.*\nFROM\n    magstats AS ms\nINNER JOIN\n    probability AS p\n    ON p.oid = ms.oid\nWHERE\n    p.classifier_name = 'lc_classifier'  -- default condition\n    AND p.ranking = 1                    -- default condition\n    AND p.class_name = 'AGN'\n    AND p.probability > 0.6\n    AND ms.w1mag BETWEEN 12 AND 13\nORDER BY\n    p.probability DESC\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 50 objects with lc_classifier rank-1 AGN probability > 0.6\n-- and WISE W1 magnitude between 12 and 13.\n-- Assumes the time-independent stats table is named 'magstats' and the W1 column is 'w1mag'.\nSELECT\n    ms.*\nFROM\n    magstats AS ms\nINNER JOIN\n    probability AS p\n    ON p.oid = ms.oid\nWHERE\n    p.classifier_name = 'lc_classifier'  -- default condition\n    AND p.ranking = 1                    -- default condition\n    AND p.class_name = 'AGN'\n    AND p.probability > 0.6\n    AND ms.w1mag BETWEEN 12 AND 13\nORDER BY\n    p.probability DESC\nLIMIT 50;\n```"
                },
                "in_toks": 3032,
                "out_toks": 2423,
                "id": "chatcmpl-CZb0YWx4195IVBtAKhkk3FlZpTlcX",
                "created": 1762599774,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "6": {
            "req_id": "102",
            "experiment_id": "run_6",
            "pred_tables": [
                "magstat",
                "probability",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat', 'probability', 'allwise']"
                },
                "in_toks": 644,
                "out_toks": 1365,
                "id": "chatcmpl-CZMlnvOkxOr1pnnp1HguUjqH590rh",
                "created": 1762545043,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return all columns from the magstat table for up to 50 objects\n-- satisfying: lc_classifier rank-1 AGN with probability > 0.6\n-- and WISE W1 magnitude (allwise.w1mpro) between 12 and 13.\n-- Note: Correct table name is magstat (not magstats).\nWITH selected_oids AS\n  (SELECT p.oid\n   FROM probability p\n   JOIN allwise aw ON aw.oid_catalog = p.oid\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6\n     AND aw.w1mpro BETWEEN 12 AND 13\n   GROUP BY p.oid\n   ORDER BY MAX(p.probability) DESC\n   LIMIT 50)\nSELECT ms.*\nFROM magstat ms\nJOIN selected_oids s ON s.oid = ms.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Return all columns from the magstat table for up to 50 objects\n-- satisfying: lc_classifier rank-1 AGN with probability > 0.6\n-- and WISE W1 magnitude (allwise.w1mpro) between 12 and 13.\n-- Note: Correct table name is magstat (not magstats).\nWITH selected_oids AS\n  (SELECT p.oid\n   FROM probability p\n   JOIN allwise aw ON aw.oid_catalog = p.oid\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.ranking = 1\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6\n     AND aw.w1mpro BETWEEN 12 AND 13\n   GROUP BY p.oid\n   ORDER BY MAX(p.probability) DESC\n   LIMIT 50)\nSELECT ms.*\nFROM magstat ms\nJOIN selected_oids s ON s.oid = ms.oid;"
                },
                "in_toks": 2368,
                "out_toks": 2836,
                "id": "chatcmpl-CbHIUwfzDvOTE7YlGd925tEZ4oDlS",
                "created": 1763000662,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2055,
                "out_toks": 655,
                "id": "chatcmpl-CZYW8QGnRvuiQatqdVxbYaKHUPihI",
                "created": 1762590200,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3934,
                "out_toks": 4000,
                "id": "chatcmpl-CZZu9zABhBNB35KReQ3abiC6U6jem",
                "created": 1762595533,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all columns from the magstats table for up to 50 objects\n-- satisfying: lc_classifier rank-1 AGN with probability > 0.6\n-- and WISE W1 magnitude between 12 and 13.\n-- Note: Replace ms.w1 with the correct W1 column name if different (e.g., w1mpro).\nSELECT ms.*\nFROM magstats ms\nINNER JOIN probability p ON p.oid = ms.oid\nWHERE p.classifier_name = 'lc_classifier'  -- default classifier\n  AND p.ranking = 1                         -- default to most likely class\n  AND p.class_name = 'AGN'\n  AND p.probability > 0.6\n  AND ms.w1 BETWEEN 12 AND 13\nORDER BY p.probability DESC\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the magstats table for up to 50 objects\n-- satisfying: lc_classifier rank-1 AGN with probability > 0.6\n-- and WISE W1 magnitude between 12 and 13.\n-- Note: Replace ms.w1 with the correct W1 column name if different (e.g., w1mpro).\nSELECT ms.*\nFROM magstats ms\nINNER JOIN probability p ON p.oid = ms.oid\nWHERE p.classifier_name = 'lc_classifier'  -- default classifier\n  AND p.ranking = 1                         -- default to most likely class\n  AND p.class_name = 'AGN'\n  AND p.probability > 0.6\n  AND ms.w1 BETWEEN 12 AND 13\nORDER BY p.probability DESC\nLIMIT 50;\n```"
                },
                "in_toks": 3032,
                "out_toks": 2807,
                "id": "chatcmpl-CZazUpkFx8PCEO06kHIa3COzmHW2D",
                "created": 1762599708,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "7": {
            "req_id": "102",
            "experiment_id": "run_7",
            "pred_tables": [
                "probability",
                "taxonomy",
                "allwise",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'allwise', 'magstat']"
                },
                "in_toks": 644,
                "out_toks": 792,
                "id": "chatcmpl-CZMmGGfNvNj3ycaORHSMhnufBrrzL",
                "created": 1762545072,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Find up to 50 ZTF objects with AGN probability > 0.6 (lc_classifier) and WISE W1 magnitude between 12 and 13,\n-- then return all columns from the magstat table for those objects.\n-- Fixes:\n--  - Use the correct table name: magstat (not magstats).\n--  - Use the correct WISE column and table: allwise.w1mpro (not ms.w1).\n--  - Do not require ranking = 1 since the request only specifies probability > 0.6.\n--  - Select up to 50 distinct objects first, then return all magstat rows (all bands) for those objects.\n WITH selected_oids AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   JOIN allwise aw ON aw.oid_catalog = p.oid -- assumes linkage between ZTF object and AllWISE entry\n\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6\n     AND aw.w1mpro BETWEEN 12 AND 13\n   LIMIT 50)\nSELECT ms.*\nFROM magstat ms\nJOIN selected_oids so ON so.oid = ms.oid\nORDER BY ms.oid,\n         ms.fid;",
            "sql_response": {
                "responses": {
                    "0": "-- Find up to 50 ZTF objects with AGN probability > 0.6 (lc_classifier) and WISE W1 magnitude between 12 and 13,\n-- then return all columns from the magstat table for those objects.\n-- Fixes:\n--  - Use the correct table name: magstat (not magstats).\n--  - Use the correct WISE column and table: allwise.w1mpro (not ms.w1).\n--  - Do not require ranking = 1 since the request only specifies probability > 0.6.\n--  - Select up to 50 distinct objects first, then return all magstat rows (all bands) for those objects.\n WITH selected_oids AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   JOIN allwise aw ON aw.oid_catalog = p.oid -- assumes linkage between ZTF object and AllWISE entry\n\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6\n     AND aw.w1mpro BETWEEN 12 AND 13\n   LIMIT 50)\nSELECT ms.*\nFROM magstat ms\nJOIN selected_oids so ON so.oid = ms.oid\nORDER BY ms.oid,\n         ms.fid;"
                },
                "in_toks": 2439,
                "out_toks": 3163,
                "id": "chatcmpl-CbHIxXvM6hvFIOyG7vhs0fKfZgTfw",
                "created": 1763000691,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2100,
                "out_toks": 1039,
                "id": "chatcmpl-CZYWJh0YcOQ1zhfyQiEAFImuvqLAH",
                "created": 1762590211,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3979,
                "out_toks": 4000,
                "id": "chatcmpl-CZZhIkzemfzYVu3VF8683sbXPVwGw",
                "created": 1762594736,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return up to 50 objects with top-ranked AGN classification (lc_classifier) and WISE W1 magnitude between 12 and 13\n-- NOTE: This assumes the time-independent table name is 'magstats' and that the W1 magnitude column is 'w1'.\n-- If your schema uses a different column name for W1 (e.g., 'w1mag' or 'w1mpro'), replace ms.w1 accordingly.\n\nSELECT DISTINCT ON (ms.oid) ms.*\nFROM magstats ms\nINNER JOIN probability p\n    ON p.oid = ms.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n  AND p.class_name = 'AGN'\n  AND p.probability > 0.6\n  AND ms.w1 BETWEEN 12 AND 13\nORDER BY ms.oid\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return up to 50 objects with top-ranked AGN classification (lc_classifier) and WISE W1 magnitude between 12 and 13\n-- NOTE: This assumes the time-independent table name is 'magstats' and that the W1 magnitude column is 'w1'.\n-- If your schema uses a different column name for W1 (e.g., 'w1mag' or 'w1mpro'), replace ms.w1 accordingly.\n\nSELECT DISTINCT ON (ms.oid) ms.*\nFROM magstats ms\nINNER JOIN probability p\n    ON p.oid = ms.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking = 1\n  AND p.class_name = 'AGN'\n  AND p.probability > 0.6\n  AND ms.w1 BETWEEN 12 AND 13\nORDER BY ms.oid\nLIMIT 50;\n```"
                },
                "in_toks": 3032,
                "out_toks": 3268,
                "id": "chatcmpl-CZb04fuIv0VPHEQdco8jOQ9Y3quRc",
                "created": 1762599744,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "8": {
            "req_id": "102",
            "experiment_id": "run_8",
            "pred_tables": [
                "magstat",
                "probability",
                "taxonomy",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat', 'probability', 'taxonomy', 'allwise']"
                },
                "in_toks": 644,
                "out_toks": 1240,
                "id": "chatcmpl-CZMmYS3yXNpBKoStCDZlH6J1DIMpo",
                "created": 1762545090,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return all magstat rows for up to 50 ZTF objects that:\n-- (1) have AGN probability > 0.6 in the light curve (lc) classifier, and\n-- (2) have WISE W1 magnitude between 12 and 13.\n-- Fix: use the correct table name 'magstat' (not 'magstats') and get W1 from the 'allwise' table.\n WITH selected_oids AS\n  (SELECT DISTINCT p.oid\n   FROM probability AS p\n   INNER JOIN allwise AS aw ON aw.oid_catalog = p.oid -- assumes crossmatch key aligns; adjust if a dedicated xmatch table is available\n\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6\n     AND aw.w1mpro BETWEEN 12 AND 13\n   LIMIT 50)\nSELECT ms.*\nFROM magstat AS ms\nINNER JOIN selected_oids AS so ON so.oid = ms.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Return all magstat rows for up to 50 ZTF objects that:\n-- (1) have AGN probability > 0.6 in the light curve (lc) classifier, and\n-- (2) have WISE W1 magnitude between 12 and 13.\n-- Fix: use the correct table name 'magstat' (not 'magstats') and get W1 from the 'allwise' table.\n WITH selected_oids AS\n  (SELECT DISTINCT p.oid\n   FROM probability AS p\n   INNER JOIN allwise AS aw ON aw.oid_catalog = p.oid -- assumes crossmatch key aligns; adjust if a dedicated xmatch table is available\n\n   WHERE p.classifier_name = 'lc_classifier'\n     AND p.class_name = 'AGN'\n     AND p.probability > 0.6\n     AND aw.w1mpro BETWEEN 12 AND 13\n   LIMIT 50)\nSELECT ms.*\nFROM magstat AS ms\nINNER JOIN selected_oids AS so ON so.oid = ms.oid;"
                },
                "in_toks": 2480,
                "out_toks": 3174,
                "id": "chatcmpl-CbHJYPBq0vnGCA9HjvctlMUHBkz24",
                "created": 1763000728,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2100,
                "out_toks": 847,
                "id": "chatcmpl-CZYWZNyqIOI2UyzJzzUTxfhFDlxAe",
                "created": 1762590227,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3979,
                "out_toks": 4000,
                "id": "chatcmpl-CZZuw1BIdGlf3qB1oNTmCZNog491d",
                "created": 1762595582,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 50 objects classified as AGN by the light curve classifier with rank=1 and probability > 0.6,\n-- and having WISE W1 magnitude between 12 and 13.\n-- Note: This query assumes the table is named 'magstats' (time-independent stats) and that the W1 column is 'w1mpro'.\n-- If your schema uses a different table/column name (e.g., 'magstat' or 'w1'), adjust accordingly.\n\nSELECT\n    ms.*\nFROM\n    magstats ms\nINNER JOIN\n    probability p\n    ON p.oid = ms.oid\nWHERE\n    p.classifier_name = 'lc_classifier' -- default condition: use light curve classifier\n    AND p.ranking = 1                   -- default condition: top-ranked class\n    AND p.class_name = 'AGN'\n    AND p.probability > 0.6\n    AND ms.w1mpro BETWEEN 12 AND 13\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 50 objects classified as AGN by the light curve classifier with rank=1 and probability > 0.6,\n-- and having WISE W1 magnitude between 12 and 13.\n-- Note: This query assumes the table is named 'magstats' (time-independent stats) and that the W1 column is 'w1mpro'.\n-- If your schema uses a different table/column name (e.g., 'magstat' or 'w1'), adjust accordingly.\n\nSELECT\n    ms.*\nFROM\n    magstats ms\nINNER JOIN\n    probability p\n    ON p.oid = ms.oid\nWHERE\n    p.classifier_name = 'lc_classifier' -- default condition: use light curve classifier\n    AND p.ranking = 1                   -- default condition: top-ranked class\n    AND p.class_name = 'AGN'\n    AND p.probability > 0.6\n    AND ms.w1mpro BETWEEN 12 AND 13\nLIMIT 50;\n```"
                },
                "in_toks": 3032,
                "out_toks": 2397,
                "id": "chatcmpl-CZb0D6PomSUMlAGQESru1SuvIyNgJ",
                "created": 1762599753,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "9": {
            "req_id": "102",
            "experiment_id": "run_9",
            "pred_tables": [
                "magstat",
                "probability",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat', 'probability', 'allwise']"
                },
                "in_toks": 644,
                "out_toks": 853,
                "id": "chatcmpl-CZMmyeDCTOflNPSTDX1VBgiCNCy4x",
                "created": 1762545116,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- NOTE: The provided schema does not include the 'object' table (with ra/dec) or any crossmatch table\n-- linking ZTF oids to AllWISE 'oid_catalog'. Therefore, we cannot apply the WISE W1 magnitude filter\n-- or a 2 arcsec positional join using q3c_join with the available tables. Below we return up to 50\n-- ZTF objects (by highest P(AGN) from 'lc_classifier') and all their magstat rows.\n WITH p_agn AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND class_name = 'AGN'\n     AND probability > 0.6),\n      top50_oids AS\n  (SELECT oid\n   FROM p_agn\n   ORDER BY probability DESC\n   LIMIT 50)\nSELECT m.*\nFROM magstat m\nJOIN top50_oids t USING (oid)\nORDER BY m.oid,\n         m.fid;",
            "sql_response": {
                "responses": {
                    "0": "-- NOTE: The provided schema does not include the 'object' table (with ra/dec) or any crossmatch table\n-- linking ZTF oids to AllWISE 'oid_catalog'. Therefore, we cannot apply the WISE W1 magnitude filter\n-- or a 2 arcsec positional join using q3c_join with the available tables. Below we return up to 50\n-- ZTF objects (by highest P(AGN) from 'lc_classifier') and all their magstat rows.\n WITH p_agn AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND class_name = 'AGN'\n     AND probability > 0.6),\n      top50_oids AS\n  (SELECT oid\n   FROM p_agn\n   ORDER BY probability DESC\n   LIMIT 50)\nSELECT m.*\nFROM magstat m\nJOIN top50_oids t USING (oid)\nORDER BY m.oid,\n         m.fid;"
                },
                "in_toks": 2684,
                "out_toks": 2962,
                "id": "chatcmpl-CbHKO7U9iMKod1Jsh6jUWm9W0BS6n",
                "created": 1763000780,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2055,
                "out_toks": 1103,
                "id": "chatcmpl-CZYWs1ViSbl6ktViYazNtmdTSYR4a",
                "created": 1762590246,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Find up to 50 ZTF objects with P(AGN) > 0.6 from the lc_classifier (ranking=1),\n-- that have an AllWISE counterpart with 12 <= w1mpro <= 13 within 2 arcsec,\n-- and return all columns from magstat for those objects.\nWITH p_agn AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND ranking = 1\n     AND class_name = 'AGN'\n     AND probability > 0.6),\n     o_wise AS\n  (SELECT DISTINCT o.oid\n   FROM OBJECT o\n   INNER JOIN allwise w ON q3c_join(o.ra, o.dec, w.ra, w.dec, 2.0/3600.0)\n   WHERE w.w1mpro BETWEEN 12 AND 13),\n     oids_match AS\n  (SELECT oid\n   FROM p_agn INTERSECT SELECT oid\n   FROM o_wise),\n     top50_oids AS\n  (SELECT m.oid,\n          p.probability\n   FROM oids_match m\n   INNER JOIN p_agn p USING (oid)\n   ORDER BY p.probability DESC\n   LIMIT 50)\nSELECT magstat.*\nFROM magstat\nINNER JOIN top50_oids t ON magstat.oid = t.oid\nORDER BY magstat.oid,\n         magstat.fid;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve at most 50 unique ZTF objects that:\n  - Have probability > 0.6 of being 'AGN' under the light curve classifier ('lc_classifier') and with ranking = 1.\n  - Have an AllWISE match whose w1mpro is between 12 and 13 (inclusive).\n- Return all columns from the magstat table (i.e., magstat.*) for those objects (all available bands/rows per oid).\n\nAssumptions and parameters\n- Spatial join radius: use a typical cross-match radius of 2 arcsec = 2/3600 degrees \u2248 0.0005555556 deg.\n- Tables and key columns:\n  - probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n  - object(oid, ra, dec)  [referenced by magstat and probability; required for Q3C join]\n  - allwise(oid_catalog, ra, dec, w1mpro, \u2026)\n  - magstat(oid, fid, stellar, corrected, ndet, ndubious, dmdt_first, dm_first, sigmadm_first, dt_first, magmean, magmedian, magmax, magmin, magsigma, maglast, magfirst, magmean_corr, magmedian_corr, magmax_corr, magmin_corr, magsigma_corr, maglast_corr, magfirst_corr, firstmjd, lastmjd, step_id_corr, saturation_rate)\n- Q3C function to use: q3c_join(ra1, dec1, ra2, dec2, radius). Be explicit about argument order.\n\nStructure (use CTEs to organize; leverage JOINs, INTERSECT, and nested queries)\n\n1) Subquery P_AGN: restrict to highest-rank AGN per object in the light curve classifier\n- From probability table.\n- WHERE conditions (default constraints applied):\n  - probability.classifier_name = 'lc_classifier'\n  - probability.class_name = 'AGN'\n  - probability.ranking = 1\n  - probability.probability > 0.6\n- Output columns:\n  - oid\n  - probability (retain to rank later)\n- This will leverage ix_classification_rank1 and ix_probabilities_probability.\n\n2) Subquery O_WISE: find ZTF objects with an AllWISE counterpart satisfying W1 magnitude constraint\n- Start from object table to get celestial coordinates: object(oid, ra, dec).\n- INNER JOIN allwise ON q3c_join(object.ra, object.dec, allwise.ra, allwise.dec, 2/3600.0)\n  - Note the exact order of q3c_join arguments: (object.ra, object.dec, allwise.ra, allwise.dec, radius_in_degrees).\n- WHERE allwise.w1mpro BETWEEN 12 AND 13 (inclusive).\n- Output:\n  - DISTINCT object.oid (deduplicate if multiple WISE matches exist).\n- Optional refinement (if you want to ensure a unique best match per object):\n  - Use a nested SELECT that computes q3c_dist(object.ra, object.dec, allwise.ra, allwise.dec) and then selects the closest allwise row per object via DISTINCT ON (object.oid) ordered by distance ASC. For the purpose of this request, DISTINCT oids is sufficient.\n\n3) INTERSECT to enforce both conditions at the object level\n- Create OIDS_MATCH as the intersection of the two sets of oids:\n  - SELECT oid FROM P_AGN\n  INTERSECT\n  - SELECT oid FROM O_WISE\n- This guarantees that resulting oids satisfy both the AGN probability condition and the W1 magnitude condition.\n\n4) Choose at most 50 objects, prioritizing highest AGN probabilities\n- Join OIDS_MATCH back to P_AGN to recover the probability values for ordering.\n- ORDER BY P_AGN.probability DESC (secondary tie-breakers optional).\n- LIMIT 50.\n- Output:\n  - The final set of up to 50 oids (TOP50_OIDS).\n\n5) Final retrieval of magstat rows for the selected objects\n- SELECT magstat.* (all columns, as requested).\n- FROM magstat\n- INNER JOIN TOP50_OIDS ON magstat.oid = TOP50_OIDS.oid\n- This returns all magstat rows (one per fid per object) for the selected oids.\n- Optional ORDER BY for readability (e.g., ORDER BY magstat.oid, magstat.fid).\n\nNotes on performance and correctness\n- Ensure Q3C is installed and appropriate q3c index exists on allwise(ra, dec) and object(ra, dec) to accelerate the spatial join; the btree indexes on allwise(ra) and allwise(dec) are not used by Q3C.\n- Keep the probability filter in a separate subquery to leverage ix_classification_rank1 and avoid scanning all classes.\n- Apply LIMIT at the object level (TOP50_OIDS) so that you return all magstat rows for those objects without prematurely limiting magstat rows."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve at most 50 unique ZTF objects that:\n  - Have probability > 0.6 of being 'AGN' under the light curve classifier ('lc_classifier') and with ranking = 1.\n  - Have an AllWISE match whose w1mpro is between 12 and 13 (inclusive).\n- Return all columns from the magstat table (i.e., magstat.*) for those objects (all available bands/rows per oid).\n\nAssumptions and parameters\n- Spatial join radius: use a typical cross-match radius of 2 arcsec = 2/3600 degrees \u2248 0.0005555556 deg.\n- Tables and key columns:\n  - probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n  - object(oid, ra, dec)  [referenced by magstat and probability; required for Q3C join]\n  - allwise(oid_catalog, ra, dec, w1mpro, \u2026)\n  - magstat(oid, fid, stellar, corrected, ndet, ndubious, dmdt_first, dm_first, sigmadm_first, dt_first, magmean, magmedian, magmax, magmin, magsigma, maglast, magfirst, magmean_corr, magmedian_corr, magmax_corr, magmin_corr, magsigma_corr, maglast_corr, magfirst_corr, firstmjd, lastmjd, step_id_corr, saturation_rate)\n- Q3C function to use: q3c_join(ra1, dec1, ra2, dec2, radius). Be explicit about argument order.\n\nStructure (use CTEs to organize; leverage JOINs, INTERSECT, and nested queries)\n\n1) Subquery P_AGN: restrict to highest-rank AGN per object in the light curve classifier\n- From probability table.\n- WHERE conditions (default constraints applied):\n  - probability.classifier_name = 'lc_classifier'\n  - probability.class_name = 'AGN'\n  - probability.ranking = 1\n  - probability.probability > 0.6\n- Output columns:\n  - oid\n  - probability (retain to rank later)\n- This will leverage ix_classification_rank1 and ix_probabilities_probability.\n\n2) Subquery O_WISE: find ZTF objects with an AllWISE counterpart satisfying W1 magnitude constraint\n- Start from object table to get celestial coordinates: object(oid, ra, dec).\n- INNER JOIN allwise ON q3c_join(object.ra, object.dec, allwise.ra, allwise.dec, 2/3600.0)\n  - Note the exact order of q3c_join arguments: (object.ra, object.dec, allwise.ra, allwise.dec, radius_in_degrees).\n- WHERE allwise.w1mpro BETWEEN 12 AND 13 (inclusive).\n- Output:\n  - DISTINCT object.oid (deduplicate if multiple WISE matches exist).\n- Optional refinement (if you want to ensure a unique best match per object):\n  - Use a nested SELECT that computes q3c_dist(object.ra, object.dec, allwise.ra, allwise.dec) and then selects the closest allwise row per object via DISTINCT ON (object.oid) ordered by distance ASC. For the purpose of this request, DISTINCT oids is sufficient.\n\n3) INTERSECT to enforce both conditions at the object level\n- Create OIDS_MATCH as the intersection of the two sets of oids:\n  - SELECT oid FROM P_AGN\n  INTERSECT\n  - SELECT oid FROM O_WISE\n- This guarantees that resulting oids satisfy both the AGN probability condition and the W1 magnitude condition.\n\n4) Choose at most 50 objects, prioritizing highest AGN probabilities\n- Join OIDS_MATCH back to P_AGN to recover the probability values for ordering.\n- ORDER BY P_AGN.probability DESC (secondary tie-breakers optional).\n- LIMIT 50.\n- Output:\n  - The final set of up to 50 oids (TOP50_OIDS).\n\n5) Final retrieval of magstat rows for the selected objects\n- SELECT magstat.* (all columns, as requested).\n- FROM magstat\n- INNER JOIN TOP50_OIDS ON magstat.oid = TOP50_OIDS.oid\n- This returns all magstat rows (one per fid per object) for the selected oids.\n- Optional ORDER BY for readability (e.g., ORDER BY magstat.oid, magstat.fid).\n\nNotes on performance and correctness\n- Ensure Q3C is installed and appropriate q3c index exists on allwise(ra, dec) and object(ra, dec) to accelerate the spatial join; the btree indexes on allwise(ra) and allwise(dec) are not used by Q3C.\n- Keep the probability filter in a separate subquery to leverage ix_classification_rank1 and avoid scanning all classes.\n- Apply LIMIT at the object level (TOP50_OIDS) so that you return all magstat rows for those objects without prematurely limiting magstat rows."
                    },
                    "in_toks": 3934,
                    "out_toks": 4141,
                    "id": "chatcmpl-Cb6Sz7kPDzzXisZnfNW7KerVlHSkD",
                    "created": 1762959029,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Find up to 50 ZTF objects with P(AGN) > 0.6 from the lc_classifier (ranking=1),\n-- that have an AllWISE counterpart with 12 <= w1mpro <= 13 within 2 arcsec,\n-- and return all columns from magstat for those objects.\nWITH p_agn AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE classifier_name = 'lc_classifier'\n     AND ranking = 1\n     AND class_name = 'AGN'\n     AND probability > 0.6),\n     o_wise AS\n  (SELECT DISTINCT o.oid\n   FROM OBJECT o\n   INNER JOIN allwise w ON q3c_join(o.ra, o.dec, w.ra, w.dec, 2.0/3600.0)\n   WHERE w.w1mpro BETWEEN 12 AND 13),\n     oids_match AS\n  (SELECT oid\n   FROM p_agn INTERSECT SELECT oid\n   FROM o_wise),\n     top50_oids AS\n  (SELECT m.oid,\n          p.probability\n   FROM oids_match m\n   INNER JOIN p_agn p USING (oid)\n   ORDER BY p.probability DESC\n   LIMIT 50)\nSELECT magstat.*\nFROM magstat\nINNER JOIN top50_oids t ON magstat.oid = t.oid\nORDER BY magstat.oid,\n         magstat.fid;"
                        },
                        "in_toks": 3655,
                        "out_toks": 1663,
                        "id": "chatcmpl-Cb6UbWZqcwi4b0kf2x7wKsfqI96zS",
                        "created": 1762959129,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        }
    },
    "81": {
        "0": {
            "req_id": "81",
            "experiment_id": "run_0",
            "pred_tables": [
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch', 'allwise']",
                    "1": "['xmatch', 'allwise']"
                },
                "in_toks": 633,
                "out_toks": 1506,
                "id": "chatcmpl-CSnXVT1pjL3xiukhiDMxtRVqOenVc",
                "created": 1760979649,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1256,
                "out_toks": 527,
                "id": "chatcmpl-CSnn7WHl4B3l7zOtFmWSd4iaGWYqy",
                "created": 1760980617,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ZTF objects matched to the specified ALLWISE source; return ZTF oid and angular separation (arcsec)\nSELECT\n    x.oid,\n    x.dist\nFROM xmatch AS x\nINNER JOIN allwise AS w\n    ON w.oid_catalog = x.oid_catalog\nWHERE w.oid_catalog = 'J163603.54-065228.7';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ZTF objects matched to the specified ALLWISE source; return ZTF oid and angular separation (arcsec)\nSELECT\n    x.oid,\n    x.dist\nFROM xmatch AS x\nINNER JOIN allwise AS w\n    ON w.oid_catalog = x.oid_catalog\nWHERE w.oid_catalog = 'J163603.54-065228.7';\n```"
                },
                "in_toks": 2574,
                "out_toks": 1370,
                "id": "chatcmpl-CSqsLYBi56uVxzAMxPkTnuxKyS7x6",
                "created": 1760992473,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "81",
            "experiment_id": "run_1",
            "pred_tables": [
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch', 'allwise']",
                    "1": "['xmatch', 'allwise']"
                },
                "in_toks": 633,
                "out_toks": 1506,
                "id": "chatcmpl-CSnXVT1pjL3xiukhiDMxtRVqOenVc",
                "created": 1760979649,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1256,
                "out_toks": 143,
                "id": "chatcmpl-CSnnEJ7uRdxNISdQV3UTmgEe50jno",
                "created": 1760980624,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return the ZTF object identifier (oid) and the distance (dist) for the specified ALLWISE source\nSELECT\n    xm.oid,\n    xm.dist\nFROM xmatch AS xm\nINNER JOIN allwise AS aw\n    ON aw.oid_catalog = xm.oid_catalog\nWHERE aw.oid_catalog = 'J163603.54-065228.7';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return the ZTF object identifier (oid) and the distance (dist) for the specified ALLWISE source\nSELECT\n    xm.oid,\n    xm.dist\nFROM xmatch AS xm\nINNER JOIN allwise AS aw\n    ON aw.oid_catalog = xm.oid_catalog\nWHERE aw.oid_catalog = 'J163603.54-065228.7';\n```"
                },
                "in_toks": 2574,
                "out_toks": 1050,
                "id": "chatcmpl-CSqsDXNT9kLNieEMidgmLfZBmpdL4",
                "created": 1760992465,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "81",
            "experiment_id": "run_2",
            "pred_tables": [
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch', 'allwise']"
                },
                "in_toks": 633,
                "out_toks": 465,
                "id": "chatcmpl-CSsjAENLUGEEuUqumNnIDOfQ4ujmc",
                "created": 1760999592,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1256,
                "out_toks": 591,
                "id": "chatcmpl-CSxYLU2TpX7QNnpKQTKQfYbvd5n8U",
                "created": 1761018141,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return the ZTF object identifier (oid) and the angular distance (dist, in arcseconds)\n-- for the AllWISE source with designation 'J163603.54-065228.7'\nSELECT\n    x.oid,\n    x.dist\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog\nWHERE a.oid_catalog = 'J163603.54-065228.7';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return the ZTF object identifier (oid) and the angular distance (dist, in arcseconds)\n-- for the AllWISE source with designation 'J163603.54-065228.7'\nSELECT\n    x.oid,\n    x.dist\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog\nWHERE a.oid_catalog = 'J163603.54-065228.7';\n```"
                },
                "in_toks": 2574,
                "out_toks": 2028,
                "id": "chatcmpl-CSxl4MugyRXLN7ZjUEwyzkw4PKpwS",
                "created": 1761018930,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "81",
            "experiment_id": "run_3",
            "pred_tables": [
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch', 'allwise']"
                },
                "in_toks": 633,
                "out_toks": 657,
                "id": "chatcmpl-CSsjG0kmxijWOledgJzkrQakKf1El",
                "created": 1760999598,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1256,
                "out_toks": 399,
                "id": "chatcmpl-CSxYR3c4yIIho87P6Fvy4cDxjMFxP",
                "created": 1761018147,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ZTF objects cross-matched to the specified ALLWISE source, returning ZTF oid and angular separation (dist, in arcsec)\nSELECT\n    x.oid,\n    x.dist\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog\nWHERE a.oid_catalog = 'J163603.54-065228.7';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ZTF objects cross-matched to the specified ALLWISE source, returning ZTF oid and angular separation (dist, in arcsec)\nSELECT\n    x.oid,\n    x.dist\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog\nWHERE a.oid_catalog = 'J163603.54-065228.7';\n```"
                },
                "in_toks": 2574,
                "out_toks": 1119,
                "id": "chatcmpl-CSxlXlbZDLImYj3QqCsaHSZrOxDyE",
                "created": 1761018959,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "81",
            "experiment_id": "run_4",
            "pred_tables": [
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch', 'allwise']"
                },
                "in_toks": 633,
                "out_toks": 785,
                "id": "chatcmpl-CSsjPmFZbDFg3D3rw7jaQgBTsCbQL",
                "created": 1760999607,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1256,
                "out_toks": 335,
                "id": "chatcmpl-CSxYWD5aWsrij9bgI5FX6aKprVqaI",
                "created": 1761018152,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return ZTF object identifier and crossmatch distance for the ALLWISE source with identifier 'J163603.54-065228.7'\n-- The join to 'allwise' ensures we select the ALLWISE catalog; the WHERE handles cases with/without leading 'J' in the designation.\nSELECT\n    xmatch.oid,\n    xmatch.dist\nFROM xmatch\nINNER JOIN allwise ON allwise.oid_catalog = xmatch.oid_catalog\nWHERE allwise.oid_catalog = 'J163603.54-065228.7'\n   OR ('J' || allwise.oid_catalog) = 'J163603.54-065228.7';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return ZTF object identifier and crossmatch distance for the ALLWISE source with identifier 'J163603.54-065228.7'\n-- The join to 'allwise' ensures we select the ALLWISE catalog; the WHERE handles cases with/without leading 'J' in the designation.\nSELECT\n    xmatch.oid,\n    xmatch.dist\nFROM xmatch\nINNER JOIN allwise ON allwise.oid_catalog = xmatch.oid_catalog\nWHERE allwise.oid_catalog = 'J163603.54-065228.7'\n   OR ('J' || allwise.oid_catalog) = 'J163603.54-065228.7';\n```"
                },
                "in_toks": 2574,
                "out_toks": 1943,
                "id": "chatcmpl-CSxlpQ3d71KVymZmCU7UK6iGLO3tr",
                "created": 1761018977,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "81",
            "experiment_id": "run_5",
            "pred_tables": [
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch', 'allwise']"
                },
                "in_toks": 633,
                "out_toks": 721,
                "id": "chatcmpl-CZMnH5zLiqJZaX8oBZM1UVbKS6YjT",
                "created": 1762545135,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1256,
                "out_toks": 271,
                "id": "chatcmpl-CZYXBEMKtVI687nMEFLQaNxD0kbt1",
                "created": 1762590265,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return ZTF object identifier (oid) and angular distance (dist) for the ALLWISE source 'J163603.54-065228.7'\nSELECT\n    x.oid,\n    x.dist\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog\nWHERE a.oid_catalog = 'J163603.54-065228.7';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return ZTF object identifier (oid) and angular distance (dist) for the ALLWISE source 'J163603.54-065228.7'\nSELECT\n    x.oid,\n    x.dist\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog\nWHERE a.oid_catalog = 'J163603.54-065228.7';\n```"
                },
                "in_toks": 2574,
                "out_toks": 995,
                "id": "chatcmpl-CZZla13m2bVanjOVDGOTbhntUh0Kq",
                "created": 1762595002,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "81",
            "experiment_id": "run_6",
            "pred_tables": [
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch']"
                },
                "in_toks": 633,
                "out_toks": 1101,
                "id": "chatcmpl-CZMnXzhOj4kI875Z2DdYe1kORiQwN",
                "created": 1762545151,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 557,
                "out_toks": 207,
                "id": "chatcmpl-CZYXFcGqBkr2zXPDZzpmDcrPtmvfZ",
                "created": 1762590269,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return ZTF object identifier (oid) and distance (arcsec) for the specified ALLWISE source\nSELECT\n    oid,\n    dist\nFROM xmatch\nWHERE catid = 'ALLWISE'\n  AND oid_catalog = 'J163603.54-065228.7';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return ZTF object identifier (oid) and distance (arcsec) for the specified ALLWISE source\nSELECT\n    oid,\n    dist\nFROM xmatch\nWHERE catid = 'ALLWISE'\n  AND oid_catalog = 'J163603.54-065228.7';\n```"
                },
                "in_toks": 1875,
                "out_toks": 712,
                "id": "chatcmpl-CZZweV1cPWRbVgQbrJ8vQT1JvRFKo",
                "created": 1762595688,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "81",
            "experiment_id": "run_7",
            "pred_tables": [
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch', 'allwise']"
                },
                "in_toks": 633,
                "out_toks": 785,
                "id": "chatcmpl-CZMnqvEnZvwyzl40qOGeuK9kmH9gc",
                "created": 1762545170,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1256,
                "out_toks": 335,
                "id": "chatcmpl-CZYXIpSsBHknlPC2BCeG8UidEZL9p",
                "created": 1762590272,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ZTF objects cross-matched to the specified ALLWISE source, returning ZTF oid and angular distance (arcsec)\nSELECT\n    x.oid,\n    x.dist\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog\nWHERE a.oid_catalog = 'J163603.54-065228.7';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ZTF objects cross-matched to the specified ALLWISE source, returning ZTF oid and angular distance (arcsec)\nSELECT\n    x.oid,\n    x.dist\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog\nWHERE a.oid_catalog = 'J163603.54-065228.7';\n```"
                },
                "in_toks": 2574,
                "out_toks": 1564,
                "id": "chatcmpl-CZZy7FfrRJEYE3X6LNLuMPyKllsBu",
                "created": 1762595779,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "81",
            "experiment_id": "run_8",
            "pred_tables": [
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch', 'allwise']"
                },
                "in_toks": 633,
                "out_toks": 593,
                "id": "chatcmpl-CZMo9l6l5wbNEzYWBYdriieu8ruyr",
                "created": 1762545189,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1256,
                "out_toks": 463,
                "id": "chatcmpl-CZYXPt8mrxv04Sq4yVPc0mJaBpe8w",
                "created": 1762590279,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ZTF objects cross-matched to the ALLWISE source 'J163603.54-065228.7'\n-- Returning the ZTF object identifier (oid) and the distance to its catalog counterpart (dist)\nSELECT\n    x.oid,\n    x.dist\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog\nWHERE a.oid_catalog = 'J163603.54-065228.7';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ZTF objects cross-matched to the ALLWISE source 'J163603.54-065228.7'\n-- Returning the ZTF object identifier (oid) and the distance to its catalog counterpart (dist)\nSELECT\n    x.oid,\n    x.dist\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog\nWHERE a.oid_catalog = 'J163603.54-065228.7';\n```"
                },
                "in_toks": 2574,
                "out_toks": 1839,
                "id": "chatcmpl-CZZmrBMsVDPtIXWwNGTuv9ldXafBN",
                "created": 1762595081,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "81",
            "experiment_id": "run_9",
            "pred_tables": [
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch', 'allwise']"
                },
                "in_toks": 633,
                "out_toks": 593,
                "id": "chatcmpl-CZMoYpY1c8guBXWO5ym8cBX5HYmTW",
                "created": 1762545214,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1256,
                "out_toks": 271,
                "id": "chatcmpl-CZYXVXH5squsISHac8J1PEcNycaOF",
                "created": 1762590285,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- ZTF objects matched to the ALLWISE source 'J163603.54-065228.7'\n-- Returns the ZTF object identifier (oid) and the angular distance (dist, in arcsec)\nSELECT\n    x.oid,\n    x.dist\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog\nWHERE a.oid_catalog = 'J163603.54-065228.7';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ZTF objects matched to the ALLWISE source 'J163603.54-065228.7'\n-- Returns the ZTF object identifier (oid) and the angular distance (dist, in arcsec)\nSELECT\n    x.oid,\n    x.dist\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog\nWHERE a.oid_catalog = 'J163603.54-065228.7';\n```"
                },
                "in_toks": 2574,
                "out_toks": 1134,
                "id": "chatcmpl-CZZwyKfirb49qhWUlKAJdYg0unioE",
                "created": 1762595708,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "69": {
        "0": {
            "req_id": "69",
            "experiment_id": "run_0",
            "pred_tables": [
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ps1_ztf']",
                    "1": "['ps1_ztf', 'object']"
                },
                "in_toks": 649,
                "out_toks": 1315,
                "id": "chatcmpl-CSnXj1DfEmnkxGbO5CmsS69y1rAR1",
                "created": 1760979663,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1213,
                "out_toks": 271,
                "id": "chatcmpl-CSnnIS8W7wjUbvmUWRTgk2RXtKdW4",
                "created": 1760980628,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All ps1_ztf rows for the given ZTF objects where the nearest PS1 source has sgscore1 < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All ps1_ztf rows for the given ZTF objects where the nearest PS1 source has sgscore1 < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```"
                },
                "in_toks": 2531,
                "out_toks": 604,
                "id": "chatcmpl-CSqsNZqpIhQgplPcoh8E8bWskpznG",
                "created": 1760992475,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "69",
            "experiment_id": "run_1",
            "pred_tables": [
                "ps1_ztf",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ps1_ztf']",
                    "1": "['ps1_ztf', 'object']"
                },
                "in_toks": 649,
                "out_toks": 1315,
                "id": "chatcmpl-CSnXj1DfEmnkxGbO5CmsS69y1rAR1",
                "created": 1760979663,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1696,
                "out_toks": 79,
                "id": "chatcmpl-CSnnMgI1VlEranIgqyqDJ4I1p4nRU",
                "created": 1760980632,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Rows in ps1_ztf for the specified ZTF objects where the nearest PS1 source has sgscore1 < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Rows in ps1_ztf for the specified ZTF objects where the nearest PS1 source has sgscore1 < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```"
                },
                "in_toks": 3014,
                "out_toks": 476,
                "id": "chatcmpl-CSqsSIMQNAhmaHiNsEhVlY3w0b4YN",
                "created": 1760992480,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "69",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'ps1_ztf']"
                },
                "in_toks": 649,
                "out_toks": 339,
                "id": "chatcmpl-CSsjaA3wLmp9lqAMwNBLQHjEpMSeI",
                "created": 1760999618,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1695,
                "out_toks": 271,
                "id": "chatcmpl-CSxYa8nqgmXzj7tTCbP7c93ZqX4IM",
                "created": 1761018156,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find all Pan-STARRS crossmatch rows for the specified ZTF objects\n-- where the nearest source Star/Galaxy score (sgscore1) is < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find all Pan-STARRS crossmatch rows for the specified ZTF objects\n-- where the nearest source Star/Galaxy score (sgscore1) is < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```"
                },
                "in_toks": 3013,
                "out_toks": 549,
                "id": "chatcmpl-CSxmF1UY5tn5HFnWbC9HM7wm5iEJj",
                "created": 1761019003,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "69",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'ps1_ztf']"
                },
                "in_toks": 649,
                "out_toks": 595,
                "id": "chatcmpl-CSsjfRHd01z7rLvq6p2pZW4b1Rwz2",
                "created": 1760999623,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1695,
                "out_toks": 271,
                "id": "chatcmpl-CSxYdfKpy0izdYtv6zfFvA97syWBf",
                "created": 1761018159,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all PS1/ZTF crossmatch rows for the specified ZTF objects\n-- where the nearest PS1 source has a Star/Galaxy score < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all PS1/ZTF crossmatch rows for the specified ZTF objects\n-- where the nearest PS1 source has a Star/Galaxy score < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```"
                },
                "in_toks": 3013,
                "out_toks": 483,
                "id": "chatcmpl-CSxmOx7HDYQWm8DX7tHhHPYBUPcaD",
                "created": 1761019012,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "69",
            "experiment_id": "run_4",
            "pred_tables": [
                "ps1_ztf",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ps1_ztf', 'object']"
                },
                "in_toks": 649,
                "out_toks": 851,
                "id": "chatcmpl-CSsjnNi9M3t2MztCvFC9fFh8GoMYJ",
                "created": 1760999631,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1696,
                "out_toks": 143,
                "id": "chatcmpl-CSxYh95QMvtJJ8hvwvLxDhuyiNbRp",
                "created": 1761018163,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All Pan-STARRS crossmatch rows for the specified ZTF objects\n-- where the nearest-source star/galaxy score (sgscore1) is < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All Pan-STARRS crossmatch rows for the specified ZTF objects\n-- where the nearest-source star/galaxy score (sgscore1) is < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```"
                },
                "in_toks": 3014,
                "out_toks": 612,
                "id": "chatcmpl-CSxmZsACfEa28R9pXEoTbZfF26zvy",
                "created": 1761019023,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "69",
            "experiment_id": "run_5",
            "pred_tables": [
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ps1_ztf']"
                },
                "in_toks": 649,
                "out_toks": 464,
                "id": "chatcmpl-CZMyRNJ2jUM7eAWiqvFTdpnF8MewW",
                "created": 1762545827,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1213,
                "out_toks": 207,
                "id": "chatcmpl-CZYXbr7CJ6JZ4tdutJxbIrASVbVQI",
                "created": 1762590291,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find all rows in ps1_ztf for the specified ZTF objects where the nearest source (sgscore1) < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find all rows in ps1_ztf for the specified ZTF objects where the nearest source (sgscore1) < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```"
                },
                "in_toks": 2531,
                "out_toks": 733,
                "id": "chatcmpl-CZZeB4Evul5BPUOysqieeSCWBZP1L",
                "created": 1762594543,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "69",
            "experiment_id": "run_6",
            "pred_tables": [
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ps1_ztf']"
                },
                "in_toks": 649,
                "out_toks": 208,
                "id": "chatcmpl-CZMyaYPOrfsTtMm8LvYvyvPE0qIjs",
                "created": 1762545836,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1213,
                "out_toks": 207,
                "id": "chatcmpl-CZYXfDeiUma6cu6IVehNijnL6TmEs",
                "created": 1762590295,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find all ps1_ztf rows for the specified ZTF objects where the nearest PS1 source has sgscore1 < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2\nORDER BY oid, candid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find all ps1_ztf rows for the specified ZTF objects where the nearest PS1 source has sgscore1 < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2\nORDER BY oid, candid;\n```"
                },
                "in_toks": 2531,
                "out_toks": 547,
                "id": "chatcmpl-CZZytXz3mwtulODc2E1netOPXUXVU",
                "created": 1762595827,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "69",
            "experiment_id": "run_7",
            "pred_tables": [
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ps1_ztf']"
                },
                "in_toks": 649,
                "out_toks": 272,
                "id": "chatcmpl-CZMygH0EEu8GYp68PdWqDhdoKKL4q",
                "created": 1762545842,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1213,
                "out_toks": 271,
                "id": "chatcmpl-CZYXj6wDVQp6XvMOHNfVdc0iqj50Q",
                "created": 1762590299,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Select all rows in ps1_ztf for the specified ZTF objects\n-- where the star/galaxy score of the nearest PS1 source (sgscore1) is lower than 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Select all rows in ps1_ztf for the specified ZTF objects\n-- where the star/galaxy score of the nearest PS1 source (sgscore1) is lower than 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```"
                },
                "in_toks": 2531,
                "out_toks": 426,
                "id": "chatcmpl-CZZpAiOiuVupqrNc6VdKx2XSqTowu",
                "created": 1762595224,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "69",
            "experiment_id": "run_8",
            "pred_tables": [
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ps1_ztf']"
                },
                "in_toks": 649,
                "out_toks": 400,
                "id": "chatcmpl-CZMyoUXGLkJ4t1Ij6fSK3rJH6AZfy",
                "created": 1762545850,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1213,
                "out_toks": 271,
                "id": "chatcmpl-CZYXtqp9LQLHqyezN37sltRUXk5lZ",
                "created": 1762590309,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Rows in ps1_ztf for the given ZTF objects where the nearest PS1 source has sgscore1 < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Rows in ps1_ztf for the given ZTF objects where the nearest PS1 source has sgscore1 < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```"
                },
                "in_toks": 2531,
                "out_toks": 604,
                "id": "chatcmpl-CZZeyLLTa4Ood0tILxWZTL2hwrVK0",
                "created": 1762594592,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "69",
            "experiment_id": "run_9",
            "pred_tables": [
                "ps1_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ps1_ztf']"
                },
                "in_toks": 649,
                "out_toks": 336,
                "id": "chatcmpl-CZMyyf67zbYPmR7iie7K8hhZdFlsQ",
                "created": 1762545860,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1213,
                "out_toks": 207,
                "id": "chatcmpl-CZYXy9vDXesl0FdQuB6Oki3CM9Uv5",
                "created": 1762590314,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find all ps1_ztf rows for the given ZTF objects where the nearest PS1 source has sgscore1 < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find all ps1_ztf rows for the given ZTF objects where the nearest PS1 source has sgscore1 < 0.2\nSELECT *\nFROM ps1_ztf\nWHERE oid IN ('ZTF21abstkhj', 'ZTF22aacqjeb', 'ZTF21aamwpdf')\n  AND sgscore1 < 0.2;\n```"
                },
                "in_toks": 2531,
                "out_toks": 605,
                "id": "chatcmpl-CZZzAE9OMCyxRvCLCW60iMiMpshK0",
                "created": 1762595844,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "61": {
        "0": {
            "req_id": "61",
            "experiment_id": "run_0",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat']",
                    "1": "['magstat']"
                },
                "in_toks": 634,
                "out_toks": 282,
                "id": "chatcmpl-CSnXu8SUMXss678kcq9vw9cOwCb0C",
                "created": 1760979674,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1162,
                "out_toks": 207,
                "id": "chatcmpl-CSnnPTmLYEArJUCBoyDjetgfyjAr4",
                "created": 1760980635,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 30 magstat rows with:\n-- - at least 10 detections (ndet >= 10)\n-- - median difference magnitude fainter than 19 (magmedian > 19; fainter = larger mags)\n-- - last difference magnitude brighter than 17 (maglast < 17; brighter = smaller mags)\n-- Ordered by the object identifier (oid)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 magstat rows with:\n-- - at least 10 detections (ndet >= 10)\n-- - median difference magnitude fainter than 19 (magmedian > 19; fainter = larger mags)\n-- - last difference magnitude brighter than 17 (maglast < 17; brighter = smaller mags)\n-- Ordered by the object identifier (oid)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```"
                },
                "in_toks": 2491,
                "out_toks": 449,
                "id": "chatcmpl-CSqsFKCUpFvXz71ZqHIgeyv6DvEmP",
                "created": 1760992467,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "61",
            "experiment_id": "run_1",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat']",
                    "1": "['magstat']"
                },
                "in_toks": 634,
                "out_toks": 282,
                "id": "chatcmpl-CSnXu8SUMXss678kcq9vw9cOwCb0C",
                "created": 1760979674,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1162,
                "out_toks": 143,
                "id": "chatcmpl-CSnnUA09FUJ5LWR7bISYkKRNrIIVM",
                "created": 1760980640,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 30 magstat rows with:\n-- - at least 10 detections (ndet >= 10),\n-- - median difference magnitude fainter than 19 (magmedian > 19),\n-- - last difference magnitude brighter than 17 (maglast < 17),\n-- ordered by the object identifier.\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 magstat rows with:\n-- - at least 10 detections (ndet >= 10),\n-- - median difference magnitude fainter than 19 (magmedian > 19),\n-- - last difference magnitude brighter than 17 (maglast < 17),\n-- ordered by the object identifier.\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```"
                },
                "in_toks": 2491,
                "out_toks": 564,
                "id": "chatcmpl-CSqsYEibx4UzgeTmiCBaJOA1nLmCu",
                "created": 1760992486,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "61",
            "experiment_id": "run_2",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat']"
                },
                "in_toks": 634,
                "out_toks": 77,
                "id": "chatcmpl-CSsjz7LcPYO6LP78mt4zM1AWtg3Ju",
                "created": 1760999643,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1162,
                "out_toks": 79,
                "id": "chatcmpl-CSxYkWhSdtYbdVMJkElmXokYFOGuE",
                "created": 1761018166,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 30 magstat rows with:\n-- - at least 10 detections (ndet >= 10)\n-- - median difference magnitude fainter than 19 (magmedian > 19)\n-- - last difference magnitude brighter than 17 (maglast < 17)\n-- Ordered by the object identifier (oid)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 magstat rows with:\n-- - at least 10 detections (ndet >= 10)\n-- - median difference magnitude fainter than 19 (magmedian > 19)\n-- - last difference magnitude brighter than 17 (maglast < 17)\n-- Ordered by the object identifier (oid)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```"
                },
                "in_toks": 2491,
                "out_toks": 310,
                "id": "chatcmpl-CSxmjyRwd8ewCtYKARqRZUDJE3ONk",
                "created": 1761019033,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "61",
            "experiment_id": "run_3",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat']"
                },
                "in_toks": 634,
                "out_toks": 205,
                "id": "chatcmpl-CSsk1Rs3wzd9kjTkg4BaY7Vf7zriy",
                "created": 1760999645,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1162,
                "out_toks": 143,
                "id": "chatcmpl-CSxYmsxvbcAjRmmOReFFVajSsT2ZB",
                "created": 1761018168,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Select up to 30 magstat rows with:\n-- - at least 10 detections (ndet >= 10)\n-- - median difference magnitude fainter than 19 (magmedian > 19; larger mag = fainter)\n-- - last difference magnitude brighter than 17 (maglast < 17; smaller mag = brighter)\n-- Ordered by object identifier (oid)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Select up to 30 magstat rows with:\n-- - at least 10 detections (ndet >= 10)\n-- - median difference magnitude fainter than 19 (magmedian > 19; larger mag = fainter)\n-- - last difference magnitude brighter than 17 (maglast < 17; smaller mag = brighter)\n-- Ordered by object identifier (oid)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```"
                },
                "in_toks": 2491,
                "out_toks": 640,
                "id": "chatcmpl-CSxmru0h4lI9RBLRJfuhUE4SBRjzO",
                "created": 1761019041,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "61",
            "experiment_id": "run_4",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat']"
                },
                "in_toks": 634,
                "out_toks": 77,
                "id": "chatcmpl-CSsk5L4TBbcun8x6CttkZshnuOXLb",
                "created": 1760999649,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1162,
                "out_toks": 143,
                "id": "chatcmpl-CSxYpqwNOLBvk0jU41enXG0AeWxlI",
                "created": 1761018171,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 30 magstat rows with:\n-- - at least 10 detections (ndet >= 10)\n-- - median difference magnitude fainter than 19 (magmedian > 19; fainter = larger magnitude)\n-- - last difference magnitude brighter than 17 (maglast < 17; brighter = smaller magnitude)\n-- Ordered by object identifier (oid)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 magstat rows with:\n-- - at least 10 detections (ndet >= 10)\n-- - median difference magnitude fainter than 19 (magmedian > 19; fainter = larger magnitude)\n-- - last difference magnitude brighter than 17 (maglast < 17; brighter = smaller magnitude)\n-- Ordered by object identifier (oid)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```"
                },
                "in_toks": 2491,
                "out_toks": 448,
                "id": "chatcmpl-CSxn17uQEKZQoNB0cvYW4Pr3OAST1",
                "created": 1761019051,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "61",
            "experiment_id": "run_5",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat']"
                },
                "in_toks": 634,
                "out_toks": 205,
                "id": "chatcmpl-CZMz99TDadEU7EW7Y0snjkhS24rp3",
                "created": 1762545871,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1162,
                "out_toks": 207,
                "id": "chatcmpl-CZYY1HLcSnS5l56oPtEGHAn72P0PP",
                "created": 1762590317,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return up to 30 magstat rows with:\n-- - at least 10 detections (ndet >= 10)\n-- - median difference magnitude fainter than 19 (magmedian > 19)\n-- - last difference magnitude brighter than 17 (maglast < 17)\n-- Ordered by the object identifier (oid)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return up to 30 magstat rows with:\n-- - at least 10 detections (ndet >= 10)\n-- - median difference magnitude fainter than 19 (magmedian > 19)\n-- - last difference magnitude brighter than 17 (maglast < 17)\n-- Ordered by the object identifier (oid)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```"
                },
                "in_toks": 2491,
                "out_toks": 502,
                "id": "chatcmpl-CZZpPsUavm83oSe2ALCwW7AZPfTzm",
                "created": 1762595239,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "61",
            "experiment_id": "run_6",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat']"
                },
                "in_toks": 634,
                "out_toks": 141,
                "id": "chatcmpl-CZMzFQ3627wOJw9jiZmdBZixzFhFd",
                "created": 1762545877,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1162,
                "out_toks": 207,
                "id": "chatcmpl-CZYY5KfrcPGILrYguotS5xAcRlttF",
                "created": 1762590321,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 30 magstat rows with:\n-- - at least 10 detections (ndet >= 10)\n-- - median difference magnitude fainter than 19 (magmedian > 19)\n-- - last difference magnitude brighter than 17 (maglast < 17)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 magstat rows with:\n-- - at least 10 detections (ndet >= 10)\n-- - median difference magnitude fainter than 19 (magmedian > 19)\n-- - last difference magnitude brighter than 17 (maglast < 17)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```"
                },
                "in_toks": 2491,
                "out_toks": 429,
                "id": "chatcmpl-CZZfaSt5nMMiNXtCYO4XQGI29Kuh6",
                "created": 1762594630,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "61",
            "experiment_id": "run_7",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat']"
                },
                "in_toks": 634,
                "out_toks": 141,
                "id": "chatcmpl-CZMzJV7pBR6dyTUFb4oZ7qy5EftXP",
                "created": 1762545881,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1162,
                "out_toks": 79,
                "id": "chatcmpl-CZYYHO7mBVRWPk5Yx8quAnk7L2Q41",
                "created": 1762590333,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 30 magstat rows with:\n--  - ndet >= 10 (minimum number of detections)\n--  - magmedian > 19 (fainter than 19; larger magnitude is fainter)\n--  - maglast < 17 (brighter than 17; smaller magnitude is brighter)\n-- Ordered by object identifier (oid)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 magstat rows with:\n--  - ndet >= 10 (minimum number of detections)\n--  - magmedian > 19 (fainter than 19; larger magnitude is fainter)\n--  - maglast < 17 (brighter than 17; smaller magnitude is brighter)\n-- Ordered by object identifier (oid)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```"
                },
                "in_toks": 2491,
                "out_toks": 445,
                "id": "chatcmpl-CZZpn78ovccl6aawRvyQT1M8He2Bw",
                "created": 1762595263,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "61",
            "experiment_id": "run_8",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat']"
                },
                "in_toks": 634,
                "out_toks": 141,
                "id": "chatcmpl-CZMzO2JN6KSxKGOoYG5lnhtm3Pql8",
                "created": 1762545886,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1162,
                "out_toks": 207,
                "id": "chatcmpl-CZYYK6bfzgZ5OWk2Oe0oKKyGUCWXq",
                "created": 1762590336,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 30 magstat rows with:\n-- - at least 10 detections\n-- - median difference magnitude fainter than 19 (i.e., larger value)\n-- - last difference magnitude brighter than 17 (i.e., smaller value)\n-- Order results by the object identifier (oid)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 magstat rows with:\n-- - at least 10 detections\n-- - median difference magnitude fainter than 19 (i.e., larger value)\n-- - last difference magnitude brighter than 17 (i.e., smaller value)\n-- Order results by the object identifier (oid)\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```"
                },
                "in_toks": 2491,
                "out_toks": 433,
                "id": "chatcmpl-CZZzTfvlsDDlfpmHyrjXS6deYUKRq",
                "created": 1762595863,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "61",
            "experiment_id": "run_9",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat']"
                },
                "in_toks": 634,
                "out_toks": 269,
                "id": "chatcmpl-CZMzSVSK4K8ZAsQf5VYuVGf3Y8E1O",
                "created": 1762545890,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1162,
                "out_toks": 207,
                "id": "chatcmpl-CZYYWd0xZHGleb60R0B9VzqbDLwLI",
                "created": 1762590348,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 30 magstat rows with:\n-- - at least 10 detections,\n-- - median difference magnitude fainter than 19 (numerically > 19),\n-- - last difference magnitude brighter than 17 (numerically < 17),\n-- ordered by object identifier.\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 magstat rows with:\n-- - at least 10 detections,\n-- - median difference magnitude fainter than 19 (numerically > 19),\n-- - last difference magnitude brighter than 17 (numerically < 17),\n-- ordered by object identifier.\nSELECT *\nFROM magstat\nWHERE ndet >= 10\n  AND magmedian > 19\n  AND maglast < 17\nORDER BY oid\nLIMIT 30;\n```"
                },
                "in_toks": 2491,
                "out_toks": 493,
                "id": "chatcmpl-CZZfkd9HWWGvSXXsOnolr33eqyER1",
                "created": 1762594640,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "104": {
        "0": {
            "req_id": "104",
            "experiment_id": "run_0",
            "pred_tables": [
                "probability",
                "taxonomy",
                "detection",
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'detection', 'ss_ztf']",
                    "1": "['probability', 'taxonomy', 'detection', 'ss_ztf']"
                },
                "in_toks": 682,
                "out_toks": 4596,
                "id": "chatcmpl-CSnXy7HC7HeUlhNuT0qKZJD6snUI6",
                "created": 1760979678,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Find up to 30 objects with asteroid probability > 0.9 for stamp classifier v1.0.4\n-- Return object and candidate IDs, nearest Solar System object info (from ss_ztf),\n-- and candidate-level fields (fid). The provided detection schema does not include\n-- fwhm, ncalib, or exptime, so we return NULLs for those columns.\nWITH top_asteroids AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.probability > 0.9\n   ORDER BY p.probability DESC\n   LIMIT 30),\n     latest_det AS\n  (-- Latest detection per object (avoid filtering on detection by fields other than oid)\n SELECT DISTINCT ON (d.oid) d.*\n   FROM detection d\n   INNER JOIN top_asteroids ta ON ta.oid = d.oid\n   ORDER BY d.oid,\n            d.mjd DESC)\nSELECT ld.oid, -- ZTF object identifier\n ld.candid, -- candidate identifier\n s.ssdistnr, -- distance to nearest Solar System object\n s.ssmagnr, -- MPC archive magnitude\n s.ssnamenr, -- MPC name\n ld.fid, -- filter identifier (1=g; 2=r; 3=i)\n NULL::DOUBLE PRECISION AS fwhm, -- not available in provided detection schema\n NULL::INTEGER AS ncalib, -- not available in provided detection schema\n NULL::DOUBLE PRECISION AS exptime -- not available in provided detection schema\nFROM latest_det ld\nLEFT JOIN ss_ztf s ON s.oid = ld.oid\nORDER BY ld.oid;",
            "sql_response": {
                "responses": {
                    "0": "-- Find up to 30 objects with asteroid probability > 0.9 for stamp classifier v1.0.4\n-- Return object and candidate IDs, nearest Solar System object info (from ss_ztf),\n-- and candidate-level fields (fid). The provided detection schema does not include\n-- fwhm, ncalib, or exptime, so we return NULLs for those columns.\nWITH top_asteroids AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.probability > 0.9\n   ORDER BY p.probability DESC\n   LIMIT 30),\n     latest_det AS\n  (-- Latest detection per object (avoid filtering on detection by fields other than oid)\n SELECT DISTINCT ON (d.oid) d.*\n   FROM detection d\n   INNER JOIN top_asteroids ta ON ta.oid = d.oid\n   ORDER BY d.oid,\n            d.mjd DESC)\nSELECT ld.oid, -- ZTF object identifier\n ld.candid, -- candidate identifier\n s.ssdistnr, -- distance to nearest Solar System object\n s.ssmagnr, -- MPC archive magnitude\n s.ssnamenr, -- MPC name\n ld.fid, -- filter identifier (1=g; 2=r; 3=i)\n NULL::DOUBLE PRECISION AS fwhm, -- not available in provided detection schema\n NULL::INTEGER AS ncalib, -- not available in provided detection schema\n NULL::DOUBLE PRECISION AS exptime -- not available in provided detection schema\nFROM latest_det ld\nLEFT JOIN ss_ztf s ON s.oid = ld.oid\nORDER BY ld.oid;"
                },
                "in_toks": 2278,
                "out_toks": 2777,
                "id": "chatcmpl-CbHLHr7kEB9IcnBEIL3lmcD8oKhE2",
                "created": 1763000835,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1432,
                "out_toks": 847,
                "id": "chatcmpl-CSnnXVuJYRr6ezroVggTCOyuUN4ec",
                "created": 1760980643,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3311,
                "out_toks": 4000,
                "id": "chatcmpl-CSqsQJ7tHB4Ng9IAsflAZNTDnYrio",
                "created": 1760992478,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Top 30 ZTF objects most likely to be 'asteroid' per stamp classifier v1.0.4 (probability > 0.9, ranking=1)\nWITH top_asteroids AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.classifier_name = 'stamp_classifier'\n      AND p.classifier_version = 'stamp_classifier_1.0.4'\n      AND p.class_name = 'asteroid'\n      AND p.probability > 0.9\n      AND p.ranking = 1\n    ORDER BY p.probability DESC\n    LIMIT 30\n),\n-- For those objects, pick the latest detection (candidate) to report candidate-level fields\nlatest_det AS (\n    SELECT DISTINCT ON (d.oid) d.*\n    FROM detection d\n    INNER JOIN top_asteroids ta ON ta.oid = d.oid\n    ORDER BY d.oid, d.mjd DESC\n)\nSELECT\n    -- Identifiers\n    ld.oid,\n    ld.candid,\n    -- Nearest Solar System object info from MPC\n    ld.ssdistnr,   -- distance to nearest SS object (arcsec)\n    ld.ssmagnr,    -- MPC archive magnitude\n    ld.ssnamenr,   -- MPC name\n    -- Candidate-related fields\n    ld.fid,        -- filter identifier (1=g, 2=r, 3=i)\n    ld.fwhm,       -- FWHM from SExtractor (arcsec)\n    ld.ncalib,     -- number of PS1 calibrators used\n    ld.exptime     -- exposure time (s)\nFROM latest_det ld\nORDER BY ld.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Top 30 ZTF objects most likely to be 'asteroid' per stamp classifier v1.0.4 (probability > 0.9, ranking=1)\nWITH top_asteroids AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.classifier_name = 'stamp_classifier'\n      AND p.classifier_version = 'stamp_classifier_1.0.4'\n      AND p.class_name = 'asteroid'\n      AND p.probability > 0.9\n      AND p.ranking = 1\n    ORDER BY p.probability DESC\n    LIMIT 30\n),\n-- For those objects, pick the latest detection (candidate) to report candidate-level fields\nlatest_det AS (\n    SELECT DISTINCT ON (d.oid) d.*\n    FROM detection d\n    INNER JOIN top_asteroids ta ON ta.oid = d.oid\n    ORDER BY d.oid, d.mjd DESC\n)\nSELECT\n    -- Identifiers\n    ld.oid,\n    ld.candid,\n    -- Nearest Solar System object info from MPC\n    ld.ssdistnr,   -- distance to nearest SS object (arcsec)\n    ld.ssmagnr,    -- MPC archive magnitude\n    ld.ssnamenr,   -- MPC name\n    -- Candidate-related fields\n    ld.fid,        -- filter identifier (1=g, 2=r, 3=i)\n    ld.fwhm,       -- FWHM from SExtractor (arcsec)\n    ld.ncalib,     -- number of PS1 calibrators used\n    ld.exptime     -- exposure time (s)\nFROM latest_det ld\nORDER BY ld.oid;\n```"
                },
                "in_toks": 3070,
                "out_toks": 3180,
                "id": "chatcmpl-CSr7CEa3XWuwQ1PafvcSujtVacNPc",
                "created": 1760993394,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "1": {
            "req_id": "104",
            "experiment_id": "run_1",
            "pred_tables": [
                "probability",
                "taxonomy",
                "detection",
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'detection', 'ss_ztf']",
                    "1": "['probability', 'taxonomy', 'detection', 'ss_ztf']"
                },
                "in_toks": 682,
                "out_toks": 4596,
                "id": "chatcmpl-CSnXy7HC7HeUlhNuT0qKZJD6snUI6",
                "created": 1760979678,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Find up to 30 ZTF objects with asteroid probability > 0.9 from the stamp classifier v1.0.4\n-- Optimized to avoid scanning the large detection table by joining via ss_ztf.candid (PRIMARY KEY join to detection)\n-- Note: The requested columns \"FWHM from SExtractor\", \"number of PS1 calibrators used\", and \"exposure time\"\n--       are not present in the provided schema, so they are returned as NULL placeholders.\n WITH highprob AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.class_name = 'asteroid'\n     AND p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.ranking = 1\n     AND p.probability > 0.9)\nSELECT hp.oid AS ztf_oid, -- ZTF object identifier\n s.candid AS candid, -- candidate identifier\n s.ssdistnr AS ss_distance, -- distance to nearest Solar System object\n s.ssmagnr AS mpc_mag, -- MPC archive magnitude\n s.ssnamenr AS mpc_name, -- MPC archive name\n d.fid AS fid, -- filter identifier (1=g; 2=r; 3=i)\n NULL::double precision AS fwhm_sextractor, -- not available in provided schema\n NULL::integer AS ps1_calibrators, -- not available in provided schema\n NULL::double precision AS exposure_time -- not available in provided schema\nFROM highprob hp\nJOIN ss_ztf s ON s.oid = hp.oid\nJOIN detection d ON d.candid = s.candid\nORDER BY hp.probability DESC\nLIMIT 30;",
            "sql_response": {
                "responses": {
                    "0": "-- Find up to 30 ZTF objects with asteroid probability > 0.9 from the stamp classifier v1.0.4\n-- Optimized to avoid scanning the large detection table by joining via ss_ztf.candid (PRIMARY KEY join to detection)\n-- Note: The requested columns \"FWHM from SExtractor\", \"number of PS1 calibrators used\", and \"exposure time\"\n--       are not present in the provided schema, so they are returned as NULL placeholders.\n WITH highprob AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.class_name = 'asteroid'\n     AND p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.ranking = 1\n     AND p.probability > 0.9)\nSELECT hp.oid AS ztf_oid, -- ZTF object identifier\n s.candid AS candid, -- candidate identifier\n s.ssdistnr AS ss_distance, -- distance to nearest Solar System object\n s.ssmagnr AS mpc_mag, -- MPC archive magnitude\n s.ssnamenr AS mpc_name, -- MPC archive name\n d.fid AS fid, -- filter identifier (1=g; 2=r; 3=i)\n NULL::double precision AS fwhm_sextractor, -- not available in provided schema\n NULL::integer AS ps1_calibrators, -- not available in provided schema\n NULL::double precision AS exposure_time -- not available in provided schema\nFROM highprob hp\nJOIN ss_ztf s ON s.oid = hp.oid\nJOIN detection d ON d.candid = s.candid\nORDER BY hp.probability DESC\nLIMIT 30;"
                },
                "in_toks": 2228,
                "out_toks": 2957,
                "id": "chatcmpl-CbHM0vjk5hO0K42JPsyJ4x6RNlD6v",
                "created": 1763000880,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1432,
                "out_toks": 1167,
                "id": "chatcmpl-CSnnkRvnbJcoL6BHLvpxRsFRJYFd1",
                "created": 1760980656,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3311,
                "out_toks": 4000,
                "id": "chatcmpl-CSqsZNLqpAjIpw0iEwsp6CZzumy4u",
                "created": 1760992487,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 30 objects most likely classified as 'asteroid' by the stamp classifier\n-- NOTE: The requested columns \"distance from the nearest Solar System object\", \"MPC archive magnitude\", \"MPC archive name\",\n--       \"FWHM from SExtractor\", \"number of PS1 calibrators used\", and \"exposure time\" are not present in the provided schema.\n--       The detection table includes \"distnr\" (distance to nearest source in the reference image), which is NOT the Solar System object distance.\n--       Therefore, this query returns the available requested columns: ZTF identifier (oid), candidate identifier (candid), and filter identifier (fid),\n--       plus \"distnr\" as the closest available distance metric.\nWITH top_objs AS (\n    SELECT\n        p.oid,\n        p.probability\n    FROM probability p\n    WHERE p.class_name = 'asteroid'\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.classifier_version = 'stamp_classifier_1.0.4'\n      AND p.probability > 0.9\n      AND p.ranking = 1\n    ORDER BY p.probability DESC\n    LIMIT 30\n),\nlatest_det AS (\n    SELECT DISTINCT ON (d.oid)\n        d.*\n    FROM detection d\n    INNER JOIN top_objs t\n        ON t.oid = d.oid\n    ORDER BY d.oid, d.mjd DESC\n)\nSELECT\n    l.oid,         -- ZTF object identifier\n    l.candid,      -- candidate identifier\n    l.fid,         -- filter identifier (1=g; 2=r; 3=i)\n    l.distnr       -- distance to nearest source in reference image (NOT Solar System distance)\nFROM latest_det l\nORDER BY l.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 objects most likely classified as 'asteroid' by the stamp classifier\n-- NOTE: The requested columns \"distance from the nearest Solar System object\", \"MPC archive magnitude\", \"MPC archive name\",\n--       \"FWHM from SExtractor\", \"number of PS1 calibrators used\", and \"exposure time\" are not present in the provided schema.\n--       The detection table includes \"distnr\" (distance to nearest source in the reference image), which is NOT the Solar System object distance.\n--       Therefore, this query returns the available requested columns: ZTF identifier (oid), candidate identifier (candid), and filter identifier (fid),\n--       plus \"distnr\" as the closest available distance metric.\nWITH top_objs AS (\n    SELECT\n        p.oid,\n        p.probability\n    FROM probability p\n    WHERE p.class_name = 'asteroid'\n      AND p.classifier_name = 'stamp_classifier'\n      AND p.classifier_version = 'stamp_classifier_1.0.4'\n      AND p.probability > 0.9\n      AND p.ranking = 1\n    ORDER BY p.probability DESC\n    LIMIT 30\n),\nlatest_det AS (\n    SELECT DISTINCT ON (d.oid)\n        d.*\n    FROM detection d\n    INNER JOIN top_objs t\n        ON t.oid = d.oid\n    ORDER BY d.oid, d.mjd DESC\n)\nSELECT\n    l.oid,         -- ZTF object identifier\n    l.candid,      -- candidate identifier\n    l.fid,         -- filter identifier (1=g; 2=r; 3=i)\n    l.distnr       -- distance to nearest source in reference image (NOT Solar System distance)\nFROM latest_det l\nORDER BY l.oid;\n```"
                },
                "in_toks": 3070,
                "out_toks": 3270,
                "id": "chatcmpl-CSr7f6plsIB8pIMihjxvDW8umjKFc",
                "created": 1760993423,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "2": {
            "req_id": "104",
            "experiment_id": "run_2",
            "pred_tables": [
                "probability",
                "taxonomy",
                "detection",
                "ss_ztf",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'detection', 'ss_ztf', 'dataquality']"
                },
                "in_toks": 682,
                "out_toks": 1502,
                "id": "chatcmpl-CSsk6D1JRE4N0ySgf3u0cayEdrzAz",
                "created": 1760999650,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "WITH top_asteroids AS\n  (-- Select up to 30 objects with asteroid class prob > 0.9 for the specified stamp classifier/version\n SELECT p.oid,\n        p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.ranking = 1\n     AND p.probability > 0.9\n   ORDER BY p.probability DESC\n   LIMIT 30)\nSELECT ta.oid, -- ZTF object identifier\n sz.candid, -- candidate identifier (from ss_ztf)\n sz.ssdistnr, -- distance to nearest Solar System object\n sz.ssmagnr, -- MPC archive magnitude\n sz.ssnamenr, -- MPC object name\n d.fid, -- filter identifier\n dq.fwhm, -- FWHM from SExtractor\n dq.nmatches, -- number of PS1 calibrators used\n dq.exptime -- exposure time\nFROM top_asteroids ta\nJOIN ss_ztf sz ON sz.oid = ta.oid -- get Solar System match info\nJOIN detection d ON d.candid = sz.candid\nAND d.oid = sz.oid -- candidate-level info\nJOIN dataquality dq ON dq.candid = d.candid\nAND dq.oid = d.oid -- SExtractor/quality metrics\nORDER BY ta.probability DESC,\n         ta.oid;",
            "sql_response": {
                "responses": {
                    "0": "WITH top_asteroids AS\n  (-- Select up to 30 objects with asteroid class prob > 0.9 for the specified stamp classifier/version\n SELECT p.oid,\n        p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.ranking = 1\n     AND p.probability > 0.9\n   ORDER BY p.probability DESC\n   LIMIT 30)\nSELECT ta.oid, -- ZTF object identifier\n sz.candid, -- candidate identifier (from ss_ztf)\n sz.ssdistnr, -- distance to nearest Solar System object\n sz.ssmagnr, -- MPC archive magnitude\n sz.ssnamenr, -- MPC object name\n d.fid, -- filter identifier\n dq.fwhm, -- FWHM from SExtractor\n dq.nmatches, -- number of PS1 calibrators used\n dq.exptime -- exposure time\nFROM top_asteroids ta\nJOIN ss_ztf sz ON sz.oid = ta.oid -- get Solar System match info\nJOIN detection d ON d.candid = sz.candid\nAND d.oid = sz.oid -- candidate-level info\nJOIN dataquality dq ON dq.candid = d.candid\nAND dq.oid = d.oid -- SExtractor/quality metrics\nORDER BY ta.probability DESC,\n         ta.oid;"
                },
                "in_toks": 3275,
                "out_toks": 2903,
                "id": "chatcmpl-CbHMfsZ9rZSgA45t19bqk5Eq5NBam",
                "created": 1763000921,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2229,
                "out_toks": 719,
                "id": "chatcmpl-CSxYsMbcL6ka7RfiMHRohKR7vlllN",
                "created": 1761018174,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 4108,
                "out_toks": 4000,
                "id": "chatcmpl-CSxn9tFr7IHdPDWhqd6KQrbTPXW0V",
                "created": 1761019059,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Top 30 ZTF objects with stamp classifier ('stamp_classifier_1.0.4') probability > 0.9 for class 'asteroid'\nWITH top_asteroids AS (\n    SELECT\n        p.oid,\n        p.probability\n    FROM probability p\n    WHERE\n        p.classifier_name = 'stamp_classifier' AND            -- use stamp classifier\n        p.classifier_version = 'stamp_classifier_1.0.4' AND   -- requested version\n        p.class_name = 'asteroid' AND                         -- asteroid class\n        p.ranking = 1 AND                                     -- top-ranked class\n        p.probability > 0.9                                   -- probability threshold\n    ORDER BY p.probability DESC\n    LIMIT 30                                                  -- at most 30 objects\n),\nlatest_det AS (\n    -- Pick one candidate (latest by mjd) per selected object to report candidate-level columns\n    SELECT DISTINCT ON (d.oid)\n        d.oid,\n        d.candid,\n        d.ssdistnr,     -- distance from the nearest Solar System object (arcsec)\n        d.ssmagnr,      -- MPC archive magnitude\n        d.ssnamenr,     -- MPC object name\n        d.fid,          -- filter identifier\n        d.fwhm,         -- FWHM from SExtractor\n        d.ncalib,       -- number of PS1 calibrators used\n        d.exptime       -- exposure time\n    FROM detection d\n    INNER JOIN top_asteroids ta ON ta.oid = d.oid\n    ORDER BY d.oid, d.mjd DESC\n)\nSELECT\n    ld.oid,         -- ZTF object identifier\n    ld.candid,      -- candidate identifier\n    ld.ssdistnr,    -- distance to nearest Solar System object\n    ld.ssmagnr,     -- MPC archive magnitude\n    ld.ssnamenr,    -- MPC object name\n    ld.fid,         -- filter identifier\n    ld.fwhm,        -- FWHM from SExtractor\n    ld.ncalib,      -- number of PS1 calibrators\n    ld.exptime      -- exposure time\nFROM latest_det ld\nORDER BY ld.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Top 30 ZTF objects with stamp classifier ('stamp_classifier_1.0.4') probability > 0.9 for class 'asteroid'\nWITH top_asteroids AS (\n    SELECT\n        p.oid,\n        p.probability\n    FROM probability p\n    WHERE\n        p.classifier_name = 'stamp_classifier' AND            -- use stamp classifier\n        p.classifier_version = 'stamp_classifier_1.0.4' AND   -- requested version\n        p.class_name = 'asteroid' AND                         -- asteroid class\n        p.ranking = 1 AND                                     -- top-ranked class\n        p.probability > 0.9                                   -- probability threshold\n    ORDER BY p.probability DESC\n    LIMIT 30                                                  -- at most 30 objects\n),\nlatest_det AS (\n    -- Pick one candidate (latest by mjd) per selected object to report candidate-level columns\n    SELECT DISTINCT ON (d.oid)\n        d.oid,\n        d.candid,\n        d.ssdistnr,     -- distance from the nearest Solar System object (arcsec)\n        d.ssmagnr,      -- MPC archive magnitude\n        d.ssnamenr,     -- MPC object name\n        d.fid,          -- filter identifier\n        d.fwhm,         -- FWHM from SExtractor\n        d.ncalib,       -- number of PS1 calibrators used\n        d.exptime       -- exposure time\n    FROM detection d\n    INNER JOIN top_asteroids ta ON ta.oid = d.oid\n    ORDER BY d.oid, d.mjd DESC\n)\nSELECT\n    ld.oid,         -- ZTF object identifier\n    ld.candid,      -- candidate identifier\n    ld.ssdistnr,    -- distance to nearest Solar System object\n    ld.ssmagnr,     -- MPC archive magnitude\n    ld.ssnamenr,    -- MPC object name\n    ld.fid,         -- filter identifier\n    ld.fwhm,        -- FWHM from SExtractor\n    ld.ncalib,      -- number of PS1 calibrators\n    ld.exptime      -- exposure time\nFROM latest_det ld\nORDER BY ld.oid;\n```"
                },
                "in_toks": 3070,
                "out_toks": 2719,
                "id": "chatcmpl-CSyNtSbwJEiZzI04svncK19xOQVy4",
                "created": 1761021337,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "3": {
            "req_id": "104",
            "experiment_id": "run_3",
            "pred_tables": [
                "probability",
                "detection",
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'detection', 'ss_ztf']"
                },
                "in_toks": 682,
                "out_toks": 2838,
                "id": "chatcmpl-CSskiBSH1cLb0zeYUyxdQyO5y98Rg",
                "created": 1760999688,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized: pick up to 30 top-asteroid objects from probability with strict filters (including ranking=1),\n-- then join to ss_ztf to get nearest Solar System info and to detection via candid (PK) to avoid scanning the full detection table.\n-- FWHM, number of PS1 calibrators, and exposure time are not present in the provided schema, so they are returned as NULL placeholders.\n WITH selected_oids AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.ranking = 1\n     AND p.probability > 0.9\n   LIMIT 30)\nSELECT d.oid, -- ZTF object identifier\n d.candid, -- candidate identifier\n ss.ssdistnr, -- distance to nearest Solar System object\n ss.ssmagnr, -- MPC archive magnitude\n ss.ssnamenr, -- MPC object name\n d.fid, -- filter identifier\n NULL::double precision AS fwhm, -- FWHM (not available in provided schema)\n NULL::integer AS nps1_calibrators, -- number of PS1 calibrators (not available)\n NULL::double precision AS exptime -- exposure time (not available)\nFROM selected_oids s\nJOIN ss_ztf ss ON ss.oid = s.oid\nJOIN detection d ON d.candid = ss.candid;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized: pick up to 30 top-asteroid objects from probability with strict filters (including ranking=1),\n-- then join to ss_ztf to get nearest Solar System info and to detection via candid (PK) to avoid scanning the full detection table.\n-- FWHM, number of PS1 calibrators, and exposure time are not present in the provided schema, so they are returned as NULL placeholders.\n WITH selected_oids AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.ranking = 1\n     AND p.probability > 0.9\n   LIMIT 30)\nSELECT d.oid, -- ZTF object identifier\n d.candid, -- candidate identifier\n ss.ssdistnr, -- distance to nearest Solar System object\n ss.ssmagnr, -- MPC archive magnitude\n ss.ssnamenr, -- MPC object name\n d.fid, -- filter identifier\n NULL::double precision AS fwhm, -- FWHM (not available in provided schema)\n NULL::integer AS nps1_calibrators, -- number of PS1 calibrators (not available)\n NULL::double precision AS exptime -- exposure time (not available)\nFROM selected_oids s\nJOIN ss_ztf ss ON ss.oid = s.oid\nJOIN detection d ON d.candid = ss.candid;"
                },
                "in_toks": 2229,
                "out_toks": 2972,
                "id": "chatcmpl-CbHNMmG8lSHwCXJXSL3PoumzPqnpt",
                "created": 1763000964,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1387,
                "out_toks": 911,
                "id": "chatcmpl-CSxZ0vCyoj17teqr79KxAdKov9w8j",
                "created": 1761018182,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3266,
                "out_toks": 4000,
                "id": "chatcmpl-CSxnt0Cx2MxBXHlVRHUiKJBIuHgEe",
                "created": 1761019105,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 30 objects classified as 'asteroid' by the stamp classifier version 'stamp_classifier_1.0.4'\n-- with probability > 0.9. Then list all their candidates (detections) with requested fields.\n-- NOTE: The ALeRCE detection schema provided here does not include Solar System matching\n-- (e.g., ssdistnr, ssmagnr, ssnamenr), FWHM, number of PS1 calibrators, or exposure time.\n-- These are returned as NULL placeholders with conventional aliases.\n\nWITH selected_oids AS (\n    SELECT\n        p.oid\n    FROM probability p\n    WHERE p.classifier_name = 'stamp_classifier'\n      AND p.classifier_version = 'stamp_classifier_1.0.4'\n      AND p.class_name = 'asteroid'\n      AND p.probability > 0.9\n    ORDER BY p.probability DESC\n    LIMIT 30\n)\nSELECT\n    d.oid,                      -- ZTF object identifier\n    d.candid,                   -- candidate identifier\n    NULL::double precision AS ssdistnr,  -- distance to nearest Solar System object (not available in this schema)\n    NULL::double precision AS ssmagnr,   -- MPC archive magnitude (not available in this schema)\n    NULL::text AS ssnamenr,               -- MPC object name (not available in this schema)\n    d.fid,                      -- filter identifier\n    NULL::double precision AS fwhm,       -- FWHM from SExtractor (not available in this schema)\n    NULL::integer AS nps1_calibrators,    -- number of PS1 calibrators used (not available in this schema)\n    NULL::double precision AS exptime     -- exposure time (not available in this schema)\nFROM selected_oids s\nINNER JOIN detection d\n    ON d.oid = s.oid\nORDER BY d.oid, d.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 objects classified as 'asteroid' by the stamp classifier version 'stamp_classifier_1.0.4'\n-- with probability > 0.9. Then list all their candidates (detections) with requested fields.\n-- NOTE: The ALeRCE detection schema provided here does not include Solar System matching\n-- (e.g., ssdistnr, ssmagnr, ssnamenr), FWHM, number of PS1 calibrators, or exposure time.\n-- These are returned as NULL placeholders with conventional aliases.\n\nWITH selected_oids AS (\n    SELECT\n        p.oid\n    FROM probability p\n    WHERE p.classifier_name = 'stamp_classifier'\n      AND p.classifier_version = 'stamp_classifier_1.0.4'\n      AND p.class_name = 'asteroid'\n      AND p.probability > 0.9\n    ORDER BY p.probability DESC\n    LIMIT 30\n)\nSELECT\n    d.oid,                      -- ZTF object identifier\n    d.candid,                   -- candidate identifier\n    NULL::double precision AS ssdistnr,  -- distance to nearest Solar System object (not available in this schema)\n    NULL::double precision AS ssmagnr,   -- MPC archive magnitude (not available in this schema)\n    NULL::text AS ssnamenr,               -- MPC object name (not available in this schema)\n    d.fid,                      -- filter identifier\n    NULL::double precision AS fwhm,       -- FWHM from SExtractor (not available in this schema)\n    NULL::integer AS nps1_calibrators,    -- number of PS1 calibrators used (not available in this schema)\n    NULL::double precision AS exptime     -- exposure time (not available in this schema)\nFROM selected_oids s\nINNER JOIN detection d\n    ON d.oid = s.oid\nORDER BY d.oid, d.mjd;\n```"
                },
                "in_toks": 3070,
                "out_toks": 3874,
                "id": "chatcmpl-CSyOTV8meKrvf397Agg7RgQykAG4I",
                "created": 1761021373,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "4": {
            "req_id": "104",
            "experiment_id": "run_4",
            "pred_tables": [
                "probability",
                "taxonomy",
                "step",
                "object",
                "detection",
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'step', 'object', 'detection', 'ss_ztf']"
                },
                "in_toks": 682,
                "out_toks": 2400,
                "id": "chatcmpl-CSslahVSxB2z1ceGZvbszOVfHI14c",
                "created": 1760999742,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Find up to 30 ZTF objects with P(asteroid | stamp_classifier v1.0.4) > 0.9 and ranking=1\n-- Optimized by pre-limiting using probability joined to ss_ztf, then joining detection by candid (PK)\n-- Note: The provided schema does not include FWHM (SExtractor), number of PS1 calibrators, or exposure time.\n-- These are returned as NULL placeholders.\nWITH base AS\n  (SELECT p.oid,\n          p.probability,\n          ss.candid,\n          ss.ssdistnr,\n          ss.ssmagnr,\n          ss.ssnamenr\n   FROM probability AS p\n   INNER JOIN ss_ztf AS ss ON ss.oid = p.oid\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.ranking = 1\n     AND p.probability > 0.9\n   ORDER BY p.probability DESC\n   LIMIT 30)\nSELECT b.oid,\n       b.candid,\n       b.ssdistnr,\n       b.ssmagnr,\n       b.ssnamenr,\n       d.fid,\n       NULL::DOUBLE PRECISION AS fwhm_sextractor, -- unavailable in provided schema\n NULL::INTEGER AS ps1_calibrators_used, -- unavailable in provided schema\n NULL::DOUBLE PRECISION AS exposure_time -- unavailable in provided schema\nFROM base AS b\nINNER JOIN detection AS d ON d.candid = b.candid\nORDER BY b.probability DESC;",
            "sql_response": {
                "responses": {
                    "0": "-- Find up to 30 ZTF objects with P(asteroid | stamp_classifier v1.0.4) > 0.9 and ranking=1\n-- Optimized by pre-limiting using probability joined to ss_ztf, then joining detection by candid (PK)\n-- Note: The provided schema does not include FWHM (SExtractor), number of PS1 calibrators, or exposure time.\n-- These are returned as NULL placeholders.\nWITH base AS\n  (SELECT p.oid,\n          p.probability,\n          ss.candid,\n          ss.ssdistnr,\n          ss.ssmagnr,\n          ss.ssnamenr\n   FROM probability AS p\n   INNER JOIN ss_ztf AS ss ON ss.oid = p.oid\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.ranking = 1\n     AND p.probability > 0.9\n   ORDER BY p.probability DESC\n   LIMIT 30)\nSELECT b.oid,\n       b.candid,\n       b.ssdistnr,\n       b.ssmagnr,\n       b.ssnamenr,\n       d.fid,\n       NULL::DOUBLE PRECISION AS fwhm_sextractor, -- unavailable in provided schema\n NULL::INTEGER AS ps1_calibrators_used, -- unavailable in provided schema\n NULL::DOUBLE PRECISION AS exposure_time -- unavailable in provided schema\nFROM base AS b\nINNER JOIN detection AS d ON d.candid = b.candid\nORDER BY b.probability DESC;"
                },
                "in_toks": 2669,
                "out_toks": 2350,
                "id": "chatcmpl-CbHO4NmrGc2x49gvwO4EIE3EhLxKK",
                "created": 1763001008,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1986,
                "out_toks": 1167,
                "id": "chatcmpl-CSxZAhc9gD93Wz9c53sjuSrOVkyEL",
                "created": 1761018192,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Find up to 30 ZTF objects with P(asteroid | stamp_classifier v1.0.4) > 0.9\n-- Note: We do NOT apply the default ranking=1 or lc_classifier filters because the user specified a different classifier/version.\n-- Note on unavailable fields: The detection/object/ss_ztf/probability tables provided do not contain\n--   - FWHM from SExtractor\n--   - number of PS1 calibrators used\n--   - exposure time\n-- They are returned as NULL placeholders below. If your deployment has a table with these per-candidate fields,\n-- join it by detection.candid and replace the NULL columns.\n WITH base AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability AS p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.probability > 0.9\n   ORDER BY p.probability DESC\n   LIMIT 30)\nSELECT b.oid,\n       d.candid,\n       ss.ssdistnr,\n       ss.ssmagnr,\n       ss.ssnamenr,\n       d.fid,\n       NULL::DOUBLE PRECISION AS fwhm_sextractor, -- unavailable in provided schema\n NULL::INTEGER AS ps1_calibrators_used, -- unavailable in provided schema\n NULL::DOUBLE PRECISION AS exposure_time -- unavailable in provided schema\nFROM base AS b\nINNER JOIN ss_ztf AS ss ON ss.oid = b.oid\nINNER JOIN detection AS d ON d.candid = ss.candid\nAND d.oid = b.oid\nORDER BY b.probability DESC;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the required outputs and map them to the schema\n- ZTF object identifier: object.oid (but can be taken directly from probability.oid; no need to join object if no extra columns from object are needed)\n- Candidate identifier: detection.candid (linked 1-to-1 with ss_ztf.candid for the chosen candidate per object)\n- Distance to nearest Solar System object: ss_ztf.ssdistnr\n- MPC archive magnitude: ss_ztf.ssmagnr\n- Name of nearest Solar System object: ss_ztf.ssnamenr\n- Filter identifier: detection.fid\n- Not available in the provided schema (cannot be returned): FWHM from SExtractor, number of PS1 calibrators used, exposure time. These fields do not exist in the detection, object, probability, or ss_ztf tables defined above. If they exist in a different local table in your deployment, you would need to join that table on detection.candid; otherwise they cannot be included.\n\n2) Build the base set of ZTF objects using the probability table\n- Create a subquery (alias p) selecting the oids that satisfy the user-specified stamp classifier condition:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.classifier_version = 'stamp_classifier_1.0.4'\n  - probability.class_name = 'asteroid'\n  - probability.probability > 0.9\n- Do NOT apply the default probability.ranking = 1 or classifier_name = 'lc_classifier' because the user explicitly requested the stamp classifier with specific version and class.\n- For reproducibility and to enforce \u201cat most 30 ZTF objects,\u201d order the qualifying rows by probability.probability DESC and limit to 30 distinct objects:\n  - If needed, ensure uniqueness at the oid level (e.g., SELECT DISTINCT oid, probability to guard against duplicates in practical deployments). The primary key (oid, class_name, classifier_name, classifier_version) ensures only one row per object for this class+classifier+version, so DISTINCT on oid is typically redundant, but you can keep DISTINCT oid for safety.\n- Columns to project from this subquery: p.oid, p.probability (to allow optional ordering of the final output by probability).\n\n3) Attach Solar System crossmatch information\n- Inner join the base set (p) to ss_ztf (alias ss) on ss.oid = p.oid.\n- This join enforces the presence of the Solar System nearest-object metadata and provides:\n  - ss.ssdistnr\n  - ss.ssmagnr\n  - ss.ssnamenr\n  - ss.candid (the candidate id chosen for this object in ss_ztf; there is one ss_ztf row per oid)\n\n4) Attach candidate-level detection information for the candidate chosen in ss_ztf\n- Inner join detection (alias d) to the result of step 3 using the candidate identifier:\n  - d.candid = ss.candid\n  - Optionally also include d.oid = p.oid for additional consistency (d.candid is the primary key, so the join on candid is already unique).\n- From detection, select:\n  - d.candid (candidate id)\n  - d.fid (filter identifier as requested)\n- Note: Do not filter on detection table columns other than oid in general for performance; here you are not filtering, only joining on candid (primary key), which is efficient.\n\n5) Final projection and ordering\n- Select the following columns in the final output:\n  - p.oid as the ZTF object identifier\n  - d.candid as the candidate identifier\n  - ss.ssdistnr as the distance to the nearest Solar System object\n  - ss.ssmagnr as the MPC archive magnitude\n  - ss.ssnamenr as the Solar System object name\n  - d.fid as the filter identifier\n- The FWHM from SExtractor, number of PS1 calibrators used, and exposure time are not present in the provided schema and therefore cannot be included. If your deployment has an additional table with these fields keyed by candid (for example, an alerts metadata table), add an inner join on that table using candid and project the relevant columns.\n- Order the final results by p.probability DESC (optional, but consistent with taking the top 30 by probability).\n- Ensure the \u201cat most 30 ZTF objects\u201d constraint is applied in the base probability subquery (step 2) before joins, so the limit is enforced at the object level, not the row level after expanding with joins.\n\n6) Indexes and performance considerations\n- probability: the filters on classifier_name, classifier_version, class_name, and probability > 0.9 will use ix_probabilities_probability (btree) and the primary key; the hash index on oid also helps joins if needed.\n- ss_ztf: primary key on oid supports the join ss.oid = p.oid; the btree on candid is not needed for this join but is used in the next step.\n- detection: primary key on candid supports the join d.candid = ss.candid efficiently.\n- Avoid scanning the detection table by other columns.\n\n7) Edge cases\n- If fewer than 30 objects satisfy both the stamp-classifier condition and have a corresponding ss_ztf row, the result set will have fewer than 30 rows.\n- If you want one row per object deterministically, using ss_ztf to pick the candidate ensures a single detection row per object because d.candid is unique and ss_ztf is 1 row per oid."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the required outputs and map them to the schema\n- ZTF object identifier: object.oid (but can be taken directly from probability.oid; no need to join object if no extra columns from object are needed)\n- Candidate identifier: detection.candid (linked 1-to-1 with ss_ztf.candid for the chosen candidate per object)\n- Distance to nearest Solar System object: ss_ztf.ssdistnr\n- MPC archive magnitude: ss_ztf.ssmagnr\n- Name of nearest Solar System object: ss_ztf.ssnamenr\n- Filter identifier: detection.fid\n- Not available in the provided schema (cannot be returned): FWHM from SExtractor, number of PS1 calibrators used, exposure time. These fields do not exist in the detection, object, probability, or ss_ztf tables defined above. If they exist in a different local table in your deployment, you would need to join that table on detection.candid; otherwise they cannot be included.\n\n2) Build the base set of ZTF objects using the probability table\n- Create a subquery (alias p) selecting the oids that satisfy the user-specified stamp classifier condition:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.classifier_version = 'stamp_classifier_1.0.4'\n  - probability.class_name = 'asteroid'\n  - probability.probability > 0.9\n- Do NOT apply the default probability.ranking = 1 or classifier_name = 'lc_classifier' because the user explicitly requested the stamp classifier with specific version and class.\n- For reproducibility and to enforce \u201cat most 30 ZTF objects,\u201d order the qualifying rows by probability.probability DESC and limit to 30 distinct objects:\n  - If needed, ensure uniqueness at the oid level (e.g., SELECT DISTINCT oid, probability to guard against duplicates in practical deployments). The primary key (oid, class_name, classifier_name, classifier_version) ensures only one row per object for this class+classifier+version, so DISTINCT on oid is typically redundant, but you can keep DISTINCT oid for safety.\n- Columns to project from this subquery: p.oid, p.probability (to allow optional ordering of the final output by probability).\n\n3) Attach Solar System crossmatch information\n- Inner join the base set (p) to ss_ztf (alias ss) on ss.oid = p.oid.\n- This join enforces the presence of the Solar System nearest-object metadata and provides:\n  - ss.ssdistnr\n  - ss.ssmagnr\n  - ss.ssnamenr\n  - ss.candid (the candidate id chosen for this object in ss_ztf; there is one ss_ztf row per oid)\n\n4) Attach candidate-level detection information for the candidate chosen in ss_ztf\n- Inner join detection (alias d) to the result of step 3 using the candidate identifier:\n  - d.candid = ss.candid\n  - Optionally also include d.oid = p.oid for additional consistency (d.candid is the primary key, so the join on candid is already unique).\n- From detection, select:\n  - d.candid (candidate id)\n  - d.fid (filter identifier as requested)\n- Note: Do not filter on detection table columns other than oid in general for performance; here you are not filtering, only joining on candid (primary key), which is efficient.\n\n5) Final projection and ordering\n- Select the following columns in the final output:\n  - p.oid as the ZTF object identifier\n  - d.candid as the candidate identifier\n  - ss.ssdistnr as the distance to the nearest Solar System object\n  - ss.ssmagnr as the MPC archive magnitude\n  - ss.ssnamenr as the Solar System object name\n  - d.fid as the filter identifier\n- The FWHM from SExtractor, number of PS1 calibrators used, and exposure time are not present in the provided schema and therefore cannot be included. If your deployment has an additional table with these fields keyed by candid (for example, an alerts metadata table), add an inner join on that table using candid and project the relevant columns.\n- Order the final results by p.probability DESC (optional, but consistent with taking the top 30 by probability).\n- Ensure the \u201cat most 30 ZTF objects\u201d constraint is applied in the base probability subquery (step 2) before joins, so the limit is enforced at the object level, not the row level after expanding with joins.\n\n6) Indexes and performance considerations\n- probability: the filters on classifier_name, classifier_version, class_name, and probability > 0.9 will use ix_probabilities_probability (btree) and the primary key; the hash index on oid also helps joins if needed.\n- ss_ztf: primary key on oid supports the join ss.oid = p.oid; the btree on candid is not needed for this join but is used in the next step.\n- detection: primary key on candid supports the join d.candid = ss.candid efficiently.\n- Avoid scanning the detection table by other columns.\n\n7) Edge cases\n- If fewer than 30 objects satisfy both the stamp-classifier condition and have a corresponding ss_ztf row, the result set will have fewer than 30 rows.\n- If you want one row per object deterministically, using ss_ztf to pick the candidate ensures a single detection row per object because d.candid is unique and ss_ztf is 1 row per oid."
                    },
                    "in_toks": 3865,
                    "out_toks": 5539,
                    "id": "chatcmpl-Cb6V68OzqgGxVRXXAD1w2Cs2gpBAL",
                    "created": 1762959160,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Find up to 30 ZTF objects with P(asteroid | stamp_classifier v1.0.4) > 0.9\n-- Note: We do NOT apply the default ranking=1 or lc_classifier filters because the user specified a different classifier/version.\n-- Note on unavailable fields: The detection/object/ss_ztf/probability tables provided do not contain\n--   - FWHM from SExtractor\n--   - number of PS1 calibrators used\n--   - exposure time\n-- They are returned as NULL placeholders below. If your deployment has a table with these per-candidate fields,\n-- join it by detection.candid and replace the NULL columns.\n WITH base AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability AS p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.probability > 0.9\n   ORDER BY p.probability DESC\n   LIMIT 30)\nSELECT b.oid,\n       d.candid,\n       ss.ssdistnr,\n       ss.ssmagnr,\n       ss.ssnamenr,\n       d.fid,\n       NULL::DOUBLE PRECISION AS fwhm_sextractor, -- unavailable in provided schema\n NULL::INTEGER AS ps1_calibrators_used, -- unavailable in provided schema\n NULL::DOUBLE PRECISION AS exposure_time -- unavailable in provided schema\nFROM base AS b\nINNER JOIN ss_ztf AS ss ON ss.oid = b.oid\nINNER JOIN detection AS d ON d.candid = ss.candid\nAND d.oid = b.oid\nORDER BY b.probability DESC;"
                        },
                        "in_toks": 3704,
                        "out_toks": 2565,
                        "id": "chatcmpl-Cb6XRpxy0HVUXQwHWW1E6yyexZ244",
                        "created": 1762959305,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "5": {
            "req_id": "104",
            "experiment_id": "run_5",
            "pred_tables": [
                "probability",
                "detection",
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'detection', 'ss_ztf']"
                },
                "in_toks": 682,
                "out_toks": 2327,
                "id": "chatcmpl-CZMzYBwNj8yQUfEEGsWVIM5EDoxXV",
                "created": 1762545896,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Find up to 30 ZTF objects classified as 'asteroid' by stamp_classifier v1.0.4 with probability > 0.9\n-- Returns: ZTF oid, candidate id, distance to nearest Solar System object, MPC magnitude and name, and filter id.\n-- Note: FWHM from SExtractor, number of PS1 calibrators, and exposure time are not available in the provided tables.\n-- Optimization: limit to 30 objects before joining the large detection table, and join detection by its primary key (candid).\nWITH p AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE class_name = 'asteroid'\n     AND classifier_name = 'stamp_classifier'\n     AND classifier_version = 'stamp_classifier_1.0.4'\n     AND ranking = 1\n     AND probability > 0.9),\n     p30 AS\n  (SELECT p.oid,\n          p.probability,\n          s.candid,\n          s.ssdistnr,\n          s.ssmagnr,\n          s.ssnamenr\n   FROM p\n   JOIN ss_ztf s ON s.oid = p.oid\n   ORDER BY p.probability DESC,\n            p.oid ASC\n   LIMIT 30)\nSELECT p30.oid AS ztf_oid,\n       p30.candid,\n       p30.ssdistnr,\n       p30.ssmagnr,\n       p30.ssnamenr,\n       d.fid\nFROM p30\nJOIN detection d ON d.candid = p30.candid\nORDER BY p30.probability DESC,\n         p30.oid ASC;",
            "sql_response": {
                "responses": {
                    "0": "-- Find up to 30 ZTF objects classified as 'asteroid' by stamp_classifier v1.0.4 with probability > 0.9\n-- Returns: ZTF oid, candidate id, distance to nearest Solar System object, MPC magnitude and name, and filter id.\n-- Note: FWHM from SExtractor, number of PS1 calibrators, and exposure time are not available in the provided tables.\n-- Optimization: limit to 30 objects before joining the large detection table, and join detection by its primary key (candid).\nWITH p AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE class_name = 'asteroid'\n     AND classifier_name = 'stamp_classifier'\n     AND classifier_version = 'stamp_classifier_1.0.4'\n     AND ranking = 1\n     AND probability > 0.9),\n     p30 AS\n  (SELECT p.oid,\n          p.probability,\n          s.candid,\n          s.ssdistnr,\n          s.ssmagnr,\n          s.ssnamenr\n   FROM p\n   JOIN ss_ztf s ON s.oid = p.oid\n   ORDER BY p.probability DESC,\n            p.oid ASC\n   LIMIT 30)\nSELECT p30.oid AS ztf_oid,\n       p30.candid,\n       p30.ssdistnr,\n       p30.ssmagnr,\n       p30.ssnamenr,\n       d.fid\nFROM p30\nJOIN detection d ON d.candid = p30.candid\nORDER BY p30.probability DESC,\n         p30.oid ASC;"
                },
                "in_toks": 1906,
                "out_toks": 2517,
                "id": "chatcmpl-CbHOf69cWBdkRj4zLxFa7jYpcZ3ws",
                "created": 1763001045,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1387,
                "out_toks": 1423,
                "id": "chatcmpl-CZYYaMh5mR4bcb5loZXIShnlUvTgx",
                "created": 1762590352,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Find up to 30 objects classified as 'asteroid' by stamp_classifier v1.0.4 with probability > 0.9\n-- Note: The requested candidate-level columns \"FWHM from SExtractor\", \"number of PS1 calibrators used\", and \"exposure time\" are not present in the provided tables, so they cannot be returned.\n WITH p AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE class_name = 'asteroid'\n     AND classifier_name = 'stamp_classifier'\n     AND classifier_version = 'stamp_classifier_1.0.4'\n     AND ranking = 1\n     AND probability > 0.9)\nSELECT p.oid,\n       d.candid,\n       s.ssdistnr,\n       s.ssmagnr,\n       s.ssnamenr,\n       d.fid\nFROM p\nINNER JOIN ss_ztf s ON s.oid = p.oid\nINNER JOIN detection d ON d.oid = s.oid\nAND d.candid = s.candid\nORDER BY p.probability DESC,\n         p.oid ASC\nLIMIT 30;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nNote about requested columns not present in the provided schema\n- The following requested columns are not available in the provided tables (probability, detection, ss_ztf): \u201cFWHM from SExtractor\u201d, \u201cnumber of PS1 calibrators used\u201d, and \u201cexposure time\u201d. They cannot be selected unless additional tables/columns exist beyond what is specified. The plan below returns all other requested fields.\n\nGoal\n- Find up to 30 ZTF objects (object identifier = probability.oid) whose stamp classifier (version 'stamp_classifier_1.0.4') assigns class_name 'asteroid' with probability > 0.9. \n- Return: object identifier (oid), candidate identifier (candid), distance to nearest Solar System object (ssdistnr), MPC archive magnitude (ssmagnr), name (ssnamenr), and filter identifier (fid). \n- Constrain to the candidate associated to the nearest Solar System object by tying detection.candid to ss_ztf.candid for the same oid.\n\nConstants and constraints to use\n- Classifier and class: probability.classifier_name = 'stamp_classifier'; probability.classifier_version = 'stamp_classifier_1.0.4'; probability.class_name = 'asteroid'\n- Probability threshold: probability.probability > 0.9\n- Ranking default: probability.ranking = 1 (as per default rule unless the user specifies otherwise; the user did not specify a different ranking condition)\n- Joins: link by oid; for candidate-level data, also join on candid = ss_ztf.candid\n- Limit and ordering: at most 30 rows; order by probability.probability DESC to prioritize highest probabilities\n- Tables/columns to use:\n  - probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n  - ss_ztf(oid, candid, ssdistnr, ssmagnr, ssnamenr)\n  - detection(oid, candid, fid)\n- Index usage considerations: ix_classification_rank1 (ranking=1), ix_probabilities_probability, ix_probabilities_oid, ix_ss_ztf_candid, ix_ndetection_oid\n\nStep-by-step query construction (no SQL, just logic)\n\n1) Subquery P (qualifying asteroids in the stamp classifier)\n- From probability\n- WHERE:\n  - class_name = 'asteroid'\n  - classifier_name = 'stamp_classifier'\n  - classifier_version = 'stamp_classifier_1.0.4'\n  - ranking = 1\n  - probability > 0.9\n- SELECT: oid, probability\n- This isolates only top-1 asteroid classifications with high confidence for the specified classifier version.\n\n2) Subquery S (nearest Solar System object linkage)\n- From ss_ztf\n- SELECT: oid, candid, ssdistnr, ssmagnr, ssnamenr\n- No additional filters are strictly required. Note: ssnamenr may be the literal string 'null' (per schema description) even when a Solar System object isn\u2019t known; do not filter it out unless explicitly required.\n\n3) Intersection of available objects in P and S\n- Build a set OIDS_OK = (SELECT oid FROM P) INTERSECT (SELECT oid FROM S)\n- This creates the object set that both (a) meets the asteroid probability condition in the stamp classifier and (b) has an ss_ztf record.\n\n4) Candidate-level detection rows for the ss_ztf candid\n- Since we must report candidate-level fields, tie detection to the same candidate referenced in ss_ztf by joining on both oid and candid.\n- Create three subqueries to cover each filter band explicitly (to fulfill the requirement of using UNION), even though only one will match the ss_ztf.candid:\n  - D1: detection rows for fid = 1 (g), joined to S on detection.oid = S.oid AND detection.candid = S.candid, and restricted to detection.oid IN OIDS_OK. SELECT: detection.oid, detection.candid, detection.fid\n  - D2: same as D1 but with fid = 2 (r)\n  - D3: same as D1 but with fid = 3 (i)\n- Union these three subqueries:\n  - D_UNION = D1 UNION ALL D2 UNION ALL D3\n- Because detection.candid is fixed by S, at most one of D1/D2/D3 will contribute a row per oid; the UNION ensures coverage of all bands while keeping the logic explicit.\n\n5) Final assembly\n- INNER JOIN P to S on P.oid = S.oid (ensures asteroid classification and Solar System proximity info are on the same object)\n- INNER JOIN D_UNION on D_UNION.oid = S.oid AND D_UNION.candid = S.candid (ensures candidate-level fields come from the same candidate used in ss_ztf)\n- SELECT the requested columns available in the schema:\n  - P.oid AS the ZTF object identifier\n  - D_UNION.candid AS the candidate identifier\n  - S.ssdistnr AS distance to nearest Solar System object\n  - S.ssmagnr AS MPC archive magnitude\n  - S.ssnamenr AS Solar System object name\n  - D_UNION.fid AS filter identifier\n- Note: The following requested columns cannot be returned because they do not exist in the provided tables/columns: \u201cFWHM from SExtractor\u201d, \u201cnumber of PS1 calibrators used\u201d, \u201cexposure time\u201d.\n\n6) Ordering and limiting\n- ORDER BY P.probability DESC (optionally add P.oid ASC as a tiebreaker)\n- LIMIT 30\n- This enforces \u201cat most 30\u201d results, prioritizing higher asteroid probabilities.\n\n7) Integrity and performance notes\n- All filtering is done in the probability subquery P to leverage ix_classification_rank1 and ix_probabilities_probability early, minimizing row counts before joins.\n- The OIDS_OK intersection reduces the subsequent joins to only objects that have both classification and ss_ztf entries.\n- The detection join uses detection.oid (hash index ix_ndetection_oid) and an equality on candid for precise candidate selection.\n- Avoid any additional filtering on detection beyond the join and fid constants (as recommended: do not filter detection by other parameters).\n- If an object has no matching detection for the ss_ztf.candid (unlikely), the INNER JOIN to D_UNION will drop it; switch to LEFT JOIN only if you prefer to keep such rows with NULL fid (not requested here).\n\nOutput schema (columns in the final result)\n- oid (from probability) \u2014 ZTF object identifier\n- candid (from detection) \u2014 candidate identifier\n- ssdistnr (from ss_ztf) \u2014 distance to nearest known solar system object\n- ssmagnr (from ss_ztf) \u2014 MPC archive magnitude\n- ssnamenr (from ss_ztf) \u2014 name of nearest solar system object (may be string 'null')\n- fid (from detection) \u2014 filter identifier\n\nUnavailable requested columns (cannot be selected given the provided schema)\n- FWHM from SExtractor\n- Number of PS1 calibrators used\n- Exposure time\n\nThis plan uses JOINs, an INTERSECT (to enforce the object set overlap between P and S), and a UNION ALL (to explicitly cover all possible fid values for the referenced candid)."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nNote about requested columns not present in the provided schema\n- The following requested columns are not available in the provided tables (probability, detection, ss_ztf): \u201cFWHM from SExtractor\u201d, \u201cnumber of PS1 calibrators used\u201d, and \u201cexposure time\u201d. They cannot be selected unless additional tables/columns exist beyond what is specified. The plan below returns all other requested fields.\n\nGoal\n- Find up to 30 ZTF objects (object identifier = probability.oid) whose stamp classifier (version 'stamp_classifier_1.0.4') assigns class_name 'asteroid' with probability > 0.9. \n- Return: object identifier (oid), candidate identifier (candid), distance to nearest Solar System object (ssdistnr), MPC archive magnitude (ssmagnr), name (ssnamenr), and filter identifier (fid). \n- Constrain to the candidate associated to the nearest Solar System object by tying detection.candid to ss_ztf.candid for the same oid.\n\nConstants and constraints to use\n- Classifier and class: probability.classifier_name = 'stamp_classifier'; probability.classifier_version = 'stamp_classifier_1.0.4'; probability.class_name = 'asteroid'\n- Probability threshold: probability.probability > 0.9\n- Ranking default: probability.ranking = 1 (as per default rule unless the user specifies otherwise; the user did not specify a different ranking condition)\n- Joins: link by oid; for candidate-level data, also join on candid = ss_ztf.candid\n- Limit and ordering: at most 30 rows; order by probability.probability DESC to prioritize highest probabilities\n- Tables/columns to use:\n  - probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n  - ss_ztf(oid, candid, ssdistnr, ssmagnr, ssnamenr)\n  - detection(oid, candid, fid)\n- Index usage considerations: ix_classification_rank1 (ranking=1), ix_probabilities_probability, ix_probabilities_oid, ix_ss_ztf_candid, ix_ndetection_oid\n\nStep-by-step query construction (no SQL, just logic)\n\n1) Subquery P (qualifying asteroids in the stamp classifier)\n- From probability\n- WHERE:\n  - class_name = 'asteroid'\n  - classifier_name = 'stamp_classifier'\n  - classifier_version = 'stamp_classifier_1.0.4'\n  - ranking = 1\n  - probability > 0.9\n- SELECT: oid, probability\n- This isolates only top-1 asteroid classifications with high confidence for the specified classifier version.\n\n2) Subquery S (nearest Solar System object linkage)\n- From ss_ztf\n- SELECT: oid, candid, ssdistnr, ssmagnr, ssnamenr\n- No additional filters are strictly required. Note: ssnamenr may be the literal string 'null' (per schema description) even when a Solar System object isn\u2019t known; do not filter it out unless explicitly required.\n\n3) Intersection of available objects in P and S\n- Build a set OIDS_OK = (SELECT oid FROM P) INTERSECT (SELECT oid FROM S)\n- This creates the object set that both (a) meets the asteroid probability condition in the stamp classifier and (b) has an ss_ztf record.\n\n4) Candidate-level detection rows for the ss_ztf candid\n- Since we must report candidate-level fields, tie detection to the same candidate referenced in ss_ztf by joining on both oid and candid.\n- Create three subqueries to cover each filter band explicitly (to fulfill the requirement of using UNION), even though only one will match the ss_ztf.candid:\n  - D1: detection rows for fid = 1 (g), joined to S on detection.oid = S.oid AND detection.candid = S.candid, and restricted to detection.oid IN OIDS_OK. SELECT: detection.oid, detection.candid, detection.fid\n  - D2: same as D1 but with fid = 2 (r)\n  - D3: same as D1 but with fid = 3 (i)\n- Union these three subqueries:\n  - D_UNION = D1 UNION ALL D2 UNION ALL D3\n- Because detection.candid is fixed by S, at most one of D1/D2/D3 will contribute a row per oid; the UNION ensures coverage of all bands while keeping the logic explicit.\n\n5) Final assembly\n- INNER JOIN P to S on P.oid = S.oid (ensures asteroid classification and Solar System proximity info are on the same object)\n- INNER JOIN D_UNION on D_UNION.oid = S.oid AND D_UNION.candid = S.candid (ensures candidate-level fields come from the same candidate used in ss_ztf)\n- SELECT the requested columns available in the schema:\n  - P.oid AS the ZTF object identifier\n  - D_UNION.candid AS the candidate identifier\n  - S.ssdistnr AS distance to nearest Solar System object\n  - S.ssmagnr AS MPC archive magnitude\n  - S.ssnamenr AS Solar System object name\n  - D_UNION.fid AS filter identifier\n- Note: The following requested columns cannot be returned because they do not exist in the provided tables/columns: \u201cFWHM from SExtractor\u201d, \u201cnumber of PS1 calibrators used\u201d, \u201cexposure time\u201d.\n\n6) Ordering and limiting\n- ORDER BY P.probability DESC (optionally add P.oid ASC as a tiebreaker)\n- LIMIT 30\n- This enforces \u201cat most 30\u201d results, prioritizing higher asteroid probabilities.\n\n7) Integrity and performance notes\n- All filtering is done in the probability subquery P to leverage ix_classification_rank1 and ix_probabilities_probability early, minimizing row counts before joins.\n- The OIDS_OK intersection reduces the subsequent joins to only objects that have both classification and ss_ztf entries.\n- The detection join uses detection.oid (hash index ix_ndetection_oid) and an equality on candid for precise candidate selection.\n- Avoid any additional filtering on detection beyond the join and fid constants (as recommended: do not filter detection by other parameters).\n- If an object has no matching detection for the ss_ztf.candid (unlikely), the INNER JOIN to D_UNION will drop it; switch to LEFT JOIN only if you prefer to keep such rows with NULL fid (not requested here).\n\nOutput schema (columns in the final result)\n- oid (from probability) \u2014 ZTF object identifier\n- candid (from detection) \u2014 candidate identifier\n- ssdistnr (from ss_ztf) \u2014 distance to nearest known solar system object\n- ssmagnr (from ss_ztf) \u2014 MPC archive magnitude\n- ssnamenr (from ss_ztf) \u2014 name of nearest solar system object (may be string 'null')\n- fid (from detection) \u2014 filter identifier\n\nUnavailable requested columns (cannot be selected given the provided schema)\n- FWHM from SExtractor\n- Number of PS1 calibrators used\n- Exposure time\n\nThis plan uses JOINs, an INTERSECT (to enforce the object set overlap between P and S), and a UNION ALL (to explicitly cover all possible fid values for the referenced candid)."
                    },
                    "in_toks": 3266,
                    "out_toks": 6170,
                    "id": "chatcmpl-Cb6YPPQWcAFnG6uy0hF8ybaKEqct7",
                    "created": 1762959365,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Find up to 30 objects classified as 'asteroid' by stamp_classifier v1.0.4 with probability > 0.9\n-- Note: The requested candidate-level columns \"FWHM from SExtractor\", \"number of PS1 calibrators used\", and \"exposure time\" are not present in the provided tables, so they cannot be returned.\n WITH p AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE class_name = 'asteroid'\n     AND classifier_name = 'stamp_classifier'\n     AND classifier_version = 'stamp_classifier_1.0.4'\n     AND ranking = 1\n     AND probability > 0.9)\nSELECT p.oid,\n       d.candid,\n       s.ssdistnr,\n       s.ssmagnr,\n       s.ssnamenr,\n       d.fid\nFROM p\nINNER JOIN ss_ztf s ON s.oid = p.oid\nINNER JOIN detection d ON d.oid = s.oid\nAND d.candid = s.candid\nORDER BY p.probability DESC,\n         p.oid ASC\nLIMIT 30;"
                        },
                        "in_toks": 3480,
                        "out_toks": 2045,
                        "id": "chatcmpl-Cb6aeZSK7lHiYxegKTVdi5GU1TID8",
                        "created": 1762959504,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "6": {
            "req_id": "104",
            "experiment_id": "run_6",
            "pred_tables": [
                "probability",
                "taxonomy",
                "detection",
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'detection', 'ss_ztf']"
                },
                "in_toks": 682,
                "out_toks": 1562,
                "id": "chatcmpl-CZN0GGD5oRXzZK2YECpSIREGeHkXj",
                "created": 1762545940,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "WITH top_asteroid AS\n  (-- Objects with asteroid probability > 0.9 for the requested classifier/version (keep top 30 by probability)\n SELECT p.oid,\n        p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.ranking = 1\n     AND p.probability > 0.9\n   ORDER BY p.probability DESC\n   LIMIT 30),\n     latest_detection AS\n  (-- Latest detection per object to provide candidate-level fields\n SELECT DISTINCT ON (d.oid) d.*\n   FROM detection d\n   JOIN top_asteroid ta ON ta.oid = d.oid\n   ORDER BY d.oid,\n            d.mjd DESC)\nSELECT ta.oid, -- ZTF object identifier\n ld.candid, -- ZTF candidate identifier\n sst.ssdistnr, -- distance to nearest Solar System object\n sst.ssmagnr, -- MPC archive magnitude\n sst.ssnamenr, -- MPC name\n ld.fid, -- filter identifier (1=g; 2=r; 3=i)\n NULL::DOUBLE PRECISION AS fwhm, -- FWHM from SExtractor (not available in provided detection schema)\n NULL::INTEGER AS ncalib, -- number of PS1 calibrators (not available in provided detection schema)\n NULL::DOUBLE PRECISION AS exptime -- exposure time (not available in provided detection schema)\nFROM top_asteroid ta\nJOIN latest_detection ld ON ld.oid = ta.oid\nLEFT JOIN ss_ztf sst ON sst.oid = ta.oid\nORDER BY ta.probability DESC;",
            "sql_response": {
                "responses": {
                    "0": "WITH top_asteroid AS\n  (-- Objects with asteroid probability > 0.9 for the requested classifier/version (keep top 30 by probability)\n SELECT p.oid,\n        p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.ranking = 1\n     AND p.probability > 0.9\n   ORDER BY p.probability DESC\n   LIMIT 30),\n     latest_detection AS\n  (-- Latest detection per object to provide candidate-level fields\n SELECT DISTINCT ON (d.oid) d.*\n   FROM detection d\n   JOIN top_asteroid ta ON ta.oid = d.oid\n   ORDER BY d.oid,\n            d.mjd DESC)\nSELECT ta.oid, -- ZTF object identifier\n ld.candid, -- ZTF candidate identifier\n sst.ssdistnr, -- distance to nearest Solar System object\n sst.ssmagnr, -- MPC archive magnitude\n sst.ssnamenr, -- MPC name\n ld.fid, -- filter identifier (1=g; 2=r; 3=i)\n NULL::DOUBLE PRECISION AS fwhm, -- FWHM from SExtractor (not available in provided detection schema)\n NULL::INTEGER AS ncalib, -- number of PS1 calibrators (not available in provided detection schema)\n NULL::DOUBLE PRECISION AS exptime -- exposure time (not available in provided detection schema)\nFROM top_asteroid ta\nJOIN latest_detection ld ON ld.oid = ta.oid\nLEFT JOIN ss_ztf sst ON sst.oid = ta.oid\nORDER BY ta.probability DESC;"
                },
                "in_toks": 2300,
                "out_toks": 2128,
                "id": "chatcmpl-CbHPEw9Ojzp2yxNwvCJMQtBMtK3gM",
                "created": 1763001080,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1432,
                "out_toks": 783,
                "id": "chatcmpl-CZYZ0SPDBatEmBVjow4qCm6aSlvSV",
                "created": 1762590378,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3311,
                "out_toks": 4000,
                "id": "chatcmpl-CZZzjteDVWVDdCqJJSfLU08boQ0KQ",
                "created": 1762595879,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Top 30 ZTF objects with high asteroid probability from the specified stamp classifier version\nWITH top_asteroid AS (\n    SELECT\n        p.oid,\n        p.probability\n    FROM probability p\n    WHERE\n        p.classifier_name = 'stamp_classifier'\n        AND p.classifier_version = 'stamp_classifier_1.0.4'\n        AND p.class_name = 'asteroid'\n        AND p.ranking = 1 -- keep only the most likely class per object\n        AND p.probability > 0.9\n    ORDER BY p.probability DESC\n    LIMIT 30\n),\n-- One (latest) candidate per object to retrieve candidate-level fields\nlatest_detection AS (\n    SELECT DISTINCT ON (d.oid)\n        d.*\n    FROM detection d\n    INNER JOIN top_asteroid ta ON ta.oid = d.oid\n    ORDER BY d.oid, d.mjd DESC\n)\nSELECT\n    ta.oid,                 -- ZTF object identifier\n    ld.candid,              -- ZTF candidate identifier\n    ld.ssdistnr,            -- distance to nearest Solar System object (arcsec)\n    ld.ssmagnr,             -- MPC archive magnitude\n    ld.ssnamenr,            -- MPC name of the Solar System object\n    ld.fid,                 -- filter identifier (1=g, 2=r, 3=i)\n    ld.fwhm,                -- FWHM from SExtractor (arcsec)\n    ld.ncalib,              -- number of PS1 calibrators used\n    ld.exptime              -- exposure time (seconds)\nFROM top_asteroid ta\nINNER JOIN latest_detection ld ON ld.oid = ta.oid\nORDER BY ta.probability DESC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Top 30 ZTF objects with high asteroid probability from the specified stamp classifier version\nWITH top_asteroid AS (\n    SELECT\n        p.oid,\n        p.probability\n    FROM probability p\n    WHERE\n        p.classifier_name = 'stamp_classifier'\n        AND p.classifier_version = 'stamp_classifier_1.0.4'\n        AND p.class_name = 'asteroid'\n        AND p.ranking = 1 -- keep only the most likely class per object\n        AND p.probability > 0.9\n    ORDER BY p.probability DESC\n    LIMIT 30\n),\n-- One (latest) candidate per object to retrieve candidate-level fields\nlatest_detection AS (\n    SELECT DISTINCT ON (d.oid)\n        d.*\n    FROM detection d\n    INNER JOIN top_asteroid ta ON ta.oid = d.oid\n    ORDER BY d.oid, d.mjd DESC\n)\nSELECT\n    ta.oid,                 -- ZTF object identifier\n    ld.candid,              -- ZTF candidate identifier\n    ld.ssdistnr,            -- distance to nearest Solar System object (arcsec)\n    ld.ssmagnr,             -- MPC archive magnitude\n    ld.ssnamenr,            -- MPC name of the Solar System object\n    ld.fid,                 -- filter identifier (1=g, 2=r, 3=i)\n    ld.fwhm,                -- FWHM from SExtractor (arcsec)\n    ld.ncalib,              -- number of PS1 calibrators used\n    ld.exptime              -- exposure time (seconds)\nFROM top_asteroid ta\nINNER JOIN latest_detection ld ON ld.oid = ta.oid\nORDER BY ta.probability DESC;\n```"
                },
                "in_toks": 3070,
                "out_toks": 3449,
                "id": "chatcmpl-CZb0gcQlgRSDl6hgBR16rHZ7J6d1l",
                "created": 1762599782,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "7": {
            "req_id": "104",
            "experiment_id": "run_7",
            "pred_tables": [
                "probability",
                "detection",
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'detection', 'ss_ztf']"
                },
                "in_toks": 682,
                "out_toks": 2263,
                "id": "chatcmpl-CZN0rem4sd6HeEyZJIXhF14kS49Z8",
                "created": 1762545977,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Top-30 highest-probability asteroid objects from the stamp classifier v1.0.4 (ranking=1), limited early for performance\nWITH top_p AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.class_name = 'asteroid'\n     AND p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.ranking = 1\n     AND p.probability > 0.9\n   ORDER BY p.probability DESC\n   LIMIT 30)\nSELECT d.oid, -- ZTF object identifier\n d.candid, -- candidate identifier\n s.ssdistnr, -- distance to nearest Solar System object\n s.ssmagnr, -- MPC archive magnitude\n s.ssnamenr, -- MPC name\n d.fid, -- filter identifier\n NULL::double precision AS fwhm, -- FWHM (not available in provided schema)\n NULL::integer AS n_ps1_calibrators, -- number of PS1 calibrators (not available)\n NULL::double precision AS exptime -- exposure time (not available)\nFROM top_p tp\nJOIN ss_ztf s ON s.oid = tp.oid -- one ss_ztf row per object (PK on oid)\nJOIN detection d ON d.candid = s.candid\nAND d.oid = s.oid -- join on candid (PK) and oid\nORDER BY tp.probability DESC;",
            "sql_response": {
                "responses": {
                    "0": "-- Top-30 highest-probability asteroid objects from the stamp classifier v1.0.4 (ranking=1), limited early for performance\nWITH top_p AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.class_name = 'asteroid'\n     AND p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.ranking = 1\n     AND p.probability > 0.9\n   ORDER BY p.probability DESC\n   LIMIT 30)\nSELECT d.oid, -- ZTF object identifier\n d.candid, -- candidate identifier\n s.ssdistnr, -- distance to nearest Solar System object\n s.ssmagnr, -- MPC archive magnitude\n s.ssnamenr, -- MPC name\n d.fid, -- filter identifier\n NULL::double precision AS fwhm, -- FWHM (not available in provided schema)\n NULL::integer AS n_ps1_calibrators, -- number of PS1 calibrators (not available)\n NULL::double precision AS exptime -- exposure time (not available)\nFROM top_p tp\nJOIN ss_ztf s ON s.oid = tp.oid -- one ss_ztf row per object (PK on oid)\nJOIN detection d ON d.candid = s.candid\nAND d.oid = s.oid -- join on candid (PK) and oid\nORDER BY tp.probability DESC;"
                },
                "in_toks": 2142,
                "out_toks": 2137,
                "id": "chatcmpl-CbHPtY7o5LUPgwmhknTzVqO8klrJC",
                "created": 1763001121,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1387,
                "out_toks": 1167,
                "id": "chatcmpl-CZYZGa15RRt56qA7knyiafTCkXQy0",
                "created": 1762590394,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Find up to 30 ZTF objects likely 'asteroid' by the stamp classifier v1.0.4 with probability > 0.9\n-- Note: Using classifier_name='stamp_classifier'; not enforcing ranking=1 as the user requested a probability threshold.\n-- Note: The provided 'detection' schema does not include FWHM, number of PS1 calibrators, or exposure time; returning NULL placeholders for these.\nWITH p AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE class_name = 'asteroid'\n     AND classifier_name = 'stamp_classifier'\n     AND classifier_version = 'stamp_classifier_1.0.4'\n     AND probability > 0.9),\n     ps AS\n  (SELECT p.oid,\n          p.probability,\n          s.candid,\n          s.ssdistnr,\n          s.ssmagnr,\n          s.ssnamenr\n   FROM p\n   INNER JOIN ss_ztf s ON s.oid = p.oid)\nSELECT d.oid,\n       d.candid,\n       ps.ssdistnr,\n       ps.ssmagnr,\n       ps.ssnamenr,\n       d.fid,\n       NULL::DOUBLE PRECISION AS fwhm, -- FWHM from SExtractor (not available in provided schema)\n NULL::INTEGER AS n_ps1_calibrators, -- number of PS1 calibrators used (not available in provided schema)\n NULL::DOUBLE PRECISION AS exptime -- exposure time (not available in provided schema)\nFROM ps\nINNER JOIN detection d ON d.candid = ps.candid\nAND d.oid = ps.oid\nORDER BY ps.probability DESC\nLIMIT 30;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nReturn up to 30 ZTF objects whose \u201cstamp classifier\u201d assigns probability > 0.9 to class 'asteroid' for version 'stamp_classifier_1.0.4', and for each object return:\n- Object identifier (ZTF oid) and candidate identifier (candid)\n- ss_ztf: ssdistnr, ssmagnr (MPC archive magnitude), ssnamenr (name)\n- detection (candidate-level): fid (filter identifier), plus FWHM from SExtractor, number of PS1 calibrators used, and exposure time\n\nImportant schema notes and constraints\n- Use tables: probability, ss_ztf, detection.\n- probability: use class_name='asteroid', classifier_name='stamp_classifier', classifier_version='stamp_classifier_1.0.4', probability > 0.9. Do not force ranking=1 because the user asked for probability > 0.9 for a specific classifier/version, not necessarily the top-ranked class.\n- ss_ztf is keyed by oid (PRIMARY KEY) and contains candid and the Solar System proximity info. Join probability\u2192ss_ztf by oid.\n- detection is keyed by candid (PRIMARY KEY) and contains fid. The provided schema does not include FWHM, number of PS1 calibrators, or exposure time. If your actual detection schema includes columns such as fwhm, ncalib (or similar), and exptime, project them; otherwise these fields cannot be returned from the provided schema.\n- Avoid filtering on detection columns other than oid (per guidance). We will not filter; we only join via candid provided by ss_ztf.\n- Return at most 30 rows; order by probability descending to prioritize highest-confidence cases.\n\nStep-by-step plan\n\n1) Base set of asteroid-likely objects (P)\n- Create a subquery (CTE) selecting the set of oids from probability with:\n  - probability.class_name = 'asteroid'\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.classifier_version = 'stamp_classifier_1.0.4'\n  - probability.probability > 0.9\n- Project columns: oid, probability (to allow ordering).\n- Note: Do not apply probability.ranking = 1 here, to keep any object with asteroid probability > 0.9 even if asteroid is not rank 1 in the stamp classifier output. If you strictly need top-ranked asteroid only, you could additionally filter ranking = 1, but that is not requested.\n\n2) Attach nearest Solar System object info and candidate id (S join)\n- INNER JOIN the base set P to ss_ztf on ss_ztf.oid = P.oid.\n  - This guarantees the availability of ssdistnr, ssmagnr, ssnamenr and obtains the relevant candid for that object.\n  - Keep the join inner (not left), because the output requires these columns; inner join ensures all are present.\n- Project columns you will need downstream: P.oid, P.probability, ss_ztf.candid, ss_ztf.ssdistnr, ss_ztf.ssmagnr, ss_ztf.ssnamenr.\n\n3) Fetch candidate-level info (D join)\n- INNER JOIN the result of step 2 to detection on detection.candid = ss_ztf.candid.\n  - detection has PRIMARY KEY on candid, so this join is efficient.\n  - Optionally assert detection.oid = P.oid if you wish to enforce referential consistency, though joining via candid (PK) already selects the exact candidate associated with the ss_ztf record.\n- From detection, project:\n  - detection.oid (ZTF object identifier)\n  - detection.candid (candidate identifier)\n  - detection.fid (filter identifier)\n  - If present in your actual schema: detection.fwhm (FWHM from SExtractor), detection.ncalib (or equivalent: number of PS1 calibrators used), detection.exptime (exposure time).\n  - If these columns do not exist in your deployment, they cannot be returned from the provided schema. Replace with the correct column names if they exist in your environment (e.g., fwhm, ncalib or nps1, exptime).\n\n4) Final projection\n- Select exactly the columns requested:\n  - ZTF identifier: detection.oid\n  - Candidate identifier: detection.candid\n  - Distance to nearest Solar System object: ss_ztf.ssdistnr\n  - MPC archive magnitude: ss_ztf.ssmagnr\n  - Name: ss_ztf.ssnamenr\n  - Candidate-level columns: detection.fid, and (if available) detection.fwhm, detection.ncalib, detection.exptime\n- Do not include extra columns unless needed for ordering (you can still order by a non-selected column in SQL).\n\n5) Ordering and limiting\n- Order results by P.probability DESC to prioritize highest asteroid probabilities.\n- Apply LIMIT 30 to return at most 30 objects.\n- Because ss_ztf has a single row per oid and detection is joined via that single candid, you will naturally get one row per object. DISTINCT is therefore unnecessary. If you choose to defensively ensure uniqueness, you can use DISTINCT ON (oid) with ordering by probability DESC (conceptually; do not emit SQL code here).\n\n6) Performance and index usage\n- The plan uses:\n  - probability filters (btree on probability; hash on oid) to reduce row count early.\n  - Join P\u2192ss_ztf on oid (ss_ztf has PK on oid) \u2014 efficient.\n  - Join to detection on candid (detection has PK on candid) \u2014 efficient.\n- No filters are applied on detection beyond joining keys, complying with the guidance to avoid detection filters other than by oid (we don\u2019t even filter by oid; join is via candid from ss_ztf).\n\n7) Optional safeguards (only if needed)\n- If you need to ensure the ss_ztf record refers to a known SS object, add a condition ss_ztf.ssnamenr IS NOT NULL (not requested, so omit by default).\n- If you must enforce that 'asteroid' is the top-ranked stamp class, add probability.ranking = 1 in the P subquery (again, not requested).\n\nMapping of requested outputs to schema columns\n- ZTF object identifier: detection.oid (same as probability.oid and ss_ztf.oid)\n- Candidate identifier: detection.candid (equal to ss_ztf.candid)\n- Distance to nearest SS object: ss_ztf.ssdistnr\n- MPC archive magnitude: ss_ztf.ssmagnr\n- Name: ss_ztf.ssnamenr\n- Candidate fields:\n  - Filter identifier: detection.fid\n  - FWHM from SExtractor: not present in provided detection schema; use detection.fwhm if available in your deployment\n  - Number of PS1 calibrators used: not present in provided detection schema; use detection.ncalib (or equivalent) if available\n  - Exposure time: not present in provided detection schema; use detection.exptime if available\n\nThis plan uses three nested subqueries/CTEs (base probability filter P; join with ss_ztf; join to detection), inner joins on keys with indexes, a final projection to the requested columns, ordering by asteroid probability descending, and LIMIT 30 to enforce the maximum count."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\nReturn up to 30 ZTF objects whose \u201cstamp classifier\u201d assigns probability > 0.9 to class 'asteroid' for version 'stamp_classifier_1.0.4', and for each object return:\n- Object identifier (ZTF oid) and candidate identifier (candid)\n- ss_ztf: ssdistnr, ssmagnr (MPC archive magnitude), ssnamenr (name)\n- detection (candidate-level): fid (filter identifier), plus FWHM from SExtractor, number of PS1 calibrators used, and exposure time\n\nImportant schema notes and constraints\n- Use tables: probability, ss_ztf, detection.\n- probability: use class_name='asteroid', classifier_name='stamp_classifier', classifier_version='stamp_classifier_1.0.4', probability > 0.9. Do not force ranking=1 because the user asked for probability > 0.9 for a specific classifier/version, not necessarily the top-ranked class.\n- ss_ztf is keyed by oid (PRIMARY KEY) and contains candid and the Solar System proximity info. Join probability\u2192ss_ztf by oid.\n- detection is keyed by candid (PRIMARY KEY) and contains fid. The provided schema does not include FWHM, number of PS1 calibrators, or exposure time. If your actual detection schema includes columns such as fwhm, ncalib (or similar), and exptime, project them; otherwise these fields cannot be returned from the provided schema.\n- Avoid filtering on detection columns other than oid (per guidance). We will not filter; we only join via candid provided by ss_ztf.\n- Return at most 30 rows; order by probability descending to prioritize highest-confidence cases.\n\nStep-by-step plan\n\n1) Base set of asteroid-likely objects (P)\n- Create a subquery (CTE) selecting the set of oids from probability with:\n  - probability.class_name = 'asteroid'\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.classifier_version = 'stamp_classifier_1.0.4'\n  - probability.probability > 0.9\n- Project columns: oid, probability (to allow ordering).\n- Note: Do not apply probability.ranking = 1 here, to keep any object with asteroid probability > 0.9 even if asteroid is not rank 1 in the stamp classifier output. If you strictly need top-ranked asteroid only, you could additionally filter ranking = 1, but that is not requested.\n\n2) Attach nearest Solar System object info and candidate id (S join)\n- INNER JOIN the base set P to ss_ztf on ss_ztf.oid = P.oid.\n  - This guarantees the availability of ssdistnr, ssmagnr, ssnamenr and obtains the relevant candid for that object.\n  - Keep the join inner (not left), because the output requires these columns; inner join ensures all are present.\n- Project columns you will need downstream: P.oid, P.probability, ss_ztf.candid, ss_ztf.ssdistnr, ss_ztf.ssmagnr, ss_ztf.ssnamenr.\n\n3) Fetch candidate-level info (D join)\n- INNER JOIN the result of step 2 to detection on detection.candid = ss_ztf.candid.\n  - detection has PRIMARY KEY on candid, so this join is efficient.\n  - Optionally assert detection.oid = P.oid if you wish to enforce referential consistency, though joining via candid (PK) already selects the exact candidate associated with the ss_ztf record.\n- From detection, project:\n  - detection.oid (ZTF object identifier)\n  - detection.candid (candidate identifier)\n  - detection.fid (filter identifier)\n  - If present in your actual schema: detection.fwhm (FWHM from SExtractor), detection.ncalib (or equivalent: number of PS1 calibrators used), detection.exptime (exposure time).\n  - If these columns do not exist in your deployment, they cannot be returned from the provided schema. Replace with the correct column names if they exist in your environment (e.g., fwhm, ncalib or nps1, exptime).\n\n4) Final projection\n- Select exactly the columns requested:\n  - ZTF identifier: detection.oid\n  - Candidate identifier: detection.candid\n  - Distance to nearest Solar System object: ss_ztf.ssdistnr\n  - MPC archive magnitude: ss_ztf.ssmagnr\n  - Name: ss_ztf.ssnamenr\n  - Candidate-level columns: detection.fid, and (if available) detection.fwhm, detection.ncalib, detection.exptime\n- Do not include extra columns unless needed for ordering (you can still order by a non-selected column in SQL).\n\n5) Ordering and limiting\n- Order results by P.probability DESC to prioritize highest asteroid probabilities.\n- Apply LIMIT 30 to return at most 30 objects.\n- Because ss_ztf has a single row per oid and detection is joined via that single candid, you will naturally get one row per object. DISTINCT is therefore unnecessary. If you choose to defensively ensure uniqueness, you can use DISTINCT ON (oid) with ordering by probability DESC (conceptually; do not emit SQL code here).\n\n6) Performance and index usage\n- The plan uses:\n  - probability filters (btree on probability; hash on oid) to reduce row count early.\n  - Join P\u2192ss_ztf on oid (ss_ztf has PK on oid) \u2014 efficient.\n  - Join to detection on candid (detection has PK on candid) \u2014 efficient.\n- No filters are applied on detection beyond joining keys, complying with the guidance to avoid detection filters other than by oid (we don\u2019t even filter by oid; join is via candid from ss_ztf).\n\n7) Optional safeguards (only if needed)\n- If you need to ensure the ss_ztf record refers to a known SS object, add a condition ss_ztf.ssnamenr IS NOT NULL (not requested, so omit by default).\n- If you must enforce that 'asteroid' is the top-ranked stamp class, add probability.ranking = 1 in the P subquery (again, not requested).\n\nMapping of requested outputs to schema columns\n- ZTF object identifier: detection.oid (same as probability.oid and ss_ztf.oid)\n- Candidate identifier: detection.candid (equal to ss_ztf.candid)\n- Distance to nearest SS object: ss_ztf.ssdistnr\n- MPC archive magnitude: ss_ztf.ssmagnr\n- Name: ss_ztf.ssnamenr\n- Candidate fields:\n  - Filter identifier: detection.fid\n  - FWHM from SExtractor: not present in provided detection schema; use detection.fwhm if available in your deployment\n  - Number of PS1 calibrators used: not present in provided detection schema; use detection.ncalib (or equivalent) if available\n  - Exposure time: not present in provided detection schema; use detection.exptime if available\n\nThis plan uses three nested subqueries/CTEs (base probability filter P; join with ss_ztf; join to detection), inner joins on keys with indexes, a final projection to the requested columns, ordering by asteroid probability descending, and LIMIT 30 to enforce the maximum count."
                    },
                    "in_toks": 3266,
                    "out_toks": 5989,
                    "id": "chatcmpl-Cb6bDvv0CsrfgBg0h9Ln06LZSqo7X",
                    "created": 1762959539,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Find up to 30 ZTF objects likely 'asteroid' by the stamp classifier v1.0.4 with probability > 0.9\n-- Note: Using classifier_name='stamp_classifier'; not enforcing ranking=1 as the user requested a probability threshold.\n-- Note: The provided 'detection' schema does not include FWHM, number of PS1 calibrators, or exposure time; returning NULL placeholders for these.\nWITH p AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE class_name = 'asteroid'\n     AND classifier_name = 'stamp_classifier'\n     AND classifier_version = 'stamp_classifier_1.0.4'\n     AND probability > 0.9),\n     ps AS\n  (SELECT p.oid,\n          p.probability,\n          s.candid,\n          s.ssdistnr,\n          s.ssmagnr,\n          s.ssnamenr\n   FROM p\n   INNER JOIN ss_ztf s ON s.oid = p.oid)\nSELECT d.oid,\n       d.candid,\n       ps.ssdistnr,\n       ps.ssmagnr,\n       ps.ssnamenr,\n       d.fid,\n       NULL::DOUBLE PRECISION AS fwhm, -- FWHM from SExtractor (not available in provided schema)\n NULL::INTEGER AS n_ps1_calibrators, -- number of PS1 calibrators used (not available in provided schema)\n NULL::DOUBLE PRECISION AS exptime -- exposure time (not available in provided schema)\nFROM ps\nINNER JOIN detection d ON d.candid = ps.candid\nAND d.oid = ps.oid\nORDER BY ps.probability DESC\nLIMIT 30;"
                        },
                        "in_toks": 3491,
                        "out_toks": 3323,
                        "id": "chatcmpl-Cb6d2ju6Jyfu1IhJk15NTXRxlxXpH",
                        "created": 1762959652,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "8": {
            "req_id": "104",
            "experiment_id": "run_8",
            "pred_tables": [
                "probability",
                "taxonomy",
                "detection",
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'detection', 'ss_ztf']"
                },
                "in_toks": 682,
                "out_toks": 3098,
                "id": "chatcmpl-CZN2Afzg4aq6wR5EJ2WeLSzLGZ1cR",
                "created": 1762546058,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "WITH -- 1) Preselect up to 30 objects with highest 'asteroid' probability (>0.9) for the given stamp classifier/version.\n--    We also enforce ranking=1 to keep only the top class per object for this classifier/version.\ntop_objects AS\n  (SELECT DISTINCT ON (p.oid) p.oid,\n                      p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.probability > 0.9\n     AND p.ranking = 1\n   ORDER BY p.oid,\n            p.probability DESC), -- Keep only the top 30 highest-probability objects\ntop30 AS\n  (SELECT *\n   FROM top_objects\n   ORDER BY probability DESC\n   LIMIT 30), -- 2) For those objects, get the latest detection (candidate) to attach candidate-level info (fid).\nlatest_det AS\n  (SELECT DISTINCT ON (d.oid) d.oid,\n                      d.candid,\n                      d.fid,\n                      d.mjd\n   FROM detection d\n   INNER JOIN top30 t ON t.oid = d.oid\n   ORDER BY d.oid,\n            d.mjd DESC) -- 3) Final selection with Solar System nearest object info.\n\nSELECT ld.oid AS ztf_oid, -- ZTF object identifier\n ld.candid, -- candidate identifier\n s.ssdistnr AS ss_nearest_dist, -- distance to nearest Solar System object\n s.ssmagnr AS ss_mpc_mag, -- MPC archive magnitude\n s.ssnamenr AS ss_name, -- MPC object name\n ld.fid, -- filter identifier (1=g; 2=r; 3=i)\n NULL::double precision AS fwhm_sextractor, -- Not available in provided schema\n NULL::integer AS ps1_ncalib, -- Not available in provided schema\n NULL::double precision AS exposure_time -- Not available in provided schema\nFROM latest_det ld\nLEFT JOIN ss_ztf s ON s.oid = ld.oid\nINNER JOIN top30 t ON t.oid = ld.oid\nORDER BY t.probability DESC;",
            "sql_response": {
                "responses": {
                    "0": "WITH -- 1) Preselect up to 30 objects with highest 'asteroid' probability (>0.9) for the given stamp classifier/version.\n--    We also enforce ranking=1 to keep only the top class per object for this classifier/version.\ntop_objects AS\n  (SELECT DISTINCT ON (p.oid) p.oid,\n                      p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.probability > 0.9\n     AND p.ranking = 1\n   ORDER BY p.oid,\n            p.probability DESC), -- Keep only the top 30 highest-probability objects\ntop30 AS\n  (SELECT *\n   FROM top_objects\n   ORDER BY probability DESC\n   LIMIT 30), -- 2) For those objects, get the latest detection (candidate) to attach candidate-level info (fid).\nlatest_det AS\n  (SELECT DISTINCT ON (d.oid) d.oid,\n                      d.candid,\n                      d.fid,\n                      d.mjd\n   FROM detection d\n   INNER JOIN top30 t ON t.oid = d.oid\n   ORDER BY d.oid,\n            d.mjd DESC) -- 3) Final selection with Solar System nearest object info.\n\nSELECT ld.oid AS ztf_oid, -- ZTF object identifier\n ld.candid, -- candidate identifier\n s.ssdistnr AS ss_nearest_dist, -- distance to nearest Solar System object\n s.ssmagnr AS ss_mpc_mag, -- MPC archive magnitude\n s.ssnamenr AS ss_name, -- MPC object name\n ld.fid, -- filter identifier (1=g; 2=r; 3=i)\n NULL::double precision AS fwhm_sextractor, -- Not available in provided schema\n NULL::integer AS ps1_ncalib, -- Not available in provided schema\n NULL::double precision AS exposure_time -- Not available in provided schema\nFROM latest_det ld\nLEFT JOIN ss_ztf s ON s.oid = ld.oid\nINNER JOIN top30 t ON t.oid = ld.oid\nORDER BY t.probability DESC;"
                },
                "in_toks": 2105,
                "out_toks": 2618,
                "id": "chatcmpl-CbHQWPzBXUHBpS3IK9EiZiVUV54fO",
                "created": 1763001160,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1432,
                "out_toks": 1487,
                "id": "chatcmpl-CZYZaUD70gAQa6Ms6zvoxkfwTwcZd",
                "created": 1762590414,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3311,
                "out_toks": 4000,
                "id": "chatcmpl-CZZgKmQGwIoV3pmIwnnPwCnOwwMRr",
                "created": 1762594676,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 30 ZTF objects classified as 'asteroid' by the stamp classifier version 'stamp_classifier_1.0.4'\n-- with probability > 0.9, returning one (latest) candidate per object.\n-- Note: The provided schema does not include columns for Solar System distance, MPC magnitude/name,\n-- FWHM, number of PS1 calibrators, or exposure time. If those exist in another deployment\n-- (e.g., as ssdistnr, ssmagnr, ssnamenr, fwhm, ncalib, exptime), replace or add them accordingly.\n\nSELECT\n    o.oid,               -- ZTF object identifier\n    d.candid,            -- candidate identifier\n    d.fid,               -- filter identifier\n    p.*,\n    o.*,\n    d.*\nFROM probability p\nINNER JOIN object o\n    ON o.oid = p.oid\n-- pick the latest detection per object to attach candidate-level info\nINNER JOIN LATERAL (\n    SELECT *\n    FROM detection d\n    WHERE d.oid = o.oid\n    ORDER BY d.mjd DESC\n    LIMIT 1\n) d ON TRUE\nWHERE p.classifier_name = 'stamp_classifier'\n  AND p.classifier_version = 'stamp_classifier_1.0.4'\n  AND p.class_name = 'asteroid'\n  AND p.probability > 0.9\n  AND p.ranking = 1\nORDER BY p.probability DESC\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 ZTF objects classified as 'asteroid' by the stamp classifier version 'stamp_classifier_1.0.4'\n-- with probability > 0.9, returning one (latest) candidate per object.\n-- Note: The provided schema does not include columns for Solar System distance, MPC magnitude/name,\n-- FWHM, number of PS1 calibrators, or exposure time. If those exist in another deployment\n-- (e.g., as ssdistnr, ssmagnr, ssnamenr, fwhm, ncalib, exptime), replace or add them accordingly.\n\nSELECT\n    o.oid,               -- ZTF object identifier\n    d.candid,            -- candidate identifier\n    d.fid,               -- filter identifier\n    p.*,\n    o.*,\n    d.*\nFROM probability p\nINNER JOIN object o\n    ON o.oid = p.oid\n-- pick the latest detection per object to attach candidate-level info\nINNER JOIN LATERAL (\n    SELECT *\n    FROM detection d\n    WHERE d.oid = o.oid\n    ORDER BY d.mjd DESC\n    LIMIT 1\n) d ON TRUE\nWHERE p.classifier_name = 'stamp_classifier'\n  AND p.classifier_version = 'stamp_classifier_1.0.4'\n  AND p.class_name = 'asteroid'\n  AND p.probability > 0.9\n  AND p.ranking = 1\nORDER BY p.probability DESC\nLIMIT 30;\n```"
                },
                "in_toks": 3070,
                "out_toks": 3145,
                "id": "chatcmpl-CZb19igCjB4NNsDTfEjiUkSuu0IDb",
                "created": 1762599811,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "9": {
            "req_id": "104",
            "experiment_id": "run_9",
            "pred_tables": [
                "probability",
                "taxonomy",
                "detection",
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'taxonomy', 'detection', 'ss_ztf']"
                },
                "in_toks": 682,
                "out_toks": 1498,
                "id": "chatcmpl-CZN3QBTOkxRaUgvuoeqYICUNU9tpm",
                "created": 1762546136,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query: select top-30 asteroid objects by probability first,\n-- then join to ss_ztf (per-oid) and detection via candid (PK) to avoid heavy scans.\n-- Note: fwhm, nps1, exptime are not present in the provided schema; returned as NULLs.\nWITH top_asteroids AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier' -- classifier name\n\n     AND p.classifier_version = 'stamp_classifier_1.0.4' -- classifier version\n\n     AND p.class_name = 'asteroid' -- class\n\n     AND p.ranking = 1 -- most likely class\n\n     AND p.probability > 0.9 -- probability threshold\n\n   ORDER BY p.probability DESC\n   LIMIT 30)\nSELECT a.oid, -- ZTF object identifier\n s.candid, -- candidate identifier (from ss_ztf)\n s.ssdistnr, -- distance to nearest Solar System object\n s.ssmagnr, -- MPC archive magnitude\n s.ssnamenr, -- MPC object name\n d.fid, -- filter identifier\n NULL::double precision AS fwhm, -- SExtractor FWHM (not available in schema)\n NULL::integer AS nps1, -- number of PS1 calibrators (not available)\n NULL::double precision AS exptime -- exposure time (not available)\nFROM top_asteroids a\nJOIN ss_ztf s ON s.oid = a.oid\nJOIN detection d ON d.candid = s.candid\nORDER BY a.probability DESC;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query: select top-30 asteroid objects by probability first,\n-- then join to ss_ztf (per-oid) and detection via candid (PK) to avoid heavy scans.\n-- Note: fwhm, nps1, exptime are not present in the provided schema; returned as NULLs.\nWITH top_asteroids AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier' -- classifier name\n\n     AND p.classifier_version = 'stamp_classifier_1.0.4' -- classifier version\n\n     AND p.class_name = 'asteroid' -- class\n\n     AND p.ranking = 1 -- most likely class\n\n     AND p.probability > 0.9 -- probability threshold\n\n   ORDER BY p.probability DESC\n   LIMIT 30)\nSELECT a.oid, -- ZTF object identifier\n s.candid, -- candidate identifier (from ss_ztf)\n s.ssdistnr, -- distance to nearest Solar System object\n s.ssmagnr, -- MPC archive magnitude\n s.ssnamenr, -- MPC object name\n d.fid, -- filter identifier\n NULL::double precision AS fwhm, -- SExtractor FWHM (not available in schema)\n NULL::integer AS nps1, -- number of PS1 calibrators (not available)\n NULL::double precision AS exptime -- exposure time (not available)\nFROM top_asteroids a\nJOIN ss_ztf s ON s.oid = a.oid\nJOIN detection d ON d.candid = s.candid\nORDER BY a.probability DESC;"
                },
                "in_toks": 2472,
                "out_toks": 3518,
                "id": "chatcmpl-CbHRFsqBqQZa5cmNV3jCWLb5Tv1N4",
                "created": 1763001205,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1432,
                "out_toks": 847,
                "id": "chatcmpl-CZYZtBlXm4a5R53tC07wFVV1nhZI3",
                "created": 1762590433,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3311,
                "out_toks": 4000,
                "id": "chatcmpl-CZa2LwNAwvqkkD6hPSTDxjeTeq1an",
                "created": 1762596041,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 30 ZTF objects whose most likely stamp classifier label is 'asteroid'\n-- with probability > 0.9 in version 'stamp_classifier_1.0.4'.\n-- Return per-object the most recent detection (candidate) and requested columns.\n-- Note: The ALeRCE detection schema provided does not include the following ZTF alert fields:\n--   distance to nearest Solar System object (ssdistnr),\n--   MPC archive magnitude (ssmagnr),\n--   MPC object name (ssnamenr),\n--   SExtractor FWHM (fwhm),\n--   number of PS1 calibrators (nps1),\n--   exposure time (exptime).\n-- These are returned as NULL placeholders with conventional ZTF field names.\n\nWITH asteroid_objs AS (\n  SELECT\n    p.oid,\n    p.probability\n  FROM probability p\n  WHERE p.classifier_name = 'stamp_classifier'\n    AND p.classifier_version = 'stamp_classifier_1.0.4'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.9\n    AND p.ranking = 1  -- keep only the top-ranked class per object\n),\nbest_det AS (\n  SELECT DISTINCT ON (d.oid)\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd\n  FROM detection d\n  INNER JOIN asteroid_objs a USING (oid)\n  ORDER BY d.oid, d.mjd DESC  -- most recent detection per object\n)\nSELECT\n  b.oid,                        -- ZTF object identifier\n  b.candid,                     -- candidate identifier\n  NULL::double precision AS ssdistnr,  -- distance to nearest Solar System object (not available)\n  NULL::double precision AS ssmagnr,   -- MPC archive magnitude (not available)\n  NULL::varchar AS ssnamenr,           -- MPC object name (not available)\n  b.fid,                        -- filter identifier\n  NULL::double precision AS fwhm,      -- SExtractor FWHM (not available)\n  NULL::integer AS nps1,               -- number of PS1 calibrators used (not available)\n  NULL::double precision AS exptime    -- exposure time (not available)\nFROM best_det b\nINNER JOIN asteroid_objs a ON a.oid = b.oid\nORDER BY a.probability DESC\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 ZTF objects whose most likely stamp classifier label is 'asteroid'\n-- with probability > 0.9 in version 'stamp_classifier_1.0.4'.\n-- Return per-object the most recent detection (candidate) and requested columns.\n-- Note: The ALeRCE detection schema provided does not include the following ZTF alert fields:\n--   distance to nearest Solar System object (ssdistnr),\n--   MPC archive magnitude (ssmagnr),\n--   MPC object name (ssnamenr),\n--   SExtractor FWHM (fwhm),\n--   number of PS1 calibrators (nps1),\n--   exposure time (exptime).\n-- These are returned as NULL placeholders with conventional ZTF field names.\n\nWITH asteroid_objs AS (\n  SELECT\n    p.oid,\n    p.probability\n  FROM probability p\n  WHERE p.classifier_name = 'stamp_classifier'\n    AND p.classifier_version = 'stamp_classifier_1.0.4'\n    AND p.class_name = 'asteroid'\n    AND p.probability > 0.9\n    AND p.ranking = 1  -- keep only the top-ranked class per object\n),\nbest_det AS (\n  SELECT DISTINCT ON (d.oid)\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd\n  FROM detection d\n  INNER JOIN asteroid_objs a USING (oid)\n  ORDER BY d.oid, d.mjd DESC  -- most recent detection per object\n)\nSELECT\n  b.oid,                        -- ZTF object identifier\n  b.candid,                     -- candidate identifier\n  NULL::double precision AS ssdistnr,  -- distance to nearest Solar System object (not available)\n  NULL::double precision AS ssmagnr,   -- MPC archive magnitude (not available)\n  NULL::varchar AS ssnamenr,           -- MPC object name (not available)\n  b.fid,                        -- filter identifier\n  NULL::double precision AS fwhm,      -- SExtractor FWHM (not available)\n  NULL::integer AS nps1,               -- number of PS1 calibrators used (not available)\n  NULL::double precision AS exptime    -- exposure time (not available)\nFROM best_det b\nINNER JOIN asteroid_objs a ON a.oid = b.oid\nORDER BY a.probability DESC\nLIMIT 30;\n```"
                },
                "in_toks": 3070,
                "out_toks": 3716,
                "id": "chatcmpl-CZb1XMLwvNpCz3Xa8PC6q3tj4a8QM",
                "created": 1762599835,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        }
    },
    "71": {
        "0": {
            "req_id": "71",
            "experiment_id": "run_0",
            "pred_tables": [
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['reference']",
                    "1": "['object', 'reference', 'detection']"
                },
                "in_toks": 665,
                "out_toks": 1887,
                "id": "chatcmpl-CSnYcmspI0T4ZxgdWqYX2ZAWdhG6n",
                "created": 1760979718,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 842,
                "out_toks": 271,
                "id": "chatcmpl-CSno0Oc9DCzRyPhJWlwmCOgN1ATCo",
                "created": 1760980672,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Reference rows in g band (fid=1) for the specified ZTF objects\nSELECT\n    rfid,       -- identifier of the reference\n    oid,        -- ZTF identifier\n    candid,     -- candidate identifier\n    magnr,      -- magnitude of nearest source in reference image\n    sigmagnr    -- 1-sigma uncertainty in magnr\nFROM reference\nWHERE oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\n  AND fid = 1  -- g band\nORDER BY oid, rfid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Reference rows in g band (fid=1) for the specified ZTF objects\nSELECT\n    rfid,       -- identifier of the reference\n    oid,        -- ZTF identifier\n    candid,     -- candidate identifier\n    magnr,      -- magnitude of nearest source in reference image\n    sigmagnr    -- 1-sigma uncertainty in magnr\nFROM reference\nWHERE oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\n  AND fid = 1  -- g band\nORDER BY oid, rfid;\n```"
                },
                "in_toks": 2160,
                "out_toks": 907,
                "id": "chatcmpl-CSqsTxJ33dCykYmSZTacEogaPPKw7",
                "created": 1760992481,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "71",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "reference",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['reference']",
                    "1": "['object', 'reference', 'detection']"
                },
                "in_toks": 665,
                "out_toks": 1887,
                "id": "chatcmpl-CSnYcmspI0T4ZxgdWqYX2ZAWdhG6n",
                "created": 1760979718,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1872,
                "out_toks": 335,
                "id": "chatcmpl-CSno4pZdITnrm14103u1gieDsPWB5",
                "created": 1760980676,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- g band corresponds to fid = 1\nSELECT\n    rfid,      -- identifier of the reference\n    oid,       -- ZTF identifier\n    candid,    -- candidate identifier\n    magnr,     -- magnitude of the nearest reference object\n    sigmagnr   -- uncertainty of magnr\nFROM reference\nWHERE oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\n  AND fid = 1\nORDER BY oid, rfid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- g band corresponds to fid = 1\nSELECT\n    rfid,      -- identifier of the reference\n    oid,       -- ZTF identifier\n    candid,    -- candidate identifier\n    magnr,     -- magnitude of the nearest reference object\n    sigmagnr   -- uncertainty of magnr\nFROM reference\nWHERE oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\n  AND fid = 1\nORDER BY oid, rfid;\n```"
                },
                "in_toks": 3190,
                "out_toks": 890,
                "id": "chatcmpl-CSqseqrFzMUsrtWXRwmABFTagKqg5",
                "created": 1760992492,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "71",
            "experiment_id": "run_2",
            "pred_tables": [
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['reference']"
                },
                "in_toks": 665,
                "out_toks": 780,
                "id": "chatcmpl-CSsmIhAA3WngnvsPFdSqh4fpfmOlO",
                "created": 1760999786,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 842,
                "out_toks": 271,
                "id": "chatcmpl-CSxZMPAvucGAExwLHiW3UBIdpceC8",
                "created": 1761018204,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find g-band (fid = 1) reference entries for the specified ZTF objects\nSELECT\n    rfid,       -- identifier of the reference\n    oid,        -- ZTF identifier\n    candid,     -- candidate identifier\n    magnr,      -- magnitude of nearest reference object\n    sigmagnr    -- uncertainty in magnitude\nFROM reference\nWHERE fid = 1\n  AND oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\nORDER BY oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find g-band (fid = 1) reference entries for the specified ZTF objects\nSELECT\n    rfid,       -- identifier of the reference\n    oid,        -- ZTF identifier\n    candid,     -- candidate identifier\n    magnr,      -- magnitude of nearest reference object\n    sigmagnr    -- uncertainty in magnitude\nFROM reference\nWHERE fid = 1\n  AND oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\nORDER BY oid;\n```"
                },
                "in_toks": 2160,
                "out_toks": 1086,
                "id": "chatcmpl-CSxp7udTAx6EKrLckVxxWyVatuASY",
                "created": 1761019181,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "71",
            "experiment_id": "run_3",
            "pred_tables": [
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['reference']"
                },
                "in_toks": 665,
                "out_toks": 844,
                "id": "chatcmpl-CSsmRXROGANJCfR3GkDcvUnExunKB",
                "created": 1760999795,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 842,
                "out_toks": 335,
                "id": "chatcmpl-CSxZQJLQdY3XRQ6kHB13Xhw8Aabp4",
                "created": 1761018208,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Reference rows in g band (fid = 1) for specific ZTF objects\n-- Returning: reference identifier (rfid), ZTF identifier (oid), candidate identifier (candid),\n-- and nearest reference magnitude with uncertainty (magnr, sigmagnr)\nSELECT\n  rfid,\n  oid,\n  candid,\n  magnr,\n  sigmagnr\nFROM reference\nWHERE fid = 1 -- g band\n  AND oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\nORDER BY oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Reference rows in g band (fid = 1) for specific ZTF objects\n-- Returning: reference identifier (rfid), ZTF identifier (oid), candidate identifier (candid),\n-- and nearest reference magnitude with uncertainty (magnr, sigmagnr)\nSELECT\n  rfid,\n  oid,\n  candid,\n  magnr,\n  sigmagnr\nFROM reference\nWHERE fid = 1 -- g band\n  AND oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\nORDER BY oid;\n```"
                },
                "in_toks": 2160,
                "out_toks": 1093,
                "id": "chatcmpl-CSxhKbDF4MZf1w4hzxNRvqZx7xhH3",
                "created": 1761018698,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "71",
            "experiment_id": "run_4",
            "pred_tables": [
                "reference",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['reference', 'object']"
                },
                "in_toks": 665,
                "out_toks": 847,
                "id": "chatcmpl-CSsmdeZJhI02fcC85naeu0crwZ5Y2",
                "created": 1760999807,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1324,
                "out_toks": 207,
                "id": "chatcmpl-CSxZUY3MqFpRc31pBD3HbSIvLmvzU",
                "created": 1761018212,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Reference rows in g band (fid = 1) for the specified ZTF objects\n-- Returning: reference identifier (rfid), ZTF identifier (oid), candidate identifier (candid),\n-- and the nearest reference magnitude and its uncertainty (magnr, sigmagnr)\nSELECT\n    rfid,\n    oid,\n    candid,\n    magnr,\n    sigmagnr\nFROM reference\nWHERE fid = 1\n  AND oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\nORDER BY oid, rfid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Reference rows in g band (fid = 1) for the specified ZTF objects\n-- Returning: reference identifier (rfid), ZTF identifier (oid), candidate identifier (candid),\n-- and the nearest reference magnitude and its uncertainty (magnr, sigmagnr)\nSELECT\n    rfid,\n    oid,\n    candid,\n    magnr,\n    sigmagnr\nFROM reference\nWHERE fid = 1\n  AND oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\nORDER BY oid, rfid;\n```"
                },
                "in_toks": 2642,
                "out_toks": 904,
                "id": "chatcmpl-CSxhaWHxODTXmmQWVk6p4xaxiGyOg",
                "created": 1761018714,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "71",
            "experiment_id": "run_5",
            "pred_tables": [
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['reference']"
                },
                "in_toks": 665,
                "out_toks": 1100,
                "id": "chatcmpl-CZN40suk93QNq0KYfQgZKKjEyB4B8",
                "created": 1762546172,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 842,
                "out_toks": 143,
                "id": "chatcmpl-CZYa5RpwTwC5Es5SPF7j8oUHZjjJO",
                "created": 1762590445,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- g band in ZTF corresponds to fid = 1\nSELECT\n    rfid,         -- identifier of the reference\n    oid,          -- ZTF identifier\n    candid,       -- candidate identifier\n    magnr,        -- magnitude of nearest reference object\n    sigmagnr      -- 1-sigma uncertainty of magnr\nFROM reference\nWHERE fid = 1\n  AND oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\nORDER BY oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- g band in ZTF corresponds to fid = 1\nSELECT\n    rfid,         -- identifier of the reference\n    oid,          -- ZTF identifier\n    candid,       -- candidate identifier\n    magnr,        -- magnitude of nearest reference object\n    sigmagnr      -- 1-sigma uncertainty of magnr\nFROM reference\nWHERE fid = 1\n  AND oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\nORDER BY oid;\n```"
                },
                "in_toks": 2160,
                "out_toks": 957,
                "id": "chatcmpl-CZZvRvkFDXZj1aLnaifRqXZ1lY9s8",
                "created": 1762595613,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "71",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'reference']"
                },
                "in_toks": 665,
                "out_toks": 1103,
                "id": "chatcmpl-CZN4lTdIXvB9Nv5SaZWjpEp6H2e96",
                "created": 1762546219,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1324,
                "out_toks": 207,
                "id": "chatcmpl-CZYa8ACxnWI4dZztKbtPRbOsu1Oif",
                "created": 1762590448,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- g band corresponds to fid = 1\nSELECT\n    rfid,       -- identifier of the reference\n    oid,        -- ZTF identifier\n    candid,     -- candidate identifier\n    magnr,      -- magnitude of the nearest reference object\n    sigmagnr    -- uncertainty of the magnitude\nFROM reference\nWHERE oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\n  AND fid = 1\nORDER BY oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- g band corresponds to fid = 1\nSELECT\n    rfid,       -- identifier of the reference\n    oid,        -- ZTF identifier\n    candid,     -- candidate identifier\n    magnr,      -- magnitude of the nearest reference object\n    sigmagnr    -- uncertainty of the magnitude\nFROM reference\nWHERE oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\n  AND fid = 1\nORDER BY oid;\n```"
                },
                "in_toks": 2642,
                "out_toks": 887,
                "id": "chatcmpl-CZZiZhD9CPOO8f4mmheXxZPxN5Yvz",
                "created": 1762594815,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "71",
            "experiment_id": "run_7",
            "pred_tables": [
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['reference']"
                },
                "in_toks": 665,
                "out_toks": 652,
                "id": "chatcmpl-CZN5GMWT3DHM1XIhvSm9f7uc9tHPd",
                "created": 1762546250,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 842,
                "out_toks": 271,
                "id": "chatcmpl-CZYaD0JY1w2i4yBxGST2cTrD0VIH9",
                "created": 1762590453,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- g band corresponds to fid = 1\nSELECT\n    rfid,\n    oid,\n    candid,\n    magnr,\n    sigmagnr\nFROM reference\nWHERE oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\n  AND fid = 1\nORDER BY oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- g band corresponds to fid = 1\nSELECT\n    rfid,\n    oid,\n    candid,\n    magnr,\n    sigmagnr\nFROM reference\nWHERE oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\n  AND fid = 1\nORDER BY oid;\n```"
                },
                "in_toks": 2160,
                "out_toks": 982,
                "id": "chatcmpl-CZZvoE76flMTPh7Mtu4KxA64GdBPb",
                "created": 1762595636,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "71",
            "experiment_id": "run_8",
            "pred_tables": [
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['reference']"
                },
                "in_toks": 665,
                "out_toks": 268,
                "id": "chatcmpl-CZN5TE7bWxdoVfMGrf9vu0xjaC3wa",
                "created": 1762546263,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 842,
                "out_toks": 335,
                "id": "chatcmpl-CZYaHFzJvk7GmxVq5QCZQkHNBATKY",
                "created": 1762590457,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- g band corresponds to fid = 1\nSELECT\n  r.rfid,      -- identifier of the reference\n  r.oid,       -- ZTF identifier\n  r.candid,    -- candidate identifier\n  r.magnr,     -- magnitude of nearest reference object\n  r.sigmagnr   -- 1-sigma uncertainty in magnr\nFROM reference AS r\nWHERE r.oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\n  AND r.fid = 1\nORDER BY r.oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- g band corresponds to fid = 1\nSELECT\n  r.rfid,      -- identifier of the reference\n  r.oid,       -- ZTF identifier\n  r.candid,    -- candidate identifier\n  r.magnr,     -- magnitude of nearest reference object\n  r.sigmagnr   -- 1-sigma uncertainty in magnr\nFROM reference AS r\nWHERE r.oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\n  AND r.fid = 1\nORDER BY r.oid;\n```"
                },
                "in_toks": 2160,
                "out_toks": 1483,
                "id": "chatcmpl-CZZjDRMHIsGc6no7utF39Xyqwze17",
                "created": 1762594855,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "71",
            "experiment_id": "run_9",
            "pred_tables": [
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['reference']"
                },
                "in_toks": 665,
                "out_toks": 844,
                "id": "chatcmpl-CZN5aNefCOpZFtGN2FrEc0ybeHdnS",
                "created": 1762546270,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 842,
                "out_toks": 271,
                "id": "chatcmpl-CZYaMpKakFRE566ldakJ4OnjzCQXk",
                "created": 1762590462,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Reference rows in g band (fid=1) for the specified ZTF objects,\n-- returning reference ID, ZTF (oid), candidate ID, and nearest reference magnitude with its uncertainty.\nSELECT\n    rfid,\n    oid,\n    candid,\n    magnr,\n    sigmagnr\nFROM reference\nWHERE oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\n  AND fid = 1  -- g band\nORDER BY oid;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Reference rows in g band (fid=1) for the specified ZTF objects,\n-- returning reference ID, ZTF (oid), candidate ID, and nearest reference magnitude with its uncertainty.\nSELECT\n    rfid,\n    oid,\n    candid,\n    magnr,\n    sigmagnr\nFROM reference\nWHERE oid IN ('ZTF20aczxeud', 'ZTF21aappfdu', 'ZTF22aacqjeb')\n  AND fid = 1  -- g band\nORDER BY oid;\n```"
                },
                "in_toks": 2160,
                "out_toks": 759,
                "id": "chatcmpl-CZZwD3z3HfjjyKzPRMrmHVro8NmIV",
                "created": 1762595661,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "42": {
        "0": {
            "req_id": "42",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'dataquality']",
                    "1": "['dataquality']"
                },
                "in_toks": 662,
                "out_toks": 1309,
                "id": "chatcmpl-CSnYvWHiKzlPWMMmeI6drO3ClVgZf",
                "created": 1760979737,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1752,
                "out_toks": 207,
                "id": "chatcmpl-CSnoA7WCgXAWC3xoPKcM4k5rps33b",
                "created": 1760980682,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All epochs in dataquality for object ZTF21aapnixl, sorted by reduced chi-square\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf ASC NULLS LAST;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All epochs in dataquality for object ZTF21aapnixl, sorted by reduced chi-square\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf ASC NULLS LAST;\n```"
                },
                "in_toks": 3070,
                "out_toks": 939,
                "id": "chatcmpl-CSqsia9Fq6yUnOjtKmRE1kZ1wSPdk",
                "created": 1760992496,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "42",
            "experiment_id": "run_1",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'dataquality']",
                    "1": "['dataquality']"
                },
                "in_toks": 662,
                "out_toks": 1309,
                "id": "chatcmpl-CSnYvWHiKzlPWMMmeI6drO3ClVgZf",
                "created": 1760979737,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1270,
                "out_toks": 207,
                "id": "chatcmpl-CSnoFp08l9TQ70zuR4m9HSvVrKJrI",
                "created": 1760980687,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get all epochs for the specified ZTF object from dataquality\n-- Return the requested columns and sort by reduced chi-square (chipsf)\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all epochs for the specified ZTF object from dataquality\n-- Return the requested columns and sort by reduced chi-square (chipsf)\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf;\n```"
                },
                "in_toks": 2588,
                "out_toks": 685,
                "id": "chatcmpl-CSqsfUf0kXOIv5bpN75YBbvhxtj28",
                "created": 1760992493,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "42",
            "experiment_id": "run_2",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']"
                },
                "in_toks": 662,
                "out_toks": 205,
                "id": "chatcmpl-CSsmo4CJ2g0gInD9eL8tWHaVAgIi9",
                "created": 1760999818,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1270,
                "out_toks": 271,
                "id": "chatcmpl-CSxZX5HXtx2JajjbxbhbBpqp6gfSH",
                "created": 1761018215,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get all dataquality epochs for the specified ZTF object, sorted by reduced chi-square\nSELECT\n    oid,           -- object identifier\n    candid,        -- candidate identifier\n    fid,           -- filter identifier (1=g; 2=r; 3=i)\n    chipsf,        -- reduced chi-square for PSF-fit\n    fwhm,          -- FWHM from SExtractor [pixels]\n    classtar,      -- Star/Galaxy classification score from SExtractor\n    nbad,          -- number of prior-tagged bad pixels in a 5 x 5 pixel stamp\n    magzpsci,      -- magnitude zero point [mag]\n    magzpsciunc,   -- magnitude zero point uncertainty [mag]\n    exptime        -- exposure time [sec]\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf ASC NULLS LAST;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all dataquality epochs for the specified ZTF object, sorted by reduced chi-square\nSELECT\n    oid,           -- object identifier\n    candid,        -- candidate identifier\n    fid,           -- filter identifier (1=g; 2=r; 3=i)\n    chipsf,        -- reduced chi-square for PSF-fit\n    fwhm,          -- FWHM from SExtractor [pixels]\n    classtar,      -- Star/Galaxy classification score from SExtractor\n    nbad,          -- number of prior-tagged bad pixels in a 5 x 5 pixel stamp\n    magzpsci,      -- magnitude zero point [mag]\n    magzpsciunc,   -- magnitude zero point uncertainty [mag]\n    exptime        -- exposure time [sec]\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf ASC NULLS LAST;\n```"
                },
                "in_toks": 2588,
                "out_toks": 972,
                "id": "chatcmpl-CSxhomREZBk93K5SwEtPyRKSBUsIu",
                "created": 1761018728,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "42",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'dataquality']"
                },
                "in_toks": 662,
                "out_toks": 592,
                "id": "chatcmpl-CSsmsQhX4i6LU0HiUgfDcE03EiGrN",
                "created": 1760999822,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1752,
                "out_toks": 271,
                "id": "chatcmpl-CSxZbP2VMb1rq6KA0o9vUwzqHG8mL",
                "created": 1761018219,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All epochs in dataquality for the specified ZTF object, sorted by reduced chi-square (ascending)\nSELECT\n    oid,           -- object identifier\n    candid,        -- candidate identifier\n    fid,           -- filter identifier (1=g; 2=r; 3=i)\n    chipsf,        -- reduced chi-square for PSF-fit\n    fwhm,          -- FWHM from SExtractor [pixels]\n    classtar,      -- Star/Galaxy classification score from SExtractor\n    nbad,          -- number of prior-tagged bad pixels in a 5x5 stamp\n    magzpsci,      -- magnitude zero point [mag]\n    magzpsciunc,   -- magnitude zero point uncertainty [mag]\n    exptime        -- exposure time [sec]\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf ASC NULLS LAST;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All epochs in dataquality for the specified ZTF object, sorted by reduced chi-square (ascending)\nSELECT\n    oid,           -- object identifier\n    candid,        -- candidate identifier\n    fid,           -- filter identifier (1=g; 2=r; 3=i)\n    chipsf,        -- reduced chi-square for PSF-fit\n    fwhm,          -- FWHM from SExtractor [pixels]\n    classtar,      -- Star/Galaxy classification score from SExtractor\n    nbad,          -- number of prior-tagged bad pixels in a 5x5 stamp\n    magzpsci,      -- magnitude zero point [mag]\n    magzpsciunc,   -- magnitude zero point uncertainty [mag]\n    exptime        -- exposure time [sec]\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf ASC NULLS LAST;\n```"
                },
                "in_toks": 3070,
                "out_toks": 780,
                "id": "chatcmpl-CSxi5OnoaSOtotlaj8IrweEzUJ9Cz",
                "created": 1761018745,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "42",
            "experiment_id": "run_4",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']"
                },
                "in_toks": 662,
                "out_toks": 653,
                "id": "chatcmpl-CSsn172tt60haqYgtQcCM13fVzI8M",
                "created": 1760999831,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1270,
                "out_toks": 207,
                "id": "chatcmpl-CSxZeGtER8UJcZo0qN6FBmFhRhdVd",
                "created": 1761018222,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All epochs in dataquality for the ZTF object 'ZTF21aapnixl'\n-- Returning: oid, candid, fid, chipsf, fwhm, classtar, nbad, magzpsci, magzpsciunc, exptime\n-- Sorted by reduced chi-square (chipsf)\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All epochs in dataquality for the ZTF object 'ZTF21aapnixl'\n-- Returning: oid, candid, fid, chipsf, fwhm, classtar, nbad, magzpsci, magzpsciunc, exptime\n-- Sorted by reduced chi-square (chipsf)\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf ASC;\n```"
                },
                "in_toks": 2588,
                "out_toks": 1044,
                "id": "chatcmpl-CSxiI5g78j1VocOkcLa4BkY2dDqE5",
                "created": 1761018758,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "42",
            "experiment_id": "run_5",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']"
                },
                "in_toks": 662,
                "out_toks": 269,
                "id": "chatcmpl-CZN62R4fw9T16br0kapf160ezIJ7G",
                "created": 1762546298,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1270,
                "out_toks": 335,
                "id": "chatcmpl-CZYaQarNXgTQbnxQYeaklSHSXtH8o",
                "created": 1762590466,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All epochs from the dataquality table for the specified ZTF object,\n-- returning requested columns and sorted by reduced chi-square (chipsf)\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All epochs from the dataquality table for the specified ZTF object,\n-- returning requested columns and sorted by reduced chi-square (chipsf)\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf ASC;\n```"
                },
                "in_toks": 2588,
                "out_toks": 814,
                "id": "chatcmpl-CZZkILTvEpNTr5H0UR7UzuxOh9ao7",
                "created": 1762594922,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "42",
            "experiment_id": "run_6",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']"
                },
                "in_toks": 662,
                "out_toks": 333,
                "id": "chatcmpl-CZN69y2KyO0ClC4isCz0NHj4C8lrm",
                "created": 1762546305,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1270,
                "out_toks": 207,
                "id": "chatcmpl-CZYaUMSUUHMuNIrTr7b1vpfcF6lAh",
                "created": 1762590470,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get all epochs from the dataquality table for the specified ZTF object\n-- Return: object (oid), candidate id (candid), filter id (fid),\n-- reduced chi-square (chipsf), FWHM (fwhm), S/G score (classtar),\n-- number of bad pixels (nbad), ZP magnitude (magzpsci) and its uncertainty (magzpsciunc), exposure time (exptime)\n-- Sorted by reduced chi-square (chipsf)\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all epochs from the dataquality table for the specified ZTF object\n-- Return: object (oid), candidate id (candid), filter id (fid),\n-- reduced chi-square (chipsf), FWHM (fwhm), S/G score (classtar),\n-- number of bad pixels (nbad), ZP magnitude (magzpsci) and its uncertainty (magzpsciunc), exposure time (exptime)\n-- Sorted by reduced chi-square (chipsf)\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf;\n```"
                },
                "in_toks": 2588,
                "out_toks": 885,
                "id": "chatcmpl-CZZwWFr7nMtGGl9KyE0qsWkNR8kZI",
                "created": 1762595680,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "42",
            "experiment_id": "run_7",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']"
                },
                "in_toks": 662,
                "out_toks": 269,
                "id": "chatcmpl-CZN6FZvKZiyL7dpsXTHDbALTzhpD0",
                "created": 1762546311,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1270,
                "out_toks": 335,
                "id": "chatcmpl-CZYaXQxfB7gMYz7dnNQVD9xQmMH5r",
                "created": 1762590473,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All epochs from dataquality for the specified ZTF object, sorted by reduced chi-square (chipsf)\n-- Note: fid = 1 (g), 2 (r), 3 (i)\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All epochs from dataquality for the specified ZTF object, sorted by reduced chi-square (chipsf)\n-- Note: fid = 1 (g), 2 (r), 3 (i)\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf;\n```"
                },
                "in_toks": 2588,
                "out_toks": 826,
                "id": "chatcmpl-CZZkoG9gTEkmQbONEuE5nrgtHlwox",
                "created": 1762594954,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "42",
            "experiment_id": "run_8",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']"
                },
                "in_toks": 662,
                "out_toks": 461,
                "id": "chatcmpl-CZN6Majy6sTj51iksQp4GDh11Dobr",
                "created": 1762546318,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1270,
                "out_toks": 335,
                "id": "chatcmpl-CZYaajdhWbkSq1G2KStfAhlW1IrV2",
                "created": 1762590476,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All epochs in dataquality for the specified ZTF object, ordered by reduced chi-square\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All epochs in dataquality for the specified ZTF object, ordered by reduced chi-square\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf ASC;\n```"
                },
                "in_toks": 2588,
                "out_toks": 740,
                "id": "chatcmpl-CZZx9cjJvKCs07f8jSps6ESyG4Zkd",
                "created": 1762595719,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "42",
            "experiment_id": "run_9",
            "pred_tables": [
                "dataquality"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['dataquality']"
                },
                "in_toks": 662,
                "out_toks": 525,
                "id": "chatcmpl-CZN6ZoML0uSk0AL0wxzLaigbSgQTs",
                "created": 1762546331,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1270,
                "out_toks": 143,
                "id": "chatcmpl-CZYafS8yZDtUhESoRDi3Bj9GCZPDK",
                "created": 1762590481,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All epochs in the 'dataquality' table for object ZTF21aapnixl\n-- Columns: object (oid), candidate (candid), filter (fid), reduced chi-square (chipsf),\n-- FWHM (fwhm), star/galaxy score (classtar), number of bad pixels (nbad),\n-- ZP magnitude (magzpsci), ZP uncertainty (magzpsciunc), exposure time (exptime)\n-- Sorted by reduced chi-square\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All epochs in the 'dataquality' table for object ZTF21aapnixl\n-- Columns: object (oid), candidate (candid), filter (fid), reduced chi-square (chipsf),\n-- FWHM (fwhm), star/galaxy score (classtar), number of bad pixels (nbad),\n-- ZP magnitude (magzpsci), ZP uncertainty (magzpsciunc), exposure time (exptime)\n-- Sorted by reduced chi-square\nSELECT\n    oid,\n    candid,\n    fid,\n    chipsf,\n    fwhm,\n    classtar,\n    nbad,\n    magzpsci,\n    magzpsciunc,\n    exptime\nFROM dataquality\nWHERE oid = 'ZTF21aapnixl'\nORDER BY chipsf;\n```"
                },
                "in_toks": 2588,
                "out_toks": 887,
                "id": "chatcmpl-CZZlC4lEjbstsVyVTOsqWnv23CN2W",
                "created": 1762594978,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "107": {
        "0": {
            "req_id": "107",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'ss_ztf', 'detection']",
                    "1": "['object', 'probability', 'detection', 'ss_ztf']"
                },
                "in_toks": 699,
                "out_toks": 3383,
                "id": "chatcmpl-CSnZClff7cK1dHHZI9MYXhmRFTB2F",
                "created": 1760979754,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1931,
                "out_toks": 591,
                "id": "chatcmpl-CSnoJuk6mnAzZ1XtuueVXiXMNL1dM",
                "created": 1760980691,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Find ZTF objects with ndet > 500, asteroid prob > 0.5 in stamp_classifier_1.0.4, and ssdistnr < 2 arcsec\n\nSELECT o.oid,\n       o.ndet,\n       o.firstmjd,\n       o.lastmjd,\n       p.probability,\n       s.candid,\n       s.ssdistnr,\n       s.ssnamenr,\n       d.mjd,\n       d.fid\nFROM OBJECT AS o\nINNER JOIN probability AS p ON p.oid = o.oid\nAND p.classifier_name = 'stamp_classifier'\nAND p.classifier_version = 'stamp_classifier_1.0.4'\nAND p.class_name = 'asteroid'\nAND p.probability > 0.5\nINNER JOIN ss_ztf AS s ON s.oid = o.oid\nAND s.ssdistnr < 2.0\nINNER JOIN detection AS d ON d.candid = s.candid\nWHERE o.ndet > 500\nORDER BY o.firstmjd ASC\nLIMIT 10;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify and lock in classifier constraints (override default)\n- We must NOT use the default probability constraints (ranking = 1 and classifier_name = 'lc_classifier'). The user explicitly requests the stamp-based classifier and a specific version.\n- Use probability filters:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.classifier_version = 'stamp_classifier_1.0.4'\n  - probability.class_name = 'asteroid'\n  - probability.probability > 0.5\n\n2) Define the per-table filters as separate subqueries (each returns only needed columns and is fully filtered)\n- Subquery P (probability filter):\n  - FROM probability\n  - SELECT: oid, probability\n  - WHERE:\n    - classifier_name = 'stamp_classifier'\n    - classifier_version = 'stamp_classifier_1.0.4'\n    - class_name = 'asteroid'\n    - probability > 0.5\n\n- Subquery O (object filter):\n  - FROM object\n  - SELECT: oid, ndet, firstmjd, lastmjd\n  - WHERE:\n    - ndet > 500\n\n- Subquery S (solar-system crossmatch constraint):\n  - FROM ss_ztf\n  - SELECT: oid, candid, ssdistnr, ssnamenr\n  - WHERE:\n    - ssdistnr < 2.0  (distance to nearest known solar system object in arcsec)\n\n- Subquery D (detection row corresponding to the ss_ztf candid):\n  - FROM detection d\n  - INNER JOIN S on d.candid = S.candid\n  - SELECT: d.candid, d.mjd, d.fid\n  - Note: detection.candid is PRIMARY KEY in detection; ss_ztf.candid is indexed. The join is unique (one row per object due to ss_ztf primary key on oid).\n\n3) Build the intersection of eligible objects (use INTERSECT)\n- Subquery I_oids:\n  - SELECT oid FROM P\n  - INTERSECT\n  - SELECT oid FROM O\n  - INTERSECT\n  - SELECT oid FROM S\n- This yields the set of oids satisfying all three independent constraints.\n\n4) (Additionally use UNION ALL to cross-validate the set via counting; fulfills UNION requirement)\n- Subquery U_all (stack the three filtered sets):\n  - SELECT oid, 'P' AS src FROM P\n  - UNION ALL\n  - SELECT oid, 'O' AS src FROM O\n  - UNION ALL\n  - SELECT oid, 'S' AS src FROM S\n- Subquery U_oids (oids present in all three sources):\n  - FROM U_all\n  - GROUP BY oid\n  - HAVING COUNT(DISTINCT src) = 3\n- Optional but recommended consistency filter: final eligible oids are those appearing in both I_oids and U_oids:\n  - Subquery E_oids:\n    - SELECT oid FROM I_oids\n    - INTERSECT\n    - SELECT oid FROM U_oids\n\n5) Assemble the final rows with INNER JOINs, restricting to eligible oids\n- Base: FROM O (the object subquery, already filtered on ndet > 500)\n- INNER JOIN P ON P.oid = O.oid (adds asteroid stamp probability > 0.5 for the requested version)\n- INNER JOIN S ON S.oid = O.oid (adds solar-system nearest-object info; enforces ssdistnr < 2 arcsec)\n- INNER JOIN D ON D.candid = S.candid (adds detection date and filter id for that candid)\n- WHERE O.oid IN (SELECT oid FROM E_oids)  [If you don\u2019t implement step 4, use I_oids instead.]\n- This guarantees only objects satisfying all conditions are returned, and prevents any leakage from unfiltered joins.\n\n6) Columns to return (with exact table/column names and suggested aliases)\n- object.oid AS ztf_oid  (ZTF identifier)\n- object.ndet\n- object.firstmjd\n- object.lastmjd\n- probability.probability\n- ss_ztf.candid\n- ss_ztf.ssdistnr\n- ss_ztf.ssnamenr\n- detection.mjd AS detection_mjd\n- detection.fid\n\n7) Ordering and limiting\n- ORDER BY object.firstmjd ASC\n- LIMIT 10\n\n8) Index/plan considerations (implicit for optimizer)\n- object: ix_object_ndet and ix_object_firstmjd can assist filtering and ordering.\n- probability: ix_probabilities_probability helps with probability > 0.5; filter also on classifier_name, classifier_version, class_name.\n- ss_ztf: ix_ss_ztf_candid helps the join to detection; ssdistnr filter is selective.\n- detection: PRIMARY KEY on candid enables efficient probe by ss_ztf.candid.\n\n9) Summary of the final structure\n- WITH P AS (filtered probability),\n- O AS (filtered object),\n- S AS (filtered ss_ztf),\n- I_oids AS (INTERSECT of oids from P, O, S),\n- U_all and U_oids as the UNION ALL sanity path,\n- E_oids as INTERSECT of I_oids and U_oids,\n- D as detection rows joined to S by candid,\n- Final SELECT joining O, P, S, D, filtered to E_oids, projecting the requested columns, ordered by object.firstmjd, limited to 10."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify and lock in classifier constraints (override default)\n- We must NOT use the default probability constraints (ranking = 1 and classifier_name = 'lc_classifier'). The user explicitly requests the stamp-based classifier and a specific version.\n- Use probability filters:\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.classifier_version = 'stamp_classifier_1.0.4'\n  - probability.class_name = 'asteroid'\n  - probability.probability > 0.5\n\n2) Define the per-table filters as separate subqueries (each returns only needed columns and is fully filtered)\n- Subquery P (probability filter):\n  - FROM probability\n  - SELECT: oid, probability\n  - WHERE:\n    - classifier_name = 'stamp_classifier'\n    - classifier_version = 'stamp_classifier_1.0.4'\n    - class_name = 'asteroid'\n    - probability > 0.5\n\n- Subquery O (object filter):\n  - FROM object\n  - SELECT: oid, ndet, firstmjd, lastmjd\n  - WHERE:\n    - ndet > 500\n\n- Subquery S (solar-system crossmatch constraint):\n  - FROM ss_ztf\n  - SELECT: oid, candid, ssdistnr, ssnamenr\n  - WHERE:\n    - ssdistnr < 2.0  (distance to nearest known solar system object in arcsec)\n\n- Subquery D (detection row corresponding to the ss_ztf candid):\n  - FROM detection d\n  - INNER JOIN S on d.candid = S.candid\n  - SELECT: d.candid, d.mjd, d.fid\n  - Note: detection.candid is PRIMARY KEY in detection; ss_ztf.candid is indexed. The join is unique (one row per object due to ss_ztf primary key on oid).\n\n3) Build the intersection of eligible objects (use INTERSECT)\n- Subquery I_oids:\n  - SELECT oid FROM P\n  - INTERSECT\n  - SELECT oid FROM O\n  - INTERSECT\n  - SELECT oid FROM S\n- This yields the set of oids satisfying all three independent constraints.\n\n4) (Additionally use UNION ALL to cross-validate the set via counting; fulfills UNION requirement)\n- Subquery U_all (stack the three filtered sets):\n  - SELECT oid, 'P' AS src FROM P\n  - UNION ALL\n  - SELECT oid, 'O' AS src FROM O\n  - UNION ALL\n  - SELECT oid, 'S' AS src FROM S\n- Subquery U_oids (oids present in all three sources):\n  - FROM U_all\n  - GROUP BY oid\n  - HAVING COUNT(DISTINCT src) = 3\n- Optional but recommended consistency filter: final eligible oids are those appearing in both I_oids and U_oids:\n  - Subquery E_oids:\n    - SELECT oid FROM I_oids\n    - INTERSECT\n    - SELECT oid FROM U_oids\n\n5) Assemble the final rows with INNER JOINs, restricting to eligible oids\n- Base: FROM O (the object subquery, already filtered on ndet > 500)\n- INNER JOIN P ON P.oid = O.oid (adds asteroid stamp probability > 0.5 for the requested version)\n- INNER JOIN S ON S.oid = O.oid (adds solar-system nearest-object info; enforces ssdistnr < 2 arcsec)\n- INNER JOIN D ON D.candid = S.candid (adds detection date and filter id for that candid)\n- WHERE O.oid IN (SELECT oid FROM E_oids)  [If you don\u2019t implement step 4, use I_oids instead.]\n- This guarantees only objects satisfying all conditions are returned, and prevents any leakage from unfiltered joins.\n\n6) Columns to return (with exact table/column names and suggested aliases)\n- object.oid AS ztf_oid  (ZTF identifier)\n- object.ndet\n- object.firstmjd\n- object.lastmjd\n- probability.probability\n- ss_ztf.candid\n- ss_ztf.ssdistnr\n- ss_ztf.ssnamenr\n- detection.mjd AS detection_mjd\n- detection.fid\n\n7) Ordering and limiting\n- ORDER BY object.firstmjd ASC\n- LIMIT 10\n\n8) Index/plan considerations (implicit for optimizer)\n- object: ix_object_ndet and ix_object_firstmjd can assist filtering and ordering.\n- probability: ix_probabilities_probability helps with probability > 0.5; filter also on classifier_name, classifier_version, class_name.\n- ss_ztf: ix_ss_ztf_candid helps the join to detection; ssdistnr filter is selective.\n- detection: PRIMARY KEY on candid enables efficient probe by ss_ztf.candid.\n\n9) Summary of the final structure\n- WITH P AS (filtered probability),\n- O AS (filtered object),\n- S AS (filtered ss_ztf),\n- I_oids AS (INTERSECT of oids from P, O, S),\n- U_all and U_oids as the UNION ALL sanity path,\n- E_oids as INTERSECT of I_oids and U_oids,\n- D as detection rows joined to S by candid,\n- Final SELECT joining O, P, S, D, filtered to E_oids, projecting the requested columns, ordered by object.firstmjd, limited to 10."
                    },
                    "in_toks": 3809,
                    "out_toks": 4567,
                    "id": "chatcmpl-Cb6egtfF9b1CptjZKrFV5RW3qRgni",
                    "created": 1762959754,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Find ZTF objects with ndet > 500, asteroid prob > 0.5 in stamp_classifier_1.0.4, and ssdistnr < 2 arcsec\n\nSELECT o.oid,\n       o.ndet,\n       o.firstmjd,\n       o.lastmjd,\n       p.probability,\n       s.candid,\n       s.ssdistnr,\n       s.ssnamenr,\n       d.mjd,\n       d.fid\nFROM OBJECT AS o\nINNER JOIN probability AS p ON p.oid = o.oid\nAND p.classifier_name = 'stamp_classifier'\nAND p.classifier_version = 'stamp_classifier_1.0.4'\nAND p.class_name = 'asteroid'\nAND p.probability > 0.5\nINNER JOIN ss_ztf AS s ON s.oid = o.oid\nAND s.ssdistnr < 2.0\nINNER JOIN detection AS d ON d.candid = s.candid\nWHERE o.ndet > 500\nORDER BY o.firstmjd ASC\nLIMIT 10;"
                        },
                        "in_toks": 3636,
                        "out_toks": 2555,
                        "id": "chatcmpl-Cb6gl10Ctawr9rTrMbs7sy2leiCtH",
                        "created": 1762959883,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "107",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "probability",
                "detection",
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'ss_ztf', 'detection']",
                    "1": "['object', 'probability', 'detection', 'ss_ztf']"
                },
                "in_toks": 699,
                "out_toks": 3383,
                "id": "chatcmpl-CSnZClff7cK1dHHZI9MYXhmRFTB2F",
                "created": 1760979754,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1886,
                "out_toks": 1103,
                "id": "chatcmpl-CSnoS25vnjxZFmvFoQRrW44hlOSX9",
                "created": 1760980700,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Find ZTF objects with ndet > 500, asteroid prob > 0.5 in stamp_classifier_1.0.4 (ranking=1),\n-- nearest Solar System object within 2 arcsec; return requested columns, ordered by firstmjd, limit 10.\nWITH p AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE ranking = 1\n     AND classifier_name = 'stamp_classifier'\n     AND classifier_version = 'stamp_classifier_1.0.4'\n     AND class_name = 'asteroid'\n     AND probability > 0.5),\n     o AS\n  (SELECT oid,\n          ndet,\n          firstmjd,\n          lastmjd\n   FROM OBJECT\n   WHERE ndet > 500),\n     s AS\n  (SELECT oid,\n          candid,\n          ssdistnr,\n          ssnamenr\n   FROM ss_ztf\n   WHERE ssdistnr < 2)\nSELECT o.oid,\n       o.ndet,\n       o.firstmjd,\n       o.lastmjd,\n       p.probability,\n       s.candid,\n       s.ssdistnr,\n       s.ssnamenr,\n       d.mjd,\n       d.fid\nFROM o\nINNER JOIN p ON p.oid = o.oid\nINNER JOIN s ON s.oid = o.oid\nINNER JOIN detection d ON d.candid = s.candid\nORDER BY o.firstmjd ASC\nLIMIT 10;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query:\n\n1) Define required output columns\n- From object: oid (ZTF identifier), ndet (number of detections), firstmjd (first detection date), lastmjd (last detection date).\n- From probability: probability (asteroid probability under stamp classifier version).\n- From ss_ztf: candid (candidate identifier), ssdistnr (distance to nearest Solar System/MPC object), ssnamenr (MPC name).\n- From detection: mjd (detection date of the matched candidate), fid (filter identifier).\n- Order by object.firstmjd ascending. Limit 10 rows.\n\n2) Probability filter subquery (asteroid, stamp classifier)\n- Base table: probability.\n- Columns to select: oid, probability.\n- Filters (use exact values):\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.classifier_version = 'stamp_classifier_1.0.4'\n  - probability.class_name = 'asteroid'\n  - probability.probability > 0.5\n  - probability.ranking = 1 (apply default best-class constraint unless explicitly contradicted).\n- Primary key/indices: PK (oid, class_name, classifier_name, classifier_version); btree on ranking; btree on probability; hash on oid.\n\n3) Object filter subquery (ndet > 500)\n- Base table: object.\n- Columns to select: oid, ndet, firstmjd, lastmjd.\n- Filter: object.ndet > 500.\n- Indices: ix_object_ndet on ndet supports this filter.\n\n4) Solar-system proximity subquery (nearest SS object within 2 arcsec)\n- Base table: ss_ztf.\n- Columns to select: oid, candid, ssdistnr, ssnamenr.\n- Filter: ss_ztf.ssdistnr < 2 (interpreted as arcseconds as requested).\n- Indices: PK on (oid); btree on candid (used later to join detection). No dedicated index on ssdistnr (acceptable; optional for performance).\n\n5) Set intersection of qualifying oids (ensure all conditions simultaneously)\n- Build three oid-only projections:\n  - SELECT oid FROM step 2 (probability).\n  - SELECT oid FROM step 3 (object).\n  - SELECT oid FROM step 4 (ss_ztf).\n- Use INTERSECT to obtain the common set:\n  - keep_oids AS (probability_oids INTERSECT object_oids INTERSECT ss_ztf_oids).\n\n6) Detection-row linkage for the matched candidate\n- Join detection by candid to the ss_ztf candidate to get the detection date and filter of the solar-system\u2013matched candidate:\n  - detection.candid = ss_ztf.candid.\n- Columns to select: detection.mjd, detection.fid.\n- Keys/indices: detection.candid is PRIMARY KEY; ss_ztf.candid has btree index, enabling an efficient join.\n\n7) Final assembly via JOINs after INTERSECT\n- FROM keep_oids k\n  - INNER JOIN step 3 (object) o ON o.oid = k.oid\n  - INNER JOIN step 2 (probability) p ON p.oid = k.oid\n  - INNER JOIN step 4 (ss_ztf) s ON s.oid = k.oid\n  - INNER JOIN detection d ON d.candid = s.candid\n- This guarantees:\n  - ndet > 500\n  - asteroid probability > 0.5 in stamp_classifier v 'stamp_classifier_1.0.4' (ranking=1)\n  - nearest SS object within 2 arcsec\n  - detection row corresponds to the SS crossmatch candidate.\n\n8) SELECT list (only requested columns; preserve exact table/column names)\n- o.oid AS ztf_identifier\n- o.ndet AS number_of_detections\n- o.firstmjd AS first_detection_date\n- o.lastmjd AS last_detection_date\n- p.probability AS probability\n- s.candid AS candidate_identifier\n- s.ssdistnr AS distance_arcsec\n- s.ssnamenr AS mpc_name\n- d.mjd AS detection_date\n- d.fid AS filter_identifier\n\n9) Ordering and limiting\n- ORDER BY o.firstmjd ASC.\n- LIMIT 10.\n\n10) Notes/assumptions for correctness and performance\n- The ss_ztf row is unique per oid (PRIMARY KEY (oid)); detection join by candid returns a single row (detection.candid is PRIMARY KEY), so no duplicates per oid.\n- No Q3C spatial functions are required (selection is not by sky coordinates).\n- Using INTERSECT ensures strict satisfaction of all three independent constraints before assembling full rows."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query:\n\n1) Define required output columns\n- From object: oid (ZTF identifier), ndet (number of detections), firstmjd (first detection date), lastmjd (last detection date).\n- From probability: probability (asteroid probability under stamp classifier version).\n- From ss_ztf: candid (candidate identifier), ssdistnr (distance to nearest Solar System/MPC object), ssnamenr (MPC name).\n- From detection: mjd (detection date of the matched candidate), fid (filter identifier).\n- Order by object.firstmjd ascending. Limit 10 rows.\n\n2) Probability filter subquery (asteroid, stamp classifier)\n- Base table: probability.\n- Columns to select: oid, probability.\n- Filters (use exact values):\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.classifier_version = 'stamp_classifier_1.0.4'\n  - probability.class_name = 'asteroid'\n  - probability.probability > 0.5\n  - probability.ranking = 1 (apply default best-class constraint unless explicitly contradicted).\n- Primary key/indices: PK (oid, class_name, classifier_name, classifier_version); btree on ranking; btree on probability; hash on oid.\n\n3) Object filter subquery (ndet > 500)\n- Base table: object.\n- Columns to select: oid, ndet, firstmjd, lastmjd.\n- Filter: object.ndet > 500.\n- Indices: ix_object_ndet on ndet supports this filter.\n\n4) Solar-system proximity subquery (nearest SS object within 2 arcsec)\n- Base table: ss_ztf.\n- Columns to select: oid, candid, ssdistnr, ssnamenr.\n- Filter: ss_ztf.ssdistnr < 2 (interpreted as arcseconds as requested).\n- Indices: PK on (oid); btree on candid (used later to join detection). No dedicated index on ssdistnr (acceptable; optional for performance).\n\n5) Set intersection of qualifying oids (ensure all conditions simultaneously)\n- Build three oid-only projections:\n  - SELECT oid FROM step 2 (probability).\n  - SELECT oid FROM step 3 (object).\n  - SELECT oid FROM step 4 (ss_ztf).\n- Use INTERSECT to obtain the common set:\n  - keep_oids AS (probability_oids INTERSECT object_oids INTERSECT ss_ztf_oids).\n\n6) Detection-row linkage for the matched candidate\n- Join detection by candid to the ss_ztf candidate to get the detection date and filter of the solar-system\u2013matched candidate:\n  - detection.candid = ss_ztf.candid.\n- Columns to select: detection.mjd, detection.fid.\n- Keys/indices: detection.candid is PRIMARY KEY; ss_ztf.candid has btree index, enabling an efficient join.\n\n7) Final assembly via JOINs after INTERSECT\n- FROM keep_oids k\n  - INNER JOIN step 3 (object) o ON o.oid = k.oid\n  - INNER JOIN step 2 (probability) p ON p.oid = k.oid\n  - INNER JOIN step 4 (ss_ztf) s ON s.oid = k.oid\n  - INNER JOIN detection d ON d.candid = s.candid\n- This guarantees:\n  - ndet > 500\n  - asteroid probability > 0.5 in stamp_classifier v 'stamp_classifier_1.0.4' (ranking=1)\n  - nearest SS object within 2 arcsec\n  - detection row corresponds to the SS crossmatch candidate.\n\n8) SELECT list (only requested columns; preserve exact table/column names)\n- o.oid AS ztf_identifier\n- o.ndet AS number_of_detections\n- o.firstmjd AS first_detection_date\n- o.lastmjd AS last_detection_date\n- p.probability AS probability\n- s.candid AS candidate_identifier\n- s.ssdistnr AS distance_arcsec\n- s.ssnamenr AS mpc_name\n- d.mjd AS detection_date\n- d.fid AS filter_identifier\n\n9) Ordering and limiting\n- ORDER BY o.firstmjd ASC.\n- LIMIT 10.\n\n10) Notes/assumptions for correctness and performance\n- The ss_ztf row is unique per oid (PRIMARY KEY (oid)); detection join by candid returns a single row (detection.candid is PRIMARY KEY), so no duplicates per oid.\n- No Q3C spatial functions are required (selection is not by sky coordinates).\n- Using INTERSECT ensures strict satisfaction of all three independent constraints before assembling full rows."
                    },
                    "in_toks": 3764,
                    "out_toks": 4336,
                    "id": "chatcmpl-Cb6hiPd3LQBzWP0qKrnxpa9hwCwwL",
                    "created": 1762959942,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Find ZTF objects with ndet > 500, asteroid prob > 0.5 in stamp_classifier_1.0.4 (ranking=1),\n-- nearest Solar System object within 2 arcsec; return requested columns, ordered by firstmjd, limit 10.\nWITH p AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE ranking = 1\n     AND classifier_name = 'stamp_classifier'\n     AND classifier_version = 'stamp_classifier_1.0.4'\n     AND class_name = 'asteroid'\n     AND probability > 0.5),\n     o AS\n  (SELECT oid,\n          ndet,\n          firstmjd,\n          lastmjd\n   FROM OBJECT\n   WHERE ndet > 500),\n     s AS\n  (SELECT oid,\n          candid,\n          ssdistnr,\n          ssnamenr\n   FROM ss_ztf\n   WHERE ssdistnr < 2)\nSELECT o.oid,\n       o.ndet,\n       o.firstmjd,\n       o.lastmjd,\n       p.probability,\n       s.candid,\n       s.ssdistnr,\n       s.ssnamenr,\n       d.mjd,\n       d.fid\nFROM o\nINNER JOIN p ON p.oid = o.oid\nINNER JOIN s ON s.oid = o.oid\nINNER JOIN detection d ON d.candid = s.candid\nORDER BY o.firstmjd ASC\nLIMIT 10;"
                        },
                        "in_toks": 3424,
                        "out_toks": 1593,
                        "id": "chatcmpl-Cb6jdOg0wD2JjnfguK3U9XYkBEdKY",
                        "created": 1762960061,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "107",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "probability",
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'ss_ztf', 'detection']"
                },
                "in_toks": 699,
                "out_toks": 1882,
                "id": "chatcmpl-CSsn9pIYJXP1Alhqrg2gWTwCBlLCs",
                "created": 1760999839,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1886,
                "out_toks": 527,
                "id": "chatcmpl-CSxZimJC05xz4lx21qO7d9RN52rjE",
                "created": 1761018226,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Find up to 10 ZTF objects with ndet > 500, asteroid prob > 0.5 in stamp_classifier_1.0.4, and ssdistnr < 2 arcsec.\n-- Return requested columns and order by firstmjd.\n WITH prob_asteroid AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE class_name = 'asteroid'\n     AND classifier_name = 'stamp_classifier' -- override default lc_classifier\n\n     AND classifier_version = 'stamp_classifier_1.0.4'\n     AND ranking = 1\n     AND probability > 0.5),\n      solar_match AS\n  (SELECT oid,\n          candid,\n          ssdistnr,\n          ssnamenr\n   FROM ss_ztf\n   WHERE ssdistnr < 2.0),\n      candidates_by_ndet AS\n  (SELECT oid,\n          ndet,\n          firstmjd,\n          lastmjd\n   FROM OBJECT\n   WHERE ndet > 500),\n      base_ids AS\n  (SELECT oid\n   FROM candidates_by_ndet INTERSECT SELECT oid\n   FROM prob_asteroid INTERSECT SELECT oid\n   FROM solar_match),\n      top10_ids AS\n  (SELECT b.oid\n   FROM base_ids b\n   INNER JOIN OBJECT o USING (oid)\n   ORDER BY o.firstmjd ASC\n   LIMIT 10)\nSELECT o.oid,\n       o.ndet,\n       o.firstmjd,\n       o.lastmjd,\n       p.probability,\n       s.candid,\n       s.ssdistnr,\n       s.ssnamenr,\n       d.mjd,\n       d.fid\nFROM top10_ids t\nINNER JOIN OBJECT o ON o.oid = t.oid\nINNER JOIN prob_asteroid p ON p.oid = o.oid\nINNER JOIN solar_match s ON s.oid = o.oid\nINNER JOIN detection d ON d.candid = s.candid\nORDER BY o.firstmjd ASC,\n         o.oid ASC;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Define the filters and required columns\n- Object-level constraints (table object):\n  - ndet > 500\n  - Need: oid (ZTF identifier), ndet, firstmjd, lastmjd\n- Probability constraints (table probability):\n  - class_name = 'asteroid'\n  - classifier_name = 'stamp_classifier'  [explicitly overrides the general default of 'lc_classifier']\n  - classifier_version = 'stamp_classifier_1.0.4'\n  - ranking = 1  [keep this default to ensure top class is asteroid]\n  - probability > 0.5\n  - Need: oid, probability\n- Solar system match constraints (table ss_ztf):\n  - ssdistnr < 2.0  [arcsec]\n  - Need: oid, candid, ssdistnr (distance), ssnamenr (MPC name)\n- Detection row to report the detection date and filter (table detection):\n  - Join via candid = ss_ztf.candid\n  - Need: mjd (detection date), fid (filter identifier)\n\n2) Build per-table filtered subqueries (CTEs) for performance and clarity\n- prob_asteroid: rows in probability that meet the asteroid condition\n  - FROM probability\n  - WHERE class_name = 'asteroid'\n    AND classifier_name = 'stamp_classifier'\n    AND classifier_version = 'stamp_classifier_1.0.4'\n    AND ranking = 1\n    AND probability > 0.5\n  - SELECT oid, probability\n- solar_match: rows in ss_ztf with close solar system counterpart\n  - FROM ss_ztf\n  - WHERE ssdistnr < 2.0\n  - SELECT oid, candid, ssdistnr, ssnamenr\n- candidates_by_ndet: objects meeting the detection-count threshold\n  - FROM object\n  - WHERE ndet > 500\n  - SELECT oid, ndet, firstmjd, lastmjd\n\n3) Derive the set of valid object IDs using INTERSECT\n- Build base_ids as the intersection of the three sets, ensuring objects satisfy all three independent constraints:\n  - SELECT oid FROM candidates_by_ndet\n  INTERSECT\n  - SELECT oid FROM prob_asteroid\n  INTERSECT\n  - SELECT oid FROM solar_match\n- Output: base_ids(oid)\n\n4) Restrict to at most 10 objects by earliest first detection date\n- Join base_ids to object to access firstmjd for ordering and apply LIMIT 10:\n  - FROM base_ids b\n  - INNER JOIN object o USING (oid)\n  - ORDER BY o.firstmjd ASC\n  - LIMIT 10\n- Output: top10_ids(oid)\n- Rationale: limiting earlier avoids unnecessary joins to large tables for objects outside the earliest 10.\n\n5) Assemble the final result by joining details for the 10 objects\n- Start from object, restricted by top10_ids:\n  - FROM object o\n  - INNER JOIN top10_ids t ON t.oid = o.oid\n- Join the asteroid probability to bring the probability value:\n  - INNER JOIN prob_asteroid p ON p.oid = o.oid\n- Join the solar system match to bring candid, distance, and MPC name:\n  - INNER JOIN solar_match s ON s.oid = o.oid\n- Join the detection row corresponding to the ss_ztf candid to obtain detection date and filter:\n  - INNER JOIN detection d ON d.candid = s.candid\n    [Optionally also assert d.oid = o.oid for consistency, though joining on candid is sufficient since detection.candid is PRIMARY KEY.]\n- Columns to SELECT (and final aliases):\n  - o.oid AS ztf_id\n  - o.ndet\n  - o.firstmjd\n  - o.lastmjd\n  - p.probability\n  - s.candid\n  - s.ssdistnr\n  - s.ssnamenr\n  - d.mjd AS detection_mjd\n  - d.fid\n- Final ORDER BY:\n  - ORDER BY o.firstmjd ASC\n  - Note: Already constrained to the earliest 10 via top10_ids; keep ORDER BY in the outer SELECT for clarity and stability (optionally add o.oid as a tiebreaker).\n\n6) Index and execution notes\n- object: ix_ndet on ndet and ix_object_firstmjd on firstmjd support the WHERE ndet > 500 and ORDER BY firstmjd.\n- probability: PRIMARY KEY (oid, class_name, classifier_name, classifier_version) enables fast access when filtering by those exact values; ix_probabilities_ranking helps with ranking = 1; also filter on probability > 0.5.\n- ss_ztf: PRIMARY KEY (oid) and ix_ss_ztf_candid on candid; the WHERE ssdistnr < 2.0 benefits from sequential filtering; the join to detection uses detection.candid PRIMARY KEY.\n- detection: candid is PRIMARY KEY, so join by candid is optimal.\n\n7) Query structure summary (no SQL code, just shape)\n- WITH prob_asteroid AS (filter probability)\n- , solar_match AS (filter ss_ztf)\n- , candidates_by_ndet AS (filter object)\n- , base_ids AS (\n    SELECT oid FROM candidates_by_ndet\n    INTERSECT\n    SELECT oid FROM prob_asteroid\n    INTERSECT\n    SELECT oid FROM solar_match\n  )\n- , top10_ids AS (\n    SELECT b.oid\n    FROM base_ids b\n    JOIN object o USING (oid)\n    ORDER BY o.firstmjd ASC\n    LIMIT 10\n  )\n- SELECT required columns\n  FROM object o\n  JOIN top10_ids t ON t.oid = o.oid\n  JOIN prob_asteroid p ON p.oid = o.oid\n  JOIN solar_match s ON s.oid = o.oid\n  JOIN detection d ON d.candid = s.candid\n  ORDER BY o.firstmjd ASC\n- LIMIT is not needed in the final SELECT since top10_ids already bounds the result to at most 10 rows."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\n1) Define the filters and required columns\n- Object-level constraints (table object):\n  - ndet > 500\n  - Need: oid (ZTF identifier), ndet, firstmjd, lastmjd\n- Probability constraints (table probability):\n  - class_name = 'asteroid'\n  - classifier_name = 'stamp_classifier'  [explicitly overrides the general default of 'lc_classifier']\n  - classifier_version = 'stamp_classifier_1.0.4'\n  - ranking = 1  [keep this default to ensure top class is asteroid]\n  - probability > 0.5\n  - Need: oid, probability\n- Solar system match constraints (table ss_ztf):\n  - ssdistnr < 2.0  [arcsec]\n  - Need: oid, candid, ssdistnr (distance), ssnamenr (MPC name)\n- Detection row to report the detection date and filter (table detection):\n  - Join via candid = ss_ztf.candid\n  - Need: mjd (detection date), fid (filter identifier)\n\n2) Build per-table filtered subqueries (CTEs) for performance and clarity\n- prob_asteroid: rows in probability that meet the asteroid condition\n  - FROM probability\n  - WHERE class_name = 'asteroid'\n    AND classifier_name = 'stamp_classifier'\n    AND classifier_version = 'stamp_classifier_1.0.4'\n    AND ranking = 1\n    AND probability > 0.5\n  - SELECT oid, probability\n- solar_match: rows in ss_ztf with close solar system counterpart\n  - FROM ss_ztf\n  - WHERE ssdistnr < 2.0\n  - SELECT oid, candid, ssdistnr, ssnamenr\n- candidates_by_ndet: objects meeting the detection-count threshold\n  - FROM object\n  - WHERE ndet > 500\n  - SELECT oid, ndet, firstmjd, lastmjd\n\n3) Derive the set of valid object IDs using INTERSECT\n- Build base_ids as the intersection of the three sets, ensuring objects satisfy all three independent constraints:\n  - SELECT oid FROM candidates_by_ndet\n  INTERSECT\n  - SELECT oid FROM prob_asteroid\n  INTERSECT\n  - SELECT oid FROM solar_match\n- Output: base_ids(oid)\n\n4) Restrict to at most 10 objects by earliest first detection date\n- Join base_ids to object to access firstmjd for ordering and apply LIMIT 10:\n  - FROM base_ids b\n  - INNER JOIN object o USING (oid)\n  - ORDER BY o.firstmjd ASC\n  - LIMIT 10\n- Output: top10_ids(oid)\n- Rationale: limiting earlier avoids unnecessary joins to large tables for objects outside the earliest 10.\n\n5) Assemble the final result by joining details for the 10 objects\n- Start from object, restricted by top10_ids:\n  - FROM object o\n  - INNER JOIN top10_ids t ON t.oid = o.oid\n- Join the asteroid probability to bring the probability value:\n  - INNER JOIN prob_asteroid p ON p.oid = o.oid\n- Join the solar system match to bring candid, distance, and MPC name:\n  - INNER JOIN solar_match s ON s.oid = o.oid\n- Join the detection row corresponding to the ss_ztf candid to obtain detection date and filter:\n  - INNER JOIN detection d ON d.candid = s.candid\n    [Optionally also assert d.oid = o.oid for consistency, though joining on candid is sufficient since detection.candid is PRIMARY KEY.]\n- Columns to SELECT (and final aliases):\n  - o.oid AS ztf_id\n  - o.ndet\n  - o.firstmjd\n  - o.lastmjd\n  - p.probability\n  - s.candid\n  - s.ssdistnr\n  - s.ssnamenr\n  - d.mjd AS detection_mjd\n  - d.fid\n- Final ORDER BY:\n  - ORDER BY o.firstmjd ASC\n  - Note: Already constrained to the earliest 10 via top10_ids; keep ORDER BY in the outer SELECT for clarity and stability (optionally add o.oid as a tiebreaker).\n\n6) Index and execution notes\n- object: ix_ndet on ndet and ix_object_firstmjd on firstmjd support the WHERE ndet > 500 and ORDER BY firstmjd.\n- probability: PRIMARY KEY (oid, class_name, classifier_name, classifier_version) enables fast access when filtering by those exact values; ix_probabilities_ranking helps with ranking = 1; also filter on probability > 0.5.\n- ss_ztf: PRIMARY KEY (oid) and ix_ss_ztf_candid on candid; the WHERE ssdistnr < 2.0 benefits from sequential filtering; the join to detection uses detection.candid PRIMARY KEY.\n- detection: candid is PRIMARY KEY, so join by candid is optimal.\n\n7) Query structure summary (no SQL code, just shape)\n- WITH prob_asteroid AS (filter probability)\n- , solar_match AS (filter ss_ztf)\n- , candidates_by_ndet AS (filter object)\n- , base_ids AS (\n    SELECT oid FROM candidates_by_ndet\n    INTERSECT\n    SELECT oid FROM prob_asteroid\n    INTERSECT\n    SELECT oid FROM solar_match\n  )\n- , top10_ids AS (\n    SELECT b.oid\n    FROM base_ids b\n    JOIN object o USING (oid)\n    ORDER BY o.firstmjd ASC\n    LIMIT 10\n  )\n- SELECT required columns\n  FROM object o\n  JOIN top10_ids t ON t.oid = o.oid\n  JOIN prob_asteroid p ON p.oid = o.oid\n  JOIN solar_match s ON s.oid = o.oid\n  JOIN detection d ON d.candid = s.candid\n  ORDER BY o.firstmjd ASC\n- LIMIT is not needed in the final SELECT since top10_ids already bounds the result to at most 10 rows."
                    },
                    "in_toks": 3764,
                    "out_toks": 5158,
                    "id": "chatcmpl-Cb6kFKTBas1K6CcwRXDtFuZe7vgox",
                    "created": 1762960099,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Find up to 10 ZTF objects with ndet > 500, asteroid prob > 0.5 in stamp_classifier_1.0.4, and ssdistnr < 2 arcsec.\n-- Return requested columns and order by firstmjd.\n WITH prob_asteroid AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE class_name = 'asteroid'\n     AND classifier_name = 'stamp_classifier' -- override default lc_classifier\n\n     AND classifier_version = 'stamp_classifier_1.0.4'\n     AND ranking = 1\n     AND probability > 0.5),\n      solar_match AS\n  (SELECT oid,\n          candid,\n          ssdistnr,\n          ssnamenr\n   FROM ss_ztf\n   WHERE ssdistnr < 2.0),\n      candidates_by_ndet AS\n  (SELECT oid,\n          ndet,\n          firstmjd,\n          lastmjd\n   FROM OBJECT\n   WHERE ndet > 500),\n      base_ids AS\n  (SELECT oid\n   FROM candidates_by_ndet INTERSECT SELECT oid\n   FROM prob_asteroid INTERSECT SELECT oid\n   FROM solar_match),\n      top10_ids AS\n  (SELECT b.oid\n   FROM base_ids b\n   INNER JOIN OBJECT o USING (oid)\n   ORDER BY o.firstmjd ASC\n   LIMIT 10)\nSELECT o.oid,\n       o.ndet,\n       o.firstmjd,\n       o.lastmjd,\n       p.probability,\n       s.candid,\n       s.ssdistnr,\n       s.ssnamenr,\n       d.mjd,\n       d.fid\nFROM top10_ids t\nINNER JOIN OBJECT o ON o.oid = t.oid\nINNER JOIN prob_asteroid p ON p.oid = o.oid\nINNER JOIN solar_match s ON s.oid = o.oid\nINNER JOIN detection d ON d.candid = s.candid\nORDER BY o.firstmjd ASC,\n         o.oid ASC;"
                        },
                        "in_toks": 3734,
                        "out_toks": 1857,
                        "id": "chatcmpl-Cb6mOtJurQH2r0XGNbjVcKzo8luBO",
                        "created": 1762960232,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "107",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'ss_ztf', 'detection']"
                },
                "in_toks": 699,
                "out_toks": 2333,
                "id": "chatcmpl-CSsnmG0DawwKMevx2QRXkTYJdeQlN",
                "created": 1760999878,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1931,
                "out_toks": 783,
                "id": "chatcmpl-CSxZoMNMxH47lQU5QTMNezYmYcLu2",
                "created": 1761018232,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3809,
                "out_toks": 4000,
                "id": "chatcmpl-CSxjLgpWhfZX7knx9cbSaGd36conE",
                "created": 1761018823,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 10 ZTF objects with >500 detections, asteroid probability > 0.5\n-- in the stamp classifier version 'stamp_classifier_1.0.4', and with at least\n-- one detection having ssdistnr < 2 arcsec. Return one detection per object\n-- (the one with the smallest ssdistnr), ordered by the object's first detection date.\n-- Note: This query assumes detection.ssdistnr (arcsec) and detection.ssnamenr (MPC name)\n-- are available in the detection table, as in ZTF alert schemas.\n\nWITH base AS (\n    SELECT\n        o.oid,\n        o.ndet,\n        o.firstmjd,\n        o.lastmjd,\n        p.probability\n    FROM object o\n    INNER JOIN probability p ON p.oid = o.oid\n    WHERE\n        o.ndet > 500\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.classifier_version = 'stamp_classifier_1.0.4'\n        AND p.class_name = 'asteroid'\n        AND p.probability > 0.5\n),\nper_oid AS (\n    SELECT DISTINCT ON (b.oid)\n        b.oid,\n        b.ndet,\n        b.firstmjd,\n        b.lastmjd,\n        b.probability,\n        d.candid,\n        d.ssdistnr,\n        d.ssnamenr,\n        d.mjd,\n        d.fid\n    FROM base b\n    INNER JOIN detection d ON d.oid = b.oid\n    WHERE d.ssdistnr < 2.0\n    ORDER BY b.oid, d.ssdistnr ASC, d.mjd ASC\n)\nSELECT\n    oid,\n    ndet,\n    firstmjd,\n    lastmjd,\n    probability,\n    candid,\n    ssdistnr,\n    ssnamenr,\n    mjd,\n    fid\nFROM per_oid\nORDER BY firstmjd ASC\nLIMIT 10;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 10 ZTF objects with >500 detections, asteroid probability > 0.5\n-- in the stamp classifier version 'stamp_classifier_1.0.4', and with at least\n-- one detection having ssdistnr < 2 arcsec. Return one detection per object\n-- (the one with the smallest ssdistnr), ordered by the object's first detection date.\n-- Note: This query assumes detection.ssdistnr (arcsec) and detection.ssnamenr (MPC name)\n-- are available in the detection table, as in ZTF alert schemas.\n\nWITH base AS (\n    SELECT\n        o.oid,\n        o.ndet,\n        o.firstmjd,\n        o.lastmjd,\n        p.probability\n    FROM object o\n    INNER JOIN probability p ON p.oid = o.oid\n    WHERE\n        o.ndet > 500\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.classifier_version = 'stamp_classifier_1.0.4'\n        AND p.class_name = 'asteroid'\n        AND p.probability > 0.5\n),\nper_oid AS (\n    SELECT DISTINCT ON (b.oid)\n        b.oid,\n        b.ndet,\n        b.firstmjd,\n        b.lastmjd,\n        b.probability,\n        d.candid,\n        d.ssdistnr,\n        d.ssnamenr,\n        d.mjd,\n        d.fid\n    FROM base b\n    INNER JOIN detection d ON d.oid = b.oid\n    WHERE d.ssdistnr < 2.0\n    ORDER BY b.oid, d.ssdistnr ASC, d.mjd ASC\n)\nSELECT\n    oid,\n    ndet,\n    firstmjd,\n    lastmjd,\n    probability,\n    candid,\n    ssdistnr,\n    ssnamenr,\n    mjd,\n    fid\nFROM per_oid\nORDER BY firstmjd ASC\nLIMIT 10;\n```"
                },
                "in_toks": 3086,
                "out_toks": 3506,
                "id": "chatcmpl-CSyQQQpN9ceySZfKWZX2LVhXv4K4h",
                "created": 1761021494,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "107",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'ss_ztf', 'detection']"
                },
                "in_toks": 699,
                "out_toks": 2013,
                "id": "chatcmpl-CSsoEBzpPjWUwbJkLFLfZ5N4YLVRm",
                "created": 1760999906,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1931,
                "out_toks": 719,
                "id": "chatcmpl-CSxZwzSM3HQrIkaSn4UXlTTfiYRh9",
                "created": 1761018240,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3809,
                "out_toks": 4000,
                "id": "chatcmpl-CSxk6OuWvDZpeibIruFFmWVXlZesZ",
                "created": 1761018870,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 10 ZTF objects with:\n--  - ndet > 500\n--  - stamp classifier ('stamp_classifier_1.0.4') probability > 0.5 for class 'asteroid' (ranking = 1)\n--  - at least one detection with ssdistnr < 2 arcsec (nearest Solar System object) and known ssnamenr\n-- Return the requested columns and order results by the object's first detection date (firstmjd)\nWITH best_det AS (\n    SELECT *\n    FROM (\n        SELECT\n            d.*,\n            row_number() OVER (PARTITION BY d.oid ORDER BY d.ssdistnr ASC, d.mjd ASC) AS rn\n        FROM detection d\n        WHERE d.ssdistnr IS NOT NULL\n          AND d.ssnamenr IS NOT NULL\n          AND d.ssdistnr < 2.0  -- arcseconds\n    ) t\n    WHERE t.rn = 1\n)\nSELECT\n    o.oid,                -- ZTF identifier\n    o.ndet,               -- number of detections\n    o.firstmjd,           -- first detection date\n    o.lastmjd,            -- last detection date\n    p.probability,        -- probability from stamp classifier\n    bd.candid,            -- candidate identifier\n    bd.ssdistnr,          -- distance to nearest Solar System object (arcsec)\n    bd.ssnamenr,          -- MPC name\n    bd.mjd,               -- detection date\n    bd.fid                -- filter identifier (1=g; 2=r; 3=i)\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\nINNER JOIN best_det bd\n    ON bd.oid = o.oid\nWHERE o.ndet > 500\n  AND p.classifier_name = 'stamp_classifier'\n  AND p.classifier_version = 'stamp_classifier_1.0.4'\n  AND p.class_name = 'asteroid'\n  AND p.probability > 0.5\n  AND p.ranking = 1\nORDER BY o.firstmjd ASC\nLIMIT 10;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 10 ZTF objects with:\n--  - ndet > 500\n--  - stamp classifier ('stamp_classifier_1.0.4') probability > 0.5 for class 'asteroid' (ranking = 1)\n--  - at least one detection with ssdistnr < 2 arcsec (nearest Solar System object) and known ssnamenr\n-- Return the requested columns and order results by the object's first detection date (firstmjd)\nWITH best_det AS (\n    SELECT *\n    FROM (\n        SELECT\n            d.*,\n            row_number() OVER (PARTITION BY d.oid ORDER BY d.ssdistnr ASC, d.mjd ASC) AS rn\n        FROM detection d\n        WHERE d.ssdistnr IS NOT NULL\n          AND d.ssnamenr IS NOT NULL\n          AND d.ssdistnr < 2.0  -- arcseconds\n    ) t\n    WHERE t.rn = 1\n)\nSELECT\n    o.oid,                -- ZTF identifier\n    o.ndet,               -- number of detections\n    o.firstmjd,           -- first detection date\n    o.lastmjd,            -- last detection date\n    p.probability,        -- probability from stamp classifier\n    bd.candid,            -- candidate identifier\n    bd.ssdistnr,          -- distance to nearest Solar System object (arcsec)\n    bd.ssnamenr,          -- MPC name\n    bd.mjd,               -- detection date\n    bd.fid                -- filter identifier (1=g; 2=r; 3=i)\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\nINNER JOIN best_det bd\n    ON bd.oid = o.oid\nWHERE o.ndet > 500\n  AND p.classifier_name = 'stamp_classifier'\n  AND p.classifier_version = 'stamp_classifier_1.0.4'\n  AND p.class_name = 'asteroid'\n  AND p.probability > 0.5\n  AND p.ranking = 1\nORDER BY o.firstmjd ASC\nLIMIT 10;\n```"
                },
                "in_toks": 3086,
                "out_toks": 3346,
                "id": "chatcmpl-CSyQtw4ktPFTaa4rqYJvDZBBwnvM4",
                "created": 1761021523,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "107",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "probability",
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'ss_ztf', 'detection']"
                },
                "in_toks": 699,
                "out_toks": 1370,
                "id": "chatcmpl-CZN6l4GpDapXCAXAotfzDAWB11PiA",
                "created": 1762546343,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1886,
                "out_toks": 911,
                "id": "chatcmpl-CZYaiusJITUMpj0nBFkv5eDWIqchd",
                "created": 1762590484,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3764,
                "out_toks": 4000,
                "id": "chatcmpl-CZZeBKr51cGptuAXVgNvyrs68uUQw",
                "created": 1762594543,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find ZTF objects with >500 detections, asteroid probability >0.5 (stamp_classifier_1.0.4),\n-- and within 2 arcsec of the nearest Solar System object (MPC). Returns up to 10 rows.\n-- NOTE: Replace the 'mpc' CTE with your actual Solar System/MPC catalog table or a VALUES list.\nWITH mpc (mpc_name, ra, dec) AS (\n    VALUES\n    -- ('MPC_object_name', ra_in_deg, dec_in_deg)\n    -- Add rows or replace this CTE with your real MPC/Solar System object table\n)\nSELECT\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    o.lastmjd,\n    p.probability,\n    d.candid,\n    mnear.dist_deg * 3600.0 AS dist_arcsec,  -- distance in arcsec\n    mnear.mpc_name,\n    d.mjd,\n    d.fid\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\n   AND p.classifier_name = 'stamp_classifier'\n   AND p.classifier_version = 'stamp_classifier_1.0.4'\n   AND p.class_name = 'asteroid'\n   AND p.probability > 0.5\n-- earliest detection per object\nINNER JOIN LATERAL (\n    SELECT d1.*\n    FROM detection d1\n    WHERE d1.oid = o.oid\n    ORDER BY d1.mjd ASC\n    LIMIT 1\n) d ON TRUE\n-- nearest MPC object within 2 arcsec\nINNER JOIN LATERAL (\n    SELECT\n        m.mpc_name,\n        q3c_dist(o.meanra, o.meandec, m.ra, m.dec) AS dist_deg\n    FROM mpc m\n    WHERE q3c_join(o.meanra, o.meandec, m.ra, m.dec, 2.0/3600.0)\n    ORDER BY dist_deg ASC\n    LIMIT 1\n) mnear ON TRUE\nWHERE o.ndet > 500\nORDER BY o.firstmjd\nLIMIT 10;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find ZTF objects with >500 detections, asteroid probability >0.5 (stamp_classifier_1.0.4),\n-- and within 2 arcsec of the nearest Solar System object (MPC). Returns up to 10 rows.\n-- NOTE: Replace the 'mpc' CTE with your actual Solar System/MPC catalog table or a VALUES list.\nWITH mpc (mpc_name, ra, dec) AS (\n    VALUES\n    -- ('MPC_object_name', ra_in_deg, dec_in_deg)\n    -- Add rows or replace this CTE with your real MPC/Solar System object table\n)\nSELECT\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    o.lastmjd,\n    p.probability,\n    d.candid,\n    mnear.dist_deg * 3600.0 AS dist_arcsec,  -- distance in arcsec\n    mnear.mpc_name,\n    d.mjd,\n    d.fid\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\n   AND p.classifier_name = 'stamp_classifier'\n   AND p.classifier_version = 'stamp_classifier_1.0.4'\n   AND p.class_name = 'asteroid'\n   AND p.probability > 0.5\n-- earliest detection per object\nINNER JOIN LATERAL (\n    SELECT d1.*\n    FROM detection d1\n    WHERE d1.oid = o.oid\n    ORDER BY d1.mjd ASC\n    LIMIT 1\n) d ON TRUE\n-- nearest MPC object within 2 arcsec\nINNER JOIN LATERAL (\n    SELECT\n        m.mpc_name,\n        q3c_dist(o.meanra, o.meandec, m.ra, m.dec) AS dist_deg\n    FROM mpc m\n    WHERE q3c_join(o.meanra, o.meandec, m.ra, m.dec, 2.0/3600.0)\n    ORDER BY dist_deg ASC\n    LIMIT 1\n) mnear ON TRUE\nWHERE o.ndet > 500\nORDER BY o.firstmjd\nLIMIT 10;\n```"
                },
                "in_toks": 3086,
                "out_toks": 3854,
                "id": "chatcmpl-CZawcipIhug03d9YPdmbyclqKROBm",
                "created": 1762599530,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "107",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "probability",
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'ss_ztf', 'detection']"
                },
                "in_toks": 699,
                "out_toks": 1754,
                "id": "chatcmpl-CZN7GAbn9VDWvCBQ05kyczBsCJPDt",
                "created": 1762546374,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1886,
                "out_toks": 783,
                "id": "chatcmpl-CZYb11fIUJSKdyGI6KztQUdEdOeQW",
                "created": 1762590503,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Find at most 10 ZTF objects with ndet > 500, asteroid probability > 0.5 in stamp_classifier v1.0.4 (ranking=1),\n-- and nearest Solar System object distance < 2 arcsec. Include requested columns and order by firstmjd.\nWITH objects_gt500 AS\n  (SELECT o.oid,\n          o.ndet,\n          o.firstmjd,\n          o.lastmjd\n   FROM OBJECT o\n   WHERE o.ndet > 500),\n     asteroid_prob AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.probability > 0.5\n     AND p.ranking = 1),\n     ss_match AS\n  (SELECT s.oid,\n          s.candid,\n          s.ssdistnr,\n          s.ssnamenr\n   FROM ss_ztf s\n   WHERE s.ssdistnr < 2),\n     final_oids AS\n  (SELECT oid\n   FROM objects_gt500 INTERSECT SELECT oid\n   FROM asteroid_prob INTERSECT SELECT oid\n   FROM ss_match)\nSELECT o.oid,\n       o.ndet,\n       o.firstmjd,\n       o.lastmjd,\n       p.probability,\n       s.candid,\n       s.ssdistnr,\n       s.ssnamenr,\n       d.mjd,\n       d.fid\nFROM final_oids f\nINNER JOIN objects_gt500 o ON o.oid = f.oid\nINNER JOIN asteroid_prob p ON p.oid = f.oid\nINNER JOIN ss_match s ON s.oid = f.oid\nINNER JOIN detection d ON d.candid = s.candid\nORDER BY o.firstmjd ASC\nLIMIT 10;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Define the inputs and filters\n- Dataset: ALeRCE ZTF objects.\n- Required filters:\n  - object.ndet > 500\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.classifier_version = 'stamp_classifier_1.0.4'\n  - probability.class_name = 'asteroid'\n  - probability.probability > 0.5\n  - probability.ranking = 1 (apply default \u201cranking=1\u201d, while using the user-specified classifier/version)\n  - ss_ztf.ssdistnr < 2 (arcsec)\n- Columns to return:\n  - object.oid (ZTF identifier)\n  - object.ndet (number of detections)\n  - object.firstmjd, object.lastmjd (first and last detection date)\n  - probability.probability (asteroid probability)\n  - ss_ztf.candid (candidate identifier)\n  - ss_ztf.ssdistnr (distance to MPC object, arcsec)\n  - ss_ztf.ssnamenr (MPC name; note: may be the string 'null')\n  - detection.mjd (detection date)\n  - detection.fid (filter identifier)\n- Ordering and row limit:\n  - ORDER BY object.firstmjd ASC\n  - LIMIT 10 objects (unique oids)\n\n2) Build a subquery for objects with > 500 detections (objects_gt500)\n- FROM object o\n- WHERE o.ndet > 500\n- SELECT o.oid, o.ndet, o.firstmjd, o.lastmjd\n- Indexes leveraged: ix_object_ndet (filter), ix_object_firstmjd (later ordering)\n\n3) Build a subquery for asteroid-class probability from the Stamp classifier (asteroid_prob)\n- FROM probability p\n- WHERE\n  - p.classifier_name = 'stamp_classifier'\n  - p.classifier_version = 'stamp_classifier_1.0.4'\n  - p.class_name = 'asteroid'\n  - p.probability > 0.5\n  - p.ranking = 1\n- SELECT p.oid, p.probability\n- Notes:\n  - This enforces the user\u2019s classifier/version and class, with the default constraint ranking=1.\n  - Indexes leveraged: ix_probabilities_ranking (ranking=1), ix_probabilities_probability (probability > 0.5)\n\n4) Build a subquery for Solar System crossmatch with distance < 2 arcsec (ss_match)\n- FROM ss_ztf s\n- WHERE s.ssdistnr < 2\n- SELECT s.oid, s.candid, s.ssdistnr, s.ssnamenr\n- Notes:\n  - ss_ztf primary key is (oid); candid refers to the associated detection.\n  - We do not exclude rows with ssnamenr = 'null' (string), since the user did not request that.\n\n5) Compute the set of oids that satisfy all three independent conditions using INTERSECT (final_oids)\n- Create three SELECT statements that each output only the oid column:\n  - SELECT oid FROM objects_gt500\n  - SELECT oid FROM asteroid_prob\n  - SELECT oid FROM ss_match\n- INTERSECT them: this enforces that oids satisfy all three constraints simultaneously.\n- Resulting CTE/table: final_oids(oid)\n\n6) Join to gather full row data including detection info\n- Start from final_oids f\n- INNER JOIN objects_gt500 o ON o.oid = f.oid\n- INNER JOIN asteroid_prob p ON p.oid = f.oid\n- INNER JOIN ss_match s ON s.oid = f.oid\n- INNER JOIN detection d ON d.candid = s.candid\n  - This ensures the detection info (d.mjd, d.fid) corresponds to the same candidate used by the Solar System crossmatch.\n- Avoid filtering on detection beyond this key-based join (per best practice).\n\n7) Project the requested columns\n- SELECT:\n  - o.oid AS ztf_identifier\n  - o.ndet AS number_of_detections\n  - o.firstmjd AS first_detection_date\n  - o.lastmjd AS last_detection_date\n  - p.probability AS asteroid_probability\n  - s.candid AS candidate_identifier\n  - s.ssdistnr AS mpc_distance_arcsec\n  - s.ssnamenr AS mpc_name\n  - d.mjd AS detection_date\n  - d.fid AS filter_id\n\n8) Ordering and limiting\n- ORDER BY o.firstmjd ASC\n- LIMIT 10\n- If there is any chance of more than one row per oid (not expected because ss_ztf has a single candid per oid), apply DISTINCT ON (o.oid) before ORDER BY to guarantee at most one row per object; otherwise LIMIT 10 suffices.\n\n9) Optional UNION usage (only if you must standardize inputs from multiple classifier versions)\n- Not required here because the user explicitly fixed classifier_version = 'stamp_classifier_1.0.4'.\n- If you needed to accept several stamp classifier versions, you would create multiple filtered probability subqueries (one per version) and UNION ALL them into asteroid_prob, then continue from step 5."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\n1) Define the inputs and filters\n- Dataset: ALeRCE ZTF objects.\n- Required filters:\n  - object.ndet > 500\n  - probability.classifier_name = 'stamp_classifier'\n  - probability.classifier_version = 'stamp_classifier_1.0.4'\n  - probability.class_name = 'asteroid'\n  - probability.probability > 0.5\n  - probability.ranking = 1 (apply default \u201cranking=1\u201d, while using the user-specified classifier/version)\n  - ss_ztf.ssdistnr < 2 (arcsec)\n- Columns to return:\n  - object.oid (ZTF identifier)\n  - object.ndet (number of detections)\n  - object.firstmjd, object.lastmjd (first and last detection date)\n  - probability.probability (asteroid probability)\n  - ss_ztf.candid (candidate identifier)\n  - ss_ztf.ssdistnr (distance to MPC object, arcsec)\n  - ss_ztf.ssnamenr (MPC name; note: may be the string 'null')\n  - detection.mjd (detection date)\n  - detection.fid (filter identifier)\n- Ordering and row limit:\n  - ORDER BY object.firstmjd ASC\n  - LIMIT 10 objects (unique oids)\n\n2) Build a subquery for objects with > 500 detections (objects_gt500)\n- FROM object o\n- WHERE o.ndet > 500\n- SELECT o.oid, o.ndet, o.firstmjd, o.lastmjd\n- Indexes leveraged: ix_object_ndet (filter), ix_object_firstmjd (later ordering)\n\n3) Build a subquery for asteroid-class probability from the Stamp classifier (asteroid_prob)\n- FROM probability p\n- WHERE\n  - p.classifier_name = 'stamp_classifier'\n  - p.classifier_version = 'stamp_classifier_1.0.4'\n  - p.class_name = 'asteroid'\n  - p.probability > 0.5\n  - p.ranking = 1\n- SELECT p.oid, p.probability\n- Notes:\n  - This enforces the user\u2019s classifier/version and class, with the default constraint ranking=1.\n  - Indexes leveraged: ix_probabilities_ranking (ranking=1), ix_probabilities_probability (probability > 0.5)\n\n4) Build a subquery for Solar System crossmatch with distance < 2 arcsec (ss_match)\n- FROM ss_ztf s\n- WHERE s.ssdistnr < 2\n- SELECT s.oid, s.candid, s.ssdistnr, s.ssnamenr\n- Notes:\n  - ss_ztf primary key is (oid); candid refers to the associated detection.\n  - We do not exclude rows with ssnamenr = 'null' (string), since the user did not request that.\n\n5) Compute the set of oids that satisfy all three independent conditions using INTERSECT (final_oids)\n- Create three SELECT statements that each output only the oid column:\n  - SELECT oid FROM objects_gt500\n  - SELECT oid FROM asteroid_prob\n  - SELECT oid FROM ss_match\n- INTERSECT them: this enforces that oids satisfy all three constraints simultaneously.\n- Resulting CTE/table: final_oids(oid)\n\n6) Join to gather full row data including detection info\n- Start from final_oids f\n- INNER JOIN objects_gt500 o ON o.oid = f.oid\n- INNER JOIN asteroid_prob p ON p.oid = f.oid\n- INNER JOIN ss_match s ON s.oid = f.oid\n- INNER JOIN detection d ON d.candid = s.candid\n  - This ensures the detection info (d.mjd, d.fid) corresponds to the same candidate used by the Solar System crossmatch.\n- Avoid filtering on detection beyond this key-based join (per best practice).\n\n7) Project the requested columns\n- SELECT:\n  - o.oid AS ztf_identifier\n  - o.ndet AS number_of_detections\n  - o.firstmjd AS first_detection_date\n  - o.lastmjd AS last_detection_date\n  - p.probability AS asteroid_probability\n  - s.candid AS candidate_identifier\n  - s.ssdistnr AS mpc_distance_arcsec\n  - s.ssnamenr AS mpc_name\n  - d.mjd AS detection_date\n  - d.fid AS filter_id\n\n8) Ordering and limiting\n- ORDER BY o.firstmjd ASC\n- LIMIT 10\n- If there is any chance of more than one row per oid (not expected because ss_ztf has a single candid per oid), apply DISTINCT ON (o.oid) before ORDER BY to guarantee at most one row per object; otherwise LIMIT 10 suffices.\n\n9) Optional UNION usage (only if you must standardize inputs from multiple classifier versions)\n- Not required here because the user explicitly fixed classifier_version = 'stamp_classifier_1.0.4'.\n- If you needed to accept several stamp classifier versions, you would create multiple filtered probability subqueries (one per version) and UNION ALL them into asteroid_prob, then continue from step 5."
                    },
                    "in_toks": 3764,
                    "out_toks": 5473,
                    "id": "chatcmpl-Cb6muUR6CTLp2XnARkIH1X8ZdGfbh",
                    "created": 1762960264,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Find at most 10 ZTF objects with ndet > 500, asteroid probability > 0.5 in stamp_classifier v1.0.4 (ranking=1),\n-- and nearest Solar System object distance < 2 arcsec. Include requested columns and order by firstmjd.\nWITH objects_gt500 AS\n  (SELECT o.oid,\n          o.ndet,\n          o.firstmjd,\n          o.lastmjd\n   FROM OBJECT o\n   WHERE o.ndet > 500),\n     asteroid_prob AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.probability > 0.5\n     AND p.ranking = 1),\n     ss_match AS\n  (SELECT s.oid,\n          s.candid,\n          s.ssdistnr,\n          s.ssnamenr\n   FROM ss_ztf s\n   WHERE s.ssdistnr < 2),\n     final_oids AS\n  (SELECT oid\n   FROM objects_gt500 INTERSECT SELECT oid\n   FROM asteroid_prob INTERSECT SELECT oid\n   FROM ss_match)\nSELECT o.oid,\n       o.ndet,\n       o.firstmjd,\n       o.lastmjd,\n       p.probability,\n       s.candid,\n       s.ssdistnr,\n       s.ssnamenr,\n       d.mjd,\n       d.fid\nFROM final_oids f\nINNER JOIN objects_gt500 o ON o.oid = f.oid\nINNER JOIN asteroid_prob p ON p.oid = f.oid\nINNER JOIN ss_match s ON s.oid = f.oid\nINNER JOIN detection d ON d.candid = s.candid\nORDER BY o.firstmjd ASC\nLIMIT 10;"
                        },
                        "in_toks": 3537,
                        "out_toks": 2411,
                        "id": "chatcmpl-Cb6oQqgHPDfqDUjNN3X2J59I6kVzF",
                        "created": 1762960358,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "107",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "step",
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'step', 'ss_ztf', 'detection']"
                },
                "in_toks": 699,
                "out_toks": 1632,
                "id": "chatcmpl-CZN7mQ9Q4wukBdUPN6XXcZnzTRVkd",
                "created": 1762546406,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2003,
                "out_toks": 1103,
                "id": "chatcmpl-CZYbNOncaKn7hkMUqTcv8kGSfhDRd",
                "created": 1762590525,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Find up to 10 ZTF objects with: ndet > 500, asteroid prob > 0.5 in stamp_classifier_1.0.4,\n-- and nearest Solar System object distance < 2 arcsec. Return requested columns ordered by firstmjd.\nWITH prob_ast AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.probability > 0.5),\n     ss_close AS\n  (SELECT s.oid,\n          s.candid,\n          s.ssdistnr,\n          s.ssnamenr\n   FROM ss_ztf s\n   WHERE s.ssdistnr < 2),\n     obj_many AS\n  (SELECT o.oid,\n          o.ndet,\n          o.firstmjd,\n          o.lastmjd\n   FROM OBJECT o\n   WHERE o.ndet > 500),\n     eligible_oids AS\n  (SELECT oid\n   FROM prob_ast INTERSECT SELECT oid\n   FROM ss_close INTERSECT SELECT oid\n   FROM obj_many)\nSELECT o.oid,\n       o.ndet,\n       o.firstmjd,\n       o.lastmjd,\n       p.probability,\n       s.candid,\n       s.ssdistnr,\n       s.ssnamenr,\n       d.mjd,\n       d.fid\nFROM OBJECT o\nINNER JOIN eligible_oids e ON e.oid = o.oid\nINNER JOIN prob_ast p ON p.oid = o.oid\nINNER JOIN ss_close s ON s.oid = o.oid\nINNER JOIN detection d ON d.candid = s.candid\nORDER BY o.firstmjd ASC\nLIMIT 10;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query for the ALeRCE database:\n\n1) Define the probability filter (stamp classifier, asteroid, versioned)\n- Build a subquery/CTE prob_ast selecting only the needed columns:\n  - Columns: p.oid, p.probability\n  - FROM probability p\n  - WHERE:\n    - p.classifier_name = 'stamp_classifier'\n    - p.classifier_version = 'stamp_classifier_1.0.4'\n    - p.class_name = 'asteroid'\n    - p.probability > 0.5\n  - Note: Do not apply the default probability.ranking = 1 or classifier_name = 'lc_classifier' because the user explicitly requests a different classifier and condition.\n\n2) Define the Solar System proximity filter\n- Build a subquery/CTE ss_close selecting:\n  - Columns: s.oid, s.candid, s.ssdistnr, s.ssnamenr\n  - FROM ss_ztf s\n  - WHERE s.ssdistnr < 2\n  - This enforces \u201cdistance from the nearest Solar System object below 2 arcsec.\u201d\n\n3) Define the objects with > 500 detections\n- Build a subquery/CTE obj_many selecting:\n  - Columns: o.oid, o.ndet, o.firstmjd, o.lastmjd\n  - FROM object o\n  - WHERE o.ndet > 500\n\n4) Compute the eligible object set via INTERSECT (set-based filter)\n- Create a subquery/CTE eligible_oids containing only oids that satisfy all three previous filters:\n  - SELECT oid FROM prob_ast\n    INTERSECT\n    SELECT oid FROM ss_close\n    INTERSECT\n    SELECT oid FROM obj_many\n\n5) Assemble final rows by joining all required information\n- Start from object joined to the eligible set to minimize rows early:\n  - FROM object o\n  - INNER JOIN eligible_oids e ON e.oid = o.oid\n- Bring in the asteroid probability:\n  - INNER JOIN prob_ast p ON p.oid = o.oid\n- Bring in Solar System nearest info (candid, distance, MPC name):\n  - INNER JOIN ss_close s ON s.oid = o.oid\n- Bring in the detection metadata (date and filter) matching the exact candidate:\n  - INNER JOIN detection d ON d.candid = s.candid\n- This join structure guarantees one row per eligible object because ss_ztf has a single candid per oid (PRIMARY KEY (oid)) and detection has a unique candid (PRIMARY KEY (candid)).\n\n6) Select only the columns requested by the user\n- ZTF identifier: o.oid\n- Number of detections: o.ndet\n- First detection date: o.firstmjd\n- Last detection date: o.lastmjd\n- Probability: p.probability\n- Candidate identifier: s.candid\n- Distance to MPC object: s.ssdistnr\n- MPC name: s.ssnamenr\n- Detection date: d.mjd\n- Filter identifier: d.fid\n\n7) Ordering and limiting\n- ORDER BY o.firstmjd ASC\n- LIMIT 10\n\n8) Performance and correctness notes\n- The plan uses only necessary tables: object, probability, ss_ztf, detection.\n- Indexes that will help:\n  - object: ix_object_ndet (ndet), ix_object_firstmjd (firstmjd)\n  - probability: ix_probabilities_probability (probability), ix_probabilities_oid (oid), and filtering on classifier_name/classifier_version/class_name will be selective\n  - ss_ztf: ix_ss_ztf_candid (candid)\n  - detection: primary key on candid ensures efficient join\n- No Q3C functions are needed (no sky-position filtering).\n- Ensure literal class and classifier names use exact values: 'asteroid' and 'stamp_classifier', classifier_version 'stamp_classifier_1.0.4'."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query for the ALeRCE database:\n\n1) Define the probability filter (stamp classifier, asteroid, versioned)\n- Build a subquery/CTE prob_ast selecting only the needed columns:\n  - Columns: p.oid, p.probability\n  - FROM probability p\n  - WHERE:\n    - p.classifier_name = 'stamp_classifier'\n    - p.classifier_version = 'stamp_classifier_1.0.4'\n    - p.class_name = 'asteroid'\n    - p.probability > 0.5\n  - Note: Do not apply the default probability.ranking = 1 or classifier_name = 'lc_classifier' because the user explicitly requests a different classifier and condition.\n\n2) Define the Solar System proximity filter\n- Build a subquery/CTE ss_close selecting:\n  - Columns: s.oid, s.candid, s.ssdistnr, s.ssnamenr\n  - FROM ss_ztf s\n  - WHERE s.ssdistnr < 2\n  - This enforces \u201cdistance from the nearest Solar System object below 2 arcsec.\u201d\n\n3) Define the objects with > 500 detections\n- Build a subquery/CTE obj_many selecting:\n  - Columns: o.oid, o.ndet, o.firstmjd, o.lastmjd\n  - FROM object o\n  - WHERE o.ndet > 500\n\n4) Compute the eligible object set via INTERSECT (set-based filter)\n- Create a subquery/CTE eligible_oids containing only oids that satisfy all three previous filters:\n  - SELECT oid FROM prob_ast\n    INTERSECT\n    SELECT oid FROM ss_close\n    INTERSECT\n    SELECT oid FROM obj_many\n\n5) Assemble final rows by joining all required information\n- Start from object joined to the eligible set to minimize rows early:\n  - FROM object o\n  - INNER JOIN eligible_oids e ON e.oid = o.oid\n- Bring in the asteroid probability:\n  - INNER JOIN prob_ast p ON p.oid = o.oid\n- Bring in Solar System nearest info (candid, distance, MPC name):\n  - INNER JOIN ss_close s ON s.oid = o.oid\n- Bring in the detection metadata (date and filter) matching the exact candidate:\n  - INNER JOIN detection d ON d.candid = s.candid\n- This join structure guarantees one row per eligible object because ss_ztf has a single candid per oid (PRIMARY KEY (oid)) and detection has a unique candid (PRIMARY KEY (candid)).\n\n6) Select only the columns requested by the user\n- ZTF identifier: o.oid\n- Number of detections: o.ndet\n- First detection date: o.firstmjd\n- Last detection date: o.lastmjd\n- Probability: p.probability\n- Candidate identifier: s.candid\n- Distance to MPC object: s.ssdistnr\n- MPC name: s.ssnamenr\n- Detection date: d.mjd\n- Filter identifier: d.fid\n\n7) Ordering and limiting\n- ORDER BY o.firstmjd ASC\n- LIMIT 10\n\n8) Performance and correctness notes\n- The plan uses only necessary tables: object, probability, ss_ztf, detection.\n- Indexes that will help:\n  - object: ix_object_ndet (ndet), ix_object_firstmjd (firstmjd)\n  - probability: ix_probabilities_probability (probability), ix_probabilities_oid (oid), and filtering on classifier_name/classifier_version/class_name will be selective\n  - ss_ztf: ix_ss_ztf_candid (candid)\n  - detection: primary key on candid ensures efficient join\n- No Q3C functions are needed (no sky-position filtering).\n- Ensure literal class and classifier names use exact values: 'asteroid' and 'stamp_classifier', classifier_version 'stamp_classifier_1.0.4'."
                    },
                    "in_toks": 3881,
                    "out_toks": 3916,
                    "id": "chatcmpl-Cb6ozoqm9hsVpyEwXUvRV69FKJ3jf",
                    "created": 1762960393,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Find up to 10 ZTF objects with: ndet > 500, asteroid prob > 0.5 in stamp_classifier_1.0.4,\n-- and nearest Solar System object distance < 2 arcsec. Return requested columns ordered by firstmjd.\nWITH prob_ast AS\n  (SELECT p.oid,\n          p.probability\n   FROM probability p\n   WHERE p.classifier_name = 'stamp_classifier'\n     AND p.classifier_version = 'stamp_classifier_1.0.4'\n     AND p.class_name = 'asteroid'\n     AND p.probability > 0.5),\n     ss_close AS\n  (SELECT s.oid,\n          s.candid,\n          s.ssdistnr,\n          s.ssnamenr\n   FROM ss_ztf s\n   WHERE s.ssdistnr < 2),\n     obj_many AS\n  (SELECT o.oid,\n          o.ndet,\n          o.firstmjd,\n          o.lastmjd\n   FROM OBJECT o\n   WHERE o.ndet > 500),\n     eligible_oids AS\n  (SELECT oid\n   FROM prob_ast INTERSECT SELECT oid\n   FROM ss_close INTERSECT SELECT oid\n   FROM obj_many)\nSELECT o.oid,\n       o.ndet,\n       o.firstmjd,\n       o.lastmjd,\n       p.probability,\n       s.candid,\n       s.ssdistnr,\n       s.ssnamenr,\n       d.mjd,\n       d.fid\nFROM OBJECT o\nINNER JOIN eligible_oids e ON e.oid = o.oid\nINNER JOIN prob_ast p ON p.oid = o.oid\nINNER JOIN ss_close s ON s.oid = o.oid\nINNER JOIN detection d ON d.candid = s.candid\nORDER BY o.firstmjd ASC\nLIMIT 10;"
                        },
                        "in_toks": 3377,
                        "out_toks": 1418,
                        "id": "chatcmpl-Cb6q4DO2rWtDlwdj1HDqcwbng19G1",
                        "created": 1762960460,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "107",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'ss_ztf', 'detection']"
                },
                "in_toks": 699,
                "out_toks": 1373,
                "id": "chatcmpl-CZN8EDLWYEyENDv7tSyiwxzTO7VyH",
                "created": 1762546434,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1931,
                "out_toks": 591,
                "id": "chatcmpl-CZYbmnnOBj3f93VHhdybKfx5yNXze",
                "created": 1762590550,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "/* Find up to 10 ZTF objects with ndet > 500, classified as 'asteroid' by the stamp classifier v1.0.4 with probability > 0.5 (ranking=1), and with nearest Solar System object within 2 arcsec. Return requested columns and order by firstmjd. */ WITH prob_filter AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE classifier_name = 'stamp_classifier'\n     AND classifier_version = 'stamp_classifier_1.0.4'\n     AND class_name = 'asteroid'\n     AND ranking = 1\n     AND probability > 0.5),\n                                                                                                                                                                                                                                                        obj_filter AS\n  (SELECT oid,\n          ndet,\n          firstmjd,\n          lastmjd\n   FROM OBJECT\n   WHERE ndet > 500),\n                                                                                                                                                                                                                                                        ss_filter AS\n  (SELECT oid,\n          candid,\n          ssdistnr,\n          ssnamenr\n   FROM ss_ztf\n   WHERE ssdistnr < 2)\nSELECT o.oid,\n       o.ndet,\n       o.firstmjd,\n       o.lastmjd,\n       p.probability,\n       s.candid,\n       s.ssdistnr,\n       s.ssnamenr,\n       d.mjd,\n       d.fid\nFROM obj_filter o\nINNER JOIN prob_filter p ON p.oid = o.oid\nINNER JOIN ss_filter s ON s.oid = o.oid\nINNER JOIN detection d ON d.candid = s.candid\nAND d.oid = s.oid\nORDER BY o.firstmjd ASC\nLIMIT 10;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\nFind up to 10 ZTF objects (object.oid) that:\n- Have more than 500 detections (object.ndet > 500).\n- Are classified by the stamp classifier (probability.classifier_name='stamp_classifier', classifier_version='stamp_classifier_1.0.4') as 'asteroid' with probability > 0.5. Enforce ranking = 1 to keep most-likely class.\n- Have nearest Solar System object distance < 2 arcsec (ss_ztf.ssdistnr < 2).\nReturn columns:\n- ZTF identifier: object.oid\n- number of detections: object.ndet\n- first detection date: object.firstmjd\n- last detection date: object.lastmjd\n- classification probability: probability.probability\n- candidate identifier: ss_ztf.candid\n- distance to MPC object: ss_ztf.ssdistnr\n- MPC name: ss_ztf.ssnamenr\n- detection date: detection.mjd (corresponding to ss_ztf.candid)\n- filter identifier: detection.fid\nOrder by object.firstmjd ascending; limit to 10 rows.\n\nTables and columns to use\n- object(o): oid, ndet, firstmjd, lastmjd\n- probability(p): oid, class_name, classifier_name, classifier_version, probability, ranking\n- ss_ztf(s): oid, candid, ssdistnr, ssnamenr\n- detection(d): candid, oid, mjd, fid\nNote: ss_ztf has one row per oid (PRIMARY KEY (oid)). detection has candid as PRIMARY KEY, so joining via ss_ztf.candid identifies a single detection to report mjd/fid.\n\nQuery structure (using CTEs and an INTERSECT set step)\n1) CTE prob_filter\n- Source: probability p\n- Purpose: filter to objects classified as 'asteroid' by the stamp classifier version 'stamp_classifier_1.0.4' with probability > 0.5, taking rank-1 classes.\n- Columns to project: p.oid, p.probability\n- Filters:\n  - p.classifier_name = 'stamp_classifier'\n  - p.classifier_version = 'stamp_classifier_1.0.4'\n  - p.class_name = 'asteroid'\n  - p.probability > 0.5\n  - p.ranking = 1\n- Index usage: ix_probabilities_ranking (WHERE ranking = 1), ix_probabilities_probability; filtering by classifier_name/classifier_version/class_name narrows efficiently.\n\n2) CTE obj_filter\n- Source: object o\n- Purpose: restrict to objects with high detection counts.\n- Columns to project: o.oid, o.ndet, o.firstmjd, o.lastmjd\n- Filters:\n  - o.ndet > 500\n- Index usage: ix_object_ndet for the ndet filter; ix_object_firstmjd used later for sorting.\n\n3) CTE ss_filter\n- Source: ss_ztf s\n- Purpose: restrict to objects with a nearest Solar System object within 2 arcsec.\n- Columns to project: s.oid, s.candid, s.ssdistnr, s.ssnamenr\n- Filters:\n  - s.ssdistnr < 2\n- Note: Units are arcseconds for ssdistnr; no conversion needed.\n\n4) CTE eligible_oids via INTERSECT\n- Purpose: compute the set of oids that satisfy all three independent conditions before bringing in detection details.\n- Build as the INTERSECT of:\n  - SELECT o.oid FROM obj_filter o\n  - SELECT p.oid FROM prob_filter p\n  - SELECT s.oid FROM ss_filter s\n- Result columns: oid only.\n\n5) Final join to assemble requested columns\n- Start from eligible_oids e\n- INNER JOIN obj_filter o ON o.oid = e.oid\n- INNER JOIN prob_filter p ON p.oid = e.oid\n- INNER JOIN ss_filter s ON s.oid = e.oid\n- INNER JOIN detection d ON d.candid = s.candid\n  - Optional integrity check: AND d.oid = e.oid (not strictly necessary since detection.candid is PK and ss_ztf points to that candid, but acceptable for safety).\n- Selected columns (with clear mapping to user-requested outputs):\n  - object.oid AS ztf_oid\n  - object.ndet\n  - object.firstmjd\n  - object.lastmjd\n  - probability.probability\n  - ss_ztf.candid\n  - ss_ztf.ssdistnr\n  - ss_ztf.ssnamenr\n  - detection.mjd AS detection_mjd\n  - detection.fid\n- Ordering and limiting:\n  - ORDER BY o.firstmjd ASC\n  - LIMIT 10\n\n6) Notes on defaults and constraints\n- The default probability-table conditions are overridden for classifier_name; set classifier_name='stamp_classifier' and classifier_version='stamp_classifier_1.0.4' as explicitly requested. Keep ranking = 1 to ensure the returned probability corresponds to the top class and remains performant via ix_classification_rank1/ix_probabilities_ranking.\n- No spatial (Q3C) functions are required since selection is not by RA/Dec.\n- Duplicates are not expected:\n  - ss_ztf has one row per oid (PRIMARY KEY (oid)).\n  - detection join via s.candid yields a single detection row per oid (d.candid is PRIMARY KEY).\n- Indices that will aid performance:\n  - object: ix_object_ndet, ix_object_firstmjd (for final ORDER BY)\n  - probability: ix_probabilities_ranking (ranking=1), ix_probabilities_probability\n  - detection: PRIMARY KEY on candid\n  - ss_ztf: PRIMARY KEY on oid (implicit), ix_ss_ztf_candid\n\n7) Result semantics\n- The detection date and filter identifier correspond to the specific candidate used in the Solar System match (ss_ztf.candid), aligning the MPC-related information and the detection metadata in a consistent row.\n- If it is critical that the MPC name be non-null, optionally add s.ssnamenr IS NOT NULL to ss_filter; otherwise, return nulls as-is."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\nFind up to 10 ZTF objects (object.oid) that:\n- Have more than 500 detections (object.ndet > 500).\n- Are classified by the stamp classifier (probability.classifier_name='stamp_classifier', classifier_version='stamp_classifier_1.0.4') as 'asteroid' with probability > 0.5. Enforce ranking = 1 to keep most-likely class.\n- Have nearest Solar System object distance < 2 arcsec (ss_ztf.ssdistnr < 2).\nReturn columns:\n- ZTF identifier: object.oid\n- number of detections: object.ndet\n- first detection date: object.firstmjd\n- last detection date: object.lastmjd\n- classification probability: probability.probability\n- candidate identifier: ss_ztf.candid\n- distance to MPC object: ss_ztf.ssdistnr\n- MPC name: ss_ztf.ssnamenr\n- detection date: detection.mjd (corresponding to ss_ztf.candid)\n- filter identifier: detection.fid\nOrder by object.firstmjd ascending; limit to 10 rows.\n\nTables and columns to use\n- object(o): oid, ndet, firstmjd, lastmjd\n- probability(p): oid, class_name, classifier_name, classifier_version, probability, ranking\n- ss_ztf(s): oid, candid, ssdistnr, ssnamenr\n- detection(d): candid, oid, mjd, fid\nNote: ss_ztf has one row per oid (PRIMARY KEY (oid)). detection has candid as PRIMARY KEY, so joining via ss_ztf.candid identifies a single detection to report mjd/fid.\n\nQuery structure (using CTEs and an INTERSECT set step)\n1) CTE prob_filter\n- Source: probability p\n- Purpose: filter to objects classified as 'asteroid' by the stamp classifier version 'stamp_classifier_1.0.4' with probability > 0.5, taking rank-1 classes.\n- Columns to project: p.oid, p.probability\n- Filters:\n  - p.classifier_name = 'stamp_classifier'\n  - p.classifier_version = 'stamp_classifier_1.0.4'\n  - p.class_name = 'asteroid'\n  - p.probability > 0.5\n  - p.ranking = 1\n- Index usage: ix_probabilities_ranking (WHERE ranking = 1), ix_probabilities_probability; filtering by classifier_name/classifier_version/class_name narrows efficiently.\n\n2) CTE obj_filter\n- Source: object o\n- Purpose: restrict to objects with high detection counts.\n- Columns to project: o.oid, o.ndet, o.firstmjd, o.lastmjd\n- Filters:\n  - o.ndet > 500\n- Index usage: ix_object_ndet for the ndet filter; ix_object_firstmjd used later for sorting.\n\n3) CTE ss_filter\n- Source: ss_ztf s\n- Purpose: restrict to objects with a nearest Solar System object within 2 arcsec.\n- Columns to project: s.oid, s.candid, s.ssdistnr, s.ssnamenr\n- Filters:\n  - s.ssdistnr < 2\n- Note: Units are arcseconds for ssdistnr; no conversion needed.\n\n4) CTE eligible_oids via INTERSECT\n- Purpose: compute the set of oids that satisfy all three independent conditions before bringing in detection details.\n- Build as the INTERSECT of:\n  - SELECT o.oid FROM obj_filter o\n  - SELECT p.oid FROM prob_filter p\n  - SELECT s.oid FROM ss_filter s\n- Result columns: oid only.\n\n5) Final join to assemble requested columns\n- Start from eligible_oids e\n- INNER JOIN obj_filter o ON o.oid = e.oid\n- INNER JOIN prob_filter p ON p.oid = e.oid\n- INNER JOIN ss_filter s ON s.oid = e.oid\n- INNER JOIN detection d ON d.candid = s.candid\n  - Optional integrity check: AND d.oid = e.oid (not strictly necessary since detection.candid is PK and ss_ztf points to that candid, but acceptable for safety).\n- Selected columns (with clear mapping to user-requested outputs):\n  - object.oid AS ztf_oid\n  - object.ndet\n  - object.firstmjd\n  - object.lastmjd\n  - probability.probability\n  - ss_ztf.candid\n  - ss_ztf.ssdistnr\n  - ss_ztf.ssnamenr\n  - detection.mjd AS detection_mjd\n  - detection.fid\n- Ordering and limiting:\n  - ORDER BY o.firstmjd ASC\n  - LIMIT 10\n\n6) Notes on defaults and constraints\n- The default probability-table conditions are overridden for classifier_name; set classifier_name='stamp_classifier' and classifier_version='stamp_classifier_1.0.4' as explicitly requested. Keep ranking = 1 to ensure the returned probability corresponds to the top class and remains performant via ix_classification_rank1/ix_probabilities_ranking.\n- No spatial (Q3C) functions are required since selection is not by RA/Dec.\n- Duplicates are not expected:\n  - ss_ztf has one row per oid (PRIMARY KEY (oid)).\n  - detection join via s.candid yields a single detection row per oid (d.candid is PRIMARY KEY).\n- Indices that will aid performance:\n  - object: ix_object_ndet, ix_object_firstmjd (for final ORDER BY)\n  - probability: ix_probabilities_ranking (ranking=1), ix_probabilities_probability\n  - detection: PRIMARY KEY on candid\n  - ss_ztf: PRIMARY KEY on oid (implicit), ix_ss_ztf_candid\n\n7) Result semantics\n- The detection date and filter identifier correspond to the specific candidate used in the Solar System match (ss_ztf.candid), aligning the MPC-related information and the detection metadata in a consistent row.\n- If it is critical that the MPC name be non-null, optionally add s.ssnamenr IS NOT NULL to ss_filter; otherwise, return nulls as-is."
                    },
                    "in_toks": 3809,
                    "out_toks": 5452,
                    "id": "chatcmpl-Cb6qeZ9Cwmq3HpSZBEyB39Y5Fi8WG",
                    "created": 1762960496,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "/* Find up to 10 ZTF objects with ndet > 500, classified as 'asteroid' by the stamp classifier v1.0.4 with probability > 0.5 (ranking=1), and with nearest Solar System object within 2 arcsec. Return requested columns and order by firstmjd. */ WITH prob_filter AS\n  (SELECT oid,\n          probability\n   FROM probability\n   WHERE classifier_name = 'stamp_classifier'\n     AND classifier_version = 'stamp_classifier_1.0.4'\n     AND class_name = 'asteroid'\n     AND ranking = 1\n     AND probability > 0.5),\n                                                                                                                                                                                                                                                        obj_filter AS\n  (SELECT oid,\n          ndet,\n          firstmjd,\n          lastmjd\n   FROM OBJECT\n   WHERE ndet > 500),\n                                                                                                                                                                                                                                                        ss_filter AS\n  (SELECT oid,\n          candid,\n          ssdistnr,\n          ssnamenr\n   FROM ss_ztf\n   WHERE ssdistnr < 2)\nSELECT o.oid,\n       o.ndet,\n       o.firstmjd,\n       o.lastmjd,\n       p.probability,\n       s.candid,\n       s.ssdistnr,\n       s.ssnamenr,\n       d.mjd,\n       d.fid\nFROM obj_filter o\nINNER JOIN prob_filter p ON p.oid = o.oid\nINNER JOIN ss_filter s ON s.oid = o.oid\nINNER JOIN detection d ON d.candid = s.candid\nAND d.oid = s.oid\nORDER BY o.firstmjd ASC\nLIMIT 10;"
                        },
                        "in_toks": 3817,
                        "out_toks": 1762,
                        "id": "chatcmpl-Cb6sdMYlh28NYlLM3SQQe70YD8RqP",
                        "created": 1762960619,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "107",
            "experiment_id": "run_9",
            "pred_tables": [
                "detection",
                "probability",
                "taxonomy",
                "ss_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'probability', 'taxonomy', 'ss_ztf']"
                },
                "in_toks": 699,
                "out_toks": 2970,
                "id": "chatcmpl-CZN8qHk45N9Af7Kw1vUHmeFQ4Okio",
                "created": 1762546472,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1449,
                "out_toks": 1295,
                "id": "chatcmpl-CZYc3KYpz37htn70YD8W6CRdn6G8m",
                "created": 1762590567,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3327,
                "out_toks": 4000,
                "id": "chatcmpl-CZZz5jhEENeNBTb9P5wa5aGUD8Jes",
                "created": 1762595839,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* Find up to 10 ZTF objects with >500 detections, asteroid probability > 0.5\n   from stamp_classifier_1.0.4, and a nearest Solar System (MPC) object within 2 arcsec.\n   Replace the 'mpc' CTE with the MPC sources (ra,dec in degrees) you want to match. */\nWITH mpc (name, ra, dec) AS (\n    /* Provide MPC objects here (one row per source), e.g.:\n       VALUES\n         ('(101955) Bennu',  101.234567, -12.345678),\n         ('(99942) Apophis', 250.123456,  36.543210)\n       The following creates an empty MPC set; replace it with the VALUES above. */\n    SELECT NULL::varchar AS name, NULL::double precision AS ra, NULL::double precision AS dec\n    WHERE false\n),\nfiltered_objects AS (\n    SELECT\n        o.oid,\n        o.ndet,\n        o.firstmjd,\n        o.lastmjd,\n        p.probability\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE\n        o.ndet > 500\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.classifier_version = 'stamp_classifier_1.0.4'\n        AND p.class_name = 'asteroid'\n        AND p.probability > 0.5\n)\nSELECT\n    fo.oid,                 -- ZTF identifier\n    fo.ndet,                -- number of detections\n    fo.firstmjd,            -- first detection date\n    fo.lastmjd,             -- last detection date\n    fo.probability,         -- asteroid probability (stamp classifier)\n    best.candid,            -- candidate identifier\n    best.distance_arcsec,   -- distance between ZTF detection and MPC object (arcsec)\n    best.name,              -- MPC name\n    best.mjd,               -- detection date\n    best.fid                -- filter identifier\nFROM filtered_objects fo\nJOIN LATERAL (\n    SELECT\n        d.candid,\n        d.mjd,\n        d.fid,\n        m.name,\n        q3c_dist(d.ra, d.dec, m.ra, m.dec) * 3600.0 AS distance_arcsec\n    FROM detection d\n    JOIN mpc m\n        ON q3c_join(d.ra, d.dec, m.ra, m.dec, 2.0/3600.0)  -- within 2 arcsec\n    WHERE d.oid = fo.oid\n    ORDER BY q3c_dist(d.ra, d.dec, m.ra, m.dec) ASC\n    LIMIT 1\n) AS best ON true\nORDER BY fo.firstmjd\nLIMIT 10;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* Find up to 10 ZTF objects with >500 detections, asteroid probability > 0.5\n   from stamp_classifier_1.0.4, and a nearest Solar System (MPC) object within 2 arcsec.\n   Replace the 'mpc' CTE with the MPC sources (ra,dec in degrees) you want to match. */\nWITH mpc (name, ra, dec) AS (\n    /* Provide MPC objects here (one row per source), e.g.:\n       VALUES\n         ('(101955) Bennu',  101.234567, -12.345678),\n         ('(99942) Apophis', 250.123456,  36.543210)\n       The following creates an empty MPC set; replace it with the VALUES above. */\n    SELECT NULL::varchar AS name, NULL::double precision AS ra, NULL::double precision AS dec\n    WHERE false\n),\nfiltered_objects AS (\n    SELECT\n        o.oid,\n        o.ndet,\n        o.firstmjd,\n        o.lastmjd,\n        p.probability\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE\n        o.ndet > 500\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.classifier_version = 'stamp_classifier_1.0.4'\n        AND p.class_name = 'asteroid'\n        AND p.probability > 0.5\n)\nSELECT\n    fo.oid,                 -- ZTF identifier\n    fo.ndet,                -- number of detections\n    fo.firstmjd,            -- first detection date\n    fo.lastmjd,             -- last detection date\n    fo.probability,         -- asteroid probability (stamp classifier)\n    best.candid,            -- candidate identifier\n    best.distance_arcsec,   -- distance between ZTF detection and MPC object (arcsec)\n    best.name,              -- MPC name\n    best.mjd,               -- detection date\n    best.fid                -- filter identifier\nFROM filtered_objects fo\nJOIN LATERAL (\n    SELECT\n        d.candid,\n        d.mjd,\n        d.fid,\n        m.name,\n        q3c_dist(d.ra, d.dec, m.ra, m.dec) * 3600.0 AS distance_arcsec\n    FROM detection d\n    JOIN mpc m\n        ON q3c_join(d.ra, d.dec, m.ra, m.dec, 2.0/3600.0)  -- within 2 arcsec\n    WHERE d.oid = fo.oid\n    ORDER BY q3c_dist(d.ra, d.dec, m.ra, m.dec) ASC\n    LIMIT 1\n) AS best ON true\nORDER BY fo.firstmjd\nLIMIT 10;\n```"
                },
                "in_toks": 3086,
                "out_toks": 3936,
                "id": "chatcmpl-CZawc208vYeoq6QCnxKEi2Ih3yjCo",
                "created": 1762599530,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "83": {
        "0": {
            "req_id": "83",
            "experiment_id": "run_0",
            "pred_tables": [
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise']",
                    "1": "['allwise']"
                },
                "in_toks": 608,
                "out_toks": 666,
                "id": "chatcmpl-CSnZdRa7zHLwhlRnHvVrEGbYBdw27",
                "created": 1760979781,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- The 'allwise' table does not have a column named 'oid'; the primary key is 'oid_catalog'.\n-- Note: 'ZTF21aazqwxv' is a ZTF object ID. To properly link a ZTF object to an AllWISE source, you would typically join via an xmatch table (not provided here).\n-- This query assumes you already know the corresponding AllWISE 'oid_catalog' value equals 'ZTF21aazqwxv'.\n\nSELECT *\nFROM allwise\nWHERE oid_catalog = 'ZTF21aazqwxv';",
            "sql_response": {
                "responses": {
                    "0": "-- The 'allwise' table does not have a column named 'oid'; the primary key is 'oid_catalog'.\n-- Note: 'ZTF21aazqwxv' is a ZTF object ID. To properly link a ZTF object to an AllWISE source, you would typically join via an xmatch table (not provided here).\n-- This query assumes you already know the corresponding AllWISE 'oid_catalog' value equals 'ZTF21aazqwxv'.\n\nSELECT *\nFROM allwise\nWHERE oid_catalog = 'ZTF21aazqwxv';"
                },
                "in_toks": 1401,
                "out_toks": 1151,
                "id": "chatcmpl-CbHS46rDAfRNu9e4Ko6u0w3NPDqQy",
                "created": 1763001256,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1118,
                "out_toks": 911,
                "id": "chatcmpl-CSnojskpTxn4iC7MLAwVduIGgtjV7",
                "created": 1760980717,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 2996,
                "out_toks": 4000,
                "id": "chatcmpl-CSqssz5DykTetFbWIVprTE8fBXiuH",
                "created": 1760992506,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all columns from the AllWISE crossmatch for the specified ZTF object\nSELECT *\nFROM allwise\nWHERE oid = 'ZTF21aazqwxv';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns from the AllWISE crossmatch for the specified ZTF object\nSELECT *\nFROM allwise\nWHERE oid = 'ZTF21aazqwxv';\n```"
                },
                "in_toks": 2995,
                "out_toks": 1009,
                "id": "chatcmpl-CSr7nkCdoJwrsDoT15sPCVTRemqPF",
                "created": 1760993431,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "1": {
            "req_id": "83",
            "experiment_id": "run_1",
            "pred_tables": [
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise']",
                    "1": "['allwise']"
                },
                "in_toks": 608,
                "out_toks": 666,
                "id": "chatcmpl-CSnZdRa7zHLwhlRnHvVrEGbYBdw27",
                "created": 1760979781,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Get all columns from the AllWISE catalog for ZTF object 'ZTF21aazqwxv'\n-- Fix: xmatch table does not have a 'catalog' column; remove that predicate.\n-- The join to 'allwise' already restricts results to the AllWISE catalog.\n WITH xmatch_rows AS\n  (SELECT x.oid_catalog\n   FROM xmatch x\n   WHERE x.oid = 'ZTF21aazqwxv'),\n      by_xmatch AS\n  (SELECT a.*\n   FROM allwise a\n   INNER JOIN xmatch_rows xm ON xm.oid_catalog = a.oid_catalog),\n      object_pos AS\n  (SELECT o.meanra AS ra,\n          o.meandec AS dec\n   FROM OBJECT o\n   WHERE o.oid = 'ZTF21aazqwxv'),\n      by_cone AS\n  (SELECT a.*\n   FROM allwise a\n   CROSS JOIN object_pos p\n   WHERE q3c_radial_query(a.ra, a.dec, p.ra, p.dec, 2.0/3600.0) -- 2 arcsec radius\n\n   ORDER BY q3c_dist(a.ra, a.dec, p.ra, p.dec)\n   LIMIT 1)\nSELECT *\nFROM by_xmatch\nUNION ALL\nSELECT *\nFROM by_cone\nWHERE NOT EXISTS\n    (SELECT 1\n     FROM by_xmatch);",
            "sql_response": {
                "responses": {
                    "0": "-- Get all columns from the AllWISE catalog for ZTF object 'ZTF21aazqwxv'\n-- Fix: xmatch table does not have a 'catalog' column; remove that predicate.\n-- The join to 'allwise' already restricts results to the AllWISE catalog.\n WITH xmatch_rows AS\n  (SELECT x.oid_catalog\n   FROM xmatch x\n   WHERE x.oid = 'ZTF21aazqwxv'),\n      by_xmatch AS\n  (SELECT a.*\n   FROM allwise a\n   INNER JOIN xmatch_rows xm ON xm.oid_catalog = a.oid_catalog),\n      object_pos AS\n  (SELECT o.meanra AS ra,\n          o.meandec AS dec\n   FROM OBJECT o\n   WHERE o.oid = 'ZTF21aazqwxv'),\n      by_cone AS\n  (SELECT a.*\n   FROM allwise a\n   CROSS JOIN object_pos p\n   WHERE q3c_radial_query(a.ra, a.dec, p.ra, p.dec, 2.0/3600.0) -- 2 arcsec radius\n\n   ORDER BY q3c_dist(a.ra, a.dec, p.ra, p.dec)\n   LIMIT 1)\nSELECT *\nFROM by_xmatch\nUNION ALL\nSELECT *\nFROM by_cone\nWHERE NOT EXISTS\n    (SELECT 1\n     FROM by_xmatch);"
                },
                "in_toks": 1965,
                "out_toks": 2855,
                "id": "chatcmpl-CbHSJGQ8NvpyaatXqJtc9ywVOZL9g",
                "created": 1763001271,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1118,
                "out_toks": 1103,
                "id": "chatcmpl-CSnoybSbvIlWVN18RU9KPF6E0dTB9",
                "created": 1760980732,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\nGoal\n- Return all columns from the AllWISE catalog (table allwise) associated with the ZTF object having oid 'ZTF21aazqwxv'.\n\nKey table and columns available\n- allwise\n  - Primary key: allwise.oid_catalog\n  - Position: allwise.ra (DOUBLE PRECISION), allwise.dec (DOUBLE PRECISION)\n  - Photometry: w1mpro, w2mpro, w3mpro, w4mpro, w1sigmpro, w2sigmpro, w3sigmpro, w4sigmpro\n  - 2MASS: j_m_2mass, h_m_2mass, k_m_2mass, j_msig_2mass, h_msig_2mass, k_msig_2mass\n  - Important relationship: allwise.oid_catalog matches xmatch.oid_catalog for AllWISE entries (not the ZTF oid)\n\nAssumptions/notes\n- The ZTF object ID (oid) is 'ZTF21aazqwxv'.\n- The canonical and most direct way to map a ZTF oid to an AllWISE source is via the crossmatch table (commonly named xmatch) using its oid (ZTF id) and the external catalog\u2019s oid_catalog. If that table is present, prefer that approach.\n- If xmatch is not available, use a coordinate-based cone search by first retrieving the ZTF object\u2019s sky position from the object table (commonly named object, with columns object.oid, object.ra, object.dec) and then applying Q3C functions on allwise.\n- The probability table and its default conditions are not needed for this request.\n\nPlan A (preferred): Use crossmatch to AllWISE, then join to allwise\n1) Identify the crossmatch table and confirm its relevant columns\n   - Expected table: xmatch\n   - Required columns:\n     - xmatch.oid (the ALeRCE/ZTF object id, e.g., 'ZTF21aazqwxv')\n     - xmatch.oid_catalog (the external catalog\u2019s identifier; equals allwise.oid_catalog for AllWISE matches)\n     - xmatch.catalog (the catalog name; must be the literal 'allwise' to restrict to AllWISE matches)\n   - If actual column names differ, adjust accordingly before proceeding.\n\n2) Filter crossmatch rows to the target ZTF object and the AllWISE catalog\n   - WHERE xmatch.oid = 'ZTF21aazqwxv'\n   - AND xmatch.catalog = 'allwise'\n\n3) Join to the AllWISE table to retrieve all columns\n   - INNER JOIN allwise a ON a.oid_catalog = xmatch.oid_catalog\n   - Return all columns from AllWISE: SELECT a.*\n\n4) Result handling\n   - This will return one or more AllWISE rows if multiple crossmatches exist. If you need the closest match only, add an ORDER BY on the crossmatch\u2019s stored separation (if available in xmatch) and LIMIT 1. If that separation column exists, confirm its exact name (often something like separation or dist_arcsec) before using it.\n\nPlan B (fallback): Coordinate-based match via object + Q3C cone search\nUse this if xmatch is unavailable or empty for the target oid.\n\n1) Retrieve the ZTF object\u2019s position\n   - Table: object\n   - Required columns: object.oid, object.ra, object.dec\n   - Filter: WHERE object.oid = 'ZTF21aazqwxv'\n   - Return a single row containing o.ra, o.dec.\n\n2) Decide a matching radius\n   - Parameterize match_radius_arcsec (typical values: 2.0 arcsec; adjust as needed).\n   - Convert to degrees: radius_deg = match_radius_arcsec / 3600.0.\n\n3) Apply a Q3C cone search on AllWISE around the ZTF object\u2019s coordinates\n   - Use q3c_radial_query(allwise.ra, allwise.dec, o.ra, o.dec, radius_deg) to select candidate AllWISE sources near the ZTF object.\n   - Be careful with parameter order: q3c_radial_query(ra, dec, center_ra, center_dec, radius_deg).\n\n4) If multiple candidates are found, select the nearest\n   - Order by q3c_dist(allwise.ra, allwise.dec, o.ra, o.dec) ASC and optionally LIMIT 1.\n   - Again, verify parameter order for q3c_dist(ra1, dec1, ra2, dec2).\n\n5) Return all columns from AllWISE\n   - SELECT a.* where a is the allwise alias.\n\nAdditional implementation details and checks\n- Exact columns in allwise to be returned by SELECT a.*:\n  - oid_catalog, ra, dec,\n  - w1mpro, w2mpro, w3mpro, w4mpro,\n  - w1sigmpro, w2sigmpro, w3sigmpro, w4sigmpro,\n  - j_m_2mass, h_m_2mass, k_m_2mass,\n  - j_msig_2mass, h_msig_2mass, k_msig_2mass.\n- Indices:\n  - allwise has btree indexes on ra and dec. If your DB also has a Q3C index on (ra, dec), Q3C queries will be faster; otherwise they still work but may be slower.\n- Edge cases:\n  - If the object.oid is not found in object, the coordinate-based plan cannot proceed.\n  - If the crossmatch returns no rows, fall back to the coordinate-based plan.\n  - If multiple AllWISE matches exist within the radius, document whether you want the nearest only (then use ORDER BY ... LIMIT 1) or all candidates.\n\nSummary of the two concrete paths\n- Path via xmatch (recommended, exact catalog linkage): xmatch.oid = 'ZTF21aazqwxv' AND xmatch.catalog = 'allwise', then join on a.oid_catalog = xmatch.oid_catalog and SELECT a.*.\n- Path via coordinates: fetch o.ra, o.dec for 'ZTF21aazqwxv' from object, cone-search allwise with q3c_radial_query around (o.ra, o.dec) within a chosen radius, optionally pick the nearest by q3c_dist, and SELECT a.*.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\nGoal\n- Return all columns from the AllWISE catalog (table allwise) associated with the ZTF object having oid 'ZTF21aazqwxv'.\n\nKey table and columns available\n- allwise\n  - Primary key: allwise.oid_catalog\n  - Position: allwise.ra (DOUBLE PRECISION), allwise.dec (DOUBLE PRECISION)\n  - Photometry: w1mpro, w2mpro, w3mpro, w4mpro, w1sigmpro, w2sigmpro, w3sigmpro, w4sigmpro\n  - 2MASS: j_m_2mass, h_m_2mass, k_m_2mass, j_msig_2mass, h_msig_2mass, k_msig_2mass\n  - Important relationship: allwise.oid_catalog matches xmatch.oid_catalog for AllWISE entries (not the ZTF oid)\n\nAssumptions/notes\n- The ZTF object ID (oid) is 'ZTF21aazqwxv'.\n- The canonical and most direct way to map a ZTF oid to an AllWISE source is via the crossmatch table (commonly named xmatch) using its oid (ZTF id) and the external catalog\u2019s oid_catalog. If that table is present, prefer that approach.\n- If xmatch is not available, use a coordinate-based cone search by first retrieving the ZTF object\u2019s sky position from the object table (commonly named object, with columns object.oid, object.ra, object.dec) and then applying Q3C functions on allwise.\n- The probability table and its default conditions are not needed for this request.\n\nPlan A (preferred): Use crossmatch to AllWISE, then join to allwise\n1) Identify the crossmatch table and confirm its relevant columns\n   - Expected table: xmatch\n   - Required columns:\n     - xmatch.oid (the ALeRCE/ZTF object id, e.g., 'ZTF21aazqwxv')\n     - xmatch.oid_catalog (the external catalog\u2019s identifier; equals allwise.oid_catalog for AllWISE matches)\n     - xmatch.catalog (the catalog name; must be the literal 'allwise' to restrict to AllWISE matches)\n   - If actual column names differ, adjust accordingly before proceeding.\n\n2) Filter crossmatch rows to the target ZTF object and the AllWISE catalog\n   - WHERE xmatch.oid = 'ZTF21aazqwxv'\n   - AND xmatch.catalog = 'allwise'\n\n3) Join to the AllWISE table to retrieve all columns\n   - INNER JOIN allwise a ON a.oid_catalog = xmatch.oid_catalog\n   - Return all columns from AllWISE: SELECT a.*\n\n4) Result handling\n   - This will return one or more AllWISE rows if multiple crossmatches exist. If you need the closest match only, add an ORDER BY on the crossmatch\u2019s stored separation (if available in xmatch) and LIMIT 1. If that separation column exists, confirm its exact name (often something like separation or dist_arcsec) before using it.\n\nPlan B (fallback): Coordinate-based match via object + Q3C cone search\nUse this if xmatch is unavailable or empty for the target oid.\n\n1) Retrieve the ZTF object\u2019s position\n   - Table: object\n   - Required columns: object.oid, object.ra, object.dec\n   - Filter: WHERE object.oid = 'ZTF21aazqwxv'\n   - Return a single row containing o.ra, o.dec.\n\n2) Decide a matching radius\n   - Parameterize match_radius_arcsec (typical values: 2.0 arcsec; adjust as needed).\n   - Convert to degrees: radius_deg = match_radius_arcsec / 3600.0.\n\n3) Apply a Q3C cone search on AllWISE around the ZTF object\u2019s coordinates\n   - Use q3c_radial_query(allwise.ra, allwise.dec, o.ra, o.dec, radius_deg) to select candidate AllWISE sources near the ZTF object.\n   - Be careful with parameter order: q3c_radial_query(ra, dec, center_ra, center_dec, radius_deg).\n\n4) If multiple candidates are found, select the nearest\n   - Order by q3c_dist(allwise.ra, allwise.dec, o.ra, o.dec) ASC and optionally LIMIT 1.\n   - Again, verify parameter order for q3c_dist(ra1, dec1, ra2, dec2).\n\n5) Return all columns from AllWISE\n   - SELECT a.* where a is the allwise alias.\n\nAdditional implementation details and checks\n- Exact columns in allwise to be returned by SELECT a.*:\n  - oid_catalog, ra, dec,\n  - w1mpro, w2mpro, w3mpro, w4mpro,\n  - w1sigmpro, w2sigmpro, w3sigmpro, w4sigmpro,\n  - j_m_2mass, h_m_2mass, k_m_2mass,\n  - j_msig_2mass, h_msig_2mass, k_msig_2mass.\n- Indices:\n  - allwise has btree indexes on ra and dec. If your DB also has a Q3C index on (ra, dec), Q3C queries will be faster; otherwise they still work but may be slower.\n- Edge cases:\n  - If the object.oid is not found in object, the coordinate-based plan cannot proceed.\n  - If the crossmatch returns no rows, fall back to the coordinate-based plan.\n  - If multiple AllWISE matches exist within the radius, document whether you want the nearest only (then use ORDER BY ... LIMIT 1) or all candidates.\n\nSummary of the two concrete paths\n- Path via xmatch (recommended, exact catalog linkage): xmatch.oid = 'ZTF21aazqwxv' AND xmatch.catalog = 'allwise', then join on a.oid_catalog = xmatch.oid_catalog and SELECT a.*.\n- Path via coordinates: fetch o.ra, o.dec for 'ZTF21aazqwxv' from object, cone-search allwise with q3c_radial_query around (o.ra, o.dec) within a chosen radius, optionally pick the nearest by q3c_dist, and SELECT a.*."
                },
                "in_toks": 2725,
                "out_toks": 3925,
                "id": "chatcmpl-CSqsqG5ZKiWdEPSiPXXyQWBKSMRa8",
                "created": 1760992504,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all columns from the AllWISE catalog for ZTF object 'ZTF21aazqwxv'\n-- Plan A: Use crossmatch to retrieve AllWISE entries linked to the ZTF oid\n-- Plan B (fallback): If no crossmatch rows, perform a 2 arcsec Q3C cone search around the object's meanra/meandec and return the nearest AllWISE source\n\nWITH\nxmatch_rows AS (\n  SELECT x.oid_catalog\n  FROM xmatch x\n  WHERE x.oid = 'ZTF21aazqwxv'\n    AND x.catalog = 'allwise'\n),\nby_xmatch AS (\n  SELECT a.*\n  FROM allwise a\n  INNER JOIN xmatch_rows xm ON xm.oid_catalog = a.oid_catalog\n),\nobject_pos AS (\n  SELECT o.meanra AS ra, o.meandec AS dec\n  FROM object o\n  WHERE o.oid = 'ZTF21aazqwxv'\n),\nby_cone AS (\n  SELECT a.*\n  FROM allwise a\n  CROSS JOIN object_pos p\n  WHERE q3c_radial_query(a.ra, a.dec, p.ra, p.dec, 2.0/3600.0) -- 2 arcsec radius\n  ORDER BY q3c_dist(a.ra, a.dec, p.ra, p.dec)\n  LIMIT 1\n)\nSELECT * FROM by_xmatch\nUNION ALL\nSELECT * FROM by_cone\nWHERE NOT EXISTS (SELECT 1 FROM by_xmatch);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns from the AllWISE catalog for ZTF object 'ZTF21aazqwxv'\n-- Plan A: Use crossmatch to retrieve AllWISE entries linked to the ZTF oid\n-- Plan B (fallback): If no crossmatch rows, perform a 2 arcsec Q3C cone search around the object's meanra/meandec and return the nearest AllWISE source\n\nWITH\nxmatch_rows AS (\n  SELECT x.oid_catalog\n  FROM xmatch x\n  WHERE x.oid = 'ZTF21aazqwxv'\n    AND x.catalog = 'allwise'\n),\nby_xmatch AS (\n  SELECT a.*\n  FROM allwise a\n  INNER JOIN xmatch_rows xm ON xm.oid_catalog = a.oid_catalog\n),\nobject_pos AS (\n  SELECT o.meanra AS ra, o.meandec AS dec\n  FROM object o\n  WHERE o.oid = 'ZTF21aazqwxv'\n),\nby_cone AS (\n  SELECT a.*\n  FROM allwise a\n  CROSS JOIN object_pos p\n  WHERE q3c_radial_query(a.ra, a.dec, p.ra, p.dec, 2.0/3600.0) -- 2 arcsec radius\n  ORDER BY q3c_dist(a.ra, a.dec, p.ra, p.dec)\n  LIMIT 1\n)\nSELECT * FROM by_xmatch\nUNION ALL\nSELECT * FROM by_cone\nWHERE NOT EXISTS (SELECT 1 FROM by_xmatch);\n```"
                },
                "in_toks": 3369,
                "out_toks": 2121,
                "id": "chatcmpl-CSr7nr9L62ZkHcEw2Gi8V2pQkcqe3",
                "created": 1760993431,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "2": {
            "req_id": "83",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'allwise']"
                },
                "in_toks": 608,
                "out_toks": 400,
                "id": "chatcmpl-CSsofKiuAEhK5LAtXIBic1qEXSlsX",
                "created": 1760999933,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1600,
                "out_toks": 1231,
                "id": "chatcmpl-CSxa5mCjLtvpGcqqcbn9R11UzC1JB",
                "created": 1761018249,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query that returns all ALLWISE columns for the ZTF object ZTF21aazqwxv\n\n1) Inputs and assumptions\n- Input ZTF object identifier (object.oid): 'ZTF21aazqwxv'\n- Spatial crossmatch is required because ALLWISE rows are not keyed by the ZTF oid. We will use the object\u2019s sky position (object.meanra, object.meandec) to find nearby ALLWISE sources (allwise.ra, allwise.dec).\n- Matching radius (degrees): choose a small cone suitable for WISE crossmatches; default to 3 arcseconds = 3.0/3600.0 degrees (~0.0008333333 deg). You may parameterize this value to adjust if needed.\n- Output columns: only ALLWISE columns (i.e., select allwise.*), since the user requested \u201call columns in the allwise table.\u201d\n- If multiple ALLWISE sources fall within the radius, return all of them sorted by angular separation (smallest first). Optionally, you can limit to the nearest match if desired.\n\n2) Tables and columns to use\n- object\n  - oid (PK, VARCHAR) \u2014 filter by 'ZTF21aazqwxv'\n  - meanra (DOUBLE PRECISION)\n  - meandec (DOUBLE PRECISION)\n- allwise\n  - ra (DOUBLE PRECISION)\n  - dec (DOUBLE PRECISION)\n  - All other columns in allwise (w1mpro, w2mpro, \u2026, k_msig_2mass, etc.)\n- Q3C functions (available per context)\n  - q3c_radial_query(ra, dec, center_ra, center_dec, radius) for the spatial join\n  - q3c_dist(ra1, dec1, ra2, dec2) to compute distance for ordering (optional but recommended)\n\n3) Base object lookup\n- Create a subquery (or CTE) that retrieves the target object\u2019s coordinates from the object table:\n  - SELECT oid, meanra, meandec\n  - WHERE object.oid = 'ZTF21aazqwxv'\n- This ensures the subsequent spatial join has a single sky position as the match center.\n- Note: If meanra or meandec is NULL for the object, the spatial join will produce no results.\n\n4) Spatial join to ALLWISE using Q3C\n- Join allwise to the single-row object subquery using q3c_radial_query:\n  - q3c_radial_query(allwise.ra, allwise.dec, object.meanra, object.meandec, :radius_deg)\n- Be careful with the parameter order:\n  - q3c_radial_query(ra, dec, center_ra, center_dec, radius)\n  - Here, ra/dec are from allwise; center_ra/center_dec are from object.\n- Set the radius parameter to 3 arcsec in degrees (0.0008333333), unless the user specifies a different radius.\n\n5) Optional distance computation for ranking\n- Compute the separation for each candidate match:\n  - q3c_dist(allwise.ra, allwise.dec, object.meanra, object.meandec) AS separation_deg\n- Use this expression in ORDER BY to sort nearest first.\n- If you must return a single best match, add LIMIT 1. If not, return all matches within the cone.\n\n6) Projection (columns to return)\n- Return only the ALLWISE columns:\n  - SELECT allwise.* (i.e., all columns in the allwise table)\n- Optionally include the derived separation_deg for inspection, but only if the user wants it. By default, keep to allwise.* as requested.\n\n7) Final filtering and ordering\n- WHERE clause: applied through q3c_radial_query in the JOIN condition.\n- ORDER BY: separation_deg ASC (if you include the computed distance).\n- LIMIT: optional (omit to return all matches; set to 1 to return the closest match).\n\n8) Performance and correctness notes\n- The object table is filtered by primary key (oid), which is efficient.\n- The allwise table has btree indexes on ra and dec; Q3C radial queries are efficient when a Q3C index exists, but the function can still be used. If performance is a concern and Q3C index is absent, you can add a coarse prefilter on dec and ra (a bounding box) before the q3c_radial_query, but it is optional.\n- Q3C functions correctly handle RA wrap-around and spherical geometry.\n\n9) Edge cases and alternatives\n- If no row exists in object for 'ZTF21aazqwxv', the query returns zero rows.\n- If meanra/meandec are NULL, the query returns zero rows.\n- If multiple ALLWISE rows fall within the radius, you will get multiple matches; decide whether to return them all or only the nearest (by adding LIMIT 1).\n- If an xmatch table exists and links object.oid to allwise.oid_catalog, that would be the most direct method; however, since only object and allwise are provided in the current schema context, use the spatial join approach above.\n\n10) Summary of construction steps\n- Step A: Define input variables: :oid := 'ZTF21aazqwxv'; :radius_deg := 0.0008333333 (3 arcsec).\n- Step B: Subquery/CTE target_object: SELECT oid, meanra, meandec FROM object WHERE oid = :oid.\n- Step C: INNER JOIN allwise to target_object ON q3c_radial_query(allwise.ra, allwise.dec, target_object.meanra, target_object.meandec, :radius_deg).\n- Step D: (Optional) Compute q3c_dist(allwise.ra, allwise.dec, target_object.meanra, target_object.meandec) AS separation_deg and ORDER BY separation_deg ASC.\n- Step E: SELECT projection: allwise.* only.\n- Step F: (Optional) LIMIT 1 to keep only the nearest match.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query that returns all ALLWISE columns for the ZTF object ZTF21aazqwxv\n\n1) Inputs and assumptions\n- Input ZTF object identifier (object.oid): 'ZTF21aazqwxv'\n- Spatial crossmatch is required because ALLWISE rows are not keyed by the ZTF oid. We will use the object\u2019s sky position (object.meanra, object.meandec) to find nearby ALLWISE sources (allwise.ra, allwise.dec).\n- Matching radius (degrees): choose a small cone suitable for WISE crossmatches; default to 3 arcseconds = 3.0/3600.0 degrees (~0.0008333333 deg). You may parameterize this value to adjust if needed.\n- Output columns: only ALLWISE columns (i.e., select allwise.*), since the user requested \u201call columns in the allwise table.\u201d\n- If multiple ALLWISE sources fall within the radius, return all of them sorted by angular separation (smallest first). Optionally, you can limit to the nearest match if desired.\n\n2) Tables and columns to use\n- object\n  - oid (PK, VARCHAR) \u2014 filter by 'ZTF21aazqwxv'\n  - meanra (DOUBLE PRECISION)\n  - meandec (DOUBLE PRECISION)\n- allwise\n  - ra (DOUBLE PRECISION)\n  - dec (DOUBLE PRECISION)\n  - All other columns in allwise (w1mpro, w2mpro, \u2026, k_msig_2mass, etc.)\n- Q3C functions (available per context)\n  - q3c_radial_query(ra, dec, center_ra, center_dec, radius) for the spatial join\n  - q3c_dist(ra1, dec1, ra2, dec2) to compute distance for ordering (optional but recommended)\n\n3) Base object lookup\n- Create a subquery (or CTE) that retrieves the target object\u2019s coordinates from the object table:\n  - SELECT oid, meanra, meandec\n  - WHERE object.oid = 'ZTF21aazqwxv'\n- This ensures the subsequent spatial join has a single sky position as the match center.\n- Note: If meanra or meandec is NULL for the object, the spatial join will produce no results.\n\n4) Spatial join to ALLWISE using Q3C\n- Join allwise to the single-row object subquery using q3c_radial_query:\n  - q3c_radial_query(allwise.ra, allwise.dec, object.meanra, object.meandec, :radius_deg)\n- Be careful with the parameter order:\n  - q3c_radial_query(ra, dec, center_ra, center_dec, radius)\n  - Here, ra/dec are from allwise; center_ra/center_dec are from object.\n- Set the radius parameter to 3 arcsec in degrees (0.0008333333), unless the user specifies a different radius.\n\n5) Optional distance computation for ranking\n- Compute the separation for each candidate match:\n  - q3c_dist(allwise.ra, allwise.dec, object.meanra, object.meandec) AS separation_deg\n- Use this expression in ORDER BY to sort nearest first.\n- If you must return a single best match, add LIMIT 1. If not, return all matches within the cone.\n\n6) Projection (columns to return)\n- Return only the ALLWISE columns:\n  - SELECT allwise.* (i.e., all columns in the allwise table)\n- Optionally include the derived separation_deg for inspection, but only if the user wants it. By default, keep to allwise.* as requested.\n\n7) Final filtering and ordering\n- WHERE clause: applied through q3c_radial_query in the JOIN condition.\n- ORDER BY: separation_deg ASC (if you include the computed distance).\n- LIMIT: optional (omit to return all matches; set to 1 to return the closest match).\n\n8) Performance and correctness notes\n- The object table is filtered by primary key (oid), which is efficient.\n- The allwise table has btree indexes on ra and dec; Q3C radial queries are efficient when a Q3C index exists, but the function can still be used. If performance is a concern and Q3C index is absent, you can add a coarse prefilter on dec and ra (a bounding box) before the q3c_radial_query, but it is optional.\n- Q3C functions correctly handle RA wrap-around and spherical geometry.\n\n9) Edge cases and alternatives\n- If no row exists in object for 'ZTF21aazqwxv', the query returns zero rows.\n- If meanra/meandec are NULL, the query returns zero rows.\n- If multiple ALLWISE rows fall within the radius, you will get multiple matches; decide whether to return them all or only the nearest (by adding LIMIT 1).\n- If an xmatch table exists and links object.oid to allwise.oid_catalog, that would be the most direct method; however, since only object and allwise are provided in the current schema context, use the spatial join approach above.\n\n10) Summary of construction steps\n- Step A: Define input variables: :oid := 'ZTF21aazqwxv'; :radius_deg := 0.0008333333 (3 arcsec).\n- Step B: Subquery/CTE target_object: SELECT oid, meanra, meandec FROM object WHERE oid = :oid.\n- Step C: INNER JOIN allwise to target_object ON q3c_radial_query(allwise.ra, allwise.dec, target_object.meanra, target_object.meandec, :radius_deg).\n- Step D: (Optional) Compute q3c_dist(allwise.ra, allwise.dec, target_object.meanra, target_object.meandec) AS separation_deg and ORDER BY separation_deg ASC.\n- Step E: SELECT projection: allwise.* only.\n- Step F: (Optional) LIMIT 1 to keep only the nearest match."
                },
                "in_toks": 3207,
                "out_toks": 3581,
                "id": "chatcmpl-CSxkfYsAqHieS2KF3BPQ5tt2aC2Ic",
                "created": 1761018905,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all columns from the ALLWISE table for the ZTF object 'ZTF21aazqwxv'\n-- Crossmatch radius: 3 arcseconds (0.0008333333333333333 degrees)\n-- Returns all ALLWISE matches within the cone, ordered by nearest first\nWITH target_object AS (\n    SELECT oid, meanra, meandec\n    FROM object\n    WHERE oid = 'ZTF21aazqwxv'\n)\nSELECT a.*\nFROM allwise AS a\nINNER JOIN target_object AS o\n    ON q3c_radial_query(a.ra, a.dec, o.meanra, o.meandec, 0.0008333333333333333)\nORDER BY q3c_dist(a.ra, a.dec, o.meanra, o.meandec) ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns from the ALLWISE table for the ZTF object 'ZTF21aazqwxv'\n-- Crossmatch radius: 3 arcseconds (0.0008333333333333333 degrees)\n-- Returns all ALLWISE matches within the cone, ordered by nearest first\nWITH target_object AS (\n    SELECT oid, meanra, meandec\n    FROM object\n    WHERE oid = 'ZTF21aazqwxv'\n)\nSELECT a.*\nFROM allwise AS a\nINNER JOIN target_object AS o\n    ON q3c_radial_query(a.ra, a.dec, o.meanra, o.meandec, 0.0008333333333333333)\nORDER BY q3c_dist(a.ra, a.dec, o.meanra, o.meandec) ASC;\n```"
                },
                "in_toks": 3281,
                "out_toks": 1461,
                "id": "chatcmpl-CSyRK0PDOvNDDKbLLS1oAEmO7qpqO",
                "created": 1761021550,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "83",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'allwise']"
                },
                "in_toks": 608,
                "out_toks": 336,
                "id": "chatcmpl-CSsolWNtUwWRwEyzK409v2CBiKsmm",
                "created": 1760999939,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1600,
                "out_toks": 1167,
                "id": "chatcmpl-CSxaJUGlTeaLfDxug3ggzj7u7P42W",
                "created": 1761018263,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\nGoal\n- Return all columns from the allwise table corresponding to the ZTF object with oid = 'ZTF21aazqwxv'.\n\nKey points from schema\n- ZTF objects are stored in object (primary key: object.oid). Coordinates: object.meanra, object.meandec (degrees).\n- ALLWISE sources are stored in allwise (primary key: allwise.oid_catalog). Coordinates: allwise.ra, allwise.dec (degrees).\n- There is no direct ID join between object and allwise; linkage must be done via a spatial (positional) match using Q3C functions.\n- Q3C functions accept angles in degrees.\n\nSteps\n\n1) Identify the target object\n- Filter the object table by object.oid = 'ZTF21aazqwxv'.\n- Columns needed from object for the match: object.meanra and object.meandec.\n\n2) Choose a cross-match strategy and radius\n- Use a cone (radial) match between the object\u2019s mean position and ALLWISE positions.\n- Recommended matching radius: 3 arcseconds, converted to degrees as 3/3600 = 0.000833333... degrees.\n- Use a Q3C function for the spatial constraint. Two valid options:\n  - q3c_radial_query(allwise.ra, allwise.dec, object.meanra, object.meandec, radius_deg), or\n  - q3c_join(allwise.ra, allwise.dec, object.meanra, object.meandec, radius_deg).\n- Be careful with argument order: the first pair is the candidate table (allwise.ra, allwise.dec), the second pair is the reference position (object.meanra, object.meandec), followed by the radius in degrees.\n\n3) Join design\n- Use an INNER JOIN between object and allwise with the Q3C spatial predicate as the join condition.\n- Left filtering clause: object.oid = 'ZTF21aazqwxv'.\n- Join condition: the chosen Q3C function returns true within the 3\" radius.\n\n4) Disambiguation if multiple ALLWISE matches exist\n- Compute the angular distance with q3c_dist(allwise.ra, allwise.dec, object.meanra, object.meandec).\n- Order results by this distance ascending.\n- Limit to the closest match (LIMIT 1) to return a single best counterpart. If you prefer to see all possible counterparts within the radius, omit the LIMIT and ordering.\n\n5) Select list\n- Return only the ALLWISE columns as requested: select allwise.*.\n- Do not add columns from object unless explicitly requested by the user.\n\n6) Performance considerations\n- The spatial predicate using Q3C will be efficient if the appropriate Q3C index exists on allwise(ra, dec). If not, performance may degrade; still, use the Q3C predicate for correctness.\n- The filter on object.oid is highly selective and uses the object primary key, ensuring only one object row is used in the spatial join.\n\n7) Expected behavior and edge cases\n- If the ZTF object does not exist in object, the query returns zero rows.\n- If there are no ALLWISE sources within 3\", the query returns zero rows.\n- Adjust the radius if needed for your science use case (e.g., 2\" tighter, 5\" looser), but keep units in degrees.\n\nSummary of the final query structure to implement\n- FROM object o\n- WHERE o.oid = 'ZTF21aazqwxv'\n- INNER JOIN allwise aw ON q3c_radial_query(aw.ra, aw.dec, o.meanra, o.meandec, 3/3600.0)\n- SELECT aw.* only\n- Optionally ORDER BY q3c_dist(aw.ra, aw.dec, o.meanra, o.meandec) ASC\n- Optionally LIMIT 1 to get the nearest match\n\nNo probability table is needed for this request, so the default probability conditions do not apply.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\nGoal\n- Return all columns from the allwise table corresponding to the ZTF object with oid = 'ZTF21aazqwxv'.\n\nKey points from schema\n- ZTF objects are stored in object (primary key: object.oid). Coordinates: object.meanra, object.meandec (degrees).\n- ALLWISE sources are stored in allwise (primary key: allwise.oid_catalog). Coordinates: allwise.ra, allwise.dec (degrees).\n- There is no direct ID join between object and allwise; linkage must be done via a spatial (positional) match using Q3C functions.\n- Q3C functions accept angles in degrees.\n\nSteps\n\n1) Identify the target object\n- Filter the object table by object.oid = 'ZTF21aazqwxv'.\n- Columns needed from object for the match: object.meanra and object.meandec.\n\n2) Choose a cross-match strategy and radius\n- Use a cone (radial) match between the object\u2019s mean position and ALLWISE positions.\n- Recommended matching radius: 3 arcseconds, converted to degrees as 3/3600 = 0.000833333... degrees.\n- Use a Q3C function for the spatial constraint. Two valid options:\n  - q3c_radial_query(allwise.ra, allwise.dec, object.meanra, object.meandec, radius_deg), or\n  - q3c_join(allwise.ra, allwise.dec, object.meanra, object.meandec, radius_deg).\n- Be careful with argument order: the first pair is the candidate table (allwise.ra, allwise.dec), the second pair is the reference position (object.meanra, object.meandec), followed by the radius in degrees.\n\n3) Join design\n- Use an INNER JOIN between object and allwise with the Q3C spatial predicate as the join condition.\n- Left filtering clause: object.oid = 'ZTF21aazqwxv'.\n- Join condition: the chosen Q3C function returns true within the 3\" radius.\n\n4) Disambiguation if multiple ALLWISE matches exist\n- Compute the angular distance with q3c_dist(allwise.ra, allwise.dec, object.meanra, object.meandec).\n- Order results by this distance ascending.\n- Limit to the closest match (LIMIT 1) to return a single best counterpart. If you prefer to see all possible counterparts within the radius, omit the LIMIT and ordering.\n\n5) Select list\n- Return only the ALLWISE columns as requested: select allwise.*.\n- Do not add columns from object unless explicitly requested by the user.\n\n6) Performance considerations\n- The spatial predicate using Q3C will be efficient if the appropriate Q3C index exists on allwise(ra, dec). If not, performance may degrade; still, use the Q3C predicate for correctness.\n- The filter on object.oid is highly selective and uses the object primary key, ensuring only one object row is used in the spatial join.\n\n7) Expected behavior and edge cases\n- If the ZTF object does not exist in object, the query returns zero rows.\n- If there are no ALLWISE sources within 3\", the query returns zero rows.\n- Adjust the radius if needed for your science use case (e.g., 2\" tighter, 5\" looser), but keep units in degrees.\n\nSummary of the final query structure to implement\n- FROM object o\n- WHERE o.oid = 'ZTF21aazqwxv'\n- INNER JOIN allwise aw ON q3c_radial_query(aw.ra, aw.dec, o.meanra, o.meandec, 3/3600.0)\n- SELECT aw.* only\n- Optionally ORDER BY q3c_dist(aw.ra, aw.dec, o.meanra, o.meandec) ASC\n- Optionally LIMIT 1 to get the nearest match\n\nNo probability table is needed for this request, so the default probability conditions do not apply."
                },
                "in_toks": 3207,
                "out_toks": 3087,
                "id": "chatcmpl-CSxlJQRblohn93JTPyHG1ltx7yzme",
                "created": 1761018945,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all ALLWISE columns for the ZTF object 'ZTF21aazqwxv' by positional cross-match within 3 arcseconds\nSELECT\n    aw.*\nFROM object AS o\nINNER JOIN allwise AS aw\n    ON q3c_radial_query(aw.ra, aw.dec, o.meanra, o.meandec, 3.0/3600.0) -- 3 arcsec radius in degrees\nWHERE o.oid = 'ZTF21aazqwxv'\nORDER BY q3c_dist(aw.ra, aw.dec, o.meanra, o.meandec) ASC -- closest counterpart first\nLIMIT 1; -- return the single nearest ALLWISE match\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all ALLWISE columns for the ZTF object 'ZTF21aazqwxv' by positional cross-match within 3 arcseconds\nSELECT\n    aw.*\nFROM object AS o\nINNER JOIN allwise AS aw\n    ON q3c_radial_query(aw.ra, aw.dec, o.meanra, o.meandec, 3.0/3600.0) -- 3 arcsec radius in degrees\nWHERE o.oid = 'ZTF21aazqwxv'\nORDER BY q3c_dist(aw.ra, aw.dec, o.meanra, o.meandec) ASC -- closest counterpart first\nLIMIT 1; -- return the single nearest ALLWISE match\n```"
                },
                "in_toks": 2851,
                "out_toks": 1184,
                "id": "chatcmpl-CSyRelAc8Xnj0QooED5Mtjrv6nsEa",
                "created": 1761021570,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "83",
            "experiment_id": "run_4",
            "pred_tables": [
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch', 'allwise']"
                },
                "in_toks": 608,
                "out_toks": 529,
                "id": "chatcmpl-CSsoqThPB4QvRONMoKDvBnJhTtdcZ",
                "created": 1760999944,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1231,
                "out_toks": 463,
                "id": "chatcmpl-CSxaWg5cRfP9HrsyqvLyKIwpPi2BS",
                "created": 1761018276,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and inputs\n- Goal: Retrieve all columns from the AllWISE catalog entry (table allwise) that is cross-matched to the given ZTF object.\n- Input parameter: ZTF object id (xmatch.oid) = 'ZTF21aazqwxv'.\n\n2) Identify relevant tables and join keys\n- xmatch: contains ZTF object ids (xmatch.oid) and the matched catalog ids (xmatch.oid_catalog), along with the catalog name (xmatch.catid) and angular separation (xmatch.dist).\n- allwise: contains the AllWISE catalog data; its primary key allwise.oid_catalog matches xmatch.oid_catalog for AllWISE matches.\n- Join key: xmatch.oid_catalog = allwise.oid_catalog.\n\n3) Define the selection and filtering conditions\n- Filter by the requested ZTF object: xmatch.oid = 'ZTF21aazqwxv'.\n- Restrict to rows that correspond to the AllWISE catalog by joining to allwise on oid_catalog. This inherently limits results to AllWISE matches.\n- Optional (only if you know the exact value used in your instance): also filter xmatch.catid to the AllWISE catalog name (commonly 'ALLWISE'). If uncertain, omit this condition since the join already restricts to AllWISE entries.\n\n4) Choose the result columns\n- Return all columns from the allwise table, as the user requested \u201call columns\u201d (select allwise.*).\n\n5) Specify the table relationships (JOIN structure)\n- Use an INNER JOIN from xmatch to allwise on the shared key xmatch.oid_catalog = allwise.oid_catalog so only AllWISE matches for the specified ZTF oid are returned.\n\n6) Handle potential multiplicity and ordering\n- It is possible for a single ZTF object to have multiple AllWISE cross-matches in xmatch. Do not limit results unless the user requests only the closest match.\n- Optional: add an ORDER BY xmatch.dist ASC to present the closest AllWISE match first. If the user wants only the closest one, add a LIMIT 1 (not requested here).\n\n7) Performance considerations\n- The join leverages allwise.oid_catalog being a PRIMARY KEY, ensuring efficient lookups.\n- No spatial constraints are needed; Q3C functions are not used here.\n- No default probability filters apply since the probability table is not involved.\n\n8) Final query structure to generate (conceptually)\n- FROM xmatch (aliased, e.g., xm)\n- INNER JOIN allwise (aliased, e.g., aw) ON aw.oid_catalog = xm.oid_catalog\n- WHERE xm.oid = 'ZTF21aazqwxv'\n- SELECT aw.* (optionally ORDER BY xm.dist ASC)",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and inputs\n- Goal: Retrieve all columns from the AllWISE catalog entry (table allwise) that is cross-matched to the given ZTF object.\n- Input parameter: ZTF object id (xmatch.oid) = 'ZTF21aazqwxv'.\n\n2) Identify relevant tables and join keys\n- xmatch: contains ZTF object ids (xmatch.oid) and the matched catalog ids (xmatch.oid_catalog), along with the catalog name (xmatch.catid) and angular separation (xmatch.dist).\n- allwise: contains the AllWISE catalog data; its primary key allwise.oid_catalog matches xmatch.oid_catalog for AllWISE matches.\n- Join key: xmatch.oid_catalog = allwise.oid_catalog.\n\n3) Define the selection and filtering conditions\n- Filter by the requested ZTF object: xmatch.oid = 'ZTF21aazqwxv'.\n- Restrict to rows that correspond to the AllWISE catalog by joining to allwise on oid_catalog. This inherently limits results to AllWISE matches.\n- Optional (only if you know the exact value used in your instance): also filter xmatch.catid to the AllWISE catalog name (commonly 'ALLWISE'). If uncertain, omit this condition since the join already restricts to AllWISE entries.\n\n4) Choose the result columns\n- Return all columns from the allwise table, as the user requested \u201call columns\u201d (select allwise.*).\n\n5) Specify the table relationships (JOIN structure)\n- Use an INNER JOIN from xmatch to allwise on the shared key xmatch.oid_catalog = allwise.oid_catalog so only AllWISE matches for the specified ZTF oid are returned.\n\n6) Handle potential multiplicity and ordering\n- It is possible for a single ZTF object to have multiple AllWISE cross-matches in xmatch. Do not limit results unless the user requests only the closest match.\n- Optional: add an ORDER BY xmatch.dist ASC to present the closest AllWISE match first. If the user wants only the closest one, add a LIMIT 1 (not requested here).\n\n7) Performance considerations\n- The join leverages allwise.oid_catalog being a PRIMARY KEY, ensuring efficient lookups.\n- No spatial constraints are needed; Q3C functions are not used here.\n- No default probability filters apply since the probability table is not involved.\n\n8) Final query structure to generate (conceptually)\n- FROM xmatch (aliased, e.g., xm)\n- INNER JOIN allwise (aliased, e.g., aw) ON aw.oid_catalog = xm.oid_catalog\n- WHERE xm.oid = 'ZTF21aazqwxv'\n- SELECT aw.* (optionally ORDER BY xm.dist ASC)"
                },
                "in_toks": 2838,
                "out_toks": 2322,
                "id": "chatcmpl-CSxluWnbpGcg7NEN4h2M83q8MLLkv",
                "created": 1761018982,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all columns from the AllWISE catalog entry matched to the given ZTF object\nSELECT aw.*\nFROM xmatch AS xm\nINNER JOIN allwise AS aw\n  ON aw.oid_catalog = xm.oid_catalog\nWHERE xm.oid = 'ZTF21aazqwxv';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the AllWISE catalog entry matched to the given ZTF object\nSELECT aw.*\nFROM xmatch AS xm\nINNER JOIN allwise AS aw\n  ON aw.oid_catalog = xm.oid_catalog\nWHERE xm.oid = 'ZTF21aazqwxv';\n```"
                },
                "in_toks": 2598,
                "out_toks": 906,
                "id": "chatcmpl-CSyRsyO1N8DVCd5927qgUh0TXsgLd",
                "created": 1761021584,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "83",
            "experiment_id": "run_5",
            "pred_tables": [
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise']"
                },
                "in_toks": 608,
                "out_toks": 333,
                "id": "chatcmpl-CZNA4LIkmiY0cwKaryN1TNxPmon0N",
                "created": 1762546548,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1118,
                "out_toks": 1103,
                "id": "chatcmpl-CZYdS9dZfM2xzJqSnQF7Xxs4lsP2A",
                "created": 1762590654,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 2996,
                "out_toks": 4000,
                "id": "chatcmpl-CZZps055A0Q77U1zbv39WqqkCETiE",
                "created": 1762595268,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all columns from the 'allwise' table for the ZTF object by sky-position crossmatch\n-- Uses a 2 arcsec radius; adjust if needed\nSELECT\n  a.*\nFROM object o\nINNER JOIN allwise a\n  ON q3c_join(a.ra, a.dec, o.meanra, o.meandec, 2.0/3600.0)\nWHERE o.oid = 'ZTF21aazqwxv'\nORDER BY q3c_dist(a.ra, a.dec, o.meanra, o.meandec);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the 'allwise' table for the ZTF object by sky-position crossmatch\n-- Uses a 2 arcsec radius; adjust if needed\nSELECT\n  a.*\nFROM object o\nINNER JOIN allwise a\n  ON q3c_join(a.ra, a.dec, o.meanra, o.meandec, 2.0/3600.0)\nWHERE o.oid = 'ZTF21aazqwxv'\nORDER BY q3c_dist(a.ra, a.dec, o.meanra, o.meandec);\n```"
                },
                "in_toks": 2995,
                "out_toks": 1858,
                "id": "chatcmpl-CZawcC7ll8aDUJrYznw3vIa3eyq5t",
                "created": 1762599530,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "83",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'allwise']"
                },
                "in_toks": 608,
                "out_toks": 400,
                "id": "chatcmpl-CZNAAh69th67rb5g5TlQwlkJ0aUbj",
                "created": 1762546554,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1600,
                "out_toks": 2447,
                "id": "chatcmpl-CZYe0ymPttCwBPFhyPa7qgb48Xbgd",
                "created": 1762590688,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\nGoal: Return all columns from the allwise table corresponding to the ZTF object with oid = 'ZTF21aazqwxv'. Because allwise.oid_catalog is not a ZTF oid and there is no xmatch table available in the provided schema, perform a spatial crossmatch between the ZTF object\u2019s coordinates (from object) and AllWISE sources (from allwise) using Q3C functions.\n\nInputs and assumptions\n- Target ZTF oid: 'ZTF21aazqwxv'.\n- Matching method: spatial crossmatch via Q3C.\n- Default matching radius: 3 arcseconds (convert to degrees: 3/3600 = 0.000833333333... deg). You can adjust if needed.\n- Coordinate columns:\n  - object: meanra (deg), meandec (deg)\n  - allwise: ra (deg), dec (deg)\n- Output: All columns from allwise only (a.*).\n- If multiple AllWISE candidates fall within the radius, return the nearest one by angular distance.\n- If no match is found within the radius, return zero rows.\n\nStep-by-step plan\n\n1) Parameterize the target object and radius\n- Define a parameter for the ZTF object oid: 'ZTF21aazqwxv'.\n- Define a radius in degrees for the cone search (radius_deg = 3/3600.0).\n\n2) Retrieve the ZTF object\u2019s position\n- From table object, select meanra and meandec where object.oid = 'ZTF21aazqwxv'.\n- This will serve as the cone center for the spatial search.\n- Note: If this subquery returns no row (object not found), the entire query should return zero rows.\n\n3) Spatially filter AllWISE sources around the object position using Q3C\n- Use Q3C\u2019s cone search around the object\u2019s coordinates to restrict allwise rows:\n  - q3c_radial_query(allwise.ra, allwise.dec, object.meanra, object.meandec, radius_deg)\n  - Be careful with argument order: first are the candidate coordinates (a.ra, a.dec), then the center (o.meanra, o.meandec), then the radius in degrees.\n\n4) Compute angular distance for tie-breaking and nearest-neighbor selection\n- Compute the angular separation between the AllWISE source and the ZTF object using:\n  - q3c_dist(allwise.ra, allwise.dec, object.meanra, object.meandec)\n- Use this distance only for ordering/selection, not for filtering (the filtering is done by the radial query).\n\n5) Select the nearest AllWISE match within the radius\n- Order the spatially filtered AllWISE candidates by the computed q3c_dist ascending.\n- Limit to 1 row to pick the closest match.\n- Optional (for deterministic tie-breaking if identical distances): add a secondary ORDER BY allwise.oid_catalog ASC.\n\n6) Return only AllWISE columns\n- Select all columns from the matched allwise row (a.*).\n- Do not include columns from object in the output since the user explicitly requested \u201call columns in the allwise table.\u201d\n- Optionally, if you want to debug or inspect, you can add the computed distance as an extra column; otherwise keep it to a.* per the request.\n\n7) Suggested SQL structuring details (without code)\n- Use a subquery (or a CTE) to fetch the object\u2019s meanra and meandec by oid.\n- Join that single-row subquery to allwise via a Q3C radial condition.\n- Compute q3c_dist in the SELECT-list (or an inline subquery) to allow ORDER BY distance and LIMIT 1.\n- Final projection: a.*.\n\n8) Performance considerations\n- Q3C radial searches rely on the Q3C index on the (ra, dec) columns; ensure it exists in the target deployment. If not, the btree indexes on ra/dec won\u2019t accelerate q3c predicates.\n- Since you\u2019re matching a single oid, the query will be efficient even without additional filters.\n\nEdge cases and behaviors\n- If object.oid = 'ZTF21aazqwxv' is absent, the result is empty.\n- If no AllWISE source lies within the chosen radius, the result is empty.\n- If you need more than one possible counterpart, remove LIMIT 1 and return all candidates ordered by distance.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\nGoal: Return all columns from the allwise table corresponding to the ZTF object with oid = 'ZTF21aazqwxv'. Because allwise.oid_catalog is not a ZTF oid and there is no xmatch table available in the provided schema, perform a spatial crossmatch between the ZTF object\u2019s coordinates (from object) and AllWISE sources (from allwise) using Q3C functions.\n\nInputs and assumptions\n- Target ZTF oid: 'ZTF21aazqwxv'.\n- Matching method: spatial crossmatch via Q3C.\n- Default matching radius: 3 arcseconds (convert to degrees: 3/3600 = 0.000833333333... deg). You can adjust if needed.\n- Coordinate columns:\n  - object: meanra (deg), meandec (deg)\n  - allwise: ra (deg), dec (deg)\n- Output: All columns from allwise only (a.*).\n- If multiple AllWISE candidates fall within the radius, return the nearest one by angular distance.\n- If no match is found within the radius, return zero rows.\n\nStep-by-step plan\n\n1) Parameterize the target object and radius\n- Define a parameter for the ZTF object oid: 'ZTF21aazqwxv'.\n- Define a radius in degrees for the cone search (radius_deg = 3/3600.0).\n\n2) Retrieve the ZTF object\u2019s position\n- From table object, select meanra and meandec where object.oid = 'ZTF21aazqwxv'.\n- This will serve as the cone center for the spatial search.\n- Note: If this subquery returns no row (object not found), the entire query should return zero rows.\n\n3) Spatially filter AllWISE sources around the object position using Q3C\n- Use Q3C\u2019s cone search around the object\u2019s coordinates to restrict allwise rows:\n  - q3c_radial_query(allwise.ra, allwise.dec, object.meanra, object.meandec, radius_deg)\n  - Be careful with argument order: first are the candidate coordinates (a.ra, a.dec), then the center (o.meanra, o.meandec), then the radius in degrees.\n\n4) Compute angular distance for tie-breaking and nearest-neighbor selection\n- Compute the angular separation between the AllWISE source and the ZTF object using:\n  - q3c_dist(allwise.ra, allwise.dec, object.meanra, object.meandec)\n- Use this distance only for ordering/selection, not for filtering (the filtering is done by the radial query).\n\n5) Select the nearest AllWISE match within the radius\n- Order the spatially filtered AllWISE candidates by the computed q3c_dist ascending.\n- Limit to 1 row to pick the closest match.\n- Optional (for deterministic tie-breaking if identical distances): add a secondary ORDER BY allwise.oid_catalog ASC.\n\n6) Return only AllWISE columns\n- Select all columns from the matched allwise row (a.*).\n- Do not include columns from object in the output since the user explicitly requested \u201call columns in the allwise table.\u201d\n- Optionally, if you want to debug or inspect, you can add the computed distance as an extra column; otherwise keep it to a.* per the request.\n\n7) Suggested SQL structuring details (without code)\n- Use a subquery (or a CTE) to fetch the object\u2019s meanra and meandec by oid.\n- Join that single-row subquery to allwise via a Q3C radial condition.\n- Compute q3c_dist in the SELECT-list (or an inline subquery) to allow ORDER BY distance and LIMIT 1.\n- Final projection: a.*.\n\n8) Performance considerations\n- Q3C radial searches rely on the Q3C index on the (ra, dec) columns; ensure it exists in the target deployment. If not, the btree indexes on ra/dec won\u2019t accelerate q3c predicates.\n- Since you\u2019re matching a single oid, the query will be efficient even without additional filters.\n\nEdge cases and behaviors\n- If object.oid = 'ZTF21aazqwxv' is absent, the result is empty.\n- If no AllWISE source lies within the chosen radius, the result is empty.\n- If you need more than one possible counterpart, remove LIMIT 1 and return all candidates ordered by distance."
                },
                "in_toks": 3207,
                "out_toks": 2790,
                "id": "chatcmpl-CZZmTvfNPQFiEO7RIlyDTwuWXA7sN",
                "created": 1762595057,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all columns from the AllWISE table matched to the ZTF object 'ZTF21aazqwxv'\n-- using a 3 arcsec radius crossmatch via Q3C, returning the nearest source.\nWITH target AS (\n  SELECT oid, meanra, meandec\n  FROM object\n  WHERE oid = 'ZTF21aazqwxv'\n)\nSELECT a.*\nFROM allwise a\nJOIN target t\n  ON q3c_radial_query(a.ra, a.dec, t.meanra, t.meandec, 3.0/3600.0)\nORDER BY q3c_dist(a.ra, a.dec, t.meanra, t.meandec) ASC\nLIMIT 1;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns from the AllWISE table matched to the ZTF object 'ZTF21aazqwxv'\n-- using a 3 arcsec radius crossmatch via Q3C, returning the nearest source.\nWITH target AS (\n  SELECT oid, meanra, meandec\n  FROM object\n  WHERE oid = 'ZTF21aazqwxv'\n)\nSELECT a.*\nFROM allwise a\nJOIN target t\n  ON q3c_radial_query(a.ra, a.dec, t.meanra, t.meandec, 3.0/3600.0)\nORDER BY q3c_dist(a.ra, a.dec, t.meanra, t.meandec) ASC\nLIMIT 1;\n```"
                },
                "in_toks": 2938,
                "out_toks": 1508,
                "id": "chatcmpl-CZaxtJ47vhGwsgCrFv1WzCx9gqQTI",
                "created": 1762599609,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "83",
            "experiment_id": "run_7",
            "pred_tables": [
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise']"
                },
                "in_toks": 608,
                "out_toks": 333,
                "id": "chatcmpl-CZNAMXXakqYrUQxmZjVP9nD3a6DMB",
                "created": 1762546566,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- The allwise table does not have a ZTF oid column; it uses oid_catalog (the ALLWISE identifier).\n-- This filter will only return a row if the provided value is actually the ALLWISE oid_catalog.\n-- To query by a ZTF object id (e.g., 'ZTF21aazqwxv'), you would normally join through the crossmatch table, which is not provided here.\n\nSELECT *\nFROM allwise\nWHERE oid_catalog = 'ZTF21aazqwxv';",
            "sql_response": {
                "responses": {
                    "0": "-- The allwise table does not have a ZTF oid column; it uses oid_catalog (the ALLWISE identifier).\n-- This filter will only return a row if the provided value is actually the ALLWISE oid_catalog.\n-- To query by a ZTF object id (e.g., 'ZTF21aazqwxv'), you would normally join through the crossmatch table, which is not provided here.\n\nSELECT *\nFROM allwise\nWHERE oid_catalog = 'ZTF21aazqwxv';"
                },
                "in_toks": 1403,
                "out_toks": 1072,
                "id": "chatcmpl-CbHStS8yiQHiqv6AbVE40awzcynz3",
                "created": 1763001307,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1118,
                "out_toks": 1167,
                "id": "chatcmpl-CZYejK9MbUAZGD76TYu4xhGoVjEZY",
                "created": 1762590733,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 2725,
                "out_toks": 4000,
                "id": "chatcmpl-CZa12K7lnDoC5OrZOVcUtibvJ2uUn",
                "created": 1762595960,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all columns from the AllWISE crossmatch table for the specified ZTF object\nSELECT *\nFROM allwise\nWHERE oid = 'ZTF21aazqwxv';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the AllWISE crossmatch table for the specified ZTF object\nSELECT *\nFROM allwise\nWHERE oid = 'ZTF21aazqwxv';\n```"
                },
                "in_toks": 2995,
                "out_toks": 626,
                "id": "chatcmpl-CZawc79R2uttjr8UHAA7kcafEam0g",
                "created": 1762599530,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "8": {
            "req_id": "83",
            "experiment_id": "run_8",
            "pred_tables": [
                "allwise",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise', 'object']"
                },
                "in_toks": 608,
                "out_toks": 272,
                "id": "chatcmpl-CZNATrHCvtfYG8gGz4gB64uIBrP9v",
                "created": 1762546573,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1600,
                "out_toks": 1103,
                "id": "chatcmpl-CZYf0DH8eloYqsBazfB3IwTDrGdSc",
                "created": 1762590750,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\nObjective\n- Retrieve all columns from the allwise table corresponding to the ZTF object with oid = 'ZTF21aazqwxv'.\n- Because there is no explicit crossmatch table provided, perform a spatial match between the ZTF object\u2019s coordinates (from object.meanra, object.meandec) and ALLWISE positions (allwise.ra, allwise.dec) using Q3C.\n\nAssumptions and defaults\n- Tables available: object and allwise.\n- Use a cone search via the Q3C extension. Radius specified in degrees.\n- Recommended matching radius: 2.0\u20133.0 arcsec. Use 2.5 arcsec by default (i.e., radius_deg = 2.5/3600.0).\n- User requested only ALLWISE columns; therefore, select aw.* (no columns from object in the final projection unless the distance is explicitly needed).\n- Do not use the probability table (not relevant here).\n\nSteps\n\n1) Define inputs\n- ztf_oid: the ZTF object identifier string: 'ZTF21aazqwxv'.\n- match_radius_arcsec: default 2.5 (arcseconds); convert to degrees as match_radius_deg = 2.5/3600.0.\n\n2) Fetch the ZTF object\u2019s coordinates\n- Source table: object.\n- Columns needed: object.meanra, object.meandec.\n- Filter: object.oid = 'ZTF21aazqwxv'.\n- Implement as:\n  - A CTE (WITH) named target_obj returning one row with columns (oid, meanra, meandec), or\n  - An inline subquery used directly in the FROM clause.\n\n3) Perform the spatial crossmatch to ALLWISE\n- Source table: allwise (aliased as aw).\n- Join strategy: spatial filter using Q3C cone search.\n- Condition: q3c_radial_query(aw.ra, aw.dec, target_obj.meanra, target_obj.meandec, match_radius_deg) = true.\n  - Note the argument order for q3c_radial_query: (ra, dec, center_ra, center_dec, radius_deg).\n- This will return all ALLWISE entries within the specified angular radius around the ZTF object\u2019s mean coordinates.\n\n4) Output selection\n- Select all columns from the ALLWISE table only: aw.*.\n- Optional (for diagnostics or to disambiguate multiple candidates): add an extra computed column with the angular separation in degrees using q3c_dist(aw.ra, aw.dec, target_obj.meanra, target_obj.meandec), aliased e.g., as dist_deg. Only include if you need to pick the closest match or report distances.\n\n5) Optional disambiguation (nearest match)\n- If you want only the most likely ALLWISE counterpart:\n  - Add ORDER BY q3c_dist(aw.ra, aw.dec, target_obj.meanra, target_obj.meandec) ASC.\n  - Add LIMIT 1.\n- If you want all candidates in the cone (the default implied by \u201cget all columns\u201d), omit LIMIT 1. You may still apply ORDER BY by distance for clarity.\n\n6) Handling missing object or no matches\n- If object.oid = 'ZTF21aazqwxv' does not exist in object, the subquery/CTE returns zero rows, and the final result will be empty.\n- If the object exists but there are no ALLWISE sources within match_radius_deg, the result will be empty.\n\n7) Performance notes (informational)\n- Q3C functions are optimized for large-scale spatial queries. Ensure the Q3C extension is available.\n- For a single-oid lookup, performance is typically adequate. No further indexing changes are required in this context.\n\nSummary of elements to include in the final SQL\n- A CTE or subquery to fetch meanra and meandec from object where oid = 'ZTF21aazqwxv'.\n- A join/filter using q3c_radial_query between allwise (aw.ra, aw.dec) and the target object coordinates with radius = 2.5/3600.0 degrees.\n- SELECT aw.* as the projection.\n- Optionally compute and use q3c_dist for ordering; optionally LIMIT 1 if only the nearest counterpart is desired.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nObjective\n- Retrieve all columns from the allwise table corresponding to the ZTF object with oid = 'ZTF21aazqwxv'.\n- Because there is no explicit crossmatch table provided, perform a spatial match between the ZTF object\u2019s coordinates (from object.meanra, object.meandec) and ALLWISE positions (allwise.ra, allwise.dec) using Q3C.\n\nAssumptions and defaults\n- Tables available: object and allwise.\n- Use a cone search via the Q3C extension. Radius specified in degrees.\n- Recommended matching radius: 2.0\u20133.0 arcsec. Use 2.5 arcsec by default (i.e., radius_deg = 2.5/3600.0).\n- User requested only ALLWISE columns; therefore, select aw.* (no columns from object in the final projection unless the distance is explicitly needed).\n- Do not use the probability table (not relevant here).\n\nSteps\n\n1) Define inputs\n- ztf_oid: the ZTF object identifier string: 'ZTF21aazqwxv'.\n- match_radius_arcsec: default 2.5 (arcseconds); convert to degrees as match_radius_deg = 2.5/3600.0.\n\n2) Fetch the ZTF object\u2019s coordinates\n- Source table: object.\n- Columns needed: object.meanra, object.meandec.\n- Filter: object.oid = 'ZTF21aazqwxv'.\n- Implement as:\n  - A CTE (WITH) named target_obj returning one row with columns (oid, meanra, meandec), or\n  - An inline subquery used directly in the FROM clause.\n\n3) Perform the spatial crossmatch to ALLWISE\n- Source table: allwise (aliased as aw).\n- Join strategy: spatial filter using Q3C cone search.\n- Condition: q3c_radial_query(aw.ra, aw.dec, target_obj.meanra, target_obj.meandec, match_radius_deg) = true.\n  - Note the argument order for q3c_radial_query: (ra, dec, center_ra, center_dec, radius_deg).\n- This will return all ALLWISE entries within the specified angular radius around the ZTF object\u2019s mean coordinates.\n\n4) Output selection\n- Select all columns from the ALLWISE table only: aw.*.\n- Optional (for diagnostics or to disambiguate multiple candidates): add an extra computed column with the angular separation in degrees using q3c_dist(aw.ra, aw.dec, target_obj.meanra, target_obj.meandec), aliased e.g., as dist_deg. Only include if you need to pick the closest match or report distances.\n\n5) Optional disambiguation (nearest match)\n- If you want only the most likely ALLWISE counterpart:\n  - Add ORDER BY q3c_dist(aw.ra, aw.dec, target_obj.meanra, target_obj.meandec) ASC.\n  - Add LIMIT 1.\n- If you want all candidates in the cone (the default implied by \u201cget all columns\u201d), omit LIMIT 1. You may still apply ORDER BY by distance for clarity.\n\n6) Handling missing object or no matches\n- If object.oid = 'ZTF21aazqwxv' does not exist in object, the subquery/CTE returns zero rows, and the final result will be empty.\n- If the object exists but there are no ALLWISE sources within match_radius_deg, the result will be empty.\n\n7) Performance notes (informational)\n- Q3C functions are optimized for large-scale spatial queries. Ensure the Q3C extension is available.\n- For a single-oid lookup, performance is typically adequate. No further indexing changes are required in this context.\n\nSummary of elements to include in the final SQL\n- A CTE or subquery to fetch meanra and meandec from object where oid = 'ZTF21aazqwxv'.\n- A join/filter using q3c_radial_query between allwise (aw.ra, aw.dec) and the target object coordinates with radius = 2.5/3600.0 degrees.\n- SELECT aw.* as the projection.\n- Optionally compute and use q3c_dist for ordering; optionally LIMIT 1 if only the nearest counterpart is desired."
                },
                "in_toks": 3207,
                "out_toks": 2956,
                "id": "chatcmpl-CZa3083UE7tOhVtIhOuYxoy3KGtXu",
                "created": 1762596082,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all columns from ALLWISE entries matched to the ZTF object by a 2.5 arcsec cone using Q3C\nWITH target_obj AS (\n    SELECT oid, meanra, meandec\n    FROM object\n    WHERE oid = 'ZTF21aazqwxv'\n)\nSELECT aw.*\nFROM allwise AS aw\nJOIN target_obj AS t\n    ON q3c_radial_query(aw.ra, aw.dec, t.meanra, t.meandec, 2.5/3600.0)\nORDER BY q3c_dist(aw.ra, aw.dec, t.meanra, t.meandec) ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns from ALLWISE entries matched to the ZTF object by a 2.5 arcsec cone using Q3C\nWITH target_obj AS (\n    SELECT oid, meanra, meandec\n    FROM object\n    WHERE oid = 'ZTF21aazqwxv'\n)\nSELECT aw.*\nFROM allwise AS aw\nJOIN target_obj AS t\n    ON q3c_radial_query(aw.ra, aw.dec, t.meanra, t.meandec, 2.5/3600.0)\nORDER BY q3c_dist(aw.ra, aw.dec, t.meanra, t.meandec) ASC;\n```"
                },
                "in_toks": 2912,
                "out_toks": 1301,
                "id": "chatcmpl-CZawcRcI5UrUZeWUUqEgvQwvV8Tum",
                "created": 1762599530,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "83",
            "experiment_id": "run_9",
            "pred_tables": [
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch', 'allwise']"
                },
                "in_toks": 608,
                "out_toks": 913,
                "id": "chatcmpl-CZNAZt74WR3FwFfoAM4n5seuiEJiM",
                "created": 1762546579,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1231,
                "out_toks": 335,
                "id": "chatcmpl-CZYfIj3C5Qe4bLqEXj6WLMQAfTHGR",
                "created": 1762590768,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\nGoal\n- Retrieve all columns from the AllWISE catalog (table: allwise) corresponding to the ZTF object with oid = 'ZTF21aazqwxv'.\n\nInputs\n- ZTF object identifier (oid): 'ZTF21aazqwxv'\n\nRelevant tables and columns\n- xmatch\n  - oid (ZTF object id; filter on this)\n  - oid_catalog (foreign key to catalog entry; join key to allwise.oid_catalog)\n  - catid (catalog name; optional filter if the exact AllWISE identifier is known)\n  - dist (angular separation in arcseconds; can be used for ordering by nearest match)\n- allwise\n  - oid_catalog (PRIMARY KEY; join key from xmatch)\n  - ra, dec\n  - w1mpro, w2mpro, w3mpro, w4mpro\n  - w1sigmpro, w2sigmpro, w3sigmpro, w4sigmpro\n  - j_m_2mass, h_m_2mass, k_m_2mass\n  - j_msig_2mass, h_msig_2mass, k_msig_2mass\n  - Select all columns from this table (allwise.*)\n\nStep-by-step plan\n\n1) Parameter preparation\n- Set a parameter for the target ZTF object id: target_oid = 'ZTF21aazqwxv'.\n- Treat the oid as a case-sensitive string literal.\n\n2) Identify the join strategy\n- Use xmatch to map the ZTF oid to catalog-level identifiers via xmatch.oid_catalog.\n- Join xmatch to allwise on the shared catalog key: xmatch.oid_catalog = allwise.oid_catalog.\n- Filtering xmatch by xmatch.oid = target_oid ensures we only join entries relevant to the requested ZTF object.\n- Optional: If the exact AllWISE catid string is known in this deployment, add a filter xmatch.catid = '<AllWISE catalog id>'. This is not strictly necessary because the join to allwise guarantees only AllWISE matches will be returned.\n\n3) Define the selection (projection)\n- Select all columns from allwise only (i.e., allwise.*), because the user requested all columns from the allwise table.\n- Do not include columns from xmatch in the final projection.\n\n4) Define the filtering conditions\n- Mandatory filter: xmatch.oid = 'ZTF21aazqwxv'.\n- Optional disambiguation (only if needed and the exact value is known): xmatch.catid = '<AllWISE catalog id>'.\n- No additional filters (e.g., on magnitude) are required.\n\n5) Join condition\n- INNER JOIN allwise ON allwise.oid_catalog = xmatch.oid_catalog.\n\n6) Handle potential duplicates\n- If there is a possibility that xmatch contains multiple rows that resolve to the same allwise.oid_catalog for the same oid, add a DISTINCT on allwise.oid_catalog (or SELECT DISTINCT allwise.*) to eliminate duplicates.\n- Alternatively, if multiple AllWISE counterparts exist and you want the closest one only, order by xmatch.dist ASC and limit to 1. Only apply this if \u201cclosest only\u201d is desired; otherwise return all matches.\n\n7) Optional ordering\n- If returning all matches, optionally ORDER BY xmatch.dist ASC so the closest association(s) appear first.\n\n8) Performance considerations\n- The filter on xmatch.oid drastically reduces rows before the join.\n- The equality join on allwise.oid_catalog uses the allwise primary key index.\n- No Q3C spatial functions are needed because the spatial association is already encoded in xmatch.\n\n9) Expected results and edge cases\n- If a crossmatch exists: the query returns one or more rows with all columns from allwise for the matched catalog entries.\n- If no crossmatch exists for this oid in AllWISE: the query returns zero rows.\n\n10) Final assembly\n- FROM xmatch (aliased, e.g., xm)\n- INNER JOIN allwise (aliased, e.g., aw) ON xm.oid_catalog = aw.oid_catalog\n- WHERE xm.oid = 'ZTF21aazqwxv'\n- SELECT aw.* (and optionally DISTINCT or ORDER BY xm.dist, or LIMIT 1 as needed)\n\nNotes\n- The probability and object tables are not required for this task; therefore, the default probability conditions do not apply.\n- No additional columns were requested, so only allwise.* should be returned even though the xmatch table is used for joining.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\nGoal\n- Retrieve all columns from the AllWISE catalog (table: allwise) corresponding to the ZTF object with oid = 'ZTF21aazqwxv'.\n\nInputs\n- ZTF object identifier (oid): 'ZTF21aazqwxv'\n\nRelevant tables and columns\n- xmatch\n  - oid (ZTF object id; filter on this)\n  - oid_catalog (foreign key to catalog entry; join key to allwise.oid_catalog)\n  - catid (catalog name; optional filter if the exact AllWISE identifier is known)\n  - dist (angular separation in arcseconds; can be used for ordering by nearest match)\n- allwise\n  - oid_catalog (PRIMARY KEY; join key from xmatch)\n  - ra, dec\n  - w1mpro, w2mpro, w3mpro, w4mpro\n  - w1sigmpro, w2sigmpro, w3sigmpro, w4sigmpro\n  - j_m_2mass, h_m_2mass, k_m_2mass\n  - j_msig_2mass, h_msig_2mass, k_msig_2mass\n  - Select all columns from this table (allwise.*)\n\nStep-by-step plan\n\n1) Parameter preparation\n- Set a parameter for the target ZTF object id: target_oid = 'ZTF21aazqwxv'.\n- Treat the oid as a case-sensitive string literal.\n\n2) Identify the join strategy\n- Use xmatch to map the ZTF oid to catalog-level identifiers via xmatch.oid_catalog.\n- Join xmatch to allwise on the shared catalog key: xmatch.oid_catalog = allwise.oid_catalog.\n- Filtering xmatch by xmatch.oid = target_oid ensures we only join entries relevant to the requested ZTF object.\n- Optional: If the exact AllWISE catid string is known in this deployment, add a filter xmatch.catid = '<AllWISE catalog id>'. This is not strictly necessary because the join to allwise guarantees only AllWISE matches will be returned.\n\n3) Define the selection (projection)\n- Select all columns from allwise only (i.e., allwise.*), because the user requested all columns from the allwise table.\n- Do not include columns from xmatch in the final projection.\n\n4) Define the filtering conditions\n- Mandatory filter: xmatch.oid = 'ZTF21aazqwxv'.\n- Optional disambiguation (only if needed and the exact value is known): xmatch.catid = '<AllWISE catalog id>'.\n- No additional filters (e.g., on magnitude) are required.\n\n5) Join condition\n- INNER JOIN allwise ON allwise.oid_catalog = xmatch.oid_catalog.\n\n6) Handle potential duplicates\n- If there is a possibility that xmatch contains multiple rows that resolve to the same allwise.oid_catalog for the same oid, add a DISTINCT on allwise.oid_catalog (or SELECT DISTINCT allwise.*) to eliminate duplicates.\n- Alternatively, if multiple AllWISE counterparts exist and you want the closest one only, order by xmatch.dist ASC and limit to 1. Only apply this if \u201cclosest only\u201d is desired; otherwise return all matches.\n\n7) Optional ordering\n- If returning all matches, optionally ORDER BY xmatch.dist ASC so the closest association(s) appear first.\n\n8) Performance considerations\n- The filter on xmatch.oid drastically reduces rows before the join.\n- The equality join on allwise.oid_catalog uses the allwise primary key index.\n- No Q3C spatial functions are needed because the spatial association is already encoded in xmatch.\n\n9) Expected results and edge cases\n- If a crossmatch exists: the query returns one or more rows with all columns from allwise for the matched catalog entries.\n- If no crossmatch exists for this oid in AllWISE: the query returns zero rows.\n\n10) Final assembly\n- FROM xmatch (aliased, e.g., xm)\n- INNER JOIN allwise (aliased, e.g., aw) ON xm.oid_catalog = aw.oid_catalog\n- WHERE xm.oid = 'ZTF21aazqwxv'\n- SELECT aw.* (and optionally DISTINCT or ORDER BY xm.dist, or LIMIT 1 as needed)\n\nNotes\n- The probability and object tables are not required for this task; therefore, the default probability conditions do not apply.\n- No additional columns were requested, so only allwise.* should be returned even though the xmatch table is used for joining."
                },
                "in_toks": 2838,
                "out_toks": 3141,
                "id": "chatcmpl-CZZpKRANJJ7UrhYNn3j8bDusFVYEz",
                "created": 1762595234,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all columns in the 'allwise' table for the ZTF object 'ZTF21aazqwxv'\nSELECT aw.*\nFROM xmatch AS xm\nINNER JOIN allwise AS aw\n    ON aw.oid_catalog = xm.oid_catalog\nWHERE xm.oid = 'ZTF21aazqwxv';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns in the 'allwise' table for the ZTF object 'ZTF21aazqwxv'\nSELECT aw.*\nFROM xmatch AS xm\nINNER JOIN allwise AS aw\n    ON aw.oid_catalog = xm.oid_catalog\nWHERE xm.oid = 'ZTF21aazqwxv';\n```"
                },
                "in_toks": 2969,
                "out_toks": 1426,
                "id": "chatcmpl-CZaxvjriE63AU75zS2DESrecE9uFQ",
                "created": 1762599611,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "84": {
        "0": {
            "req_id": "84",
            "experiment_id": "run_0",
            "pred_tables": [
                "allwise",
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise', 'xmatch']",
                    "1": "['object', 'xmatch', 'allwise']"
                },
                "in_toks": 632,
                "out_toks": 1445,
                "id": "chatcmpl-CSnZkVySUssDCrjQ8EzxQ2udwwqoW",
                "created": 1760979788,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1255,
                "out_toks": 463,
                "id": "chatcmpl-CSnpFWWQmftxrevdOOrwHa8bQ0hvA",
                "created": 1760980749,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- For the ZTF object 'ZTF19aascdol', return for its AllWISE match(es): the ZTF identifier, the AllWISE catalog identifier, the distance between counterparts (arcsec), and the WISE magnitudes W1\u2013W4.\n\nRelevant tables and columns\n- xmatch\n  - oid: ZTF object Id (VARCHAR)\n  - catid: Catalog name (VARCHAR)\n  - oid_catalog: Object Id in the external catalog (VARCHAR)\n  - dist: Angular separation to the ZTF object in arcseconds (DOUBLE PRECISION)\n  - class_catalog, period: not needed here\n- allwise\n  - oid_catalog: AllWISE object Id (VARCHAR, PRIMARY KEY)\n  - ra, dec: not required for this request\n  - w1mpro, w2mpro, w3mpro, w4mpro: WISE W1\u2013W4 magnitudes (DOUBLE PRECISION)\n  - w1sigmpro, w2sigmpro, w3sigmpro, w4sigmpro, 2MASS columns: not required here\n\nAssumptions and constraints\n- We only want AllWISE matches. Instead of relying on xmatch.catid string values (which may vary), constrain to AllWISE by INNER JOIN with the allwise table on oid_catalog. This guarantees we only return AllWISE matches for the given ZTF object.\n- Return all matches if there are multiple counterparts.\n- No probability or classifier information is needed; do not involve the probability table.\n- No sky-region filtering/Q3C is needed; we use the existing crossmatch.\n- Keep units: xmatch.dist is in arcseconds as stored.\n\nInputs\n- The specific ZTF object OID string: 'ZTF19aascdol'.\n\nStep-by-step plan\n1) Establish the base filter on the ZTF object:\n   - FROM xmatch xm\n   - WHERE xm.oid = 'ZTF19aascdol'\n\n2) Restrict to AllWISE matches by joining to the AllWISE catalog table:\n   - INNER JOIN allwise aw ON aw.oid_catalog = xm.oid_catalog\n   - This join ensures only entries with a corresponding AllWISE counterpart are returned.\n\n3) Select the required output columns:\n   - ZTF identifier: xm.oid\n   - AllWISE catalog identifier: aw.oid_catalog (equivalently xm.oid_catalog; choose the AllWISE table\u2019s primary key for clarity)\n   - Distance between counterparts (arcsec): xm.dist\n   - WISE magnitudes:\n     - aw.w1mpro as W1\n     - aw.w2mpro as W2\n     - aw.w3mpro as W3\n     - aw.w4mpro as W4\n   - Optional: include xm.catid to explicitly show the catalog name in the result, though it\u2019s not strictly necessary.\n\n4) Apply ordering for readability (optional but recommended):\n   - ORDER BY xm.dist ASC to list the closest match first.\n\n5) Do not apply LIMIT, so that all AllWISE match(es) for the object are returned. If the user later requests only the nearest counterpart, add LIMIT 1.\n\n6) No additional filters are required. Do not involve the probability or object tables. Do not use Q3C functions, as we are not performing a new spatial match.\n\n7) Aliasing for clarity (optional):\n   - Alias selected columns to user-friendly names, e.g., ztf_oid, allwise_oid, distance_arcsec, W1, W2, W3, W4.\n\n8) Validate edge cases:\n   - If no AllWISE match exists for this ZTF object, the query will return zero rows (expected behavior).\n   - Some WISE magnitudes may be NULL if unavailable or upper limits; return as-is.\n\nPerformance notes\n- The join uses allwise.oid_catalog (PRIMARY KEY), which is efficient. The filter on xm.oid is a simple equality predicate. No spatial indices or Q3C functions are needed.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- For the ZTF object 'ZTF19aascdol', return for its AllWISE match(es): the ZTF identifier, the AllWISE catalog identifier, the distance between counterparts (arcsec), and the WISE magnitudes W1\u2013W4.\n\nRelevant tables and columns\n- xmatch\n  - oid: ZTF object Id (VARCHAR)\n  - catid: Catalog name (VARCHAR)\n  - oid_catalog: Object Id in the external catalog (VARCHAR)\n  - dist: Angular separation to the ZTF object in arcseconds (DOUBLE PRECISION)\n  - class_catalog, period: not needed here\n- allwise\n  - oid_catalog: AllWISE object Id (VARCHAR, PRIMARY KEY)\n  - ra, dec: not required for this request\n  - w1mpro, w2mpro, w3mpro, w4mpro: WISE W1\u2013W4 magnitudes (DOUBLE PRECISION)\n  - w1sigmpro, w2sigmpro, w3sigmpro, w4sigmpro, 2MASS columns: not required here\n\nAssumptions and constraints\n- We only want AllWISE matches. Instead of relying on xmatch.catid string values (which may vary), constrain to AllWISE by INNER JOIN with the allwise table on oid_catalog. This guarantees we only return AllWISE matches for the given ZTF object.\n- Return all matches if there are multiple counterparts.\n- No probability or classifier information is needed; do not involve the probability table.\n- No sky-region filtering/Q3C is needed; we use the existing crossmatch.\n- Keep units: xmatch.dist is in arcseconds as stored.\n\nInputs\n- The specific ZTF object OID string: 'ZTF19aascdol'.\n\nStep-by-step plan\n1) Establish the base filter on the ZTF object:\n   - FROM xmatch xm\n   - WHERE xm.oid = 'ZTF19aascdol'\n\n2) Restrict to AllWISE matches by joining to the AllWISE catalog table:\n   - INNER JOIN allwise aw ON aw.oid_catalog = xm.oid_catalog\n   - This join ensures only entries with a corresponding AllWISE counterpart are returned.\n\n3) Select the required output columns:\n   - ZTF identifier: xm.oid\n   - AllWISE catalog identifier: aw.oid_catalog (equivalently xm.oid_catalog; choose the AllWISE table\u2019s primary key for clarity)\n   - Distance between counterparts (arcsec): xm.dist\n   - WISE magnitudes:\n     - aw.w1mpro as W1\n     - aw.w2mpro as W2\n     - aw.w3mpro as W3\n     - aw.w4mpro as W4\n   - Optional: include xm.catid to explicitly show the catalog name in the result, though it\u2019s not strictly necessary.\n\n4) Apply ordering for readability (optional but recommended):\n   - ORDER BY xm.dist ASC to list the closest match first.\n\n5) Do not apply LIMIT, so that all AllWISE match(es) for the object are returned. If the user later requests only the nearest counterpart, add LIMIT 1.\n\n6) No additional filters are required. Do not involve the probability or object tables. Do not use Q3C functions, as we are not performing a new spatial match.\n\n7) Aliasing for clarity (optional):\n   - Alias selected columns to user-friendly names, e.g., ztf_oid, allwise_oid, distance_arcsec, W1, W2, W3, W4.\n\n8) Validate edge cases:\n   - If no AllWISE match exists for this ZTF object, the query will return zero rows (expected behavior).\n   - Some WISE magnitudes may be NULL if unavailable or upper limits; return as-is.\n\nPerformance notes\n- The join uses allwise.oid_catalog (PRIMARY KEY), which is efficient. The filter on xm.oid is a simple equality predicate. No spatial indices or Q3C functions are needed."
                },
                "in_toks": 2882,
                "out_toks": 2771,
                "id": "chatcmpl-CSqsu6Ajq1xp0b535OkI2QDbhBcB0",
                "created": 1760992508,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return AllWISE match(es) for the specified ZTF object with ZTF and AllWISE identifiers,\n-- separation distance (arcsec), and WISE W1\u2013W4 magnitudes.\nSELECT\n    xm.oid,\n    aw.oid_catalog,\n    xm.dist,\n    aw.w1mpro,\n    aw.w2mpro,\n    aw.w3mpro,\n    aw.w4mpro\nFROM xmatch AS xm\nINNER JOIN allwise AS aw\n    ON aw.oid_catalog = xm.oid_catalog  -- ensures only AllWISE matches\nWHERE xm.oid = 'ZTF19aascdol'\nORDER BY xm.dist ASC;  -- closest counterpart first\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return AllWISE match(es) for the specified ZTF object with ZTF and AllWISE identifiers,\n-- separation distance (arcsec), and WISE W1\u2013W4 magnitudes.\nSELECT\n    xm.oid,\n    aw.oid_catalog,\n    xm.dist,\n    aw.w1mpro,\n    aw.w2mpro,\n    aw.w3mpro,\n    aw.w4mpro\nFROM xmatch AS xm\nINNER JOIN allwise AS aw\n    ON aw.oid_catalog = xm.oid_catalog  -- ensures only AllWISE matches\nWHERE xm.oid = 'ZTF19aascdol'\nORDER BY xm.dist ASC;  -- closest counterpart first\n```"
                },
                "in_toks": 2899,
                "out_toks": 1050,
                "id": "chatcmpl-CSr7JmGvDCWDHm81IhJqCrx5Pwl0F",
                "created": 1760993401,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "84",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['allwise', 'xmatch']",
                    "1": "['object', 'xmatch', 'allwise']"
                },
                "in_toks": 632,
                "out_toks": 1445,
                "id": "chatcmpl-CSnZkVySUssDCrjQ8EzxQ2udwwqoW",
                "created": 1760979788,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1737,
                "out_toks": 399,
                "id": "chatcmpl-CSnpNCLTLxGBtCCax55LzcDD52f0L",
                "created": 1760980757,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Identify the relevant tables and relationships\n- xmatch: holds cross-match entries between ZTF objects and external catalogs.\n  - Key columns needed: oid (ZTF identifier), oid_catalog (external catalog identifier), dist (match distance in arcsec), catid (catalog name).\n- allwise: holds photometric data for AllWISE catalog sources.\n  - Key columns needed: oid_catalog (primary key, matches xmatch.oid_catalog), w1mpro, w2mpro, w3mpro, w4mpro (WISE W1\u2013W4 magnitudes).\n- Note: xmatch.oid references object(oid), but object is not needed for the requested fields.\n\n2) Define the selection goal (columns to return)\n- ZTF identifier: xmatch.oid\n- AllWISE identifier: xmatch.oid_catalog (same as allwise.oid_catalog)\n- Match distance: xmatch.dist (in arcseconds)\n- WISE magnitudes:\n  - W1: allwise.w1mpro\n  - W2: allwise.w2mpro\n  - W3: allwise.w3mpro\n  - W4: allwise.w4mpro\n\n3) Establish the base table and joins\n- Start from xmatch, because the filter is by ZTF object ID.\n- INNER JOIN allwise ON xmatch.oid_catalog = allwise.oid_catalog to retrieve the WISE magnitudes for the matched AllWISE counterpart(s).\n- This join inherently restricts to AllWISE matches; an explicit catalog-name filter on xmatch is optional.\n\n4) Apply filters (WHERE conditions)\n- Filter by the requested ZTF object: xmatch.oid = 'ZTF19aascdol'.\n- Optional: If you want to explicitly restrict to the AllWISE catalog in xmatch, add xmatch.catid = 'allwise'. This is not strictly necessary when joining to allwise, but can be included for clarity if the catid value is known to be exactly 'allwise'.\n\n5) Ordering (optional but helpful)\n- Order by xmatch.dist ASC to list the closest AllWISE match first if multiple counterparts exist.\n\n6) Handle duplicates and completeness\n- Typically, one ZTF object may have zero, one, or multiple AllWISE matches; the INNER JOIN will return one row per match.\n- No DISTINCT is required unless you observe duplicate oid_catalog entries.\n- Leave magnitude fields as-is; allwise.wXmpro can be NULL if the source is not measured or only an upper limit is available.\n\n7) Performance and indexing considerations\n- allwise.oid_catalog is a PRIMARY KEY, so joining on it is efficient.\n- Filtering on xmatch.oid should be efficient if an index exists on that column; if not, expect a scan limited by a very selective equality predicate.\n- Adding xmatch.catid = 'allwise' (if correct) may further reduce rows early, but it\u2019s optional due to the inner join to allwise.\n\n8) Final result structure\n- One row per AllWISE counterpart matched to ZTF19aascdol, with:\n  - xmatch.oid as ztf_oid\n  - xmatch.oid_catalog as allwise_oid\n  - xmatch.dist as match_dist_arcsec\n  - allwise.w1mpro as W1\n  - allwise.w2mpro as W2\n  - allwise.w3mpro as W3\n  - allwise.w4mpro as W4\n\n9) Notes\n- No probability table is involved; default probability conditions are not applicable.\n- No spatial Q3C functions are needed because the match is precomputed in xmatch.\n- Units: dist is in arcseconds as stored in xmatch.dist.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Identify the relevant tables and relationships\n- xmatch: holds cross-match entries between ZTF objects and external catalogs.\n  - Key columns needed: oid (ZTF identifier), oid_catalog (external catalog identifier), dist (match distance in arcsec), catid (catalog name).\n- allwise: holds photometric data for AllWISE catalog sources.\n  - Key columns needed: oid_catalog (primary key, matches xmatch.oid_catalog), w1mpro, w2mpro, w3mpro, w4mpro (WISE W1\u2013W4 magnitudes).\n- Note: xmatch.oid references object(oid), but object is not needed for the requested fields.\n\n2) Define the selection goal (columns to return)\n- ZTF identifier: xmatch.oid\n- AllWISE identifier: xmatch.oid_catalog (same as allwise.oid_catalog)\n- Match distance: xmatch.dist (in arcseconds)\n- WISE magnitudes:\n  - W1: allwise.w1mpro\n  - W2: allwise.w2mpro\n  - W3: allwise.w3mpro\n  - W4: allwise.w4mpro\n\n3) Establish the base table and joins\n- Start from xmatch, because the filter is by ZTF object ID.\n- INNER JOIN allwise ON xmatch.oid_catalog = allwise.oid_catalog to retrieve the WISE magnitudes for the matched AllWISE counterpart(s).\n- This join inherently restricts to AllWISE matches; an explicit catalog-name filter on xmatch is optional.\n\n4) Apply filters (WHERE conditions)\n- Filter by the requested ZTF object: xmatch.oid = 'ZTF19aascdol'.\n- Optional: If you want to explicitly restrict to the AllWISE catalog in xmatch, add xmatch.catid = 'allwise'. This is not strictly necessary when joining to allwise, but can be included for clarity if the catid value is known to be exactly 'allwise'.\n\n5) Ordering (optional but helpful)\n- Order by xmatch.dist ASC to list the closest AllWISE match first if multiple counterparts exist.\n\n6) Handle duplicates and completeness\n- Typically, one ZTF object may have zero, one, or multiple AllWISE matches; the INNER JOIN will return one row per match.\n- No DISTINCT is required unless you observe duplicate oid_catalog entries.\n- Leave magnitude fields as-is; allwise.wXmpro can be NULL if the source is not measured or only an upper limit is available.\n\n7) Performance and indexing considerations\n- allwise.oid_catalog is a PRIMARY KEY, so joining on it is efficient.\n- Filtering on xmatch.oid should be efficient if an index exists on that column; if not, expect a scan limited by a very selective equality predicate.\n- Adding xmatch.catid = 'allwise' (if correct) may further reduce rows early, but it\u2019s optional due to the inner join to allwise.\n\n8) Final result structure\n- One row per AllWISE counterpart matched to ZTF19aascdol, with:\n  - xmatch.oid as ztf_oid\n  - xmatch.oid_catalog as allwise_oid\n  - xmatch.dist as match_dist_arcsec\n  - allwise.w1mpro as W1\n  - allwise.w2mpro as W2\n  - allwise.w3mpro as W3\n  - allwise.w4mpro as W4\n\n9) Notes\n- No probability table is involved; default probability conditions are not applicable.\n- No spatial Q3C functions are needed because the match is precomputed in xmatch.\n- Units: dist is in arcseconds as stored in xmatch.dist."
                },
                "in_toks": 3364,
                "out_toks": 2902,
                "id": "chatcmpl-CSqssMRkUWSqPTk7jvg3BCT0S4Ll3",
                "created": 1760992506,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- ALLWISE matches for a specific ZTF object with identifiers, match distance, and WISE W1\u2013W4 magnitudes\nSELECT\n    xmatch.oid,\n    xmatch.oid_catalog,\n    xmatch.dist,\n    allwise.w1mpro,\n    allwise.w2mpro,\n    allwise.w3mpro,\n    allwise.w4mpro\nFROM xmatch\nINNER JOIN allwise\n    ON xmatch.oid_catalog = allwise.oid_catalog\nWHERE xmatch.oid = 'ZTF19aascdol'\nORDER BY xmatch.dist ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE matches for a specific ZTF object with identifiers, match distance, and WISE W1\u2013W4 magnitudes\nSELECT\n    xmatch.oid,\n    xmatch.oid_catalog,\n    xmatch.dist,\n    allwise.w1mpro,\n    allwise.w2mpro,\n    allwise.w3mpro,\n    allwise.w4mpro\nFROM xmatch\nINNER JOIN allwise\n    ON xmatch.oid_catalog = allwise.oid_catalog\nWHERE xmatch.oid = 'ZTF19aascdol'\nORDER BY xmatch.dist ASC;\n```"
                },
                "in_toks": 2838,
                "out_toks": 1096,
                "id": "chatcmpl-CSr7tQvKLjcAiwP4Fg4rOjxCvtOmX",
                "created": 1760993437,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "84",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'xmatch', 'allwise']"
                },
                "in_toks": 632,
                "out_toks": 468,
                "id": "chatcmpl-CSsoysomzGVO1BOkSTJxQpIopjvdZ",
                "created": 1760999952,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1737,
                "out_toks": 463,
                "id": "chatcmpl-CSxabUoRe3rGlKg8UtOM0A007MC4x",
                "created": 1761018281,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the SQL query\n\n1) Clarify the user goal\n- Retrieve, for the ZTF object ZTF19aascdol, the information about its ALLWISE cross-match(es):\n  - Identifier in ZTF (ZTF oid)\n  - Identifier in the ALLWISE catalog (ALLWISE oid_catalog)\n  - Angular separation between the counterparts (distance)\n  - WISE magnitudes in filters W1, W2, W3, W4\n- Return all ALLWISE matches if multiple exist.\n\n2) Identify relevant tables and columns\n- xmatch: provides cross-match links and separations\n  - Columns needed: xmatch.oid (ZTF identifier), xmatch.oid_catalog (catalog identifier), xmatch.dist (separation in arcsec), xmatch.catid (catalog name; optional for validation)\n- allwise: provides photometry and positions for ALLWISE sources\n  - Columns needed: allwise.oid_catalog (join key), allwise.w1mpro, allwise.w2mpro, allwise.w3mpro, allwise.w4mpro\n- object: not required for this retrieval, since we filter by xmatch.oid directly\n- probability: not required (no classification filtering involved)\n\n3) Define filters and join logic\n- Primary filter:\n  - xmatch.oid = 'ZTF19aascdol'\n- Catalog scoping:\n  - Restrict to ALLWISE matches by performing an INNER JOIN to allwise ON xmatch.oid_catalog = allwise.oid_catalog. This inherently limits results to entries with an ALLWISE record.\n  - If additionally validating the catalog label is desired, include xmatch.catid = '<exact AllWISE catalog name if known>'. If the exact literal is unknown, omit this filter and rely on the join.\n- Join:\n  - INNER JOIN allwise ON xmatch.oid_catalog = allwise.oid_catalog\n  - This uses the primary key on allwise.oid_catalog for efficient lookup.\n\n4) Select list (only the columns explicitly requested)\n- xmatch.oid AS the ZTF identifier\n- xmatch.oid_catalog AS the ALLWISE catalog identifier\n- xmatch.dist AS the angular separation in arcseconds\n- allwise.w1mpro AS W1 magnitude\n- allwise.w2mpro AS W2 magnitude\n- allwise.w3mpro AS W3 magnitude\n- allwise.w4mpro AS W4 magnitude\n- Note: \u201cfilters W1 to W4\u201d correspond to columns allwise.w1mpro, allwise.w2mpro, allwise.w3mpro, allwise.w4mpro.\n\n5) Row ordering\n- Order results by xmatch.dist ASC to present the closest match first.\n\n6) Handling of multiple or zero matches\n- The query should return:\n  - Zero rows if there is no ALLWISE match for the given ZTF object in xmatch.\n  - One or more rows if multiple ALLWISE entries are associated; do not deduplicate unless the same oid_catalog appears more than once (unlikely given allwise.oid_catalog is PRIMARY KEY).\n- No LIMIT is applied, as the user requested \u201cmatch(es).\u201d\n\n7) Performance and indexing considerations\n- Filter by xmatch.oid should be efficient if xmatch.oid is indexed (not shown, but typical).\n- The join on allwise.oid_catalog will be efficient due to allwise.oid_catalog PRIMARY KEY.\n- No Q3C spatial functions are needed because the linkage is via catalog cross-match and not a spatial cone search.\n\n8) Optional diagnostics (not required but useful)\n- If you want to verify the catalog source, you can also select xmatch.catid in the result for validation (not strictly required by the user).\n- If you want to include positions, add allwise.ra and allwise.dec (not requested).\n\n9) No default classifier/probability conditions\n- Do not include probability table or its default conditions, as classification is not part of this request.\n\n10) Final structure summary (no SQL, just structure)\n- FROM xmatch (aliased, e.g., x)\n- INNER JOIN allwise (aliased, e.g., a) ON x.oid_catalog = a.oid_catalog\n- WHERE x.oid = 'ZTF19aascdol'\n- SELECT: x.oid, x.oid_catalog, x.dist, a.w1mpro, a.w2mpro, a.w3mpro, a.w4mpro\n- ORDER BY x.dist ASC",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the SQL query\n\n1) Clarify the user goal\n- Retrieve, for the ZTF object ZTF19aascdol, the information about its ALLWISE cross-match(es):\n  - Identifier in ZTF (ZTF oid)\n  - Identifier in the ALLWISE catalog (ALLWISE oid_catalog)\n  - Angular separation between the counterparts (distance)\n  - WISE magnitudes in filters W1, W2, W3, W4\n- Return all ALLWISE matches if multiple exist.\n\n2) Identify relevant tables and columns\n- xmatch: provides cross-match links and separations\n  - Columns needed: xmatch.oid (ZTF identifier), xmatch.oid_catalog (catalog identifier), xmatch.dist (separation in arcsec), xmatch.catid (catalog name; optional for validation)\n- allwise: provides photometry and positions for ALLWISE sources\n  - Columns needed: allwise.oid_catalog (join key), allwise.w1mpro, allwise.w2mpro, allwise.w3mpro, allwise.w4mpro\n- object: not required for this retrieval, since we filter by xmatch.oid directly\n- probability: not required (no classification filtering involved)\n\n3) Define filters and join logic\n- Primary filter:\n  - xmatch.oid = 'ZTF19aascdol'\n- Catalog scoping:\n  - Restrict to ALLWISE matches by performing an INNER JOIN to allwise ON xmatch.oid_catalog = allwise.oid_catalog. This inherently limits results to entries with an ALLWISE record.\n  - If additionally validating the catalog label is desired, include xmatch.catid = '<exact AllWISE catalog name if known>'. If the exact literal is unknown, omit this filter and rely on the join.\n- Join:\n  - INNER JOIN allwise ON xmatch.oid_catalog = allwise.oid_catalog\n  - This uses the primary key on allwise.oid_catalog for efficient lookup.\n\n4) Select list (only the columns explicitly requested)\n- xmatch.oid AS the ZTF identifier\n- xmatch.oid_catalog AS the ALLWISE catalog identifier\n- xmatch.dist AS the angular separation in arcseconds\n- allwise.w1mpro AS W1 magnitude\n- allwise.w2mpro AS W2 magnitude\n- allwise.w3mpro AS W3 magnitude\n- allwise.w4mpro AS W4 magnitude\n- Note: \u201cfilters W1 to W4\u201d correspond to columns allwise.w1mpro, allwise.w2mpro, allwise.w3mpro, allwise.w4mpro.\n\n5) Row ordering\n- Order results by xmatch.dist ASC to present the closest match first.\n\n6) Handling of multiple or zero matches\n- The query should return:\n  - Zero rows if there is no ALLWISE match for the given ZTF object in xmatch.\n  - One or more rows if multiple ALLWISE entries are associated; do not deduplicate unless the same oid_catalog appears more than once (unlikely given allwise.oid_catalog is PRIMARY KEY).\n- No LIMIT is applied, as the user requested \u201cmatch(es).\u201d\n\n7) Performance and indexing considerations\n- Filter by xmatch.oid should be efficient if xmatch.oid is indexed (not shown, but typical).\n- The join on allwise.oid_catalog will be efficient due to allwise.oid_catalog PRIMARY KEY.\n- No Q3C spatial functions are needed because the linkage is via catalog cross-match and not a spatial cone search.\n\n8) Optional diagnostics (not required but useful)\n- If you want to verify the catalog source, you can also select xmatch.catid in the result for validation (not strictly required by the user).\n- If you want to include positions, add allwise.ra and allwise.dec (not requested).\n\n9) No default classifier/probability conditions\n- Do not include probability table or its default conditions, as classification is not part of this request.\n\n10) Final structure summary (no SQL, just structure)\n- FROM xmatch (aliased, e.g., x)\n- INNER JOIN allwise (aliased, e.g., a) ON x.oid_catalog = a.oid_catalog\n- WHERE x.oid = 'ZTF19aascdol'\n- SELECT: x.oid, x.oid_catalog, x.dist, a.w1mpro, a.w2mpro, a.w3mpro, a.w4mpro\n- ORDER BY x.dist ASC"
                },
                "in_toks": 3364,
                "out_toks": 2801,
                "id": "chatcmpl-CSxmSNucBQ7sp3Sbvr4Q00QEy708o",
                "created": 1761019016,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- ALLWISE matches for the ZTF object ZTF19aascdol with separations and W1\u2013W4 magnitudes\nSELECT\n    x.oid,                -- ZTF identifier\n    x.oid_catalog,        -- ALLWISE catalog identifier\n    x.dist,               -- angular separation (arcsec)\n    a.w1mpro,             -- WISE W1 magnitude\n    a.w2mpro,             -- WISE W2 magnitude\n    a.w3mpro,             -- WISE W3 magnitude\n    a.w4mpro              -- WISE W4 magnitude\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON x.oid_catalog = a.oid_catalog\nWHERE x.oid = 'ZTF19aascdol'\nORDER BY x.dist ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE matches for the ZTF object ZTF19aascdol with separations and W1\u2013W4 magnitudes\nSELECT\n    x.oid,                -- ZTF identifier\n    x.oid_catalog,        -- ALLWISE catalog identifier\n    x.dist,               -- angular separation (arcsec)\n    a.w1mpro,             -- WISE W1 magnitude\n    a.w2mpro,             -- WISE W2 magnitude\n    a.w3mpro,             -- WISE W3 magnitude\n    a.w4mpro              -- WISE W4 magnitude\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON x.oid_catalog = a.oid_catalog\nWHERE x.oid = 'ZTF19aascdol'\nORDER BY x.dist ASC;\n```"
                },
                "in_toks": 2994,
                "out_toks": 1205,
                "id": "chatcmpl-CSyS51rtgWKBzBLQKkrowrBSfMINN",
                "created": 1761021597,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "84",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'xmatch', 'allwise']"
                },
                "in_toks": 632,
                "out_toks": 596,
                "id": "chatcmpl-CSsp4S7zNq10b1lFS8NUzSqKcZkTt",
                "created": 1760999958,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1737,
                "out_toks": 399,
                "id": "chatcmpl-CSxagGuqiTDp981JOpEYw40x3eVW9",
                "created": 1761018286,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- For the ZTF object ZTF19aascdol, retrieve information about its crossmatch(es) to the AllWISE catalog:\n  - ZTF identifier\n  - Catalog identifier (in AllWISE)\n  - Distance between counterparts (arcseconds)\n  - WISE magnitudes W1, W2, W3, W4\n\nRelevant tables and columns\n- xmatch\n  - oid (ZTF object identifier; FK to object.oid)\n  - catid (catalog identifier/name; for this task filter to the AllWISE catalog)\n  - oid_catalog (identifier in the external catalog; this will match allwise.oid_catalog)\n  - dist (distance to closest ZTF object in arcseconds)\n  - class_catalog (not needed here)\n  - period (not needed here)\n\n- allwise\n  - oid_catalog (PK; identifier in AllWISE, same code as xmatch.oid_catalog)\n  - ra, dec (not required here)\n  - w1mpro, w2mpro, w3mpro, w4mpro (WISE W1\u2013W4 profile-fit magnitudes)\n  - w1sigmpro, w2sigmpro, w3sigmpro, w4sigmpro (uncertainties; not required unless requested)\n\n- object\n  - oid (PK; ZTF object ID)\n  - Not required for this specific output since oid is provided, but can be used as an anchor if desired.\n\nInputs and assumptions\n- Input ZTF object ID: 'ZTF19aascdol'\n- Catalog filter: xmatch.catid = 'ALLWISE' (use this exact value to refer to the AllWISE catalog)\n- Units:\n  - xmatch.dist is in arcseconds\n  - allwise W1\u2013W4 magnitudes are the profile-fit magnitudes (w1mpro, w2mpro, w3mpro, w4mpro)\n\nStep-by-step plan\n1) Parameterize the target ZTF object\n   - Set a parameter (e.g., :ztf_oid) to 'ZTF19aascdol'\n\n2) Identify AllWISE crossmatches for the target object\n   - From the xmatch table, filter rows where:\n     - xmatch.oid = :ztf_oid\n     - xmatch.catid = 'ALLWISE'\n   - Columns needed at this stage:\n     - xmatch.oid (ZTF identifier)\n     - xmatch.oid_catalog (AllWISE catalog identifier)\n     - xmatch.dist (distance in arcseconds)\n\n3) Join to AllWISE catalog entries to retrieve WISE magnitudes\n   - Perform an INNER JOIN between the filtered xmatch rows and allwise on:\n     - xmatch.oid_catalog = allwise.oid_catalog\n   - This join is required to access the W1\u2013W4 magnitudes\n\n4) Select the required output columns\n   - ZTF identifier: xmatch.oid\n   - AllWISE catalog identifier: xmatch.oid_catalog (equivalently allwise.oid_catalog)\n   - Distance between counterparts (arcseconds): xmatch.dist\n   - Magnitudes:\n     - W1: allwise.w1mpro\n     - W2: allwise.w2mpro\n     - W3: allwise.w3mpro\n     - W4: allwise.w4mpro\n\n5) Handle multiple matches and ordering\n   - Return all matching rows (no LIMIT), because the request allows for multiple matches (\u201cmatch(es)\u201d)\n   - Order the results by ascending distance to list the closest counterpart first:\n     - ORDER BY xmatch.dist ASC\n\n6) Optional validations or refinements\n   - If there is any uncertainty about the exact catalog name used in xmatch.catid, first check distinct catid values for this oid; otherwise proceed with catid = 'ALLWISE'\n   - Use an INNER JOIN to ensure rows have WISE magnitudes; if you want to see crossmatch rows even when AllWISE magnitudes are missing, use a LEFT JOIN instead (not needed by default)\n   - No need for Q3C spatial functions because the xmatch table already provides the crossmatch pairs and distances\n\n7) Final dataset characteristics\n   - One row per AllWISE counterpart associated to ZTF19aascdol\n   - Columns:\n     - oid (ZTF object ID)\n     - oid_catalog (AllWISE ID)\n     - dist (arcseconds)\n     - w1mpro, w2mpro, w3mpro, w4mpro (WISE magnitudes W1\u2013W4)\n   - Sorted by dist ascending\n\nNotes\n- The probability table is not needed for this request; therefore, default probability filters are not applicable here.\n- Keep exact table and column names as specified:\n  - Tables: xmatch, allwise\n  - Columns: oid, catid, oid_catalog, dist, w1mpro, w2mpro, w3mpro, w4mpro\n- The object table is not required since the ZTF oid is known, but could be included as an anchor join if desired.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- For the ZTF object ZTF19aascdol, retrieve information about its crossmatch(es) to the AllWISE catalog:\n  - ZTF identifier\n  - Catalog identifier (in AllWISE)\n  - Distance between counterparts (arcseconds)\n  - WISE magnitudes W1, W2, W3, W4\n\nRelevant tables and columns\n- xmatch\n  - oid (ZTF object identifier; FK to object.oid)\n  - catid (catalog identifier/name; for this task filter to the AllWISE catalog)\n  - oid_catalog (identifier in the external catalog; this will match allwise.oid_catalog)\n  - dist (distance to closest ZTF object in arcseconds)\n  - class_catalog (not needed here)\n  - period (not needed here)\n\n- allwise\n  - oid_catalog (PK; identifier in AllWISE, same code as xmatch.oid_catalog)\n  - ra, dec (not required here)\n  - w1mpro, w2mpro, w3mpro, w4mpro (WISE W1\u2013W4 profile-fit magnitudes)\n  - w1sigmpro, w2sigmpro, w3sigmpro, w4sigmpro (uncertainties; not required unless requested)\n\n- object\n  - oid (PK; ZTF object ID)\n  - Not required for this specific output since oid is provided, but can be used as an anchor if desired.\n\nInputs and assumptions\n- Input ZTF object ID: 'ZTF19aascdol'\n- Catalog filter: xmatch.catid = 'ALLWISE' (use this exact value to refer to the AllWISE catalog)\n- Units:\n  - xmatch.dist is in arcseconds\n  - allwise W1\u2013W4 magnitudes are the profile-fit magnitudes (w1mpro, w2mpro, w3mpro, w4mpro)\n\nStep-by-step plan\n1) Parameterize the target ZTF object\n   - Set a parameter (e.g., :ztf_oid) to 'ZTF19aascdol'\n\n2) Identify AllWISE crossmatches for the target object\n   - From the xmatch table, filter rows where:\n     - xmatch.oid = :ztf_oid\n     - xmatch.catid = 'ALLWISE'\n   - Columns needed at this stage:\n     - xmatch.oid (ZTF identifier)\n     - xmatch.oid_catalog (AllWISE catalog identifier)\n     - xmatch.dist (distance in arcseconds)\n\n3) Join to AllWISE catalog entries to retrieve WISE magnitudes\n   - Perform an INNER JOIN between the filtered xmatch rows and allwise on:\n     - xmatch.oid_catalog = allwise.oid_catalog\n   - This join is required to access the W1\u2013W4 magnitudes\n\n4) Select the required output columns\n   - ZTF identifier: xmatch.oid\n   - AllWISE catalog identifier: xmatch.oid_catalog (equivalently allwise.oid_catalog)\n   - Distance between counterparts (arcseconds): xmatch.dist\n   - Magnitudes:\n     - W1: allwise.w1mpro\n     - W2: allwise.w2mpro\n     - W3: allwise.w3mpro\n     - W4: allwise.w4mpro\n\n5) Handle multiple matches and ordering\n   - Return all matching rows (no LIMIT), because the request allows for multiple matches (\u201cmatch(es)\u201d)\n   - Order the results by ascending distance to list the closest counterpart first:\n     - ORDER BY xmatch.dist ASC\n\n6) Optional validations or refinements\n   - If there is any uncertainty about the exact catalog name used in xmatch.catid, first check distinct catid values for this oid; otherwise proceed with catid = 'ALLWISE'\n   - Use an INNER JOIN to ensure rows have WISE magnitudes; if you want to see crossmatch rows even when AllWISE magnitudes are missing, use a LEFT JOIN instead (not needed by default)\n   - No need for Q3C spatial functions because the xmatch table already provides the crossmatch pairs and distances\n\n7) Final dataset characteristics\n   - One row per AllWISE counterpart associated to ZTF19aascdol\n   - Columns:\n     - oid (ZTF object ID)\n     - oid_catalog (AllWISE ID)\n     - dist (arcseconds)\n     - w1mpro, w2mpro, w3mpro, w4mpro (WISE magnitudes W1\u2013W4)\n   - Sorted by dist ascending\n\nNotes\n- The probability table is not needed for this request; therefore, default probability filters are not applicable here.\n- Keep exact table and column names as specified:\n  - Tables: xmatch, allwise\n  - Columns: oid, catid, oid_catalog, dist, w1mpro, w2mpro, w3mpro, w4mpro\n- The object table is not required since the ZTF oid is known, but could be included as an anchor join if desired."
                },
                "in_toks": 3364,
                "out_toks": 3319,
                "id": "chatcmpl-CSxmy1bTrD98xiI8wSBkNXHzpWnkF",
                "created": 1761019048,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- ALLWISE crossmatches for a given ZTF object with WISE W1\u2013W4 magnitudes\nSELECT\n    xmatch.oid,               -- ZTF object identifier\n    xmatch.oid_catalog,       -- ALLWISE catalog identifier\n    xmatch.dist,              -- distance between counterparts (arcseconds)\n    allwise.w1mpro,           -- WISE W1 magnitude\n    allwise.w2mpro,           -- WISE W2 magnitude\n    allwise.w3mpro,           -- WISE W3 magnitude\n    allwise.w4mpro            -- WISE W4 magnitude\nFROM xmatch\nINNER JOIN allwise\n    ON xmatch.oid_catalog = allwise.oid_catalog\nWHERE xmatch.oid = 'ZTF19aascdol'\n  AND xmatch.catid = 'ALLWISE'\nORDER BY xmatch.dist ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE crossmatches for a given ZTF object with WISE W1\u2013W4 magnitudes\nSELECT\n    xmatch.oid,               -- ZTF object identifier\n    xmatch.oid_catalog,       -- ALLWISE catalog identifier\n    xmatch.dist,              -- distance between counterparts (arcseconds)\n    allwise.w1mpro,           -- WISE W1 magnitude\n    allwise.w2mpro,           -- WISE W2 magnitude\n    allwise.w3mpro,           -- WISE W3 magnitude\n    allwise.w4mpro            -- WISE W4 magnitude\nFROM xmatch\nINNER JOIN allwise\n    ON xmatch.oid_catalog = allwise.oid_catalog\nWHERE xmatch.oid = 'ZTF19aascdol'\n  AND xmatch.catid = 'ALLWISE'\nORDER BY xmatch.dist ASC;\n```"
                },
                "in_toks": 3127,
                "out_toks": 1348,
                "id": "chatcmpl-CSySIMuLgy3mANQq0cyKv0J4I45XO",
                "created": 1761021610,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "84",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'xmatch', 'allwise']"
                },
                "in_toks": 632,
                "out_toks": 404,
                "id": "chatcmpl-CSspDBeyN8if4bXLB9dfG0PcDvMsa",
                "created": 1760999967,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1737,
                "out_toks": 655,
                "id": "chatcmpl-CSxam2Clr7NAGfaIuu5CsG6OLAmZR",
                "created": 1761018292,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query:\n\n1) Clarify the goal\n- Retrieve, for the ZTF object with oid = 'ZTF19aascdol', all cross-matches in the AllWISE catalog, returning:\n  - ZTF identifier (ZTF oid)\n  - AllWISE catalog identifier (oid_catalog in the AllWISE catalog)\n  - Angular separation between the counterparts (in arcseconds)\n  - AllWISE magnitudes in filters W1, W2, W3, and W4\n\n2) Identify the relevant tables and columns\n- xmatch table:\n  - oid (ZTF object identifier; filter on this)\n  - catid (catalog name; filter to the AllWISE catalog)\n  - oid_catalog (catalog-side identifier; join key into the AllWISE table)\n  - dist (separation to the closest ZTF object, in arcseconds; select this)\n- allwise table:\n  - oid_catalog (primary key; join key from xmatch)\n  - w1mpro, w2mpro, w3mpro, w4mpro (profile-fit magnitudes in W1\u2013W4; select these)\n- object table:\n  - Not required for this query since xmatch already carries the ZTF oid. Include only if you want to validate existence or add object-level metadata (not requested here).\n\n3) Define filtering conditions\n- Restrict to the requested ZTF object:\n  - xmatch.oid = 'ZTF19aascdol'\n- Restrict to AllWISE cross-matches:\n  - xmatch.catid = 'allwise' (use the exact literal used in your deployment for the AllWISE catalog; if unsure, verify or use a case-insensitive comparison)\n- No probability table is needed; therefore the default probability conditions do not apply.\n\n4) Define the join(s)\n- Inner join xmatch to allwise on the catalog identifier:\n  - xmatch.oid_catalog = allwise.oid_catalog\n- This ensures only cross-matches that exist in the allwise table are returned.\n\n5) Specify the selected columns (the user asked for specific fields, so do not use SELECT *)\n- From xmatch:\n  - xmatch.oid             (ZTF identifier)\n  - xmatch.oid_catalog     (AllWISE catalog identifier)\n  - xmatch.dist            (separation in arcseconds)\n- From allwise:\n  - allwise.w1mpro\n  - allwise.w2mpro\n  - allwise.w3mpro\n  - allwise.w4mpro\n\n6) Sorting (optional but recommended)\n- Order by the angular separation to present the closest match first:\n  - ORDER BY xmatch.dist ASC\n\n7) Handling multiple matches\n- The query should return all AllWISE matches for this ZTF object (if multiple exist). Do not aggregate or limit unless explicitly requested.\n- If you later need only the nearest match, add a per-oid ranking on xmatch.dist and filter to the top rank.\n\n8) Nullability and data caveats\n- The AllWISE magnitude columns (w1mpro\u2013w4mpro) may be NULL if unavailable or are upper limits under certain SNR conditions. Return as-is; the user did not request filtering on magnitude availability.\n- dist is already provided by xmatch in arcseconds and reflects the matching separation.\n\n9) Performance notes\n- Given the equality filter on xmatch.oid and the specific catid, the query should be fast even without additional indexes. No Q3C spatial functions are needed because we are not performing a coordinate-based search.\n\n10) Output expectations\n- One row per AllWISE cross-match of the object, with columns:\n  - oid, oid_catalog, dist, w1mpro, w2mpro, w3mpro, w4mpro\n\n11) Validation (optional)\n- If uncertain about the exact catid literal used for AllWISE in xmatch, first confirm it (e.g., 'allwise' vs 'AllWISE') and then set the filter accordingly to ensure correct matches are returned.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query:\n\n1) Clarify the goal\n- Retrieve, for the ZTF object with oid = 'ZTF19aascdol', all cross-matches in the AllWISE catalog, returning:\n  - ZTF identifier (ZTF oid)\n  - AllWISE catalog identifier (oid_catalog in the AllWISE catalog)\n  - Angular separation between the counterparts (in arcseconds)\n  - AllWISE magnitudes in filters W1, W2, W3, and W4\n\n2) Identify the relevant tables and columns\n- xmatch table:\n  - oid (ZTF object identifier; filter on this)\n  - catid (catalog name; filter to the AllWISE catalog)\n  - oid_catalog (catalog-side identifier; join key into the AllWISE table)\n  - dist (separation to the closest ZTF object, in arcseconds; select this)\n- allwise table:\n  - oid_catalog (primary key; join key from xmatch)\n  - w1mpro, w2mpro, w3mpro, w4mpro (profile-fit magnitudes in W1\u2013W4; select these)\n- object table:\n  - Not required for this query since xmatch already carries the ZTF oid. Include only if you want to validate existence or add object-level metadata (not requested here).\n\n3) Define filtering conditions\n- Restrict to the requested ZTF object:\n  - xmatch.oid = 'ZTF19aascdol'\n- Restrict to AllWISE cross-matches:\n  - xmatch.catid = 'allwise' (use the exact literal used in your deployment for the AllWISE catalog; if unsure, verify or use a case-insensitive comparison)\n- No probability table is needed; therefore the default probability conditions do not apply.\n\n4) Define the join(s)\n- Inner join xmatch to allwise on the catalog identifier:\n  - xmatch.oid_catalog = allwise.oid_catalog\n- This ensures only cross-matches that exist in the allwise table are returned.\n\n5) Specify the selected columns (the user asked for specific fields, so do not use SELECT *)\n- From xmatch:\n  - xmatch.oid             (ZTF identifier)\n  - xmatch.oid_catalog     (AllWISE catalog identifier)\n  - xmatch.dist            (separation in arcseconds)\n- From allwise:\n  - allwise.w1mpro\n  - allwise.w2mpro\n  - allwise.w3mpro\n  - allwise.w4mpro\n\n6) Sorting (optional but recommended)\n- Order by the angular separation to present the closest match first:\n  - ORDER BY xmatch.dist ASC\n\n7) Handling multiple matches\n- The query should return all AllWISE matches for this ZTF object (if multiple exist). Do not aggregate or limit unless explicitly requested.\n- If you later need only the nearest match, add a per-oid ranking on xmatch.dist and filter to the top rank.\n\n8) Nullability and data caveats\n- The AllWISE magnitude columns (w1mpro\u2013w4mpro) may be NULL if unavailable or are upper limits under certain SNR conditions. Return as-is; the user did not request filtering on magnitude availability.\n- dist is already provided by xmatch in arcseconds and reflects the matching separation.\n\n9) Performance notes\n- Given the equality filter on xmatch.oid and the specific catid, the query should be fast even without additional indexes. No Q3C spatial functions are needed because we are not performing a coordinate-based search.\n\n10) Output expectations\n- One row per AllWISE cross-match of the object, with columns:\n  - oid, oid_catalog, dist, w1mpro, w2mpro, w3mpro, w4mpro\n\n11) Validation (optional)\n- If uncertain about the exact catid literal used for AllWISE in xmatch, first confirm it (e.g., 'allwise' vs 'AllWISE') and then set the filter accordingly to ensure correct matches are returned."
                },
                "in_toks": 3364,
                "out_toks": 2580,
                "id": "chatcmpl-CSxnTzknQnBtHQYevBFRLWsLSbxSn",
                "created": 1761019079,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- ALLWISE cross-matches for the given ZTF object with W1\u2013W4 magnitudes\nSELECT\n    x.oid,               -- ZTF identifier\n    x.oid_catalog,       -- ALLWISE catalog identifier\n    x.dist,              -- angular separation in arcseconds\n    a.w1mpro,            -- WISE W1 magnitude\n    a.w2mpro,            -- WISE W2 magnitude\n    a.w3mpro,            -- WISE W3 magnitude\n    a.w4mpro             -- WISE W4 magnitude\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog\nWHERE x.oid = 'ZTF19aascdol'\n  AND x.catid = 'allwise'\nORDER BY x.dist ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE cross-matches for the given ZTF object with W1\u2013W4 magnitudes\nSELECT\n    x.oid,               -- ZTF identifier\n    x.oid_catalog,       -- ALLWISE catalog identifier\n    x.dist,              -- angular separation in arcseconds\n    a.w1mpro,            -- WISE W1 magnitude\n    a.w2mpro,            -- WISE W2 magnitude\n    a.w3mpro,            -- WISE W3 magnitude\n    a.w4mpro             -- WISE W4 magnitude\nFROM xmatch AS x\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog\nWHERE x.oid = 'ZTF19aascdol'\n  AND x.catid = 'allwise'\nORDER BY x.dist ASC;\n```"
                },
                "in_toks": 2900,
                "out_toks": 1145,
                "id": "chatcmpl-CSySZfnXPMrYYOnIJJsmZkyXe5N3A",
                "created": 1761021627,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "84",
            "experiment_id": "run_5",
            "pred_tables": [
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch', 'allwise']"
                },
                "in_toks": 632,
                "out_toks": 913,
                "id": "chatcmpl-CZNAr6Hj6pls3orhzUWUj0Y6G023F",
                "created": 1762546597,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1255,
                "out_toks": 655,
                "id": "chatcmpl-CZYfOUL9TKLMtZtCTYWOBFjo684gc",
                "created": 1762590774,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Clarify the goal and inputs\n- Objective: Retrieve ALLWISE cross-matches for the ZTF object ZTF19aascdol, returning:\n  - ZTF identifier\n  - ALLWISE catalog identifier\n  - Angular separation between counterparts (in arcseconds)\n  - WISE magnitudes in W1, W2, W3, W4\n- Input parameter: oid = 'ZTF19aascdol'\n\n2) Identify the necessary tables and relationships\n- xmatch\n  - Relevant columns: oid (ZTF object id), oid_catalog (catalog object id), catid (catalog name), dist (distance in arcsec)\n  - Contains one-to-many matches per ZTF object across multiple catalogs\n- allwise\n  - Relevant columns: oid_catalog (PRIMARY KEY), w1mpro, w2mpro, w3mpro, w4mpro\n  - Join key: xmatch.oid_catalog = allwise.oid_catalog\n- Note: We do not need the probability or object tables for this task, so the default probability conditions are not applicable.\n\n3) Define filtering conditions\n- Filter to the target ZTF object: xmatch.oid = 'ZTF19aascdol'\n- Ensure we only return ALLWISE matches by using an INNER JOIN to the allwise table on oid_catalog. This implicitly restricts to xmatch rows that correspond to ALLWISE without relying on a particular string in xmatch.catid.\n\n4) Define the join strategy\n- Use INNER JOIN allwise ON xmatch.oid_catalog = allwise.oid_catalog\n- Rationale:\n  - allwise.oid_catalog is a primary key, guaranteeing at most one matching ALLWISE row per xmatch record\n  - This avoids dependence on the exact string value of xmatch.catid\n\n5) Select the required output columns\n- From xmatch:\n  - xmatch.oid as the ZTF identifier\n  - xmatch.oid_catalog as the ALLWISE identifier\n  - xmatch.dist as the distance between counterparts (arcseconds)\n- From allwise:\n  - allwise.w1mpro as W1 magnitude\n  - allwise.w2mpro as W2 magnitude\n  - allwise.w3mpro as W3 magnitude\n  - allwise.w4mpro as W4 magnitude\n\n6) Optional result ordering and deduplication\n- Order results by xmatch.dist ASC to present the closest counterpart(s) first\n- If necessary to guard against duplicates in xmatch, use DISTINCT ON (xmatch.oid, xmatch.oid_catalog) or GROUP BY those keys; however, a plain inner join should suffice in typical usage.\n\n7) Assemble the query structure (no SQL code here; structural outline)\n- FROM: xmatch (aliased, e.g., xm)\n- JOIN: INNER JOIN allwise (aliased, e.g., aw) ON xm.oid_catalog = aw.oid_catalog\n- WHERE: xm.oid = 'ZTF19aascdol'\n- SELECT: xm.oid, xm.oid_catalog, xm.dist, aw.w1mpro, aw.w2mpro, aw.w3mpro, aw.w4mpro\n- ORDER BY: xm.dist ASC\n\n8) Notes and assumptions\n- xmatch.dist is in arcseconds (as per schema comment), which directly satisfies the \u201cdistance between counterparts\u201d requirement.\n- WISE filters W1\u2013W4 map to columns w1mpro, w2mpro, w3mpro, w4mpro in the allwise table.\n- If you want to explicitly enforce catalog identification, you can add an additional filter xm.catid = 'allwise' (or the exact case used in your deployment), but it is not strictly necessary because the INNER JOIN to allwise already guarantees only ALLWISE matches are returned.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Clarify the goal and inputs\n- Objective: Retrieve ALLWISE cross-matches for the ZTF object ZTF19aascdol, returning:\n  - ZTF identifier\n  - ALLWISE catalog identifier\n  - Angular separation between counterparts (in arcseconds)\n  - WISE magnitudes in W1, W2, W3, W4\n- Input parameter: oid = 'ZTF19aascdol'\n\n2) Identify the necessary tables and relationships\n- xmatch\n  - Relevant columns: oid (ZTF object id), oid_catalog (catalog object id), catid (catalog name), dist (distance in arcsec)\n  - Contains one-to-many matches per ZTF object across multiple catalogs\n- allwise\n  - Relevant columns: oid_catalog (PRIMARY KEY), w1mpro, w2mpro, w3mpro, w4mpro\n  - Join key: xmatch.oid_catalog = allwise.oid_catalog\n- Note: We do not need the probability or object tables for this task, so the default probability conditions are not applicable.\n\n3) Define filtering conditions\n- Filter to the target ZTF object: xmatch.oid = 'ZTF19aascdol'\n- Ensure we only return ALLWISE matches by using an INNER JOIN to the allwise table on oid_catalog. This implicitly restricts to xmatch rows that correspond to ALLWISE without relying on a particular string in xmatch.catid.\n\n4) Define the join strategy\n- Use INNER JOIN allwise ON xmatch.oid_catalog = allwise.oid_catalog\n- Rationale:\n  - allwise.oid_catalog is a primary key, guaranteeing at most one matching ALLWISE row per xmatch record\n  - This avoids dependence on the exact string value of xmatch.catid\n\n5) Select the required output columns\n- From xmatch:\n  - xmatch.oid as the ZTF identifier\n  - xmatch.oid_catalog as the ALLWISE identifier\n  - xmatch.dist as the distance between counterparts (arcseconds)\n- From allwise:\n  - allwise.w1mpro as W1 magnitude\n  - allwise.w2mpro as W2 magnitude\n  - allwise.w3mpro as W3 magnitude\n  - allwise.w4mpro as W4 magnitude\n\n6) Optional result ordering and deduplication\n- Order results by xmatch.dist ASC to present the closest counterpart(s) first\n- If necessary to guard against duplicates in xmatch, use DISTINCT ON (xmatch.oid, xmatch.oid_catalog) or GROUP BY those keys; however, a plain inner join should suffice in typical usage.\n\n7) Assemble the query structure (no SQL code here; structural outline)\n- FROM: xmatch (aliased, e.g., xm)\n- JOIN: INNER JOIN allwise (aliased, e.g., aw) ON xm.oid_catalog = aw.oid_catalog\n- WHERE: xm.oid = 'ZTF19aascdol'\n- SELECT: xm.oid, xm.oid_catalog, xm.dist, aw.w1mpro, aw.w2mpro, aw.w3mpro, aw.w4mpro\n- ORDER BY: xm.dist ASC\n\n8) Notes and assumptions\n- xmatch.dist is in arcseconds (as per schema comment), which directly satisfies the \u201cdistance between counterparts\u201d requirement.\n- WISE filters W1\u2013W4 map to columns w1mpro, w2mpro, w3mpro, w4mpro in the allwise table.\n- If you want to explicitly enforce catalog identification, you can add an additional filter xm.catid = 'allwise' (or the exact case used in your deployment), but it is not strictly necessary because the INNER JOIN to allwise already guarantees only ALLWISE matches are returned."
                },
                "in_toks": 2882,
                "out_toks": 2477,
                "id": "chatcmpl-CZZsl2ajSala9uvD4FUorCspX121C",
                "created": 1762595447,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- ALLWISE cross-matches for the ZTF object 'ZTF19aascdol'\n-- Returns: ZTF identifier (oid), ALLWISE identifier (oid_catalog), angular separation (dist, arcsec),\n-- and WISE magnitudes in W1\u2013W4 (w1mpro, w2mpro, w3mpro, w4mpro)\nSELECT\n    xm.oid,\n    xm.oid_catalog,\n    xm.dist,\n    aw.w1mpro,\n    aw.w2mpro,\n    aw.w3mpro,\n    aw.w4mpro\nFROM xmatch AS xm\nINNER JOIN allwise AS aw\n    ON xm.oid_catalog = aw.oid_catalog\nWHERE xm.oid = 'ZTF19aascdol'\nORDER BY xm.dist ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE cross-matches for the ZTF object 'ZTF19aascdol'\n-- Returns: ZTF identifier (oid), ALLWISE identifier (oid_catalog), angular separation (dist, arcsec),\n-- and WISE magnitudes in W1\u2013W4 (w1mpro, w2mpro, w3mpro, w4mpro)\nSELECT\n    xm.oid,\n    xm.oid_catalog,\n    xm.dist,\n    aw.w1mpro,\n    aw.w2mpro,\n    aw.w3mpro,\n    aw.w4mpro\nFROM xmatch AS xm\nINNER JOIN allwise AS aw\n    ON xm.oid_catalog = aw.oid_catalog\nWHERE xm.oid = 'ZTF19aascdol'\nORDER BY xm.dist ASC;\n```"
                },
                "in_toks": 2861,
                "out_toks": 1010,
                "id": "chatcmpl-CZawcuWfg54ZFZW06D1PWxHWKmLPa",
                "created": 1762599530,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "84",
            "experiment_id": "run_6",
            "pred_tables": [
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch', 'allwise']"
                },
                "in_toks": 632,
                "out_toks": 593,
                "id": "chatcmpl-CZNB8ykSJqSdH2z0BE5LbWGy6gKbJ",
                "created": 1762546614,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1255,
                "out_toks": 399,
                "id": "chatcmpl-CZYfXMuJwSklBhmQHOj5b41Efzjcw",
                "created": 1762590783,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Clarify the goal and outputs\n- Input: a single ZTF object id = 'ZTF19aascdol'.\n- Required outputs per matched AllWISE counterpart:\n  - ZTF identifier (ZTF oid).\n  - Catalog identifier in AllWISE (catalog\u2019s oid).\n  - Angular distance between ZTF and AllWISE counterparts (in arcseconds).\n  - AllWISE magnitudes in W1, W2, W3, W4.\n- Return all AllWISE match(es) for the given ZTF object (not just the closest). Sort by smallest angular distance first.\n\n2) Identify relevant tables and columns\n- Table xmatch:\n  - oid (ZTF object id; filter on this)\n  - catid (catalog identifier string; may indicate \u201cAllWISE\u201d but the exact literal is not guaranteed)\n  - oid_catalog (catalog-specific id; used to join to the AllWISE catalog table)\n  - dist (distance to closest ZTF object in arcseconds)\n- Table allwise:\n  - oid_catalog (primary key; same value as xmatch.oid_catalog; join key)\n  - w1mpro, w2mpro, w3mpro, w4mpro (WISE profile-fit magnitudes for W1\u2013W4)\n\n3) Choose join strategy\n- Use an INNER JOIN from xmatch to allwise on xmatch.oid_catalog = allwise.oid_catalog.\n- This join automatically restricts results to AllWISE matches without relying on a specific xmatch.catid literal.\n\n4) Define filtering conditions\n- WHERE xmatch.oid = 'ZTF19aascdol'.\n- Do not include probability-related filters (not needed here).\n- Optional: If you want to be explicit about the catalog, you may add a filter on xmatch.catid once the exact literal used for AllWISE in this database is confirmed (e.g., catid = 'allwise' or 'AllWISE'). This is not required if using the join to allwise.\n\n5) Select the required columns (only those requested)\n- xmatch.oid as the ZTF identifier.\n- xmatch.oid_catalog as the AllWISE catalog identifier.\n- xmatch.dist as the distance (units: arcseconds).\n- allwise.w1mpro as W1 magnitude.\n- allwise.w2mpro as W2 magnitude.\n- allwise.w3mpro as W3 magnitude.\n- allwise.w4mpro as W4 magnitude.\n\n6) Sorting and multiplicity\n- ORDER BY xmatch.dist ASC to present the closest counterparts first.\n- Do not apply LIMIT to return all AllWISE match(es).\n- DISTINCT is typically unnecessary, but if duplicates exist due to upstream data issues, add SELECT DISTINCT over the selected columns.\n\n7) Performance and correctness notes\n- The join is efficient due to allwise.oid_catalog being a primary key. If available, an index on xmatch.oid will speed up the WHERE filter.\n- No Q3C spatial filters are needed because the cross-match has already been established; distance is provided by xmatch.dist.\n- Magnitude columns can be NULL if not measured; return as-is.\n\n8) Final assembly of the query\n- FROM: xmatch aliased (e.g., xm).\n- JOIN: INNER JOIN allwise (e.g., aw) ON xm.oid_catalog = aw.oid_catalog.\n- WHERE: xm.oid = 'ZTF19aascdol' (and optionally xm.catid equals the verified AllWISE literal).\n- SELECT: xm.oid, xm.oid_catalog, xm.dist, aw.w1mpro, aw.w2mpro, aw.w3mpro, aw.w4mpro.\n- ORDER BY: xm.dist ASC.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Clarify the goal and outputs\n- Input: a single ZTF object id = 'ZTF19aascdol'.\n- Required outputs per matched AllWISE counterpart:\n  - ZTF identifier (ZTF oid).\n  - Catalog identifier in AllWISE (catalog\u2019s oid).\n  - Angular distance between ZTF and AllWISE counterparts (in arcseconds).\n  - AllWISE magnitudes in W1, W2, W3, W4.\n- Return all AllWISE match(es) for the given ZTF object (not just the closest). Sort by smallest angular distance first.\n\n2) Identify relevant tables and columns\n- Table xmatch:\n  - oid (ZTF object id; filter on this)\n  - catid (catalog identifier string; may indicate \u201cAllWISE\u201d but the exact literal is not guaranteed)\n  - oid_catalog (catalog-specific id; used to join to the AllWISE catalog table)\n  - dist (distance to closest ZTF object in arcseconds)\n- Table allwise:\n  - oid_catalog (primary key; same value as xmatch.oid_catalog; join key)\n  - w1mpro, w2mpro, w3mpro, w4mpro (WISE profile-fit magnitudes for W1\u2013W4)\n\n3) Choose join strategy\n- Use an INNER JOIN from xmatch to allwise on xmatch.oid_catalog = allwise.oid_catalog.\n- This join automatically restricts results to AllWISE matches without relying on a specific xmatch.catid literal.\n\n4) Define filtering conditions\n- WHERE xmatch.oid = 'ZTF19aascdol'.\n- Do not include probability-related filters (not needed here).\n- Optional: If you want to be explicit about the catalog, you may add a filter on xmatch.catid once the exact literal used for AllWISE in this database is confirmed (e.g., catid = 'allwise' or 'AllWISE'). This is not required if using the join to allwise.\n\n5) Select the required columns (only those requested)\n- xmatch.oid as the ZTF identifier.\n- xmatch.oid_catalog as the AllWISE catalog identifier.\n- xmatch.dist as the distance (units: arcseconds).\n- allwise.w1mpro as W1 magnitude.\n- allwise.w2mpro as W2 magnitude.\n- allwise.w3mpro as W3 magnitude.\n- allwise.w4mpro as W4 magnitude.\n\n6) Sorting and multiplicity\n- ORDER BY xmatch.dist ASC to present the closest counterparts first.\n- Do not apply LIMIT to return all AllWISE match(es).\n- DISTINCT is typically unnecessary, but if duplicates exist due to upstream data issues, add SELECT DISTINCT over the selected columns.\n\n7) Performance and correctness notes\n- The join is efficient due to allwise.oid_catalog being a primary key. If available, an index on xmatch.oid will speed up the WHERE filter.\n- No Q3C spatial filters are needed because the cross-match has already been established; distance is provided by xmatch.dist.\n- Magnitude columns can be NULL if not measured; return as-is.\n\n8) Final assembly of the query\n- FROM: xmatch aliased (e.g., xm).\n- JOIN: INNER JOIN allwise (e.g., aw) ON xm.oid_catalog = aw.oid_catalog.\n- WHERE: xm.oid = 'ZTF19aascdol' (and optionally xm.catid equals the verified AllWISE literal).\n- SELECT: xm.oid, xm.oid_catalog, xm.dist, aw.w1mpro, aw.w2mpro, aw.w3mpro, aw.w4mpro.\n- ORDER BY: xm.dist ASC."
                },
                "in_toks": 2882,
                "out_toks": 3025,
                "id": "chatcmpl-CZa4UXj0WGdxmr35LG57vwOJMQIag",
                "created": 1762596174,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- ALLWISE matches for a given ZTF object, with angular distance and W1\u2013W4 magnitudes\nSELECT\n    xm.oid,              -- ZTF identifier\n    xm.oid_catalog,      -- AllWISE catalog identifier\n    xm.dist,             -- angular distance (arcseconds)\n    aw.w1mpro,           -- W1 magnitude\n    aw.w2mpro,           -- W2 magnitude\n    aw.w3mpro,           -- W3 magnitude\n    aw.w4mpro            -- W4 magnitude\nFROM xmatch AS xm\nINNER JOIN allwise AS aw\n    ON xm.oid_catalog = aw.oid_catalog  -- ensures only AllWISE counterparts are returned\nWHERE xm.oid = 'ZTF19aascdol'\nORDER BY xm.dist ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE matches for a given ZTF object, with angular distance and W1\u2013W4 magnitudes\nSELECT\n    xm.oid,              -- ZTF identifier\n    xm.oid_catalog,      -- AllWISE catalog identifier\n    xm.dist,             -- angular distance (arcseconds)\n    aw.w1mpro,           -- W1 magnitude\n    aw.w2mpro,           -- W2 magnitude\n    aw.w3mpro,           -- W3 magnitude\n    aw.w4mpro            -- W4 magnitude\nFROM xmatch AS xm\nINNER JOIN allwise AS aw\n    ON xm.oid_catalog = aw.oid_catalog  -- ensures only AllWISE counterparts are returned\nWHERE xm.oid = 'ZTF19aascdol'\nORDER BY xm.dist ASC;\n```"
                },
                "in_toks": 2833,
                "out_toks": 1138,
                "id": "chatcmpl-CZaxzNhzKhpHfLU1E4A9S439RVjzh",
                "created": 1762599615,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "84",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'xmatch', 'allwise']"
                },
                "in_toks": 632,
                "out_toks": 404,
                "id": "chatcmpl-CZNBNmpa0uRNILbkGDcEDjxgGH48M",
                "created": 1762546629,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1737,
                "out_toks": 335,
                "id": "chatcmpl-CZYfdsTtxMciobLdGALuCaxCKn9Bd",
                "created": 1762590789,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Define the input and goal\n- Input object identifier: 'ZTF19aascdol' (this is the ZTF object oid).\n- Goal: For this ZTF object, return information about its ALLWISE cross-match(es):\n  - ZTF identifier\n  - ALLWISE catalog identifier\n  - Distance between counterparts (in arcseconds, as stored in xmatch.dist)\n  - WISE magnitudes W1 to W4 (columns w1mpro, w2mpro, w3mpro, w4mpro from the allwise table)\n\n2) Identify the relevant tables and necessary columns\n- xmatch\n  - Purpose: stores cross-matches between ZTF objects and external catalogs.\n  - Columns to use:\n    - oid (ZTF object identifier)\n    - catid (catalog name; must equal 'ALLWISE' for this task)\n    - oid_catalog (identifier of the matched object in the external catalog)\n    - dist (angular distance in arcseconds between the ZTF object and the catalog counterpart)\n- allwise\n  - Purpose: stores photometry and metadata for ALLWISE sources.\n  - Join key: allwise.oid_catalog = xmatch.oid_catalog\n  - Columns to use:\n    - w1mpro, w2mpro, w3mpro, w4mpro (WISE profile-fit magnitudes)\n\n3) Establish filtering conditions\n- Restrict to the specific ZTF object:\n  - xmatch.oid = 'ZTF19aascdol'\n- Restrict to ALLWISE catalog matches:\n  - xmatch.catid = 'ALLWISE'\n  Note: Use the exact string 'ALLWISE' for catid.\n\n4) Define table joins\n- Perform an INNER JOIN between xmatch and allwise to enrich ALLWISE matches with WISE magnitudes:\n  - Join condition: xmatch.oid_catalog = allwise.oid_catalog\n- The object table is not required for this query because xmatch.oid already provides the ZTF identifier and the rest comes from the xmatch and allwise tables.\n\n5) Specify the columns to return (projection)\n- ZTF identifier:\n  - xmatch.oid (can be returned as-is; this is the ZTF object identifier)\n- ALLWISE identifier:\n  - xmatch.oid_catalog\n- Distance between counterparts:\n  - xmatch.dist (units are arcseconds)\n- WISE magnitudes:\n  - allwise.w1mpro\n  - allwise.w2mpro\n  - allwise.w3mpro\n  - allwise.w4mpro\n\n6) Sorting (optional but recommended)\n- If multiple ALLWISE matches exist, order them by increasing distance to present the nearest counterpart(s) first:\n  - ORDER BY xmatch.dist ASC\n\n7) Handling multiple matches or nulls\n- Expect zero, one, or multiple rows depending on the number of ALLWISE counterparts recorded for the object.\n- Magnitude columns (w1mpro\u2013w4mpro) may be NULL if not available; no special handling is required unless the user requests it.\n\n8) Performance and indexes\n- The query filters on xmatch.oid and xmatch.catid. While indexes on these columns are not described, the filter is specific to a single oid and one catalog, so the result set should be small.\n- The join to allwise uses the exact key allwise.oid_catalog = xmatch.oid_catalog; ensure this is an INNER JOIN to only return matches that have ALLWISE photometry.\n\n9) No probability table involvement\n- The probability table and its default conditions are not used in this request, so no classifier-related filters apply.\n\n10) Final result structure\n- Each output row corresponds to one ALLWISE counterpart of 'ZTF19aascdol', with the following fields:\n  - oid (ZTF object id)\n  - oid_catalog (ALLWISE id)\n  - dist (arcsec)\n  - w1mpro\n  - w2mpro\n  - w3mpro\n  - w4mpro",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Define the input and goal\n- Input object identifier: 'ZTF19aascdol' (this is the ZTF object oid).\n- Goal: For this ZTF object, return information about its ALLWISE cross-match(es):\n  - ZTF identifier\n  - ALLWISE catalog identifier\n  - Distance between counterparts (in arcseconds, as stored in xmatch.dist)\n  - WISE magnitudes W1 to W4 (columns w1mpro, w2mpro, w3mpro, w4mpro from the allwise table)\n\n2) Identify the relevant tables and necessary columns\n- xmatch\n  - Purpose: stores cross-matches between ZTF objects and external catalogs.\n  - Columns to use:\n    - oid (ZTF object identifier)\n    - catid (catalog name; must equal 'ALLWISE' for this task)\n    - oid_catalog (identifier of the matched object in the external catalog)\n    - dist (angular distance in arcseconds between the ZTF object and the catalog counterpart)\n- allwise\n  - Purpose: stores photometry and metadata for ALLWISE sources.\n  - Join key: allwise.oid_catalog = xmatch.oid_catalog\n  - Columns to use:\n    - w1mpro, w2mpro, w3mpro, w4mpro (WISE profile-fit magnitudes)\n\n3) Establish filtering conditions\n- Restrict to the specific ZTF object:\n  - xmatch.oid = 'ZTF19aascdol'\n- Restrict to ALLWISE catalog matches:\n  - xmatch.catid = 'ALLWISE'\n  Note: Use the exact string 'ALLWISE' for catid.\n\n4) Define table joins\n- Perform an INNER JOIN between xmatch and allwise to enrich ALLWISE matches with WISE magnitudes:\n  - Join condition: xmatch.oid_catalog = allwise.oid_catalog\n- The object table is not required for this query because xmatch.oid already provides the ZTF identifier and the rest comes from the xmatch and allwise tables.\n\n5) Specify the columns to return (projection)\n- ZTF identifier:\n  - xmatch.oid (can be returned as-is; this is the ZTF object identifier)\n- ALLWISE identifier:\n  - xmatch.oid_catalog\n- Distance between counterparts:\n  - xmatch.dist (units are arcseconds)\n- WISE magnitudes:\n  - allwise.w1mpro\n  - allwise.w2mpro\n  - allwise.w3mpro\n  - allwise.w4mpro\n\n6) Sorting (optional but recommended)\n- If multiple ALLWISE matches exist, order them by increasing distance to present the nearest counterpart(s) first:\n  - ORDER BY xmatch.dist ASC\n\n7) Handling multiple matches or nulls\n- Expect zero, one, or multiple rows depending on the number of ALLWISE counterparts recorded for the object.\n- Magnitude columns (w1mpro\u2013w4mpro) may be NULL if not available; no special handling is required unless the user requests it.\n\n8) Performance and indexes\n- The query filters on xmatch.oid and xmatch.catid. While indexes on these columns are not described, the filter is specific to a single oid and one catalog, so the result set should be small.\n- The join to allwise uses the exact key allwise.oid_catalog = xmatch.oid_catalog; ensure this is an INNER JOIN to only return matches that have ALLWISE photometry.\n\n9) No probability table involvement\n- The probability table and its default conditions are not used in this request, so no classifier-related filters apply.\n\n10) Final result structure\n- Each output row corresponds to one ALLWISE counterpart of 'ZTF19aascdol', with the following fields:\n  - oid (ZTF object id)\n  - oid_catalog (ALLWISE id)\n  - dist (arcsec)\n  - w1mpro\n  - w2mpro\n  - w3mpro\n  - w4mpro"
                },
                "in_toks": 3364,
                "out_toks": 2521,
                "id": "chatcmpl-CZZsLzEtNRNLLgi4dhWNco7YIi5Jh",
                "created": 1762595421,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return ALLWISE cross-match information for the specified ZTF object\nSELECT\n    xmatch.oid,              -- ZTF identifier\n    xmatch.oid_catalog,      -- ALLWISE catalog identifier\n    xmatch.dist,             -- angular distance (arcseconds)\n    allwise.w1mpro,          -- WISE W1 magnitude\n    allwise.w2mpro,          -- WISE W2 magnitude\n    allwise.w3mpro,          -- WISE W3 magnitude\n    allwise.w4mpro           -- WISE W4 magnitude\nFROM xmatch\nINNER JOIN allwise\n    ON allwise.oid_catalog = xmatch.oid_catalog\nWHERE xmatch.oid = 'ZTF19aascdol'\n  AND xmatch.catid = 'ALLWISE'\nORDER BY xmatch.dist ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return ALLWISE cross-match information for the specified ZTF object\nSELECT\n    xmatch.oid,              -- ZTF identifier\n    xmatch.oid_catalog,      -- ALLWISE catalog identifier\n    xmatch.dist,             -- angular distance (arcseconds)\n    allwise.w1mpro,          -- WISE W1 magnitude\n    allwise.w2mpro,          -- WISE W2 magnitude\n    allwise.w3mpro,          -- WISE W3 magnitude\n    allwise.w4mpro           -- WISE W4 magnitude\nFROM xmatch\nINNER JOIN allwise\n    ON allwise.oid_catalog = xmatch.oid_catalog\nWHERE xmatch.oid = 'ZTF19aascdol'\n  AND xmatch.catid = 'ALLWISE'\nORDER BY xmatch.dist ASC;\n```"
                },
                "in_toks": 2906,
                "out_toks": 954,
                "id": "chatcmpl-CZawc4YFVbdS9W3a5OrGc3NB9rOYI",
                "created": 1762599530,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "84",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'xmatch', 'allwise']"
                },
                "in_toks": 632,
                "out_toks": 532,
                "id": "chatcmpl-CZNBXbVHy8Se5QOL0gzIFx0pGJR0I",
                "created": 1762546639,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1737,
                "out_toks": 527,
                "id": "chatcmpl-CZYfhN6ekkxazNjb225ILJt9c5ort",
                "created": 1762590793,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- For the ZTF object with oid = 'ZTF19aascdol', return its AllWISE cross-match(es) with:\n  - ZTF identifier\n  - Catalog (AllWISE) identifier\n  - Distance between counterparts (arcseconds)\n  - Magnitudes in the WISE filters W1\u2013W4\n\nRelevant schema and rationale\n- xmatch: holds cross-matches between ALeRCE/ZTF objects and external catalogs.\n  - Columns needed: oid (ZTF id), oid_catalog (catalog\u2019s id), dist (arcsec), catid (not strictly needed if we join to allwise).\n- allwise: holds the AllWISE catalog content keyed by oid_catalog.\n  - Columns needed: oid_catalog (join key), w1mpro, w2mpro, w3mpro, w4mpro (WISE magnitudes).\n- object: not required for this retrieval since xmatch already carries the ZTF oid; including it would add unnecessary joins.\n- We avoid filtering by xmatch.catid string to prevent dependence on an exact literal; the INNER JOIN to allwise ensures we only get AllWISE matches.\n\nStep-by-step plan\n1) Define input parameter\n- Fixed value for this request: ZTF oid = 'ZTF19aascdol'.\n\n2) Build the base dataset from xmatch\n- Select rows from xmatch where xmatch.oid = 'ZTF19aascdol'.\n- This returns all catalog matches for the specified ZTF object.\n\n3) Restrict to AllWISE matches via join\n- INNER JOIN allwise ON allwise.oid_catalog = xmatch.oid_catalog.\n- This implicitly filters to AllWISE-only rows, because allwise contains only AllWISE entries keyed by the same oid_catalog.\n\n4) Select the required output columns\n- ZTF identifier:\n  - xmatch.oid\n- Catalog identifier (AllWISE):\n  - xmatch.oid_catalog\n- Angular separation between the ZTF and catalog counterpart (in arcseconds):\n  - xmatch.dist\n- WISE magnitudes:\n  - allwise.w1mpro (WISE W1)\n  - allwise.w2mpro (WISE W2)\n  - allwise.w3mpro (WISE W3)\n  - allwise.w4mpro (WISE W4)\n- Use the exact column names as listed above; you may alias them for readability (e.g., AS ztf_oid, AS allwise_oid, AS dist_arcsec), but keep the source column names correct.\n\n5) Handle multiplicity and ordering\n- There may be multiple AllWISE matches for a single ZTF object; return all matches.\n- Order the results by increasing separation to present the closest counterpart(s) first:\n  - ORDER BY xmatch.dist ASC.\n\n6) Optional refinements (only if explicitly requested)\n- If only the closest match is desired, apply a limit or use DISTINCT ON with ORDER BY xmatch.dist ASC to keep the minimum-distance row per (oid).\n- If magnitude uncertainties are needed, also select:\n  - allwise.w1sigmpro, allwise.w2sigmpro, allwise.w3sigmpro, allwise.w4sigmpro.\n\n7) No probability table usage\n- The probability table and its default conditions are not needed here and should not be included.\n\n8) Final shape of the query (description)\n- FROM xmatch filtered by xmatch.oid = 'ZTF19aascdol'\n- INNER JOIN allwise ON allwise.oid_catalog = xmatch.oid_catalog\n- SELECT:\n  - xmatch.oid\n  - xmatch.oid_catalog\n  - xmatch.dist\n  - allwise.w1mpro, allwise.w2mpro, allwise.w3mpro, allwise.w4mpro\n- ORDER BY xmatch.dist ASC\n\nNotes\n- Units: xmatch.dist is in arcseconds (as per schema).\n- This plan avoids dependence on the xmatch.catid literal and remains robust by using the allwise join key.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- For the ZTF object with oid = 'ZTF19aascdol', return its AllWISE cross-match(es) with:\n  - ZTF identifier\n  - Catalog (AllWISE) identifier\n  - Distance between counterparts (arcseconds)\n  - Magnitudes in the WISE filters W1\u2013W4\n\nRelevant schema and rationale\n- xmatch: holds cross-matches between ALeRCE/ZTF objects and external catalogs.\n  - Columns needed: oid (ZTF id), oid_catalog (catalog\u2019s id), dist (arcsec), catid (not strictly needed if we join to allwise).\n- allwise: holds the AllWISE catalog content keyed by oid_catalog.\n  - Columns needed: oid_catalog (join key), w1mpro, w2mpro, w3mpro, w4mpro (WISE magnitudes).\n- object: not required for this retrieval since xmatch already carries the ZTF oid; including it would add unnecessary joins.\n- We avoid filtering by xmatch.catid string to prevent dependence on an exact literal; the INNER JOIN to allwise ensures we only get AllWISE matches.\n\nStep-by-step plan\n1) Define input parameter\n- Fixed value for this request: ZTF oid = 'ZTF19aascdol'.\n\n2) Build the base dataset from xmatch\n- Select rows from xmatch where xmatch.oid = 'ZTF19aascdol'.\n- This returns all catalog matches for the specified ZTF object.\n\n3) Restrict to AllWISE matches via join\n- INNER JOIN allwise ON allwise.oid_catalog = xmatch.oid_catalog.\n- This implicitly filters to AllWISE-only rows, because allwise contains only AllWISE entries keyed by the same oid_catalog.\n\n4) Select the required output columns\n- ZTF identifier:\n  - xmatch.oid\n- Catalog identifier (AllWISE):\n  - xmatch.oid_catalog\n- Angular separation between the ZTF and catalog counterpart (in arcseconds):\n  - xmatch.dist\n- WISE magnitudes:\n  - allwise.w1mpro (WISE W1)\n  - allwise.w2mpro (WISE W2)\n  - allwise.w3mpro (WISE W3)\n  - allwise.w4mpro (WISE W4)\n- Use the exact column names as listed above; you may alias them for readability (e.g., AS ztf_oid, AS allwise_oid, AS dist_arcsec), but keep the source column names correct.\n\n5) Handle multiplicity and ordering\n- There may be multiple AllWISE matches for a single ZTF object; return all matches.\n- Order the results by increasing separation to present the closest counterpart(s) first:\n  - ORDER BY xmatch.dist ASC.\n\n6) Optional refinements (only if explicitly requested)\n- If only the closest match is desired, apply a limit or use DISTINCT ON with ORDER BY xmatch.dist ASC to keep the minimum-distance row per (oid).\n- If magnitude uncertainties are needed, also select:\n  - allwise.w1sigmpro, allwise.w2sigmpro, allwise.w3sigmpro, allwise.w4sigmpro.\n\n7) No probability table usage\n- The probability table and its default conditions are not needed here and should not be included.\n\n8) Final shape of the query (description)\n- FROM xmatch filtered by xmatch.oid = 'ZTF19aascdol'\n- INNER JOIN allwise ON allwise.oid_catalog = xmatch.oid_catalog\n- SELECT:\n  - xmatch.oid\n  - xmatch.oid_catalog\n  - xmatch.dist\n  - allwise.w1mpro, allwise.w2mpro, allwise.w3mpro, allwise.w4mpro\n- ORDER BY xmatch.dist ASC\n\nNotes\n- Units: xmatch.dist is in arcseconds (as per schema).\n- This plan avoids dependence on the xmatch.catid literal and remains robust by using the allwise join key."
                },
                "in_toks": 3364,
                "out_toks": 2837,
                "id": "chatcmpl-CZZuTqYOBdqbD5fp7yHIWa374DRS6",
                "created": 1762595553,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- ALLWISE matches for a specific ZTF object with requested fields\nSELECT\n  xmatch.oid,               -- ZTF identifier\n  xmatch.oid_catalog,       -- AllWISE catalog identifier\n  xmatch.dist,              -- angular separation in arcseconds\n  allwise.w1mpro,           -- WISE W1 magnitude\n  allwise.w2mpro,           -- WISE W2 magnitude\n  allwise.w3mpro,           -- WISE W3 magnitude\n  allwise.w4mpro            -- WISE W4 magnitude\nFROM xmatch\nINNER JOIN allwise\n  ON allwise.oid_catalog = xmatch.oid_catalog\nWHERE xmatch.oid = 'ZTF19aascdol'\nORDER BY xmatch.dist ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE matches for a specific ZTF object with requested fields\nSELECT\n  xmatch.oid,               -- ZTF identifier\n  xmatch.oid_catalog,       -- AllWISE catalog identifier\n  xmatch.dist,              -- angular separation in arcseconds\n  allwise.w1mpro,           -- WISE W1 magnitude\n  allwise.w2mpro,           -- WISE W2 magnitude\n  allwise.w3mpro,           -- WISE W3 magnitude\n  allwise.w4mpro            -- WISE W4 magnitude\nFROM xmatch\nINNER JOIN allwise\n  ON allwise.oid_catalog = xmatch.oid_catalog\nWHERE xmatch.oid = 'ZTF19aascdol'\nORDER BY xmatch.dist ASC;\n```"
                },
                "in_toks": 2901,
                "out_toks": 943,
                "id": "chatcmpl-CZay0ACAZcgjcFKpBgNgvpEeGvBt5",
                "created": 1762599616,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "84",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "xmatch",
                "allwise"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'xmatch', 'allwise']"
                },
                "in_toks": 632,
                "out_toks": 660,
                "id": "chatcmpl-CZNBfxOKbAbWtwVnuEReyEkIv6sMg",
                "created": 1762546647,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1737,
                "out_toks": 399,
                "id": "chatcmpl-CZYfq6evZ8Jrs5EICtUZnExywFiY5",
                "created": 1762590802,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the target object\n- Base table: object\n- Filter condition: object.oid = 'ZTF19aascdol'\n- Rationale: This pins the query to the single ZTF object of interest.\n\n2) Retrieve its catalog crossmatches\n- Table: xmatch\n- Join to object on: xmatch.oid = object.oid\n- Do not filter by xmatch.catid explicitly; instead, restrict to AllWISE by joining to the allwise table in the next step (this guarantees we only keep AllWISE matches regardless of the catid string format).\n\n3) Restrict to AllWISE matches and fetch photometry\n- Table: allwise\n- Join condition: allwise.oid_catalog = xmatch.oid_catalog\n- Rationale: The dedicated allwise table contains the AllWISE photometric magnitudes and uses the same oid_catalog identifier as xmatch. Joining via oid_catalog selects only the AllWISE matches.\n\n4) Select the exact fields requested by the user\n- ZTF identifier: object.oid (or xmatch.oid; use object.oid for clarity)\n- Catalog identifier: allwise.oid_catalog (this is the AllWISE source designation per schema comments)\n- Distance between counterparts: xmatch.dist (in arcseconds)\n- WISE magnitudes W1\u2013W4:\n  - allwise.w1mpro\n  - allwise.w2mpro\n  - allwise.w3mpro\n  - allwise.w4mpro\n\n5) Handle multiplicity and ordering\n- Expect zero, one, or multiple AllWISE matches for the given ZTF object.\n- Order results by increasing xmatch.dist to list the nearest counterpart first.\n\n6) Optional projection and formatting considerations\n- Keep only the requested columns (do not use SELECT *) since the user specified them explicitly.\n- If you want to present clearer column names, use aliases (e.g., ztf_oid, allwise_id, dist_arcsec, W1, W2, W3, W4). This is optional but recommended for readability.\n\n7) No need for probability table or spatial functions\n- The probability table is not involved; therefore, the default probability filtering is not applicable here.\n- Q3C spatial functions are not needed because you are using catalog crossmatches already present in xmatch and allwise.\n\n8) Final query structure outline (no SQL code, just structure)\n- FROM object\n- INNER JOIN xmatch ON xmatch.oid = object.oid\n- INNER JOIN allwise ON allwise.oid_catalog = xmatch.oid_catalog\n- WHERE object.oid = 'ZTF19aascdol'\n- SELECT:\n  - object.oid\n  - allwise.oid_catalog\n  - xmatch.dist\n  - allwise.w1mpro\n  - allwise.w2mpro\n  - allwise.w3mpro\n  - allwise.w4mpro\n- ORDER BY xmatch.dist ASC\n\n9) Performance notes\n- object.oid is the primary key, ensuring an efficient filter.\n- allwise.oid_catalog is the primary key, making the join efficient.\n- xmatch may not have an explicit index on oid or oid_catalog in the provided schema snippet; however, the highly selective WHERE on object.oid will limit rows early, keeping the join efficient.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the target object\n- Base table: object\n- Filter condition: object.oid = 'ZTF19aascdol'\n- Rationale: This pins the query to the single ZTF object of interest.\n\n2) Retrieve its catalog crossmatches\n- Table: xmatch\n- Join to object on: xmatch.oid = object.oid\n- Do not filter by xmatch.catid explicitly; instead, restrict to AllWISE by joining to the allwise table in the next step (this guarantees we only keep AllWISE matches regardless of the catid string format).\n\n3) Restrict to AllWISE matches and fetch photometry\n- Table: allwise\n- Join condition: allwise.oid_catalog = xmatch.oid_catalog\n- Rationale: The dedicated allwise table contains the AllWISE photometric magnitudes and uses the same oid_catalog identifier as xmatch. Joining via oid_catalog selects only the AllWISE matches.\n\n4) Select the exact fields requested by the user\n- ZTF identifier: object.oid (or xmatch.oid; use object.oid for clarity)\n- Catalog identifier: allwise.oid_catalog (this is the AllWISE source designation per schema comments)\n- Distance between counterparts: xmatch.dist (in arcseconds)\n- WISE magnitudes W1\u2013W4:\n  - allwise.w1mpro\n  - allwise.w2mpro\n  - allwise.w3mpro\n  - allwise.w4mpro\n\n5) Handle multiplicity and ordering\n- Expect zero, one, or multiple AllWISE matches for the given ZTF object.\n- Order results by increasing xmatch.dist to list the nearest counterpart first.\n\n6) Optional projection and formatting considerations\n- Keep only the requested columns (do not use SELECT *) since the user specified them explicitly.\n- If you want to present clearer column names, use aliases (e.g., ztf_oid, allwise_id, dist_arcsec, W1, W2, W3, W4). This is optional but recommended for readability.\n\n7) No need for probability table or spatial functions\n- The probability table is not involved; therefore, the default probability filtering is not applicable here.\n- Q3C spatial functions are not needed because you are using catalog crossmatches already present in xmatch and allwise.\n\n8) Final query structure outline (no SQL code, just structure)\n- FROM object\n- INNER JOIN xmatch ON xmatch.oid = object.oid\n- INNER JOIN allwise ON allwise.oid_catalog = xmatch.oid_catalog\n- WHERE object.oid = 'ZTF19aascdol'\n- SELECT:\n  - object.oid\n  - allwise.oid_catalog\n  - xmatch.dist\n  - allwise.w1mpro\n  - allwise.w2mpro\n  - allwise.w3mpro\n  - allwise.w4mpro\n- ORDER BY xmatch.dist ASC\n\n9) Performance notes\n- object.oid is the primary key, ensuring an efficient filter.\n- allwise.oid_catalog is the primary key, making the join efficient.\n- xmatch may not have an explicit index on oid or oid_catalog in the provided schema snippet; however, the highly selective WHERE on object.oid will limit rows early, keeping the join efficient."
                },
                "in_toks": 3364,
                "out_toks": 2113,
                "id": "chatcmpl-CZa62hCtXJ0nDCsP4IhVQSXd12smG",
                "created": 1762596270,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- ALLWISE counterparts (with photometry) for the given ZTF object\nSELECT\n    o.oid,              -- ZTF identifier\n    a.oid_catalog,      -- ALLWISE catalog identifier\n    x.dist,             -- distance between counterparts (arcsec)\n    a.w1mpro,           -- WISE W1 magnitude\n    a.w2mpro,           -- WISE W2 magnitude\n    a.w3mpro,           -- WISE W3 magnitude\n    a.w4mpro            -- WISE W4 magnitude\nFROM object AS o\nINNER JOIN xmatch AS x\n    ON x.oid = o.oid\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog  -- restricts to AllWISE matches\nWHERE o.oid = 'ZTF19aascdol'\nORDER BY x.dist ASC;  -- nearest counterpart first\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- ALLWISE counterparts (with photometry) for the given ZTF object\nSELECT\n    o.oid,              -- ZTF identifier\n    a.oid_catalog,      -- ALLWISE catalog identifier\n    x.dist,             -- distance between counterparts (arcsec)\n    a.w1mpro,           -- WISE W1 magnitude\n    a.w2mpro,           -- WISE W2 magnitude\n    a.w3mpro,           -- WISE W3 magnitude\n    a.w4mpro            -- WISE W4 magnitude\nFROM object AS o\nINNER JOIN xmatch AS x\n    ON x.oid = o.oid\nINNER JOIN allwise AS a\n    ON a.oid_catalog = x.oid_catalog  -- restricts to AllWISE matches\nWHERE o.oid = 'ZTF19aascdol'\nORDER BY x.dist ASC;  -- nearest counterpart first\n```"
                },
                "in_toks": 2753,
                "out_toks": 905,
                "id": "chatcmpl-CZawtqIN657ypIn0WoFAvBrYcslS8",
                "created": 1762599547,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "96": {
        "0": {
            "req_id": "96",
            "experiment_id": "run_0",
            "pred_tables": [
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf', 'detection']",
                    "1": "['ss_ztf', 'detection']"
                },
                "in_toks": 670,
                "out_toks": 1318,
                "id": "chatcmpl-CSna2ywfLLJAcv7zvQIOykzbR8bwL",
                "created": 1760979806,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Get all detections for ZTF objects whose nearest Solar System object is either '2003FP134' or '2009UK56'\n-- within 2 arcseconds. Optimize by first reducing ss_ztf to the small target set, then joining to detection by oid.\nWITH target_ss AS\n  (SELECT *\n   FROM ss_ztf\n   WHERE ssnamenr IN ('2003FP134',\n                      '2009UK56')\n     AND ssdistnr <= 2)\nSELECT target_ss.*, -- all columns from ss_ztf\n d.mjd, -- detection date (MJD)\n d.fid, -- filter identifier\n d.isdiffpos, -- difference sign flag\n d.ra, -- RA\n d.dec, -- Dec\n d.magpsf, -- difference magnitude\n d.sigmapsf -- difference magnitude uncertainty\nFROM target_ss\nJOIN detection d USING (oid)-- join only on oid as recommended\nORDER BY target_ss.ssnamenr,\n         d.mjd;",
            "sql_response": {
                "responses": {
                    "0": "-- Get all detections for ZTF objects whose nearest Solar System object is either '2003FP134' or '2009UK56'\n-- within 2 arcseconds. Optimize by first reducing ss_ztf to the small target set, then joining to detection by oid.\nWITH target_ss AS\n  (SELECT *\n   FROM ss_ztf\n   WHERE ssnamenr IN ('2003FP134',\n                      '2009UK56')\n     AND ssdistnr <= 2)\nSELECT target_ss.*, -- all columns from ss_ztf\n d.mjd, -- detection date (MJD)\n d.fid, -- filter identifier\n d.isdiffpos, -- difference sign flag\n d.ra, -- RA\n d.dec, -- Dec\n d.magpsf, -- difference magnitude\n d.sigmapsf -- difference magnitude uncertainty\nFROM target_ss\nJOIN detection d USING (oid)-- join only on oid as recommended\nORDER BY target_ss.ssnamenr,\n         d.mjd;"
                },
                "in_toks": 1643,
                "out_toks": 2472,
                "id": "chatcmpl-CbHT5MeZMz3IIkmIIXz5ATg984oCW",
                "created": 1763001319,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1191,
                "out_toks": 591,
                "id": "chatcmpl-CSnpSCtK6rI1Xze9Xav6C3JKixPzi",
                "created": 1760980762,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and returned columns\n- Task: Retrieve all detections for all ZTF objects whose nearest known solar system object is either '2003FP134' or '2009UK56' and is within 2 arcseconds, then return:\n  - All columns from ss_ztf (i.e., ss_ztf.*).\n  - From detection: mjd (detection date), fid (filter identifier), isdiffpos, ra, dec, magpsf (difference magnitude), sigmapsf (uncertainty).\n- Sort results by MPC name (solar system identifier) and detection date.\n\n2) Identify relevant tables and relationships\n- ss_ztf: Columns used: oid, candid, ssdistnr, ssmagnr, ssnamenr.\n  - Note: ssnamenr is the nearest solar system object name (string), with 'null' (literal string) used for non-SS objects per schema note.\n  - ssdistnr is the distance to the nearest known solar system object (assumed in arcseconds).\n  - Primary key: (oid).\n- detection: Columns used: candid (PK), oid (FK to object.oid), mjd, fid, isdiffpos, ra, dec, magpsf, sigmapsf.\n  - Important performance caveat: Avoid filtering on detection by anything other than oid (per provided guidance).\n\n3) Define the selection/filter criteria\n- Solar system object names filter: ss_ztf.ssnamenr IN ('2003FP134', '2009UK56').\n- Proximity constraint: ss_ztf.ssdistnr <= 2 (interpreted as within 2 arcseconds).\n- No additional filters on detection beyond joining via oid.\n\n4) Determine the base object set\n- Build a base set of ZTF objects (via oids) from ss_ztf that satisfy:\n  - ssnamenr IN ('2003FP134', '2009UK56').\n  - ssdistnr <= 2.\n- This can be written as a subquery (or CTE) selecting ss_ztf.* for those oids, to be joined to detection.\n\n5) Join strategy to get all detections for those objects\n- Use an INNER JOIN between detection and the filtered ss_ztf result on oid:\n  - detection.oid = ss_ztf.oid.\n- This returns all detection rows for each object that matches the solar system name and distance criteria.\n- Do not join on candid (we want all detections for each object, not just the one candid stored in ss_ztf).\n\n6) Columns to project in the SELECT list\n- All columns from ss_ztf: ss_ztf.* (e.g., oid, candid, ssdistnr, ssmagnr, ssnamenr).\n- From detection:\n  - detection.mjd AS mjd.\n  - detection.fid AS fid.\n  - detection.isdiffpos AS isdiffpos.\n  - detection.ra AS ra.\n  - detection.dec AS dec.\n  - detection.magpsf AS magpsf.\n  - detection.sigmapsf AS sigmapsf.\n- Do not include additional detection columns unless requested.\n\n7) Ordering of results\n- ORDER BY:\n  - ss_ztf.ssnamenr ASC  (MPC name).\n  - detection.mjd ASC     (detection date).\n- Optional tie-breaker (if desired for deterministic output): detection.candid ASC.\n\n8) Indexes and performance considerations\n- The filter on ssnamenr will benefit from ix_ss_ztf_ssnamenr (btree on ssnamenr).\n- The join on detection.oid will benefit from ix_ndetection_oid (hash on oid).\n- No Q3C spatial functions are needed here, because the matching is via the precomputed nearest solar system object name and distance (ss_ztf.ssnamenr and ss_ztf.ssdistnr).\n\n9) Edge cases and assumptions\n- Assumes ssdistnr is measured in arcseconds; 2 arcseconds threshold is applied directly to ss_ztf.ssdistnr.\n- The ss_ztf.ssnamenr field uses the literal string 'null' for non-SS matches; filtering via IN ('2003FP134','2009UK56') inherently excludes those.\n- There is one ss_ztf row per oid (PK on oid). Joining to detection will produce multiple rows per oid, one per detection (as intended).\n- If no objects meet the criteria, the query returns zero rows.\n\n10) Final assembly steps summary\n- From ss_ztf, filter rows where:\n  - ssnamenr IN ('2003FP134', '2009UK56')\n  - AND ssdistnr <= 2\n- Join those rows to detection on detection.oid = ss_ztf.oid.\n- SELECT ss_ztf.* plus detection.mjd, detection.fid, detection.isdiffpos, detection.ra, detection.dec, detection.magpsf, detection.sigmapsf.\n- ORDER BY ss_ztf.ssnamenr, detection.mjd.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and returned columns\n- Task: Retrieve all detections for all ZTF objects whose nearest known solar system object is either '2003FP134' or '2009UK56' and is within 2 arcseconds, then return:\n  - All columns from ss_ztf (i.e., ss_ztf.*).\n  - From detection: mjd (detection date), fid (filter identifier), isdiffpos, ra, dec, magpsf (difference magnitude), sigmapsf (uncertainty).\n- Sort results by MPC name (solar system identifier) and detection date.\n\n2) Identify relevant tables and relationships\n- ss_ztf: Columns used: oid, candid, ssdistnr, ssmagnr, ssnamenr.\n  - Note: ssnamenr is the nearest solar system object name (string), with 'null' (literal string) used for non-SS objects per schema note.\n  - ssdistnr is the distance to the nearest known solar system object (assumed in arcseconds).\n  - Primary key: (oid).\n- detection: Columns used: candid (PK), oid (FK to object.oid), mjd, fid, isdiffpos, ra, dec, magpsf, sigmapsf.\n  - Important performance caveat: Avoid filtering on detection by anything other than oid (per provided guidance).\n\n3) Define the selection/filter criteria\n- Solar system object names filter: ss_ztf.ssnamenr IN ('2003FP134', '2009UK56').\n- Proximity constraint: ss_ztf.ssdistnr <= 2 (interpreted as within 2 arcseconds).\n- No additional filters on detection beyond joining via oid.\n\n4) Determine the base object set\n- Build a base set of ZTF objects (via oids) from ss_ztf that satisfy:\n  - ssnamenr IN ('2003FP134', '2009UK56').\n  - ssdistnr <= 2.\n- This can be written as a subquery (or CTE) selecting ss_ztf.* for those oids, to be joined to detection.\n\n5) Join strategy to get all detections for those objects\n- Use an INNER JOIN between detection and the filtered ss_ztf result on oid:\n  - detection.oid = ss_ztf.oid.\n- This returns all detection rows for each object that matches the solar system name and distance criteria.\n- Do not join on candid (we want all detections for each object, not just the one candid stored in ss_ztf).\n\n6) Columns to project in the SELECT list\n- All columns from ss_ztf: ss_ztf.* (e.g., oid, candid, ssdistnr, ssmagnr, ssnamenr).\n- From detection:\n  - detection.mjd AS mjd.\n  - detection.fid AS fid.\n  - detection.isdiffpos AS isdiffpos.\n  - detection.ra AS ra.\n  - detection.dec AS dec.\n  - detection.magpsf AS magpsf.\n  - detection.sigmapsf AS sigmapsf.\n- Do not include additional detection columns unless requested.\n\n7) Ordering of results\n- ORDER BY:\n  - ss_ztf.ssnamenr ASC  (MPC name).\n  - detection.mjd ASC     (detection date).\n- Optional tie-breaker (if desired for deterministic output): detection.candid ASC.\n\n8) Indexes and performance considerations\n- The filter on ssnamenr will benefit from ix_ss_ztf_ssnamenr (btree on ssnamenr).\n- The join on detection.oid will benefit from ix_ndetection_oid (hash on oid).\n- No Q3C spatial functions are needed here, because the matching is via the precomputed nearest solar system object name and distance (ss_ztf.ssnamenr and ss_ztf.ssdistnr).\n\n9) Edge cases and assumptions\n- Assumes ssdistnr is measured in arcseconds; 2 arcseconds threshold is applied directly to ss_ztf.ssdistnr.\n- The ss_ztf.ssnamenr field uses the literal string 'null' for non-SS matches; filtering via IN ('2003FP134','2009UK56') inherently excludes those.\n- There is one ss_ztf row per oid (PK on oid). Joining to detection will produce multiple rows per oid, one per detection (as intended).\n- If no objects meet the criteria, the query returns zero rows.\n\n10) Final assembly steps summary\n- From ss_ztf, filter rows where:\n  - ssnamenr IN ('2003FP134', '2009UK56')\n  - AND ssdistnr <= 2\n- Join those rows to detection on detection.oid = ss_ztf.oid.\n- SELECT ss_ztf.* plus detection.mjd, detection.fid, detection.isdiffpos, detection.ra, detection.dec, detection.magpsf, detection.sigmapsf.\n- ORDER BY ss_ztf.ssnamenr, detection.mjd."
                },
                "in_toks": 2799,
                "out_toks": 3323,
                "id": "chatcmpl-CSqt7q5yk3ld93YJ1OHttQUlMhuep",
                "created": 1760992521,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- All detections for ZTF objects whose nearest known Solar System object is either '2003FP134' or '2009UK56'\n-- within 2 arcseconds. Returns all ss_ztf columns plus selected detection columns.\nSELECT\n    ss_ztf.*,\n    detection.mjd,\n    detection.fid,\n    detection.isdiffpos,\n    detection.ra,\n    detection.dec,\n    detection.magpsf,\n    detection.sigmapsf\nFROM ss_ztf\nINNER JOIN detection ON detection.oid = ss_ztf.oid\nWHERE ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n  AND ss_ztf.ssdistnr <= 2\nORDER BY ss_ztf.ssnamenr ASC, detection.mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All detections for ZTF objects whose nearest known Solar System object is either '2003FP134' or '2009UK56'\n-- within 2 arcseconds. Returns all ss_ztf columns plus selected detection columns.\nSELECT\n    ss_ztf.*,\n    detection.mjd,\n    detection.fid,\n    detection.isdiffpos,\n    detection.ra,\n    detection.dec,\n    detection.magpsf,\n    detection.sigmapsf\nFROM ss_ztf\nINNER JOIN detection ON detection.oid = ss_ztf.oid\nWHERE ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n  AND ss_ztf.ssdistnr <= 2\nORDER BY ss_ztf.ssnamenr ASC, detection.mjd ASC;\n```"
                },
                "in_toks": 3151,
                "out_toks": 1268,
                "id": "chatcmpl-CSr6Dy5XCbcxlT61r2e19lbfFOXad",
                "created": 1760993333,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "1": {
            "req_id": "96",
            "experiment_id": "run_1",
            "pred_tables": [
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf', 'detection']",
                    "1": "['ss_ztf', 'detection']"
                },
                "in_toks": 670,
                "out_toks": 1318,
                "id": "chatcmpl-CSna2ywfLLJAcv7zvQIOykzbR8bwL",
                "created": 1760979806,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return all detections for ZTF objects whose nearest Solar System object is\n-- either '2003FP134' or '2009UK56' within 2 arcsec.\n-- We use ss_ztf.ssnamenr (MPC name) and ss_ztf.ssdistnr (distance in arcsec).\n-- Join to detection by oid to get all detections for those objects (avoid filtering on detection).\n\nSELECT ss.*,\n       d.mjd, -- detection date (MJD)\n d.fid, -- filter identifier\n d.isdiffpos, -- isdiffpos flag\n d.ra, -- detection RA\n d.dec, -- detection Dec\n d.magpsf, -- difference magnitude\n d.sigmapsf -- uncertainty of difference magnitude\nFROM ss_ztf AS ss\nJOIN detection AS d ON d.oid = ss.oid\nWHERE ss.ssnamenr IN ('2003FP134',\n                      '2009UK56')\n  AND ss.ssdistnr <= 2.0\nORDER BY ss.ssnamenr,\n         d.mjd;",
            "sql_response": {
                "responses": {
                    "0": "-- Return all detections for ZTF objects whose nearest Solar System object is\n-- either '2003FP134' or '2009UK56' within 2 arcsec.\n-- We use ss_ztf.ssnamenr (MPC name) and ss_ztf.ssdistnr (distance in arcsec).\n-- Join to detection by oid to get all detections for those objects (avoid filtering on detection).\n\nSELECT ss.*,\n       d.mjd, -- detection date (MJD)\n d.fid, -- filter identifier\n d.isdiffpos, -- isdiffpos flag\n d.ra, -- detection RA\n d.dec, -- detection Dec\n d.magpsf, -- difference magnitude\n d.sigmapsf -- uncertainty of difference magnitude\nFROM ss_ztf AS ss\nJOIN detection AS d ON d.oid = ss.oid\nWHERE ss.ssnamenr IN ('2003FP134',\n                      '2009UK56')\n  AND ss.ssdistnr <= 2.0\nORDER BY ss.ssnamenr,\n         d.mjd;"
                },
                "in_toks": 1797,
                "out_toks": 1975,
                "id": "chatcmpl-CbHTZ1rL5RobzqBOKwQEBr9IyItWm",
                "created": 1763001349,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1191,
                "out_toks": 591,
                "id": "chatcmpl-CSnpbZGUY7ULV5Z3vgQKYaLbMF04s",
                "created": 1760980771,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 2799,
                "out_toks": 4000,
                "id": "chatcmpl-CSqt3zn1Nidyu7OLteNFdOTtjrwRT",
                "created": 1760992517,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- All detections within 2 arcsec of the Solar System objects '2003FP134' and '2009UK56'\n-- Assumes ss_ztf has columns: mpc_name (MPC identifier), ra, dec\n-- If your ss_ztf identifier column differs, replace ss.mpc_name below accordingly.\nSELECT\n    ss.*,\n    d.mjd,\n    d.fid,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf\nFROM ss_ztf AS ss\nINNER JOIN detection AS d\n    ON q3c_join(d.ra, d.dec, ss.ra, ss.dec, 2.0/3600.0)  -- 2 arcsec radius\nWHERE ss.mpc_name IN ('2003FP134', '2009UK56')\nORDER BY ss.mpc_name, d.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All detections within 2 arcsec of the Solar System objects '2003FP134' and '2009UK56'\n-- Assumes ss_ztf has columns: mpc_name (MPC identifier), ra, dec\n-- If your ss_ztf identifier column differs, replace ss.mpc_name below accordingly.\nSELECT\n    ss.*,\n    d.mjd,\n    d.fid,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf\nFROM ss_ztf AS ss\nINNER JOIN detection AS d\n    ON q3c_join(d.ra, d.dec, ss.ra, ss.dec, 2.0/3600.0)  -- 2 arcsec radius\nWHERE ss.mpc_name IN ('2003FP134', '2009UK56')\nORDER BY ss.mpc_name, d.mjd;\n```"
                },
                "in_toks": 3058,
                "out_toks": 3338,
                "id": "chatcmpl-CSr86NjPu3SvYKIwHLow15sRsyLoF",
                "created": 1760993450,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "2": {
            "req_id": "96",
            "experiment_id": "run_2",
            "pred_tables": [
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf', 'detection']"
                },
                "in_toks": 670,
                "out_toks": 851,
                "id": "chatcmpl-CSspKMchseKzSnZRPuM2tNHwIHKys",
                "created": 1760999974,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1191,
                "out_toks": 783,
                "id": "chatcmpl-CSxavWJY1sE1Qvpg2mj8aWfR7AMUT",
                "created": 1761018301,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify inputs and scope\n- Solar System object names to match (MPC names): '2003FP134', '2009UK56'\n- Angular separation threshold: within 2 arcsec\n- Return:\n  - All columns from ss_ztf (i.e., ss_ztf.*)\n  - From detection: mjd (detection date), fid (filter identifier), isdiffpos, ra, dec, magpsf (difference magnitude), sigmapsf (its uncertainty)\n- Sorting: first by MPC name, then by detection date\n- Note on interpretation: use ss_ztf.ssdistnr (distance to nearest known SSO, in arcseconds) to enforce the 2 arcsec proximity. Then retrieve all detections for the selected ZTF objects. No additional spatial filtering on detection is required (and should be avoided per guidance).\n\n2) Identify required tables and relations\n- ss_ztf: contains per-object nearest Solar System object info. Key columns:\n  - oid (PK; references object.oid)\n  - candid (BIGINT; candidate identifier associated with that nearest-SSO record)\n  - ssdistnr (DOUBLE PRECISION; distance to nearest SSO, arcsec)\n  - ssmagnr (DOUBLE PRECISION; mag of that SSO)\n  - ssnamenr (VARCHAR; MPC name of nearest SSO)\n- detection: contains all detections (light curve points). Key columns:\n  - oid (object identifier; join key to ss_ztf)\n  - mjd, fid, isdiffpos, ra, dec, magpsf, sigmapsf\n- Relationship: detection.oid = ss_ztf.oid (use INNER JOIN)\n\n3) Filtering strategy (apply filters only on ss_ztf and join on oid)\n- Restrict to the target MPC names:\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n- Enforce 2 arcsec proximity:\n  - ss_ztf.ssdistnr <= 2.0\n- Rationale: avoids filtering on detection beyond oid, as recommended.\n\n4) Join strategy\n- INNER JOIN detection d ON d.oid = ss_ztf.oid\n- This yields all detections for objects that satisfy the SSO name and distance cut.\n\n5) Projection (selected columns)\n- From ss_ztf: select all columns (ss_ztf.*)\n- From detection: select only the requested columns:\n  - detection.mjd (as detection date)\n  - detection.fid (filter identifier)\n  - detection.isdiffpos\n  - detection.ra\n  - detection.dec\n  - detection.magpsf (difference magnitude)\n  - detection.sigmapsf (difference magnitude uncertainty)\n\n6) Ordering of results\n- ORDER BY ss_ztf.ssnamenr ASC, detection.mjd ASC\n- Interpretation: \u201cMPC name\u201d corresponds to ss_ztf.ssnamenr. \u201cDetection date\u201d corresponds to detection.mjd.\n\n7) Index and performance considerations\n- Filtering on ss_ztf.ssnamenr can use index ix_ss_ztf_ssnamenr.\n- The join on detection.oid will use ix_ndetection_oid (hash index on detection.oid).\n- Avoid any additional filters on detection to maintain performance as per database guidance.\n\n8) Assumptions and justifications\n- ss_ztf.ssdistnr is in arcseconds; thus use threshold 2.0 directly (no unit conversion needed).\n- ss_ztf has one row per oid (PRIMARY KEY (oid)), representing the nearest known SSO association for that object. Using ssdistnr <= 2.0 ensures the object is (at least for the associated candidate) within 2 arcsec of the specified SSO name.\n- Q3C spatial functions are not needed because the required spatial constraint is already encapsulated by ss_ztf.ssdistnr and the target names; the database does not provide SSO ephemerides/positions to recompute per-detection separations.\n\n9) Edge cases to consider (no changes needed in the query)\n- If objects have null ssnamenr, they are excluded by the name filter.\n- Multiple detections per object are expected and desired.\n- No need for DISTINCT unless duplicates appear due to unforeseen joins (not expected here).\n\n10) Final assembly steps\n- FROM ss_ztf (aliased as s)\n- WHERE s.ssnamenr IN ('2003FP134','2009UK56') AND s.ssdistnr <= 2.0\n- INNER JOIN detection d ON d.oid = s.oid\n- SELECT s.*, d.mjd, d.fid, d.isdiffpos, d.ra, d.dec, d.magpsf, d.sigmapsf\n- ORDER BY s.ssnamenr, d.mjd",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify inputs and scope\n- Solar System object names to match (MPC names): '2003FP134', '2009UK56'\n- Angular separation threshold: within 2 arcsec\n- Return:\n  - All columns from ss_ztf (i.e., ss_ztf.*)\n  - From detection: mjd (detection date), fid (filter identifier), isdiffpos, ra, dec, magpsf (difference magnitude), sigmapsf (its uncertainty)\n- Sorting: first by MPC name, then by detection date\n- Note on interpretation: use ss_ztf.ssdistnr (distance to nearest known SSO, in arcseconds) to enforce the 2 arcsec proximity. Then retrieve all detections for the selected ZTF objects. No additional spatial filtering on detection is required (and should be avoided per guidance).\n\n2) Identify required tables and relations\n- ss_ztf: contains per-object nearest Solar System object info. Key columns:\n  - oid (PK; references object.oid)\n  - candid (BIGINT; candidate identifier associated with that nearest-SSO record)\n  - ssdistnr (DOUBLE PRECISION; distance to nearest SSO, arcsec)\n  - ssmagnr (DOUBLE PRECISION; mag of that SSO)\n  - ssnamenr (VARCHAR; MPC name of nearest SSO)\n- detection: contains all detections (light curve points). Key columns:\n  - oid (object identifier; join key to ss_ztf)\n  - mjd, fid, isdiffpos, ra, dec, magpsf, sigmapsf\n- Relationship: detection.oid = ss_ztf.oid (use INNER JOIN)\n\n3) Filtering strategy (apply filters only on ss_ztf and join on oid)\n- Restrict to the target MPC names:\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n- Enforce 2 arcsec proximity:\n  - ss_ztf.ssdistnr <= 2.0\n- Rationale: avoids filtering on detection beyond oid, as recommended.\n\n4) Join strategy\n- INNER JOIN detection d ON d.oid = ss_ztf.oid\n- This yields all detections for objects that satisfy the SSO name and distance cut.\n\n5) Projection (selected columns)\n- From ss_ztf: select all columns (ss_ztf.*)\n- From detection: select only the requested columns:\n  - detection.mjd (as detection date)\n  - detection.fid (filter identifier)\n  - detection.isdiffpos\n  - detection.ra\n  - detection.dec\n  - detection.magpsf (difference magnitude)\n  - detection.sigmapsf (difference magnitude uncertainty)\n\n6) Ordering of results\n- ORDER BY ss_ztf.ssnamenr ASC, detection.mjd ASC\n- Interpretation: \u201cMPC name\u201d corresponds to ss_ztf.ssnamenr. \u201cDetection date\u201d corresponds to detection.mjd.\n\n7) Index and performance considerations\n- Filtering on ss_ztf.ssnamenr can use index ix_ss_ztf_ssnamenr.\n- The join on detection.oid will use ix_ndetection_oid (hash index on detection.oid).\n- Avoid any additional filters on detection to maintain performance as per database guidance.\n\n8) Assumptions and justifications\n- ss_ztf.ssdistnr is in arcseconds; thus use threshold 2.0 directly (no unit conversion needed).\n- ss_ztf has one row per oid (PRIMARY KEY (oid)), representing the nearest known SSO association for that object. Using ssdistnr <= 2.0 ensures the object is (at least for the associated candidate) within 2 arcsec of the specified SSO name.\n- Q3C spatial functions are not needed because the required spatial constraint is already encapsulated by ss_ztf.ssdistnr and the target names; the database does not provide SSO ephemerides/positions to recompute per-detection separations.\n\n9) Edge cases to consider (no changes needed in the query)\n- If objects have null ssnamenr, they are excluded by the name filter.\n- Multiple detections per object are expected and desired.\n- No need for DISTINCT unless duplicates appear due to unforeseen joins (not expected here).\n\n10) Final assembly steps\n- FROM ss_ztf (aliased as s)\n- WHERE s.ssnamenr IN ('2003FP134','2009UK56') AND s.ssdistnr <= 2.0\n- INNER JOIN detection d ON d.oid = s.oid\n- SELECT s.*, d.mjd, d.fid, d.isdiffpos, d.ra, d.dec, d.magpsf, d.sigmapsf\n- ORDER BY s.ssnamenr, d.mjd"
                },
                "in_toks": 2799,
                "out_toks": 3594,
                "id": "chatcmpl-CSxnunbo1RqMzPNZcPPldn53SIxkp",
                "created": 1761019106,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all detections for ZTF objects within 2 arcsec of specified MPC names\n-- Returns: all columns from ss_ztf, plus selected detection columns\nSELECT\n    s.*,\n    d.mjd,\n    d.fid,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf\nFROM ss_ztf AS s\nINNER JOIN detection AS d\n    ON d.oid = s.oid\nWHERE\n    s.ssnamenr IN ('2003FP134', '2009UK56')\n    AND s.ssdistnr <= 2.0\nORDER BY\n    s.ssnamenr ASC,\n    d.mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all detections for ZTF objects within 2 arcsec of specified MPC names\n-- Returns: all columns from ss_ztf, plus selected detection columns\nSELECT\n    s.*,\n    d.mjd,\n    d.fid,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf\nFROM ss_ztf AS s\nINNER JOIN detection AS d\n    ON d.oid = s.oid\nWHERE\n    s.ssnamenr IN ('2003FP134', '2009UK56')\n    AND s.ssdistnr <= 2.0\nORDER BY\n    s.ssnamenr ASC,\n    d.mjd ASC;\n```"
                },
                "in_toks": 3102,
                "out_toks": 1189,
                "id": "chatcmpl-CSyK8vzCzlR77HqEbY0IeVBFj0Bxv",
                "created": 1761021104,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "96",
            "experiment_id": "run_3",
            "pred_tables": [
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf', 'detection']"
                },
                "in_toks": 670,
                "out_toks": 403,
                "id": "chatcmpl-CSspW69MBi0mA3405MwpBYcsNcG7C",
                "created": 1760999986,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1191,
                "out_toks": 847,
                "id": "chatcmpl-CSxb4gQhXHBmUYY7hgeYhf4Gomoxu",
                "created": 1761018310,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Define the user inputs and required output\n- Inputs:\n  - Solar System object identifiers (MPC names): '2003FP134', '2009UK56'\n  - Angular separation threshold: within 2 arcseconds\n- Output columns:\n  - All columns from ss_ztf (ss_ztf.*)\n  - From detection: mjd (detection date), fid (filter identifier), isdiffpos (flag), ra, dec (coordinates), magpsf (difference magnitude), sigmapsf (its uncertainty)\n- Sorting:\n  - First by MPC name (ss_ztf.ssnamenr), then by detection date (detection.mjd)\n\n2) Identify relevant tables and columns\n- ss_ztf: oid, candid, ssdistnr (distance to nearest known SSO; in arcseconds), ssmagnr, ssnamenr (name of nearest known SSO)\n- detection: candid, oid, mjd, fid, isdiffpos, ra, dec, magpsf, sigmapsf (and other columns not needed here)\n- No other tables are required; do not use probability or object tables.\n\n3) Translate the scientific constraints into database filters\n- Limit to records where the nearest known Solar System object matches either '2003FP134' or '2009UK56':\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n- Enforce the \u201cwithin 2 arcsec\u201d condition using the precomputed distance:\n  - ss_ztf.ssdistnr <= 2\n- No sky-position Q3C function is needed, because the distance to the named Solar System object is already provided by ss_ztf.ssdistnr.\n\n4) Define the row set of ZTF objects to be considered\n- Use ss_ztf as the driving table because:\n  - It directly encodes the association to Solar System objects via ssnamenr/ssdistnr.\n  - It has an index on ssnamenr (ix_ss_ztf_ssnamenr), making the name filter efficient.\n- Filter ss_ztf with:\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n  - ss_ztf.ssdistnr <= 2\n\n5) Join strategy to retrieve all detections for selected objects\n- Join detection to ss_ztf on the object identifier:\n  - INNER JOIN detection ON detection.oid = ss_ztf.oid\n- Rationale:\n  - detection has a hash index on oid (ix_ndetection_oid), making this join efficient.\n  - This returns all detections (i.e., full light curves) for those objects; avoid adding filters on detection other than the join key for performance, as advised.\n\n6) Columns to select\n- From ss_ztf:\n  - Select all columns: ss_ztf.* (includes oid, candid, ssdistnr, ssmagnr, ssnamenr)\n- From detection:\n  - detection.mjd (detection date)\n  - detection.fid (filter identifier; 1=g, 2=r, 3=i)\n  - detection.isdiffpos (difference sign flag)\n  - detection.ra, detection.dec (coordinates at detection)\n  - detection.magpsf (difference magnitude)\n  - detection.sigmapsf (difference magnitude uncertainty)\n- Keep original column names exactly as in the schema.\n\n7) Sorting of results\n- ORDER BY:\n  - ss_ztf.ssnamenr ASC (MPC name)\n  - detection.mjd ASC (detection date)\n\n8) Handling duplicates and completeness\n- No DISTINCT is needed; each detection row should be returned for each qualifying object.\n- Each ss_ztf row is unique per oid (primary key on oid), so join will not multiply rows unexpectedly.\n\n9) Performance and indexes\n- Filters on ss_ztf.ssnamenr use ix_ss_ztf_ssnamenr (btree on ssnamenr).\n- Join to detection on detection.oid uses ix_ndetection_oid (hash on oid).\n- Avoid filtering on detection columns to keep performance optimal (as per guidance).\n\n10) Validation and assumptions\n- Assumes ss_ztf.ssdistnr is in arcseconds (standard for ZTF alert schema).\n- The \u201cMPC name\u201d corresponds to ss_ztf.ssnamenr.\n- The requested \u201cdifference magnitude (and its uncertainty)\u201d maps to detection.magpsf and detection.sigmapsf (not the corrected variants magpsf_corr/sigmapsf_corr).\n- The detection date is returned as detection.mjd (Modified Julian Date), as stored.\n\n11) Final query structure (conceptual, no SQL code)\n- FROM ss_ztf filtered by ssnamenr IN (...) and ssdistnr <= 2\n- INNER JOIN detection ON detection.oid = ss_ztf.oid\n- SELECT ss_ztf.* and the specified detection columns\n- ORDER BY ss_ztf.ssnamenr, detection.mjd",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Define the user inputs and required output\n- Inputs:\n  - Solar System object identifiers (MPC names): '2003FP134', '2009UK56'\n  - Angular separation threshold: within 2 arcseconds\n- Output columns:\n  - All columns from ss_ztf (ss_ztf.*)\n  - From detection: mjd (detection date), fid (filter identifier), isdiffpos (flag), ra, dec (coordinates), magpsf (difference magnitude), sigmapsf (its uncertainty)\n- Sorting:\n  - First by MPC name (ss_ztf.ssnamenr), then by detection date (detection.mjd)\n\n2) Identify relevant tables and columns\n- ss_ztf: oid, candid, ssdistnr (distance to nearest known SSO; in arcseconds), ssmagnr, ssnamenr (name of nearest known SSO)\n- detection: candid, oid, mjd, fid, isdiffpos, ra, dec, magpsf, sigmapsf (and other columns not needed here)\n- No other tables are required; do not use probability or object tables.\n\n3) Translate the scientific constraints into database filters\n- Limit to records where the nearest known Solar System object matches either '2003FP134' or '2009UK56':\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n- Enforce the \u201cwithin 2 arcsec\u201d condition using the precomputed distance:\n  - ss_ztf.ssdistnr <= 2\n- No sky-position Q3C function is needed, because the distance to the named Solar System object is already provided by ss_ztf.ssdistnr.\n\n4) Define the row set of ZTF objects to be considered\n- Use ss_ztf as the driving table because:\n  - It directly encodes the association to Solar System objects via ssnamenr/ssdistnr.\n  - It has an index on ssnamenr (ix_ss_ztf_ssnamenr), making the name filter efficient.\n- Filter ss_ztf with:\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n  - ss_ztf.ssdistnr <= 2\n\n5) Join strategy to retrieve all detections for selected objects\n- Join detection to ss_ztf on the object identifier:\n  - INNER JOIN detection ON detection.oid = ss_ztf.oid\n- Rationale:\n  - detection has a hash index on oid (ix_ndetection_oid), making this join efficient.\n  - This returns all detections (i.e., full light curves) for those objects; avoid adding filters on detection other than the join key for performance, as advised.\n\n6) Columns to select\n- From ss_ztf:\n  - Select all columns: ss_ztf.* (includes oid, candid, ssdistnr, ssmagnr, ssnamenr)\n- From detection:\n  - detection.mjd (detection date)\n  - detection.fid (filter identifier; 1=g, 2=r, 3=i)\n  - detection.isdiffpos (difference sign flag)\n  - detection.ra, detection.dec (coordinates at detection)\n  - detection.magpsf (difference magnitude)\n  - detection.sigmapsf (difference magnitude uncertainty)\n- Keep original column names exactly as in the schema.\n\n7) Sorting of results\n- ORDER BY:\n  - ss_ztf.ssnamenr ASC (MPC name)\n  - detection.mjd ASC (detection date)\n\n8) Handling duplicates and completeness\n- No DISTINCT is needed; each detection row should be returned for each qualifying object.\n- Each ss_ztf row is unique per oid (primary key on oid), so join will not multiply rows unexpectedly.\n\n9) Performance and indexes\n- Filters on ss_ztf.ssnamenr use ix_ss_ztf_ssnamenr (btree on ssnamenr).\n- Join to detection on detection.oid uses ix_ndetection_oid (hash on oid).\n- Avoid filtering on detection columns to keep performance optimal (as per guidance).\n\n10) Validation and assumptions\n- Assumes ss_ztf.ssdistnr is in arcseconds (standard for ZTF alert schema).\n- The \u201cMPC name\u201d corresponds to ss_ztf.ssnamenr.\n- The requested \u201cdifference magnitude (and its uncertainty)\u201d maps to detection.magpsf and detection.sigmapsf (not the corrected variants magpsf_corr/sigmapsf_corr).\n- The detection date is returned as detection.mjd (Modified Julian Date), as stored.\n\n11) Final query structure (conceptual, no SQL code)\n- FROM ss_ztf filtered by ssnamenr IN (...) and ssdistnr <= 2\n- INNER JOIN detection ON detection.oid = ss_ztf.oid\n- SELECT ss_ztf.* and the specified detection columns\n- ORDER BY ss_ztf.ssnamenr, detection.mjd"
                },
                "in_toks": 2799,
                "out_toks": 3311,
                "id": "chatcmpl-CSxoZyhzTW4d7YhblF6Plzx9Zy89S",
                "created": 1761019147,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- All detections for ZTF objects within 2 arcsec of MPC names '2003FP134' or '2009UK56'\n-- Returns: ss_ztf.* plus detection.mjd, detection.fid, detection.isdiffpos, detection.ra, detection.dec, detection.magpsf, detection.sigmapsf\nSELECT\n    ss_ztf.*,\n    detection.mjd,\n    detection.fid,\n    detection.isdiffpos,\n    detection.ra,\n    detection.dec,\n    detection.magpsf,\n    detection.sigmapsf\nFROM ss_ztf\nINNER JOIN detection\n    ON detection.oid = ss_ztf.oid\nWHERE\n    ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n    AND ss_ztf.ssdistnr <= 2\nORDER BY\n    ss_ztf.ssnamenr ASC,\n    detection.mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All detections for ZTF objects within 2 arcsec of MPC names '2003FP134' or '2009UK56'\n-- Returns: ss_ztf.* plus detection.mjd, detection.fid, detection.isdiffpos, detection.ra, detection.dec, detection.magpsf, detection.sigmapsf\nSELECT\n    ss_ztf.*,\n    detection.mjd,\n    detection.fid,\n    detection.isdiffpos,\n    detection.ra,\n    detection.dec,\n    detection.magpsf,\n    detection.sigmapsf\nFROM ss_ztf\nINNER JOIN detection\n    ON detection.oid = ss_ztf.oid\nWHERE\n    ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n    AND ss_ztf.ssdistnr <= 2\nORDER BY\n    ss_ztf.ssnamenr ASC,\n    detection.mjd ASC;\n```"
                },
                "in_toks": 3139,
                "out_toks": 1102,
                "id": "chatcmpl-CSyKPFNNwwwZXuBfmPMIEZ1x16yQ8",
                "created": 1761021121,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "96",
            "experiment_id": "run_4",
            "pred_tables": [
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf', 'detection']"
                },
                "in_toks": 670,
                "out_toks": 531,
                "id": "chatcmpl-CSspcWJZbw0rLzgXhuLRzEUHioBY6",
                "created": 1760999992,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1191,
                "out_toks": 655,
                "id": "chatcmpl-CSxbDUgJ2mhOd0Uo69XudMn0UJZ4S",
                "created": 1761018319,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and outputs\n- Goal: Retrieve all detections (light-curve points) for ZTF objects whose nearest known Solar System object is either '2003FP134' or '2009UK56' and whose nearest-object angular separation is within 2 arcseconds.\n- Output columns:\n  - All columns from ss_ztf (i.e., ss_ztf.*).\n  - From detection: detection.mjd (detection date), detection.fid (filter identifier), detection.isdiffpos, detection.ra, detection.dec, detection.magpsf (difference magnitude), detection.sigmapsf (difference magnitude uncertainty).\n- Sorting: First by the MPC name (ss_ztf.ssnamenr), then by detection date (detection.mjd).\n\n2) Identify relevant tables, keys, and columns\n- ss_ztf: Per-object Solar System nearest-object metadata.\n  - Key columns to use: ss_ztf.oid (PK, references object), ss_ztf.ssnamenr (name of nearest known Solar System object), ss_ztf.ssdistnr (distance to nearest known Solar System object; in arcseconds), ss_ztf.candid (candidate identifier; not used for filtering).\n- detection: Per-detection photometric measurements (light curve).\n  - Key columns to use: detection.oid (FK to object), detection.mjd, detection.fid, detection.isdiffpos, detection.ra, detection.dec, detection.magpsf, detection.sigmapsf.\n- Relationship: One ss_ztf row per object (oid), many detection rows per object (oid). Join on oid.\n\n3) Define filters and constants\n- Solar System object name filter: ss_ztf.ssnamenr IN ('2003FP134', '2009UK56').\n- Angular separation threshold: ss_ztf.ssdistnr <= 2 (2 arcseconds).\n- No use of the probability table in this query (so no default probability conditions apply).\n- Avoid filtering on detection by any column other than detection.oid (per database advice).\n\n4) Establish the join strategy\n- Start from ss_ztf because it can be heavily filtered by ssnamenr and ssdistnr, reducing the data volume early.\n- Perform an INNER JOIN from ss_ztf to detection on ss_ztf.oid = detection.oid to retrieve all detections belonging to the filtered objects.\n\n5) Specify the SELECT list\n- Include all columns from ss_ztf: ss_ztf.* (this brings oid, candid, ssdistnr, ssmagnr, ssnamenr, etc.).\n- Include required detection columns:\n  - detection.mjd\n  - detection.fid\n  - detection.isdiffpos\n  - detection.ra\n  - detection.dec\n  - detection.magpsf\n  - detection.sigmapsf\n- Note: There will be two columns named candid (one in ss_ztf.*, one in detection), but since you are not selecting detection.candid explicitly, ambiguity is avoided.\n\n6) Sorting requirements\n- ORDER BY ss_ztf.ssnamenr ASC, detection.mjd ASC to meet the \u201csort by MPC name and detection date\u201d requirement.\n\n7) Optional CTE for readability (not required)\n- You may define a small inline list of target Solar System identifiers via a WITH ... VALUES CTE to make the IN-list explicit and maintainable. Then filter ss_ztf against that list. This is optional and purely for clarity.\n\n8) Indexes and performance considerations\n- The filter on ss_ztf.ssnamenr will benefit from the index ix_ss_ztf_ssnamenr.\n- The join on detection.oid will benefit from ix_ndetection_oid (hash index).\n- Filtering on ss_ztf first (using WHERE ssnamenr IN (...) AND ssdistnr <= 2) before joining to detection will minimize the joined row count and improve performance.\n\n9) Edge cases and assumptions\n- ss_ztf.ssdistnr is assumed to be in arcseconds (typical for ZTF alert schema). No unit conversion needed for the 2 arcsec threshold.\n- If ss_ztf.ssnamenr is NULL, those rows are automatically excluded by the IN filter.\n- The query returns all detections for each qualifying object (no deduplication or additional filters).\n- No Q3C spatial functions are needed because the spatial criterion is implemented via ss_ztf.ssdistnr.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and outputs\n- Goal: Retrieve all detections (light-curve points) for ZTF objects whose nearest known Solar System object is either '2003FP134' or '2009UK56' and whose nearest-object angular separation is within 2 arcseconds.\n- Output columns:\n  - All columns from ss_ztf (i.e., ss_ztf.*).\n  - From detection: detection.mjd (detection date), detection.fid (filter identifier), detection.isdiffpos, detection.ra, detection.dec, detection.magpsf (difference magnitude), detection.sigmapsf (difference magnitude uncertainty).\n- Sorting: First by the MPC name (ss_ztf.ssnamenr), then by detection date (detection.mjd).\n\n2) Identify relevant tables, keys, and columns\n- ss_ztf: Per-object Solar System nearest-object metadata.\n  - Key columns to use: ss_ztf.oid (PK, references object), ss_ztf.ssnamenr (name of nearest known Solar System object), ss_ztf.ssdistnr (distance to nearest known Solar System object; in arcseconds), ss_ztf.candid (candidate identifier; not used for filtering).\n- detection: Per-detection photometric measurements (light curve).\n  - Key columns to use: detection.oid (FK to object), detection.mjd, detection.fid, detection.isdiffpos, detection.ra, detection.dec, detection.magpsf, detection.sigmapsf.\n- Relationship: One ss_ztf row per object (oid), many detection rows per object (oid). Join on oid.\n\n3) Define filters and constants\n- Solar System object name filter: ss_ztf.ssnamenr IN ('2003FP134', '2009UK56').\n- Angular separation threshold: ss_ztf.ssdistnr <= 2 (2 arcseconds).\n- No use of the probability table in this query (so no default probability conditions apply).\n- Avoid filtering on detection by any column other than detection.oid (per database advice).\n\n4) Establish the join strategy\n- Start from ss_ztf because it can be heavily filtered by ssnamenr and ssdistnr, reducing the data volume early.\n- Perform an INNER JOIN from ss_ztf to detection on ss_ztf.oid = detection.oid to retrieve all detections belonging to the filtered objects.\n\n5) Specify the SELECT list\n- Include all columns from ss_ztf: ss_ztf.* (this brings oid, candid, ssdistnr, ssmagnr, ssnamenr, etc.).\n- Include required detection columns:\n  - detection.mjd\n  - detection.fid\n  - detection.isdiffpos\n  - detection.ra\n  - detection.dec\n  - detection.magpsf\n  - detection.sigmapsf\n- Note: There will be two columns named candid (one in ss_ztf.*, one in detection), but since you are not selecting detection.candid explicitly, ambiguity is avoided.\n\n6) Sorting requirements\n- ORDER BY ss_ztf.ssnamenr ASC, detection.mjd ASC to meet the \u201csort by MPC name and detection date\u201d requirement.\n\n7) Optional CTE for readability (not required)\n- You may define a small inline list of target Solar System identifiers via a WITH ... VALUES CTE to make the IN-list explicit and maintainable. Then filter ss_ztf against that list. This is optional and purely for clarity.\n\n8) Indexes and performance considerations\n- The filter on ss_ztf.ssnamenr will benefit from the index ix_ss_ztf_ssnamenr.\n- The join on detection.oid will benefit from ix_ndetection_oid (hash index).\n- Filtering on ss_ztf first (using WHERE ssnamenr IN (...) AND ssdistnr <= 2) before joining to detection will minimize the joined row count and improve performance.\n\n9) Edge cases and assumptions\n- ss_ztf.ssdistnr is assumed to be in arcseconds (typical for ZTF alert schema). No unit conversion needed for the 2 arcsec threshold.\n- If ss_ztf.ssnamenr is NULL, those rows are automatically excluded by the IN filter.\n- The query returns all detections for each qualifying object (no deduplication or additional filters).\n- No Q3C spatial functions are needed because the spatial criterion is implemented via ss_ztf.ssdistnr."
                },
                "in_toks": 2799,
                "out_toks": 3637,
                "id": "chatcmpl-CSxp42UZR1bFtgNBNNMUkR1kUajcu",
                "created": 1761019178,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all detections for ZTF objects whose nearest Solar System object is '2003FP134' or '2009UK56' within 2 arcsec\nSELECT\n    ss_ztf.*,\n    detection.mjd,\n    detection.fid,\n    detection.isdiffpos,\n    detection.ra,\n    detection.dec,\n    detection.magpsf,\n    detection.sigmapsf\nFROM ss_ztf\nINNER JOIN detection\n    ON ss_ztf.oid = detection.oid\nWHERE ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n  AND ss_ztf.ssdistnr <= 2\nORDER BY ss_ztf.ssnamenr ASC, detection.mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all detections for ZTF objects whose nearest Solar System object is '2003FP134' or '2009UK56' within 2 arcsec\nSELECT\n    ss_ztf.*,\n    detection.mjd,\n    detection.fid,\n    detection.isdiffpos,\n    detection.ra,\n    detection.dec,\n    detection.magpsf,\n    detection.sigmapsf\nFROM ss_ztf\nINNER JOIN detection\n    ON ss_ztf.oid = detection.oid\nWHERE ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n  AND ss_ztf.ssdistnr <= 2\nORDER BY ss_ztf.ssnamenr ASC, detection.mjd ASC;\n```"
                },
                "in_toks": 3016,
                "out_toks": 2024,
                "id": "chatcmpl-CSyKiv8ZT0jotHfyVI0YxuocD9Vnk",
                "created": 1761021140,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "96",
            "experiment_id": "run_5",
            "pred_tables": [
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf', 'detection']"
                },
                "in_toks": 670,
                "out_toks": 595,
                "id": "chatcmpl-CZNBv4rzxiRw1a1rU7rJAKl0uinnW",
                "created": 1762546663,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1191,
                "out_toks": 975,
                "id": "chatcmpl-CZYfwPCVcOQl8O3TYPr7vuLHM52ti",
                "created": 1762590808,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Clarify input parameters and proximity criterion\n- Solar System object identifiers (MPC names): '2003FP134', '2009UK56'.\n- Angular separation threshold: 2 arcseconds.\n- Use ss_ztf.ssnamenr to select the MPC names and ss_ztf.ssdistnr to enforce the 2 arcsec proximity. The ssdistnr field is the distance (in arcseconds) to the nearest known Solar System object for the associated object/candidate.\n\n2) Identify the base table and filtering conditions\n- Base table: ss_ztf (contains the nearest Solar System object info per ZTF object).\n- Apply filters only on ss_ztf to avoid performance issues on detection:\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n  - ss_ztf.ssdistnr <= 2\n- This ensures we select ZTF objects whose nearest known Solar System object is one of the requested MPC names and is within 2 arcseconds.\n\n3) Join to retrieve all detections for the selected objects\n- Target table for detections: detection.\n- Join key: detection.oid = ss_ztf.oid (INNER JOIN).\n- Do not add any additional filters on detection (per guidance, avoid filtering on detection columns other than oid). This will return all detections for each selected object.\n\n4) Columns to return\n- All columns from ss_ztf:\n  - ss_ztf.oid\n  - ss_ztf.candid\n  - ss_ztf.ssdistnr\n  - ss_ztf.ssmagnr\n  - ss_ztf.ssnamenr\n  - (equivalently select ss_ztf.*)\n- Specific columns from detection:\n  - detection.mjd (detection date, in Modified Julian Date)\n  - detection.fid (filter identifier; 1=g, 2=r, 3=i)\n  - detection.isdiffpos (difference image sign flag)\n  - detection.ra (in degrees)\n  - detection.dec (in degrees)\n  - detection.magpsf (difference magnitude)\n  - detection.sigmapsf (uncertainty of difference magnitude)\n- Note: The user asked for \u201cdifference magnitude (and its uncertainty)\u201d; use detection.magpsf and detection.sigmapsf (not the corrected versions). If corrected magnitudes were desired, fields would be detection.magpsf_corr and detection.sigmapsf_corr.\n\n5) Sorting requirements\n- Sort the final result set by:\n  - ss_ztf.ssnamenr (MPC name), ascending.\n  - detection.mjd (detection date), ascending.\n\n6) Join and selection structure\n- Use ss_ztf as the driving table with the filters in step 2.\n- INNER JOIN detection ON detection.oid = ss_ztf.oid to bring in all detections.\n- SELECT the columns listed in step 4 from both tables.\n\n7) Performance and index considerations\n- The filter on ss_ztf.ssnamenr will use the existing index ix_ss_ztf_ssnamenr.\n- The join on detection.oid will use ix_ndetection_oid (hash index on detection.oid).\n- No spatial Q3C functions are needed because the proximity to the Solar System objects is already provided via ss_ztf.ssdistnr; there are no coordinates for the Solar System objects in the provided schema.\n\n8) No use of probability or object tables\n- The probability and object tables are not needed for this request. Therefore, the default conditions for the probability table do not apply here.\n\n9) Result semantics\n- Each row in the result corresponds to one detection (detection.candid) belonging to a ZTF object (ss_ztf.oid) whose nearest Solar System object matches one of the requested MPC names within 2 arcseconds at the time/association represented in ss_ztf.\n- Since the requirement is \u201cget all detections,\u201d do not aggregate or deduplicate; return one row per detection joined to its ss_ztf record.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Clarify input parameters and proximity criterion\n- Solar System object identifiers (MPC names): '2003FP134', '2009UK56'.\n- Angular separation threshold: 2 arcseconds.\n- Use ss_ztf.ssnamenr to select the MPC names and ss_ztf.ssdistnr to enforce the 2 arcsec proximity. The ssdistnr field is the distance (in arcseconds) to the nearest known Solar System object for the associated object/candidate.\n\n2) Identify the base table and filtering conditions\n- Base table: ss_ztf (contains the nearest Solar System object info per ZTF object).\n- Apply filters only on ss_ztf to avoid performance issues on detection:\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n  - ss_ztf.ssdistnr <= 2\n- This ensures we select ZTF objects whose nearest known Solar System object is one of the requested MPC names and is within 2 arcseconds.\n\n3) Join to retrieve all detections for the selected objects\n- Target table for detections: detection.\n- Join key: detection.oid = ss_ztf.oid (INNER JOIN).\n- Do not add any additional filters on detection (per guidance, avoid filtering on detection columns other than oid). This will return all detections for each selected object.\n\n4) Columns to return\n- All columns from ss_ztf:\n  - ss_ztf.oid\n  - ss_ztf.candid\n  - ss_ztf.ssdistnr\n  - ss_ztf.ssmagnr\n  - ss_ztf.ssnamenr\n  - (equivalently select ss_ztf.*)\n- Specific columns from detection:\n  - detection.mjd (detection date, in Modified Julian Date)\n  - detection.fid (filter identifier; 1=g, 2=r, 3=i)\n  - detection.isdiffpos (difference image sign flag)\n  - detection.ra (in degrees)\n  - detection.dec (in degrees)\n  - detection.magpsf (difference magnitude)\n  - detection.sigmapsf (uncertainty of difference magnitude)\n- Note: The user asked for \u201cdifference magnitude (and its uncertainty)\u201d; use detection.magpsf and detection.sigmapsf (not the corrected versions). If corrected magnitudes were desired, fields would be detection.magpsf_corr and detection.sigmapsf_corr.\n\n5) Sorting requirements\n- Sort the final result set by:\n  - ss_ztf.ssnamenr (MPC name), ascending.\n  - detection.mjd (detection date), ascending.\n\n6) Join and selection structure\n- Use ss_ztf as the driving table with the filters in step 2.\n- INNER JOIN detection ON detection.oid = ss_ztf.oid to bring in all detections.\n- SELECT the columns listed in step 4 from both tables.\n\n7) Performance and index considerations\n- The filter on ss_ztf.ssnamenr will use the existing index ix_ss_ztf_ssnamenr.\n- The join on detection.oid will use ix_ndetection_oid (hash index on detection.oid).\n- No spatial Q3C functions are needed because the proximity to the Solar System objects is already provided via ss_ztf.ssdistnr; there are no coordinates for the Solar System objects in the provided schema.\n\n8) No use of probability or object tables\n- The probability and object tables are not needed for this request. Therefore, the default conditions for the probability table do not apply here.\n\n9) Result semantics\n- Each row in the result corresponds to one detection (detection.candid) belonging to a ZTF object (ss_ztf.oid) whose nearest Solar System object matches one of the requested MPC names within 2 arcseconds at the time/association represented in ss_ztf.\n- Since the requirement is \u201cget all detections,\u201d do not aggregate or deduplicate; return one row per detection joined to its ss_ztf record."
                },
                "in_toks": 2799,
                "out_toks": 2916,
                "id": "chatcmpl-CZZuky0RNPDcOVMtyL0BgUGMjmAJQ",
                "created": 1762595570,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all detections for ZTF objects within 2 arcsec of the specified Solar System identifiers,\n-- returning all ss_ztf columns and selected detection fields; sorted by MPC name and detection date.\nSELECT\n    ss_ztf.*,\n    detection.mjd,\n    detection.fid,\n    detection.isdiffpos,\n    detection.ra,\n    detection.dec,\n    detection.magpsf,\n    detection.sigmapsf\nFROM ss_ztf\nINNER JOIN detection\n    ON detection.oid = ss_ztf.oid\nWHERE\n    ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n    AND ss_ztf.ssdistnr <= 2\nORDER BY\n    ss_ztf.ssnamenr ASC,\n    detection.mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all detections for ZTF objects within 2 arcsec of the specified Solar System identifiers,\n-- returning all ss_ztf columns and selected detection fields; sorted by MPC name and detection date.\nSELECT\n    ss_ztf.*,\n    detection.mjd,\n    detection.fid,\n    detection.isdiffpos,\n    detection.ra,\n    detection.dec,\n    detection.magpsf,\n    detection.sigmapsf\nFROM ss_ztf\nINNER JOIN detection\n    ON detection.oid = ss_ztf.oid\nWHERE\n    ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n    AND ss_ztf.ssdistnr <= 2\nORDER BY\n    ss_ztf.ssnamenr ASC,\n    detection.mjd ASC;\n```"
                },
                "in_toks": 2935,
                "out_toks": 1653,
                "id": "chatcmpl-CZay1JxlPf7RMuBBe4WdwM1J9fhMU",
                "created": 1762599617,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "96",
            "experiment_id": "run_6",
            "pred_tables": [
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf', 'detection']"
                },
                "in_toks": 670,
                "out_toks": 723,
                "id": "chatcmpl-CZNCMPLntAsfpUQpJ1vrx0XgVgLOi",
                "created": 1762546690,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1191,
                "out_toks": 463,
                "id": "chatcmpl-CZYg5XwC2PWn2tnrDsVwwLaROMYV3",
                "created": 1762590817,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- All detections for ZTF objects within 2 arcsec of specified Solar System objects\n\nSELECT ss_ztf.*,\n       detection.mjd,\n       detection.fid,\n       detection.isdiffpos,\n       detection.ra,\n       detection.dec,\n       detection.magpsf,\n       detection.sigmapsf\nFROM ss_ztf\nINNER JOIN detection ON detection.oid = ss_ztf.oid\nWHERE ss_ztf.ssnamenr IN ('2003FP134',\n                          '2009UK56')\n  AND ss_ztf.ssdistnr <= 2\nORDER BY ss_ztf.ssnamenr ASC,\n         detection.mjd ASC;",
            "original_sql_response": {
                "difficulty_class": "medium",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Inputs and constants\n- Solar System object identifiers (MPC names): ['2003FP134', '2009UK56'].\n- Maximum angular separation: 2 arcsec (assumed units of ss_ztf.ssdistnr are arcseconds; no unit conversion needed).\n\n2) Tables and relationships\n- Base table for Solar System cross-match metadata: ss_ztf (columns: oid, candid, ssdistnr, ssmagnr, ssnamenr).\n- Detections/light-curve table: detection (columns used: oid, mjd, fid, isdiffpos, ra, dec, magpsf, sigmapsf).\n- Join key: detection.oid = ss_ztf.oid (INNER JOIN).\n- Indexes that will help:\n  - ss_ztf: ix_ss_ztf_ssnamenr on (ssnamenr) for filtering by MPC name.\n  - detection: ix_ndetection_oid on (oid) for the join.\n\n3) Row filtering (WHERE)\n- Restrict to the requested MPC names:\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56').\n- Restrict to objects within 2 arcsec of the matched Solar System object:\n  - ss_ztf.ssdistnr <= 2.\n- (Implicitly excludes NULL distances since comparison with NULL yields NULL/false.)\n\n4) Join strategy\n- Start from the filtered ss_ztf subset (small set due to name filter and distance threshold).\n- INNER JOIN detection on matching oid to retrieve all detections for each selected object.\n- Avoid additional filters on detection (per guidance) other than the join on oid.\n\n5) Columns to return (projection)\n- All columns from ss_ztf: ss_ztf.*.\n- From detection, only the requested fields:\n  - detection.mjd AS detection_date (detection time; MJD).\n  - detection.fid (filter identifier; 1=g, 2=r, 3=i).\n  - detection.isdiffpos (difference sign flag).\n  - detection.ra, detection.dec (coordinates of the detection).\n  - detection.magpsf, detection.sigmapsf (difference magnitude and its uncertainty).\n\n6) Sorting\n- Primary sort: ss_ztf.ssnamenr ASC (MPC name).\n- Secondary sort: detection.mjd ASC (detection date).\n\n7) Output semantics and checks\n- Each row corresponds to a detection belonging to an object whose nearest known Solar System object matches one of the two MPC names within 2 arcsec.\n- If needed, alias columns for clarity (e.g., detection.mjd AS detection_date), but keep exact column names elsewhere.\n\n8) Performance considerations\n- Ensure the optimizer starts from ss_ztf (leverages ix_ss_ztf_ssnamenr), then joins to detection via ix_ndetection_oid.\n- No Q3C spatial function is required, as ss_ztf.ssdistnr provides the angular separation filter directly.\n\n9) Edge cases\n- If case sensitivity of ssnamenr is a concern, standardize values or rely on exact matches as provided.\n- If ss_ztf.ssdistnr units differ in your deployment, convert 2 arcsec to the appropriate units before comparison (not expected per typical ZTF metadata)."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query\n\n1) Inputs and constants\n- Solar System object identifiers (MPC names): ['2003FP134', '2009UK56'].\n- Maximum angular separation: 2 arcsec (assumed units of ss_ztf.ssdistnr are arcseconds; no unit conversion needed).\n\n2) Tables and relationships\n- Base table for Solar System cross-match metadata: ss_ztf (columns: oid, candid, ssdistnr, ssmagnr, ssnamenr).\n- Detections/light-curve table: detection (columns used: oid, mjd, fid, isdiffpos, ra, dec, magpsf, sigmapsf).\n- Join key: detection.oid = ss_ztf.oid (INNER JOIN).\n- Indexes that will help:\n  - ss_ztf: ix_ss_ztf_ssnamenr on (ssnamenr) for filtering by MPC name.\n  - detection: ix_ndetection_oid on (oid) for the join.\n\n3) Row filtering (WHERE)\n- Restrict to the requested MPC names:\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56').\n- Restrict to objects within 2 arcsec of the matched Solar System object:\n  - ss_ztf.ssdistnr <= 2.\n- (Implicitly excludes NULL distances since comparison with NULL yields NULL/false.)\n\n4) Join strategy\n- Start from the filtered ss_ztf subset (small set due to name filter and distance threshold).\n- INNER JOIN detection on matching oid to retrieve all detections for each selected object.\n- Avoid additional filters on detection (per guidance) other than the join on oid.\n\n5) Columns to return (projection)\n- All columns from ss_ztf: ss_ztf.*.\n- From detection, only the requested fields:\n  - detection.mjd AS detection_date (detection time; MJD).\n  - detection.fid (filter identifier; 1=g, 2=r, 3=i).\n  - detection.isdiffpos (difference sign flag).\n  - detection.ra, detection.dec (coordinates of the detection).\n  - detection.magpsf, detection.sigmapsf (difference magnitude and its uncertainty).\n\n6) Sorting\n- Primary sort: ss_ztf.ssnamenr ASC (MPC name).\n- Secondary sort: detection.mjd ASC (detection date).\n\n7) Output semantics and checks\n- Each row corresponds to a detection belonging to an object whose nearest known Solar System object matches one of the two MPC names within 2 arcsec.\n- If needed, alias columns for clarity (e.g., detection.mjd AS detection_date), but keep exact column names elsewhere.\n\n8) Performance considerations\n- Ensure the optimizer starts from ss_ztf (leverages ix_ss_ztf_ssnamenr), then joins to detection via ix_ndetection_oid.\n- No Q3C spatial function is required, as ss_ztf.ssdistnr provides the angular separation filter directly.\n\n9) Edge cases\n- If case sensitivity of ssnamenr is a concern, standardize values or rely on exact matches as provided.\n- If ss_ztf.ssdistnr units differ in your deployment, convert 2 arcsec to the appropriate units before comparison (not expected per typical ZTF metadata)."
                    },
                    "in_toks": 2799,
                    "out_toks": 2755,
                    "id": "chatcmpl-Cb6tJOZ8XNEGzXN1sB8GSSheo4ZjI",
                    "created": 1762960661,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- All detections for ZTF objects within 2 arcsec of specified Solar System objects\n\nSELECT ss_ztf.*,\n       detection.mjd,\n       detection.fid,\n       detection.isdiffpos,\n       detection.ra,\n       detection.dec,\n       detection.magpsf,\n       detection.sigmapsf\nFROM ss_ztf\nINNER JOIN detection ON detection.oid = ss_ztf.oid\nWHERE ss_ztf.ssnamenr IN ('2003FP134',\n                          '2009UK56')\n  AND ss_ztf.ssdistnr <= 2\nORDER BY ss_ztf.ssnamenr ASC,\n         detection.mjd ASC;"
                        },
                        "in_toks": 2225,
                        "out_toks": 1438,
                        "id": "chatcmpl-Cb6uuxRvpMAxRbl5kx0JMbOj5cwsM",
                        "created": 1762960760,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "96",
            "experiment_id": "run_7",
            "pred_tables": [
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf', 'detection']"
                },
                "in_toks": 670,
                "out_toks": 531,
                "id": "chatcmpl-CZNCgNfUBhd8i8fm8PEpyvSXb7wfq",
                "created": 1762546710,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1191,
                "out_toks": 655,
                "id": "chatcmpl-CZYgBdvxjCAWmbeJo8wHJLYcmnO1h",
                "created": 1762590823,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query:\n\n1) Clarify the goal and inputs\n- Goal: Retrieve all detections for ZTF objects associated (within 2 arcseconds) with any of the specified Solar System objects and return the requested fields, sorted by the Solar System object name and detection time.\n- Inputs provided by the user:\n  - Solar System identifiers (MPC names): '2003FP134', '2009UK56'\n  - Angular separation threshold: 2 arcseconds\n- Interpretation of \u201cMPC name\u201d: use column ss_ztf.ssnamenr\n- Interpretation of \u201cwithin 2 arcsec\u201d: use column ss_ztf.ssdistnr <= 2 (ZTF schema convention is arcseconds)\n- Return columns:\n  - All columns from ss_ztf (ss_ztf.*)\n  - From detection: mjd (detection date), fid (filter identifier), isdiffpos, ra, dec, magpsf (difference magnitude), sigmapsf (uncertainty)\n- Sorting: by ss_ztf.ssnamenr (MPC name) ascending, then detection.mjd ascending\n\n2) Identify the relevant tables and relationships\n- ss_ztf: contains per-object information about the closest known solar system object\n  - Columns needed: oid, candid, ssdistnr, ssmagnr, ssnamenr (and any others since we will select ss_ztf.*)\n  - Filters will be applied on ss_ztf.ssnamenr and ss_ztf.ssdistnr\n  - Indexes available: ix_ss_ztf_ssnamenr (useful for filtering by names), ix_ss_ztf_candid (not used here)\n- detection: contains light-curve detections per object\n  - Columns needed: oid (for joining), mjd, fid, isdiffpos, ra, dec, magpsf, sigmapsf\n  - Join key: detection.oid = ss_ztf.oid\n  - Important performance note: Avoid filters on detection other than oid; we will filter only in ss_ztf, then join by oid\n  - Index available: ix_ndetection_oid on detection(oid)\n\n3) Define filtering conditions\n- Select only ss_ztf rows where:\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n  - ss_ztf.ssdistnr <= 2\n- No need for spatial/Q3C functions, since the proximity information is already precomputed in ss_ztf.ssdistnr\n- Do not add additional filters (e.g., drb, dubious) unless explicitly requested by the user\n\n4) Define the subquery for candidate object selection\n- Create a subquery (or CTE) that selects from ss_ztf all rows matching:\n  - ssnamenr IN ('2003FP134', '2009UK56')\n  - ssdistnr <= 2\n- Return all columns from ss_ztf in this subquery (this becomes the base set of objects/rows)\n\n5) Join to detections\n- INNER JOIN detection on detection.oid = ss_ztf.oid to retrieve all detections for the selected objects\n- This satisfies \u201cget all detections for all ZTF objects that lie within 2 arcsec from any of them\u201d\n- Do not restrict by detection.candid; the user asked for all detections for those objects, not just the candid tied to ss_ztf\n\n6) Select the required columns\n- From ss_ztf: select all columns (ss_ztf.*) to fulfill \u201call columns from the 'ss_ztf' table\u201d\n- From detection: select the following specific columns:\n  - detection.mjd AS mjd\n  - detection.fid AS fid\n  - detection.isdiffpos AS isdiffpos\n  - detection.ra AS ra\n  - detection.dec AS dec\n  - detection.magpsf AS magpsf\n  - detection.sigmapsf AS sigmapsf\n- Avoid selecting detection.candid to prevent duplicate-named columns, since ss_ztf.* already includes ss_ztf.candid\n\n7) Order the results\n- ORDER BY ss_ztf.ssnamenr ASC, detection.mjd ASC\n\n8) Performance considerations\n- The filter on ss_ztf.ssnamenr will leverage ix_ss_ztf_ssnamenr\n- The join to detection by oid will leverage ix_ndetection_oid\n- Ensure no filters are applied on detection beyond the join on oid to keep the query efficient\n\n9) Optional checks and assumptions to document\n- ssdistnr is assumed to be in arcseconds (consistent with ZTF alert schema)\n- ss_ztf has one row per object (oid is PRIMARY KEY), so each object is associated with at most one nearest Solar System name in ss_ztf\n- \u201cMPC name\u201d corresponds to ss_ztf.ssnamenr\n- The query returns all detections for qualifying objects, not only the detection at which the association was determined\n\n10) Summary of the logical flow\n- Subselect from ss_ztf filtering on ssnamenr IN ('2003FP134', '2009UK56') and ssdistnr <= 2\n- Join the resulting set to detection on oid\n- Project ss_ztf.* and the specified detection columns\n- Order by ss_ztf.ssnamenr, detection.mjd",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query:\n\n1) Clarify the goal and inputs\n- Goal: Retrieve all detections for ZTF objects associated (within 2 arcseconds) with any of the specified Solar System objects and return the requested fields, sorted by the Solar System object name and detection time.\n- Inputs provided by the user:\n  - Solar System identifiers (MPC names): '2003FP134', '2009UK56'\n  - Angular separation threshold: 2 arcseconds\n- Interpretation of \u201cMPC name\u201d: use column ss_ztf.ssnamenr\n- Interpretation of \u201cwithin 2 arcsec\u201d: use column ss_ztf.ssdistnr <= 2 (ZTF schema convention is arcseconds)\n- Return columns:\n  - All columns from ss_ztf (ss_ztf.*)\n  - From detection: mjd (detection date), fid (filter identifier), isdiffpos, ra, dec, magpsf (difference magnitude), sigmapsf (uncertainty)\n- Sorting: by ss_ztf.ssnamenr (MPC name) ascending, then detection.mjd ascending\n\n2) Identify the relevant tables and relationships\n- ss_ztf: contains per-object information about the closest known solar system object\n  - Columns needed: oid, candid, ssdistnr, ssmagnr, ssnamenr (and any others since we will select ss_ztf.*)\n  - Filters will be applied on ss_ztf.ssnamenr and ss_ztf.ssdistnr\n  - Indexes available: ix_ss_ztf_ssnamenr (useful for filtering by names), ix_ss_ztf_candid (not used here)\n- detection: contains light-curve detections per object\n  - Columns needed: oid (for joining), mjd, fid, isdiffpos, ra, dec, magpsf, sigmapsf\n  - Join key: detection.oid = ss_ztf.oid\n  - Important performance note: Avoid filters on detection other than oid; we will filter only in ss_ztf, then join by oid\n  - Index available: ix_ndetection_oid on detection(oid)\n\n3) Define filtering conditions\n- Select only ss_ztf rows where:\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n  - ss_ztf.ssdistnr <= 2\n- No need for spatial/Q3C functions, since the proximity information is already precomputed in ss_ztf.ssdistnr\n- Do not add additional filters (e.g., drb, dubious) unless explicitly requested by the user\n\n4) Define the subquery for candidate object selection\n- Create a subquery (or CTE) that selects from ss_ztf all rows matching:\n  - ssnamenr IN ('2003FP134', '2009UK56')\n  - ssdistnr <= 2\n- Return all columns from ss_ztf in this subquery (this becomes the base set of objects/rows)\n\n5) Join to detections\n- INNER JOIN detection on detection.oid = ss_ztf.oid to retrieve all detections for the selected objects\n- This satisfies \u201cget all detections for all ZTF objects that lie within 2 arcsec from any of them\u201d\n- Do not restrict by detection.candid; the user asked for all detections for those objects, not just the candid tied to ss_ztf\n\n6) Select the required columns\n- From ss_ztf: select all columns (ss_ztf.*) to fulfill \u201call columns from the 'ss_ztf' table\u201d\n- From detection: select the following specific columns:\n  - detection.mjd AS mjd\n  - detection.fid AS fid\n  - detection.isdiffpos AS isdiffpos\n  - detection.ra AS ra\n  - detection.dec AS dec\n  - detection.magpsf AS magpsf\n  - detection.sigmapsf AS sigmapsf\n- Avoid selecting detection.candid to prevent duplicate-named columns, since ss_ztf.* already includes ss_ztf.candid\n\n7) Order the results\n- ORDER BY ss_ztf.ssnamenr ASC, detection.mjd ASC\n\n8) Performance considerations\n- The filter on ss_ztf.ssnamenr will leverage ix_ss_ztf_ssnamenr\n- The join to detection by oid will leverage ix_ndetection_oid\n- Ensure no filters are applied on detection beyond the join on oid to keep the query efficient\n\n9) Optional checks and assumptions to document\n- ssdistnr is assumed to be in arcseconds (consistent with ZTF alert schema)\n- ss_ztf has one row per object (oid is PRIMARY KEY), so each object is associated with at most one nearest Solar System name in ss_ztf\n- \u201cMPC name\u201d corresponds to ss_ztf.ssnamenr\n- The query returns all detections for qualifying objects, not only the detection at which the association was determined\n\n10) Summary of the logical flow\n- Subselect from ss_ztf filtering on ssnamenr IN ('2003FP134', '2009UK56') and ssdistnr <= 2\n- Join the resulting set to detection on oid\n- Project ss_ztf.* and the specified detection columns\n- Order by ss_ztf.ssnamenr, detection.mjd"
                },
                "in_toks": 2799,
                "out_toks": 3845,
                "id": "chatcmpl-CZZeBhSHImfptImAfTHagp4GIfTym",
                "created": 1762594543,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all detections for ZTF objects associated within 2 arcsec of the specified Solar System objects\nWITH ss AS (\n    SELECT *\n    FROM ss_ztf\n    WHERE ssnamenr IN ('2003FP134', '2009UK56')\n      AND ssdistnr <= 2 -- arcseconds\n)\nSELECT\n    ss.*,\n    d.mjd,\n    d.fid,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf\nFROM ss\nINNER JOIN detection d\n    ON d.oid = ss.oid -- join by object to retrieve all detections for each matched object\nORDER BY ss.ssnamenr ASC, d.mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all detections for ZTF objects associated within 2 arcsec of the specified Solar System objects\nWITH ss AS (\n    SELECT *\n    FROM ss_ztf\n    WHERE ssnamenr IN ('2003FP134', '2009UK56')\n      AND ssdistnr <= 2 -- arcseconds\n)\nSELECT\n    ss.*,\n    d.mjd,\n    d.fid,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf\nFROM ss\nINNER JOIN detection d\n    ON d.oid = ss.oid -- join by object to retrieve all detections for each matched object\nORDER BY ss.ssnamenr ASC, d.mjd ASC;\n```"
                },
                "in_toks": 3225,
                "out_toks": 1448,
                "id": "chatcmpl-CZayK5McZ8SOnC4BgCtFYg3NYpjeh",
                "created": 1762599636,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "96",
            "experiment_id": "run_8",
            "pred_tables": [
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf', 'detection']"
                },
                "in_toks": 670,
                "out_toks": 851,
                "id": "chatcmpl-CZNCse8UqmzKUux1Aa84mTeoUVBiA",
                "created": 1762546722,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1191,
                "out_toks": 1103,
                "id": "chatcmpl-CZYgIRe1zQRaIrnpLiaIdfPQHkuXe",
                "created": 1762590830,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Define input parameters\n- Solar System identifiers (MPC names): '2003FP134', '2009UK56'\n- Angular separation threshold: 2 arcseconds\n- Tables involved: ss_ztf, detection\n- Required output columns:\n  - All columns from ss_ztf: ss_ztf.*\n  - From detection: mjd (detection date), fid (filter identifier), isdiffpos, ra, dec, magpsf (difference magnitude), sigmapsf (uncertainty of difference magnitude)\n- Sorting: by MPC name (ss_ztf.ssnamenr) ascending, then by detection date (detection.mjd) ascending\n\n2) Choose the base table and filtering criteria\n- Base table: ss_ztf (contains nearest Solar System object metadata per ZTF object)\n- Filter criteria on ss_ztf:\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n  - ss_ztf.ssdistnr <= 2    (assumes ssdistnr is in arcseconds)\n- Rationale: This selects all ZTF objects (by oid) whose nearest known Solar System object matches any of the provided MPC names and is within 2 arcseconds.\n\n3) Isolate the selected ZTF objects\n- Build a subquery (CTE or inline subquery) over ss_ztf that returns the filtered set of objects and their Solar System metadata:\n  - Columns: ss_ztf.oid, ss_ztf.candid, ss_ztf.ssdistnr, ss_ztf.ssmagnr, ss_ztf.ssnamenr\n  - WHERE ss_ztf.ssnamenr IN ('2003FP134', '2009UK56') AND ss_ztf.ssdistnr <= 2\n- This forms a compact set of oids to join against detection, ensuring we avoid filtering directly on detection (per performance guidance).\n\n4) Join to detections to get all detections for those objects\n- INNER JOIN detection ON detection.oid = ss_ztf.oid\n- Do not add additional filters on detection other than via the join on oid (to respect the performance guidance).\n- This will return all detections (all mjd epochs) for every ZTF object meeting the Solar System proximity criteria.\n\n5) Select the requested columns\n- From ss_ztf (all columns):\n  - ss_ztf.oid\n  - ss_ztf.candid\n  - ss_ztf.ssdistnr\n  - ss_ztf.ssmagnr\n  - ss_ztf.ssnamenr\n- From detection (specific columns):\n  - detection.mjd    (detection date; you may alias as detection_mjd if desired)\n  - detection.fid    (filter identifier; 1=g, 2=r, 3=i)\n  - detection.isdiffpos\n  - detection.ra\n  - detection.dec\n  - detection.magpsf\n  - detection.sigmapsf\n\n6) Sorting (ORDER BY)\n- Primary: ss_ztf.ssnamenr ASC (MPC name)\n- Secondary: detection.mjd ASC (detection date)\n\n7) Performance/index considerations\n- The filter on ss_ztf.ssnamenr will leverage the index ix_ss_ztf_ssnamenr.\n- The join on detection.oid will leverage the index ix_ndetection_oid.\n- Keeping filters confined to ss_ztf (and joining to detection by oid) aligns with the guidance to avoid filtering on detection columns other than oid.\n\n8) Optional notes/assumptions\n- ssdistnr is interpreted as an angular distance in arcseconds; the 2 arcsec threshold is applied directly as ssdistnr <= 2.\n- The query returns all detections for qualifying objects, not only detections that individually are within 2 arcsec at each epoch (as requested).\n- If a human-readable date is preferred, post-processing of detection.mjd (MJD) can be done outside SQL or via an additional expression, but the user asked for detection date and the database column is mjd, so select detection.mjd as-is.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Define input parameters\n- Solar System identifiers (MPC names): '2003FP134', '2009UK56'\n- Angular separation threshold: 2 arcseconds\n- Tables involved: ss_ztf, detection\n- Required output columns:\n  - All columns from ss_ztf: ss_ztf.*\n  - From detection: mjd (detection date), fid (filter identifier), isdiffpos, ra, dec, magpsf (difference magnitude), sigmapsf (uncertainty of difference magnitude)\n- Sorting: by MPC name (ss_ztf.ssnamenr) ascending, then by detection date (detection.mjd) ascending\n\n2) Choose the base table and filtering criteria\n- Base table: ss_ztf (contains nearest Solar System object metadata per ZTF object)\n- Filter criteria on ss_ztf:\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n  - ss_ztf.ssdistnr <= 2    (assumes ssdistnr is in arcseconds)\n- Rationale: This selects all ZTF objects (by oid) whose nearest known Solar System object matches any of the provided MPC names and is within 2 arcseconds.\n\n3) Isolate the selected ZTF objects\n- Build a subquery (CTE or inline subquery) over ss_ztf that returns the filtered set of objects and their Solar System metadata:\n  - Columns: ss_ztf.oid, ss_ztf.candid, ss_ztf.ssdistnr, ss_ztf.ssmagnr, ss_ztf.ssnamenr\n  - WHERE ss_ztf.ssnamenr IN ('2003FP134', '2009UK56') AND ss_ztf.ssdistnr <= 2\n- This forms a compact set of oids to join against detection, ensuring we avoid filtering directly on detection (per performance guidance).\n\n4) Join to detections to get all detections for those objects\n- INNER JOIN detection ON detection.oid = ss_ztf.oid\n- Do not add additional filters on detection other than via the join on oid (to respect the performance guidance).\n- This will return all detections (all mjd epochs) for every ZTF object meeting the Solar System proximity criteria.\n\n5) Select the requested columns\n- From ss_ztf (all columns):\n  - ss_ztf.oid\n  - ss_ztf.candid\n  - ss_ztf.ssdistnr\n  - ss_ztf.ssmagnr\n  - ss_ztf.ssnamenr\n- From detection (specific columns):\n  - detection.mjd    (detection date; you may alias as detection_mjd if desired)\n  - detection.fid    (filter identifier; 1=g, 2=r, 3=i)\n  - detection.isdiffpos\n  - detection.ra\n  - detection.dec\n  - detection.magpsf\n  - detection.sigmapsf\n\n6) Sorting (ORDER BY)\n- Primary: ss_ztf.ssnamenr ASC (MPC name)\n- Secondary: detection.mjd ASC (detection date)\n\n7) Performance/index considerations\n- The filter on ss_ztf.ssnamenr will leverage the index ix_ss_ztf_ssnamenr.\n- The join on detection.oid will leverage the index ix_ndetection_oid.\n- Keeping filters confined to ss_ztf (and joining to detection by oid) aligns with the guidance to avoid filtering on detection columns other than oid.\n\n8) Optional notes/assumptions\n- ssdistnr is interpreted as an angular distance in arcseconds; the 2 arcsec threshold is applied directly as ssdistnr <= 2.\n- The query returns all detections for qualifying objects, not only detections that individually are within 2 arcsec at each epoch (as requested).\n- If a human-readable date is preferred, post-processing of detection.mjd (MJD) can be done outside SQL or via an additional expression, but the user asked for detection date and the database column is mjd, so select detection.mjd as-is."
                },
                "in_toks": 2799,
                "out_toks": 3458,
                "id": "chatcmpl-CZZvr2Y1sb2VKDlKslzAHHxP5AD3r",
                "created": 1762595639,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all detections for ZTF objects within 2 arcsec of specified Solar System identifiers\nWITH ss_matches AS (\n    SELECT\n        *\n    FROM\n        ss_ztf\n    WHERE\n        ssnamenr IN ('2003FP134', '2009UK56')\n        AND ssdistnr <= 2\n)\nSELECT\n    ss_matches.*,\n    detection.mjd,\n    detection.fid,\n    detection.isdiffpos,\n    detection.ra,\n    detection.dec,\n    detection.magpsf,\n    detection.sigmapsf\nFROM\n    ss_matches\nINNER JOIN\n    detection\nON\n    detection.oid = ss_matches.oid\nORDER BY\n    ss_matches.ssnamenr ASC,\n    detection.mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all detections for ZTF objects within 2 arcsec of specified Solar System identifiers\nWITH ss_matches AS (\n    SELECT\n        *\n    FROM\n        ss_ztf\n    WHERE\n        ssnamenr IN ('2003FP134', '2009UK56')\n        AND ssdistnr <= 2\n)\nSELECT\n    ss_matches.*,\n    detection.mjd,\n    detection.fid,\n    detection.isdiffpos,\n    detection.ra,\n    detection.dec,\n    detection.magpsf,\n    detection.sigmapsf\nFROM\n    ss_matches\nINNER JOIN\n    detection\nON\n    detection.oid = ss_matches.oid\nORDER BY\n    ss_matches.ssnamenr ASC,\n    detection.mjd ASC;\n```"
                },
                "in_toks": 2965,
                "out_toks": 1256,
                "id": "chatcmpl-CZawylkRXDORpnMeNkLpUh5TDAhc2",
                "created": 1762599552,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "96",
            "experiment_id": "run_9",
            "pred_tables": [
                "ss_ztf",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['ss_ztf', 'detection']"
                },
                "in_toks": 670,
                "out_toks": 659,
                "id": "chatcmpl-CZNDFfBRkseQkMlaZYZn8biwm646x",
                "created": 1762546745,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1191,
                "out_toks": 783,
                "id": "chatcmpl-CZYgSofifD3Oe9uHeuZZEysDY8VhA",
                "created": 1762590840,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Clarify intent and assumptions\n- Goal: Retrieve all detections for ZTF objects that are associated (in ss_ztf) with either Solar System identifier '2003FP134' or '2009UK56' and are within 2 arcsec of that Solar System object.\n- Interpretation:\n  - Use ss_ztf.ssnamenr to select matches to the given MPC identifiers.\n  - Use ss_ztf.ssdistnr to enforce the 2 arcsec proximity threshold (assumed to be in arcseconds).\n  - Join to detection by oid to get all detections for those objects; do not filter detection on any other parameter (per database guidance).\n- No probability/object tables are needed; therefore, no default probability conditions apply.\n\n2) Identify tables and relevant columns\n- ss_ztf (one row per ZTF object):\n  - oid (PK, references object.oid)\n  - candid (BIGINT)\n  - ssdistnr (DOUBLE PRECISION) \u2014 distance to nearest known solar system object\n  - ssmagnr (DOUBLE PRECISION) \u2014 magnitude of nearest known solar system object\n  - ssnamenr (VARCHAR) \u2014 MPC name (or 'null' string when not matched)\n- detection (light-curve detections for each object):\n  - candid (BIGINT, PK)\n  - oid (VARCHAR, FK to object.oid)\n  - mjd (DOUBLE PRECISION) \u2014 detection date (MJD)\n  - fid (INTEGER) \u2014 filter id (1=g, 2=r, 3=i)\n  - isdiffpos (INTEGER)\n  - ra (DOUBLE PRECISION)\n  - dec (DOUBLE PRECISION)\n  - magpsf (DOUBLE PRECISION) \u2014 difference magnitude\n  - sigmapsf (DOUBLE PRECISION) \u2014 uncertainty in difference magnitude\n  - Other columns exist but are not requested; avoid filtering on them.\n\n3) Define input filters and constants\n- Solar System identifiers: {'2003FP134', '2009UK56'}\n- Angular separation threshold: 2 arcsec\n- Column-based filters on ss_ztf:\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n  - ss_ztf.ssdistnr <= 2\n\n4) Build the candidate set of objects (subquery/CTE)\n- From ss_ztf, select rows satisfying:\n  - ssnamenr IN ('2003FP134', '2009UK56')\n  - AND ssdistnr <= 2\n- Keep all columns from ss_ztf in this subquery because the final output requires \u201call columns from ss_ztf.\u201d\n- This subquery produces the list of oids (and associated ss_ztf attributes) relevant to the request.\n\n5) Join detections\n- Perform an INNER JOIN from the candidate ss_ztf subquery to detection on oid:\n  - detection.oid = ss_ztf.oid\n- Do not apply additional filters on detection (per guidance to avoid filtering detection by non-oid parameters unless necessary).\n\n6) Select output columns\n- Include all columns from ss_ztf:\n  - ss_ztf.oid, ss_ztf.candid, ss_ztf.ssdistnr, ss_ztf.ssmagnr, ss_ztf.ssnamenr\n- Include requested detection columns:\n  - detection.mjd (detection date)\n  - detection.fid (filter identifier)\n  - detection.isdiffpos\n  - detection.ra, detection.dec (coordinates)\n  - detection.magpsf (difference magnitude)\n  - detection.sigmapsf (uncertainty of difference magnitude)\n- Be explicit to avoid pulling detection.candid (not requested). Note that ss_ztf.* already includes ss_ztf.candid; keep detection.candid out of the projection unless needed.\n\n7) Sort the result\n- ORDER BY:\n  - ss_ztf.ssnamenr ASC (MPC name)\n  - detection.mjd ASC (detection date)\n\n8) Performance considerations\n- The filter on ss_ztf.ssnamenr uses index ix_ss_ztf_ssnamenr.\n- The join to detection on oid benefits from ix_ndetection_oid (hash index).\n- Selecting candidate oids first (via a subquery or CTE) and then joining to detection will be efficient.\n\n9) Result semantics\n- Each row corresponds to one detection of a ZTF object whose nearest known SSO is either '2003FP134' or '2009UK56' and within 2 arcsec according to ss_ztf.ssdistnr.\n- If an oid has many detections, all will be returned, each paired with the same ss_ztf row.\n\n10) Optional aliasing (purely cosmetic)\n- You may alias detection.mjd as detection_date for readability; similarly, you can alias other columns if desired. This is optional; the required columns are identified above.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Clarify intent and assumptions\n- Goal: Retrieve all detections for ZTF objects that are associated (in ss_ztf) with either Solar System identifier '2003FP134' or '2009UK56' and are within 2 arcsec of that Solar System object.\n- Interpretation:\n  - Use ss_ztf.ssnamenr to select matches to the given MPC identifiers.\n  - Use ss_ztf.ssdistnr to enforce the 2 arcsec proximity threshold (assumed to be in arcseconds).\n  - Join to detection by oid to get all detections for those objects; do not filter detection on any other parameter (per database guidance).\n- No probability/object tables are needed; therefore, no default probability conditions apply.\n\n2) Identify tables and relevant columns\n- ss_ztf (one row per ZTF object):\n  - oid (PK, references object.oid)\n  - candid (BIGINT)\n  - ssdistnr (DOUBLE PRECISION) \u2014 distance to nearest known solar system object\n  - ssmagnr (DOUBLE PRECISION) \u2014 magnitude of nearest known solar system object\n  - ssnamenr (VARCHAR) \u2014 MPC name (or 'null' string when not matched)\n- detection (light-curve detections for each object):\n  - candid (BIGINT, PK)\n  - oid (VARCHAR, FK to object.oid)\n  - mjd (DOUBLE PRECISION) \u2014 detection date (MJD)\n  - fid (INTEGER) \u2014 filter id (1=g, 2=r, 3=i)\n  - isdiffpos (INTEGER)\n  - ra (DOUBLE PRECISION)\n  - dec (DOUBLE PRECISION)\n  - magpsf (DOUBLE PRECISION) \u2014 difference magnitude\n  - sigmapsf (DOUBLE PRECISION) \u2014 uncertainty in difference magnitude\n  - Other columns exist but are not requested; avoid filtering on them.\n\n3) Define input filters and constants\n- Solar System identifiers: {'2003FP134', '2009UK56'}\n- Angular separation threshold: 2 arcsec\n- Column-based filters on ss_ztf:\n  - ss_ztf.ssnamenr IN ('2003FP134', '2009UK56')\n  - ss_ztf.ssdistnr <= 2\n\n4) Build the candidate set of objects (subquery/CTE)\n- From ss_ztf, select rows satisfying:\n  - ssnamenr IN ('2003FP134', '2009UK56')\n  - AND ssdistnr <= 2\n- Keep all columns from ss_ztf in this subquery because the final output requires \u201call columns from ss_ztf.\u201d\n- This subquery produces the list of oids (and associated ss_ztf attributes) relevant to the request.\n\n5) Join detections\n- Perform an INNER JOIN from the candidate ss_ztf subquery to detection on oid:\n  - detection.oid = ss_ztf.oid\n- Do not apply additional filters on detection (per guidance to avoid filtering detection by non-oid parameters unless necessary).\n\n6) Select output columns\n- Include all columns from ss_ztf:\n  - ss_ztf.oid, ss_ztf.candid, ss_ztf.ssdistnr, ss_ztf.ssmagnr, ss_ztf.ssnamenr\n- Include requested detection columns:\n  - detection.mjd (detection date)\n  - detection.fid (filter identifier)\n  - detection.isdiffpos\n  - detection.ra, detection.dec (coordinates)\n  - detection.magpsf (difference magnitude)\n  - detection.sigmapsf (uncertainty of difference magnitude)\n- Be explicit to avoid pulling detection.candid (not requested). Note that ss_ztf.* already includes ss_ztf.candid; keep detection.candid out of the projection unless needed.\n\n7) Sort the result\n- ORDER BY:\n  - ss_ztf.ssnamenr ASC (MPC name)\n  - detection.mjd ASC (detection date)\n\n8) Performance considerations\n- The filter on ss_ztf.ssnamenr uses index ix_ss_ztf_ssnamenr.\n- The join to detection on oid benefits from ix_ndetection_oid (hash index).\n- Selecting candidate oids first (via a subquery or CTE) and then joining to detection will be efficient.\n\n9) Result semantics\n- Each row corresponds to one detection of a ZTF object whose nearest known SSO is either '2003FP134' or '2009UK56' and within 2 arcsec according to ss_ztf.ssdistnr.\n- If an oid has many detections, all will be returned, each paired with the same ss_ztf row.\n\n10) Optional aliasing (purely cosmetic)\n- You may alias detection.mjd as detection_date for readability; similarly, you can alias other columns if desired. This is optional; the required columns are identified above."
                },
                "in_toks": 2799,
                "out_toks": 3234,
                "id": "chatcmpl-CZZx6EhF4vXSSJTHn5vyuAgV9rBbt",
                "created": 1762595716,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- All ss_ztf columns plus selected detection fields for objects matched to MPC names within 2 arcsec\nSELECT\n    sst.*,\n    d.mjd,\n    d.fid,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf\nFROM ss_ztf AS sst\nINNER JOIN detection AS d\n    ON d.oid = sst.oid\nWHERE\n    sst.ssnamenr IN ('2003FP134', '2009UK56')\n    AND sst.ssdistnr <= 2\nORDER BY\n    sst.ssnamenr ASC,\n    d.mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All ss_ztf columns plus selected detection fields for objects matched to MPC names within 2 arcsec\nSELECT\n    sst.*,\n    d.mjd,\n    d.fid,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf\nFROM ss_ztf AS sst\nINNER JOIN detection AS d\n    ON d.oid = sst.oid\nWHERE\n    sst.ssnamenr IN ('2003FP134', '2009UK56')\n    AND sst.ssdistnr <= 2\nORDER BY\n    sst.ssnamenr ASC,\n    d.mjd ASC;\n```"
                },
                "in_toks": 3125,
                "out_toks": 1117,
                "id": "chatcmpl-CZax43aVczSZbflsycSVmPDOyKyXf",
                "created": 1762599558,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "67": {
        "0": {
            "req_id": "67",
            "experiment_id": "run_0",
            "pred_tables": [
                "gaia_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['gaia_ztf']",
                    "1": "['gaia_ztf', 'object']"
                },
                "in_toks": 648,
                "out_toks": 931,
                "id": "chatcmpl-CSnaGUytjCCf9415XtrvZMWaAk4FK",
                "created": 1760979820,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 676,
                "out_toks": 207,
                "id": "chatcmpl-CSnplnXcSxETW7zaPTltFMG8zUm2W",
                "created": 1760980781,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Rows in gaia_ztf for the specified ZTF objects where the nearest Gaia source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia IS NOT NULL\n  AND neargaia <= 1.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Rows in gaia_ztf for the specified ZTF objects where the nearest Gaia source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia IS NOT NULL\n  AND neargaia <= 1.5;\n```"
                },
                "in_toks": 1994,
                "out_toks": 1059,
                "id": "chatcmpl-CSqtOX5wfKa3vU8zPdmTCxOWHDdm3",
                "created": 1760992538,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "67",
            "experiment_id": "run_1",
            "pred_tables": [
                "gaia_ztf",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['gaia_ztf']",
                    "1": "['gaia_ztf', 'object']"
                },
                "in_toks": 648,
                "out_toks": 931,
                "id": "chatcmpl-CSnaGUytjCCf9415XtrvZMWaAk4FK",
                "created": 1760979820,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1158,
                "out_toks": 335,
                "id": "chatcmpl-CSnppfvUZqs7gLRMn9w4A9yU8fMdb",
                "created": 1760980785,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Select all gaia_ztf rows for the specified ZTF objects where the nearest Gaia source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Select all gaia_ztf rows for the specified ZTF objects where the nearest Gaia source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```"
                },
                "in_toks": 2476,
                "out_toks": 859,
                "id": "chatcmpl-CSqtB9TMYvGxKIkBWUigVu8ClqaVQ",
                "created": 1760992525,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "67",
            "experiment_id": "run_2",
            "pred_tables": [
                "gaia_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['gaia_ztf']"
                },
                "in_toks": 648,
                "out_toks": 208,
                "id": "chatcmpl-CSsplOdikbQAradcsiK5uv8RTHMv4",
                "created": 1761000001,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 676,
                "out_toks": 335,
                "id": "chatcmpl-CSxbKVe3Fg7C3SteaPP4zH9pJBqAJ",
                "created": 1761018326,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find rows in gaia_ztf for the specified ZTF objects where the nearest Gaia source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find rows in gaia_ztf for the specified ZTF objects where the nearest Gaia source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```"
                },
                "in_toks": 1994,
                "out_toks": 923,
                "id": "chatcmpl-CSxptwjwMIstApr9ywkt0HEiWUcaR",
                "created": 1761019229,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "67",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "gaia_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'gaia_ztf']"
                },
                "in_toks": 648,
                "out_toks": 595,
                "id": "chatcmpl-CSsppMZDzN4HhmobWOmMv2yCN0REl",
                "created": 1761000005,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1158,
                "out_toks": 207,
                "id": "chatcmpl-CSxbOGtcfbNMJFSepWuEM3JbGwtOH",
                "created": 1761018330,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all GAIA crossmatch rows for the specified ZTF objects\n-- where the nearest GAIA source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all GAIA crossmatch rows for the specified ZTF objects\n-- where the nearest GAIA source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```"
                },
                "in_toks": 2476,
                "out_toks": 541,
                "id": "chatcmpl-CSxq6JI7p8vtF9AjjE5J7HnTKFjDd",
                "created": 1761019242,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "67",
            "experiment_id": "run_4",
            "pred_tables": [
                "gaia_ztf",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['gaia_ztf', 'object']"
                },
                "in_toks": 648,
                "out_toks": 659,
                "id": "chatcmpl-CSspwe4D0RrEAl9tyOvomlbSMqGjf",
                "created": 1761000012,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1158,
                "out_toks": 335,
                "id": "chatcmpl-CSxbSBTigLMwY2lZPeFMAlwhRQIqK",
                "created": 1761018334,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Select all rows from gaia_ztf for the specified ZTF objects\n-- where the nearest Gaia source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Select all rows from gaia_ztf for the specified ZTF objects\n-- where the nearest Gaia source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```"
                },
                "in_toks": 2476,
                "out_toks": 670,
                "id": "chatcmpl-CSxqFqOZe2DvMhXCkYnM1gMM6aksJ",
                "created": 1761019251,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "67",
            "experiment_id": "run_5",
            "pred_tables": [
                "gaia_ztf",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['gaia_ztf', 'object']"
                },
                "in_toks": 648,
                "out_toks": 531,
                "id": "chatcmpl-CZNDVeGhefrspHar9wR8NYzlmMTDK",
                "created": 1762546761,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1158,
                "out_toks": 143,
                "id": "chatcmpl-CZYgejXWcPwsUPy5D2tHL8fBhCaUh",
                "created": 1762590852,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find Gaia matches within 1.5 arcsec for specified ZTF objects\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find Gaia matches within 1.5 arcsec for specified ZTF objects\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```"
                },
                "in_toks": 2476,
                "out_toks": 847,
                "id": "chatcmpl-CZZflH0rg7PILLxQbzVc5pgT4L3Nk",
                "created": 1762594641,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "67",
            "experiment_id": "run_6",
            "pred_tables": [
                "gaia_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['gaia_ztf']"
                },
                "in_toks": 648,
                "out_toks": 272,
                "id": "chatcmpl-CZNDoU4fJBQr6Nw9ugbAyZeJcxWhg",
                "created": 1762546780,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 676,
                "out_toks": 79,
                "id": "chatcmpl-CZYghsmw9Z5xuiJY3lCgL6HaH9OGF",
                "created": 1762590855,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find ZTF objects whose nearest Gaia source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find ZTF objects whose nearest Gaia source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```"
                },
                "in_toks": 1994,
                "out_toks": 656,
                "id": "chatcmpl-CZZyUlUeuM3FHP2ISyShJJNPKMs3e",
                "created": 1762595802,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "67",
            "experiment_id": "run_7",
            "pred_tables": [
                "gaia_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['gaia_ztf']"
                },
                "in_toks": 648,
                "out_toks": 336,
                "id": "chatcmpl-CZNDveg46DuJDhK6w70wgSDExec6x",
                "created": 1762546787,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 676,
                "out_toks": 335,
                "id": "chatcmpl-CZYgk05Ww5YIrv78Wbqzb0kdIZwRN",
                "created": 1762590858,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Rows in gaia_ztf for the specified ZTF objects where the nearest Gaia source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Rows in gaia_ztf for the specified ZTF objects where the nearest Gaia source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```"
                },
                "in_toks": 1994,
                "out_toks": 1050,
                "id": "chatcmpl-CZZy7CLdLsZdCpzHAxdbskEFVTEeO",
                "created": 1762595779,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "67",
            "experiment_id": "run_8",
            "pred_tables": [
                "gaia_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['gaia_ztf']"
                },
                "in_toks": 648,
                "out_toks": 272,
                "id": "chatcmpl-CZNE3Ck1YeZ5J8w7nc1Tj3n1Bkknj",
                "created": 1762546795,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 676,
                "out_toks": 399,
                "id": "chatcmpl-CZYgoqmeKMgrYVf2uFMoctzlZeAFD",
                "created": 1762590862,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find ZTF objects whose closest Gaia DR1 source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find ZTF objects whose closest Gaia DR1 source is within 1.5 arcsec\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```"
                },
                "in_toks": 1994,
                "out_toks": 658,
                "id": "chatcmpl-CZZgiIfW0A59k8QMVIyedaPbEyMRs",
                "created": 1762594700,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "67",
            "experiment_id": "run_9",
            "pred_tables": [
                "gaia_ztf"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['gaia_ztf']"
                },
                "in_toks": 648,
                "out_toks": 912,
                "id": "chatcmpl-CZNEB58MdOGg0ySHK5t8KLwWGdX42",
                "created": 1762546803,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 676,
                "out_toks": 207,
                "id": "chatcmpl-CZYgtTQbxYWNTeafMP79EHesOV8QP",
                "created": 1762590867,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Gaia matches within 1.5 arcsec for the specified ZTF objects\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Gaia matches within 1.5 arcsec for the specified ZTF objects\nSELECT *\nFROM gaia_ztf\nWHERE oid IN ('ZTF18acxlskz', 'ZTF22aanppbi', 'ZTF22abunrft')\n  AND neargaia <= 1.5;\n```"
                },
                "in_toks": 1994,
                "out_toks": 911,
                "id": "chatcmpl-CZZyrIV1CX2nTDDMDo5K7YUXrrGdJ",
                "created": 1762595825,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "55": {
        "0": {
            "req_id": "55",
            "experiment_id": "run_0",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']",
                    "1": "['object']"
                },
                "in_toks": 607,
                "out_toks": 152,
                "id": "chatcmpl-CSnaSBPUHxkKdTVX9uu5LJq1mn5IH",
                "created": 1760979832,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 900,
                "out_toks": 79,
                "id": "chatcmpl-CSnpugvlvR2ry3c7PVKm6dPVZeyO6",
                "created": 1760980790,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get all columns from the object table for the specified ZTF object\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns from the object table for the specified ZTF object\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```"
                },
                "in_toks": 2217,
                "out_toks": 172,
                "id": "chatcmpl-CSqtLJkKWo6ODSwQ4Q1T3ygeXNKnt",
                "created": 1760992535,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "55",
            "experiment_id": "run_1",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']",
                    "1": "['object']"
                },
                "in_toks": 607,
                "out_toks": 152,
                "id": "chatcmpl-CSnaSBPUHxkKdTVX9uu5LJq1mn5IH",
                "created": 1760979832,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 900,
                "out_toks": 143,
                "id": "chatcmpl-CSnpwGzTVZC9LcYmRYWuJRxhRBDIf",
                "created": 1760980792,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all available columns for the specified ZTF object from the 'object' table\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all available columns for the specified ZTF object from the 'object' table\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```"
                },
                "in_toks": 2217,
                "out_toks": 239,
                "id": "chatcmpl-CSqtRDoXd7yUS7cQev4na8Ekc80Up",
                "created": 1760992541,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "55",
            "experiment_id": "run_2",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 607,
                "out_toks": 76,
                "id": "chatcmpl-CSsq5bY7poSRBtc2zabSHirIfCTY2",
                "created": 1761000021,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 900,
                "out_toks": 143,
                "id": "chatcmpl-CSxbWGVf8dyhl1zpBb0RB3WsYtqyT",
                "created": 1761018338,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all columns from the 'object' table for the specified ZTF object\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the 'object' table for the specified ZTF object\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```"
                },
                "in_toks": 2217,
                "out_toks": 302,
                "id": "chatcmpl-CSxhMaGHmeZKjtW1LKdtDIUzQyTfi",
                "created": 1761018700,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "55",
            "experiment_id": "run_3",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 607,
                "out_toks": 140,
                "id": "chatcmpl-CSsq76jBrHlKkFCsrtti92MwtoQtI",
                "created": 1761000023,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 900,
                "out_toks": 271,
                "id": "chatcmpl-CSxbZle2WTLiZXcOMnCAq10TU6Cua",
                "created": 1761018341,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Retrieve all columns for the specified ZTF object from the object table\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Retrieve all columns for the specified ZTF object from the object table\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```"
                },
                "in_toks": 2217,
                "out_toks": 172,
                "id": "chatcmpl-CSxhTFrMAoHEhcQK1PRY4jYOoecdi",
                "created": 1761018707,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "55",
            "experiment_id": "run_4",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 607,
                "out_toks": 12,
                "id": "chatcmpl-CSsqAHC52r5ekJLkXhIFyQN8ur36w",
                "created": 1761000026,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 900,
                "out_toks": 79,
                "id": "chatcmpl-CSxbc26m54J2qsNmtIthhDk5dJtG4",
                "created": 1761018344,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return all columns from the object table for the given ZTF object\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from the object table for the given ZTF object\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```"
                },
                "in_toks": 2217,
                "out_toks": 236,
                "id": "chatcmpl-CSxhaJcxKToQvzcjtcwBU5CIxTSMv",
                "created": 1761018714,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "55",
            "experiment_id": "run_5",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 607,
                "out_toks": 140,
                "id": "chatcmpl-CZNEXhUZ3LKdVzVL0Q2sVuP00jaZO",
                "created": 1762546825,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 900,
                "out_toks": 143,
                "id": "chatcmpl-CZYgxXe0ZfFVCSaiyLGtMrpFT1bdy",
                "created": 1762590871,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Retrieve all available information for the specified ZTF object from the 'object' table\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Retrieve all available information for the specified ZTF object from the 'object' table\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```"
                },
                "in_toks": 2217,
                "out_toks": 239,
                "id": "chatcmpl-CZZhCReZU7ragELhFpB1J2lSne4pS",
                "created": 1762594730,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "55",
            "experiment_id": "run_6",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 607,
                "out_toks": 76,
                "id": "chatcmpl-CZNEab1jXDv3mjIeg9NuNu9iAsRKz",
                "created": 1762546828,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 900,
                "out_toks": 79,
                "id": "chatcmpl-CZYgzw2ZWSzXOcDBvIxp9NIVQx6qC",
                "created": 1762590873,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get all columns from the 'object' table for the specified ZTF object\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns from the 'object' table for the specified ZTF object\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```"
                },
                "in_toks": 2217,
                "out_toks": 238,
                "id": "chatcmpl-CZZytTI14WIdv0ReXtmV7CM1uwecY",
                "created": 1762595827,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "55",
            "experiment_id": "run_7",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 607,
                "out_toks": 76,
                "id": "chatcmpl-CZNEeFg7CB2OaHJFzKQgOVNPrfxXR",
                "created": 1762546832,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 900,
                "out_toks": 79,
                "id": "chatcmpl-CZYh0R0k3ZMjcnG2OFS5CD8SKTefO",
                "created": 1762590874,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Retrieve all columns for the specified ZTF object from the object table\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Retrieve all columns for the specified ZTF object from the object table\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```"
                },
                "in_toks": 2217,
                "out_toks": 172,
                "id": "chatcmpl-CZZzISOGnLxlLRMeLZvFqxxRSWZGz",
                "created": 1762595852,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "55",
            "experiment_id": "run_8",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 607,
                "out_toks": 76,
                "id": "chatcmpl-CZNEhpts7D8Q1xoF6rUc5ifxdDzwN",
                "created": 1762546835,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 900,
                "out_toks": 207,
                "id": "chatcmpl-CZYh3Qw1WgskKP28hRqHBkX4gk5tT",
                "created": 1762590877,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get all information from the 'object' table for the specified ZTF object\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all information from the 'object' table for the specified ZTF object\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```"
                },
                "in_toks": 2217,
                "out_toks": 302,
                "id": "chatcmpl-CZZhRDdC5UDd9LuzwfwasbefhWeiW",
                "created": 1762594745,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "55",
            "experiment_id": "run_9",
            "pred_tables": [
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object']"
                },
                "in_toks": 607,
                "out_toks": 76,
                "id": "chatcmpl-CZNEkcoGtqzsvcyQLqljhSikpAAZ4",
                "created": 1762546838,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 900,
                "out_toks": 143,
                "id": "chatcmpl-CZYh7OoKiSV9LVquPG3VHDLxzlt2J",
                "created": 1762590881,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get all columns from the 'object' table for the specified ZTF object\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns from the 'object' table for the specified ZTF object\nSELECT *\nFROM object\nWHERE oid = 'ZTF20aatxryt';\n```"
                },
                "in_toks": 2217,
                "out_toks": 238,
                "id": "chatcmpl-CZZz3hvUsrr5N9rzEq8H6Dfc1YsF6",
                "created": 1762595837,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "47": {
        "0": {
            "req_id": "47",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']",
                    "1": "['object', 'detection']"
                },
                "in_toks": 673,
                "out_toks": 1312,
                "id": "chatcmpl-CSnaUMpSjCI2qddNmQ0rA2gvPnDvX",
                "created": 1760979834,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1514,
                "out_toks": 463,
                "id": "chatcmpl-CSnpzlkrHGvCyLwl9TFxd565Yt8wx",
                "created": 1760980795,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Detections for specified ZTF objects with real/bogus score > 0.7\nSELECT\n    d.oid,            -- ZTF identifier\n    d.candid,         -- candidate identifier\n    d.fid,            -- filter identifier (1=g; 2=r; 3=i)\n    d.mjd,            -- detection date (MJD)\n    d.isdiffpos,      -- isdiffpos flag\n    d.ra,             -- detection RA\n    d.dec,            -- detection Dec\n    d.magpsf,         -- difference magnitude\n    d.sigmapsf,       -- difference magnitude uncertainty\n    d.rb              -- real/bogus score\nFROM detection d\nWHERE d.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND d.rb > 0.7\nORDER BY d.oid, d.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Detections for specified ZTF objects with real/bogus score > 0.7\nSELECT\n    d.oid,            -- ZTF identifier\n    d.candid,         -- candidate identifier\n    d.fid,            -- filter identifier (1=g; 2=r; 3=i)\n    d.mjd,            -- detection date (MJD)\n    d.isdiffpos,      -- isdiffpos flag\n    d.ra,             -- detection RA\n    d.dec,            -- detection Dec\n    d.magpsf,         -- difference magnitude\n    d.sigmapsf,       -- difference magnitude uncertainty\n    d.rb              -- real/bogus score\nFROM detection d\nWHERE d.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND d.rb > 0.7\nORDER BY d.oid, d.mjd;\n```"
                },
                "in_toks": 2832,
                "out_toks": 1354,
                "id": "chatcmpl-CSqtYE2BTOgxKuAjExtDB0IsnzdsA",
                "created": 1760992548,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "47",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']",
                    "1": "['object', 'detection']"
                },
                "in_toks": 673,
                "out_toks": 1312,
                "id": "chatcmpl-CSnaUMpSjCI2qddNmQ0rA2gvPnDvX",
                "created": 1760979834,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1514,
                "out_toks": 271,
                "id": "chatcmpl-CSnq6sLLjJFMai7JbBZ1w1a7VKFbY",
                "created": 1760980802,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Detections for the specified ZTF objects with deep-learning real/bogus score (drb) > 0.7\n-- Returns: oid (ZTF identifier), candid, fid, mjd, isdiffpos, ra, dec, magpsf, sigmapsf, drb\nSELECT\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf,\n    d.drb\nFROM detection AS d\nWHERE d.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND d.drb > 0.7\nORDER BY d.oid, d.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Detections for the specified ZTF objects with deep-learning real/bogus score (drb) > 0.7\n-- Returns: oid (ZTF identifier), candid, fid, mjd, isdiffpos, ra, dec, magpsf, sigmapsf, drb\nSELECT\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf,\n    d.drb\nFROM detection AS d\nWHERE d.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND d.drb > 0.7\nORDER BY d.oid, d.mjd;\n```"
                },
                "in_toks": 2832,
                "out_toks": 2097,
                "id": "chatcmpl-CSqtYiyM9ET4er3sG2sFxF56nsW49",
                "created": 1760992548,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "47",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 673,
                "out_toks": 976,
                "id": "chatcmpl-CSsqDfN810u0NE7MRFISMNk0ZWp18",
                "created": 1761000029,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1514,
                "out_toks": 463,
                "id": "chatcmpl-CSxbeqKvaBDhYVeJkN5Wno5iOgko6",
                "created": 1761018346,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Detections for specified ZTF objects with ZTF real-bogus score > 0.7\nSELECT\n    detection.oid,\n    detection.candid,\n    detection.fid,\n    detection.mjd,\n    detection.isdiffpos,\n    detection.ra,\n    detection.dec,\n    detection.magpsf,\n    detection.sigmapsf,\n    detection.rb\nFROM detection\nWHERE detection.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND detection.rb > 0.7\nORDER BY detection.oid, detection.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Detections for specified ZTF objects with ZTF real-bogus score > 0.7\nSELECT\n    detection.oid,\n    detection.candid,\n    detection.fid,\n    detection.mjd,\n    detection.isdiffpos,\n    detection.ra,\n    detection.dec,\n    detection.magpsf,\n    detection.sigmapsf,\n    detection.rb\nFROM detection\nWHERE detection.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND detection.rb > 0.7\nORDER BY detection.oid, detection.mjd;\n```"
                },
                "in_toks": 2832,
                "out_toks": 1349,
                "id": "chatcmpl-CSxhiPVDn9tkLCboMF7rSBXFtTpEj",
                "created": 1761018722,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "47",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 673,
                "out_toks": 464,
                "id": "chatcmpl-CSsqQGVpukh81zrRbJ3WPTmiWcOoI",
                "created": 1761000042,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1514,
                "out_toks": 271,
                "id": "chatcmpl-CSxbk2DnGGZ4cdpDWZAAwDaq7Oagr",
                "created": 1761018352,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Detections for specified ZTF objects with real/bogus (deep learning) score > 0.7\n-- Returns: oid (ZTF identifier), candid, fid, mjd, isdiffpos, ra, dec, magpsf, sigmapsf, drb\nSELECT\n    oid,\n    candid,\n    fid,\n    mjd,\n    isdiffpos,\n    ra,\n    dec,\n    magpsf,\n    sigmapsf,\n    drb\nFROM detection\nWHERE oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND drb > 0.7\nORDER BY oid, mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Detections for specified ZTF objects with real/bogus (deep learning) score > 0.7\n-- Returns: oid (ZTF identifier), candid, fid, mjd, isdiffpos, ra, dec, magpsf, sigmapsf, drb\nSELECT\n    oid,\n    candid,\n    fid,\n    mjd,\n    isdiffpos,\n    ra,\n    dec,\n    magpsf,\n    sigmapsf,\n    drb\nFROM detection\nWHERE oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND drb > 0.7\nORDER BY oid, mjd;\n```"
                },
                "in_toks": 2832,
                "out_toks": 2009,
                "id": "chatcmpl-CSxhxQuGniQuZ9fj4UpPQ8mMyw3HN",
                "created": 1761018737,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "47",
            "experiment_id": "run_4",
            "pred_tables": [
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection']"
                },
                "in_toks": 673,
                "out_toks": 589,
                "id": "chatcmpl-CSsqXZhPclcj7cOBhmSa4Ep1HCviC",
                "created": 1761000049,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1032,
                "out_toks": 335,
                "id": "chatcmpl-CSxbp2b8hQr6HToalz1nxY4iKnvTe",
                "created": 1761018357,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n/* Detections for specified ZTF objects with rb > 0.7, ordered by object (oid) and detection date (mjd) */\nSELECT\n  detection.oid,\n  detection.candid,\n  detection.fid,\n  detection.mjd,\n  detection.isdiffpos,\n  detection.ra,\n  detection.dec,\n  detection.magpsf,\n  detection.sigmapsf,\n  detection.rb\nFROM detection\nWHERE detection.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND detection.rb > 0.7\nORDER BY detection.oid, detection.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* Detections for specified ZTF objects with rb > 0.7, ordered by object (oid) and detection date (mjd) */\nSELECT\n  detection.oid,\n  detection.candid,\n  detection.fid,\n  detection.mjd,\n  detection.isdiffpos,\n  detection.ra,\n  detection.dec,\n  detection.magpsf,\n  detection.sigmapsf,\n  detection.rb\nFROM detection\nWHERE detection.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND detection.rb > 0.7\nORDER BY detection.oid, detection.mjd;\n```"
                },
                "in_toks": 2350,
                "out_toks": 1293,
                "id": "chatcmpl-CSxiIlx3y3KHFxTD5qmdZPwcM0gPs",
                "created": 1761018758,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "47",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 673,
                "out_toks": 784,
                "id": "chatcmpl-CZNEoVv3Hv1RK4naay5L5m0rkIqDU",
                "created": 1762546842,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1514,
                "out_toks": 335,
                "id": "chatcmpl-CZYh9pj4vjY1vIZH7FDkQ8GBwJNsh",
                "created": 1762590883,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Detections for given ZTF object identifiers with real/bogus score > 0.7\n-- Returns: oid (ZTF identifier), candid, fid (1=g; 2=r; 3=i), mjd (detection date),\n-- isdiffpos, ra, dec, magpsf (difference magnitude), sigmapsf (its uncertainty), rb (real/bogus score)\nSELECT\n    oid,\n    candid,\n    fid,\n    mjd,\n    isdiffpos,\n    ra,\n    dec,\n    magpsf,\n    sigmapsf,\n    rb\nFROM detection\nWHERE oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND rb > 0.7\nORDER BY oid, mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Detections for given ZTF object identifiers with real/bogus score > 0.7\n-- Returns: oid (ZTF identifier), candid, fid (1=g; 2=r; 3=i), mjd (detection date),\n-- isdiffpos, ra, dec, magpsf (difference magnitude), sigmapsf (its uncertainty), rb (real/bogus score)\nSELECT\n    oid,\n    candid,\n    fid,\n    mjd,\n    isdiffpos,\n    ra,\n    dec,\n    magpsf,\n    sigmapsf,\n    rb\nFROM detection\nWHERE oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND rb > 0.7\nORDER BY oid, mjd;\n```"
                },
                "in_toks": 2832,
                "out_toks": 1263,
                "id": "chatcmpl-CZZeBcYMcnrHk1w5EEKyf7bOhL888",
                "created": 1762594543,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "47",
            "experiment_id": "run_6",
            "pred_tables": [
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection']"
                },
                "in_toks": 673,
                "out_toks": 781,
                "id": "chatcmpl-CZNF8D0yxuJCqQqpNlEC7s8xXpVxR",
                "created": 1762546862,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1032,
                "out_toks": 271,
                "id": "chatcmpl-CZYhFmsk1Go6thYp5hx6iymoZHtmx",
                "created": 1762590889,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Detections for specified ZTF objects with real/bogus score > 0.7\nSELECT\n  oid,            -- ZTF identifier\n  candid,         -- candidate identifier\n  fid,            -- filter identifier (1=g; 2=r; 3=i)\n  mjd,            -- detection date (Modified Julian Date)\n  isdiffpos,      -- difference image sign flag\n  ra,             -- detection RA\n  dec,            -- detection Dec\n  magpsf,         -- difference magnitude (PSF)\n  sigmapsf,       -- uncertainty of difference magnitude (PSF)\n  rb              -- ZTF real/bogus score\nFROM detection\nWHERE oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND rb > 0.7\nORDER BY oid, mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Detections for specified ZTF objects with real/bogus score > 0.7\nSELECT\n  oid,            -- ZTF identifier\n  candid,         -- candidate identifier\n  fid,            -- filter identifier (1=g; 2=r; 3=i)\n  mjd,            -- detection date (Modified Julian Date)\n  isdiffpos,      -- difference image sign flag\n  ra,             -- detection RA\n  dec,            -- detection Dec\n  magpsf,         -- difference magnitude (PSF)\n  sigmapsf,       -- uncertainty of difference magnitude (PSF)\n  rb              -- ZTF real/bogus score\nFROM detection\nWHERE oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND rb > 0.7\nORDER BY oid, mjd;\n```"
                },
                "in_toks": 2350,
                "out_toks": 1152,
                "id": "chatcmpl-CZZhmzwSOM3YWRDWeD51vH7YCYTPd",
                "created": 1762594766,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "47",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 673,
                "out_toks": 528,
                "id": "chatcmpl-CZNFSrGrJK9BO6ujRlL0sCVTNnbq9",
                "created": 1762546882,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1514,
                "out_toks": 399,
                "id": "chatcmpl-CZYhJN2mGTkgjmdJCyEPFoGgg7GFy",
                "created": 1762590893,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Detections for the specified ZTF objects with rb > 0.7\nSELECT\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf,\n    d.rb\nFROM detection d\nWHERE d.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND d.rb > 0.7\nORDER BY d.oid, d.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Detections for the specified ZTF objects with rb > 0.7\nSELECT\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf,\n    d.rb\nFROM detection d\nWHERE d.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND d.rb > 0.7\nORDER BY d.oid, d.mjd;\n```"
                },
                "in_toks": 2832,
                "out_toks": 1025,
                "id": "chatcmpl-CZZzQB04KsYE3HILX3dF8z4DnrD4T",
                "created": 1762595860,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "47",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 673,
                "out_toks": 528,
                "id": "chatcmpl-CZNFmsl5i2YfvedMlOEwkLBzhrkBZ",
                "created": 1762546902,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1514,
                "out_toks": 335,
                "id": "chatcmpl-CZYhQEZW7WrbWB12UKPvbrH4LtD7u",
                "created": 1762590900,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Detections for the specified ZTF objects with real/bogus score > 0.7\n-- Returns: ZTF identifier (oid), candidate id (candid), filter id (fid), detection date (mjd),\n--          isdiffpos flag, detection coordinates (ra, dec), difference magnitude (magpsf) and its uncertainty (sigmapsf), and real/bogus score (rb)\nSELECT\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf,\n    d.rb\nFROM detection d\nWHERE d.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND d.rb > 0.7\nORDER BY d.oid, d.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Detections for the specified ZTF objects with real/bogus score > 0.7\n-- Returns: ZTF identifier (oid), candidate id (candid), filter id (fid), detection date (mjd),\n--          isdiffpos flag, detection coordinates (ra, dec), difference magnitude (magpsf) and its uncertainty (sigmapsf), and real/bogus score (rb)\nSELECT\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf,\n    d.rb\nFROM detection d\nWHERE d.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND d.rb > 0.7\nORDER BY d.oid, d.mjd;\n```"
                },
                "in_toks": 2832,
                "out_toks": 2053,
                "id": "chatcmpl-CZZzDZSVFj2gtFIyqjhQVkuQKE5ji",
                "created": 1762595847,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "47",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 673,
                "out_toks": 720,
                "id": "chatcmpl-CZNG27j87aghz6d6C6o3eNgP27kAb",
                "created": 1762546918,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1514,
                "out_toks": 335,
                "id": "chatcmpl-CZYhUcLVaymQ98VF6YevB5K1FKCYP",
                "created": 1762590904,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Detections for specified ZTF objects with deep-learning real/bogus score > 0.7\nSELECT\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf,\n    d.drb\nFROM detection d\nWHERE d.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND d.drb > 0.7\nORDER BY d.oid, d.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Detections for specified ZTF objects with deep-learning real/bogus score > 0.7\nSELECT\n    d.oid,\n    d.candid,\n    d.fid,\n    d.mjd,\n    d.isdiffpos,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf,\n    d.drb\nFROM detection d\nWHERE d.oid IN ('ZTF23aaawbsc', 'ZTF21abxlmuw')\n  AND d.drb > 0.7\nORDER BY d.oid, d.mjd;\n```"
                },
                "in_toks": 2832,
                "out_toks": 1480,
                "id": "chatcmpl-CZZfPgPOES6oLH4q8F9eWyRbir49v",
                "created": 1762594619,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "79": {
        "0": {
            "req_id": "79",
            "experiment_id": "run_0",
            "pred_tables": [
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch']",
                    "1": "['xmatch']"
                },
                "in_toks": 623,
                "out_toks": 538,
                "id": "chatcmpl-CSnafRwOUBqB2ZvpMynSMG2Qw33UE",
                "created": 1760979845,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 547,
                "out_toks": 143,
                "id": "chatcmpl-CSnqCzYHW0t6IVgNGzbgepaSHai5g",
                "created": 1760980808,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get catalog name, object identifier in the catalog, and distance for the specified ZTF object\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get catalog name, object identifier in the catalog, and distance for the specified ZTF object\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```"
                },
                "in_toks": 1865,
                "out_toks": 189,
                "id": "chatcmpl-CSqs3vJzcxYM66mQdYtSuu9cSwdbo",
                "created": 1760992455,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "79",
            "experiment_id": "run_1",
            "pred_tables": [
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch']",
                    "1": "['xmatch']"
                },
                "in_toks": 623,
                "out_toks": 538,
                "id": "chatcmpl-CSnafRwOUBqB2ZvpMynSMG2Qw33UE",
                "created": 1760979845,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 547,
                "out_toks": 79,
                "id": "chatcmpl-CSnqGqb72pZz7QzhTvDgqY6ZRM7CA",
                "created": 1760980812,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Catalog name, object identifier in the catalog, and distance for the specified ZTF object\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Catalog name, object identifier in the catalog, and distance for the specified ZTF object\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```"
                },
                "in_toks": 1865,
                "out_toks": 572,
                "id": "chatcmpl-CSqs3OcI3onwf7m6gMimkx6Jt7jnt",
                "created": 1760992455,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "79",
            "experiment_id": "run_2",
            "pred_tables": [
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch']"
                },
                "in_toks": 623,
                "out_toks": 141,
                "id": "chatcmpl-CSsqhGWT5VT0PpPLm7ymn9rPoT6aX",
                "created": 1761000059,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 547,
                "out_toks": 143,
                "id": "chatcmpl-CSxbuGKFcvdBfkn0c713s8LWpXiK3",
                "created": 1761018362,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get catalog name, catalog object identifier, and distance for the specified ZTF object\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get catalog name, catalog object identifier, and distance for the specified ZTF object\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```"
                },
                "in_toks": 1865,
                "out_toks": 315,
                "id": "chatcmpl-CSxibmcCnShweiUoQ07jgPD9frsFO",
                "created": 1761018777,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "79",
            "experiment_id": "run_3",
            "pred_tables": [
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch']"
                },
                "in_toks": 623,
                "out_toks": 205,
                "id": "chatcmpl-CSsqlVjZ59uw9ngwqdeWUf30ygUdU",
                "created": 1761000063,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 547,
                "out_toks": 143,
                "id": "chatcmpl-CSxbwcaOTPXeT0mtSOvsuly2ngoCx",
                "created": 1761018364,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Xmatch info for the specified ZTF object; 'dist' is in arcseconds\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Xmatch info for the specified ZTF object; 'dist' is in arcseconds\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```"
                },
                "in_toks": 1865,
                "out_toks": 380,
                "id": "chatcmpl-CSxijnsdQEnpuiDXVP3Ll0naZJwcj",
                "created": 1761018785,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "79",
            "experiment_id": "run_4",
            "pred_tables": [
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch']"
                },
                "in_toks": 623,
                "out_toks": 589,
                "id": "chatcmpl-CSsqpsMNijHdBEx2E2I3uYqdDQayF",
                "created": 1761000067,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 547,
                "out_toks": 207,
                "id": "chatcmpl-CSxbyr0YrZoeJhfeGWZv08SaCNLWy",
                "created": 1761018366,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get catalog name, catalog object identifier, and distance for the specified ZTF object\nSELECT\n  catid,\n  oid_catalog,\n  dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get catalog name, catalog object identifier, and distance for the specified ZTF object\nSELECT\n  catid,\n  oid_catalog,\n  dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```"
                },
                "in_toks": 1865,
                "out_toks": 315,
                "id": "chatcmpl-CSxisGXjnA9JhSZDPg54CUCr8dYpW",
                "created": 1761018794,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "79",
            "experiment_id": "run_5",
            "pred_tables": [
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch']"
                },
                "in_toks": 623,
                "out_toks": 269,
                "id": "chatcmpl-CZNGZnp8hbAS4mHkgw5NB96cJ17Py",
                "created": 1762546951,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 547,
                "out_toks": 207,
                "id": "chatcmpl-CZYhaDl73W3aRKnEUZ3bLR51SnFOz",
                "created": 1762590910,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Retrieve catalog name, catalog object identifier, and distance (arcsec)\n-- for the specified ZTF object from the xmatch table\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Retrieve catalog name, catalog object identifier, and distance (arcsec)\n-- for the specified ZTF object from the xmatch table\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```"
                },
                "in_toks": 1865,
                "out_toks": 517,
                "id": "chatcmpl-CZZj5nPt2ub1SrmO1IZv3RiyabVY0",
                "created": 1762594847,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "79",
            "experiment_id": "run_6",
            "pred_tables": [
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch']"
                },
                "in_toks": 623,
                "out_toks": 269,
                "id": "chatcmpl-CZNGh3sthAkzxp5w733CW0sr9gesB",
                "created": 1762546959,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 547,
                "out_toks": 143,
                "id": "chatcmpl-CZYhf56EH9ex6tqihcr6kBy91HUKR",
                "created": 1762590915,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get catalog name, catalog object identifier, and distance [arcsec]\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get catalog name, catalog object identifier, and distance [arcsec]\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```"
                },
                "in_toks": 1865,
                "out_toks": 248,
                "id": "chatcmpl-CZa0bSJApxroSdXgCfjxJTethBo1l",
                "created": 1762595933,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "79",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'xmatch']"
                },
                "in_toks": 623,
                "out_toks": 336,
                "id": "chatcmpl-CZNGq60YJBy0HSjHTm2NfLdtdqatJ",
                "created": 1762546968,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1029,
                "out_toks": 143,
                "id": "chatcmpl-CZYhjOBrsjhDidphboIBxHNTCs7GA",
                "created": 1762590919,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Retrieve catalog name, catalog object identifier, and distance for the specified ZTF object\nSELECT\n    x.catid,\n    x.oid_catalog,\n    x.dist\nFROM xmatch AS x\nWHERE x.oid = 'ZTF20achscch';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Retrieve catalog name, catalog object identifier, and distance for the specified ZTF object\nSELECT\n    x.catid,\n    x.oid_catalog,\n    x.dist\nFROM xmatch AS x\nWHERE x.oid = 'ZTF20achscch';\n```"
                },
                "in_toks": 2347,
                "out_toks": 323,
                "id": "chatcmpl-CZZh1u3X4VZjgIqJOQcjKKLksjQ7X",
                "created": 1762594719,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "79",
            "experiment_id": "run_8",
            "pred_tables": [
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['xmatch']"
                },
                "in_toks": 623,
                "out_toks": 589,
                "id": "chatcmpl-CZNGznhHe16HSfMFFn5oXRyO9UH7g",
                "created": 1762546977,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 547,
                "out_toks": 143,
                "id": "chatcmpl-CZYhm84LdGE09Su1D0TGo9DwOg7xx",
                "created": 1762590922,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```"
                },
                "in_toks": 1865,
                "out_toks": 361,
                "id": "chatcmpl-CZa0l09SD05QhAseaCey2PMkbrrnq",
                "created": 1762595943,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "79",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "xmatch"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'xmatch']"
                },
                "in_toks": 623,
                "out_toks": 336,
                "id": "chatcmpl-CZNHGBhmIhYhDWs2El4kS16cDrA2A",
                "created": 1762546994,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1029,
                "out_toks": 143,
                "id": "chatcmpl-CZYhqMvZ595HtrGbd7WcYUDFkJJ5w",
                "created": 1762590926,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get catalog name, object identifier in the catalog, and distance for the specified ZTF object\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get catalog name, object identifier in the catalog, and distance for the specified ZTF object\nSELECT\n    catid,\n    oid_catalog,\n    dist\nFROM xmatch\nWHERE oid = 'ZTF20achscch';\n```"
                },
                "in_toks": 2347,
                "out_toks": 317,
                "id": "chatcmpl-CZZoGXnEyuYqG5xzlX8gSc3J9Qo8K",
                "created": 1762595168,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "94": {
        "0": {
            "req_id": "94",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'reference']",
                    "1": "['object', 'reference']"
                },
                "in_toks": 618,
                "out_toks": 734,
                "id": "chatcmpl-CSnakHQhj7VbqNRO3C4mDvsm0gSmF",
                "created": 1760979850,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1277,
                "out_toks": 1231,
                "id": "chatcmpl-CSnqKEsB0xC00NG7FsCcTG07odNDx",
                "created": 1760980816,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and scope\n- Goal: Retrieve at most 50 rows combining all columns from the object and reference tables for ZTF objects that \u201chad a change in the reference.\u201d\n- Interpretation: \u201chad a change in the reference\u201d maps to the boolean column object.reference_change = TRUE.\n- Output: All columns from both tables (i.e., select o.*, r.*).\n- Row cap: Limit the final joined result to 50 rows.\n\n2) Identify base tables and relationships\n- Tables involved:\n  - object (primary key: oid VARCHAR)\n  - reference (foreign key: oid references object(oid); primary key: (oid, rfid))\n- Join key:\n  - reference.oid = object.oid\n- Join type:\n  - Use INNER JOIN to ensure only objects that have corresponding reference rows are returned (since the output must include columns from both tables).\n\n3) Filtering condition\n- Apply the filter on the object table:\n  - object.reference_change = TRUE\n- No additional filtering (e.g., coordinates, classifiers, probabilities) is required by the user request.\n- Note: The default conditions for the probability table are not applicable because the probability table is not used in this query.\n\n4) Selection of columns\n- As the user requested \u201cGet all columns,\u201d select:\n  - All columns from object (alias o.*)\n  - All columns from reference (alias r.*)\n- Be aware that oid will appear from both tables; this is acceptable for a \u201cselect all columns\u201d request.\n\n5) Join logic\n- From object o, INNER JOIN reference r ON r.oid = o.oid\n- Outcome: If an object has multiple reference entries (multiple rfid values), the result will include one row per (object, reference) pair. This is consistent with \u201cget all columns from object and reference.\u201d\n\n6) Result size constraint\n- Apply LIMIT 50 at the end of the query so that the final output table (after joining) has at most 50 rows.\n- Note: Place LIMIT after the join to cap the actual returned rows, not just the number of objects pre-join.\n\n7) Ordering (optional but recommended for determinism)\n- Add an ORDER BY to make the 50 rows deterministic across executions.\n- Choose a column with an index or stable ordering; options:\n  - ORDER BY o.oid ASC (object.oid is a primary key and has an index)\n- If recency is preferred (not requested), one could use ORDER BY o.lastmjd DESC, but this column is not indexed per the provided schema.\n\n8) Performance considerations\n- The filter on object.reference_change (boolean) has no explicit index; however, the result set is limited to 50 rows, so the operation should be efficient in practice.\n- The join will benefit from:\n  - object.oid (PRIMARY KEY => indexed)\n  - reference primary key (oid, rfid) provides an index on oid as the first column of the composite index, which supports the join on r.oid.\n\n9) Edge cases and clarifications\n- Multiple reference rows per object will yield multiple joined rows; if the intention were to return only one reference row per object (not requested), an additional step (e.g., choosing the most recent by r.mjdendref) would be needed.\n- If the user wants strictly unique objects capped at 50, you would need to limit on distinct oids before joining, but that could produce more than 50 final rows due to multiple references. The current interpretation caps the final rows at 50, which matches \u201cat most 50 rows in the resulting table.\u201d\n\n10) Final assembly sequence\n- FROM object o\n- INNER JOIN reference r ON r.oid = o.oid\n- WHERE o.reference_change = TRUE\n- SELECT o.*, r.*\n- ORDER BY o.oid ASC (for deterministic output)\n- LIMIT 50",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and scope\n- Goal: Retrieve at most 50 rows combining all columns from the object and reference tables for ZTF objects that \u201chad a change in the reference.\u201d\n- Interpretation: \u201chad a change in the reference\u201d maps to the boolean column object.reference_change = TRUE.\n- Output: All columns from both tables (i.e., select o.*, r.*).\n- Row cap: Limit the final joined result to 50 rows.\n\n2) Identify base tables and relationships\n- Tables involved:\n  - object (primary key: oid VARCHAR)\n  - reference (foreign key: oid references object(oid); primary key: (oid, rfid))\n- Join key:\n  - reference.oid = object.oid\n- Join type:\n  - Use INNER JOIN to ensure only objects that have corresponding reference rows are returned (since the output must include columns from both tables).\n\n3) Filtering condition\n- Apply the filter on the object table:\n  - object.reference_change = TRUE\n- No additional filtering (e.g., coordinates, classifiers, probabilities) is required by the user request.\n- Note: The default conditions for the probability table are not applicable because the probability table is not used in this query.\n\n4) Selection of columns\n- As the user requested \u201cGet all columns,\u201d select:\n  - All columns from object (alias o.*)\n  - All columns from reference (alias r.*)\n- Be aware that oid will appear from both tables; this is acceptable for a \u201cselect all columns\u201d request.\n\n5) Join logic\n- From object o, INNER JOIN reference r ON r.oid = o.oid\n- Outcome: If an object has multiple reference entries (multiple rfid values), the result will include one row per (object, reference) pair. This is consistent with \u201cget all columns from object and reference.\u201d\n\n6) Result size constraint\n- Apply LIMIT 50 at the end of the query so that the final output table (after joining) has at most 50 rows.\n- Note: Place LIMIT after the join to cap the actual returned rows, not just the number of objects pre-join.\n\n7) Ordering (optional but recommended for determinism)\n- Add an ORDER BY to make the 50 rows deterministic across executions.\n- Choose a column with an index or stable ordering; options:\n  - ORDER BY o.oid ASC (object.oid is a primary key and has an index)\n- If recency is preferred (not requested), one could use ORDER BY o.lastmjd DESC, but this column is not indexed per the provided schema.\n\n8) Performance considerations\n- The filter on object.reference_change (boolean) has no explicit index; however, the result set is limited to 50 rows, so the operation should be efficient in practice.\n- The join will benefit from:\n  - object.oid (PRIMARY KEY => indexed)\n  - reference primary key (oid, rfid) provides an index on oid as the first column of the composite index, which supports the join on r.oid.\n\n9) Edge cases and clarifications\n- Multiple reference rows per object will yield multiple joined rows; if the intention were to return only one reference row per object (not requested), an additional step (e.g., choosing the most recent by r.mjdendref) would be needed.\n- If the user wants strictly unique objects capped at 50, you would need to limit on distinct oids before joining, but that could produce more than 50 final rows due to multiple references. The current interpretation caps the final rows at 50, which matches \u201cat most 50 rows in the resulting table.\u201d\n\n10) Final assembly sequence\n- FROM object o\n- INNER JOIN reference r ON r.oid = o.oid\n- WHERE o.reference_change = TRUE\n- SELECT o.*, r.*\n- ORDER BY o.oid ASC (for deterministic output)\n- LIMIT 50"
                },
                "in_toks": 2885,
                "out_toks": 2419,
                "id": "chatcmpl-CSqs32z65YB1khPBOWevA15k9Noa7",
                "created": 1760992455,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all columns from 'object' and 'reference' for objects with a change in the reference\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON r.oid = o.oid\nWHERE o.reference_change = TRUE\nORDER BY o.oid ASC\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns from 'object' and 'reference' for objects with a change in the reference\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON r.oid = o.oid\nWHERE o.reference_change = TRUE\nORDER BY o.oid ASC\nLIMIT 50;\n```"
                },
                "in_toks": 2835,
                "out_toks": 722,
                "id": "chatcmpl-CSr6EoOygwOuPgZvoBbPlwadb27ha",
                "created": 1760993334,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "94",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'reference']",
                    "1": "['object', 'reference']"
                },
                "in_toks": 618,
                "out_toks": 734,
                "id": "chatcmpl-CSnakHQhj7VbqNRO3C4mDvsm0gSmF",
                "created": 1760979850,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1277,
                "out_toks": 1039,
                "id": "chatcmpl-CSnqaS5WgqiHvdWO4VlJFF1JViLnz",
                "created": 1760980832,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the goal and scope\n- Retrieve all columns from both the object and reference tables.\n- Only include ZTF objects that had a change in the reference; this is indicated by the boolean column object.reference_change = TRUE.\n- Limit the final result to at most 50 rows.\n- No need to use any classifier/probability tables or spatial (Q3C) functions for this request.\n\n2) Determine relevant tables, columns, and relationships\n- Tables:\n  - object (alias o): primary table with object-level attributes. Key columns of interest:\n    - oid (VARCHAR PRIMARY KEY)\n    - reference_change (BOOLEAN) \u2014 filter condition\n    - other columns available for selection: deltajd, firstmjd, lastmjd, ndethist, ncovhist, mjdstarthist, mjdendhist, corrected, stellar, ndet, g_r_max, g_r_max_corr, g_r_mean, g_r_mean_corr, meanra, meandec, sigmara, sigmadec, step_id_corr, diffpos\n  - reference (alias r): reference image metadata for each object. Key columns of interest:\n    - oid (VARCHAR REFERENCES object(oid))\n    - rfid (BIGINT) \u2014 part of PRIMARY KEY (oid, rfid)\n    - other columns available for selection: candid, fid, rcid, field, magnr, sigmagnr, chinr, sharpnr, ranr, decnr, mjdstartref, mjdendref, nframesref\n- Relationship:\n  - One object may have one or more reference rows (PRIMARY KEY (oid, rfid)).\n  - Join condition is r.oid = o.oid.\n\n3) Define selection and filters\n- Selection:\n  - Return all columns from both tables; use o.* and r.* to include every column explicitly from each table.\n- Filters:\n  - Only objects with reference change: WHERE o.reference_change = TRUE.\n- Join type:\n  - Use INNER JOIN between object and reference to ensure the output includes valid reference rows and to be consistent with \u201cfrom the object and reference tables.\u201d\n  - This will return one row per matching (object, reference) pair; objects with multiple references will appear multiple times, which is acceptable given the request to include all reference rows.\n\n4) Consider result size and ordering\n- Apply LIMIT 50 to cap the number of rows returned.\n- Ordering was not specified. If a deterministic selection is desired, you can optionally add ORDER BY (e.g., ORDER BY o.lastmjd DESC or ORDER BY o.oid ASC). Otherwise, omit ORDER BY and rely on LIMIT 50.\n\n5) Join and filtering strategy for performance\n- Apply the filter on object.reference_change = TRUE before or during the join to reduce the number of rows joined.\n- Use INNER JOIN on r.oid = o.oid; the reference table\u2019s PRIMARY KEY (oid, rfid) provides an index to support the join.\n- No additional indexes are specified for object.reference_change; the filter is straightforward and should be applied directly in the WHERE clause.\n\n6) Assemble the query components\n- FROM object o\n- INNER JOIN reference r ON r.oid = o.oid\n- WHERE o.reference_change = TRUE\n- SELECT o.*, r.* to get all columns from both tables\n- LIMIT 50\n- Optional: add ORDER BY if a deterministic subset is preferred (not required by the user)\n\n7) Assumptions and clarifications\n- \u201cZTF objects\u201d is satisfied because object.oid is defined as a ZTF identifier in this database; no extra filtering on oid is necessary.\n- The query intentionally does not use probability or classifier tables because they are irrelevant to the user\u2019s request.\n- The query does not use Q3C spatial functions since no positional filtering was requested.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the goal and scope\n- Retrieve all columns from both the object and reference tables.\n- Only include ZTF objects that had a change in the reference; this is indicated by the boolean column object.reference_change = TRUE.\n- Limit the final result to at most 50 rows.\n- No need to use any classifier/probability tables or spatial (Q3C) functions for this request.\n\n2) Determine relevant tables, columns, and relationships\n- Tables:\n  - object (alias o): primary table with object-level attributes. Key columns of interest:\n    - oid (VARCHAR PRIMARY KEY)\n    - reference_change (BOOLEAN) \u2014 filter condition\n    - other columns available for selection: deltajd, firstmjd, lastmjd, ndethist, ncovhist, mjdstarthist, mjdendhist, corrected, stellar, ndet, g_r_max, g_r_max_corr, g_r_mean, g_r_mean_corr, meanra, meandec, sigmara, sigmadec, step_id_corr, diffpos\n  - reference (alias r): reference image metadata for each object. Key columns of interest:\n    - oid (VARCHAR REFERENCES object(oid))\n    - rfid (BIGINT) \u2014 part of PRIMARY KEY (oid, rfid)\n    - other columns available for selection: candid, fid, rcid, field, magnr, sigmagnr, chinr, sharpnr, ranr, decnr, mjdstartref, mjdendref, nframesref\n- Relationship:\n  - One object may have one or more reference rows (PRIMARY KEY (oid, rfid)).\n  - Join condition is r.oid = o.oid.\n\n3) Define selection and filters\n- Selection:\n  - Return all columns from both tables; use o.* and r.* to include every column explicitly from each table.\n- Filters:\n  - Only objects with reference change: WHERE o.reference_change = TRUE.\n- Join type:\n  - Use INNER JOIN between object and reference to ensure the output includes valid reference rows and to be consistent with \u201cfrom the object and reference tables.\u201d\n  - This will return one row per matching (object, reference) pair; objects with multiple references will appear multiple times, which is acceptable given the request to include all reference rows.\n\n4) Consider result size and ordering\n- Apply LIMIT 50 to cap the number of rows returned.\n- Ordering was not specified. If a deterministic selection is desired, you can optionally add ORDER BY (e.g., ORDER BY o.lastmjd DESC or ORDER BY o.oid ASC). Otherwise, omit ORDER BY and rely on LIMIT 50.\n\n5) Join and filtering strategy for performance\n- Apply the filter on object.reference_change = TRUE before or during the join to reduce the number of rows joined.\n- Use INNER JOIN on r.oid = o.oid; the reference table\u2019s PRIMARY KEY (oid, rfid) provides an index to support the join.\n- No additional indexes are specified for object.reference_change; the filter is straightforward and should be applied directly in the WHERE clause.\n\n6) Assemble the query components\n- FROM object o\n- INNER JOIN reference r ON r.oid = o.oid\n- WHERE o.reference_change = TRUE\n- SELECT o.*, r.* to get all columns from both tables\n- LIMIT 50\n- Optional: add ORDER BY if a deterministic subset is preferred (not required by the user)\n\n7) Assumptions and clarifications\n- \u201cZTF objects\u201d is satisfied because object.oid is defined as a ZTF identifier in this database; no extra filtering on oid is necessary.\n- The query intentionally does not use probability or classifier tables because they are irrelevant to the user\u2019s request.\n- The query does not use Q3C spatial functions since no positional filtering was requested."
                },
                "in_toks": 2885,
                "out_toks": 2215,
                "id": "chatcmpl-CSqs3kqhzOHigfUT9xLndhdfm3CIR",
                "created": 1760992455,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all columns from the object and reference tables for ZTF objects with a reference change\nSELECT\n    o.*,\n    r.*\nFROM object AS o\nINNER JOIN reference AS r\n    ON r.oid = o.oid\nWHERE o.reference_change = TRUE\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns from the object and reference tables for ZTF objects with a reference change\nSELECT\n    o.*,\n    r.*\nFROM object AS o\nINNER JOIN reference AS r\n    ON r.oid = o.oid\nWHERE o.reference_change = TRUE\nLIMIT 50;\n```"
                },
                "in_toks": 2822,
                "out_toks": 841,
                "id": "chatcmpl-CSr6ExqpZ13FhiGauEZOMxFSJonmW",
                "created": 1760993334,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "94",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'reference']"
                },
                "in_toks": 618,
                "out_toks": 335,
                "id": "chatcmpl-CSsqzSXQEYRC7JMajHPYfohcmelH4",
                "created": 1761000077,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1277,
                "out_toks": 655,
                "id": "chatcmpl-CSxc19M7ZhX6GqV5XlkH4QbmXBp3Q",
                "created": 1761018369,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Goal and scope\n- Retrieve at most 50 rows that combine all columns from the object and reference tables for ZTF objects that had a change in the reference image.\n- \u201cChange in the reference\u201d corresponds to object.reference_change = TRUE.\n\n2) Relevant tables and columns\n- object: primary table with per-object summary. Key columns used here:\n  - oid (VARCHAR, PRIMARY KEY)\n  - reference_change (BOOLEAN) \u2014 filter: TRUE\n  - Additional columns returned when selecting all columns include: deltajd, firstmjd, lastmjd, ndethist, ncovhist, mjdstarthist, mjdendhist, corrected, stellar, ndet, g_r_max, g_r_max_corr, g_r_mean, g_r_mean_corr, meanra, meandec, sigmara, sigmadec, step_id_corr, diffpos\n- reference: per-object reference image metadata (may have multiple rows per object). Key columns used here:\n  - oid (VARCHAR, FOREIGN KEY referencing object.oid)\n  - rfid (BIGINT, part of PRIMARY KEY (oid, rfid))\n  - All columns to return: candid, fid, rcid, field, magnr, sigmagnr, chinr, sharpnr, ranr, decnr, mjdstartref, mjdendref, nframesref, plus oid and rfid.\n\n3) Join strategy\n- Use an INNER JOIN between object and reference on reference.oid = object.oid to ensure rows contain data from both tables.\n- Expect multiple reference rows per object (different rfid values); the result may include several rows per oid. This is acceptable since the user wants all columns from both tables.\n\n4) Filters and conditions\n- Apply the condition object.reference_change = TRUE to select only objects with a change in the reference.\n- No probability tables are involved, so no default probability conditions are needed.\n\n5) Columns to return\n- Select all columns from both tables: object.* and reference.*.\n- Note that both tables include oid; the result set will include both columns (with table alias qualification if needed by the client to disambiguate).\n\n6) Row limit and ordering\n- Limit the final result set to at most 50 rows using LIMIT 50 applied after the join and filter.\n- The user did not specify ordering; if a deterministic ordering is desired, add an ORDER BY (e.g., object.lastmjd DESC or object.oid ASC). Otherwise, omit ORDER BY and rely on LIMIT 50.\n\n7) Performance considerations\n- The filter is on object.reference_change (no explicit index shown), which may require a sequential scan; however, the join to reference will be efficient due to the reference table\u2019s PRIMARY KEY (oid, rfid), which provides an index on (oid, rfid).\n- Apply the WHERE predicate on object first; the planner will push down predicates appropriately. LIMIT 50 after the join ensures at most 50 output rows.\n\n8) Query structure to implement\n- FROM object AS o\n- INNER JOIN reference AS r ON r.oid = o.oid\n- WHERE o.reference_change = TRUE\n- SELECT o.* , r.*\n- Add LIMIT 50 at the end\n- Optionally add ORDER BY if deterministic ordering is desired.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Goal and scope\n- Retrieve at most 50 rows that combine all columns from the object and reference tables for ZTF objects that had a change in the reference image.\n- \u201cChange in the reference\u201d corresponds to object.reference_change = TRUE.\n\n2) Relevant tables and columns\n- object: primary table with per-object summary. Key columns used here:\n  - oid (VARCHAR, PRIMARY KEY)\n  - reference_change (BOOLEAN) \u2014 filter: TRUE\n  - Additional columns returned when selecting all columns include: deltajd, firstmjd, lastmjd, ndethist, ncovhist, mjdstarthist, mjdendhist, corrected, stellar, ndet, g_r_max, g_r_max_corr, g_r_mean, g_r_mean_corr, meanra, meandec, sigmara, sigmadec, step_id_corr, diffpos\n- reference: per-object reference image metadata (may have multiple rows per object). Key columns used here:\n  - oid (VARCHAR, FOREIGN KEY referencing object.oid)\n  - rfid (BIGINT, part of PRIMARY KEY (oid, rfid))\n  - All columns to return: candid, fid, rcid, field, magnr, sigmagnr, chinr, sharpnr, ranr, decnr, mjdstartref, mjdendref, nframesref, plus oid and rfid.\n\n3) Join strategy\n- Use an INNER JOIN between object and reference on reference.oid = object.oid to ensure rows contain data from both tables.\n- Expect multiple reference rows per object (different rfid values); the result may include several rows per oid. This is acceptable since the user wants all columns from both tables.\n\n4) Filters and conditions\n- Apply the condition object.reference_change = TRUE to select only objects with a change in the reference.\n- No probability tables are involved, so no default probability conditions are needed.\n\n5) Columns to return\n- Select all columns from both tables: object.* and reference.*.\n- Note that both tables include oid; the result set will include both columns (with table alias qualification if needed by the client to disambiguate).\n\n6) Row limit and ordering\n- Limit the final result set to at most 50 rows using LIMIT 50 applied after the join and filter.\n- The user did not specify ordering; if a deterministic ordering is desired, add an ORDER BY (e.g., object.lastmjd DESC or object.oid ASC). Otherwise, omit ORDER BY and rely on LIMIT 50.\n\n7) Performance considerations\n- The filter is on object.reference_change (no explicit index shown), which may require a sequential scan; however, the join to reference will be efficient due to the reference table\u2019s PRIMARY KEY (oid, rfid), which provides an index on (oid, rfid).\n- Apply the WHERE predicate on object first; the planner will push down predicates appropriately. LIMIT 50 after the join ensures at most 50 output rows.\n\n8) Query structure to implement\n- FROM object AS o\n- INNER JOIN reference AS r ON r.oid = o.oid\n- WHERE o.reference_change = TRUE\n- SELECT o.* , r.*\n- Add LIMIT 50 at the end\n- Optionally add ORDER BY if deterministic ordering is desired."
                },
                "in_toks": 2885,
                "out_toks": 2488,
                "id": "chatcmpl-CSxizGl1pDaI55H4ROFwVDpNn5tZi",
                "created": 1761018801,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Objects with a change in the reference image; return all columns from object and reference\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON r.oid = o.oid\nWHERE o.reference_change = TRUE\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with a change in the reference image; return all columns from object and reference\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON r.oid = o.oid\nWHERE o.reference_change = TRUE\nLIMIT 50;\n```"
                },
                "in_toks": 2711,
                "out_toks": 904,
                "id": "chatcmpl-CSyL203xKxu7bI3SzcBvw7yLpjOTD",
                "created": 1761021160,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "94",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'reference']"
                },
                "in_toks": 618,
                "out_toks": 271,
                "id": "chatcmpl-CSsr6TEoBoiBWI7BXnPWCu9jSy49X",
                "created": 1761000084,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1277,
                "out_toks": 655,
                "id": "chatcmpl-CSxcAqPKw1dhEQBoUEiAapyZaw4DQ",
                "created": 1761018378,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Objective and scope\n- Retrieve all columns from both object and reference tables for ZTF objects whose reference image changed, and return at most 50 rows.\n- \u201cZTF objects\u201d are the objects in the object table (no extra filter needed).\n- Do not use the probability table; default probability conditions are not applicable here.\n\n2) Base tables and aliases\n- Use:\n  - object as o\n  - reference as r\n- relationship: reference.oid REFERENCES object(oid), with reference primary key (oid, rfid).\n\n3) Columns to return\n- Return all columns from both tables:\n  - o.* (all columns of object):\n    - oid, deltajd, firstmjd, lastmjd, ndethist, ncovhist, mjdstarthist, mjdendhist, corrected, stellar, ndet, g_r_max, g_r_max_corr, g_r_mean, g_r_mean_corr, meanra, meandec, sigmara, sigmadec, step_id_corr, diffpos, reference_change\n  - r.* (all columns of reference):\n    - oid, rfid, candid, fid, rcid, field, magnr, sigmagnr, chinr, sharpnr, ranr, decnr, mjdstartref, mjdendref, nframesref\n\n4) Join strategy\n- Use INNER JOIN between object and reference on the shared object identifier:\n  - join condition: o.oid = r.oid\n- Rationale: We need rows that exist in both tables; inner join ensures the result includes objects with at least one corresponding reference record.\n\n5) Filtering criteria (WHERE clause)\n- Select only objects that had a change in the reference:\n  - o.reference_change = TRUE\n- No additional temporal, spatial, or classifier-based filters are needed unless specified by the user.\n\n6) Result cardinality and duplicates\n- An object can have multiple reference rows (e.g., different rfid or fid), so multiple rows per object may appear in the result. This matches the request to get all columns from both tables.\n- If a single row per object were desired, DISTINCT ON(o.oid) or an aggregation would be needed, but that is not requested.\n\n7) Ordering (optional)\n- The user did not require a specific sorting; the result can be unordered.\n- If deterministic output is desired, add an ORDER BY clause (e.g., ORDER BY o.lastmjd DESC, r.rfid) before limiting. This is optional and should only be added if determinism is needed.\n\n8) Limiting the number of rows\n- Restrict the output to at most 50 rows using LIMIT 50.\n\n9) Indexes and performance considerations\n- Join uses o.oid (PRIMARY KEY in object) and r.oid (leftmost column of reference PRIMARY KEY (oid, rfid)), enabling efficient join.\n- There is no explicit index on object.reference_change; filtering on this boolean may scan a large portion of object if many rows share the same value. This is acceptable given the subsequent LIMIT 50; adding an ORDER BY on a indexed column (e.g., o.lastmjd) could help pick recent entries if that\u2019s desirable.\n- Existing indexes on object (ndet, firstmjd, g_r_max, g_r_mean_corr, meanra, meandec) are not directly used by this filter unless an ORDER BY uses one of them.\n\n10) Final query structure to build (no SQL here, just structure)\n- FROM object o\n- INNER JOIN reference r ON o.oid = r.oid\n- WHERE o.reference_change = TRUE\n- SELECT o.* , r.*\n- [optional ORDER BY o.lastmjd DESC, r.rfid]\n- LIMIT 50\n\n11) Output expectation\n- Up to 50 rows, each containing the complete set of columns from both object and reference for objects with o.reference_change = TRUE.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Objective and scope\n- Retrieve all columns from both object and reference tables for ZTF objects whose reference image changed, and return at most 50 rows.\n- \u201cZTF objects\u201d are the objects in the object table (no extra filter needed).\n- Do not use the probability table; default probability conditions are not applicable here.\n\n2) Base tables and aliases\n- Use:\n  - object as o\n  - reference as r\n- relationship: reference.oid REFERENCES object(oid), with reference primary key (oid, rfid).\n\n3) Columns to return\n- Return all columns from both tables:\n  - o.* (all columns of object):\n    - oid, deltajd, firstmjd, lastmjd, ndethist, ncovhist, mjdstarthist, mjdendhist, corrected, stellar, ndet, g_r_max, g_r_max_corr, g_r_mean, g_r_mean_corr, meanra, meandec, sigmara, sigmadec, step_id_corr, diffpos, reference_change\n  - r.* (all columns of reference):\n    - oid, rfid, candid, fid, rcid, field, magnr, sigmagnr, chinr, sharpnr, ranr, decnr, mjdstartref, mjdendref, nframesref\n\n4) Join strategy\n- Use INNER JOIN between object and reference on the shared object identifier:\n  - join condition: o.oid = r.oid\n- Rationale: We need rows that exist in both tables; inner join ensures the result includes objects with at least one corresponding reference record.\n\n5) Filtering criteria (WHERE clause)\n- Select only objects that had a change in the reference:\n  - o.reference_change = TRUE\n- No additional temporal, spatial, or classifier-based filters are needed unless specified by the user.\n\n6) Result cardinality and duplicates\n- An object can have multiple reference rows (e.g., different rfid or fid), so multiple rows per object may appear in the result. This matches the request to get all columns from both tables.\n- If a single row per object were desired, DISTINCT ON(o.oid) or an aggregation would be needed, but that is not requested.\n\n7) Ordering (optional)\n- The user did not require a specific sorting; the result can be unordered.\n- If deterministic output is desired, add an ORDER BY clause (e.g., ORDER BY o.lastmjd DESC, r.rfid) before limiting. This is optional and should only be added if determinism is needed.\n\n8) Limiting the number of rows\n- Restrict the output to at most 50 rows using LIMIT 50.\n\n9) Indexes and performance considerations\n- Join uses o.oid (PRIMARY KEY in object) and r.oid (leftmost column of reference PRIMARY KEY (oid, rfid)), enabling efficient join.\n- There is no explicit index on object.reference_change; filtering on this boolean may scan a large portion of object if many rows share the same value. This is acceptable given the subsequent LIMIT 50; adding an ORDER BY on a indexed column (e.g., o.lastmjd) could help pick recent entries if that\u2019s desirable.\n- Existing indexes on object (ndet, firstmjd, g_r_max, g_r_mean_corr, meanra, meandec) are not directly used by this filter unless an ORDER BY uses one of them.\n\n10) Final query structure to build (no SQL here, just structure)\n- FROM object o\n- INNER JOIN reference r ON o.oid = r.oid\n- WHERE o.reference_change = TRUE\n- SELECT o.* , r.*\n- [optional ORDER BY o.lastmjd DESC, r.rfid]\n- LIMIT 50\n\n11) Output expectation\n- Up to 50 rows, each containing the complete set of columns from both object and reference for objects with o.reference_change = TRUE."
                },
                "in_toks": 2885,
                "out_toks": 2302,
                "id": "chatcmpl-CSxjQu9BNkFV1c4npyOHbmJIPE1c0",
                "created": 1761018828,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all columns from the object and reference tables for objects with a changed reference\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON o.oid = r.oid\nWHERE o.reference_change = TRUE\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns from the object and reference tables for objects with a changed reference\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON o.oid = r.oid\nWHERE o.reference_change = TRUE\nLIMIT 50;\n```"
                },
                "in_toks": 2845,
                "out_toks": 967,
                "id": "chatcmpl-CSyLHkBE4ORTgV0VvxCf2IvrKFpgA",
                "created": 1761021175,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "94",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'reference']"
                },
                "in_toks": 618,
                "out_toks": 207,
                "id": "chatcmpl-CSsrB2EtnPBgqX4w13P0ZOYr4XduT",
                "created": 1761000089,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1277,
                "out_toks": 719,
                "id": "chatcmpl-CSxcILe3Mnou8eQ0FJmE9EO6pUx94",
                "created": 1761018386,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Interpret the user request and define the goal\n- Task: Retrieve, for ZTF objects that had a change in the reference, all columns from both the object and reference tables, returning at most 50 rows.\n- \u201cHad a change in the reference\u201d maps directly to the boolean column object.reference_change = TRUE.\n\n2) Identify the relevant tables, columns, and relationships\n- Tables:\n  - object: main per-object summary table. Primary key: object.oid (VARCHAR).\n    - Relevant columns for filtering: reference_change (BOOLEAN).\n    - Coordinates and stats columns exist but are not needed for filtering; they will be returned because the user wants all columns.\n  - reference: reference image metadata. Primary key: (oid, rfid).\n    - Foreign key: reference.oid REFERENCES object(oid).\n- Relationship: reference.oid is a foreign key to object.oid; join on oid.\n\n3) Define the result structure (projection)\n- The user asked for \u201call columns from the object and reference tables.\u201d\n- Project all columns from both tables using table aliases to make the intent explicit: o.* (all columns from object) and r.* (all columns from reference).\n- Note: Both tables contain the column oid; both will appear in the output. This is expected since the user asked for all columns from both tables.\n\n4) Define filtering logic (WHERE clause)\n- Filter only objects that had a change in the reference:\n  - object.reference_change = TRUE (or IS TRUE).\n- No additional filters (e.g., classifier/probability, spatial constraints) are needed.\n\n5) Define the join strategy\n- Use an INNER JOIN between object and reference on the shared key oid to ensure only rows with both object and reference information are returned.\n  - Join condition: object.oid = reference.oid.\n- This will return all reference rows associated with each qualifying object (i.e., multiple rows per object if there are multiple reference entries), which aligns with \u201call columns from the object and reference tables.\u201d\n\n6) Limit and (optional) ordering\n- Limit the number of returned rows to at most 50 using LIMIT 50.\n- The user did not specify ordering; if a deterministic order is desired, you could optionally add ORDER BY (e.g., ORDER BY o.lastmjd DESC or ORDER BY o.oid ASC). Otherwise, omit ORDER BY.\n\n7) Performance and indexing considerations\n- object.oid (PK) is indexed; reference has a PK on (oid, rfid), providing an index usable for the join.\n- There is no explicit index on object.reference_change, but given the LIMIT 50, scanning for TRUE values and joining should be efficient enough.\n- To reduce rows early, apply the reference_change filter on object before the join (the planner will typically optimize this, but writing it clearly in the WHERE clause tied to the object alias helps).\n- If desired, you can structure it as a subquery that first selects qualifying oids from object, then join to reference by oid to keep the join input small. Both approaches are acceptable.\n\n8) Final assembly of the query (conceptual, no SQL code returned)\n- FROM: object aliased as o.\n- JOIN: INNER JOIN reference aliased as r ON r.oid = o.oid.\n- WHERE: o.reference_change IS TRUE.\n- SELECT: o.* , r.* (all columns from both tables).\n- LIMIT: 50.\n- (Optional) ORDER BY for deterministic presentation (not required by the user).",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Interpret the user request and define the goal\n- Task: Retrieve, for ZTF objects that had a change in the reference, all columns from both the object and reference tables, returning at most 50 rows.\n- \u201cHad a change in the reference\u201d maps directly to the boolean column object.reference_change = TRUE.\n\n2) Identify the relevant tables, columns, and relationships\n- Tables:\n  - object: main per-object summary table. Primary key: object.oid (VARCHAR).\n    - Relevant columns for filtering: reference_change (BOOLEAN).\n    - Coordinates and stats columns exist but are not needed for filtering; they will be returned because the user wants all columns.\n  - reference: reference image metadata. Primary key: (oid, rfid).\n    - Foreign key: reference.oid REFERENCES object(oid).\n- Relationship: reference.oid is a foreign key to object.oid; join on oid.\n\n3) Define the result structure (projection)\n- The user asked for \u201call columns from the object and reference tables.\u201d\n- Project all columns from both tables using table aliases to make the intent explicit: o.* (all columns from object) and r.* (all columns from reference).\n- Note: Both tables contain the column oid; both will appear in the output. This is expected since the user asked for all columns from both tables.\n\n4) Define filtering logic (WHERE clause)\n- Filter only objects that had a change in the reference:\n  - object.reference_change = TRUE (or IS TRUE).\n- No additional filters (e.g., classifier/probability, spatial constraints) are needed.\n\n5) Define the join strategy\n- Use an INNER JOIN between object and reference on the shared key oid to ensure only rows with both object and reference information are returned.\n  - Join condition: object.oid = reference.oid.\n- This will return all reference rows associated with each qualifying object (i.e., multiple rows per object if there are multiple reference entries), which aligns with \u201call columns from the object and reference tables.\u201d\n\n6) Limit and (optional) ordering\n- Limit the number of returned rows to at most 50 using LIMIT 50.\n- The user did not specify ordering; if a deterministic order is desired, you could optionally add ORDER BY (e.g., ORDER BY o.lastmjd DESC or ORDER BY o.oid ASC). Otherwise, omit ORDER BY.\n\n7) Performance and indexing considerations\n- object.oid (PK) is indexed; reference has a PK on (oid, rfid), providing an index usable for the join.\n- There is no explicit index on object.reference_change, but given the LIMIT 50, scanning for TRUE values and joining should be efficient enough.\n- To reduce rows early, apply the reference_change filter on object before the join (the planner will typically optimize this, but writing it clearly in the WHERE clause tied to the object alias helps).\n- If desired, you can structure it as a subquery that first selects qualifying oids from object, then join to reference by oid to keep the join input small. Both approaches are acceptable.\n\n8) Final assembly of the query (conceptual, no SQL code returned)\n- FROM: object aliased as o.\n- JOIN: INNER JOIN reference aliased as r ON r.oid = o.oid.\n- WHERE: o.reference_change IS TRUE.\n- SELECT: o.* , r.* (all columns from both tables).\n- LIMIT: 50.\n- (Optional) ORDER BY for deterministic presentation (not required by the user)."
                },
                "in_toks": 2885,
                "out_toks": 2401,
                "id": "chatcmpl-CSxjzh9KLITUUblLFgehQBn1x326j",
                "created": 1761018863,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all columns from object and reference for objects with a change in the reference, limited to 50 rows\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON r.oid = o.oid\nWHERE o.reference_change IS TRUE\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all columns from object and reference for objects with a change in the reference, limited to 50 rows\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON r.oid = o.oid\nWHERE o.reference_change IS TRUE\nLIMIT 50;\n```"
                },
                "in_toks": 2752,
                "out_toks": 717,
                "id": "chatcmpl-CSyLYJvZausMLvG4mQzq9WzCDRrfx",
                "created": 1761021192,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "94",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'reference']"
                },
                "in_toks": 618,
                "out_toks": 271,
                "id": "chatcmpl-CZNHPZyjt9HN2EndsdrEx4NV2hwqd",
                "created": 1762547003,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1277,
                "out_toks": 847,
                "id": "chatcmpl-CZYhteUNaHCVxkn8k7ycCPeRIXZzO",
                "created": 1762590929,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Map the user request to the schema\n- Tables involved:\n  - object: main per-object stats. Key columns needed: oid (PK), reference_change (BOOLEAN), plus all other columns via selection.\n  - reference: per-object reference-image metadata. Key columns needed: oid (FK \u2192 object.oid), rfid (part of PK), plus all other columns via selection.\n- Interpretation of \u201cobjects that had a change in the reference\u201d:\n  - Use object.reference_change = TRUE as the selection criterion.\n\n2) Define the row filtering criteria\n- Filter only objects where object.reference_change IS TRUE.\n- Because the user wants columns from both object and reference, ensure the object has at least one matching reference row. Use an INNER JOIN to enforce this.\n\n3) Establish the join logic\n- Join key: reference.oid = object.oid.\n- Join type: INNER JOIN (returns only objects with at least one reference row).\n- Aliases:\n  - object as o\n  - reference as r\n\n4) Specify the columns to return\n- The user asked for \u201call columns from the 'object' and 'reference' tables.\u201d\n- Select o.* and r.* to include every column from both tables.\n\n5) Control result size and ordering\n- Limit the result set to at most 50 rows: LIMIT 50.\n- Add a deterministic ORDER BY to make the limited result reproducible. Options:\n  - ORDER BY o.oid ASC, r.rfid ASC (stable, uses primary/foreign key order), or\n  - Alternatively, ORDER BY o.lastmjd DESC, o.oid ASC, r.rfid ASC (to prefer most recently observed objects first; note lastmjd has no index).\n- If the intention were \u201c50 unique objects\u201d rather than \u201c50 rows,\u201d you would instead use DISTINCT ON (o.oid) with a corresponding ORDER BY to pick one reference row per object (e.g., the latest by r.mjdendref). Since the user said \u201crows,\u201d keep it as simple LIMIT 50 rows.\n\n6) Put the query pieces together\n- FROM object o\n- INNER JOIN reference r ON r.oid = o.oid\n- WHERE o.reference_change IS TRUE\n- SELECT o.*, r.*\n- ORDER BY (choose one of the deterministic options; e.g., o.oid ASC, r.rfid ASC)\n- LIMIT 50\n\n7) Performance and index considerations\n- The join will use the reference primary key index on (oid, rfid) to match r.oid to o.oid efficiently.\n- There is no index on object.reference_change; the filter will likely require a scan of object. If this query will be run frequently and the fraction of TRUE rows is small, consider adding an index on object(reference_change) to speed up the filter.\n- No spatial constraints are required; Q3C functions are not applicable here.\n\n8) Default conditions and other notes\n- The probability table and its default filters are not used in this request.\n- Column name collisions: oid exists in both tables; using o.* and r.* with table aliases ensures clarity in consumers that can distinguish the duplicated column name by prefix, or ensure your downstream tooling can handle duplicate column names. If needed, you can later alias one of the oid columns.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Map the user request to the schema\n- Tables involved:\n  - object: main per-object stats. Key columns needed: oid (PK), reference_change (BOOLEAN), plus all other columns via selection.\n  - reference: per-object reference-image metadata. Key columns needed: oid (FK \u2192 object.oid), rfid (part of PK), plus all other columns via selection.\n- Interpretation of \u201cobjects that had a change in the reference\u201d:\n  - Use object.reference_change = TRUE as the selection criterion.\n\n2) Define the row filtering criteria\n- Filter only objects where object.reference_change IS TRUE.\n- Because the user wants columns from both object and reference, ensure the object has at least one matching reference row. Use an INNER JOIN to enforce this.\n\n3) Establish the join logic\n- Join key: reference.oid = object.oid.\n- Join type: INNER JOIN (returns only objects with at least one reference row).\n- Aliases:\n  - object as o\n  - reference as r\n\n4) Specify the columns to return\n- The user asked for \u201call columns from the 'object' and 'reference' tables.\u201d\n- Select o.* and r.* to include every column from both tables.\n\n5) Control result size and ordering\n- Limit the result set to at most 50 rows: LIMIT 50.\n- Add a deterministic ORDER BY to make the limited result reproducible. Options:\n  - ORDER BY o.oid ASC, r.rfid ASC (stable, uses primary/foreign key order), or\n  - Alternatively, ORDER BY o.lastmjd DESC, o.oid ASC, r.rfid ASC (to prefer most recently observed objects first; note lastmjd has no index).\n- If the intention were \u201c50 unique objects\u201d rather than \u201c50 rows,\u201d you would instead use DISTINCT ON (o.oid) with a corresponding ORDER BY to pick one reference row per object (e.g., the latest by r.mjdendref). Since the user said \u201crows,\u201d keep it as simple LIMIT 50 rows.\n\n6) Put the query pieces together\n- FROM object o\n- INNER JOIN reference r ON r.oid = o.oid\n- WHERE o.reference_change IS TRUE\n- SELECT o.*, r.*\n- ORDER BY (choose one of the deterministic options; e.g., o.oid ASC, r.rfid ASC)\n- LIMIT 50\n\n7) Performance and index considerations\n- The join will use the reference primary key index on (oid, rfid) to match r.oid to o.oid efficiently.\n- There is no index on object.reference_change; the filter will likely require a scan of object. If this query will be run frequently and the fraction of TRUE rows is small, consider adding an index on object(reference_change) to speed up the filter.\n- No spatial constraints are required; Q3C functions are not applicable here.\n\n8) Default conditions and other notes\n- The probability table and its default filters are not used in this request.\n- Column name collisions: oid exists in both tables; using o.* and r.* with table aliases ensures clarity in consumers that can distinguish the duplicated column name by prefix, or ensure your downstream tooling can handle duplicate column names. If needed, you can later alias one of the oid columns."
                },
                "in_toks": 2885,
                "out_toks": 2613,
                "id": "chatcmpl-CZa0y9GVCffvrqefm4R4sxDjwfv90",
                "created": 1762595956,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all columns from 'object' and 'reference' for objects with a reference change, limited to 50 rows\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON r.oid = o.oid\nWHERE o.reference_change IS TRUE\nORDER BY o.oid ASC, r.rfid ASC\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns from 'object' and 'reference' for objects with a reference change, limited to 50 rows\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON r.oid = o.oid\nWHERE o.reference_change IS TRUE\nORDER BY o.oid ASC, r.rfid ASC\nLIMIT 50;\n```"
                },
                "in_toks": 2708,
                "out_toks": 795,
                "id": "chatcmpl-CZaxBgiO0bFpN3RkZlJvlF7AuQevS",
                "created": 1762599565,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "94",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'reference']"
                },
                "in_toks": 618,
                "out_toks": 207,
                "id": "chatcmpl-CZNHXmAufq1sX590CgYpq6GVQAtKe",
                "created": 1762547011,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Correct schema: join object with reference, not detection\n-- Filter to objects where the reference image changed (object.reference_change = TRUE)\n-- Use a small pre-filtered set of oids to avoid scanning the full tables, then cap final rows to 50\nWITH cand_oids AS\n  (SELECT oid\n   FROM OBJECT\n   WHERE reference_change IS TRUE\n   LIMIT 200)\nSELECT o.*,\n       r.*\nFROM cand_oids c\nJOIN OBJECT AS o ON o.oid = c.oid\nJOIN reference AS r ON r.oid = c.oid\nLIMIT 50;",
            "sql_response": {
                "responses": {
                    "0": "-- Correct schema: join object with reference, not detection\n-- Filter to objects where the reference image changed (object.reference_change = TRUE)\n-- Use a small pre-filtered set of oids to avoid scanning the full tables, then cap final rows to 50\nWITH cand_oids AS\n  (SELECT oid\n   FROM OBJECT\n   WHERE reference_change IS TRUE\n   LIMIT 200)\nSELECT o.*,\n       r.*\nFROM cand_oids c\nJOIN OBJECT AS o ON o.oid = c.oid\nJOIN reference AS r ON r.oid = c.oid\nLIMIT 50;"
                },
                "in_toks": 1563,
                "out_toks": 2563,
                "id": "chatcmpl-CbHTtYHJHTZrCZeAM32pbVIsUwTSb",
                "created": 1763001369,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1277,
                "out_toks": 911,
                "id": "chatcmpl-CZYiAsydL2PLGDZkFYUl4aMbvxZMA",
                "created": 1762590946,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify goal and scope\n- Return at most 50 rows combining all columns from both the object and reference tables for ZTF objects that had a change in the reference.\n- In the ALeRCE schema, \u201cchange in the reference\u201d maps to object.reference_change = TRUE.\n- No probability-based classification filtering is needed (the probability table is not used).\n\n2) Identify required tables, aliases, and join keys\n- Tables: object (alias o) and reference (alias r).\n- Join key: r.oid references o.oid (foreign key); use an INNER JOIN to return only rows with matching reference entries.\n- Expect multiple reference rows per object (primary key on reference is (oid, rfid)); this will create multiple rows per object as intended.\n\n3) Define filtering conditions\n- Core condition: o.reference_change = TRUE (or o.reference_change IS TRUE).\n- No additional spatial or temporal filters are required unless specified by the user.\n\n4) Select columns\n- Return all columns from both tables: o.* and r.*.\n- Note: Both tables include an oid column; most clients can handle duplicate column names from o.* and r.*, but if the consuming system requires unique names, aliasing could be added (e.g., r.oid AS reference_oid). By default, follow the instruction to select all columns via o.* and r.*.\n\n5) Result ordering (optional but recommended for determinism)\n- To make the top 50 rows reproducible, add an ORDER BY. A reasonable choice is:\n  - ORDER BY o.lastmjd DESC NULLS LAST, r.rfid ASC\n  - This prioritizes the most recently detected objects and then orders their reference entries consistently.\n- If no deterministic order is needed, you may omit ORDER BY; LIMIT alone satisfies the \u201cat most 50 rows\u201d requirement.\n\n6) Row limiting\n- Apply LIMIT 50 to cap the output rows.\n\n7) Performance and index considerations\n- The join on r.oid = o.oid uses object.oid (PRIMARY KEY) and reference (oid, rfid) (PRIMARY KEY), so the join is efficient.\n- There is no index on object.reference_change; a sequential scan on object filtered by reference_change IS TRUE may occur. Given further constraints are not specified, this is acceptable.\n- No Q3C spatial functions are needed.\n\n8) Query assembly steps\n- FROM and JOIN: start from object o and INNER JOIN reference r ON r.oid = o.oid.\n- WHERE: add o.reference_change IS TRUE.\n- SELECT: include o.* and r.*.\n- ORDER BY: optionally add ORDER BY o.lastmjd DESC NULLS LAST, r.rfid ASC for deterministic results.\n- LIMIT: add LIMIT 50.\n\n9) Validation\n- Verify the row count is \u2264 50.\n- Optionally check a sample row to confirm both o.* and r.* columns are present and the reference_change flag is TRUE.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify goal and scope\n- Return at most 50 rows combining all columns from both the object and reference tables for ZTF objects that had a change in the reference.\n- In the ALeRCE schema, \u201cchange in the reference\u201d maps to object.reference_change = TRUE.\n- No probability-based classification filtering is needed (the probability table is not used).\n\n2) Identify required tables, aliases, and join keys\n- Tables: object (alias o) and reference (alias r).\n- Join key: r.oid references o.oid (foreign key); use an INNER JOIN to return only rows with matching reference entries.\n- Expect multiple reference rows per object (primary key on reference is (oid, rfid)); this will create multiple rows per object as intended.\n\n3) Define filtering conditions\n- Core condition: o.reference_change = TRUE (or o.reference_change IS TRUE).\n- No additional spatial or temporal filters are required unless specified by the user.\n\n4) Select columns\n- Return all columns from both tables: o.* and r.*.\n- Note: Both tables include an oid column; most clients can handle duplicate column names from o.* and r.*, but if the consuming system requires unique names, aliasing could be added (e.g., r.oid AS reference_oid). By default, follow the instruction to select all columns via o.* and r.*.\n\n5) Result ordering (optional but recommended for determinism)\n- To make the top 50 rows reproducible, add an ORDER BY. A reasonable choice is:\n  - ORDER BY o.lastmjd DESC NULLS LAST, r.rfid ASC\n  - This prioritizes the most recently detected objects and then orders their reference entries consistently.\n- If no deterministic order is needed, you may omit ORDER BY; LIMIT alone satisfies the \u201cat most 50 rows\u201d requirement.\n\n6) Row limiting\n- Apply LIMIT 50 to cap the output rows.\n\n7) Performance and index considerations\n- The join on r.oid = o.oid uses object.oid (PRIMARY KEY) and reference (oid, rfid) (PRIMARY KEY), so the join is efficient.\n- There is no index on object.reference_change; a sequential scan on object filtered by reference_change IS TRUE may occur. Given further constraints are not specified, this is acceptable.\n- No Q3C spatial functions are needed.\n\n8) Query assembly steps\n- FROM and JOIN: start from object o and INNER JOIN reference r ON r.oid = o.oid.\n- WHERE: add o.reference_change IS TRUE.\n- SELECT: include o.* and r.*.\n- ORDER BY: optionally add ORDER BY o.lastmjd DESC NULLS LAST, r.rfid ASC for deterministic results.\n- LIMIT: add LIMIT 50.\n\n9) Validation\n- Verify the row count is \u2264 50.\n- Optionally check a sample row to confirm both o.* and r.* columns are present and the reference_change flag is TRUE."
                },
                "in_toks": 2885,
                "out_toks": 2351,
                "id": "chatcmpl-CZZodyUqbrdipgJnOIGv43n7Z38vT",
                "created": 1762595191,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- The ALeRCE 2023 schema provided does not include a 'reference' table.\n-- Using 'detection' as the source of reference-related information via detection.rfid.\nSELECT\n  o.*,\n  d.*\nFROM object AS o\nINNER JOIN detection AS d\n  ON d.oid = o.oid\nWHERE\n  o.reference_change IS TRUE\nORDER BY\n  o.lastmjd DESC NULLS LAST,\n  d.mjd DESC NULLS LAST,\n  d.candid DESC\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- The ALeRCE 2023 schema provided does not include a 'reference' table.\n-- Using 'detection' as the source of reference-related information via detection.rfid.\nSELECT\n  o.*,\n  d.*\nFROM object AS o\nINNER JOIN detection AS d\n  ON d.oid = o.oid\nWHERE\n  o.reference_change IS TRUE\nORDER BY\n  o.lastmjd DESC NULLS LAST,\n  d.mjd DESC NULLS LAST,\n  d.candid DESC\nLIMIT 50;\n```"
                },
                "in_toks": 2638,
                "out_toks": 1402,
                "id": "chatcmpl-CZaxKle0zJiut9v94kCMDSdvPAmDh",
                "created": 1762599574,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "7": {
            "req_id": "94",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'reference']"
                },
                "in_toks": 618,
                "out_toks": 271,
                "id": "chatcmpl-CZNHdwQUihdXhOB7K6zzga7P7XG6Z",
                "created": 1762547017,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1277,
                "out_toks": 655,
                "id": "chatcmpl-CZYiVnYFx60QtmaGLjZY6MoPUJxcj",
                "created": 1762590967,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Identify the relevant tables and purpose\n- Tables needed:\n  - object (alias o): holds per-object, time-independent stats. Contains the flag indicating reference image change.\n  - reference (alias r): holds reference-image metadata per object and rfid.\n- Goal: Return all columns from both object and reference for objects that had a change in the reference image.\n\n2) Define the filtering criterion\n- Use the boolean flag in object:\n  - o.reference_change = TRUE\n- This flag directly encodes \u201chad a change in the reference\u201d.\n\n3) Define the join between tables\n- Join key: oid\n- Relationship: reference.oid REFERENCES object(oid)\n- Use an INNER JOIN so that only objects with at least one reference row are returned:\n  - o.oid = r.oid\n\n4) Define the selected columns\n- Return all columns from both tables:\n  - o.* and r.*\n\n5) Set result size constraint\n- Limit the output to at most 50 rows:\n  - LIMIT 50\n- Note: Because an object may have multiple reference rows (different rfid or fid), multiple rows per object can appear. The LIMIT applies to the joined result rows.\n\n6) Optional ordering for reproducibility (not required by the user)\n- If a deterministic subset is desired, add an ORDER BY (e.g., ORDER BY o.lastmjd DESC or ORDER BY o.oid, r.rfid). Otherwise, omit ordering to allow the planner to optimize freely.\n\n7) Query structure outline (no SQL code, logical steps)\n- FROM object o\n- WHERE o.reference_change = TRUE\n- INNER JOIN reference r ON r.oid = o.oid\n- SELECT o.*, r.*\n- [optional ORDER BY \u2026]\n- LIMIT 50\n\n8) Notes on performance and correctness\n- Filtering on object first (o.reference_change = TRUE) reduces join size, improving performance.\n- No use of probability table is needed; default probability conditions do not apply here.\n- All requested objects are ZTF objects by definition of oid in this schema, so no additional filter is necessary.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Identify the relevant tables and purpose\n- Tables needed:\n  - object (alias o): holds per-object, time-independent stats. Contains the flag indicating reference image change.\n  - reference (alias r): holds reference-image metadata per object and rfid.\n- Goal: Return all columns from both object and reference for objects that had a change in the reference image.\n\n2) Define the filtering criterion\n- Use the boolean flag in object:\n  - o.reference_change = TRUE\n- This flag directly encodes \u201chad a change in the reference\u201d.\n\n3) Define the join between tables\n- Join key: oid\n- Relationship: reference.oid REFERENCES object(oid)\n- Use an INNER JOIN so that only objects with at least one reference row are returned:\n  - o.oid = r.oid\n\n4) Define the selected columns\n- Return all columns from both tables:\n  - o.* and r.*\n\n5) Set result size constraint\n- Limit the output to at most 50 rows:\n  - LIMIT 50\n- Note: Because an object may have multiple reference rows (different rfid or fid), multiple rows per object can appear. The LIMIT applies to the joined result rows.\n\n6) Optional ordering for reproducibility (not required by the user)\n- If a deterministic subset is desired, add an ORDER BY (e.g., ORDER BY o.lastmjd DESC or ORDER BY o.oid, r.rfid). Otherwise, omit ordering to allow the planner to optimize freely.\n\n7) Query structure outline (no SQL code, logical steps)\n- FROM object o\n- WHERE o.reference_change = TRUE\n- INNER JOIN reference r ON r.oid = o.oid\n- SELECT o.*, r.*\n- [optional ORDER BY \u2026]\n- LIMIT 50\n\n8) Notes on performance and correctness\n- Filtering on object first (o.reference_change = TRUE) reduces join size, improving performance.\n- No use of probability table is needed; default probability conditions do not apply here.\n- All requested objects are ZTF objects by definition of oid in this schema, so no additional filter is necessary."
                },
                "in_toks": 2885,
                "out_toks": 1601,
                "id": "chatcmpl-CZZm5k2ivLnirEILporttD2KPoOWE",
                "created": 1762595033,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all columns from 'object' and 'reference' for ZTF objects with a change in the reference image\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON r.oid = o.oid\nWHERE o.reference_change = TRUE\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns from 'object' and 'reference' for ZTF objects with a change in the reference image\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON r.oid = o.oid\nWHERE o.reference_change = TRUE\nLIMIT 50;\n```"
                },
                "in_toks": 2464,
                "out_toks": 1038,
                "id": "chatcmpl-CZayOVtmWPrD8fBGS9pFxRQ8tzcbb",
                "created": 1762599640,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "94",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'reference']"
                },
                "in_toks": 618,
                "out_toks": 335,
                "id": "chatcmpl-CZNHk1zDSFluiPjnIa1HBbv1ojdOG",
                "created": 1762547024,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1277,
                "out_toks": 591,
                "id": "chatcmpl-CZYigvI808Hr6fLP8ut7hMCxTIBb9",
                "created": 1762590978,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the relevant tables and roles\n- Main tables:\n  - object (holds per-object, band-independent stats; primary key: object.oid)\n  - reference (holds reference-image-related info per object; primary key: (reference.oid, reference.rfid), foreign key reference.oid \u2192 object.oid)\n- We need all columns from both tables for objects that had a change in the reference.\n\n2) Define the filter condition\n- The user\u2019s \u201chad a change in the reference\u201d corresponds to object.reference_change = TRUE (boolean).\n- No probability-based filtering is required (we are not using the probability table).\n\n3) Determine the join logic\n- We need rows that exist in both object and reference (to return columns from both), so use an INNER JOIN between object and reference on matching oid values:\n  - Join key: object.oid = reference.oid\n- Note: Because reference has a primary key (oid, rfid), an object can have multiple reference rows (one per rfid). The result may contain multiple rows per object if multiple rfid entries exist. This matches the user\u2019s request to return all columns from both tables.\n\n4) Select clause (projection)\n- Return all columns from both tables:\n  - Use table aliases for clarity (e.g., o for object, r for reference).\n  - Project o.* and r.* to include:\n    - All object columns:\n      - oid, deltajd, firstmjd, lastmjd, ndethist, ncovhist, mjdstarthist, mjdendhist, corrected, stellar, ndet, g_r_max, g_r_max_corr, g_r_mean, g_r_mean_corr, meanra, meandec, sigmara, sigmadec, step_id_corr, diffpos, reference_change\n    - All reference columns:\n      - oid, rfid, candid, fid, rcid, field, magnr, sigmagnr, chinr, sharpnr, ranr, decnr, mjdstartref, mjdendref, nframesref\n- Be aware that oid exists in both tables and will appear twice in the result set; this is acceptable since the user wants all columns. If downstream processing requires disambiguation, rely on column ordering or aliasing in client code.\n\n5) Where clause (apply filter)\n- Apply the condition to the object table:\n  - o.reference_change = TRUE\n- Placing the filter on object before or after the JOIN is logically equivalent; in standard SQL syntax, include it in the WHERE clause so the planner can push down the predicate and reduce join cardinality.\n\n6) Row limiting\n- Limit the total number of returned rows to at most 50 using LIMIT 50.\n\n7) Optional ordering (not requested, but for determinism if desired)\n- The user didn\u2019t specify ordering. If a deterministic subset is preferred, add an ORDER BY on a relevant column, e.g., o.lastmjd DESC or r.mjdendref DESC. Otherwise, omit ORDER BY.\n\n8) Performance considerations\n- Joins:\n  - object.oid is a PRIMARY KEY and implicitly indexed (btree).\n  - reference has a PRIMARY KEY on (oid, rfid); the oid component is indexed and supports efficient joins.\n- Filter:\n  - object.reference_change does not have an index per the provided schema; full-table filtering may occur on object, but the join remains efficient due to indexed keys.\n- Projection of all columns from both tables is potentially wide; acceptable given the user request and LIMIT 50.\n\n9) Final assembly of the query (conceptual)\n- FROM: object as o\n- INNER JOIN: reference as r ON r.oid = o.oid\n- WHERE: o.reference_change = TRUE\n- SELECT: o.* and r.*\n- LIMIT: 50\n\n10) Validation of outputs\n- Ensure that the result set may contain multiple rows per object when multiple reference.rfid exist; this behavior is correct per the request.\n- Confirm that no probability/Q3C or other tables/functions are included, as they are not required for this task.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the relevant tables and roles\n- Main tables:\n  - object (holds per-object, band-independent stats; primary key: object.oid)\n  - reference (holds reference-image-related info per object; primary key: (reference.oid, reference.rfid), foreign key reference.oid \u2192 object.oid)\n- We need all columns from both tables for objects that had a change in the reference.\n\n2) Define the filter condition\n- The user\u2019s \u201chad a change in the reference\u201d corresponds to object.reference_change = TRUE (boolean).\n- No probability-based filtering is required (we are not using the probability table).\n\n3) Determine the join logic\n- We need rows that exist in both object and reference (to return columns from both), so use an INNER JOIN between object and reference on matching oid values:\n  - Join key: object.oid = reference.oid\n- Note: Because reference has a primary key (oid, rfid), an object can have multiple reference rows (one per rfid). The result may contain multiple rows per object if multiple rfid entries exist. This matches the user\u2019s request to return all columns from both tables.\n\n4) Select clause (projection)\n- Return all columns from both tables:\n  - Use table aliases for clarity (e.g., o for object, r for reference).\n  - Project o.* and r.* to include:\n    - All object columns:\n      - oid, deltajd, firstmjd, lastmjd, ndethist, ncovhist, mjdstarthist, mjdendhist, corrected, stellar, ndet, g_r_max, g_r_max_corr, g_r_mean, g_r_mean_corr, meanra, meandec, sigmara, sigmadec, step_id_corr, diffpos, reference_change\n    - All reference columns:\n      - oid, rfid, candid, fid, rcid, field, magnr, sigmagnr, chinr, sharpnr, ranr, decnr, mjdstartref, mjdendref, nframesref\n- Be aware that oid exists in both tables and will appear twice in the result set; this is acceptable since the user wants all columns. If downstream processing requires disambiguation, rely on column ordering or aliasing in client code.\n\n5) Where clause (apply filter)\n- Apply the condition to the object table:\n  - o.reference_change = TRUE\n- Placing the filter on object before or after the JOIN is logically equivalent; in standard SQL syntax, include it in the WHERE clause so the planner can push down the predicate and reduce join cardinality.\n\n6) Row limiting\n- Limit the total number of returned rows to at most 50 using LIMIT 50.\n\n7) Optional ordering (not requested, but for determinism if desired)\n- The user didn\u2019t specify ordering. If a deterministic subset is preferred, add an ORDER BY on a relevant column, e.g., o.lastmjd DESC or r.mjdendref DESC. Otherwise, omit ORDER BY.\n\n8) Performance considerations\n- Joins:\n  - object.oid is a PRIMARY KEY and implicitly indexed (btree).\n  - reference has a PRIMARY KEY on (oid, rfid); the oid component is indexed and supports efficient joins.\n- Filter:\n  - object.reference_change does not have an index per the provided schema; full-table filtering may occur on object, but the join remains efficient due to indexed keys.\n- Projection of all columns from both tables is potentially wide; acceptable given the user request and LIMIT 50.\n\n9) Final assembly of the query (conceptual)\n- FROM: object as o\n- INNER JOIN: reference as r ON r.oid = o.oid\n- WHERE: o.reference_change = TRUE\n- SELECT: o.* and r.*\n- LIMIT: 50\n\n10) Validation of outputs\n- Ensure that the result set may contain multiple rows per object when multiple reference.rfid exist; this behavior is correct per the request.\n- Confirm that no probability/Q3C or other tables/functions are included, as they are not required for this task."
                },
                "in_toks": 2885,
                "out_toks": 2209,
                "id": "chatcmpl-CZa2JsXg8JvqX7YW3SFluj6O7QEp8",
                "created": 1762596039,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all columns from 'object' and 'reference' for objects with a change in the reference, limited to 50 rows\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON r.oid = o.oid\nWHERE o.reference_change = TRUE\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns from 'object' and 'reference' for objects with a change in the reference, limited to 50 rows\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON r.oid = o.oid\nWHERE o.reference_change = TRUE\nLIMIT 50;\n```"
                },
                "in_toks": 2880,
                "out_toks": 1105,
                "id": "chatcmpl-CZaxOyRAZ9yJTusOZvltzONlP1bl9",
                "created": 1762599578,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "94",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "reference"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'reference']"
                },
                "in_toks": 618,
                "out_toks": 271,
                "id": "chatcmpl-CZNHtMbiC1uDgk5SelwlS4o3NI4ZR",
                "created": 1762547033,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1277,
                "out_toks": 975,
                "id": "chatcmpl-CZYislPCSUYWM68qnNY4yMvTG6Ary",
                "created": 1762590990,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the required tables and purpose\n- Tables: object (main per-object summary) and reference (per-object, per-rfid reference metadata).\n- Goal: return all columns from both tables for objects where the reference image changed.\n\n2) Define the output columns\n- Since the user did not specify particular columns, select all columns from both tables:\n  - From object: o.* (all columns listed in the object schema, including oid, deltajd, firstmjd, lastmjd, ndethist, ncovhist, mjdstarthist, mjdendhist, corrected, stellar, ndet, g_r_max, g_r_max_corr, g_r_mean, g_r_mean_corr, meanra, meandec, sigmara, sigmadec, step_id_corr, diffpos, reference_change).\n  - From reference: r.* (all columns listed in the reference schema, including oid, rfid, candid, fid, rcid, field, magnr, sigmagnr, chinr, sharpnr, ranr, decnr, mjdstartref, mjdendref, nframesref).\n\n3) Establish table aliases and join strategy\n- Alias object as o and reference as r.\n- Join type: INNER JOIN to ensure only rows that exist in both tables are returned (the user wants columns from both).\n- Join key: r.oid = o.oid (reference.oid REFERENCES object.oid).\n\n4) Apply the filtering condition\n- Filter on objects that had a change in the reference:\n  - o.reference_change IS TRUE (or equivalently o.reference_change = true).\n- No use of the probability table is required for this request; therefore, default probability constraints do not apply.\n\n5) Optional ordering (only if deterministic ordering is desired)\n- The user did not request sorting; you can omit ORDER BY.\n- If you want deterministic results, choose an ORDER BY such as:\n  - ORDER BY o.lastmjd DESC (most recent first), or\n  - ORDER BY o.oid ASC.\n- Note: Ordering affects which rows appear within the returned 50-row limit.\n\n6) Limit the number of rows\n- Limit the result set to at most 50 rows: LIMIT 50.\n- This limit applies to joined rows (object\u2013reference pairs). Because reference can have multiple rows per object (different rfid/fid), the 50 rows are not necessarily 50 distinct objects. If instead one row per object were desired, a deduplication strategy (e.g., DISTINCT ON (o.oid) with a specified ordering over r.*) would be needed, but the user did not request that.\n\n7) Assemble the query structure (no SQL code here, just structure)\n- FROM clause: object o\n- JOIN clause: INNER JOIN reference r ON r.oid = o.oid\n- SELECT list: o.* and r.* (all columns from both)\n- WHERE clause: o.reference_change IS TRUE\n- Optional ORDER BY as above (if desired)\n- LIMIT 50\n\n8) Performance and correctness notes\n- The filter on o.reference_change should be applied before/at join time to reduce rows early.\n- There is no index on reference_change in the provided schema; this may cause a sequential scan on object. This is acceptable for correctness; adding an index is an optimization outside the scope of this query.\n- No spatial filtering or Q3C functions are needed.\n- No probability table is involved, so default conditions about probability.ranking and classifier_name do not apply.\n- Be aware that oid exists in both o and r; if downstream processing requires disambiguation, refer to o.oid or r.oid explicitly.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the required tables and purpose\n- Tables: object (main per-object summary) and reference (per-object, per-rfid reference metadata).\n- Goal: return all columns from both tables for objects where the reference image changed.\n\n2) Define the output columns\n- Since the user did not specify particular columns, select all columns from both tables:\n  - From object: o.* (all columns listed in the object schema, including oid, deltajd, firstmjd, lastmjd, ndethist, ncovhist, mjdstarthist, mjdendhist, corrected, stellar, ndet, g_r_max, g_r_max_corr, g_r_mean, g_r_mean_corr, meanra, meandec, sigmara, sigmadec, step_id_corr, diffpos, reference_change).\n  - From reference: r.* (all columns listed in the reference schema, including oid, rfid, candid, fid, rcid, field, magnr, sigmagnr, chinr, sharpnr, ranr, decnr, mjdstartref, mjdendref, nframesref).\n\n3) Establish table aliases and join strategy\n- Alias object as o and reference as r.\n- Join type: INNER JOIN to ensure only rows that exist in both tables are returned (the user wants columns from both).\n- Join key: r.oid = o.oid (reference.oid REFERENCES object.oid).\n\n4) Apply the filtering condition\n- Filter on objects that had a change in the reference:\n  - o.reference_change IS TRUE (or equivalently o.reference_change = true).\n- No use of the probability table is required for this request; therefore, default probability constraints do not apply.\n\n5) Optional ordering (only if deterministic ordering is desired)\n- The user did not request sorting; you can omit ORDER BY.\n- If you want deterministic results, choose an ORDER BY such as:\n  - ORDER BY o.lastmjd DESC (most recent first), or\n  - ORDER BY o.oid ASC.\n- Note: Ordering affects which rows appear within the returned 50-row limit.\n\n6) Limit the number of rows\n- Limit the result set to at most 50 rows: LIMIT 50.\n- This limit applies to joined rows (object\u2013reference pairs). Because reference can have multiple rows per object (different rfid/fid), the 50 rows are not necessarily 50 distinct objects. If instead one row per object were desired, a deduplication strategy (e.g., DISTINCT ON (o.oid) with a specified ordering over r.*) would be needed, but the user did not request that.\n\n7) Assemble the query structure (no SQL code here, just structure)\n- FROM clause: object o\n- JOIN clause: INNER JOIN reference r ON r.oid = o.oid\n- SELECT list: o.* and r.* (all columns from both)\n- WHERE clause: o.reference_change IS TRUE\n- Optional ORDER BY as above (if desired)\n- LIMIT 50\n\n8) Performance and correctness notes\n- The filter on o.reference_change should be applied before/at join time to reduce rows early.\n- There is no index on reference_change in the provided schema; this may cause a sequential scan on object. This is acceptable for correctness; adding an index is an optimization outside the scope of this query.\n- No spatial filtering or Q3C functions are needed.\n- No probability table is involved, so default conditions about probability.ranking and classifier_name do not apply.\n- Be aware that oid exists in both o and r; if downstream processing requires disambiguation, refer to o.oid or r.oid explicitly."
                },
                "in_toks": 2885,
                "out_toks": 2569,
                "id": "chatcmpl-CZZr0XOb5EKReTM3yYMwY9xndnojJ",
                "created": 1762595338,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get all columns from 'object' and 'reference' for objects where the reference image changed\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON r.oid = o.oid\nWHERE o.reference_change IS TRUE\nLIMIT 50;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all columns from 'object' and 'reference' for objects where the reference image changed\nSELECT\n  o.*,\n  r.*\nFROM object AS o\nINNER JOIN reference AS r\n  ON r.oid = o.oid\nWHERE o.reference_change IS TRUE\nLIMIT 50;\n```"
                },
                "in_toks": 2792,
                "out_toks": 1034,
                "id": "chatcmpl-CZaySwXWhj9SIprEsP7138HGt5EtV",
                "created": 1762599644,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "90": {
        "0": {
            "req_id": "90",
            "experiment_id": "run_0",
            "pred_tables": [
                "probability",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'feature', 'feature_version']",
                    "1": "['probability', 'feature', 'feature_version']"
                },
                "in_toks": 650,
                "out_toks": 2280,
                "id": "chatcmpl-CSnarZW8cnIBWwhtwdF3EweLRNeUB",
                "created": 1760979857,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 3128,
                "out_toks": 655,
                "id": "chatcmpl-CSnqqpbmdwjqpSx0KtaUjN98TWCEF",
                "created": 1760980848,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve at most 100 distinct ZTF objects (by oid) that have Multiband_period < 5 days in the feature version 'lc_classifier_1.2.1-P'.\n- For those objects, return all columns from the probability table, restricted to the light curve classifier (classifier_name = 'lc_classifier') and rankings in (1, 2).\n\nKey schema elements to use\n- Table feature\n  - Columns: oid, name, value, fid, version\n  - Filters needed here: name = 'Multiband_period', version = 'lc_classifier_1.2.1-P', value < 5\n- Table probability\n  - Columns: oid, class_name, classifier_name, classifier_version, probability, ranking\n  - Filters needed here: classifier_name = 'lc_classifier', ranking IN (1, 2)\n  - Note: Default condition of ranking = 1 is explicitly overridden by the user to include 1 and 2.\n\nHigh-level approach\n- First, select up to 100 distinct oids from feature that meet the Multiband_period condition in the specified feature version.\n- Then, INNER JOIN these oids to probability to retrieve all classification rows for lc_classifier with ranking 1 or 2.\n- Return all columns from probability for the matched rows.\n\nDetailed steps\n\n1) Define the filtering conditions on the feature table\n- Table: feature f\n- Conditions:\n  - f.name = 'Multiband_period'\n  - f.version = 'lc_classifier_1.2.1-P'\n  - f.value < 5\n- Notes:\n  - Do not restrict by fid unless necessary; Multiband_period is computed as a multiband feature and may be stored once (often with fid=123), but to be robust, do not assume a particular fid. Use DISTINCT to avoid duplicate oids if multiple fid rows exist.\n\n2) Select the target objects (limit to 100 distinct oids)\n- Create a CTE or subquery that returns up to 100 distinct f.oid values that satisfy the above conditions.\n- Example logical selection (no SQL to be written here):\n  - FROM feature f\n  - WHERE f.name = 'Multiband_period' AND f.version = 'lc_classifier_1.2.1-P' AND f.value < 5\n  - SELECT DISTINCT f.oid\n  - LIMIT 100\n- Rationale:\n  - The \u201cat most 100 ZTF objects\u201d constraint should apply to distinct objects, not rows in probability. Selecting distinct oids before joining ensures we do not over-limit after join (since each object may produce two probability rows for rankings 1 and 2).\n\n3) Join the selected oids to the probability table\n- Table: probability p\n- Join:\n  - INNER JOIN p ON p.oid = target_oids.oid (where target_oids is the CTE/subquery of step 2)\n- Filters on probability:\n  - p.classifier_name = 'lc_classifier'\n  - p.ranking IN (1, 2)\n- Notes:\n  - The default condition of ranking = 1 is intentionally not used because the user asks for rankings 1 or 2.\n  - Do not add any filter on classifier_version since none was requested.\n\n4) Select the required columns\n- Return all columns from the probability table for the matched rows.\n- Practically: select p.* (conceptually; do not write the SQL here).\n\n5) Optional ordering\n- The user did not request a particular sort order.\n- If a stable order is desired, order by p.oid ASC, p.ranking ASC.\n- Otherwise, omit ORDER BY for potentially better performance.\n\n6) Performance considerations\n- The join will leverage:\n  - feature: filter on name, version, value < 5; no dedicated index for these fields, but the result set should be small after the LIMIT 100 distinct oids.\n  - probability: use the hash index on p.oid (ix_probabilities_oid) for the join and the btree index on p.ranking (ix_probabilities_ranking) for the ranking filter.\n- Selecting distinct oids before the join minimizes the number of joined rows and ensures the 100-object cap is respected.\n\n7) Edge cases and correctness checks\n- If fewer than 100 objects satisfy the feature condition, the result will include all available objects.\n- If multiple feature rows exist per object (e.g., different fid), DISTINCT in step 2 prevents duplicates.\n- Ensure exact string matches for names and versions:\n  - Feature name: 'Multiband_period'\n  - Feature version: 'lc_classifier_1.2.1-P'\n  - Probability classifier_name: 'lc_classifier'\n- No spatial filtering or Q3C functions are needed for this request.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve at most 100 distinct ZTF objects (by oid) that have Multiband_period < 5 days in the feature version 'lc_classifier_1.2.1-P'.\n- For those objects, return all columns from the probability table, restricted to the light curve classifier (classifier_name = 'lc_classifier') and rankings in (1, 2).\n\nKey schema elements to use\n- Table feature\n  - Columns: oid, name, value, fid, version\n  - Filters needed here: name = 'Multiband_period', version = 'lc_classifier_1.2.1-P', value < 5\n- Table probability\n  - Columns: oid, class_name, classifier_name, classifier_version, probability, ranking\n  - Filters needed here: classifier_name = 'lc_classifier', ranking IN (1, 2)\n  - Note: Default condition of ranking = 1 is explicitly overridden by the user to include 1 and 2.\n\nHigh-level approach\n- First, select up to 100 distinct oids from feature that meet the Multiband_period condition in the specified feature version.\n- Then, INNER JOIN these oids to probability to retrieve all classification rows for lc_classifier with ranking 1 or 2.\n- Return all columns from probability for the matched rows.\n\nDetailed steps\n\n1) Define the filtering conditions on the feature table\n- Table: feature f\n- Conditions:\n  - f.name = 'Multiband_period'\n  - f.version = 'lc_classifier_1.2.1-P'\n  - f.value < 5\n- Notes:\n  - Do not restrict by fid unless necessary; Multiband_period is computed as a multiband feature and may be stored once (often with fid=123), but to be robust, do not assume a particular fid. Use DISTINCT to avoid duplicate oids if multiple fid rows exist.\n\n2) Select the target objects (limit to 100 distinct oids)\n- Create a CTE or subquery that returns up to 100 distinct f.oid values that satisfy the above conditions.\n- Example logical selection (no SQL to be written here):\n  - FROM feature f\n  - WHERE f.name = 'Multiband_period' AND f.version = 'lc_classifier_1.2.1-P' AND f.value < 5\n  - SELECT DISTINCT f.oid\n  - LIMIT 100\n- Rationale:\n  - The \u201cat most 100 ZTF objects\u201d constraint should apply to distinct objects, not rows in probability. Selecting distinct oids before joining ensures we do not over-limit after join (since each object may produce two probability rows for rankings 1 and 2).\n\n3) Join the selected oids to the probability table\n- Table: probability p\n- Join:\n  - INNER JOIN p ON p.oid = target_oids.oid (where target_oids is the CTE/subquery of step 2)\n- Filters on probability:\n  - p.classifier_name = 'lc_classifier'\n  - p.ranking IN (1, 2)\n- Notes:\n  - The default condition of ranking = 1 is intentionally not used because the user asks for rankings 1 or 2.\n  - Do not add any filter on classifier_version since none was requested.\n\n4) Select the required columns\n- Return all columns from the probability table for the matched rows.\n- Practically: select p.* (conceptually; do not write the SQL here).\n\n5) Optional ordering\n- The user did not request a particular sort order.\n- If a stable order is desired, order by p.oid ASC, p.ranking ASC.\n- Otherwise, omit ORDER BY for potentially better performance.\n\n6) Performance considerations\n- The join will leverage:\n  - feature: filter on name, version, value < 5; no dedicated index for these fields, but the result set should be small after the LIMIT 100 distinct oids.\n  - probability: use the hash index on p.oid (ix_probabilities_oid) for the join and the btree index on p.ranking (ix_probabilities_ranking) for the ranking filter.\n- Selecting distinct oids before the join minimizes the number of joined rows and ensures the 100-object cap is respected.\n\n7) Edge cases and correctness checks\n- If fewer than 100 objects satisfy the feature condition, the result will include all available objects.\n- If multiple feature rows exist per object (e.g., different fid), DISTINCT in step 2 prevents duplicates.\n- Ensure exact string matches for names and versions:\n  - Feature name: 'Multiband_period'\n  - Feature version: 'lc_classifier_1.2.1-P'\n  - Probability classifier_name: 'lc_classifier'\n- No spatial filtering or Q3C functions are needed for this request."
                },
                "in_toks": 4736,
                "out_toks": 2931,
                "id": "chatcmpl-CSqs3MGNsluF8cOY68aKGtOEZRT5f",
                "created": 1760992455,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Retrieve all probability rows (rankings 1 or 2) for up to 100 objects\n-- whose Multiband_period < 5 days in feature version 'lc_classifier_1.2.1-P'\n-- Only the light curve classifier ('lc_classifier') is included, as requested.\n\nWITH selected_oids AS (\n    SELECT DISTINCT f.oid\n    FROM feature f\n    WHERE f.name = 'Multiband_period'\n      AND f.version = 'lc_classifier_1.2.1-P'\n      AND f.value < 5\n    LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN selected_oids s\n    ON p.oid = s.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Retrieve all probability rows (rankings 1 or 2) for up to 100 objects\n-- whose Multiband_period < 5 days in feature version 'lc_classifier_1.2.1-P'\n-- Only the light curve classifier ('lc_classifier') is included, as requested.\n\nWITH selected_oids AS (\n    SELECT DISTINCT f.oid\n    FROM feature f\n    WHERE f.name = 'Multiband_period'\n      AND f.version = 'lc_classifier_1.2.1-P'\n      AND f.value < 5\n    LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN selected_oids s\n    ON p.oid = s.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2);\n```"
                },
                "in_toks": 3058,
                "out_toks": 1459,
                "id": "chatcmpl-CSr6EC246zXfuPEXSxbuAoXXKDPeh",
                "created": 1760993334,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "90",
            "experiment_id": "run_1",
            "pred_tables": [
                "probability",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'feature', 'feature_version']",
                    "1": "['probability', 'feature', 'feature_version']"
                },
                "in_toks": 650,
                "out_toks": 2280,
                "id": "chatcmpl-CSnarZW8cnIBWwhtwdF3EweLRNeUB",
                "created": 1760979857,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 3128,
                "out_toks": 1039,
                "id": "chatcmpl-CSnr6WYJpBIngXvSJO9aBAmaAqTWc",
                "created": 1760980864,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the SQL query\n\n1) Clarify scope and assumptions\n- \u201cZTF objects\u201d will be enforced by filtering object identifiers with the ZTF prefix in the ALeRCE oid, i.e., oid LIKE 'ZTF%'. (All tables in scope use the same oid key, and an object table is not required for this filter.)\n- Multiband period is stored in the feature table as:\n  - name = 'Multiband_period'\n  - version = 'lc_classifier_1.2.1-P'\n  - value contains the period in days; apply value < 5.\n- The user explicitly wants probability rows for the light curve classifier with rankings either 1 or 2 (overriding the default ranking = 1). Use classifier_name = 'lc_classifier' and ranking IN (1, 2).\n- Return all columns from probability for the matching objects.\n\n2) Build a subquery that finds at most 100 unique ZTF objects by the multiband-period criterion\n- Start from feature f.\n- WHERE conditions:\n  - f.name = 'Multiband_period'\n  - f.version = 'lc_classifier_1.2.1-P'\n  - f.value < 5\n  - f.oid LIKE 'ZTF%'\n- Select unique object identifiers to avoid duplicates from multiple rows per object (e.g., due to different fid values):\n  - Use SELECT DISTINCT f.oid (or GROUP BY f.oid).\n- Apply LIMIT 100 in this subquery so the \u201cat most 100 objects\u201d constraint refers to objects, not rows. This ensures the final join doesn\u2019t unintentionally exceed 100 objects because of multiple probability rows per object.\n\n3) Join the selected oids to the probability table to get requested classifier outputs\n- Use an INNER JOIN between:\n  - probability p\n  - the subquery of selected oids from step 2 (aliased, e.g., sel)\n  - Join condition: p.oid = sel.oid\n- Apply probability table filters:\n  - p.classifier_name = 'lc_classifier'\n  - p.ranking IN (1, 2)\n- Do not filter by classifier_version or class_name unless specifically requested; return the existing top-2 ranked classes for each oid.\n\n4) Select and return all columns from probability\n- Because the user requested \u201call columns from the probability table,\u201d select p.* only.\n- The result will contain up to 2 probability rows per selected object (rankings 1 and/or 2), depending on data availability.\n\n5) Optional ordering for readability (does not change content)\n- Order by p.oid ASC, p.ranking ASC to group rows per object and show rank 1 before rank 2.\n\n6) Notes on correctness and performance\n- Limiting in the subquery (step 2) guarantees no more than 100 objects, while still returning both rank 1 and 2 probability rows for each selected object after the join.\n- The feature table has an index on oid only (ix_feature_oid_2), so the filters on name/version/value will be applied via table scan unless other indexes exist; constraining with version, name, and value early still reduces the join set effectively.\n- No need to reference feature_version table because the version filter is directly applied via feature.version.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the SQL query\n\n1) Clarify scope and assumptions\n- \u201cZTF objects\u201d will be enforced by filtering object identifiers with the ZTF prefix in the ALeRCE oid, i.e., oid LIKE 'ZTF%'. (All tables in scope use the same oid key, and an object table is not required for this filter.)\n- Multiband period is stored in the feature table as:\n  - name = 'Multiband_period'\n  - version = 'lc_classifier_1.2.1-P'\n  - value contains the period in days; apply value < 5.\n- The user explicitly wants probability rows for the light curve classifier with rankings either 1 or 2 (overriding the default ranking = 1). Use classifier_name = 'lc_classifier' and ranking IN (1, 2).\n- Return all columns from probability for the matching objects.\n\n2) Build a subquery that finds at most 100 unique ZTF objects by the multiband-period criterion\n- Start from feature f.\n- WHERE conditions:\n  - f.name = 'Multiband_period'\n  - f.version = 'lc_classifier_1.2.1-P'\n  - f.value < 5\n  - f.oid LIKE 'ZTF%'\n- Select unique object identifiers to avoid duplicates from multiple rows per object (e.g., due to different fid values):\n  - Use SELECT DISTINCT f.oid (or GROUP BY f.oid).\n- Apply LIMIT 100 in this subquery so the \u201cat most 100 objects\u201d constraint refers to objects, not rows. This ensures the final join doesn\u2019t unintentionally exceed 100 objects because of multiple probability rows per object.\n\n3) Join the selected oids to the probability table to get requested classifier outputs\n- Use an INNER JOIN between:\n  - probability p\n  - the subquery of selected oids from step 2 (aliased, e.g., sel)\n  - Join condition: p.oid = sel.oid\n- Apply probability table filters:\n  - p.classifier_name = 'lc_classifier'\n  - p.ranking IN (1, 2)\n- Do not filter by classifier_version or class_name unless specifically requested; return the existing top-2 ranked classes for each oid.\n\n4) Select and return all columns from probability\n- Because the user requested \u201call columns from the probability table,\u201d select p.* only.\n- The result will contain up to 2 probability rows per selected object (rankings 1 and/or 2), depending on data availability.\n\n5) Optional ordering for readability (does not change content)\n- Order by p.oid ASC, p.ranking ASC to group rows per object and show rank 1 before rank 2.\n\n6) Notes on correctness and performance\n- Limiting in the subquery (step 2) guarantees no more than 100 objects, while still returning both rank 1 and 2 probability rows for each selected object after the join.\n- The feature table has an index on oid only (ix_feature_oid_2), so the filters on name/version/value will be applied via table scan unless other indexes exist; constraining with version, name, and value early still reduces the join set effectively.\n- No need to reference feature_version table because the version filter is directly applied via feature.version."
                },
                "in_toks": 4736,
                "out_toks": 2871,
                "id": "chatcmpl-CSqs8egfOd92sIgjw9OSVeCOwIzlO",
                "created": 1760992460,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 100 ZTF objects with Multiband_period < 5 in the specified feature version,\n-- then return all probability rows for the light curve classifier with rankings 1 or 2.\nSELECT\n  p.*\nFROM probability AS p\nINNER JOIN (\n  SELECT DISTINCT f.oid\n  FROM feature AS f\n  WHERE\n    f.name = 'Multiband_period'\n    AND f.version = 'lc_classifier_1.2.1-P'\n    AND f.value < 5\n    AND f.oid LIKE 'ZTF%'\n  LIMIT 100\n) AS sel\n  ON p.oid = sel.oid\nWHERE\n  p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nORDER BY\n  p.oid ASC,\n  p.ranking ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 100 ZTF objects with Multiband_period < 5 in the specified feature version,\n-- then return all probability rows for the light curve classifier with rankings 1 or 2.\nSELECT\n  p.*\nFROM probability AS p\nINNER JOIN (\n  SELECT DISTINCT f.oid\n  FROM feature AS f\n  WHERE\n    f.name = 'Multiband_period'\n    AND f.version = 'lc_classifier_1.2.1-P'\n    AND f.value < 5\n    AND f.oid LIKE 'ZTF%'\n  LIMIT 100\n) AS sel\n  ON p.oid = sel.oid\nWHERE\n  p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nORDER BY\n  p.oid ASC,\n  p.ranking ASC;\n```"
                },
                "in_toks": 2742,
                "out_toks": 1914,
                "id": "chatcmpl-CSr6EtKs8qNvXENGXlzW0GZTWWxXV",
                "created": 1760993334,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "90",
            "experiment_id": "run_2",
            "pred_tables": [
                "probability",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'feature', 'feature_version']"
                },
                "in_toks": 650,
                "out_toks": 1172,
                "id": "chatcmpl-CSsrGJoil9O0WSwiSKJ9GSoNqjVoV",
                "created": 1761000094,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return all probability rows (p.*) for up to 100 ZTF objects whose Multiband_period < 5 days\n-- in feature.version = 'lc_classifier_1.2.1-P', restricted to the light curve classifier\n-- and rankings 1 or 2.\nWITH eligible_oids AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   WHERE f.name = 'Multiband_period'\n     AND f.version = 'lc_classifier_1.2.1-P'\n     AND f.value < 5\n     AND f.oid LIKE 'ZTF%' -- Remove f.value from ORDER BY to satisfy DISTINCT requirements\n\n   ORDER BY f.oid ASC\n   LIMIT 100)\nSELECT p.*\nFROM probability p\nINNER JOIN eligible_oids e ON p.oid = e.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1,\n                    2)\nORDER BY p.oid ASC,\n         p.ranking ASC;",
            "sql_response": {
                "responses": {
                    "0": "-- Return all probability rows (p.*) for up to 100 ZTF objects whose Multiband_period < 5 days\n-- in feature.version = 'lc_classifier_1.2.1-P', restricted to the light curve classifier\n-- and rankings 1 or 2.\nWITH eligible_oids AS\n  (SELECT DISTINCT f.oid\n   FROM feature f\n   WHERE f.name = 'Multiband_period'\n     AND f.version = 'lc_classifier_1.2.1-P'\n     AND f.value < 5\n     AND f.oid LIKE 'ZTF%' -- Remove f.value from ORDER BY to satisfy DISTINCT requirements\n\n   ORDER BY f.oid ASC\n   LIMIT 100)\nSELECT p.*\nFROM probability p\nINNER JOIN eligible_oids e ON p.oid = e.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1,\n                    2)\nORDER BY p.oid ASC,\n         p.ranking ASC;"
                },
                "in_toks": 3597,
                "out_toks": 1430,
                "id": "chatcmpl-CbHUKd73mO9fixoEqjlxdWETgXkzY",
                "created": 1763001396,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 3128,
                "out_toks": 783,
                "id": "chatcmpl-CSxcPrecgDnDFkXMLrSBjwOh3dR0c",
                "created": 1761018393,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Parse the user requirements and set the global constraints\n- Goal: Return all columns from the probability table (i.e., SELECT p.*) for ZTF objects having Multiband_period < 5 days, computed in feature.version = 'lc_classifier_1.2.1-P'.\n- Classifier constraints (probability table):\n  - Include only the light curve classifier: probability.classifier_name = 'lc_classifier'.\n  - Rankings relaxed per user request: probability.ranking IN (1, 2) (note: this overrides the default ranking=1 rule).\n- Limit: At most 100 distinct objects (ZTF objects).\n- ZTF-only: If the database may contain non-ZTF oids, filter to OIDs starting with 'ZTF' via oid LIKE 'ZTF%'. If the dataset is exclusively ZTF, this condition will be redundant but harmless.\n\n2) Identify relevant tables and columns\n- feature table (to select qualifying objects):\n  - Columns used: feature.oid, feature.name, feature.value, feature.version (fid is present but not constrained here).\n  - Conditions: feature.name = 'Multiband_period', feature.version = 'lc_classifier_1.2.1-P', feature.value < 5.\n  - Optional: feature.oid LIKE 'ZTF%' to restrict to ZTF objects if necessary.\n- probability table (to return requested results):\n  - Columns: probability.oid, probability.class_name, probability.classifier_name, probability.classifier_version, probability.probability, probability.ranking.\n  - Conditions: probability.classifier_name = 'lc_classifier' AND probability.ranking IN (1, 2).\n\n3) Build a reduced, de-duplicated set of eligible objects\n- Create a subquery or CTE (e.g., eligible_oids) that returns at most 100 DISTINCT feature.oid that satisfy:\n  - feature.name = 'Multiband_period'\n  - feature.version = 'lc_classifier_1.2.1-P'\n  - feature.value < 5\n  - Optional ZTF filter: feature.oid LIKE 'ZTF%'\n- Use DISTINCT on feature.oid to avoid duplicates arising from multiple fid values or multiple rows per oid.\n- Apply LIMIT 100 in this subquery/CTE so that the cap applies to the number of unique objects, not to the number of probability rows.\n- Optional ordering (for deterministic selection across runs): ORDER BY feature.value ASC, feature.oid ASC before the LIMIT, if you want to prioritize the shortest periods. The user did not request a specific ordering, so this is optional.\n\n4) Join the eligible objects to the probability table\n- Perform an INNER JOIN from probability p to eligible_oids e on p.oid = e.oid.\n- Apply the classifier constraints: p.classifier_name = 'lc_classifier' AND p.ranking IN (1, 2).\n- Return all columns from probability: SELECT p.*.\n- This will yield up to two rows per object (rankings 1 and 2), for up to 100 objects.\n\n5) Optional result ordering\n- For readability or stable output, add ORDER BY p.oid ASC, p.ranking ASC (or another ordering as needed). Not required by the user.\n\n6) Notes and assumptions for accuracy and performance\n- We purposely do not constrain feature.fid because Multiband_period is a multiband feature; constraining fid could inadvertently exclude valid entries. Using DISTINCT on oid in the eligible_oids subquery prevents duplication if multiple fid values exist.\n- The limit must be applied to the set of distinct objects (eligible_oids) before joining to probability, otherwise LIMIT would cap the number of returned probability rows rather than the number of objects.\n- Index usage:\n  - Joining probability with a small eligible_oids set will leverage ix_probabilities_oid (hash) efficiently.\n  - Filtering by probability.ranking and probability.classifier_name can benefit from ix_probabilities_ranking and standard filtering; the main reduction should already come from eligible_oids.\n- Null handling: feature.value < 5 inherently excludes NULLs, which is desired.\n- If the database includes non-ZTF surveys, keep the ZTF filter (oid LIKE 'ZTF%') either in eligible_oids or in the final WHERE clause. If ALeRCE here is exclusively ZTF, it can be omitted.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Parse the user requirements and set the global constraints\n- Goal: Return all columns from the probability table (i.e., SELECT p.*) for ZTF objects having Multiband_period < 5 days, computed in feature.version = 'lc_classifier_1.2.1-P'.\n- Classifier constraints (probability table):\n  - Include only the light curve classifier: probability.classifier_name = 'lc_classifier'.\n  - Rankings relaxed per user request: probability.ranking IN (1, 2) (note: this overrides the default ranking=1 rule).\n- Limit: At most 100 distinct objects (ZTF objects).\n- ZTF-only: If the database may contain non-ZTF oids, filter to OIDs starting with 'ZTF' via oid LIKE 'ZTF%'. If the dataset is exclusively ZTF, this condition will be redundant but harmless.\n\n2) Identify relevant tables and columns\n- feature table (to select qualifying objects):\n  - Columns used: feature.oid, feature.name, feature.value, feature.version (fid is present but not constrained here).\n  - Conditions: feature.name = 'Multiband_period', feature.version = 'lc_classifier_1.2.1-P', feature.value < 5.\n  - Optional: feature.oid LIKE 'ZTF%' to restrict to ZTF objects if necessary.\n- probability table (to return requested results):\n  - Columns: probability.oid, probability.class_name, probability.classifier_name, probability.classifier_version, probability.probability, probability.ranking.\n  - Conditions: probability.classifier_name = 'lc_classifier' AND probability.ranking IN (1, 2).\n\n3) Build a reduced, de-duplicated set of eligible objects\n- Create a subquery or CTE (e.g., eligible_oids) that returns at most 100 DISTINCT feature.oid that satisfy:\n  - feature.name = 'Multiband_period'\n  - feature.version = 'lc_classifier_1.2.1-P'\n  - feature.value < 5\n  - Optional ZTF filter: feature.oid LIKE 'ZTF%'\n- Use DISTINCT on feature.oid to avoid duplicates arising from multiple fid values or multiple rows per oid.\n- Apply LIMIT 100 in this subquery/CTE so that the cap applies to the number of unique objects, not to the number of probability rows.\n- Optional ordering (for deterministic selection across runs): ORDER BY feature.value ASC, feature.oid ASC before the LIMIT, if you want to prioritize the shortest periods. The user did not request a specific ordering, so this is optional.\n\n4) Join the eligible objects to the probability table\n- Perform an INNER JOIN from probability p to eligible_oids e on p.oid = e.oid.\n- Apply the classifier constraints: p.classifier_name = 'lc_classifier' AND p.ranking IN (1, 2).\n- Return all columns from probability: SELECT p.*.\n- This will yield up to two rows per object (rankings 1 and 2), for up to 100 objects.\n\n5) Optional result ordering\n- For readability or stable output, add ORDER BY p.oid ASC, p.ranking ASC (or another ordering as needed). Not required by the user.\n\n6) Notes and assumptions for accuracy and performance\n- We purposely do not constrain feature.fid because Multiband_period is a multiband feature; constraining fid could inadvertently exclude valid entries. Using DISTINCT on oid in the eligible_oids subquery prevents duplication if multiple fid values exist.\n- The limit must be applied to the set of distinct objects (eligible_oids) before joining to probability, otherwise LIMIT would cap the number of returned probability rows rather than the number of objects.\n- Index usage:\n  - Joining probability with a small eligible_oids set will leverage ix_probabilities_oid (hash) efficiently.\n  - Filtering by probability.ranking and probability.classifier_name can benefit from ix_probabilities_ranking and standard filtering; the main reduction should already come from eligible_oids.\n- Null handling: feature.value < 5 inherently excludes NULLs, which is desired.\n- If the database includes non-ZTF surveys, keep the ZTF filter (oid LIKE 'ZTF%') either in eligible_oids or in the final WHERE clause. If ALeRCE here is exclusively ZTF, it can be omitted."
                },
                "in_toks": 4736,
                "out_toks": 3925,
                "id": "chatcmpl-CSxkYAt4APSDoJDIQb7dbxGrRANMM",
                "created": 1761018898,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all probability rows (p.*) for up to 100 ZTF objects whose Multiband_period < 5 days\n-- in feature.version = 'lc_classifier_1.2.1-P', restricted to the light curve classifier\n-- and rankings 1 or 2.\nWITH eligible_oids AS (\n    SELECT DISTINCT f.oid\n    FROM feature f\n    WHERE f.name = 'Multiband_period'\n      AND f.version = 'lc_classifier_1.2.1-P'\n      AND f.value < 5\n      AND f.oid LIKE 'ZTF%'\n    ORDER BY f.value ASC, f.oid ASC\n    LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN eligible_oids e ON p.oid = e.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nORDER BY p.oid ASC, p.ranking ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all probability rows (p.*) for up to 100 ZTF objects whose Multiband_period < 5 days\n-- in feature.version = 'lc_classifier_1.2.1-P', restricted to the light curve classifier\n-- and rankings 1 or 2.\nWITH eligible_oids AS (\n    SELECT DISTINCT f.oid\n    FROM feature f\n    WHERE f.name = 'Multiband_period'\n      AND f.version = 'lc_classifier_1.2.1-P'\n      AND f.value < 5\n      AND f.oid LIKE 'ZTF%'\n    ORDER BY f.value ASC, f.oid ASC\n    LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN eligible_oids e ON p.oid = e.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nORDER BY p.oid ASC, p.ranking ASC;\n```"
                },
                "in_toks": 2964,
                "out_toks": 1233,
                "id": "chatcmpl-CSyLh1JcQgNAoRWaegousNyXBbjbZ",
                "created": 1761021201,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "3": {
            "req_id": "90",
            "experiment_id": "run_3",
            "pred_tables": [
                "probability",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'feature', 'feature_version']"
                },
                "in_toks": 650,
                "out_toks": 788,
                "id": "chatcmpl-CSsrWHfTa95Elew6hZtuVPY5AEB1O",
                "created": 1761000110,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 3128,
                "out_toks": 1039,
                "id": "chatcmpl-CSxcetIkoop52BqYZATscjwrISBCC",
                "created": 1761018408,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Interpret the user\u2019s requirements and defaults\n- Target entities: ZTF objects in ALeRCE (represented by object identifiers in the oid column).\n- Feature constraint: objects whose Multiband_period feature value is strictly less than 5 days.\n- Feature version: restrict to feature.version = 'lc_classifier_1.2.1-P'.\n- Limit: at most 100 distinct objects (distinct oids). The limit should apply to objects selected by the feature constraint before fetching probabilities, so the final result may contain more than 100 rows because there can be multiple probability rows per oid (e.g., multiple classes or classifier versions).\n- Output: all columns from the probability table (i.e., probability.*).\n- Classifier restriction: only probability rows with classifier_name = 'lc_classifier'.\n- Ranking restriction: probability.ranking IN (1, 2). This overrides the default (which would be ranking = 1).\n- No spatial constraints; Q3C functions are not required.\n- No explicit ordering was requested; optionally provide a deterministic order (e.g., by oid, ranking) for readability.\n\n2) Identify the tables and relevant columns\n- feature\n  - Columns: oid (VARCHAR), name (VARCHAR), value (DOUBLE PRECISION), fid (INTEGER), version (VARCHAR)\n  - Filters to apply:\n    - name = 'Multiband_period'\n    - version = 'lc_classifier_1.2.1-P'\n    - value < 5\n    - Optional: fid = 123 (gri multiband), if you want to enforce the multiband fid; if uncertain, omit the fid condition to include all Multiband_period rows regardless of fid.\n- probability\n  - Columns: oid (VARCHAR), class_name (VARCHAR), classifier_name (VARCHAR), classifier_version (VARCHAR), probability (DOUBLE PRECISION), ranking (INTEGER)\n  - Filters to apply:\n    - classifier_name = 'lc_classifier'\n    - ranking IN (1, 2)\n\n3) Build a subquery (CTE) to select the candidate objects\n- From feature, select distinct oid where:\n  - feature.name = 'Multiband_period'\n  - feature.version = 'lc_classifier_1.2.1-P'\n  - feature.value < 5\n  - Optional: feature.fid = 123 (if enforcing multiband fid; otherwise omit)\n- Apply LIMIT 100 to this distinct set to ensure \u201cat most 100 ZTF objects.\u201d If deterministic reproducibility is desired, add an ORDER BY (e.g., ORDER BY feature.value ASC, oid) before LIMIT; otherwise omit ORDER BY.\n- Alias this CTE as selected_oids(oid).\n\n4) Join selected objects to probability to fetch desired rows\n- Perform an INNER JOIN from probability p to selected_oids so that only probability rows for those 100 oids are returned.\n- Apply classifier and ranking filters on probability:\n  - p.classifier_name = 'lc_classifier'\n  - p.ranking IN (1, 2)\n- No filter on p.class_name is required (return all classes meeting ranking condition).\n- No filter on p.classifier_version is required unless the user specifies one.\n\n5) Projection and final result shape\n- Select all columns from probability for the matched rows (i.e., p.*), as requested.\n- Note: Because each oid may have multiple classes (and possibly multiple classifier_version entries), you may return multiple rows per oid. This is consistent with the user request to \u201cReturn all columns from the probability table for such objects.\u201d\n\n6) Optional ordering for readability (not required)\n- Add ORDER BY p.oid, p.ranking, p.classifier_version, p.class_name to group results per object and by ranking.\n\n7) Performance and indexing considerations\n- The join will benefit from:\n  - Hash index on probability.oid (ix_probabilities_oid) when joining to selected_oids.\n- The feature-side filters (name, version, value) rely on sequential scan unless other indexes exist; restricting by name, version, and value reduces the working set. If available, a composite index on (name, version, value) would help, but it\u2019s not defined here.\n- Keeping the LIMIT in the CTE ensures only up to 100 oids are carried into the join, reducing the number of joined probability rows.\n\n8) Edge cases and assumptions\n- Assumes ALeRCE oids correspond to ZTF objects (common in this dataset). If a stricter ZTF filter were needed via the object table (not provided here), you would join to object to enforce it. Given the current schema details, this is not applied.\n- If Multiband_period appears with multiple fid values, omitting the fid filter ensures you consider all; if the database convention is to store multiband features with fid = 123 (gri), include fid = 123 to be precise.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Interpret the user\u2019s requirements and defaults\n- Target entities: ZTF objects in ALeRCE (represented by object identifiers in the oid column).\n- Feature constraint: objects whose Multiband_period feature value is strictly less than 5 days.\n- Feature version: restrict to feature.version = 'lc_classifier_1.2.1-P'.\n- Limit: at most 100 distinct objects (distinct oids). The limit should apply to objects selected by the feature constraint before fetching probabilities, so the final result may contain more than 100 rows because there can be multiple probability rows per oid (e.g., multiple classes or classifier versions).\n- Output: all columns from the probability table (i.e., probability.*).\n- Classifier restriction: only probability rows with classifier_name = 'lc_classifier'.\n- Ranking restriction: probability.ranking IN (1, 2). This overrides the default (which would be ranking = 1).\n- No spatial constraints; Q3C functions are not required.\n- No explicit ordering was requested; optionally provide a deterministic order (e.g., by oid, ranking) for readability.\n\n2) Identify the tables and relevant columns\n- feature\n  - Columns: oid (VARCHAR), name (VARCHAR), value (DOUBLE PRECISION), fid (INTEGER), version (VARCHAR)\n  - Filters to apply:\n    - name = 'Multiband_period'\n    - version = 'lc_classifier_1.2.1-P'\n    - value < 5\n    - Optional: fid = 123 (gri multiband), if you want to enforce the multiband fid; if uncertain, omit the fid condition to include all Multiband_period rows regardless of fid.\n- probability\n  - Columns: oid (VARCHAR), class_name (VARCHAR), classifier_name (VARCHAR), classifier_version (VARCHAR), probability (DOUBLE PRECISION), ranking (INTEGER)\n  - Filters to apply:\n    - classifier_name = 'lc_classifier'\n    - ranking IN (1, 2)\n\n3) Build a subquery (CTE) to select the candidate objects\n- From feature, select distinct oid where:\n  - feature.name = 'Multiband_period'\n  - feature.version = 'lc_classifier_1.2.1-P'\n  - feature.value < 5\n  - Optional: feature.fid = 123 (if enforcing multiband fid; otherwise omit)\n- Apply LIMIT 100 to this distinct set to ensure \u201cat most 100 ZTF objects.\u201d If deterministic reproducibility is desired, add an ORDER BY (e.g., ORDER BY feature.value ASC, oid) before LIMIT; otherwise omit ORDER BY.\n- Alias this CTE as selected_oids(oid).\n\n4) Join selected objects to probability to fetch desired rows\n- Perform an INNER JOIN from probability p to selected_oids so that only probability rows for those 100 oids are returned.\n- Apply classifier and ranking filters on probability:\n  - p.classifier_name = 'lc_classifier'\n  - p.ranking IN (1, 2)\n- No filter on p.class_name is required (return all classes meeting ranking condition).\n- No filter on p.classifier_version is required unless the user specifies one.\n\n5) Projection and final result shape\n- Select all columns from probability for the matched rows (i.e., p.*), as requested.\n- Note: Because each oid may have multiple classes (and possibly multiple classifier_version entries), you may return multiple rows per oid. This is consistent with the user request to \u201cReturn all columns from the probability table for such objects.\u201d\n\n6) Optional ordering for readability (not required)\n- Add ORDER BY p.oid, p.ranking, p.classifier_version, p.class_name to group results per object and by ranking.\n\n7) Performance and indexing considerations\n- The join will benefit from:\n  - Hash index on probability.oid (ix_probabilities_oid) when joining to selected_oids.\n- The feature-side filters (name, version, value) rely on sequential scan unless other indexes exist; restricting by name, version, and value reduces the working set. If available, a composite index on (name, version, value) would help, but it\u2019s not defined here.\n- Keeping the LIMIT in the CTE ensures only up to 100 oids are carried into the join, reducing the number of joined probability rows.\n\n8) Edge cases and assumptions\n- Assumes ALeRCE oids correspond to ZTF objects (common in this dataset). If a stricter ZTF filter were needed via the object table (not provided here), you would join to object to enforce it. Given the current schema details, this is not applied.\n- If Multiband_period appears with multiple fid values, omitting the fid filter ensures you consider all; if the database convention is to store multiband features with fid = 123 (gri), include fid = 123 to be precise."
                },
                "in_toks": 4736,
                "out_toks": 2755,
                "id": "chatcmpl-CSxlPo3MlTJlJKQcMFnpfkqQFCfbe",
                "created": 1761018951,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 100 objects with Multiband_period < 5 days in feature version 'lc_classifier_1.2.1-P'\n-- and return all probability rows for the light curve classifier with ranking 1 or 2\nWITH selected_oids AS (\n  SELECT DISTINCT f.oid\n  FROM feature f\n  WHERE f.name = 'Multiband_period'\n    AND f.version = 'lc_classifier_1.2.1-P'\n    AND f.value < 5\n  LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN selected_oids s ON s.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nORDER BY p.oid, p.ranking, p.classifier_version, p.class_name;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 100 objects with Multiband_period < 5 days in feature version 'lc_classifier_1.2.1-P'\n-- and return all probability rows for the light curve classifier with ranking 1 or 2\nWITH selected_oids AS (\n  SELECT DISTINCT f.oid\n  FROM feature f\n  WHERE f.name = 'Multiband_period'\n    AND f.version = 'lc_classifier_1.2.1-P'\n    AND f.value < 5\n  LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN selected_oids s ON s.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nORDER BY p.oid, p.ranking, p.classifier_version, p.class_name;\n```"
                },
                "in_toks": 3074,
                "out_toks": 1912,
                "id": "chatcmpl-CSyLykvOOlPg5iyqhxGgJEuIhUhYH",
                "created": 1761021218,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "90",
            "experiment_id": "run_4",
            "pred_tables": [
                "probability",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'feature', 'feature_version']"
                },
                "in_toks": 650,
                "out_toks": 852,
                "id": "chatcmpl-CSsrlOF3E4SecSiDN3NxYd1txaIiB",
                "created": 1761000125,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Return probability rows for objects whose multiband period feature < 5 days\n-- using the specified feature version. Use EXISTS to avoid duplicates from multiple fids.\n\nSELECT p.*\nFROM probability p\nWHERE p.classifier_name = 'lc_classifier' -- only light curve classifier\n\n  AND p.ranking IN (1,\n                    2)-- rankings 1 or 2\n\n  AND EXISTS\n    (SELECT 1\n     FROM feature f\n     WHERE f.oid = p.oid\n       AND f.name = 'Multiband_period' -- multiband period feature\n\n       AND f.version = 'lc_classifier_1.2.1-P' -- feature version filter\n\n       AND f.value < 5 -- period < 5 days\n)\nLIMIT 100;",
            "sql_response": {
                "responses": {
                    "0": "-- Return probability rows for objects whose multiband period feature < 5 days\n-- using the specified feature version. Use EXISTS to avoid duplicates from multiple fids.\n\nSELECT p.*\nFROM probability p\nWHERE p.classifier_name = 'lc_classifier' -- only light curve classifier\n\n  AND p.ranking IN (1,\n                    2)-- rankings 1 or 2\n\n  AND EXISTS\n    (SELECT 1\n     FROM feature f\n     WHERE f.oid = p.oid\n       AND f.name = 'Multiband_period' -- multiband period feature\n\n       AND f.version = 'lc_classifier_1.2.1-P' -- feature version filter\n\n       AND f.value < 5 -- period < 5 days\n)\nLIMIT 100;"
                },
                "in_toks": 3626,
                "out_toks": 1454,
                "id": "chatcmpl-CbHUZCIbM1mbDfoIXaSsH2cqPr9V1",
                "created": 1763001411,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 3128,
                "out_toks": 719,
                "id": "chatcmpl-CSxcpdhN4EzcgNSmw1FQqPkl3AL2T",
                "created": 1761018419,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 4736,
                "out_toks": 4000,
                "id": "chatcmpl-CSxm1MGF1w0wEqKzYlvHGiwG99Qds",
                "created": 1761018989,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- This query assumes there is a features table that stores the multiband period per object and feature/classifier version.\n-- Replace 'periodic_features' and 'multiband_period'/'classifier_version' with the actual table/column names in your ALeRCE DB.\nSELECT p.*\nFROM probability p\nINNER JOIN periodic_features f ON f.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'          -- only light curve classifier\n  AND p.ranking IN (1, 2)                          -- rankings either 1 or 2\n  AND f.classifier_version = 'lc_classifier_1.2.1-P' -- feature version filter\n  AND f.multiband_period < 5                       -- multiband period lower than 5 days\nLIMIT 100;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- This query assumes there is a features table that stores the multiband period per object and feature/classifier version.\n-- Replace 'periodic_features' and 'multiband_period'/'classifier_version' with the actual table/column names in your ALeRCE DB.\nSELECT p.*\nFROM probability p\nINNER JOIN periodic_features f ON f.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'          -- only light curve classifier\n  AND p.ranking IN (1, 2)                          -- rankings either 1 or 2\n  AND f.classifier_version = 'lc_classifier_1.2.1-P' -- feature version filter\n  AND f.multiband_period < 5                       -- multiband period lower than 5 days\nLIMIT 100;\n```"
                },
                "in_toks": 3038,
                "out_toks": 3443,
                "id": "chatcmpl-CSyMKl7tMKiCa2cOIxxbwl8Hjrv3w",
                "created": 1761021240,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "5": {
            "req_id": "90",
            "experiment_id": "run_5",
            "pred_tables": [
                "probability",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'feature', 'feature_version']"
                },
                "in_toks": 650,
                "out_toks": 980,
                "id": "chatcmpl-CZNI1QkJiC00sOX6JItk1ZJ55RcSN",
                "created": 1762547041,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "/* Find up to 100 ZTF objects with Multiband_period < 5 days for feature version 'lc_classifier_1.2.1-P'\n   Use fid = 123 to ensure the true multiband (gri) feature\n   Then return all probability columns for the light curve classifier with rankings 1 or 2 */ WITH candidates AS\n  (SELECT f.oid\n   FROM feature f\n   WHERE f.name = 'Multiband_period'\n     AND f.version = 'lc_classifier_1.2.1-P'\n     AND f.fid = 123 -- multiband (gri)\n\n     AND f.value < 5 -- period in days\n\n     AND f.oid LIKE 'ZTF%' -- ensure ZTF objects\n\n   ORDER BY f.value ASC,\n            f.oid ASC -- shortest periods first\n\n   LIMIT 100)\nSELECT p.*\nFROM probability p\nJOIN candidates c ON c.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1,\n                    2)\nORDER BY p.oid ASC,\n         p.ranking ASC;",
            "sql_response": {
                "responses": {
                    "0": "/* Find up to 100 ZTF objects with Multiband_period < 5 days for feature version 'lc_classifier_1.2.1-P'\n   Use fid = 123 to ensure the true multiband (gri) feature\n   Then return all probability columns for the light curve classifier with rankings 1 or 2 */ WITH candidates AS\n  (SELECT f.oid\n   FROM feature f\n   WHERE f.name = 'Multiband_period'\n     AND f.version = 'lc_classifier_1.2.1-P'\n     AND f.fid = 123 -- multiband (gri)\n\n     AND f.value < 5 -- period in days\n\n     AND f.oid LIKE 'ZTF%' -- ensure ZTF objects\n\n   ORDER BY f.value ASC,\n            f.oid ASC -- shortest periods first\n\n   LIMIT 100)\nSELECT p.*\nFROM probability p\nJOIN candidates c ON c.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1,\n                    2)\nORDER BY p.oid ASC,\n         p.ranking ASC;"
                },
                "in_toks": 3595,
                "out_toks": 1717,
                "id": "chatcmpl-CbHUtLvnV9REI4Q6htNqMCbVsC9Ip",
                "created": 1763001431,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 3128,
                "out_toks": 783,
                "id": "chatcmpl-CZYj8j0YLDfdyqDg96NSp1W2qacyw",
                "created": 1762591006,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve at most 100 ZTF objects whose multiband period is less than 5 days, using features computed in version 'lc_classifier_1.2.1-P'.\n- For those objects, return all columns from the probability table, restricted to the light curve classifier (classifier_name = 'lc_classifier') and rankings in (1, 2).\n\nTables and columns involved\n- feature(oid, name, value, fid, version)\n- probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n- Note: object table exists but is not required here unless additional filtering on survey metadata is needed. For \u201cZTF objects,\u201d filter by oid LIKE 'ZTF%'.\n\nDefault conditions and overrides\n- Since the probability table is used, the default classifier_name = 'lc_classifier' applies.\n- Override the default ranking = 1 to ranking IN (1, 2), as explicitly requested.\n- Use exact class/feature names as provided: feature.name = 'Multiband_period', feature.version = 'lc_classifier_1.2.1-P'.\n\nStep-by-step plan\n\n1) Define the candidate object set from feature\n- Source table: feature f.\n- Filters:\n  - f.name = 'Multiband_period'\n  - f.version = 'lc_classifier_1.2.1-P'\n  - f.value < 5\n  - f.oid LIKE 'ZTF%' to ensure ZTF objects (since no explicit survey column is available here).\n- Projection:\n  - SELECT DISTINCT f.oid to avoid duplicates caused by multiple fid entries for the same object.\n- Cardinality limit:\n  - Apply LIMIT 100 to the distinct oids so the constraint of \u201cat most 100 objects\u201d is enforced before joining to probability.\n- Optional determinism:\n  - Optionally ORDER BY f.value ASC, f.oid to pick the 100 shortest periods first (not required by the user, but improves determinism).\n\n2) Join candidates to probability and filter on classifier/ranking\n- Source table: probability p.\n- Join:\n  - INNER JOIN the candidate oid set from step 1 on p.oid = candidate.oid.\n- Filters on probability:\n  - p.classifier_name = 'lc_classifier' (only the light curve classifier).\n  - p.ranking IN (1, 2) (top-2 ranked classes per object for that classifier).\n- Projection:\n  - SELECT p.* (return all columns from the probability table).\n\n3) Optional output ordering\n- To present a structured output, you may ORDER BY p.oid ASC, p.ranking ASC (not required by the user).\n\n4) Performance and correctness considerations\n- The join will leverage ix_probabilities_oid (hash index on probability.oid).\n- The filter p.ranking IN (1, 2) can utilize ix_probabilities_ranking.\n- The feature table only has an index on oid (ix_feature_oid_2). The filters on name/version/value will likely require a scan over matching rows, but the DISTINCT + LIMIT 100 will keep the join small.\n- Using DISTINCT in the candidate selection ensures each object is included at most once even if multiple feature rows exist for different fid values.\n- The condition f.value < 5 inherently excludes NULL values.\n- No need to join feature_version since feature.version is directly filtered as 'lc_classifier_1.2.1-P'.\n\n5) Summary of logical flow\n- CTE or subquery \u201ccandidates\u201d: distinct oids from feature with Multiband_period < 5 in version 'lc_classifier_1.2.1-P', restricted to ZTF (oid LIKE 'ZTF%'), limited to 100 objects.\n- Main query: join candidates to probability, filter to p.classifier_name = 'lc_classifier' and p.ranking IN (1, 2), and return p.*.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve at most 100 ZTF objects whose multiband period is less than 5 days, using features computed in version 'lc_classifier_1.2.1-P'.\n- For those objects, return all columns from the probability table, restricted to the light curve classifier (classifier_name = 'lc_classifier') and rankings in (1, 2).\n\nTables and columns involved\n- feature(oid, name, value, fid, version)\n- probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n- Note: object table exists but is not required here unless additional filtering on survey metadata is needed. For \u201cZTF objects,\u201d filter by oid LIKE 'ZTF%'.\n\nDefault conditions and overrides\n- Since the probability table is used, the default classifier_name = 'lc_classifier' applies.\n- Override the default ranking = 1 to ranking IN (1, 2), as explicitly requested.\n- Use exact class/feature names as provided: feature.name = 'Multiband_period', feature.version = 'lc_classifier_1.2.1-P'.\n\nStep-by-step plan\n\n1) Define the candidate object set from feature\n- Source table: feature f.\n- Filters:\n  - f.name = 'Multiband_period'\n  - f.version = 'lc_classifier_1.2.1-P'\n  - f.value < 5\n  - f.oid LIKE 'ZTF%' to ensure ZTF objects (since no explicit survey column is available here).\n- Projection:\n  - SELECT DISTINCT f.oid to avoid duplicates caused by multiple fid entries for the same object.\n- Cardinality limit:\n  - Apply LIMIT 100 to the distinct oids so the constraint of \u201cat most 100 objects\u201d is enforced before joining to probability.\n- Optional determinism:\n  - Optionally ORDER BY f.value ASC, f.oid to pick the 100 shortest periods first (not required by the user, but improves determinism).\n\n2) Join candidates to probability and filter on classifier/ranking\n- Source table: probability p.\n- Join:\n  - INNER JOIN the candidate oid set from step 1 on p.oid = candidate.oid.\n- Filters on probability:\n  - p.classifier_name = 'lc_classifier' (only the light curve classifier).\n  - p.ranking IN (1, 2) (top-2 ranked classes per object for that classifier).\n- Projection:\n  - SELECT p.* (return all columns from the probability table).\n\n3) Optional output ordering\n- To present a structured output, you may ORDER BY p.oid ASC, p.ranking ASC (not required by the user).\n\n4) Performance and correctness considerations\n- The join will leverage ix_probabilities_oid (hash index on probability.oid).\n- The filter p.ranking IN (1, 2) can utilize ix_probabilities_ranking.\n- The feature table only has an index on oid (ix_feature_oid_2). The filters on name/version/value will likely require a scan over matching rows, but the DISTINCT + LIMIT 100 will keep the join small.\n- Using DISTINCT in the candidate selection ensures each object is included at most once even if multiple feature rows exist for different fid values.\n- The condition f.value < 5 inherently excludes NULL values.\n- No need to join feature_version since feature.version is directly filtered as 'lc_classifier_1.2.1-P'.\n\n5) Summary of logical flow\n- CTE or subquery \u201ccandidates\u201d: distinct oids from feature with Multiband_period < 5 in version 'lc_classifier_1.2.1-P', restricted to ZTF (oid LIKE 'ZTF%'), limited to 100 objects.\n- Main query: join candidates to probability, filter to p.classifier_name = 'lc_classifier' and p.ranking IN (1, 2), and return p.*."
                },
                "in_toks": 4736,
                "out_toks": 3631,
                "id": "chatcmpl-CZa3QIdYbW6uOTpXmIRrtPixy9jTc",
                "created": 1762596108,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* Find up to 100 ZTF objects with Multiband_period < 5 in version 'lc_classifier_1.2.1-P'\n   and return all columns from probability for the light curve classifier with rankings 1 or 2 */\nWITH candidates AS (\n    SELECT DISTINCT f.oid\n    FROM feature f\n    WHERE f.name = 'Multiband_period'\n      AND f.version = 'lc_classifier_1.2.1-P'\n      AND f.value < 5\n      AND f.oid LIKE 'ZTF%' -- ensure ZTF objects\n    ORDER BY f.value ASC, f.oid -- pick the shortest periods deterministically\n    LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN candidates c ON c.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nORDER BY p.oid ASC, p.ranking ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* Find up to 100 ZTF objects with Multiband_period < 5 in version 'lc_classifier_1.2.1-P'\n   and return all columns from probability for the light curve classifier with rankings 1 or 2 */\nWITH candidates AS (\n    SELECT DISTINCT f.oid\n    FROM feature f\n    WHERE f.name = 'Multiband_period'\n      AND f.version = 'lc_classifier_1.2.1-P'\n      AND f.value < 5\n      AND f.oid LIKE 'ZTF%' -- ensure ZTF objects\n    ORDER BY f.value ASC, f.oid -- pick the shortest periods deterministically\n    LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN candidates c ON c.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nORDER BY p.oid ASC, p.ranking ASC;\n```"
                },
                "in_toks": 2862,
                "out_toks": 1424,
                "id": "chatcmpl-CZaxRb6zUXoPxNcMPLslaZekhE3DY",
                "created": 1762599581,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "6": {
            "req_id": "90",
            "experiment_id": "run_6",
            "pred_tables": [
                "probability",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'feature', 'feature_version']"
                },
                "in_toks": 650,
                "out_toks": 660,
                "id": "chatcmpl-CZNIQ7g4brLZuECRfTr3EPWydDidx",
                "created": 1762547066,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 3128,
                "out_toks": 335,
                "id": "chatcmpl-CZYjMExcPUoxexTBSXKy3zPobJo14",
                "created": 1762591020,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Identify the goal and result shape\n- Goal: Retrieve up to 100 objects (OIDs) whose multiband period is less than 5 days, computed under feature.version = 'lc_classifier_1.2.1-P', and then return all classification rows from the probability table for those objects restricted to the light curve classifier and rankings 1 or 2.\n- Result shape: All columns from the probability table (i.e., probability.oid, probability.class_name, probability.classifier_name, probability.classifier_version, probability.probability, probability.ranking).\n- Important: The \u201cat most 100\u201d limit applies to the number of objects (distinct OIDs), not the number of returned probability rows. Each selected OID may yield up to two rows (ranking = 1 or 2) per classifier_version in the probability table.\n\n2) Tables and relevant columns\n- feature:\n  - oid (object identifier; join key to probability.oid)\n  - name (must equal 'Multiband_period')\n  - value (must be < 5; period in days)\n  - version (must equal 'lc_classifier_1.2.1-P')\n  - fid (not strictly needed for filtering; keep unconstrained)\n- probability:\n  - oid (join key)\n  - class_name\n  - classifier_name (must equal 'lc_classifier' per requirement)\n  - classifier_version (no constraint unless explicitly requested)\n  - probability\n  - ranking (must be 1 or 2; note this overrides the default ranking = 1 rule)\n\n3) Define the object subset (limit 100 objects)\n- Build a subquery (or CTE) that selects the distinct set of feature.oid satisfying:\n  - feature.name = 'Multiband_period'\n  - feature.version = 'lc_classifier_1.2.1-P'\n  - feature.value < 5\n- Use DISTINCT on feature.oid to avoid duplicates that could arise from multiple fid values or repeated rows.\n- Apply ORDER BY feature.oid (or another deterministic choice) to make the LIMIT reproducible.\n- Apply LIMIT 100 to constrain the number of objects. This ensures we return classifications for at most 100 distinct OIDs.\n\n4) Join to the probability table\n- INNER JOIN probability p ON p.oid = candidate_oids.oid (where candidate_oids is the subquery/CTE from step 3).\n- Apply classifier and ranking filters in the probability table:\n  - p.classifier_name = 'lc_classifier' (required)\n  - p.ranking IN (1, 2) (explicitly requested; overrides the default condition ranking = 1)\n- Do not filter by p.classifier_version unless specifically required by the user.\n\n5) Select and return columns\n- Select p.* to satisfy \u201cReturn all columns from the 'probability' table.\u201d\n- No need to select feature columns in the final projection since only classifications are requested.\n\n6) Optional ordering of final results\n- If a stable and readable order is desired, order the output by:\n  - p.oid ASC,\n  - p.classifier_version ASC,\n  - p.ranking ASC,\n  - p.probability DESC (as a reasonable tie-breaker).\n- Ordering is not required by the user, but documenting a default makes behavior deterministic.\n\n7) Notes on defaults and constraints\n- Default \u201cprobability\u201d conditions:\n  - Keep p.classifier_name = 'lc_classifier'.\n  - Override the default p.ranking = 1 to p.ranking IN (1, 2), per the user\u2019s explicit request.\n- No Q3C spatial constraints are needed (no RA/Dec filtering requested).\n- If fewer than 100 objects satisfy the feature constraint, the query returns all available objects.\n\n8) Performance considerations\n- The subquery/CTE that limits to 100 distinct OIDs first keeps the subsequent join to probability small.\n- Existing indexes:\n  - probability has indexes on oid (hash) and ranking (btree), which will help the join and the ranking filter.\n  - feature has an index on oid (hash), but not on (name, version, value); expect a filter on feature by name/version/value then DISTINCT/LIMIT. The version and name conditions will reduce the scanned rows.\n\n9) Summary of logical flow\n- Build candidate_oids as DISTINCT oid from feature where name = 'Multiband_period' AND version = 'lc_classifier_1.2.1-P' AND value < 5 ORDER BY oid LIMIT 100.\n- Join probability p to candidate_oids on oid.\n- Filter p to classifier_name = 'lc_classifier' and ranking IN (1, 2).\n- Return p.* (all columns from probability).",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Identify the goal and result shape\n- Goal: Retrieve up to 100 objects (OIDs) whose multiband period is less than 5 days, computed under feature.version = 'lc_classifier_1.2.1-P', and then return all classification rows from the probability table for those objects restricted to the light curve classifier and rankings 1 or 2.\n- Result shape: All columns from the probability table (i.e., probability.oid, probability.class_name, probability.classifier_name, probability.classifier_version, probability.probability, probability.ranking).\n- Important: The \u201cat most 100\u201d limit applies to the number of objects (distinct OIDs), not the number of returned probability rows. Each selected OID may yield up to two rows (ranking = 1 or 2) per classifier_version in the probability table.\n\n2) Tables and relevant columns\n- feature:\n  - oid (object identifier; join key to probability.oid)\n  - name (must equal 'Multiband_period')\n  - value (must be < 5; period in days)\n  - version (must equal 'lc_classifier_1.2.1-P')\n  - fid (not strictly needed for filtering; keep unconstrained)\n- probability:\n  - oid (join key)\n  - class_name\n  - classifier_name (must equal 'lc_classifier' per requirement)\n  - classifier_version (no constraint unless explicitly requested)\n  - probability\n  - ranking (must be 1 or 2; note this overrides the default ranking = 1 rule)\n\n3) Define the object subset (limit 100 objects)\n- Build a subquery (or CTE) that selects the distinct set of feature.oid satisfying:\n  - feature.name = 'Multiband_period'\n  - feature.version = 'lc_classifier_1.2.1-P'\n  - feature.value < 5\n- Use DISTINCT on feature.oid to avoid duplicates that could arise from multiple fid values or repeated rows.\n- Apply ORDER BY feature.oid (or another deterministic choice) to make the LIMIT reproducible.\n- Apply LIMIT 100 to constrain the number of objects. This ensures we return classifications for at most 100 distinct OIDs.\n\n4) Join to the probability table\n- INNER JOIN probability p ON p.oid = candidate_oids.oid (where candidate_oids is the subquery/CTE from step 3).\n- Apply classifier and ranking filters in the probability table:\n  - p.classifier_name = 'lc_classifier' (required)\n  - p.ranking IN (1, 2) (explicitly requested; overrides the default condition ranking = 1)\n- Do not filter by p.classifier_version unless specifically required by the user.\n\n5) Select and return columns\n- Select p.* to satisfy \u201cReturn all columns from the 'probability' table.\u201d\n- No need to select feature columns in the final projection since only classifications are requested.\n\n6) Optional ordering of final results\n- If a stable and readable order is desired, order the output by:\n  - p.oid ASC,\n  - p.classifier_version ASC,\n  - p.ranking ASC,\n  - p.probability DESC (as a reasonable tie-breaker).\n- Ordering is not required by the user, but documenting a default makes behavior deterministic.\n\n7) Notes on defaults and constraints\n- Default \u201cprobability\u201d conditions:\n  - Keep p.classifier_name = 'lc_classifier'.\n  - Override the default p.ranking = 1 to p.ranking IN (1, 2), per the user\u2019s explicit request.\n- No Q3C spatial constraints are needed (no RA/Dec filtering requested).\n- If fewer than 100 objects satisfy the feature constraint, the query returns all available objects.\n\n8) Performance considerations\n- The subquery/CTE that limits to 100 distinct OIDs first keeps the subsequent join to probability small.\n- Existing indexes:\n  - probability has indexes on oid (hash) and ranking (btree), which will help the join and the ranking filter.\n  - feature has an index on oid (hash), but not on (name, version, value); expect a filter on feature by name/version/value then DISTINCT/LIMIT. The version and name conditions will reduce the scanned rows.\n\n9) Summary of logical flow\n- Build candidate_oids as DISTINCT oid from feature where name = 'Multiband_period' AND version = 'lc_classifier_1.2.1-P' AND value < 5 ORDER BY oid LIMIT 100.\n- Join probability p to candidate_oids on oid.\n- Filter p to classifier_name = 'lc_classifier' and ranking IN (1, 2).\n- Return p.* (all columns from probability)."
                },
                "in_toks": 4736,
                "out_toks": 3042,
                "id": "chatcmpl-CZZrxUr3MpoJ4J4k6RPP6Lx2w6V2j",
                "created": 1762595397,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all probability rows (all columns) for up to 100 objects whose Multiband_period < 5\n-- using feature.version = 'lc_classifier_1.2.1-P', restricted to the light curve classifier\n-- and rankings 1 or 2.\nWITH candidate_oids AS (\n    SELECT DISTINCT f.oid\n    FROM feature f\n    WHERE f.name = 'Multiband_period'\n      AND f.version = 'lc_classifier_1.2.1-P'\n      AND f.value < 5\n    ORDER BY f.oid\n    LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN candidate_oids c ON c.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nORDER BY p.oid ASC, p.classifier_version ASC, p.ranking ASC, p.probability DESC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all probability rows (all columns) for up to 100 objects whose Multiband_period < 5\n-- using feature.version = 'lc_classifier_1.2.1-P', restricted to the light curve classifier\n-- and rankings 1 or 2.\nWITH candidate_oids AS (\n    SELECT DISTINCT f.oid\n    FROM feature f\n    WHERE f.name = 'Multiband_period'\n      AND f.version = 'lc_classifier_1.2.1-P'\n      AND f.value < 5\n    ORDER BY f.oid\n    LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN candidate_oids c ON c.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nORDER BY p.oid ASC, p.classifier_version ASC, p.ranking ASC, p.probability DESC;\n```"
                },
                "in_toks": 3041,
                "out_toks": 1611,
                "id": "chatcmpl-CZayUyAsHlo9GXPxu4rmovRXLcrGg",
                "created": 1762599646,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "90",
            "experiment_id": "run_7",
            "pred_tables": [
                "probability",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'feature', 'feature_version']"
                },
                "in_toks": 650,
                "out_toks": 1172,
                "id": "chatcmpl-CZNIeWZ8IHOk5tnaHO10fJby12zPq",
                "created": 1762547080,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 3128,
                "out_toks": 911,
                "id": "chatcmpl-CZYjTf1VQfa3N5zDy5W3j6J8kIzOJ",
                "created": 1762591027,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Parse the user requirements into precise constraints\n- Retrieve up to 100 distinct objects that satisfy a feature-based condition: Multiband_period < 5 days.\n- Use the features computed in the feature version exactly 'lc_classifier_1.2.1-P'.\n- Return all columns from the probability table (i.e., the full set of probability rows) for those objects.\n- Only include probability rows where classifier_name = 'lc_classifier'.\n- Include probability rows whose ranking is either 1 or 2 (override the default \u201cranking = 1\u201d because the user explicitly asked for 1 or 2).\n- Do not add any spatial constraints (no Q3C use is needed) and no additional classifier_version constraint (none was requested).\n- Ensure the \u201cat most 100 objects\u201d condition is applied on object identifiers (oids), not on probability rows.\n\n2) Identify the relevant tables and columns\n- Table: feature\n  - Columns to use:\n    - feature.oid (object identifier to link with probability)\n    - feature.name (must be 'Multiband_period')\n    - feature.value (numerical period; must be < 5)\n    - feature.version (must be 'lc_classifier_1.2.1-P')\n    - feature.fid (multiband; use fid = 123 for gri multiband features)\n- Table: probability\n  - Columns to use:\n    - probability.oid (join key to feature.oid)\n    - probability.classifier_name (must be 'lc_classifier')\n    - probability.ranking (must be IN (1, 2))\n    - All other columns from probability must be returned (select p.*)\n\n3) Define the base object subset via a subquery on feature\n- Filter rows in feature with:\n  - feature.name = 'Multiband_period'\n  - feature.version = 'lc_classifier_1.2.1-P'\n  - feature.value < 5\n  - feature.fid = 123 (multiband gri; if your deployment encodes multiband differently, adjust accordingly)\n- From the filtered feature rows, select DISTINCT feature.oid to avoid duplicate objects.\n- LIMIT the list of distinct oids to at most 100 to meet the \u201cat most 100 objects\u201d requirement.\n- This subquery should only return the list of candidate oids; no need to return feature columns beyond oid at this stage.\n\n4) Join the candidate oids to probability and filter probability rows\n- INNER JOIN probability on probability.oid = candidate_oids.oid to retrieve probability rows for the selected objects.\n- Apply the required probability filters:\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking IN (1, 2)\n- Do not filter probability.classifier_version (the user did not specify a constraint).\n\n5) Select and shape the final output\n- Select all columns from the probability table for the joined rows (i.e., SELECT p.*).\n- The result will include up to two probability rows per classifier version per object (rankings 1 and 2), depending on what exists in the data.\n- If a stable display order is desired (optional), order by probability.oid and probability.ranking; otherwise, omit ORDER BY.\n\n6) Enforce the \u201cat most 100 objects\u201d constraint correctly\n- Ensure the LIMIT 100 is applied in the feature-based subquery that selects DISTINCT oids, before joining to probability. This guarantees you are limiting by unique objects rather than by probability rows.\n\n7) Performance and correctness considerations\n- The feature table is filtered by multiple columns (name, version, fid, value). There is no explicit index on these, so constraining the candidate set first and limiting to 100 oids minimizes work in the subsequent join.\n- The join uses probability.oid; there is an index on probability.oid (ix_probabilities_oid), which will help.\n- If you need the 100 shortest periods specifically, add an ORDER BY feature.value ASC in the subquery before applying LIMIT 100. The user only asked for \u201cat most 100 \u2026 lower than 5 days,\u201d not necessarily the shortest, so ordering is optional.\n\n8) Edge cases and adjustments (optional)\n- If your deployment stores multiband features with a different fid than 123, adjust or omit the fid filter accordingly. If uncertain, you can omit fid to rely solely on name='Multiband_period' and version='lc_classifier_1.2.1-P'.\n- If you want to restrict to a specific probability.classifier_version, add that filter; the user did not request this, so leave it unconstrained.\n\nThis plan yields a query that:\n- Identifies up to 100 distinct objects with Multiband_period < 5 in feature version 'lc_classifier_1.2.1-P'.\n- Returns all columns from probability for those objects, restricted to classifier_name = 'lc_classifier' and ranking IN (1, 2).",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Parse the user requirements into precise constraints\n- Retrieve up to 100 distinct objects that satisfy a feature-based condition: Multiband_period < 5 days.\n- Use the features computed in the feature version exactly 'lc_classifier_1.2.1-P'.\n- Return all columns from the probability table (i.e., the full set of probability rows) for those objects.\n- Only include probability rows where classifier_name = 'lc_classifier'.\n- Include probability rows whose ranking is either 1 or 2 (override the default \u201cranking = 1\u201d because the user explicitly asked for 1 or 2).\n- Do not add any spatial constraints (no Q3C use is needed) and no additional classifier_version constraint (none was requested).\n- Ensure the \u201cat most 100 objects\u201d condition is applied on object identifiers (oids), not on probability rows.\n\n2) Identify the relevant tables and columns\n- Table: feature\n  - Columns to use:\n    - feature.oid (object identifier to link with probability)\n    - feature.name (must be 'Multiband_period')\n    - feature.value (numerical period; must be < 5)\n    - feature.version (must be 'lc_classifier_1.2.1-P')\n    - feature.fid (multiband; use fid = 123 for gri multiband features)\n- Table: probability\n  - Columns to use:\n    - probability.oid (join key to feature.oid)\n    - probability.classifier_name (must be 'lc_classifier')\n    - probability.ranking (must be IN (1, 2))\n    - All other columns from probability must be returned (select p.*)\n\n3) Define the base object subset via a subquery on feature\n- Filter rows in feature with:\n  - feature.name = 'Multiband_period'\n  - feature.version = 'lc_classifier_1.2.1-P'\n  - feature.value < 5\n  - feature.fid = 123 (multiband gri; if your deployment encodes multiband differently, adjust accordingly)\n- From the filtered feature rows, select DISTINCT feature.oid to avoid duplicate objects.\n- LIMIT the list of distinct oids to at most 100 to meet the \u201cat most 100 objects\u201d requirement.\n- This subquery should only return the list of candidate oids; no need to return feature columns beyond oid at this stage.\n\n4) Join the candidate oids to probability and filter probability rows\n- INNER JOIN probability on probability.oid = candidate_oids.oid to retrieve probability rows for the selected objects.\n- Apply the required probability filters:\n  - probability.classifier_name = 'lc_classifier'\n  - probability.ranking IN (1, 2)\n- Do not filter probability.classifier_version (the user did not specify a constraint).\n\n5) Select and shape the final output\n- Select all columns from the probability table for the joined rows (i.e., SELECT p.*).\n- The result will include up to two probability rows per classifier version per object (rankings 1 and 2), depending on what exists in the data.\n- If a stable display order is desired (optional), order by probability.oid and probability.ranking; otherwise, omit ORDER BY.\n\n6) Enforce the \u201cat most 100 objects\u201d constraint correctly\n- Ensure the LIMIT 100 is applied in the feature-based subquery that selects DISTINCT oids, before joining to probability. This guarantees you are limiting by unique objects rather than by probability rows.\n\n7) Performance and correctness considerations\n- The feature table is filtered by multiple columns (name, version, fid, value). There is no explicit index on these, so constraining the candidate set first and limiting to 100 oids minimizes work in the subsequent join.\n- The join uses probability.oid; there is an index on probability.oid (ix_probabilities_oid), which will help.\n- If you need the 100 shortest periods specifically, add an ORDER BY feature.value ASC in the subquery before applying LIMIT 100. The user only asked for \u201cat most 100 \u2026 lower than 5 days,\u201d not necessarily the shortest, so ordering is optional.\n\n8) Edge cases and adjustments (optional)\n- If your deployment stores multiband features with a different fid than 123, adjust or omit the fid filter accordingly. If uncertain, you can omit fid to rely solely on name='Multiband_period' and version='lc_classifier_1.2.1-P'.\n- If you want to restrict to a specific probability.classifier_version, add that filter; the user did not request this, so leave it unconstrained.\n\nThis plan yields a query that:\n- Identifies up to 100 distinct objects with Multiband_period < 5 in feature version 'lc_classifier_1.2.1-P'.\n- Returns all columns from probability for those objects, restricted to classifier_name = 'lc_classifier' and ranking IN (1, 2)."
                },
                "in_toks": 4736,
                "out_toks": 3470,
                "id": "chatcmpl-CZZeCYNyA9R2FsFFvoQET1uhRi2LE",
                "created": 1762594544,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 100 objects with Multiband_period < 5 in feature version 'lc_classifier_1.2.1-P'\n-- Then return all probability rows for the light curve classifier with rankings 1 or 2\nWITH candidate_oids AS (\n    SELECT DISTINCT f.oid\n    FROM feature f\n    WHERE f.name = 'Multiband_period'\n      AND f.version = 'lc_classifier_1.2.1-P'\n      AND f.value < 5\n    LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN candidate_oids c ON p.oid = c.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nORDER BY p.oid, p.ranking, p.classifier_version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 100 objects with Multiband_period < 5 in feature version 'lc_classifier_1.2.1-P'\n-- Then return all probability rows for the light curve classifier with rankings 1 or 2\nWITH candidate_oids AS (\n    SELECT DISTINCT f.oid\n    FROM feature f\n    WHERE f.name = 'Multiband_period'\n      AND f.version = 'lc_classifier_1.2.1-P'\n      AND f.value < 5\n    LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN candidate_oids c ON p.oid = c.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nORDER BY p.oid, p.ranking, p.classifier_version;\n```"
                },
                "in_toks": 3085,
                "out_toks": 1907,
                "id": "chatcmpl-CZaxUJiZy7To9P9YucQQNNtzKon4r",
                "created": 1762599584,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "90",
            "experiment_id": "run_8",
            "pred_tables": [
                "feature",
                "feature_version",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['feature', 'feature_version', 'probability']"
                },
                "in_toks": 650,
                "out_toks": 724,
                "id": "chatcmpl-CZNJ2jkvEBoHPIOewDZVjBeSwgmZU",
                "created": 1762547104,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Select up to 100 objects with Multiband_period < 5 days from feature version 'lc_classifier_1.2.1-P'\n-- Assumes multiband period is stored with fid = 123 (gri)\nWITH selected_oids AS\n  (SELECT f.oid\n   FROM feature f\n   WHERE f.name = 'Multiband_period'\n     AND f.version = 'lc_classifier_1.2.1-P'\n     AND f.fid = 123\n     AND f.value < 5\n   ORDER BY f.value ASC\n   LIMIT 100) -- Return all probability columns for the light curve classifier with rankings 1 or 2\n\nSELECT p.*\nFROM probability p\nJOIN selected_oids s ON p.oid = s.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1,\n                    2)\nORDER BY p.oid,\n         p.ranking;",
            "sql_response": {
                "responses": {
                    "0": "-- Select up to 100 objects with Multiband_period < 5 days from feature version 'lc_classifier_1.2.1-P'\n-- Assumes multiband period is stored with fid = 123 (gri)\nWITH selected_oids AS\n  (SELECT f.oid\n   FROM feature f\n   WHERE f.name = 'Multiband_period'\n     AND f.version = 'lc_classifier_1.2.1-P'\n     AND f.fid = 123\n     AND f.value < 5\n   ORDER BY f.value ASC\n   LIMIT 100) -- Return all probability columns for the light curve classifier with rankings 1 or 2\n\nSELECT p.*\nFROM probability p\nJOIN selected_oids s ON p.oid = s.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1,\n                    2)\nORDER BY p.oid,\n         p.ranking;"
                },
                "in_toks": 3593,
                "out_toks": 1674,
                "id": "chatcmpl-CbHVE7kW0NKwY6LfToCiSBx7qGuTZ",
                "created": 1763001452,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 3128,
                "out_toks": 591,
                "id": "chatcmpl-CZYjkqnixnXOU4B3S9NvKoRKmA55t",
                "created": 1762591044,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve at most 100 objects whose multiband period is < 5 days using features computed in version 'lc_classifier_1.2.1-P'.\n- Return all columns from the probability table for those objects.\n- Only include probabilities from the light curve classifier (classifier_name = 'lc_classifier') with ranking equal to 1 or 2.\n\nTables, columns, and keys to use\n- feature:\n  - Columns: oid, name, value, fid, version.\n  - Use to filter objects by the multiband period threshold and feature version.\n  - Use fid that corresponds to multiband features; for Multiband_period this is typically fid = 123 (gri).\n- probability:\n  - Columns: oid, class_name, classifier_name, classifier_version, probability, ranking.\n  - Use to retrieve probabilities for the selected objects.\n  - Filter by classifier_name = 'lc_classifier' and ranking IN (1, 2).\n- Join key: oid (present in both feature and probability).\n\nDefault-condition adjustments\n- Override the default ranking filter (ranking = 1) because the user explicitly requests rankings 1 or 2.\n- Keep the default classifier filter classifier_name = 'lc_classifier' (the user explicitly requests the light curve classifier).\n\nStep-by-step plan\n\n1) Identify candidate objects in feature\n- Source table: feature (alias f).\n- Filtering conditions:\n  - f.name = 'Multiband_period'\n  - f.version = 'lc_classifier_1.2.1-P'\n  - f.fid = 123 (multiband gri; adjust only if your deployment stores Multiband_period under a different fid)\n  - f.value < 5\n- Columns to output from this step: distinct f.oid (distinct is used as a safety measure to ensure the count limit applies to unique objects).\n- Optional ordering (not required by the user, but provides determinism): ORDER BY f.value ASC to prefer the shortest periods.\n- Limit: restrict to at most 100 unique oids at this stage to enforce \u201cat most 100 ZTF objects.\u201d This ensures the limit applies at the object level rather than at the probability-row level.\n\n2) Prepare a subquery/CTE for the selected oids\n- Implement the above filtering and limit in a subquery or CTE, e.g., selected_oids(oid).\n- Ensure it returns only the list of unique oids meeting the feature constraints, capped at 100.\n\n3) Join to probability and filter the classifier/ranking\n- Join type: INNER JOIN probability p ON p.oid = selected_oids.oid to retain only probabilities for the selected objects.\n- Filters on probability:\n  - p.classifier_name = 'lc_classifier'\n  - p.ranking IN (1, 2)\n\n4) Select columns to return\n- Return all columns from the probability table: p.oid, p.class_name, p.classifier_name, p.classifier_version, p.probability, p.ranking.\n- Do not return columns from feature; it is only used for filtering.\n\n5) Result cardinality and ordering\n- Because each selected object can have up to 2 probability rows (ranking 1 and 2), the total number of output rows can be up to 2 \u00d7 number_of_oids (\u2264 200).\n- The user did not specify an ordering for the final result; you may optionally add an ORDER BY for readability (e.g., ORDER BY p.oid, p.ranking) but it is not required.\n\n6) Performance considerations\n- Filtering in the feature subquery first and limiting to 100 oids reduces the amount of data joined against probability.\n- Existing indexes:\n  - feature: ix_feature_oid_2 (hash on oid) will help the join back from probability to candidate oids if needed.\n  - probability: ix_probabilities_oid (hash), ix_probabilities_ranking (btree), ix_probabilities_probability (btree) can help with join and ranking filter.\n- There is no index on feature.name/version/fid/value; the filter will scan those columns. Keeping the selection tight (value < 5 and a single version/fid) helps.\n\n7) Notes and assumptions\n- \u201cZTF objects\u201d: ALeRCE primarily indexes ZTF alerts. If your installation contains multiple surveys and you must restrict to ZTF explicitly, add the appropriate filter via the object table (not provided here) using an INNER JOIN on object.oid with the survey/source field. Otherwise, no additional filter is needed.\n- Multiband_period fid: Typically stored under fid = 123 (gri). If your deployment records it under another fid, adapt the fid filter accordingly (e.g., 12, 13, 23, or 123). The safest single choice for a strictly multiband period is fid = 123.\n\nSummary of the logical structure\n- WITH selected_oids AS (\n  - SELECT DISTINCT f.oid FROM feature f\n  - WHERE f.name = 'Multiband_period'\n    AND f.version = 'lc_classifier_1.2.1-P'\n    AND f.fid = 123\n    AND f.value < 5\n  - [OPTIONAL] ORDER BY f.value ASC\n  - LIMIT 100\n)\n- SELECT all columns from probability p\n- FROM probability p\n- INNER JOIN selected_oids s ON p.oid = s.oid\n- WHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve at most 100 objects whose multiband period is < 5 days using features computed in version 'lc_classifier_1.2.1-P'.\n- Return all columns from the probability table for those objects.\n- Only include probabilities from the light curve classifier (classifier_name = 'lc_classifier') with ranking equal to 1 or 2.\n\nTables, columns, and keys to use\n- feature:\n  - Columns: oid, name, value, fid, version.\n  - Use to filter objects by the multiband period threshold and feature version.\n  - Use fid that corresponds to multiband features; for Multiband_period this is typically fid = 123 (gri).\n- probability:\n  - Columns: oid, class_name, classifier_name, classifier_version, probability, ranking.\n  - Use to retrieve probabilities for the selected objects.\n  - Filter by classifier_name = 'lc_classifier' and ranking IN (1, 2).\n- Join key: oid (present in both feature and probability).\n\nDefault-condition adjustments\n- Override the default ranking filter (ranking = 1) because the user explicitly requests rankings 1 or 2.\n- Keep the default classifier filter classifier_name = 'lc_classifier' (the user explicitly requests the light curve classifier).\n\nStep-by-step plan\n\n1) Identify candidate objects in feature\n- Source table: feature (alias f).\n- Filtering conditions:\n  - f.name = 'Multiband_period'\n  - f.version = 'lc_classifier_1.2.1-P'\n  - f.fid = 123 (multiband gri; adjust only if your deployment stores Multiband_period under a different fid)\n  - f.value < 5\n- Columns to output from this step: distinct f.oid (distinct is used as a safety measure to ensure the count limit applies to unique objects).\n- Optional ordering (not required by the user, but provides determinism): ORDER BY f.value ASC to prefer the shortest periods.\n- Limit: restrict to at most 100 unique oids at this stage to enforce \u201cat most 100 ZTF objects.\u201d This ensures the limit applies at the object level rather than at the probability-row level.\n\n2) Prepare a subquery/CTE for the selected oids\n- Implement the above filtering and limit in a subquery or CTE, e.g., selected_oids(oid).\n- Ensure it returns only the list of unique oids meeting the feature constraints, capped at 100.\n\n3) Join to probability and filter the classifier/ranking\n- Join type: INNER JOIN probability p ON p.oid = selected_oids.oid to retain only probabilities for the selected objects.\n- Filters on probability:\n  - p.classifier_name = 'lc_classifier'\n  - p.ranking IN (1, 2)\n\n4) Select columns to return\n- Return all columns from the probability table: p.oid, p.class_name, p.classifier_name, p.classifier_version, p.probability, p.ranking.\n- Do not return columns from feature; it is only used for filtering.\n\n5) Result cardinality and ordering\n- Because each selected object can have up to 2 probability rows (ranking 1 and 2), the total number of output rows can be up to 2 \u00d7 number_of_oids (\u2264 200).\n- The user did not specify an ordering for the final result; you may optionally add an ORDER BY for readability (e.g., ORDER BY p.oid, p.ranking) but it is not required.\n\n6) Performance considerations\n- Filtering in the feature subquery first and limiting to 100 oids reduces the amount of data joined against probability.\n- Existing indexes:\n  - feature: ix_feature_oid_2 (hash on oid) will help the join back from probability to candidate oids if needed.\n  - probability: ix_probabilities_oid (hash), ix_probabilities_ranking (btree), ix_probabilities_probability (btree) can help with join and ranking filter.\n- There is no index on feature.name/version/fid/value; the filter will scan those columns. Keeping the selection tight (value < 5 and a single version/fid) helps.\n\n7) Notes and assumptions\n- \u201cZTF objects\u201d: ALeRCE primarily indexes ZTF alerts. If your installation contains multiple surveys and you must restrict to ZTF explicitly, add the appropriate filter via the object table (not provided here) using an INNER JOIN on object.oid with the survey/source field. Otherwise, no additional filter is needed.\n- Multiband_period fid: Typically stored under fid = 123 (gri). If your deployment records it under another fid, adapt the fid filter accordingly (e.g., 12, 13, 23, or 123). The safest single choice for a strictly multiband period is fid = 123.\n\nSummary of the logical structure\n- WITH selected_oids AS (\n  - SELECT DISTINCT f.oid FROM feature f\n  - WHERE f.name = 'Multiband_period'\n    AND f.version = 'lc_classifier_1.2.1-P'\n    AND f.fid = 123\n    AND f.value < 5\n  - [OPTIONAL] ORDER BY f.value ASC\n  - LIMIT 100\n)\n- SELECT all columns from probability p\n- FROM probability p\n- INNER JOIN selected_oids s ON p.oid = s.oid\n- WHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)"
                },
                "in_toks": 4736,
                "out_toks": 3465,
                "id": "chatcmpl-CZZt1sTCAFz1vb2DF5m1YZ4GYUgWj",
                "created": 1762595463,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 100 objects with Multiband_period < 5 days from feature version 'lc_classifier_1.2.1-P'\n-- Assumes multiband period is stored with fid = 123 (gri)\n-- Return all probability columns for the light curve classifier with rankings 1 or 2\nWITH selected_oids AS (\n    SELECT DISTINCT f.oid\n    FROM feature f\n    WHERE f.name = 'Multiband_period'\n      AND f.version = 'lc_classifier_1.2.1-P'\n      AND f.fid = 123\n      AND f.value < 5\n    ORDER BY f.value ASC\n    LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN selected_oids s ON p.oid = s.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nORDER BY p.oid, p.ranking;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 100 objects with Multiband_period < 5 days from feature version 'lc_classifier_1.2.1-P'\n-- Assumes multiband period is stored with fid = 123 (gri)\n-- Return all probability columns for the light curve classifier with rankings 1 or 2\nWITH selected_oids AS (\n    SELECT DISTINCT f.oid\n    FROM feature f\n    WHERE f.name = 'Multiband_period'\n      AND f.version = 'lc_classifier_1.2.1-P'\n      AND f.fid = 123\n      AND f.value < 5\n    ORDER BY f.value ASC\n    LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN selected_oids s ON p.oid = s.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2)\nORDER BY p.oid, p.ranking;\n```"
                },
                "in_toks": 3208,
                "out_toks": 1936,
                "id": "chatcmpl-CZayb1bhNmr8cISOFvnwkBLO44vdf",
                "created": 1762599653,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "9": {
            "req_id": "90",
            "experiment_id": "run_9",
            "pred_tables": [
                "probability",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['probability', 'feature', 'feature_version']"
                },
                "in_toks": 650,
                "out_toks": 1108,
                "id": "chatcmpl-CZNJRpqE43UteAxvyKPURBfv8wtfX",
                "created": 1762547129,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query: avoid DISTINCT (PK guarantees one row per oid for given name/fid/version),\n-- limit early to 100 oids, then join to probability with the requested filters.\nWITH selected_oids AS\n  (SELECT f.oid\n   FROM feature f\n   WHERE f.name = 'Multiband_period'\n     AND f.version = 'lc_classifier_1.2.1-P'\n     AND f.fid = 123\n     AND f.value < 5\n   LIMIT 100)\nSELECT p.*\nFROM probability p\nJOIN selected_oids s ON p.oid = s.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1,\n                    2)\n  AND p.classifier_version IS NOT NULL;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query: avoid DISTINCT (PK guarantees one row per oid for given name/fid/version),\n-- limit early to 100 oids, then join to probability with the requested filters.\nWITH selected_oids AS\n  (SELECT f.oid\n   FROM feature f\n   WHERE f.name = 'Multiband_period'\n     AND f.version = 'lc_classifier_1.2.1-P'\n     AND f.fid = 123\n     AND f.value < 5\n   LIMIT 100)\nSELECT p.*\nFROM probability p\nJOIN selected_oids s ON p.oid = s.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1,\n                    2)\n  AND p.classifier_version IS NOT NULL;"
                },
                "in_toks": 3588,
                "out_toks": 2856,
                "id": "chatcmpl-CbHVZgBQ8djxkFv6Pkkc8OgSXdr9v",
                "created": 1763001473,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 3128,
                "out_toks": 719,
                "id": "chatcmpl-CZYk0W7ESRP2xoGr2elijCwAjInD6",
                "created": 1762591060,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\nGoal\n- Retrieve up to 100 distinct ZTF objects (oid) that have a Multiband_period < 5 days measured in the feature processing version 'lc_classifier_1.2.1-P'.\n- For those objects, return all columns from the probability table, but only rows from the light curve classifier (classifier_name = 'lc_classifier') and only where ranking is 1 or 2.\n\nImportant defaults and adjustments\n- Default probability conditions require classifier_name = 'lc_classifier' and ranking = 1; the user explicitly asks for rankings 1 or 2, so adjust to ranking IN (1, 2).\n- Use exact names as in the schema: feature.name = 'Multiband_period', feature.version = 'lc_classifier_1.2.1-P'.\n- For the multiband period, use fid = 123 (gri) to target the multiband feature and avoid duplicates across bands.\n\nTables and columns involved\n- feature(oid, name, value, fid, version)\n- probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n\nStep-by-step plan\n\n1) Define the selection criteria for qualifying objects in the feature table\n- Table: feature\n- Filters:\n  - feature.name = 'Multiband_period'\n  - feature.version = 'lc_classifier_1.2.1-P'\n  - feature.fid = 123  // multiband (gri)\n  - feature.value < 5  // period strictly lower than 5 days\n- Output: distinct set of feature.oid that satisfy all four conditions.\n\n2) Restrict the number of qualifying objects to at most 100\n- From the filtered feature rows in Step 1, select DISTINCT oid and apply LIMIT 100 to ensure no more than 100 unique objects are selected.\n- Implement this as a subquery or a CTE (e.g., selected_oids) that yields at most 100 distinct oids.\n\n3) Retrieve probability rows for those objects, restricted to the light curve classifier and ranking 1 or 2\n- Table: probability (aliased as p)\n- Join: INNER JOIN probability p ON p.oid = selected_oids.oid\n- Filters on probability:\n  - p.classifier_name = 'lc_classifier'  // include only light curve classifier\n  - p.ranking IN (1, 2)                  // include top 2 ranked classes\n- Note: Do not constrain p.classifier_version unless the user requests it; include all versions available for the light curve classifier.\n\n4) Return all columns from the probability table\n- SELECT p.* so that all columns from the probability table are returned.\n- Do not include feature columns in the final projection since the user only requested probability columns.\n\n5) Ensure the \u201cat most 100 objects\u201d constraint applies to objects, not rows\n- The LIMIT 100 must be applied to the distinct set of oids in the feature-based subquery/CTE (Step 2) before joining to probability.\n- Do not apply LIMIT 100 to the final SELECT, as that would cap the number of probability rows rather than the number of objects and could yield fewer than 100 oids.\n\n6) Optional ordering (not required)\n- The user did not request a specific ordering. If desired, you may add an ORDER BY in the feature subquery (e.g., ORDER BY feature.value ASC) before LIMIT 100 to bias toward shorter periods, but this is not required.\n\n7) Performance considerations\n- The join will utilize:\n  - probability.oid hash index (ix_probabilities_oid)\n  - probability.ranking btree index for ranking IN (1, 2)\n- The feature table does not list indexes on (name, version, fid, value); expect a filter scan on feature. Constraining fid = 123 reduces duplicates and scan size.\n- Selecting DISTINCT oid in the feature subquery ensures deduplication of objects prior to the join.\n\n8) Sanity checks for correctness\n- Use exact string literals:\n  - feature.name = 'Multiband_period'\n  - feature.version = 'lc_classifier_1.2.1-P'\n  - p.classifier_name = 'lc_classifier'\n- Use numeric comparison: feature.value < 5\n- Ensure fid = 123 is applied to target the multiband feature and avoid band-specific duplicates.\n\n9) Final structure summary\n- WITH selected_oids AS (\n    SELECT DISTINCT feature.oid\n    FROM feature\n    WHERE\n      feature.name = 'Multiband_period' AND\n      feature.version = 'lc_classifier_1.2.1-P' AND\n      feature.fid = 123 AND\n      feature.value < 5\n    LIMIT 100\n  )\n- SELECT p.* FROM probability p\n  INNER JOIN selected_oids s ON p.oid = s.oid\n  WHERE p.classifier_name = 'lc_classifier'\n    AND p.ranking IN (1, 2)\n\nThis yields all probability rows (all columns) for up to 100 objects meeting the Multiband_period criterion, restricted to the light curve classifier and to rankings 1 or 2.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\nGoal\n- Retrieve up to 100 distinct ZTF objects (oid) that have a Multiband_period < 5 days measured in the feature processing version 'lc_classifier_1.2.1-P'.\n- For those objects, return all columns from the probability table, but only rows from the light curve classifier (classifier_name = 'lc_classifier') and only where ranking is 1 or 2.\n\nImportant defaults and adjustments\n- Default probability conditions require classifier_name = 'lc_classifier' and ranking = 1; the user explicitly asks for rankings 1 or 2, so adjust to ranking IN (1, 2).\n- Use exact names as in the schema: feature.name = 'Multiband_period', feature.version = 'lc_classifier_1.2.1-P'.\n- For the multiband period, use fid = 123 (gri) to target the multiband feature and avoid duplicates across bands.\n\nTables and columns involved\n- feature(oid, name, value, fid, version)\n- probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n\nStep-by-step plan\n\n1) Define the selection criteria for qualifying objects in the feature table\n- Table: feature\n- Filters:\n  - feature.name = 'Multiband_period'\n  - feature.version = 'lc_classifier_1.2.1-P'\n  - feature.fid = 123  // multiband (gri)\n  - feature.value < 5  // period strictly lower than 5 days\n- Output: distinct set of feature.oid that satisfy all four conditions.\n\n2) Restrict the number of qualifying objects to at most 100\n- From the filtered feature rows in Step 1, select DISTINCT oid and apply LIMIT 100 to ensure no more than 100 unique objects are selected.\n- Implement this as a subquery or a CTE (e.g., selected_oids) that yields at most 100 distinct oids.\n\n3) Retrieve probability rows for those objects, restricted to the light curve classifier and ranking 1 or 2\n- Table: probability (aliased as p)\n- Join: INNER JOIN probability p ON p.oid = selected_oids.oid\n- Filters on probability:\n  - p.classifier_name = 'lc_classifier'  // include only light curve classifier\n  - p.ranking IN (1, 2)                  // include top 2 ranked classes\n- Note: Do not constrain p.classifier_version unless the user requests it; include all versions available for the light curve classifier.\n\n4) Return all columns from the probability table\n- SELECT p.* so that all columns from the probability table are returned.\n- Do not include feature columns in the final projection since the user only requested probability columns.\n\n5) Ensure the \u201cat most 100 objects\u201d constraint applies to objects, not rows\n- The LIMIT 100 must be applied to the distinct set of oids in the feature-based subquery/CTE (Step 2) before joining to probability.\n- Do not apply LIMIT 100 to the final SELECT, as that would cap the number of probability rows rather than the number of objects and could yield fewer than 100 oids.\n\n6) Optional ordering (not required)\n- The user did not request a specific ordering. If desired, you may add an ORDER BY in the feature subquery (e.g., ORDER BY feature.value ASC) before LIMIT 100 to bias toward shorter periods, but this is not required.\n\n7) Performance considerations\n- The join will utilize:\n  - probability.oid hash index (ix_probabilities_oid)\n  - probability.ranking btree index for ranking IN (1, 2)\n- The feature table does not list indexes on (name, version, fid, value); expect a filter scan on feature. Constraining fid = 123 reduces duplicates and scan size.\n- Selecting DISTINCT oid in the feature subquery ensures deduplication of objects prior to the join.\n\n8) Sanity checks for correctness\n- Use exact string literals:\n  - feature.name = 'Multiband_period'\n  - feature.version = 'lc_classifier_1.2.1-P'\n  - p.classifier_name = 'lc_classifier'\n- Use numeric comparison: feature.value < 5\n- Ensure fid = 123 is applied to target the multiband feature and avoid band-specific duplicates.\n\n9) Final structure summary\n- WITH selected_oids AS (\n    SELECT DISTINCT feature.oid\n    FROM feature\n    WHERE\n      feature.name = 'Multiband_period' AND\n      feature.version = 'lc_classifier_1.2.1-P' AND\n      feature.fid = 123 AND\n      feature.value < 5\n    LIMIT 100\n  )\n- SELECT p.* FROM probability p\n  INNER JOIN selected_oids s ON p.oid = s.oid\n  WHERE p.classifier_name = 'lc_classifier'\n    AND p.ranking IN (1, 2)\n\nThis yields all probability rows (all columns) for up to 100 objects meeting the Multiband_period criterion, restricted to the light curve classifier and to rankings 1 or 2."
                },
                "in_toks": 4736,
                "out_toks": 3580,
                "id": "chatcmpl-CZZf11LbsLt1uqFWacHjbtecqhiIO",
                "created": 1762594595,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* Return all probability rows (all columns) for up to 100 objects\n   that have Multiband_period < 5 days in feature version 'lc_classifier_1.2.1-P',\n   using the multiband fid = 123. Only include light curve classifier results\n   with ranking 1 or 2. */\nWITH selected_oids AS (\n    SELECT DISTINCT f.oid\n    FROM feature f\n    WHERE f.name = 'Multiband_period'\n      AND f.version = 'lc_classifier_1.2.1-P'\n      AND f.fid = 123\n      AND f.value < 5\n    LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN selected_oids s ON p.oid = s.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2);\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* Return all probability rows (all columns) for up to 100 objects\n   that have Multiband_period < 5 days in feature version 'lc_classifier_1.2.1-P',\n   using the multiband fid = 123. Only include light curve classifier results\n   with ranking 1 or 2. */\nWITH selected_oids AS (\n    SELECT DISTINCT f.oid\n    FROM feature f\n    WHERE f.name = 'Multiband_period'\n      AND f.version = 'lc_classifier_1.2.1-P'\n      AND f.fid = 123\n      AND f.value < 5\n    LIMIT 100\n)\nSELECT p.*\nFROM probability p\nINNER JOIN selected_oids s ON p.oid = s.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.ranking IN (1, 2);\n```"
                },
                "in_toks": 3131,
                "out_toks": 1474,
                "id": "chatcmpl-CZaxnL1AkMIh3P1lQpKtqhDdtzOLQ",
                "created": 1762599603,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        }
    },
    "51": {
        "0": {
            "req_id": "51",
            "experiment_id": "run_0",
            "pred_tables": [
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['forced_photometry']",
                    "1": "['forced_photometry']"
                },
                "in_toks": 642,
                "out_toks": 478,
                "id": "chatcmpl-CSnbBqkFuuIgFPcKGPN6Y68zbi47a",
                "created": 1760979877,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1145,
                "out_toks": 271,
                "id": "chatcmpl-CSnrNpn6BXhOcl1aUNg1m6fRivFif",
                "created": 1760980881,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find all forced-photometry epochs for the given ZTF object,\n-- returning the requested columns sorted by observation date (MJD)\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find all forced-photometry epochs for the given ZTF object,\n-- returning the requested columns sorted by observation date (MJD)\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```"
                },
                "in_toks": 2463,
                "out_toks": 610,
                "id": "chatcmpl-CSqs3trpmkIajEVcRkSiNi24mwM9g",
                "created": 1760992455,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "51",
            "experiment_id": "run_1",
            "pred_tables": [
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['forced_photometry']",
                    "1": "['forced_photometry']"
                },
                "in_toks": 642,
                "out_toks": 478,
                "id": "chatcmpl-CSnbBqkFuuIgFPcKGPN6Y68zbi47a",
                "created": 1760979877,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1145,
                "out_toks": 271,
                "id": "chatcmpl-CSnrRTjCh21aNFaXMxf1Zg4IWwf27",
                "created": 1760980885,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Forced photometry epochs for ZTF object ZTF24aaiutyh, sorted by date (MJD)\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Forced photometry epochs for ZTF object ZTF24aaiutyh, sorted by date (MJD)\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```"
                },
                "in_toks": 2463,
                "out_toks": 990,
                "id": "chatcmpl-CSqsDAptw6TVtskDGmtE5Qv8HlsB2",
                "created": 1760992465,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "51",
            "experiment_id": "run_2",
            "pred_tables": [
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['forced_photometry']"
                },
                "in_toks": 642,
                "out_toks": 719,
                "id": "chatcmpl-CSsrxS99XNje7UVv3qXbQdcaFu9OR",
                "created": 1761000137,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1145,
                "out_toks": 335,
                "id": "chatcmpl-CSxcyNZK6Y9MzKqWL6OdznDYqt6V7",
                "created": 1761018428,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Forced photometry epochs for the specified ZTF object\n-- Note: 'mjd' is the observation date in Modified Julian Date\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Forced photometry epochs for the specified ZTF object\n-- Note: 'mjd' is the observation date in Modified Julian Date\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```"
                },
                "in_toks": 2463,
                "out_toks": 866,
                "id": "chatcmpl-CSxmmzceeRUJCR604cN4TaKjzqru5",
                "created": 1761019036,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "51",
            "experiment_id": "run_3",
            "pred_tables": [
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['forced_photometry']"
                },
                "in_toks": 642,
                "out_toks": 207,
                "id": "chatcmpl-CSss78qgVIC7oZdr37lo5ySbAHrYa",
                "created": 1761000147,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1145,
                "out_toks": 207,
                "id": "chatcmpl-CSxd2vO9CUmf18fOTCx3GRFmpyplr",
                "created": 1761018432,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Forced photometry epochs for the object 'ZTF24aaiutyh'\n-- Note: 'mjd' is the date column (Modified Julian Date)\nSELECT\n  oid,\n  mjd,\n  fid,\n  mag,\n  e_mag,\n  mag_corr,\n  e_mag_corr,\n  isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Forced photometry epochs for the object 'ZTF24aaiutyh'\n-- Note: 'mjd' is the date column (Modified Julian Date)\nSELECT\n  oid,\n  mjd,\n  fid,\n  mag,\n  e_mag,\n  mag_corr,\n  e_mag_corr,\n  isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```"
                },
                "in_toks": 2463,
                "out_toks": 1063,
                "id": "chatcmpl-CSxmzzTsy9Im9kHpHSizwKiQpS8pK",
                "created": 1761019049,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "51",
            "experiment_id": "run_4",
            "pred_tables": [
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['forced_photometry']"
                },
                "in_toks": 642,
                "out_toks": 207,
                "id": "chatcmpl-CSssBDRNJrOE8O0w838WIyVJRcXud",
                "created": 1761000151,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1145,
                "out_toks": 143,
                "id": "chatcmpl-CSxd50oihxvrwRfzVmc2XImnCvtXR",
                "created": 1761018435,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find all epochs in forced_photometry for the specified ZTF object,\n-- returning the requested columns and sorting by date (mjd).\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find all epochs in forced_photometry for the specified ZTF object,\n-- returning the requested columns and sorting by date (mjd).\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```"
                },
                "in_toks": 2463,
                "out_toks": 547,
                "id": "chatcmpl-CSxnDr4lZSOMLg7r5E6IoybwtgCGk",
                "created": 1761019063,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "51",
            "experiment_id": "run_5",
            "pred_tables": [
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['forced_photometry']"
                },
                "in_toks": 642,
                "out_toks": 463,
                "id": "chatcmpl-CZNJluzxfMZRTnMEHNluuaUx3C3Sl",
                "created": 1762547149,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1145,
                "out_toks": 207,
                "id": "chatcmpl-CZYkGVKlFhzJ52PpLAfJRHmYMSsjK",
                "created": 1762591076,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Forced photometry epochs for ZTF object 'ZTF24aaiutyh'\n-- Columns: object identifier (oid), date (mjd), filter identifier (fid),\n--          difference magnitude (mag) and its uncertainty (e_mag),\n--          corrected magnitude (mag_corr) and its uncertainty (e_mag_corr),\n--          isdiffpos flag\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Forced photometry epochs for ZTF object 'ZTF24aaiutyh'\n-- Columns: object identifier (oid), date (mjd), filter identifier (fid),\n--          difference magnitude (mag) and its uncertainty (e_mag),\n--          corrected magnitude (mag_corr) and its uncertainty (e_mag_corr),\n--          isdiffpos flag\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```"
                },
                "in_toks": 2463,
                "out_toks": 655,
                "id": "chatcmpl-CZaDUjBWHGKwMddQzO2PoEw7UDn4H",
                "created": 1762596732,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "51",
            "experiment_id": "run_6",
            "pred_tables": [
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['forced_photometry']"
                },
                "in_toks": 642,
                "out_toks": 463,
                "id": "chatcmpl-CZNJtmgUGlo0haVxzMZSh00qB7vUo",
                "created": 1762547157,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1145,
                "out_toks": 207,
                "id": "chatcmpl-CZYkOeVPpkx6kMNJBrbhuS7p9bR7v",
                "created": 1762591084,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All forced photometry epochs for the specified ZTF object, sorted by date (MJD)\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All forced photometry epochs for the specified ZTF object, sorted by date (MJD)\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```"
                },
                "in_toks": 2463,
                "out_toks": 858,
                "id": "chatcmpl-CZaDlHaXkEtaxqOfXwALpbkvS8J6H",
                "created": 1762596749,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "51",
            "experiment_id": "run_7",
            "pred_tables": [
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['forced_photometry']"
                },
                "in_toks": 642,
                "out_toks": 271,
                "id": "chatcmpl-CZNK4lofcSoCS2g5x1EYOczN8YPUY",
                "created": 1762547168,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1145,
                "out_toks": 207,
                "id": "chatcmpl-CZYkZjDvy05MxVp3ecOl9GKcNF3jq",
                "created": 1762591095,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All forced photometry epochs for the specified ZTF object,\n-- returning the requested columns and sorted by date (MJD ascending).\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All forced photometry epochs for the specified ZTF object,\n-- returning the requested columns and sorted by date (MJD ascending).\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```"
                },
                "in_toks": 2463,
                "out_toks": 801,
                "id": "chatcmpl-CZa3n8via7GSDMQpocb5mq1tXvv5a",
                "created": 1762596131,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "51",
            "experiment_id": "run_8",
            "pred_tables": [
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['forced_photometry']"
                },
                "in_toks": 642,
                "out_toks": 335,
                "id": "chatcmpl-CZNK9ieZohYzimf5IJ9XIdgmptli4",
                "created": 1762547173,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1145,
                "out_toks": 335,
                "id": "chatcmpl-CZYkdlUXJzZ72fvyzd9lOyj7IcQ4B",
                "created": 1762591099,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Epochs of forced photometry for the specified ZTF object\nSELECT\n    oid,          -- object identifier\n    mjd,          -- date (Modified Julian Date)\n    fid,          -- filter identifier (1=g; 2=r; 3=i)\n    mag,          -- difference magnitude\n    e_mag,        -- uncertainty of difference magnitude\n    mag_corr,     -- corrected magnitude\n    e_mag_corr,   -- uncertainty of corrected magnitude (point-like)\n    isdiffpos     -- positive/negative difference flag\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Epochs of forced photometry for the specified ZTF object\nSELECT\n    oid,          -- object identifier\n    mjd,          -- date (Modified Julian Date)\n    fid,          -- filter identifier (1=g; 2=r; 3=i)\n    mag,          -- difference magnitude\n    e_mag,        -- uncertainty of difference magnitude\n    mag_corr,     -- corrected magnitude\n    e_mag_corr,   -- uncertainty of corrected magnitude (point-like)\n    isdiffpos     -- positive/negative difference flag\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```"
                },
                "in_toks": 2463,
                "out_toks": 723,
                "id": "chatcmpl-CZa7YBQhUr5dCxthDE6ceep3fvxcV",
                "created": 1762596364,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "51",
            "experiment_id": "run_9",
            "pred_tables": [
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['forced_photometry']"
                },
                "in_toks": 642,
                "out_toks": 271,
                "id": "chatcmpl-CZNKF7TcGSQw62snrqfTcqL7PO3GE",
                "created": 1762547179,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1145,
                "out_toks": 207,
                "id": "chatcmpl-CZYkj5nuV9VVL5dc57bRLpeBNQJvX",
                "created": 1762591105,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All forced photometry epochs for object 'ZTF24aaiutyh'\n-- Note: \"date\" corresponds to the 'mjd' column (Modified Julian Date)\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All forced photometry epochs for object 'ZTF24aaiutyh'\n-- Note: \"date\" corresponds to the 'mjd' column (Modified Julian Date)\nSELECT\n    oid,\n    mjd,\n    fid,\n    mag,\n    e_mag,\n    mag_corr,\n    e_mag_corr,\n    isdiffpos\nFROM forced_photometry\nWHERE oid = 'ZTF24aaiutyh'\nORDER BY mjd ASC;\n```"
                },
                "in_toks": 2463,
                "out_toks": 1002,
                "id": "chatcmpl-CZZqAAWsWz8rQaObdNbBTAsemansM",
                "created": 1762595286,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "59": {
        "0": {
            "req_id": "59",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'magstat']",
                    "1": "['magstat']"
                },
                "in_toks": 625,
                "out_toks": 1629,
                "id": "chatcmpl-CSnbIL4nI2tWgxMhfPO2JRkFNR1O6",
                "created": 1760979884,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1635,
                "out_toks": 143,
                "id": "chatcmpl-CSnrWS5IwMGZfjzE7iMArWNxccuId",
                "created": 1760980890,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Retrieve ZTF identifier, filter identifier, number of detections, and mean difference magnitude\n-- for the specified object from the magstat table\nSELECT\n    oid,\n    fid,\n    ndet,\n    magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Retrieve ZTF identifier, filter identifier, number of detections, and mean difference magnitude\n-- for the specified object from the magstat table\nSELECT\n    oid,\n    fid,\n    ndet,\n    magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```"
                },
                "in_toks": 2953,
                "out_toks": 395,
                "id": "chatcmpl-CSqs3TaCCQkqFa7e1UwlThn14WrBE",
                "created": 1760992455,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "59",
            "experiment_id": "run_1",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'magstat']",
                    "1": "['magstat']"
                },
                "in_toks": 625,
                "out_toks": 1629,
                "id": "chatcmpl-CSnbIL4nI2tWgxMhfPO2JRkFNR1O6",
                "created": 1760979884,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1153,
                "out_toks": 143,
                "id": "chatcmpl-CSnrZ4BKUZtReNgbfSlIP7upBfRIz",
                "created": 1760980893,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return ZTF identifier (oid), filter identifier (fid), number of detections (ndet),\n-- and mean difference magnitude (magmean) for the specified ZTF object\nSELECT\n  oid,\n  fid,\n  ndet,\n  magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return ZTF identifier (oid), filter identifier (fid), number of detections (ndet),\n-- and mean difference magnitude (magmean) for the specified ZTF object\nSELECT\n  oid,\n  fid,\n  ndet,\n  magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```"
                },
                "in_toks": 2471,
                "out_toks": 466,
                "id": "chatcmpl-CSqsSH8BtuMJnUcwOLkBB5WggXRGW",
                "created": 1760992480,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "59",
            "experiment_id": "run_2",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat']"
                },
                "in_toks": 625,
                "out_toks": 269,
                "id": "chatcmpl-CSssESW0jTgjUV7wslUEK8Cmej5ry",
                "created": 1761000154,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1153,
                "out_toks": 79,
                "id": "chatcmpl-CSxd7rXiJCizFdx428FRZ9xQlNm5Y",
                "created": 1761018437,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return ZTF identifier (oid), filter identifier (fid), number of detections (ndet), and mean difference magnitude (magmean)\nSELECT\n  oid,\n  fid,\n  ndet,\n  magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return ZTF identifier (oid), filter identifier (fid), number of detections (ndet), and mean difference magnitude (magmean)\nSELECT\n  oid,\n  fid,\n  ndet,\n  magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```"
                },
                "in_toks": 2471,
                "out_toks": 458,
                "id": "chatcmpl-CSxnNbOiIqb1rVhHXgvyjo19GU2Td",
                "created": 1761019073,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "59",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'magstat']"
                },
                "in_toks": 625,
                "out_toks": 336,
                "id": "chatcmpl-CSssLgKIXbRNW5alKzRlQkLwAmmRK",
                "created": 1761000161,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1635,
                "out_toks": 207,
                "id": "chatcmpl-CSxdA591EA7L7MBribOHU3AzReHSC",
                "created": 1761018440,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return ZTF identifier, filter identifier, number of detections, and mean difference magnitude\n-- fid mapping: 1 = g, 2 = r, 3 = i\nSELECT\n    oid,\n    fid,\n    ndet,\n    magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return ZTF identifier, filter identifier, number of detections, and mean difference magnitude\n-- fid mapping: 1 = g, 2 = r, 3 = i\nSELECT\n    oid,\n    fid,\n    ndet,\n    magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```"
                },
                "in_toks": 2953,
                "out_toks": 403,
                "id": "chatcmpl-CSxnaMuqMNYNEXdHxzrHhuD8s8Acr",
                "created": 1761019086,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "59",
            "experiment_id": "run_4",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat']"
                },
                "in_toks": 625,
                "out_toks": 205,
                "id": "chatcmpl-CSssSQRJDeJZrZKonozffVrV12shS",
                "created": 1761000168,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1153,
                "out_toks": 143,
                "id": "chatcmpl-CSxdD0jxeNkrivzyxRbSXzoIX1Ph2",
                "created": 1761018443,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return ZTF object identifier (oid), filter id (fid), number of detections (ndet), and mean difference magnitude (magmean)\nSELECT\n    oid,\n    fid,\n    ndet,\n    magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return ZTF object identifier (oid), filter id (fid), number of detections (ndet), and mean difference magnitude (magmean)\nSELECT\n    oid,\n    fid,\n    ndet,\n    magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```"
                },
                "in_toks": 2471,
                "out_toks": 459,
                "id": "chatcmpl-CSxhPKbGoocluK08d5TYlLJOL202K",
                "created": 1761018703,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "59",
            "experiment_id": "run_5",
            "pred_tables": [
                "magstat",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat', 'object']"
                },
                "in_toks": 625,
                "out_toks": 528,
                "id": "chatcmpl-CZNKLH06W2zvIbQxsIv7saoh0fuZu",
                "created": 1762547185,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1635,
                "out_toks": 79,
                "id": "chatcmpl-CZYl6YezgMuwdYBlzEh5iAKorFuam",
                "created": 1762591128,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return ZTF identifier, filter identifier, number of detections, and mean difference magnitude\n-- for the specified ZTF object from the magstat table\nSELECT\n  oid,\n  fid,\n  ndet,\n  magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return ZTF identifier, filter identifier, number of detections, and mean difference magnitude\n-- for the specified ZTF object from the magstat table\nSELECT\n  oid,\n  fid,\n  ndet,\n  magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```"
                },
                "in_toks": 2953,
                "out_toks": 269,
                "id": "chatcmpl-CZa9AwORRbfShKtDREk1Es7Izdtrx",
                "created": 1762596464,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "59",
            "experiment_id": "run_6",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat']"
                },
                "in_toks": 625,
                "out_toks": 653,
                "id": "chatcmpl-CZNKY6exwWC0vrOjpzfAj15HsEk3G",
                "created": 1762547198,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1153,
                "out_toks": 143,
                "id": "chatcmpl-CZYl9WEDtXCtonCaTVoJCILYgicSh",
                "created": 1762591131,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return the requested columns from magstat for the specified ZTF object\nSELECT\n    oid,       -- ZTF identifier\n    fid,       -- filter identifier (1=g; 2=r; 3=i)\n    ndet,      -- number of detections\n    magmean    -- mean difference magnitude\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return the requested columns from magstat for the specified ZTF object\nSELECT\n    oid,       -- ZTF identifier\n    fid,       -- filter identifier (1=g; 2=r; 3=i)\n    ndet,      -- number of detections\n    magmean    -- mean difference magnitude\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```"
                },
                "in_toks": 2471,
                "out_toks": 478,
                "id": "chatcmpl-CZZvinKNqm9TukOHs3DLwzne7g2GO",
                "created": 1762595630,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "59",
            "experiment_id": "run_7",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat']"
                },
                "in_toks": 625,
                "out_toks": 141,
                "id": "chatcmpl-CZNKlOwWjExBhlRfylw01ZiayjOsB",
                "created": 1762547211,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1153,
                "out_toks": 207,
                "id": "chatcmpl-CZYlFwdfX9HQDqZOEPM1H9cM2L6KI",
                "created": 1762591137,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Retrieve identifier, filter ID, number of detections, and mean difference magnitude\n-- for the specified ZTF object from the magstat table\nSELECT\n  oid,\n  fid,\n  ndet,\n  magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Retrieve identifier, filter ID, number of detections, and mean difference magnitude\n-- for the specified ZTF object from the magstat table\nSELECT\n  oid,\n  fid,\n  ndet,\n  magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```"
                },
                "in_toks": 2471,
                "out_toks": 395,
                "id": "chatcmpl-CZaDYN0dRt7WCjLD20k5VgJ9RZRgo",
                "created": 1762596736,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "59",
            "experiment_id": "run_8",
            "pred_tables": [
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat']"
                },
                "in_toks": 625,
                "out_toks": 205,
                "id": "chatcmpl-CZNKr3XlASwMisAzejnaBc54i1kX3",
                "created": 1762547217,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1153,
                "out_toks": 207,
                "id": "chatcmpl-CZYlMkJ60RTX0mSgkSPErdcTGV7jt",
                "created": 1762591144,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return ZTF identifier (oid), filter identifier (fid), number of detections (ndet),\n-- and mean difference magnitude (magmean) for the specified ZTF object\nSELECT\n    oid,\n    fid,\n    ndet,\n    magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return ZTF identifier (oid), filter identifier (fid), number of detections (ndet),\n-- and mean difference magnitude (magmean) for the specified ZTF object\nSELECT\n    oid,\n    fid,\n    ndet,\n    magmean\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```"
                },
                "in_toks": 2471,
                "out_toks": 402,
                "id": "chatcmpl-CZaJshOrFOZ25xX9O6WHWLazIlOlf",
                "created": 1762597128,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "59",
            "experiment_id": "run_9",
            "pred_tables": [
                "magstat",
                "object"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['magstat', 'object']"
                },
                "in_toks": 625,
                "out_toks": 528,
                "id": "chatcmpl-CZNKwJhrV12f4c6CozYWtSlUC4WJ5",
                "created": 1762547222,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1635,
                "out_toks": 79,
                "id": "chatcmpl-CZYlRVPh5c6iOZ1Lmw5deSY2Fu7hX",
                "created": 1762591149,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Retrieve requested columns for the specified ZTF object from magstat\nSELECT\n    oid,          -- ZTF identifier\n    fid,          -- filter identifier (1=g; 2=r; 3=i)\n    ndet,         -- number of detections in the given band\n    magmean       -- mean difference magnitude for the given band\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Retrieve requested columns for the specified ZTF object from magstat\nSELECT\n    oid,          -- ZTF identifier\n    fid,          -- filter identifier (1=g; 2=r; 3=i)\n    ndet,         -- number of detections in the given band\n    magmean       -- mean difference magnitude for the given band\nFROM magstat\nWHERE oid = 'ZTF18acsvogv';\n```"
                },
                "in_toks": 2953,
                "out_toks": 293,
                "id": "chatcmpl-CZa5No3sPBlf5AFdfPsydGNj0Ylur",
                "created": 1762596229,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "100": {
        "0": {
            "req_id": "100",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "detection",
                "non_detection",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection', 'non_detection', 'forced_photometry']",
                    "1": "['object', 'detection', 'non_detection', 'forced_photometry']"
                },
                "in_toks": 682,
                "out_toks": 1332,
                "id": "chatcmpl-CSnbZDsVYVVJxe5lQBdaK7F2L9GZ4",
                "created": 1760979901,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2333,
                "out_toks": 463,
                "id": "chatcmpl-CSnrcfckmNxAZiUPZkMJEqLhMKeEj",
                "created": 1760980896,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\nGoal\nReturn a single result set with all epochs (detections, non-detections, and forced photometry) for the ZTF object ZTF24aamtvxb, with these columns:\n- oid (ZTF identifier)\n- mjd (epoch date)\n- fid (filter identifier)\n- isdiffpos (flag; NULL for non-detections)\n- det_mag (detection difference magnitude; detection.magpsf)\n- det_mag_err (detection magnitude uncertainty; detection.sigmapsf)\n- diffmaglim (5-sigma magnitude limit; table-specific)\n- forced_mag (forced difference magnitude; forced_photometry.mag)\n- forced_mag_err (forced magnitude uncertainty; forced_photometry.e_mag)\n- \"table\" (name of the source table for each row: 'detection', 'non_detection', or 'forced_photometry')\n\nKey schema elements to use\n- object(oid, \u2026)\n- detection(oid, mjd, fid, isdiffpos, magpsf, sigmapsf, diffmaglim, \u2026) with hash index on oid (ix_ndetection_oid)\n- non_detection(oid, fid, mjd, diffmaglim) with hash index on oid (ix_non_detection_oid)\n- forced_photometry(oid, mjd, fid, isdiffpos, mag, e_mag, diffmaglim, \u2026)\n\nNotes and constraints\n- We do not need the probability or feature tables for this request (so their default conditions do not apply).\n- MJD is the epoch date field requested.\n- The column name \"table\" is a reserved word; alias it as \"table\" with double quotes in the final SELECT.\n- Types must be consistent across UNION branches:\n  - isdiffpos: integer in detection and forced_photometry; use NULL::integer for non_detection.\n  - det_mag, det_mag_err, diffmaglim, forced_mag, forced_mag_err: double precision; use NULL::double precision where not applicable.\n- Return all rows (no deduplication), and include a literal text label indicating the source table.\n\nStep-by-step plan\n\n1) Define the target object once in a CTE and validate existence\n- Create a CTE that restricts to the single oid:\n  - FROM object o\n  - WHERE o.oid = 'ZTF24aamtvxb'\n- Select only o.oid in this CTE (call it target). This ensures we only process the intended object and provides a join anchor for all epoch subqueries.\n- Using object provides a clean INNER JOIN and avoids typos in the oid literal across branches.\n\n2) Build the detection epoch subquery (standardize columns)\n- INNER JOIN detection d to target t ON d.oid = t.oid. This leverages the hash index on detection.oid.\n- SELECT and alias columns to the unified schema:\n  - t.oid AS oid\n  - d.mjd AS mjd\n  - d.fid AS fid\n  - d.isdiffpos::integer AS isdiffpos\n  - d.magpsf::double precision AS det_mag\n  - d.sigmapsf::double precision AS det_mag_err\n  - d.diffmaglim::double precision AS diffmaglim\n  - NULL::double precision AS forced_mag\n  - NULL::double precision AS forced_mag_err\n  - 'detection'::text AS \"table\"\n- Do not filter on dubious/real-bogus unless explicitly requested; include all detections for completeness.\n\n3) Build the non-detection epoch subquery (standardize columns)\n- INNER JOIN non_detection nd to target t ON nd.oid = t.oid (hash index on non_detection.oid).\n- SELECT and alias columns to the unified schema:\n  - t.oid AS oid\n  - nd.mjd AS mjd\n  - nd.fid AS fid\n  - NULL::integer AS isdiffpos\n  - NULL::double precision AS det_mag\n  - NULL::double precision AS det_mag_err\n  - nd.diffmaglim::double precision AS diffmaglim\n  - NULL::double precision AS forced_mag\n  - NULL::double precision AS forced_mag_err\n  - 'non_detection'::text AS \"table\"\n\n4) Build the forced photometry epoch subquery (standardize columns)\n- INNER JOIN forced_photometry fp to target t ON fp.oid = t.oid.\n- SELECT and alias columns to the unified schema:\n  - t.oid AS oid\n  - fp.mjd AS mjd\n  - fp.fid AS fid\n  - fp.isdiffpos::integer AS isdiffpos\n  - NULL::double precision AS det_mag\n  - NULL::double precision AS det_mag_err\n  - fp.diffmaglim::double precision AS diffmaglim\n  - fp.mag::double precision AS forced_mag\n  - fp.e_mag::double precision AS forced_mag_err\n  - 'forced_photometry'::text AS \"table\"\n\n5) Union the three epoch subqueries into one output\n- Use UNION ALL to concatenate the three standardized subqueries:\n  - detection branch\n  - non_detection branch\n  - forced_photometry branch\n- UNION ALL is critical to retain all rows (including possible same-MJD entries across tables).\n\n6) Order the final output by epoch\n- Apply ORDER BY mjd ASC, then \"table\" ASC to provide a deterministic order when MJDs are equal across branches.\n\n7) Optional constraints and considerations\n- If you need to limit to specific filters (fid values) or time ranges (mjd windows), add WHERE clauses inside each branch for consistent filtering across all three tables.\n- If you want to ensure only epochs with at least one magnitude or limit value are returned, it\u2019s already guaranteed by table semantics; all rows in each table represent valid epochs.\n- No spatial filtering is needed here (Q3C functions are irrelevant for this request).\n- No INTERSECT/EXCEPT are necessary; the task is a union of distinct epoch sources.\n\n8) Column naming and type consistency check\n- Final column list and order must be identical in each UNION branch:\n  - oid VARCHAR\n  - mjd DOUBLE PRECISION\n  - fid INTEGER\n  - isdiffpos INTEGER (NULL for non_detection)\n  - det_mag DOUBLE PRECISION (NULL except in detection branch)\n  - det_mag_err DOUBLE PRECISION (NULL except in detection branch)\n  - diffmaglim DOUBLE PRECISION (NULL only if missing, but present in all three tables)\n  - forced_mag DOUBLE PRECISION (NULL except in forced_photometry branch)\n  - forced_mag_err DOUBLE PRECISION (NULL except in forced_photometry branch)\n  - \"table\" TEXT\n- Ensure explicit casts on NULL literals to avoid union type conflicts.\n\n9) Performance considerations\n- The detection and non_detection branches will use hash indexes on oid for fast lookup.\n- The forced_photometry table has no oid index in the provided schema; the query will filter by a single oid value, so scanning load should be small. If performance is an issue, consider adding an index on forced_photometry(oid) outside this query.\n\n10) Sanity checks\n- Verify that the object exists in object; if not, the target CTE will be empty, and the final result will have zero rows.\n- Verify counts: number of rows equals detections + non_detections + forced_photometry rows for this oid.\n\nThis plan yields a single combined epoch table with the requested columns for ZTF24aamtvxb, labeled by source table and sorted by epoch.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\nGoal\nReturn a single result set with all epochs (detections, non-detections, and forced photometry) for the ZTF object ZTF24aamtvxb, with these columns:\n- oid (ZTF identifier)\n- mjd (epoch date)\n- fid (filter identifier)\n- isdiffpos (flag; NULL for non-detections)\n- det_mag (detection difference magnitude; detection.magpsf)\n- det_mag_err (detection magnitude uncertainty; detection.sigmapsf)\n- diffmaglim (5-sigma magnitude limit; table-specific)\n- forced_mag (forced difference magnitude; forced_photometry.mag)\n- forced_mag_err (forced magnitude uncertainty; forced_photometry.e_mag)\n- \"table\" (name of the source table for each row: 'detection', 'non_detection', or 'forced_photometry')\n\nKey schema elements to use\n- object(oid, \u2026)\n- detection(oid, mjd, fid, isdiffpos, magpsf, sigmapsf, diffmaglim, \u2026) with hash index on oid (ix_ndetection_oid)\n- non_detection(oid, fid, mjd, diffmaglim) with hash index on oid (ix_non_detection_oid)\n- forced_photometry(oid, mjd, fid, isdiffpos, mag, e_mag, diffmaglim, \u2026)\n\nNotes and constraints\n- We do not need the probability or feature tables for this request (so their default conditions do not apply).\n- MJD is the epoch date field requested.\n- The column name \"table\" is a reserved word; alias it as \"table\" with double quotes in the final SELECT.\n- Types must be consistent across UNION branches:\n  - isdiffpos: integer in detection and forced_photometry; use NULL::integer for non_detection.\n  - det_mag, det_mag_err, diffmaglim, forced_mag, forced_mag_err: double precision; use NULL::double precision where not applicable.\n- Return all rows (no deduplication), and include a literal text label indicating the source table.\n\nStep-by-step plan\n\n1) Define the target object once in a CTE and validate existence\n- Create a CTE that restricts to the single oid:\n  - FROM object o\n  - WHERE o.oid = 'ZTF24aamtvxb'\n- Select only o.oid in this CTE (call it target). This ensures we only process the intended object and provides a join anchor for all epoch subqueries.\n- Using object provides a clean INNER JOIN and avoids typos in the oid literal across branches.\n\n2) Build the detection epoch subquery (standardize columns)\n- INNER JOIN detection d to target t ON d.oid = t.oid. This leverages the hash index on detection.oid.\n- SELECT and alias columns to the unified schema:\n  - t.oid AS oid\n  - d.mjd AS mjd\n  - d.fid AS fid\n  - d.isdiffpos::integer AS isdiffpos\n  - d.magpsf::double precision AS det_mag\n  - d.sigmapsf::double precision AS det_mag_err\n  - d.diffmaglim::double precision AS diffmaglim\n  - NULL::double precision AS forced_mag\n  - NULL::double precision AS forced_mag_err\n  - 'detection'::text AS \"table\"\n- Do not filter on dubious/real-bogus unless explicitly requested; include all detections for completeness.\n\n3) Build the non-detection epoch subquery (standardize columns)\n- INNER JOIN non_detection nd to target t ON nd.oid = t.oid (hash index on non_detection.oid).\n- SELECT and alias columns to the unified schema:\n  - t.oid AS oid\n  - nd.mjd AS mjd\n  - nd.fid AS fid\n  - NULL::integer AS isdiffpos\n  - NULL::double precision AS det_mag\n  - NULL::double precision AS det_mag_err\n  - nd.diffmaglim::double precision AS diffmaglim\n  - NULL::double precision AS forced_mag\n  - NULL::double precision AS forced_mag_err\n  - 'non_detection'::text AS \"table\"\n\n4) Build the forced photometry epoch subquery (standardize columns)\n- INNER JOIN forced_photometry fp to target t ON fp.oid = t.oid.\n- SELECT and alias columns to the unified schema:\n  - t.oid AS oid\n  - fp.mjd AS mjd\n  - fp.fid AS fid\n  - fp.isdiffpos::integer AS isdiffpos\n  - NULL::double precision AS det_mag\n  - NULL::double precision AS det_mag_err\n  - fp.diffmaglim::double precision AS diffmaglim\n  - fp.mag::double precision AS forced_mag\n  - fp.e_mag::double precision AS forced_mag_err\n  - 'forced_photometry'::text AS \"table\"\n\n5) Union the three epoch subqueries into one output\n- Use UNION ALL to concatenate the three standardized subqueries:\n  - detection branch\n  - non_detection branch\n  - forced_photometry branch\n- UNION ALL is critical to retain all rows (including possible same-MJD entries across tables).\n\n6) Order the final output by epoch\n- Apply ORDER BY mjd ASC, then \"table\" ASC to provide a deterministic order when MJDs are equal across branches.\n\n7) Optional constraints and considerations\n- If you need to limit to specific filters (fid values) or time ranges (mjd windows), add WHERE clauses inside each branch for consistent filtering across all three tables.\n- If you want to ensure only epochs with at least one magnitude or limit value are returned, it\u2019s already guaranteed by table semantics; all rows in each table represent valid epochs.\n- No spatial filtering is needed here (Q3C functions are irrelevant for this request).\n- No INTERSECT/EXCEPT are necessary; the task is a union of distinct epoch sources.\n\n8) Column naming and type consistency check\n- Final column list and order must be identical in each UNION branch:\n  - oid VARCHAR\n  - mjd DOUBLE PRECISION\n  - fid INTEGER\n  - isdiffpos INTEGER (NULL for non_detection)\n  - det_mag DOUBLE PRECISION (NULL except in detection branch)\n  - det_mag_err DOUBLE PRECISION (NULL except in detection branch)\n  - diffmaglim DOUBLE PRECISION (NULL only if missing, but present in all three tables)\n  - forced_mag DOUBLE PRECISION (NULL except in forced_photometry branch)\n  - forced_mag_err DOUBLE PRECISION (NULL except in forced_photometry branch)\n  - \"table\" TEXT\n- Ensure explicit casts on NULL literals to avoid union type conflicts.\n\n9) Performance considerations\n- The detection and non_detection branches will use hash indexes on oid for fast lookup.\n- The forced_photometry table has no oid index in the provided schema; the query will filter by a single oid value, so scanning load should be small. If performance is an issue, consider adding an index on forced_photometry(oid) outside this query.\n\n10) Sanity checks\n- Verify that the object exists in object; if not, the target CTE will be empty, and the final result will have zero rows.\n- Verify counts: number of rows equals detections + non_detections + forced_photometry rows for this oid.\n\nThis plan yields a single combined epoch table with the requested columns for ZTF24aamtvxb, labeled by source table and sorted by epoch."
                },
                "in_toks": 4213,
                "out_toks": 3960,
                "id": "chatcmpl-CSqs3Ok7XB21i6vm7zFIZ8IbS0Wjq",
                "created": 1760992455,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return all detections, non-detections, and forced photometry epochs for ZTF24aamtvxb\nWITH target AS (\n    SELECT o.oid\n    FROM object o\n    WHERE o.oid = 'ZTF24aamtvxb'\n)\nSELECT\n    t.oid AS oid,\n    d.mjd AS mjd,\n    d.fid AS fid,\n    d.isdiffpos::integer AS isdiffpos,\n    d.magpsf::double precision AS det_mag,\n    d.sigmapsf::double precision AS det_mag_err,\n    d.diffmaglim::double precision AS diffmaglim,\n    NULL::double precision AS forced_mag,\n    NULL::double precision AS forced_mag_err,\n    'detection'::text AS \"table\"\nFROM target t\nINNER JOIN detection d ON d.oid = t.oid\n\nUNION ALL\n\nSELECT\n    t.oid AS oid,\n    nd.mjd AS mjd,\n    nd.fid AS fid,\n    NULL::integer AS isdiffpos,\n    NULL::double precision AS det_mag,\n    NULL::double precision AS det_mag_err,\n    nd.diffmaglim::double precision AS diffmaglim,\n    NULL::double precision AS forced_mag,\n    NULL::double precision AS forced_mag_err,\n    'non_detection'::text AS \"table\"\nFROM target t\nINNER JOIN non_detection nd ON nd.oid = t.oid\n\nUNION ALL\n\nSELECT\n    t.oid AS oid,\n    fp.mjd AS mjd,\n    fp.fid AS fid,\n    fp.isdiffpos::integer AS isdiffpos,\n    NULL::double precision AS det_mag,\n    NULL::double precision AS det_mag_err,\n    fp.diffmaglim::double precision AS diffmaglim,\n    fp.mag::double precision AS forced_mag,\n    fp.e_mag::double precision AS forced_mag_err,\n    'forced_photometry'::text AS \"table\"\nFROM target t\nINNER JOIN forced_photometry fp ON fp.oid = t.oid\n\nORDER BY mjd ASC, \"table\" ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return all detections, non-detections, and forced photometry epochs for ZTF24aamtvxb\nWITH target AS (\n    SELECT o.oid\n    FROM object o\n    WHERE o.oid = 'ZTF24aamtvxb'\n)\nSELECT\n    t.oid AS oid,\n    d.mjd AS mjd,\n    d.fid AS fid,\n    d.isdiffpos::integer AS isdiffpos,\n    d.magpsf::double precision AS det_mag,\n    d.sigmapsf::double precision AS det_mag_err,\n    d.diffmaglim::double precision AS diffmaglim,\n    NULL::double precision AS forced_mag,\n    NULL::double precision AS forced_mag_err,\n    'detection'::text AS \"table\"\nFROM target t\nINNER JOIN detection d ON d.oid = t.oid\n\nUNION ALL\n\nSELECT\n    t.oid AS oid,\n    nd.mjd AS mjd,\n    nd.fid AS fid,\n    NULL::integer AS isdiffpos,\n    NULL::double precision AS det_mag,\n    NULL::double precision AS det_mag_err,\n    nd.diffmaglim::double precision AS diffmaglim,\n    NULL::double precision AS forced_mag,\n    NULL::double precision AS forced_mag_err,\n    'non_detection'::text AS \"table\"\nFROM target t\nINNER JOIN non_detection nd ON nd.oid = t.oid\n\nUNION ALL\n\nSELECT\n    t.oid AS oid,\n    fp.mjd AS mjd,\n    fp.fid AS fid,\n    fp.isdiffpos::integer AS isdiffpos,\n    NULL::double precision AS det_mag,\n    NULL::double precision AS det_mag_err,\n    fp.diffmaglim::double precision AS diffmaglim,\n    fp.mag::double precision AS forced_mag,\n    fp.e_mag::double precision AS forced_mag_err,\n    'forced_photometry'::text AS \"table\"\nFROM target t\nINNER JOIN forced_photometry fp ON fp.oid = t.oid\n\nORDER BY mjd ASC, \"table\" ASC;\n```"
                },
                "in_toks": 3874,
                "out_toks": 1661,
                "id": "chatcmpl-CSr6OcCOyI6va2uHgmapbeurG4lTa",
                "created": 1760993344,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "100",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "detection",
                "non_detection",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection', 'non_detection', 'forced_photometry']",
                    "1": "['object', 'detection', 'non_detection', 'forced_photometry']"
                },
                "in_toks": 682,
                "out_toks": 1332,
                "id": "chatcmpl-CSnbZDsVYVVJxe5lQBdaK7F2L9GZ4",
                "created": 1760979901,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2333,
                "out_toks": 527,
                "id": "chatcmpl-CSnrl5SDqYtF89R64ibunlhB5JeWU",
                "created": 1760980905,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 4213,
                "out_toks": 4000,
                "id": "chatcmpl-CSqsYAuZuD50P1rgC6TdAlRpUYMXW",
                "created": 1760992486,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- The provided schema only includes the 'detection' table among time/band-dependent data.\n-- Non-detections and forced photometry tables are not available here, so this query returns detections only.\n-- Columns returned match the user's request where possible; forced photometry columns are returned as NULLs.\n\nSELECT\n    d.oid,                 -- ZTF identifier\n    d.mjd,                 -- epoch date\n    d.fid,                 -- filter identifier\n    d.isdiffpos,           -- isdiffpos flag\n    d.magpsf,              -- detection difference magnitude\n    d.sigmapsf,            -- detection difference magnitude uncertainty\n    d.diffmaglim,          -- 5-sigma magnitude limit\n    NULL::double precision AS forced_magpsf,     -- forced difference magnitude (not available)\n    NULL::double precision AS forced_sigmapsf,   -- forced difference magnitude uncertainty (not available)\n    'detection'::text AS \"table\"                 -- name of the table of origin\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\nORDER BY d.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- The provided schema only includes the 'detection' table among time/band-dependent data.\n-- Non-detections and forced photometry tables are not available here, so this query returns detections only.\n-- Columns returned match the user's request where possible; forced photometry columns are returned as NULLs.\n\nSELECT\n    d.oid,                 -- ZTF identifier\n    d.mjd,                 -- epoch date\n    d.fid,                 -- filter identifier\n    d.isdiffpos,           -- isdiffpos flag\n    d.magpsf,              -- detection difference magnitude\n    d.sigmapsf,            -- detection difference magnitude uncertainty\n    d.diffmaglim,          -- 5-sigma magnitude limit\n    NULL::double precision AS forced_magpsf,     -- forced difference magnitude (not available)\n    NULL::double precision AS forced_sigmapsf,   -- forced difference magnitude uncertainty (not available)\n    'detection'::text AS \"table\"                 -- name of the table of origin\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\nORDER BY d.mjd;\n```"
                },
                "in_toks": 3070,
                "out_toks": 3126,
                "id": "chatcmpl-CSr6DQY6ky9mXXQ4GFnvtpL6kOcc7",
                "created": 1760993333,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "100",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "detection",
                "non_detection",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection', 'non_detection', 'forced_photometry']"
                },
                "in_toks": 682,
                "out_toks": 410,
                "id": "chatcmpl-CSssWlx0pC7L4GTGAFiiwuuNiA4hX",
                "created": 1761000172,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2333,
                "out_toks": 399,
                "id": "chatcmpl-CSxdG1ioH7bqvFF0T1aViHG4OIaac",
                "created": 1761018446,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 4213,
                "out_toks": 4000,
                "id": "chatcmpl-CSxhbxcsnh04oG7rE8JYxUB7Wi3F9",
                "created": 1761018715,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* NOTE:\n   The provided schema includes only the 'detection' table at the epoch level.\n   Tables for non-detections and forced photometry are not available here, so this query returns detection epochs only.\n   The 'forced_magpsf' and 'forced_sigmapsf' columns are returned as NULL placeholders.\n*/\nSELECT\n  d.oid,\n  d.mjd,\n  d.fid,\n  d.isdiffpos,\n  d.magpsf,\n  d.sigmapsf,\n  d.diffmaglim,\n  NULL::double precision AS forced_magpsf,\n  NULL::double precision AS forced_sigmapsf,\n  'detection'::text AS \"table\"\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\nORDER BY d.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* NOTE:\n   The provided schema includes only the 'detection' table at the epoch level.\n   Tables for non-detections and forced photometry are not available here, so this query returns detection epochs only.\n   The 'forced_magpsf' and 'forced_sigmapsf' columns are returned as NULL placeholders.\n*/\nSELECT\n  d.oid,\n  d.mjd,\n  d.fid,\n  d.isdiffpos,\n  d.magpsf,\n  d.sigmapsf,\n  d.diffmaglim,\n  NULL::double precision AS forced_magpsf,\n  NULL::double precision AS forced_sigmapsf,\n  'detection'::text AS \"table\"\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\nORDER BY d.mjd;\n```"
                },
                "in_toks": 3070,
                "out_toks": 3570,
                "id": "chatcmpl-CSyMw7B370Yp6Vx0WEuVL6RS3lhtm",
                "created": 1761021278,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "100",
            "experiment_id": "run_3",
            "pred_tables": [
                "detection",
                "non_detection",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'non_detection', 'forced_photometry']"
                },
                "in_toks": 682,
                "out_toks": 1239,
                "id": "chatcmpl-CSssdpLWVoV222RMYTgiYa84CHAcd",
                "created": 1761000179,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1851,
                "out_toks": 399,
                "id": "chatcmpl-CSxdKoip2EbzzQDE9qKkDaXHBOgxs",
                "created": 1761018450,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3731,
                "out_toks": 4000,
                "id": "chatcmpl-CSxiKnrmZy5NgX1cFAiJCOyFcTpQt",
                "created": 1761018760,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- NOTE: The available schema here includes only the 'detection' table for epoch-level photometry.\n-- Non-detections and forced photometry tables are not present in this context, so this query returns\n-- only detections for the requested object. It includes placeholders (NULLs) for forced photometry columns.\nSELECT\n    d.oid,                -- ZTF identifier\n    d.mjd,                -- epoch date\n    d.fid,                -- filter identifier\n    d.isdiffpos,          -- isdiffpos flag\n    d.magpsf,             -- detection difference magnitude\n    d.sigmapsf,           -- detection difference magnitude uncertainty\n    d.diffmaglim,         -- 5-sigma magnitude limit\n    NULL::double precision AS forced_magpsf,      -- forced difference magnitude (not available)\n    NULL::double precision AS forced_sigmapsf,    -- forced difference magnitude uncertainty (not available)\n    'detection'::text AS \"table\"                  -- table of origin\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\nORDER BY d.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- NOTE: The available schema here includes only the 'detection' table for epoch-level photometry.\n-- Non-detections and forced photometry tables are not present in this context, so this query returns\n-- only detections for the requested object. It includes placeholders (NULLs) for forced photometry columns.\nSELECT\n    d.oid,                -- ZTF identifier\n    d.mjd,                -- epoch date\n    d.fid,                -- filter identifier\n    d.isdiffpos,          -- isdiffpos flag\n    d.magpsf,             -- detection difference magnitude\n    d.sigmapsf,           -- detection difference magnitude uncertainty\n    d.diffmaglim,         -- 5-sigma magnitude limit\n    NULL::double precision AS forced_magpsf,      -- forced difference magnitude (not available)\n    NULL::double precision AS forced_sigmapsf,    -- forced difference magnitude uncertainty (not available)\n    'detection'::text AS \"table\"                  -- table of origin\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\nORDER BY d.mjd;\n```"
                },
                "in_toks": 3070,
                "out_toks": 3702,
                "id": "chatcmpl-CSyNkZ8biuLrB8u0zPlHMmQtqa8EN",
                "created": 1761021328,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "100",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "detection",
                "non_detection",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection', 'non_detection', 'forced_photometry']"
                },
                "in_toks": 682,
                "out_toks": 538,
                "id": "chatcmpl-CSssuZC30YDVRmz6FvtcJsssGwtOz",
                "created": 1761000196,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2333,
                "out_toks": 271,
                "id": "chatcmpl-CSxdRn77L2MopVeUeqSCiTRZHR0vo",
                "created": 1761018457,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 4213,
                "out_toks": 4000,
                "id": "chatcmpl-CSxj0rNFIihKgNgcJe3Y6SvVMlsqL",
                "created": 1761018802,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- NOTE: The provided schema includes only the 'detection' table for time/band-dependent epochs.\n--       There are no 'non_detection' or 'forced_photometry' tables available here.\n--       This query returns detections for the requested object and includes placeholder columns\n--       for forced photometry (NULL), along with the requested 'table' source label.\n\nSELECT\n    d.oid,               -- ZTF identifier\n    d.mjd,               -- epoch date (MJD)\n    d.fid,               -- filter identifier (1=g; 2=r; 3=i)\n    d.isdiffpos,         -- isdiffpos flag\n    d.magpsf,            -- detection difference magnitude\n    d.sigmapsf,          -- detection difference magnitude uncertainty\n    d.diffmaglim,        -- 5-sigma magnitude limit\n    NULL::double precision AS forced_magpsf,     -- forced difference magnitude (not available in this schema)\n    NULL::double precision AS forced_sigmapsf,   -- forced difference magnitude uncertainty (not available)\n    'detection'::text AS \"table\"                 -- origin table\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\nORDER BY d.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- NOTE: The provided schema includes only the 'detection' table for time/band-dependent epochs.\n--       There are no 'non_detection' or 'forced_photometry' tables available here.\n--       This query returns detections for the requested object and includes placeholder columns\n--       for forced photometry (NULL), along with the requested 'table' source label.\n\nSELECT\n    d.oid,               -- ZTF identifier\n    d.mjd,               -- epoch date (MJD)\n    d.fid,               -- filter identifier (1=g; 2=r; 3=i)\n    d.isdiffpos,         -- isdiffpos flag\n    d.magpsf,            -- detection difference magnitude\n    d.sigmapsf,          -- detection difference magnitude uncertainty\n    d.diffmaglim,        -- 5-sigma magnitude limit\n    NULL::double precision AS forced_magpsf,     -- forced difference magnitude (not available in this schema)\n    NULL::double precision AS forced_sigmapsf,   -- forced difference magnitude uncertainty (not available)\n    'detection'::text AS \"table\"                 -- origin table\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\nORDER BY d.mjd;\n```"
                },
                "in_toks": 3070,
                "out_toks": 3345,
                "id": "chatcmpl-CSyOJBhtS6KX10t1qytI2okUXV6Qq",
                "created": 1761021363,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "100",
            "experiment_id": "run_5",
            "pred_tables": [
                "detection",
                "non_detection",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'non_detection', 'forced_photometry']"
                },
                "in_toks": 682,
                "out_toks": 855,
                "id": "chatcmpl-CZNLEVkgVp0W3c0NT1hADdeV7vS3f",
                "created": 1762547240,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1851,
                "out_toks": 399,
                "id": "chatcmpl-CZYlWxkRB7jQE9KJayAAANblNqegm",
                "created": 1762591154,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3731,
                "out_toks": 4000,
                "id": "chatcmpl-CZaMifyteHQ2EnilHMFJddBDnSMXk",
                "created": 1762597304,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return detections for the specified ZTF object with the requested columns.\n-- NOTE: The provided schema includes only the 'detection' table; there are no\n--       'non_detection' or 'forced_photometry' tables available here.\n--       Placeholders for those are included as empty SELECTs to keep a single\n--       unified output with a 'table' origin column.\n\nSELECT\n    d.oid,                  -- ZTF identifier\n    d.mjd,                  -- epoch date\n    d.fid,                  -- filter identifier\n    d.isdiffpos,            -- isdiffpos flag\n    d.magpsf,               -- detection difference magnitude\n    d.sigmapsf,             -- detection difference magnitude uncertainty\n    d.diffmaglim,           -- 5-sigma magnitude limit\n    NULL::DOUBLE PRECISION AS forced_mag,       -- forced photometry magnitude (not available in this schema)\n    NULL::DOUBLE PRECISION AS forced_mag_err,   -- forced photometry magnitude uncertainty (not available in this schema)\n    'detection'::TEXT AS \"table\"                -- origin table\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\n\nUNION ALL\n\n-- Placeholder for non-detections (no table available in provided schema)\nSELECT\n    'ZTF24aamtvxb'::VARCHAR AS oid,\n    NULL::DOUBLE PRECISION  AS mjd,\n    NULL::INTEGER           AS fid,\n    NULL::INTEGER           AS isdiffpos,\n    NULL::DOUBLE PRECISION  AS magpsf,\n    NULL::DOUBLE PRECISION  AS sigmapsf,\n    NULL::DOUBLE PRECISION  AS diffmaglim,\n    NULL::DOUBLE PRECISION  AS forced_mag,\n    NULL::DOUBLE PRECISION  AS forced_mag_err,\n    'non_detection'::TEXT   AS \"table\"\nWHERE FALSE\n\nUNION ALL\n\n-- Placeholder for forced photometry (no table available in provided schema)\nSELECT\n    'ZTF24aamtvxb'::VARCHAR AS oid,\n    NULL::DOUBLE PRECISION  AS mjd,\n    NULL::INTEGER           AS fid,\n    NULL::INTEGER           AS isdiffpos,\n    NULL::DOUBLE PRECISION  AS magpsf,\n    NULL::DOUBLE PRECISION  AS sigmapsf,\n    NULL::DOUBLE PRECISION  AS diffmaglim,\n    NULL::DOUBLE PRECISION  AS forced_mag,\n    NULL::DOUBLE PRECISION  AS forced_mag_err,\n    'forced_photometry'::TEXT AS \"table\"\nWHERE FALSE;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return detections for the specified ZTF object with the requested columns.\n-- NOTE: The provided schema includes only the 'detection' table; there are no\n--       'non_detection' or 'forced_photometry' tables available here.\n--       Placeholders for those are included as empty SELECTs to keep a single\n--       unified output with a 'table' origin column.\n\nSELECT\n    d.oid,                  -- ZTF identifier\n    d.mjd,                  -- epoch date\n    d.fid,                  -- filter identifier\n    d.isdiffpos,            -- isdiffpos flag\n    d.magpsf,               -- detection difference magnitude\n    d.sigmapsf,             -- detection difference magnitude uncertainty\n    d.diffmaglim,           -- 5-sigma magnitude limit\n    NULL::DOUBLE PRECISION AS forced_mag,       -- forced photometry magnitude (not available in this schema)\n    NULL::DOUBLE PRECISION AS forced_mag_err,   -- forced photometry magnitude uncertainty (not available in this schema)\n    'detection'::TEXT AS \"table\"                -- origin table\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\n\nUNION ALL\n\n-- Placeholder for non-detections (no table available in provided schema)\nSELECT\n    'ZTF24aamtvxb'::VARCHAR AS oid,\n    NULL::DOUBLE PRECISION  AS mjd,\n    NULL::INTEGER           AS fid,\n    NULL::INTEGER           AS isdiffpos,\n    NULL::DOUBLE PRECISION  AS magpsf,\n    NULL::DOUBLE PRECISION  AS sigmapsf,\n    NULL::DOUBLE PRECISION  AS diffmaglim,\n    NULL::DOUBLE PRECISION  AS forced_mag,\n    NULL::DOUBLE PRECISION  AS forced_mag_err,\n    'non_detection'::TEXT   AS \"table\"\nWHERE FALSE\n\nUNION ALL\n\n-- Placeholder for forced photometry (no table available in provided schema)\nSELECT\n    'ZTF24aamtvxb'::VARCHAR AS oid,\n    NULL::DOUBLE PRECISION  AS mjd,\n    NULL::INTEGER           AS fid,\n    NULL::INTEGER           AS isdiffpos,\n    NULL::DOUBLE PRECISION  AS magpsf,\n    NULL::DOUBLE PRECISION  AS sigmapsf,\n    NULL::DOUBLE PRECISION  AS diffmaglim,\n    NULL::DOUBLE PRECISION  AS forced_mag,\n    NULL::DOUBLE PRECISION  AS forced_mag_err,\n    'forced_photometry'::TEXT AS \"table\"\nWHERE FALSE;\n```"
                },
                "in_toks": 3070,
                "out_toks": 3803,
                "id": "chatcmpl-CZawckEAM01Zu7KmUJ9Y59apJu2aR",
                "created": 1762599530,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "100",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "detection",
                "non_detection",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection', 'non_detection', 'forced_photometry']"
                },
                "in_toks": 682,
                "out_toks": 538,
                "id": "chatcmpl-CZNLV7bC4pebTMlpuArkIe4yV9iOy",
                "created": 1762547257,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2333,
                "out_toks": 335,
                "id": "chatcmpl-CZYlepAvNGbZNojraZE1cFu8tlzwA",
                "created": 1762591162,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 4213,
                "out_toks": 4000,
                "id": "chatcmpl-CZaNnXikMWpn2JlQy5ZtawXmnyCpL",
                "created": 1762597371,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* The provided schema includes only the 'detection' table for per-epoch photometry.\n   There are no tables for non-detections or forced photometry in the given schema,\n   so this query returns only detections for the requested object. The columns for\n   forced photometry are included as NULL placeholders to match the requested output.\n*/\nSELECT\n  d.oid,                -- ZTF identifier\n  d.mjd,                -- epoch date\n  d.fid,                -- filter identifier (1=g; 2=r; 3=i)\n  d.isdiffpos,          -- isdiffpos flag\n  d.magpsf,             -- detection difference magnitude\n  d.sigmapsf,           -- detection difference magnitude uncertainty\n  d.diffmaglim,         -- 5-sigma magnitude limit\n  NULL::double precision AS forced_mag,      -- forced difference magnitude (not available)\n  NULL::double precision AS forced_mag_err,  -- forced difference magnitude uncertainty (not available)\n  'detection'::text AS \"table\"               -- origin table\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\nORDER BY d.mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* The provided schema includes only the 'detection' table for per-epoch photometry.\n   There are no tables for non-detections or forced photometry in the given schema,\n   so this query returns only detections for the requested object. The columns for\n   forced photometry are included as NULL placeholders to match the requested output.\n*/\nSELECT\n  d.oid,                -- ZTF identifier\n  d.mjd,                -- epoch date\n  d.fid,                -- filter identifier (1=g; 2=r; 3=i)\n  d.isdiffpos,          -- isdiffpos flag\n  d.magpsf,             -- detection difference magnitude\n  d.sigmapsf,           -- detection difference magnitude uncertainty\n  d.diffmaglim,         -- 5-sigma magnitude limit\n  NULL::double precision AS forced_mag,      -- forced difference magnitude (not available)\n  NULL::double precision AS forced_mag_err,  -- forced difference magnitude uncertainty (not available)\n  'detection'::text AS \"table\"               -- origin table\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\nORDER BY d.mjd;\n```"
                },
                "in_toks": 3070,
                "out_toks": 3011,
                "id": "chatcmpl-CZaypTZan3bhkQc6eP8GnyCwRmynC",
                "created": 1762599667,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "100",
            "experiment_id": "run_7",
            "pred_tables": [
                "detection",
                "non_detection",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['detection', 'non_detection', 'forced_photometry']"
                },
                "in_toks": 682,
                "out_toks": 407,
                "id": "chatcmpl-CZNLg7A7othMlbwjxC9D8cYtdNXj6",
                "created": 1762547268,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1851,
                "out_toks": 463,
                "id": "chatcmpl-CZYlnWr4Aap5Y8KbRVGYOGtM5wgjQ",
                "created": 1762591171,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3731,
                "out_toks": 4000,
                "id": "chatcmpl-CZaDDCl48DvbZ2RMXYgqqJLd08n2g",
                "created": 1762596715,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- The current schema exposes only 'detection'; there are no 'non_detection' or 'forced_photometry' tables defined above.\n-- This query returns all detection epochs for the object, and includes placeholder NULLs for the forced-photometry columns.\n-- If your deployment includes 'non_detection' and/or 'forced_photometry' tables, you can UNION ALL analogous SELECTs to combine all epochs.\n\nSELECT\n  d.oid,                 -- ZTF identifier\n  d.mjd,                 -- epoch date\n  d.fid,                 -- filter identifier (1=g; 2=r; 3=i)\n  d.isdiffpos,           -- isdiffpos flag\n  d.magpsf,              -- detection difference magnitude\n  d.sigmapsf,            -- detection difference magnitude uncertainty\n  d.diffmaglim,          -- 5-sigma magnitude limit\n  NULL::DOUBLE PRECISION AS forced_magpsf,     -- forced difference magnitude (placeholder)\n  NULL::DOUBLE PRECISION AS forced_sigmapsf,   -- forced difference magnitude uncertainty (placeholder)\n  'detection'::text AS \"table\"                 -- table of origin\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\nORDER BY d.mjd;\n\n/*\n-- Example blocks to UNION if your instance has these tables (adjust column names as needed):\n\nUNION ALL\nSELECT\n  nd.oid,\n  nd.mjd,\n  nd.fid,\n  NULL::INTEGER AS isdiffpos,\n  NULL::DOUBLE PRECISION AS magpsf,\n  NULL::DOUBLE PRECISION AS sigmapsf,\n  nd.diffmaglim,\n  NULL::DOUBLE PRECISION AS forced_magpsf,\n  NULL::DOUBLE PRECISION AS forced_sigmapsf,\n  'non_detection'::text AS \"table\"\nFROM non_detection nd\nWHERE nd.oid = 'ZTF24aamtvxb'\n\nUNION ALL\nSELECT\n  fp.oid,\n  fp.mjd,\n  fp.fid,\n  NULL::INTEGER AS isdiffpos,\n  NULL::DOUBLE PRECISION AS magpsf,\n  NULL::DOUBLE PRECISION AS sigmapsf,\n  NULL::DOUBLE PRECISION AS diffmaglim,\n  fp.magpsf AS forced_magpsf,\n  fp.sigmapsf AS forced_sigmapsf,\n  'forced_photometry'::text AS \"table\"\nFROM forced_photometry fp\nWHERE fp.oid = 'ZTF24aamtvxb'\nORDER BY mjd;\n*/\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- The current schema exposes only 'detection'; there are no 'non_detection' or 'forced_photometry' tables defined above.\n-- This query returns all detection epochs for the object, and includes placeholder NULLs for the forced-photometry columns.\n-- If your deployment includes 'non_detection' and/or 'forced_photometry' tables, you can UNION ALL analogous SELECTs to combine all epochs.\n\nSELECT\n  d.oid,                 -- ZTF identifier\n  d.mjd,                 -- epoch date\n  d.fid,                 -- filter identifier (1=g; 2=r; 3=i)\n  d.isdiffpos,           -- isdiffpos flag\n  d.magpsf,              -- detection difference magnitude\n  d.sigmapsf,            -- detection difference magnitude uncertainty\n  d.diffmaglim,          -- 5-sigma magnitude limit\n  NULL::DOUBLE PRECISION AS forced_magpsf,     -- forced difference magnitude (placeholder)\n  NULL::DOUBLE PRECISION AS forced_sigmapsf,   -- forced difference magnitude uncertainty (placeholder)\n  'detection'::text AS \"table\"                 -- table of origin\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\nORDER BY d.mjd;\n\n/*\n-- Example blocks to UNION if your instance has these tables (adjust column names as needed):\n\nUNION ALL\nSELECT\n  nd.oid,\n  nd.mjd,\n  nd.fid,\n  NULL::INTEGER AS isdiffpos,\n  NULL::DOUBLE PRECISION AS magpsf,\n  NULL::DOUBLE PRECISION AS sigmapsf,\n  nd.diffmaglim,\n  NULL::DOUBLE PRECISION AS forced_magpsf,\n  NULL::DOUBLE PRECISION AS forced_sigmapsf,\n  'non_detection'::text AS \"table\"\nFROM non_detection nd\nWHERE nd.oid = 'ZTF24aamtvxb'\n\nUNION ALL\nSELECT\n  fp.oid,\n  fp.mjd,\n  fp.fid,\n  NULL::INTEGER AS isdiffpos,\n  NULL::DOUBLE PRECISION AS magpsf,\n  NULL::DOUBLE PRECISION AS sigmapsf,\n  NULL::DOUBLE PRECISION AS diffmaglim,\n  fp.magpsf AS forced_magpsf,\n  fp.sigmapsf AS forced_sigmapsf,\n  'forced_photometry'::text AS \"table\"\nFROM forced_photometry fp\nWHERE fp.oid = 'ZTF24aamtvxb'\nORDER BY mjd;\n*/\n```"
                },
                "in_toks": 3070,
                "out_toks": 3603,
                "id": "chatcmpl-CZaxq74JJhPd6h7SFYD11dn20qQSW",
                "created": 1762599606,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "100",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "detection",
                "non_detection",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection', 'non_detection', 'forced_photometry']"
                },
                "in_toks": 682,
                "out_toks": 538,
                "id": "chatcmpl-CZNLo0SDs4b0gYOqC5iYDiehpY5pC",
                "created": 1762547276,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2333,
                "out_toks": 399,
                "id": "chatcmpl-CZYlwxgActZhdhTvnyJjFxzoGdiOP",
                "created": 1762591180,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 4213,
                "out_toks": 4000,
                "id": "chatcmpl-CZaP1Z7X2RfZZ7vS89w5vwOdItOpB",
                "created": 1762597447,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* \nRequested: detections, non-detections, and forced photometry epochs for 'ZTF24aamtvxb'\nNote: In the provided schema, only the 'detection' table contains epoch-level photometry.\n      There are no 'non_detection' or 'forced_photometry' tables available, so those\n      UNION branches are placeholders that return zero rows (kept for schema consistency).\n      If those tables become available, replace the placeholders with real SELECTs.\n\nColumns returned:\n- oid (ZTF identifier)\n- mjd (epoch date)\n- fid (filter identifier)\n- isdiffpos (flag)\n- magpsf, sigmapsf (detection difference magnitude and its uncertainty)\n- diffmaglim (5-sigma magnitude limit)\n- forced_magpsf, forced_sigmapsf (forced photometry magnitude and uncertainty; NULL here)\n- \"table\" (name of origin table)\n*/\n\nSELECT\n  d.oid,\n  d.mjd,\n  d.fid,\n  d.isdiffpos,\n  d.magpsf,\n  d.sigmapsf,\n  d.diffmaglim,\n  NULL::double precision AS forced_magpsf,\n  NULL::double precision AS forced_sigmapsf,\n  'detection'::text AS \"table\"\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\n\nUNION ALL\n\n/* Placeholder for non-detections: returns zero rows in this schema */\nSELECT\n  o.oid,\n  NULL::double precision AS mjd,\n  NULL::integer AS fid,\n  NULL::integer AS isdiffpos,\n  NULL::double precision AS magpsf,\n  NULL::double precision AS sigmapsf,\n  NULL::double precision AS diffmaglim,\n  NULL::double precision AS forced_magpsf,\n  NULL::double precision AS forced_sigmapsf,\n  'non_detection'::text AS \"table\"\nFROM object o\nWHERE o.oid = 'ZTF24aamtvxb' AND FALSE\n\nUNION ALL\n\n/* Placeholder for forced photometry: returns zero rows in this schema */\nSELECT\n  o.oid,\n  NULL::double precision AS mjd,\n  NULL::integer AS fid,\n  NULL::integer AS isdiffpos,\n  NULL::double precision AS magpsf,\n  NULL::double precision AS sigmapsf,\n  NULL::double precision AS diffmaglim,\n  NULL::double precision AS forced_magpsf,\n  NULL::double precision AS forced_sigmapsf,\n  'forced_photometry'::text AS \"table\"\nFROM object o\nWHERE o.oid = 'ZTF24aamtvxb' AND FALSE\n\nORDER BY mjd NULLS LAST;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* \nRequested: detections, non-detections, and forced photometry epochs for 'ZTF24aamtvxb'\nNote: In the provided schema, only the 'detection' table contains epoch-level photometry.\n      There are no 'non_detection' or 'forced_photometry' tables available, so those\n      UNION branches are placeholders that return zero rows (kept for schema consistency).\n      If those tables become available, replace the placeholders with real SELECTs.\n\nColumns returned:\n- oid (ZTF identifier)\n- mjd (epoch date)\n- fid (filter identifier)\n- isdiffpos (flag)\n- magpsf, sigmapsf (detection difference magnitude and its uncertainty)\n- diffmaglim (5-sigma magnitude limit)\n- forced_magpsf, forced_sigmapsf (forced photometry magnitude and uncertainty; NULL here)\n- \"table\" (name of origin table)\n*/\n\nSELECT\n  d.oid,\n  d.mjd,\n  d.fid,\n  d.isdiffpos,\n  d.magpsf,\n  d.sigmapsf,\n  d.diffmaglim,\n  NULL::double precision AS forced_magpsf,\n  NULL::double precision AS forced_sigmapsf,\n  'detection'::text AS \"table\"\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\n\nUNION ALL\n\n/* Placeholder for non-detections: returns zero rows in this schema */\nSELECT\n  o.oid,\n  NULL::double precision AS mjd,\n  NULL::integer AS fid,\n  NULL::integer AS isdiffpos,\n  NULL::double precision AS magpsf,\n  NULL::double precision AS sigmapsf,\n  NULL::double precision AS diffmaglim,\n  NULL::double precision AS forced_magpsf,\n  NULL::double precision AS forced_sigmapsf,\n  'non_detection'::text AS \"table\"\nFROM object o\nWHERE o.oid = 'ZTF24aamtvxb' AND FALSE\n\nUNION ALL\n\n/* Placeholder for forced photometry: returns zero rows in this schema */\nSELECT\n  o.oid,\n  NULL::double precision AS mjd,\n  NULL::integer AS fid,\n  NULL::integer AS isdiffpos,\n  NULL::double precision AS magpsf,\n  NULL::double precision AS sigmapsf,\n  NULL::double precision AS diffmaglim,\n  NULL::double precision AS forced_magpsf,\n  NULL::double precision AS forced_sigmapsf,\n  'forced_photometry'::text AS \"table\"\nFROM object o\nWHERE o.oid = 'ZTF24aamtvxb' AND FALSE\n\nORDER BY mjd NULLS LAST;\n```"
                },
                "in_toks": 3070,
                "out_toks": 3837,
                "id": "chatcmpl-CZawcRJsL2KVtHvh8jhPzxKqSKDiy",
                "created": 1762599530,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "100",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "detection",
                "non_detection",
                "forced_photometry"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection', 'non_detection', 'forced_photometry']"
                },
                "in_toks": 682,
                "out_toks": 794,
                "id": "chatcmpl-CZNM1EaoUf1rGD4cf1fmXSJrVl9K7",
                "created": 1762547289,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 2333,
                "out_toks": 527,
                "id": "chatcmpl-CZYm6fhfv2xyKBXRg3c2HsUULgOLY",
                "created": 1762591190,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 4213,
                "out_toks": 4000,
                "id": "chatcmpl-CZaEm6IHeuZY47ABub3o6eghc7YRt",
                "created": 1762596812,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Combined epochs (detections, non-detections, forced photometry) for ZTF24aamtvxb\n-- Note: In this schema only the 'detection' table exists. Non-detections and forced photometry\n-- tables are not present, so those sections return zero rows but keep the requested unified layout.\n\nSELECT\n  d.oid,                                -- ZTF identifier\n  d.mjd,                                -- epoch date (MJD)\n  d.fid,                                -- filter identifier (1=g; 2=r; 3=i)\n  d.isdiffpos,                          -- isdiffpos flag\n  d.magpsf,                             -- detection difference magnitude\n  d.sigmapsf,                           -- detection difference magnitude uncertainty\n  d.diffmaglim,                         -- 5-sigma magnitude limit\n  NULL::double precision AS forced_mag, -- forced difference magnitude (not available in this schema)\n  NULL::double precision AS forced_mag_err, -- forced difference magnitude uncertainty (not available)\n  'detection'::text AS \"table\"          -- origin table\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\n\nUNION ALL\n\n-- Placeholder for non-detections (no rows returned in this schema)\nSELECT\n  o.oid,\n  NULL::double precision AS mjd,\n  NULL::integer AS fid,\n  NULL::integer AS isdiffpos,\n  NULL::double precision AS magpsf,\n  NULL::double precision AS sigmapsf,\n  NULL::double precision AS diffmaglim,\n  NULL::double precision AS forced_mag,\n  NULL::double precision AS forced_mag_err,\n  'non_detection'::text AS \"table\"\nFROM object o\nWHERE o.oid = 'ZTF24aamtvxb' AND FALSE\n\nUNION ALL\n\n-- Placeholder for forced photometry (no rows returned in this schema)\nSELECT\n  o.oid,\n  NULL::double precision AS mjd,\n  NULL::integer AS fid,\n  NULL::integer AS isdiffpos,\n  NULL::double precision AS magpsf,\n  NULL::double precision AS sigmapsf,\n  NULL::double precision AS diffmaglim,\n  NULL::double precision AS forced_mag,\n  NULL::double precision AS forced_mag_err,\n  'forced_photometry'::text AS \"table\"\nFROM object o\nWHERE o.oid = 'ZTF24aamtvxb' AND FALSE\n\nORDER BY mjd;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Combined epochs (detections, non-detections, forced photometry) for ZTF24aamtvxb\n-- Note: In this schema only the 'detection' table exists. Non-detections and forced photometry\n-- tables are not present, so those sections return zero rows but keep the requested unified layout.\n\nSELECT\n  d.oid,                                -- ZTF identifier\n  d.mjd,                                -- epoch date (MJD)\n  d.fid,                                -- filter identifier (1=g; 2=r; 3=i)\n  d.isdiffpos,                          -- isdiffpos flag\n  d.magpsf,                             -- detection difference magnitude\n  d.sigmapsf,                           -- detection difference magnitude uncertainty\n  d.diffmaglim,                         -- 5-sigma magnitude limit\n  NULL::double precision AS forced_mag, -- forced difference magnitude (not available in this schema)\n  NULL::double precision AS forced_mag_err, -- forced difference magnitude uncertainty (not available)\n  'detection'::text AS \"table\"          -- origin table\nFROM detection d\nWHERE d.oid = 'ZTF24aamtvxb'\n\nUNION ALL\n\n-- Placeholder for non-detections (no rows returned in this schema)\nSELECT\n  o.oid,\n  NULL::double precision AS mjd,\n  NULL::integer AS fid,\n  NULL::integer AS isdiffpos,\n  NULL::double precision AS magpsf,\n  NULL::double precision AS sigmapsf,\n  NULL::double precision AS diffmaglim,\n  NULL::double precision AS forced_mag,\n  NULL::double precision AS forced_mag_err,\n  'non_detection'::text AS \"table\"\nFROM object o\nWHERE o.oid = 'ZTF24aamtvxb' AND FALSE\n\nUNION ALL\n\n-- Placeholder for forced photometry (no rows returned in this schema)\nSELECT\n  o.oid,\n  NULL::double precision AS mjd,\n  NULL::integer AS fid,\n  NULL::integer AS isdiffpos,\n  NULL::double precision AS magpsf,\n  NULL::double precision AS sigmapsf,\n  NULL::double precision AS diffmaglim,\n  NULL::double precision AS forced_mag,\n  NULL::double precision AS forced_mag_err,\n  'forced_photometry'::text AS \"table\"\nFROM object o\nWHERE o.oid = 'ZTF24aamtvxb' AND FALSE\n\nORDER BY mjd;\n```"
                },
                "in_toks": 3070,
                "out_toks": 3596,
                "id": "chatcmpl-CZayrPbFl9TtBmwz7SIF4EEJSKwxZ",
                "created": 1762599669,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "106": {
        "0": {
            "req_id": "106",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']",
                    "1": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 727,
                "out_toks": 2086,
                "id": "chatcmpl-CSnbkCpHSedB9SMJfxVzlCCnUR6pL",
                "created": 1760979912,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1249,
                "out_toks": 1103,
                "id": "chatcmpl-CSnrtWo5MySXyvOIpU5X8x5xFYmG2",
                "created": 1760980913,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 30 ZTF objects with >10 detections, bogus prob>0.7 in stamp_classifier v1.0.4,\n-- and Transient prob>0.9 in lc_classifier_top. Return requested columns and order by ZTF id.\nSELECT\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    p_stamp.probability AS prob_stamp_bogus,\n    p_top.probability AS prob_lc_transient\nFROM object o\nINNER JOIN probability p_stamp\n    ON p_stamp.oid = o.oid\n    AND p_stamp.classifier_name = 'stamp_classifier'\n    AND p_stamp.classifier_version = 'stamp_classifier_1.0.4'\n    AND p_stamp.class_name = 'bogus'\n    AND p_stamp.probability > 0.7\nINNER JOIN (\n    SELECT\n        oid,\n        MAX(probability) AS probability\n    FROM probability\n    WHERE classifier_name = 'lc_classifier_top'\n      AND class_name = 'Transient'\n      AND probability > 0.9\n    GROUP BY oid\n) p_top\n    ON p_top.oid = o.oid\nWHERE o.ndet > 10\nORDER BY o.oid ASC\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 ZTF objects with >10 detections, bogus prob>0.7 in stamp_classifier v1.0.4,\n-- and Transient prob>0.9 in lc_classifier_top. Return requested columns and order by ZTF id.\nSELECT\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    p_stamp.probability AS prob_stamp_bogus,\n    p_top.probability AS prob_lc_transient\nFROM object o\nINNER JOIN probability p_stamp\n    ON p_stamp.oid = o.oid\n    AND p_stamp.classifier_name = 'stamp_classifier'\n    AND p_stamp.classifier_version = 'stamp_classifier_1.0.4'\n    AND p_stamp.class_name = 'bogus'\n    AND p_stamp.probability > 0.7\nINNER JOIN (\n    SELECT\n        oid,\n        MAX(probability) AS probability\n    FROM probability\n    WHERE classifier_name = 'lc_classifier_top'\n      AND class_name = 'Transient'\n      AND probability > 0.9\n    GROUP BY oid\n) p_top\n    ON p_top.oid = o.oid\nWHERE o.ndet > 10\nORDER BY o.oid ASC\nLIMIT 30;\n```"
                },
                "in_toks": 2566,
                "out_toks": 2962,
                "id": "chatcmpl-CSqs36te6G8uerVl7pk4Uqnp0ROGz",
                "created": 1760992455,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "106",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']",
                    "1": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 727,
                "out_toks": 2086,
                "id": "chatcmpl-CSnbkCpHSedB9SMJfxVzlCCnUR6pL",
                "created": 1760979912,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1249,
                "out_toks": 527,
                "id": "chatcmpl-CSns8xdq6oLSrvp5PLqTuM75z29T2",
                "created": 1760980928,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 2856,
                "out_toks": 4000,
                "id": "chatcmpl-CSqsZT43pO3aeteSXnb6QM87JMw7T",
                "created": 1760992487,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 30 ZTF objects with >10 detections, bogus prob > 0.7 (stamp_classifier_1.0.4),\n-- and Transient prob > 0.9 in lc_classifier_top. Return requested columns and order by oid.\nSELECT\n  o.oid,\n  o.ndet,\n  o.firstmjd,\n  ps.probability AS prob_stamp_bogus,\n  plct.probability AS prob_lc_transient\nFROM object o\nINNER JOIN probability ps\n  ON ps.oid = o.oid\n AND ps.classifier_name = 'stamp_classifier'\n AND ps.class_name = 'bogus'\n AND ps.classifier_version = 'stamp_classifier_1.0.4'\n AND ps.probability > 0.7\nINNER JOIN (\n  SELECT\n    oid,\n    MAX(probability) AS probability\n  FROM probability\n  WHERE classifier_name = 'lc_classifier_top'\n    AND class_name = 'Transient'\n  GROUP BY oid\n  HAVING MAX(probability) > 0.9\n) plct\n  ON plct.oid = o.oid\nWHERE o.ndet > 10\nORDER BY o.oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 ZTF objects with >10 detections, bogus prob > 0.7 (stamp_classifier_1.0.4),\n-- and Transient prob > 0.9 in lc_classifier_top. Return requested columns and order by oid.\nSELECT\n  o.oid,\n  o.ndet,\n  o.firstmjd,\n  ps.probability AS prob_stamp_bogus,\n  plct.probability AS prob_lc_transient\nFROM object o\nINNER JOIN probability ps\n  ON ps.oid = o.oid\n AND ps.classifier_name = 'stamp_classifier'\n AND ps.class_name = 'bogus'\n AND ps.classifier_version = 'stamp_classifier_1.0.4'\n AND ps.probability > 0.7\nINNER JOIN (\n  SELECT\n    oid,\n    MAX(probability) AS probability\n  FROM probability\n  WHERE classifier_name = 'lc_classifier_top'\n    AND class_name = 'Transient'\n  GROUP BY oid\n  HAVING MAX(probability) > 0.9\n) plct\n  ON plct.oid = o.oid\nWHERE o.ndet > 10\nORDER BY o.oid\nLIMIT 30;\n```"
                },
                "in_toks": 3114,
                "out_toks": 2570,
                "id": "chatcmpl-CSr6Ul4sL55z7yeONuBkRrq2dZiy0",
                "created": 1760993350,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "106",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']"
                },
                "in_toks": 727,
                "out_toks": 528,
                "id": "chatcmpl-CSst2xzC2NtLcStgseg6c5kqE43wV",
                "created": 1761000204,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1204,
                "out_toks": 783,
                "id": "chatcmpl-CSxdUWqS3ay6rYLj6RUR7cGAXAjAc",
                "created": 1761018460,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 2811,
                "out_toks": 4000,
                "id": "chatcmpl-CSxjbYRUyJ3sXJV6Vz4KvsRSokCgb",
                "created": 1761018839,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 30 ZTF objects with >10 detections, bogus prob > 0.7 in stamp_classifier v1.0.4,\n-- and Transient prob > 0.9 in lc_classifier_top.\nSELECT\n  o.oid,\n  o.ndet,\n  o.firstmjd,\n  p_stamp.probability AS prob_stamp_bogus,\n  p_top.probability AS prob_lc_transient\nFROM object AS o\nINNER JOIN probability AS p_stamp\n  ON p_stamp.oid = o.oid\n  AND p_stamp.classifier_name = 'stamp_classifier'\n  AND p_stamp.classifier_version = 'stamp_classifier_1.0.4'\n  AND p_stamp.class_name = 'bogus'\n  AND p_stamp.probability > 0.7\n  AND p_stamp.ranking = 1\nINNER JOIN probability AS p_top\n  ON p_top.oid = o.oid\n  AND p_top.classifier_name = 'lc_classifier_top'\n  AND p_top.class_name = 'Transient'\n  AND p_top.probability > 0.9\n  AND p_top.ranking = 1\nWHERE o.ndet > 10\nORDER BY o.oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 ZTF objects with >10 detections, bogus prob > 0.7 in stamp_classifier v1.0.4,\n-- and Transient prob > 0.9 in lc_classifier_top.\nSELECT\n  o.oid,\n  o.ndet,\n  o.firstmjd,\n  p_stamp.probability AS prob_stamp_bogus,\n  p_top.probability AS prob_lc_transient\nFROM object AS o\nINNER JOIN probability AS p_stamp\n  ON p_stamp.oid = o.oid\n  AND p_stamp.classifier_name = 'stamp_classifier'\n  AND p_stamp.classifier_version = 'stamp_classifier_1.0.4'\n  AND p_stamp.class_name = 'bogus'\n  AND p_stamp.probability > 0.7\n  AND p_stamp.ranking = 1\nINNER JOIN probability AS p_top\n  ON p_top.oid = o.oid\n  AND p_top.classifier_name = 'lc_classifier_top'\n  AND p_top.class_name = 'Transient'\n  AND p_top.probability > 0.9\n  AND p_top.ranking = 1\nWHERE o.ndet > 10\nORDER BY o.oid\nLIMIT 30;\n```"
                },
                "in_toks": 3114,
                "out_toks": 2833,
                "id": "chatcmpl-CSyP2cwUuLZcDOMqEzfu4DRsyy0n6",
                "created": 1761021408,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "106",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']"
                },
                "in_toks": 727,
                "out_toks": 912,
                "id": "chatcmpl-CSstAsfmAJ8D1L8JGYWRoGlluhGfH",
                "created": 1761000212,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1204,
                "out_toks": 719,
                "id": "chatcmpl-CSxddosmgjrOzRwjaPp7721H6cBc7",
                "created": 1761018469,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Identify the base table and primary filters\n- Main table: object (alias o), because it holds per-object summary information and the fields to filter/select:\n  - oid (ZTF identifier)\n  - ndet (number of detections)\n  - firstmjd (first detection date)\n- Apply object-level filter:\n  - o.ndet > 10\n\n2) Identify required classifier-based probability conditions\n- Two independent constraints from the probability table (alias p), one for each classifier:\n  a) Stamp classifier bogus probability\n     - classifier_name = 'stamp_classifier'\n     - classifier_version = 'stamp_classifier_1.0.4'\n     - class_name = 'bogus'\n     - probability > 0.7\n     - Output column needed: probability as prob_stamp_bogus\n     - Note: Do not enforce probability.ranking = 1 because the user explicitly specified classifier, version, class, and threshold; enforcing ranking would unnecessarily exclude cases where \u2018bogus\u2019 is not rank 1.\n  b) LC top-level transient probability\n     - classifier_name = 'lc_classifier_top'\n     - class_name = 'Transient'\n     - probability > 0.9\n     - Output column needed: probability as prob_lc_transient\n     - No classifier_version specified by the user; there may be multiple versions per oid. To avoid duplicates, aggregate per oid and select MAX(probability) as prob_lc_transient after filtering by classifier_name, class_name, and threshold.\n     - Similarly, do not enforce probability.ranking = 1 here, for the same reason as above.\n\n3) Build subqueries for each classifier constraint to reduce the joined dataset size\n- Subquery sp (stamp classifier bogus):\n  - FROM probability\n  - WHERE classifier_name = 'stamp_classifier'\n        AND classifier_version = 'stamp_classifier_1.0.4'\n        AND class_name = 'bogus'\n        AND probability > 0.7\n  - SELECT oid, probability AS prob_stamp_bogus\n  - No GROUP BY needed (the PK ensures uniqueness per oid/classifier/class/version).\n- Subquery lt (lc top transient):\n  - FROM probability\n  - WHERE classifier_name = 'lc_classifier_top'\n        AND class_name = 'Transient'\n        AND probability > 0.9\n  - SELECT oid, MAX(probability) AS prob_lc_transient\n  - GROUP BY oid\n  - This grouping ensures that if multiple classifier_version entries exist for the same oid, only one row per oid is produced and the maximum probability (\u2265 0.9) is returned.\n\n4) Join strategy\n- Start from object o\n- INNER JOIN sp ON sp.oid = o.oid\n  - Ensures the object satisfies the stamp bogus condition and yields prob_stamp_bogus\n- INNER JOIN lt ON lt.oid = o.oid\n  - Ensures the object also satisfies the lc top transient condition and yields prob_lc_transient\n- WHERE clause on the joined result:\n  - o.ndet > 10\n\n5) Selected output columns (as requested by the user)\n- o.oid (ZTF identifier)\n- o.ndet (number of detections)\n- o.firstmjd (first detection date)\n- sp.prob_stamp_bogus (probability from the stamp classifier bogus class)\n- lt.prob_lc_transient (probability from the lc classifier top \u201cTransient\u201d class)\n\n6) Ordering and limiting\n- ORDER BY the ZTF identifier of objects classified as bogus in the stamp classifier\n  - Since all returned rows satisfy the bogus condition via sp, ordering by sp.oid (equivalently o.oid) in ascending order fulfills the requirement.\n- LIMIT 30 to return at most 30 objects.\n\n7) Notes and justifications to ensure correctness and performance\n- Do not apply the default probability.ranking = 1 condition because the user provided explicit classifier/class/version/threshold constraints that supersede the defaults.\n- Exact table and column names to use:\n  - object(oid, ndet, firstmjd)\n  - probability(oid, class_name, classifier_name, classifier_version, probability)\n- Exact class and classifier names (with single quotes in the SQL to be generated):\n  - 'stamp_classifier' with 'bogus' and classifier_version 'stamp_classifier_1.0.4'\n  - 'lc_classifier_top' with 'Transient'\n- Index usage:\n  - object filter leverages ix_object_ndet on (ndet)\n  - Joins on oid use ix_probabilities_oid (hash) from probability and the PK on object(oid)\n  - Subquery filters on classifier_name/class_name/classifier_version/probability reduce scan size before joining\n- No spatial conditions or Q3C functions are needed for this request.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Identify the base table and primary filters\n- Main table: object (alias o), because it holds per-object summary information and the fields to filter/select:\n  - oid (ZTF identifier)\n  - ndet (number of detections)\n  - firstmjd (first detection date)\n- Apply object-level filter:\n  - o.ndet > 10\n\n2) Identify required classifier-based probability conditions\n- Two independent constraints from the probability table (alias p), one for each classifier:\n  a) Stamp classifier bogus probability\n     - classifier_name = 'stamp_classifier'\n     - classifier_version = 'stamp_classifier_1.0.4'\n     - class_name = 'bogus'\n     - probability > 0.7\n     - Output column needed: probability as prob_stamp_bogus\n     - Note: Do not enforce probability.ranking = 1 because the user explicitly specified classifier, version, class, and threshold; enforcing ranking would unnecessarily exclude cases where \u2018bogus\u2019 is not rank 1.\n  b) LC top-level transient probability\n     - classifier_name = 'lc_classifier_top'\n     - class_name = 'Transient'\n     - probability > 0.9\n     - Output column needed: probability as prob_lc_transient\n     - No classifier_version specified by the user; there may be multiple versions per oid. To avoid duplicates, aggregate per oid and select MAX(probability) as prob_lc_transient after filtering by classifier_name, class_name, and threshold.\n     - Similarly, do not enforce probability.ranking = 1 here, for the same reason as above.\n\n3) Build subqueries for each classifier constraint to reduce the joined dataset size\n- Subquery sp (stamp classifier bogus):\n  - FROM probability\n  - WHERE classifier_name = 'stamp_classifier'\n        AND classifier_version = 'stamp_classifier_1.0.4'\n        AND class_name = 'bogus'\n        AND probability > 0.7\n  - SELECT oid, probability AS prob_stamp_bogus\n  - No GROUP BY needed (the PK ensures uniqueness per oid/classifier/class/version).\n- Subquery lt (lc top transient):\n  - FROM probability\n  - WHERE classifier_name = 'lc_classifier_top'\n        AND class_name = 'Transient'\n        AND probability > 0.9\n  - SELECT oid, MAX(probability) AS prob_lc_transient\n  - GROUP BY oid\n  - This grouping ensures that if multiple classifier_version entries exist for the same oid, only one row per oid is produced and the maximum probability (\u2265 0.9) is returned.\n\n4) Join strategy\n- Start from object o\n- INNER JOIN sp ON sp.oid = o.oid\n  - Ensures the object satisfies the stamp bogus condition and yields prob_stamp_bogus\n- INNER JOIN lt ON lt.oid = o.oid\n  - Ensures the object also satisfies the lc top transient condition and yields prob_lc_transient\n- WHERE clause on the joined result:\n  - o.ndet > 10\n\n5) Selected output columns (as requested by the user)\n- o.oid (ZTF identifier)\n- o.ndet (number of detections)\n- o.firstmjd (first detection date)\n- sp.prob_stamp_bogus (probability from the stamp classifier bogus class)\n- lt.prob_lc_transient (probability from the lc classifier top \u201cTransient\u201d class)\n\n6) Ordering and limiting\n- ORDER BY the ZTF identifier of objects classified as bogus in the stamp classifier\n  - Since all returned rows satisfy the bogus condition via sp, ordering by sp.oid (equivalently o.oid) in ascending order fulfills the requirement.\n- LIMIT 30 to return at most 30 objects.\n\n7) Notes and justifications to ensure correctness and performance\n- Do not apply the default probability.ranking = 1 condition because the user provided explicit classifier/class/version/threshold constraints that supersede the defaults.\n- Exact table and column names to use:\n  - object(oid, ndet, firstmjd)\n  - probability(oid, class_name, classifier_name, classifier_version, probability)\n- Exact class and classifier names (with single quotes in the SQL to be generated):\n  - 'stamp_classifier' with 'bogus' and classifier_version 'stamp_classifier_1.0.4'\n  - 'lc_classifier_top' with 'Transient'\n- Index usage:\n  - object filter leverages ix_object_ndet on (ndet)\n  - Joins on oid use ix_probabilities_oid (hash) from probability and the PK on object(oid)\n  - Subquery filters on classifier_name/class_name/classifier_version/probability reduce scan size before joining\n- No spatial conditions or Q3C functions are needed for this request."
                },
                "in_toks": 2811,
                "out_toks": 3443,
                "id": "chatcmpl-CSxkE1WSqjikl8WxsJWFp4kpn0CPu",
                "created": 1761018878,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 30 ZTF objects with ndet > 10, high bogus prob in stamp_classifier v1.0.4,\n-- and high Transient prob in lc_classifier_top. Return requested columns with specified aliases.\nSELECT\n  o.oid,\n  o.ndet,\n  o.firstmjd,\n  sp.prob_stamp_bogus,\n  lt.prob_lc_transient\nFROM object AS o\nINNER JOIN (\n  SELECT\n    p.oid,\n    p.probability AS prob_stamp_bogus\n  FROM probability AS p\n  WHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.classifier_version = 'stamp_classifier_1.0.4'\n    AND p.class_name = 'bogus'\n    AND p.probability > 0.7\n) AS sp\n  ON sp.oid = o.oid\nINNER JOIN (\n  SELECT\n    p.oid,\n    MAX(p.probability) AS prob_lc_transient\n  FROM probability AS p\n  WHERE\n    p.classifier_name = 'lc_classifier_top'\n    AND p.class_name = 'Transient'\n    AND p.probability > 0.9\n  GROUP BY p.oid\n) AS lt\n  ON lt.oid = o.oid\nWHERE\n  o.ndet > 10\nORDER BY\n  o.oid ASC\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 ZTF objects with ndet > 10, high bogus prob in stamp_classifier v1.0.4,\n-- and high Transient prob in lc_classifier_top. Return requested columns with specified aliases.\nSELECT\n  o.oid,\n  o.ndet,\n  o.firstmjd,\n  sp.prob_stamp_bogus,\n  lt.prob_lc_transient\nFROM object AS o\nINNER JOIN (\n  SELECT\n    p.oid,\n    p.probability AS prob_stamp_bogus\n  FROM probability AS p\n  WHERE\n    p.classifier_name = 'stamp_classifier'\n    AND p.classifier_version = 'stamp_classifier_1.0.4'\n    AND p.class_name = 'bogus'\n    AND p.probability > 0.7\n) AS sp\n  ON sp.oid = o.oid\nINNER JOIN (\n  SELECT\n    p.oid,\n    MAX(p.probability) AS prob_lc_transient\n  FROM probability AS p\n  WHERE\n    p.classifier_name = 'lc_classifier_top'\n    AND p.class_name = 'Transient'\n    AND p.probability > 0.9\n  GROUP BY p.oid\n) AS lt\n  ON lt.oid = o.oid\nWHERE\n  o.ndet > 10\nORDER BY\n  o.oid ASC\nLIMIT 30;\n```"
                },
                "in_toks": 3134,
                "out_toks": 1330,
                "id": "chatcmpl-CSyPQaNCEAo73ILqaGQTG7o0RZZzF",
                "created": 1761021432,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "106",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']"
                },
                "in_toks": 727,
                "out_toks": 1040,
                "id": "chatcmpl-CSstNKTmv86PgZmMl9st9qvjGUOic",
                "created": 1761000225,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1204,
                "out_toks": 1167,
                "id": "chatcmpl-CSxdk9p4dWJo7u8qED5zwVecWMqIu",
                "created": 1761018476,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 30 ZTF objects with ndet > 10, bogus prob > 0.7 in stamp_classifier_1.0.4,\n-- and Transient prob > 0.9 in lc_classifier_top. Return requested columns with aliases.\nSELECT\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    stamp_p.probability AS prob_stamp_bogus,\n    lctop_p.probability AS prob_lc_transient\nFROM object o\nINNER JOIN probability AS stamp_p\n    ON stamp_p.oid = o.oid\n    AND stamp_p.classifier_name = 'stamp_classifier'\n    AND stamp_p.classifier_version = 'stamp_classifier_1.0.4'\n    AND stamp_p.class_name = 'bogus'\n    AND stamp_p.probability > 0.7\n    AND stamp_p.ranking = 1\nINNER JOIN probability AS lctop_p\n    ON lctop_p.oid = o.oid\n    AND lctop_p.classifier_name = 'lc_classifier_top'\n    AND lctop_p.class_name = 'Transient'\n    AND lctop_p.probability > 0.9\n    AND lctop_p.ranking = 1\nWHERE o.ndet > 10\nORDER BY stamp_p.oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 ZTF objects with ndet > 10, bogus prob > 0.7 in stamp_classifier_1.0.4,\n-- and Transient prob > 0.9 in lc_classifier_top. Return requested columns with aliases.\nSELECT\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    stamp_p.probability AS prob_stamp_bogus,\n    lctop_p.probability AS prob_lc_transient\nFROM object o\nINNER JOIN probability AS stamp_p\n    ON stamp_p.oid = o.oid\n    AND stamp_p.classifier_name = 'stamp_classifier'\n    AND stamp_p.classifier_version = 'stamp_classifier_1.0.4'\n    AND stamp_p.class_name = 'bogus'\n    AND stamp_p.probability > 0.7\n    AND stamp_p.ranking = 1\nINNER JOIN probability AS lctop_p\n    ON lctop_p.oid = o.oid\n    AND lctop_p.classifier_name = 'lc_classifier_top'\n    AND lctop_p.class_name = 'Transient'\n    AND lctop_p.probability > 0.9\n    AND lctop_p.ranking = 1\nWHERE o.ndet > 10\nORDER BY stamp_p.oid\nLIMIT 30;\n```"
                },
                "in_toks": 2521,
                "out_toks": 2598,
                "id": "chatcmpl-CSxl1BwuEJU3ifNtCQYXyYBGSSoxK",
                "created": 1761018927,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "106",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "step"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'step']"
                },
                "in_toks": 727,
                "out_toks": 1942,
                "id": "chatcmpl-CZNMMVbSQWusJSuokroZjfB8oTRhX",
                "created": 1762547310,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1321,
                "out_toks": 1935,
                "id": "chatcmpl-CZYmOdn59B8QR2IwAE90joDqtthNv",
                "created": 1762591208,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 2928,
                "out_toks": 4000,
                "id": "chatcmpl-CZaGpyY2Ys76xlRUhegSVwNfQrTvI",
                "created": 1762596939,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* Find up to 30 ZTF objects with ndet > 10, high bogus prob in stamp_classifier v1.0.4,\n   and high Transient prob in lc_classifier_top. Return requested columns and order by oid. */\nWITH lc_top AS (\n    SELECT\n        oid,\n        MAX(probability) AS prob_lc_transient\n    FROM probability\n    WHERE class_name = 'Transient'\n      AND classifier_name = 'lc_classifier_top'\n      AND probability > 0.9\n    GROUP BY oid\n)\nSELECT\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    p_s.probability AS prob_stamp_bogus,\n    lc_top.prob_lc_transient\nFROM object o\nINNER JOIN probability p_s\n    ON p_s.oid = o.oid\n   AND p_s.class_name = 'bogus'\n   AND p_s.classifier_name = 'stamp_classifier'\n   AND p_s.classifier_version = 'stamp_classifier_1.0.4'\n   AND p_s.probability > 0.7\nINNER JOIN lc_top\n    ON lc_top.oid = o.oid\nWHERE o.ndet > 10\nORDER BY o.oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* Find up to 30 ZTF objects with ndet > 10, high bogus prob in stamp_classifier v1.0.4,\n   and high Transient prob in lc_classifier_top. Return requested columns and order by oid. */\nWITH lc_top AS (\n    SELECT\n        oid,\n        MAX(probability) AS prob_lc_transient\n    FROM probability\n    WHERE class_name = 'Transient'\n      AND classifier_name = 'lc_classifier_top'\n      AND probability > 0.9\n    GROUP BY oid\n)\nSELECT\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    p_s.probability AS prob_stamp_bogus,\n    lc_top.prob_lc_transient\nFROM object o\nINNER JOIN probability p_s\n    ON p_s.oid = o.oid\n   AND p_s.class_name = 'bogus'\n   AND p_s.classifier_name = 'stamp_classifier'\n   AND p_s.classifier_version = 'stamp_classifier_1.0.4'\n   AND p_s.probability > 0.7\nINNER JOIN lc_top\n    ON lc_top.oid = o.oid\nWHERE o.ndet > 10\nORDER BY o.oid\nLIMIT 30;\n```"
                },
                "in_toks": 3114,
                "out_toks": 2576,
                "id": "chatcmpl-CZaxxVUxxTmsQWNtkgkt4CRshSy95",
                "created": 1762599613,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "106",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']"
                },
                "in_toks": 727,
                "out_toks": 976,
                "id": "chatcmpl-CZNNEZ8SnuqlUE7SEso3bqfdVlGEk",
                "created": 1762547364,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1204,
                "out_toks": 719,
                "id": "chatcmpl-CZYnEUs49oCyMJO5RjGD9edcTHdsW",
                "created": 1762591260,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 2811,
                "out_toks": 4000,
                "id": "chatcmpl-CZaKfTxEUijVRO3pQWtWQYQvUI7KU",
                "created": 1762597177,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 30 ZTF objects with:\n-- - ndet > 10\n-- - stamp classifier (version 'stamp_classifier_1.0.4') bogus probability > 0.7 (ranking=1)\n-- - lc_classifier_top Transient probability > 0.9 (ranking=1)\n-- Return: oid, ndet, firstmjd, prob_stamp_bogus, prob_lc_transient\n-- Order by ZTF identifier (oid)\nSELECT DISTINCT ON (o.oid)\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    p_stamp.probability AS prob_stamp_bogus,\n    p_top.probability AS prob_lc_transient\nFROM object o\nINNER JOIN probability p_stamp\n    ON p_stamp.oid = o.oid\nINNER JOIN probability p_top\n    ON p_top.oid = o.oid\nWHERE\n    o.ndet > 10\n    AND p_stamp.classifier_name = 'stamp_classifier'\n    AND p_stamp.class_name = 'bogus'\n    AND p_stamp.classifier_version = 'stamp_classifier_1.0.4'\n    AND p_stamp.probability > 0.7\n    AND p_stamp.ranking = 1 -- default condition: use most likely class per classifier/version\n    AND p_top.classifier_name = 'lc_classifier_top'\n    AND p_top.class_name = 'Transient'\n    AND p_top.probability > 0.9\n    AND p_top.ranking = 1 -- default condition\nORDER BY\n    o.oid,               -- order by ZTF identifier\n    p_top.probability DESC\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 ZTF objects with:\n-- - ndet > 10\n-- - stamp classifier (version 'stamp_classifier_1.0.4') bogus probability > 0.7 (ranking=1)\n-- - lc_classifier_top Transient probability > 0.9 (ranking=1)\n-- Return: oid, ndet, firstmjd, prob_stamp_bogus, prob_lc_transient\n-- Order by ZTF identifier (oid)\nSELECT DISTINCT ON (o.oid)\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    p_stamp.probability AS prob_stamp_bogus,\n    p_top.probability AS prob_lc_transient\nFROM object o\nINNER JOIN probability p_stamp\n    ON p_stamp.oid = o.oid\nINNER JOIN probability p_top\n    ON p_top.oid = o.oid\nWHERE\n    o.ndet > 10\n    AND p_stamp.classifier_name = 'stamp_classifier'\n    AND p_stamp.class_name = 'bogus'\n    AND p_stamp.classifier_version = 'stamp_classifier_1.0.4'\n    AND p_stamp.probability > 0.7\n    AND p_stamp.ranking = 1 -- default condition: use most likely class per classifier/version\n    AND p_top.classifier_name = 'lc_classifier_top'\n    AND p_top.class_name = 'Transient'\n    AND p_top.probability > 0.9\n    AND p_top.ranking = 1 -- default condition\nORDER BY\n    o.oid,               -- order by ZTF identifier\n    p_top.probability DESC\nLIMIT 30;\n```"
                },
                "in_toks": 3114,
                "out_toks": 3369,
                "id": "chatcmpl-CZayrUEz0c8mdul35EakD1mYB8H08",
                "created": 1762599669,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "106",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "probability"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability']"
                },
                "in_toks": 727,
                "out_toks": 528,
                "id": "chatcmpl-CZNNmIhEtxKMLA5VNeeRh8SOnVfW4",
                "created": 1762547398,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1204,
                "out_toks": 1231,
                "id": "chatcmpl-CZYnST9ZWGKbB4KcsV9mas4JaKlG4",
                "created": 1762591274,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 2811,
                "out_toks": 4000,
                "id": "chatcmpl-CZaQLCPo3zIUHsY0Vyjf8umLXIxtd",
                "created": 1762597529,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Find up to 30 ZTF objects with >10 detections, bogus prob > 0.7 (stamp_classifier_1.0.4),\n-- and Transient prob > 0.9 (lc_classifier_top). Return requested columns and order by object oid.\nWITH plct AS (\n    SELECT\n        p.oid,\n        MAX(p.probability) AS probability\n    FROM probability p\n    WHERE p.classifier_name = 'lc_classifier_top'\n      AND p.class_name = 'Transient'\n    GROUP BY p.oid\n    HAVING MAX(p.probability) > 0.9\n),\nps AS (\n    SELECT\n        p.oid,\n        p.probability\n    FROM probability p\n    WHERE p.classifier_name = 'stamp_classifier'\n      AND p.classifier_version = 'stamp_classifier_1.0.4'\n      AND p.class_name = 'bogus'\n      AND p.probability > 0.7\n)\nSELECT\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    ps.probability AS prob_stamp_bogus,\n    plct.probability AS prob_lc_transient\nFROM object o\nINNER JOIN ps ON ps.oid = o.oid\nINNER JOIN plct ON plct.oid = o.oid\nWHERE o.ndet > 10\nORDER BY o.oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 ZTF objects with >10 detections, bogus prob > 0.7 (stamp_classifier_1.0.4),\n-- and Transient prob > 0.9 (lc_classifier_top). Return requested columns and order by object oid.\nWITH plct AS (\n    SELECT\n        p.oid,\n        MAX(p.probability) AS probability\n    FROM probability p\n    WHERE p.classifier_name = 'lc_classifier_top'\n      AND p.class_name = 'Transient'\n    GROUP BY p.oid\n    HAVING MAX(p.probability) > 0.9\n),\nps AS (\n    SELECT\n        p.oid,\n        p.probability\n    FROM probability p\n    WHERE p.classifier_name = 'stamp_classifier'\n      AND p.classifier_version = 'stamp_classifier_1.0.4'\n      AND p.class_name = 'bogus'\n      AND p.probability > 0.7\n)\nSELECT\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    ps.probability AS prob_stamp_bogus,\n    plct.probability AS prob_lc_transient\nFROM object o\nINNER JOIN ps ON ps.oid = o.oid\nINNER JOIN plct ON plct.oid = o.oid\nWHERE o.ndet > 10\nORDER BY o.oid\nLIMIT 30;\n```"
                },
                "in_toks": 3114,
                "out_toks": 2545,
                "id": "chatcmpl-CZawcEvVadJ8BmZLpBY99SZOCUJ84",
                "created": 1762599530,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "106",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 727,
                "out_toks": 723,
                "id": "chatcmpl-CZNNz6sUPPVOWTg1d3eMNRBsCg4SN",
                "created": 1762547411,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1249,
                "out_toks": 1679,
                "id": "chatcmpl-CZYno10qS6r387JC6huMu1FHzPUx1",
                "created": 1762591296,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 30 ZTF objects with >10 detections, bogus prob > 0.7 in stamp_classifier v1.0.4,\n-- and Transient prob > 0.9 in lc_classifier_top. Return requested columns and order by ZTF identifier.\nSELECT\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    p_stamp.probability AS prob_stamp_bogus,\n    p_lctop.probability AS prob_lc_transient\nFROM object AS o\nINNER JOIN probability AS p_stamp\n    ON p_stamp.oid = o.oid\n    AND p_stamp.classifier_name = 'stamp_classifier'\n    AND p_stamp.classifier_version = 'stamp_classifier_1.0.4'\n    AND p_stamp.class_name = 'bogus'\n    AND p_stamp.probability > 0.7\nINNER JOIN (\n    SELECT DISTINCT ON (oid) oid, probability\n    FROM probability\n    WHERE classifier_name = 'lc_classifier_top'\n      AND class_name = 'Transient'\n      AND probability > 0.9\n    ORDER BY oid, probability DESC\n) AS p_lctop\n    ON p_lctop.oid = o.oid\nWHERE o.ndet > 10\nORDER BY o.oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 ZTF objects with >10 detections, bogus prob > 0.7 in stamp_classifier v1.0.4,\n-- and Transient prob > 0.9 in lc_classifier_top. Return requested columns and order by ZTF identifier.\nSELECT\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    p_stamp.probability AS prob_stamp_bogus,\n    p_lctop.probability AS prob_lc_transient\nFROM object AS o\nINNER JOIN probability AS p_stamp\n    ON p_stamp.oid = o.oid\n    AND p_stamp.classifier_name = 'stamp_classifier'\n    AND p_stamp.classifier_version = 'stamp_classifier_1.0.4'\n    AND p_stamp.class_name = 'bogus'\n    AND p_stamp.probability > 0.7\nINNER JOIN (\n    SELECT DISTINCT ON (oid) oid, probability\n    FROM probability\n    WHERE classifier_name = 'lc_classifier_top'\n      AND class_name = 'Transient'\n      AND probability > 0.9\n    ORDER BY oid, probability DESC\n) AS p_lctop\n    ON p_lctop.oid = o.oid\nWHERE o.ndet > 10\nORDER BY o.oid\nLIMIT 30;\n```"
                },
                "in_toks": 2566,
                "out_toks": 3228,
                "id": "chatcmpl-CZZiVJhoCkX12w6NTwCCNQduEffOK",
                "created": 1762594811,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "106",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy']"
                },
                "in_toks": 727,
                "out_toks": 1299,
                "id": "chatcmpl-CZNOV1qVjoUWfx1JpzYLzY98cOz5c",
                "created": 1762547443,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1249,
                "out_toks": 1615,
                "id": "chatcmpl-CZYoHQwN2VlfL4brJpcRz6pGeyRTM",
                "created": 1762591325,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Find up to 30 ZTF objects with ndet > 10, bogus prob > 0.7 in stamp_classifier_1.0.4 (ranking=1),\n-- and Transient prob > 0.9 in lc_classifier_top (ranking=1).\n-- Return requested columns and order by the ZTF identifier.\nSELECT\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    p_stamp.probability AS prob_stamp_bogus,\n    p_lc_top.probability AS prob_lc_transient\nFROM object o\nINNER JOIN probability p_stamp\n    ON p_stamp.oid = o.oid\n    AND p_stamp.classifier_name = 'stamp_classifier'\n    AND p_stamp.classifier_version = 'stamp_classifier_1.0.4'\n    AND p_stamp.class_name = 'bogus'\n    AND p_stamp.ranking = 1\n    AND p_stamp.probability > 0.7\nINNER JOIN probability p_lc_top\n    ON p_lc_top.oid = o.oid\n    AND p_lc_top.classifier_name = 'lc_classifier_top'\n    AND p_lc_top.class_name = 'Transient'\n    AND p_lc_top.ranking = 1\n    AND p_lc_top.probability > 0.9\nWHERE o.ndet > 10\nORDER BY o.oid\nLIMIT 30;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Find up to 30 ZTF objects with ndet > 10, bogus prob > 0.7 in stamp_classifier_1.0.4 (ranking=1),\n-- and Transient prob > 0.9 in lc_classifier_top (ranking=1).\n-- Return requested columns and order by the ZTF identifier.\nSELECT\n    o.oid,\n    o.ndet,\n    o.firstmjd,\n    p_stamp.probability AS prob_stamp_bogus,\n    p_lc_top.probability AS prob_lc_transient\nFROM object o\nINNER JOIN probability p_stamp\n    ON p_stamp.oid = o.oid\n    AND p_stamp.classifier_name = 'stamp_classifier'\n    AND p_stamp.classifier_version = 'stamp_classifier_1.0.4'\n    AND p_stamp.class_name = 'bogus'\n    AND p_stamp.ranking = 1\n    AND p_stamp.probability > 0.7\nINNER JOIN probability p_lc_top\n    ON p_lc_top.oid = o.oid\n    AND p_lc_top.classifier_name = 'lc_classifier_top'\n    AND p_lc_top.class_name = 'Transient'\n    AND p_lc_top.ranking = 1\n    AND p_lc_top.probability > 0.9\nWHERE o.ndet > 10\nORDER BY o.oid\nLIMIT 30;\n```"
                },
                "in_toks": 2566,
                "out_toks": 1969,
                "id": "chatcmpl-CZZtpo886aXjKJZFFBzZbHojucE9n",
                "created": 1762595513,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "56": {
        "0": {
            "req_id": "56",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']",
                    "1": "['object', 'magstat']"
                },
                "in_toks": 692,
                "out_toks": 2656,
                "id": "chatcmpl-CSnc21PEm7VMBoRYgupyVxRcKLves",
                "created": 1760979930,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1533,
                "out_toks": 399,
                "id": "chatcmpl-CSnsG6dmTL59n47zJ8sb0usd0hBL7",
                "created": 1760980936,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects among the given ZTF IDs whose corrected light curve was not computed (corrected = FALSE)\nSELECT\n  oid,\n  ndet,\n  meanra,\n  meandec,\n  firstmjd,\n  lastmjd,\n  g_r_mean,\n  g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected = FALSE\nORDER BY firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects among the given ZTF IDs whose corrected light curve was not computed (corrected = FALSE)\nSELECT\n  oid,\n  ndet,\n  meanra,\n  meandec,\n  firstmjd,\n  lastmjd,\n  g_r_mean,\n  g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected = FALSE\nORDER BY firstmjd ASC;\n```"
                },
                "in_toks": 2851,
                "out_toks": 821,
                "id": "chatcmpl-CSqs3iX1eL784ZLwrtZplhx20Lw9C",
                "created": 1760992455,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "56",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']",
                    "1": "['object', 'magstat']"
                },
                "in_toks": 692,
                "out_toks": 2656,
                "id": "chatcmpl-CSnc21PEm7VMBoRYgupyVxRcKLves",
                "created": 1760979930,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1702,
                "out_toks": 207,
                "id": "chatcmpl-CSnsMJNHDcFXOZYd4CCSSvj7fQOWK",
                "created": 1760980942,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects with given ZTF identifiers whose corrected light curve was not computed\nSELECT\n    oid,\n    ndet,\n    meanra,\n    meandec,\n    firstmjd,\n    lastmjd,\n    g_r_mean,\n    g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected = FALSE\nORDER BY firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects with given ZTF identifiers whose corrected light curve was not computed\nSELECT\n    oid,\n    ndet,\n    meanra,\n    meandec,\n    firstmjd,\n    lastmjd,\n    g_r_mean,\n    g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected = FALSE\nORDER BY firstmjd ASC;\n```"
                },
                "in_toks": 3020,
                "out_toks": 751,
                "id": "chatcmpl-CSqscQFuLyCNJiNElbX0xZWEY8XR6",
                "created": 1760992490,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "56",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'magstat']"
                },
                "in_toks": 692,
                "out_toks": 1040,
                "id": "chatcmpl-CSste7suRweqzWQyy8wfkz9Ob121G",
                "created": 1761000242,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1702,
                "out_toks": 143,
                "id": "chatcmpl-CSxdwFf4n4wYRL7j58e7yhhDasj28",
                "created": 1761018488,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return selected columns for the specified ZTF objects whose corrected light curve was not computed\nSELECT\n    oid,\n    ndet,\n    meanra,\n    meandec,\n    firstmjd,\n    lastmjd,\n    g_r_mean,\n    g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected = FALSE\nORDER BY firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return selected columns for the specified ZTF objects whose corrected light curve was not computed\nSELECT\n    oid,\n    ndet,\n    meanra,\n    meandec,\n    firstmjd,\n    lastmjd,\n    g_r_mean,\n    g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected = FALSE\nORDER BY firstmjd ASC;\n```"
                },
                "in_toks": 3020,
                "out_toks": 1074,
                "id": "chatcmpl-CSxlLC2R5i5esVf1hLsFmwQEfEBHR",
                "created": 1761018947,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "56",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "magstat",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'magstat', 'detection']"
                },
                "in_toks": 692,
                "out_toks": 1236,
                "id": "chatcmpl-CSstsDDZxxSdQvwGH0yAmxYHWudpT",
                "created": 1761000256,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 2250,
                "out_toks": 335,
                "id": "chatcmpl-CSxdy982PocAifBP8dCld5G4ZucnD",
                "created": 1761018490,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects among the provided ZTF IDs where the corrected light curve was not computed\nSELECT\n  oid,\n  ndet,\n  meanra,\n  meandec,\n  firstmjd,\n  lastmjd,\n  g_r_mean,\n  g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected IS NOT TRUE\nORDER BY firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects among the provided ZTF IDs where the corrected light curve was not computed\nSELECT\n  oid,\n  ndet,\n  meanra,\n  meandec,\n  firstmjd,\n  lastmjd,\n  g_r_mean,\n  g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected IS NOT TRUE\nORDER BY firstmjd ASC;\n```"
                },
                "in_toks": 3568,
                "out_toks": 1010,
                "id": "chatcmpl-CSxlaAwagcpIsAIDrsRZKW3o4rc8j",
                "created": 1761018962,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "56",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 692,
                "out_toks": 1616,
                "id": "chatcmpl-CSsuBxUVgTkCwo3J5ogNpWm9YJBBb",
                "created": 1761000275,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1533,
                "out_toks": 463,
                "id": "chatcmpl-CSxe2K5E3k1KjMJGTWHIXn0OMhUWv",
                "created": 1761018494,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects among the given ZTF oids where the corrected light curve was not computed (object.corrected = FALSE)\nSELECT\n    oid,\n    ndet,\n    meanra,\n    meandec,\n    firstmjd,\n    lastmjd,\n    g_r_mean,\n    g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected = FALSE\nORDER BY firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects among the given ZTF oids where the corrected light curve was not computed (object.corrected = FALSE)\nSELECT\n    oid,\n    ndet,\n    meanra,\n    meandec,\n    firstmjd,\n    lastmjd,\n    g_r_mean,\n    g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected = FALSE\nORDER BY firstmjd ASC;\n```"
                },
                "in_toks": 2851,
                "out_toks": 952,
                "id": "chatcmpl-CSxls8K4WxRXNGY9VlBB9QeRllmqz",
                "created": 1761018980,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "56",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'magstat']"
                },
                "in_toks": 692,
                "out_toks": 1680,
                "id": "chatcmpl-CZNP6wkind1SXCXtGXJasisH6TiBF",
                "created": 1762547480,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1702,
                "out_toks": 271,
                "id": "chatcmpl-CZYociVjHVl1wgD90CI8tXoq5pDt1",
                "created": 1762591346,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return selected columns for specified ZTF objects where the corrected light curve was not computed\nSELECT\n    oid,\n    ndet,\n    meanra,\n    meandec,\n    firstmjd,\n    lastmjd,\n    g_r_mean,\n    g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND (corrected = FALSE OR corrected IS NULL) -- corrected light curve not computed\nORDER BY firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return selected columns for specified ZTF objects where the corrected light curve was not computed\nSELECT\n    oid,\n    ndet,\n    meanra,\n    meandec,\n    firstmjd,\n    lastmjd,\n    g_r_mean,\n    g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND (corrected = FALSE OR corrected IS NULL) -- corrected light curve not computed\nORDER BY firstmjd ASC;\n```"
                },
                "in_toks": 3020,
                "out_toks": 959,
                "id": "chatcmpl-CZZzKSVHj7YbTvP4gkRYS1GTgdZVg",
                "created": 1762595854,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "56",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "magstat"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'magstat']"
                },
                "in_toks": 692,
                "out_toks": 1232,
                "id": "chatcmpl-CZNPhYonxth2NQmC05HixM65zNrFi",
                "created": 1762547517,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1702,
                "out_toks": 271,
                "id": "chatcmpl-CZYoiPokpuClaedIvhy9zTuxRsOqI",
                "created": 1762591352,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return selected columns from 'object' for specific ZTF oids where corrected light curve was not computed\nSELECT\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd,\n    o.lastmjd,\n    o.g_r_mean,\n    o.g_r_mean_corr\nFROM object AS o\nWHERE o.oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND (o.corrected IS FALSE OR o.corrected IS NULL)\nORDER BY o.firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return selected columns from 'object' for specific ZTF oids where corrected light curve was not computed\nSELECT\n    o.oid,\n    o.ndet,\n    o.meanra,\n    o.meandec,\n    o.firstmjd,\n    o.lastmjd,\n    o.g_r_mean,\n    o.g_r_mean_corr\nFROM object AS o\nWHERE o.oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND (o.corrected IS FALSE OR o.corrected IS NULL)\nORDER BY o.firstmjd ASC;\n```"
                },
                "in_toks": 3020,
                "out_toks": 1101,
                "id": "chatcmpl-CZa46dDGkNGCpdZ8bwqfwf1GWMYDi",
                "created": 1762596150,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "56",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 692,
                "out_toks": 1232,
                "id": "chatcmpl-CZNQ7ImzwbdN4j6nNIic2WQyAvp3g",
                "created": 1762547543,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1533,
                "out_toks": 207,
                "id": "chatcmpl-CZYonxIKSqKs1qyeczUHhrBXsOgc4",
                "created": 1762591357,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Select specified ZTF objects where the corrected light curve was not computed\nSELECT\n    oid,\n    ndet,\n    meanra,\n    meandec,\n    firstmjd,\n    lastmjd,\n    g_r_mean,\n    g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected IS NOT TRUE  -- include false or NULL as \"not computed\"\nORDER BY firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Select specified ZTF objects where the corrected light curve was not computed\nSELECT\n    oid,\n    ndet,\n    meanra,\n    meandec,\n    firstmjd,\n    lastmjd,\n    g_r_mean,\n    g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected IS NOT TRUE  -- include false or NULL as \"not computed\"\nORDER BY firstmjd ASC;\n```"
                },
                "in_toks": 2851,
                "out_toks": 1082,
                "id": "chatcmpl-CZa8DBYHf3zXUtTJcUj1vSN2inrue",
                "created": 1762596405,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "56",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 692,
                "out_toks": 1360,
                "id": "chatcmpl-CZNQbTxThLqZ8qm5IpYAxJGRV680L",
                "created": 1762547573,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1533,
                "out_toks": 271,
                "id": "chatcmpl-CZYoro49qvfdCV5jWqUsDyIVfRqVR",
                "created": 1762591361,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Objects among the specified ZTF IDs where the corrected light curve was not computed\nSELECT\n  oid,\n  ndet,\n  meanra,\n  meandec,\n  firstmjd,\n  lastmjd,\n  g_r_mean,\n  g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected = FALSE\nORDER BY firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Objects among the specified ZTF IDs where the corrected light curve was not computed\nSELECT\n  oid,\n  ndet,\n  meanra,\n  meandec,\n  firstmjd,\n  lastmjd,\n  g_r_mean,\n  g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected = FALSE\nORDER BY firstmjd ASC;\n```"
                },
                "in_toks": 2851,
                "out_toks": 881,
                "id": "chatcmpl-CZaCUDKW6YGDbMyybC7Vqv2pKYREm",
                "created": 1762596670,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "56",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 692,
                "out_toks": 1808,
                "id": "chatcmpl-CZNR43AcCs8M41WFp89xlxWyaChxL",
                "created": 1762547602,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1533,
                "out_toks": 271,
                "id": "chatcmpl-CZYoweUGjA6kuTljxnxhdCvBY87qZ",
                "created": 1762591366,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Select specified ZTF objects where the corrected light curve was not computed\n-- Return: oid, ndet, meanra, meandec, firstmjd, lastmjd, g_r_mean, g_r_mean_corr\n-- Sort by first detection date (firstmjd)\nSELECT\n  oid,\n  ndet,\n  meanra,\n  meandec,\n  firstmjd,\n  lastmjd,\n  g_r_mean,\n  g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected IS NOT TRUE\nORDER BY firstmjd ASC;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Select specified ZTF objects where the corrected light curve was not computed\n-- Return: oid, ndet, meanra, meandec, firstmjd, lastmjd, g_r_mean, g_r_mean_corr\n-- Sort by first detection date (firstmjd)\nSELECT\n  oid,\n  ndet,\n  meanra,\n  meandec,\n  firstmjd,\n  lastmjd,\n  g_r_mean,\n  g_r_mean_corr\nFROM object\nWHERE oid IN ('ZTF20abywydb', 'ZTF20abzpxxu', 'ZTF20acduffd')\n  AND corrected IS NOT TRUE\nORDER BY firstmjd ASC;\n```"
                },
                "in_toks": 2851,
                "out_toks": 1371,
                "id": "chatcmpl-CZaGqywiw4Wghfybb6PYX7etkhzEM",
                "created": 1762596940,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "48": {
        "0": {
            "req_id": "48",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'feature', 'feature_version']",
                    "1": "['object', 'feature', 'feature_version']"
                },
                "in_toks": 632,
                "out_toks": 1126,
                "id": "chatcmpl-CSncRleWl58KorEugX1sijfN6nlAi",
                "created": 1760979955,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 3408,
                "out_toks": 271,
                "id": "chatcmpl-CSnsQBHBc7JCgjk5U6ShosDKtyS5B",
                "created": 1760980946,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get all features for a single ZTF object, returning the requested columns\nSELECT\n    f.oid,        -- ZTF identifier\n    f.name,       -- feature name\n    f.value,      -- feature value\n    f.fid,        -- filter identifier (1:g, 2:r, 3:i, 12:gr, 13:gi, 23:ri, 123:gri)\n    f.version     -- feature version\nFROM feature f\nWHERE f.oid = 'ZTF18abqyaix'\nORDER BY f.oid, f.fid, f.version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all features for a single ZTF object, returning the requested columns\nSELECT\n    f.oid,        -- ZTF identifier\n    f.name,       -- feature name\n    f.value,      -- feature value\n    f.fid,        -- filter identifier (1:g, 2:r, 3:i, 12:gr, 13:gi, 23:ri, 123:gri)\n    f.version     -- feature version\nFROM feature f\nWHERE f.oid = 'ZTF18abqyaix'\nORDER BY f.oid, f.fid, f.version;\n```"
                },
                "in_toks": 4725,
                "out_toks": 780,
                "id": "chatcmpl-CSqsAbylSeBnae1cpjEYVdf0PStsm",
                "created": 1760992462,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "48",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'feature', 'feature_version']",
                    "1": "['object', 'feature', 'feature_version']"
                },
                "in_toks": 632,
                "out_toks": 1126,
                "id": "chatcmpl-CSncRleWl58KorEugX1sijfN6nlAi",
                "created": 1760979955,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 3408,
                "out_toks": 271,
                "id": "chatcmpl-CSnsXh6zJ3kRHMBlpCWDKyDoJJNVQ",
                "created": 1760980953,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get all features for a specific ZTF object with requested columns and sorting\nSELECT\n    f.oid,\n    f.name,\n    f.value,\n    f.fid,\n    f.version\nFROM feature AS f\nWHERE f.oid = 'ZTF18abqyaix'\nORDER BY f.oid, f.fid, f.version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all features for a specific ZTF object with requested columns and sorting\nSELECT\n    f.oid,\n    f.name,\n    f.value,\n    f.fid,\n    f.version\nFROM feature AS f\nWHERE f.oid = 'ZTF18abqyaix'\nORDER BY f.oid, f.fid, f.version;\n```"
                },
                "in_toks": 4725,
                "out_toks": 661,
                "id": "chatcmpl-CSqskRLr0wFdDortpddBg8jOnojUY",
                "created": 1760992498,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "48",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'feature', 'feature_version']"
                },
                "in_toks": 632,
                "out_toks": 595,
                "id": "chatcmpl-CSsunYQxKMErFugZerDcAFwqFI7bw",
                "created": 1761000313,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 3408,
                "out_toks": 591,
                "id": "chatcmpl-CSxe7j0ZAMFSBtq1UOEfBJsrHVLeO",
                "created": 1761018499,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get all features for the specified ZTF object with requested columns\nSELECT\n    f.oid,\n    f.name,\n    f.value,\n    f.fid,\n    f.version\nFROM feature AS f\nWHERE f.oid = 'ZTF18abqyaix'\nORDER BY f.oid, f.fid, f.version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all features for the specified ZTF object with requested columns\nSELECT\n    f.oid,\n    f.name,\n    f.value,\n    f.fid,\n    f.version\nFROM feature AS f\nWHERE f.oid = 'ZTF18abqyaix'\nORDER BY f.oid, f.fid, f.version;\n```"
                },
                "in_toks": 4725,
                "out_toks": 723,
                "id": "chatcmpl-CSxm4PQ4CYudZIMYtIUWYW5dPR05B",
                "created": 1761018992,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "48",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'feature', 'feature_version']"
                },
                "in_toks": 632,
                "out_toks": 467,
                "id": "chatcmpl-CSsuy78kbuFDzWWtRGTz1pt77ZEz6",
                "created": 1761000324,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 3408,
                "out_toks": 207,
                "id": "chatcmpl-CSxeICPweftv0nhqREvphDlwAjJNn",
                "created": 1761018510,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get all features for the specified ZTF object with requested columns and sorting\nSELECT\n    f.oid,\n    f.name,\n    f.value,\n    f.fid,\n    f.version\nFROM feature f\nWHERE f.oid = 'ZTF18abqyaix'\nORDER BY f.oid, f.fid, f.version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all features for the specified ZTF object with requested columns and sorting\nSELECT\n    f.oid,\n    f.name,\n    f.value,\n    f.fid,\n    f.version\nFROM feature f\nWHERE f.oid = 'ZTF18abqyaix'\nORDER BY f.oid, f.fid, f.version;\n```"
                },
                "in_toks": 4725,
                "out_toks": 788,
                "id": "chatcmpl-CSxmJZYlDr7LowjaqcB9A4eZZ5CXB",
                "created": 1761019007,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "48",
            "experiment_id": "run_4",
            "pred_tables": [
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['feature', 'feature_version']"
                },
                "in_toks": 632,
                "out_toks": 1104,
                "id": "chatcmpl-CSsv8UJPIGVZEnZgNvInQeM7JXtWw",
                "created": 1761000334,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 2926,
                "out_toks": 335,
                "id": "chatcmpl-CSxeLyd95RuIZhkN1GEORiRo9kK1H",
                "created": 1761018513,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get all features for the specified ZTF object with requested columns and sorting\nSELECT\n    oid,       -- ZTF identifier\n    name,      -- feature name\n    value,     -- feature value\n    fid,       -- filter identifier\n    version    -- feature version\nFROM feature\nWHERE oid = 'ZTF18abqyaix'\nORDER BY oid, fid, version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all features for the specified ZTF object with requested columns and sorting\nSELECT\n    oid,       -- ZTF identifier\n    name,      -- feature name\n    value,     -- feature value\n    fid,       -- filter identifier\n    version    -- feature version\nFROM feature\nWHERE oid = 'ZTF18abqyaix'\nORDER BY oid, fid, version;\n```"
                },
                "in_toks": 4243,
                "out_toks": 734,
                "id": "chatcmpl-CSxmYENjWH2eYzeOSa4TE55QOBzqX",
                "created": 1761019022,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "48",
            "experiment_id": "run_5",
            "pred_tables": [
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['feature', 'feature_version']"
                },
                "in_toks": 632,
                "out_toks": 912,
                "id": "chatcmpl-CZNRc3yHVxEwsnCqZsUPwcbk7i1Fi",
                "created": 1762547636,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 2926,
                "out_toks": 207,
                "id": "chatcmpl-CZYp1zxgY8rpP2Q4WvtTuRFrSbaET",
                "created": 1762591371,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get all features for the specified ZTF object with requested columns and sorting\nSELECT\n    oid,\n    name,\n    value,\n    fid,\n    version\nFROM feature\nWHERE oid = 'ZTF18abqyaix'\nORDER BY oid, fid, version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all features for the specified ZTF object with requested columns and sorting\nSELECT\n    oid,\n    name,\n    value,\n    fid,\n    version\nFROM feature\nWHERE oid = 'ZTF18abqyaix'\nORDER BY oid, fid, version;\n```"
                },
                "in_toks": 4243,
                "out_toks": 517,
                "id": "chatcmpl-CZaHLAQZy6QtgeTC3ajdBOlvj2WLn",
                "created": 1762596971,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "48",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'feature', 'feature_version']"
                },
                "in_toks": 632,
                "out_toks": 531,
                "id": "chatcmpl-CZNSV2DcIVwjdnRNeIzPC87xp9u0q",
                "created": 1762547691,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 3408,
                "out_toks": 207,
                "id": "chatcmpl-CZYp7vBTCU8bUAyU9vpa16iMeNrtd",
                "created": 1762591377,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All features for the specified ZTF object\nSELECT\n    oid,         -- ZTF identifier\n    name,        -- feature name\n    value,       -- feature value\n    fid,         -- filter identifier\n    version      -- feature version\nFROM feature\nWHERE oid = 'ZTF18abqyaix'\nORDER BY oid, fid, version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All features for the specified ZTF object\nSELECT\n    oid,         -- ZTF identifier\n    name,        -- feature name\n    value,       -- feature value\n    fid,         -- filter identifier\n    version      -- feature version\nFROM feature\nWHERE oid = 'ZTF18abqyaix'\nORDER BY oid, fid, version;\n```"
                },
                "in_toks": 4725,
                "out_toks": 984,
                "id": "chatcmpl-CZZizfuElq2pMGm30puw0wHcH9bmV",
                "created": 1762594841,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "48",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'feature', 'feature_version']"
                },
                "in_toks": 632,
                "out_toks": 467,
                "id": "chatcmpl-CZNSkYkQ6QRPnxKQAu43mKTAzbGdV",
                "created": 1762547706,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 3408,
                "out_toks": 335,
                "id": "chatcmpl-CZYpAnLfTDm8CJEfYGqSGlmZZmPNE",
                "created": 1762591380,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All features for the specified ZTF object with requested columns and sorting\nSELECT\n    oid,           -- ZTF identifier\n    name,          -- feature name\n    value,         -- feature value\n    fid,           -- filter identifier\n    version        -- feature version\nFROM feature\nWHERE oid = 'ZTF18abqyaix'\nORDER BY oid, fid, version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All features for the specified ZTF object with requested columns and sorting\nSELECT\n    oid,           -- ZTF identifier\n    name,          -- feature name\n    value,         -- feature value\n    fid,           -- filter identifier\n    version        -- feature version\nFROM feature\nWHERE oid = 'ZTF18abqyaix'\nORDER BY oid, fid, version;\n```"
                },
                "in_toks": 4725,
                "out_toks": 605,
                "id": "chatcmpl-CZaQhWaWzMj4PZIYn6lAZZGWB5mpp",
                "created": 1762597551,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "48",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'feature', 'feature_version']"
                },
                "in_toks": 632,
                "out_toks": 467,
                "id": "chatcmpl-CZNT2MGTLxzkBW8Yu7Q6WsdtR36pF",
                "created": 1762547724,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 3408,
                "out_toks": 271,
                "id": "chatcmpl-CZYpGzVIguFIvPZVWJA9sJWmxHeVs",
                "created": 1762591386,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get all features for a specific ZTF object, returning requested columns and ordering\nSELECT\n    oid,          -- ZTF identifier\n    name,         -- feature name\n    value,        -- feature value\n    fid,          -- filter identifier\n    version       -- feature version\nFROM feature\nWHERE oid = 'ZTF18abqyaix'\nORDER BY oid, fid, version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get all features for a specific ZTF object, returning requested columns and ordering\nSELECT\n    oid,          -- ZTF identifier\n    name,         -- feature name\n    value,        -- feature value\n    fid,          -- filter identifier\n    version       -- feature version\nFROM feature\nWHERE oid = 'ZTF18abqyaix'\nORDER BY oid, fid, version;\n```"
                },
                "in_toks": 4725,
                "out_toks": 543,
                "id": "chatcmpl-CZaQuEsJfsBUmyDDCa2w04z8sJaL3",
                "created": 1762597564,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "48",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "feature",
                "feature_version"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'feature', 'feature_version']"
                },
                "in_toks": 632,
                "out_toks": 275,
                "id": "chatcmpl-CZNTHLCm8HsCvYZNkUrjfrARqQEnO",
                "created": 1762547739,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 3408,
                "out_toks": 207,
                "id": "chatcmpl-CZYpMgOw3T8i8cIR1SUyzDZB7zLWA",
                "created": 1762591392,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- All features for the specified ZTF object with requested columns and sorting\nSELECT\n    oid,\n    name,\n    value,\n    fid,\n    version\nFROM feature\nWHERE oid = 'ZTF18abqyaix'\nORDER BY oid, fid, version;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- All features for the specified ZTF object with requested columns and sorting\nSELECT\n    oid,\n    name,\n    value,\n    fid,\n    version\nFROM feature\nWHERE oid = 'ZTF18abqyaix'\nORDER BY oid, fid, version;\n```"
                },
                "in_toks": 4725,
                "out_toks": 708,
                "id": "chatcmpl-CZZy6A1Aa62vp4xwYuSVN5WDo2Ujc",
                "created": 1762595778,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "58": {
        "0": {
            "req_id": "58",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']",
                    "1": "['object', 'detection']"
                },
                "in_toks": 649,
                "out_toks": 1504,
                "id": "chatcmpl-CSncao6dsm7TwOTLwsVybJz6Gnsxz",
                "created": 1760979964,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Prefilter objects to reduce the detection scan (uses indexed join on detection.oid)\nWITH fo AS\n  (SELECT oid\n   FROM OBJECT\n   WHERE ndet >= 30 -- minimum number of detections\n\n     AND deltajd > 20 -- last - first detection time > 20 days\n), -- Compute per-oid minimum corrected magnitudes in g (fid=1) and r (fid=2)\n-- only for the prefiltered oids to avoid a full detection table aggregation\nmins AS\n  (SELECT d.oid,\n          MIN(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 1\n                                       AND d.corrected) AS min_g_corr,\n          MIN(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 2\n                                       AND d.corrected) AS min_r_corr\n   FROM detection d\n   JOIN fo ON fo.oid = d.oid\n   GROUP BY d.oid) -- Return all columns from object for up to 20 matching objects\n\nSELECT o.*\nFROM OBJECT o\nJOIN mins m ON m.oid = o.oid\nWHERE o.ndet >= 30\n  AND o.deltajd > 20\n  AND m.min_g_corr IS NOT NULL\n  AND m.min_r_corr IS NOT NULL\n  AND (m.min_g_corr - m.min_r_corr) > 3.5\nLIMIT 20;",
            "sql_response": {
                "responses": {
                    "0": "-- Prefilter objects to reduce the detection scan (uses indexed join on detection.oid)\nWITH fo AS\n  (SELECT oid\n   FROM OBJECT\n   WHERE ndet >= 30 -- minimum number of detections\n\n     AND deltajd > 20 -- last - first detection time > 20 days\n), -- Compute per-oid minimum corrected magnitudes in g (fid=1) and r (fid=2)\n-- only for the prefiltered oids to avoid a full detection table aggregation\nmins AS\n  (SELECT d.oid,\n          MIN(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 1\n                                       AND d.corrected) AS min_g_corr,\n          MIN(d.magpsf_corr) FILTER (\n                                     WHERE d.fid = 2\n                                       AND d.corrected) AS min_r_corr\n   FROM detection d\n   JOIN fo ON fo.oid = d.oid\n   GROUP BY d.oid) -- Return all columns from object for up to 20 matching objects\n\nSELECT o.*\nFROM OBJECT o\nJOIN mins m ON m.oid = o.oid\nWHERE o.ndet >= 30\n  AND o.deltajd > 20\n  AND m.min_g_corr IS NOT NULL\n  AND m.min_r_corr IS NOT NULL\n  AND (m.min_g_corr - m.min_r_corr) > 3.5\nLIMIT 20;"
                },
                "in_toks": 2143,
                "out_toks": 2987,
                "id": "chatcmpl-CbHW6kez7CxJmEuf54fzOrtpaOQ1Q",
                "created": 1763001506,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1490,
                "out_toks": 1423,
                "id": "chatcmpl-CSnsbrFKeABHwzH9aZwWPS0ejXQaz",
                "created": 1760980957,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Parse the user requirements into concrete database constraints\n- Return: at most 20 rows; include all columns from the object table.\n- Filters on object-level properties:\n  - Minimum number of detections: object.ndet >= 30.\n  - Time span between last and first detection > 20 days: use object.deltajd > 20 (this field already encodes lastmjd - firstmjd).\n- Filters requiring light-curve (per-band) information:\n  - \u201cdifference between minimum g- and r-band corrected magnitudes larger than 3.5\u201d\n  - Use detection.magpsf_corr (corrected magnitude) per band:\n    - g band: detection.fid = 1\n    - r band: detection.fid = 2\n  - Compute per-object minima for each band and require min_g_corr - min_r_corr > 3.5.\n  - Only consider corrected measurements; incorporate detection.corrected = true in the aggregation logic.\n\n2) Identify the tables and columns needed\n- object table (primary table to return results and apply object-level filters):\n  - Key: object.oid\n  - Columns to return: object.* (all columns)\n  - Columns for filters: object.ndet, object.deltajd\n- detection table (to derive per-object minima of corrected magnitudes by band):\n  - Key/Join: detection.oid (foreign key to object.oid)\n  - Columns for aggregation: detection.magpsf_corr, detection.fid, detection.corrected\n\n3) Design a subquery over detection to compute per-object corrected magnitude minima by band\n- Build an aggregated subquery producing one row per detection.oid with:\n  - min_g_corr = MIN(CASE WHEN detection.fid = 1 AND detection.corrected = TRUE THEN detection.magpsf_corr END)\n  - min_r_corr = MIN(CASE WHEN detection.fid = 2 AND detection.corrected = TRUE THEN detection.magpsf_corr END)\n- GROUP BY detection.oid.\n- Ensure both bands are present for an object:\n  - Either in the subquery via HAVING conditions (min_g_corr IS NOT NULL AND min_r_corr IS NOT NULL), or apply equivalent filtering after joining.\n- Note on performance guideline: to respect \u201cavoid doing filters on detection in any parameter other than oid,\u201d avoid WHERE clauses on detection.fid or detection.corrected; implement band selection via CASE inside MIN() and filter only at the aggregated level (HAVING or post-join WHERE). This uses the ix_ndetection_oid index efficiently.\n\n4) Join the detection subquery with the object table\n- INNER JOIN object o ON o.oid = dmin.oid, where dmin is the alias of the aggregated detection subquery.\n- This restricts to objects that have valid minima in both bands.\n\n5) Apply object-level filters\n- o.ndet >= 30 (uses ix_object_ndet).\n- o.deltajd > 20 (encodes last-first detection time difference; alternative is (o.lastmjd - o.firstmjd) > 20, but deltajd is explicit).\n\n6) Apply the magnitude difference constraint\n- (dmin.min_g_corr - dmin.min_r_corr) > 3.5\n- This implements \u201cdifference between minimum g- and r-band corrected magnitudes larger than 3.5\u201d with the sign convention g \u2212 r > 3.5.\n\n7) Select and limit the output\n- SELECT o.* (all columns from object).\n- LIMIT 20 to cap the number of returned objects.\n- Optional (not required by the user): add an ORDER BY clause if deterministic top-20 selection is desired, e.g., ORDER BY (dmin.min_g_corr - dmin.min_r_corr) DESC or by o.ndet DESC. If omitted, the 20 returned rows are arbitrary among matches.\n\n8) Index and performance considerations\n- The join is on detection.oid to object.oid; ix_ndetection_oid (hash on detection.oid) supports grouping and join.\n- The filter on o.ndet uses ix_object_ndet (btree).\n- deltajd is not indexed; if necessary, an index on deltajd could help, but not required for correctness.\n- Keeping detection filters inside CASE expressions avoids direct WHERE filters on detection columns, aligning with the guideline.\n\n9) Edge cases and correctness checks\n- Ensure that min_g_corr and min_r_corr are not NULL before applying the difference; enforce via HAVING in the subquery or via WHERE after join.\n- Only corrected measurements are used (detection.corrected = TRUE within the CASE logic).\n- No use of probability or spatial Q3C functions is needed for this request.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Parse the user requirements into concrete database constraints\n- Return: at most 20 rows; include all columns from the object table.\n- Filters on object-level properties:\n  - Minimum number of detections: object.ndet >= 30.\n  - Time span between last and first detection > 20 days: use object.deltajd > 20 (this field already encodes lastmjd - firstmjd).\n- Filters requiring light-curve (per-band) information:\n  - \u201cdifference between minimum g- and r-band corrected magnitudes larger than 3.5\u201d\n  - Use detection.magpsf_corr (corrected magnitude) per band:\n    - g band: detection.fid = 1\n    - r band: detection.fid = 2\n  - Compute per-object minima for each band and require min_g_corr - min_r_corr > 3.5.\n  - Only consider corrected measurements; incorporate detection.corrected = true in the aggregation logic.\n\n2) Identify the tables and columns needed\n- object table (primary table to return results and apply object-level filters):\n  - Key: object.oid\n  - Columns to return: object.* (all columns)\n  - Columns for filters: object.ndet, object.deltajd\n- detection table (to derive per-object minima of corrected magnitudes by band):\n  - Key/Join: detection.oid (foreign key to object.oid)\n  - Columns for aggregation: detection.magpsf_corr, detection.fid, detection.corrected\n\n3) Design a subquery over detection to compute per-object corrected magnitude minima by band\n- Build an aggregated subquery producing one row per detection.oid with:\n  - min_g_corr = MIN(CASE WHEN detection.fid = 1 AND detection.corrected = TRUE THEN detection.magpsf_corr END)\n  - min_r_corr = MIN(CASE WHEN detection.fid = 2 AND detection.corrected = TRUE THEN detection.magpsf_corr END)\n- GROUP BY detection.oid.\n- Ensure both bands are present for an object:\n  - Either in the subquery via HAVING conditions (min_g_corr IS NOT NULL AND min_r_corr IS NOT NULL), or apply equivalent filtering after joining.\n- Note on performance guideline: to respect \u201cavoid doing filters on detection in any parameter other than oid,\u201d avoid WHERE clauses on detection.fid or detection.corrected; implement band selection via CASE inside MIN() and filter only at the aggregated level (HAVING or post-join WHERE). This uses the ix_ndetection_oid index efficiently.\n\n4) Join the detection subquery with the object table\n- INNER JOIN object o ON o.oid = dmin.oid, where dmin is the alias of the aggregated detection subquery.\n- This restricts to objects that have valid minima in both bands.\n\n5) Apply object-level filters\n- o.ndet >= 30 (uses ix_object_ndet).\n- o.deltajd > 20 (encodes last-first detection time difference; alternative is (o.lastmjd - o.firstmjd) > 20, but deltajd is explicit).\n\n6) Apply the magnitude difference constraint\n- (dmin.min_g_corr - dmin.min_r_corr) > 3.5\n- This implements \u201cdifference between minimum g- and r-band corrected magnitudes larger than 3.5\u201d with the sign convention g \u2212 r > 3.5.\n\n7) Select and limit the output\n- SELECT o.* (all columns from object).\n- LIMIT 20 to cap the number of returned objects.\n- Optional (not required by the user): add an ORDER BY clause if deterministic top-20 selection is desired, e.g., ORDER BY (dmin.min_g_corr - dmin.min_r_corr) DESC or by o.ndet DESC. If omitted, the 20 returned rows are arbitrary among matches.\n\n8) Index and performance considerations\n- The join is on detection.oid to object.oid; ix_ndetection_oid (hash on detection.oid) supports grouping and join.\n- The filter on o.ndet uses ix_object_ndet (btree).\n- deltajd is not indexed; if necessary, an index on deltajd could help, but not required for correctness.\n- Keeping detection filters inside CASE expressions avoids direct WHERE filters on detection columns, aligning with the guideline.\n\n9) Edge cases and correctness checks\n- Ensure that min_g_corr and min_r_corr are not NULL before applying the difference; enforce via HAVING in the subquery or via WHERE after join.\n- Only corrected measurements are used (detection.corrected = TRUE within the CASE logic).\n- No use of probability or spatial Q3C functions is needed for this request."
                },
                "in_toks": 3098,
                "out_toks": 3549,
                "id": "chatcmpl-CSqsEJ2kf0lBCLX4oIsFdvGFfgGoR",
                "created": 1760992466,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get up to 20 ZTF objects with:\n-- - object.ndet >= 30\n-- - object.deltajd > 20 days\n-- - difference between minimum corrected g and r magnitudes (g - r) > 3.5\n-- Return all columns from the object table\nSELECT o.*\nFROM object AS o\nINNER JOIN (\n    SELECT\n        d.oid,\n        MIN(CASE WHEN d.fid = 1 AND d.corrected THEN d.magpsf_corr END) AS min_g_corr, -- g-band (fid=1)\n        MIN(CASE WHEN d.fid = 2 AND d.corrected THEN d.magpsf_corr END) AS min_r_corr  -- r-band (fid=2)\n    FROM detection AS d\n    GROUP BY d.oid\n    HAVING\n        MIN(CASE WHEN d.fid = 1 AND d.corrected THEN d.magpsf_corr END) IS NOT NULL\n        AND MIN(CASE WHEN d.fid = 2 AND d.corrected THEN d.magpsf_corr END) IS NOT NULL\n) AS dmin\n    ON o.oid = dmin.oid\nWHERE\n    o.ndet >= 30\n    AND o.deltajd > 20\n    AND (dmin.min_g_corr - dmin.min_r_corr) > 3.5\nLIMIT 20;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get up to 20 ZTF objects with:\n-- - object.ndet >= 30\n-- - object.deltajd > 20 days\n-- - difference between minimum corrected g and r magnitudes (g - r) > 3.5\n-- Return all columns from the object table\nSELECT o.*\nFROM object AS o\nINNER JOIN (\n    SELECT\n        d.oid,\n        MIN(CASE WHEN d.fid = 1 AND d.corrected THEN d.magpsf_corr END) AS min_g_corr, -- g-band (fid=1)\n        MIN(CASE WHEN d.fid = 2 AND d.corrected THEN d.magpsf_corr END) AS min_r_corr  -- r-band (fid=2)\n    FROM detection AS d\n    GROUP BY d.oid\n    HAVING\n        MIN(CASE WHEN d.fid = 1 AND d.corrected THEN d.magpsf_corr END) IS NOT NULL\n        AND MIN(CASE WHEN d.fid = 2 AND d.corrected THEN d.magpsf_corr END) IS NOT NULL\n) AS dmin\n    ON o.oid = dmin.oid\nWHERE\n    o.ndet >= 30\n    AND o.deltajd > 20\n    AND (dmin.min_g_corr - dmin.min_r_corr) > 3.5\nLIMIT 20;\n```"
                },
                "in_toks": 3035,
                "out_toks": 1389,
                "id": "chatcmpl-CSr6DMmieSKpummFRWN2OTDwdpzqs",
                "created": 1760993333,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "1": {
            "req_id": "58",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']",
                    "1": "['object', 'detection']"
                },
                "in_toks": 649,
                "out_toks": 1504,
                "id": "chatcmpl-CSncao6dsm7TwOTLwsVybJz6Gnsxz",
                "created": 1760979964,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1490,
                "out_toks": 975,
                "id": "chatcmpl-CSnsubPui39TmSIbBat3FRrueHgmY",
                "created": 1760980976,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the SQL query\n\n1) Identify the base table and required output\n- Base table: object (contains per-object, band-independent summary statistics).\n- Output: all columns from object (SELECT *).\n\n2) Map the user\u2019s scientific conditions to concrete columns\n- \u201cminimum number of detections of 30\u201d \u2192 object.ndet >= 30.\n  - Rationale: ndet is the total number of detections for the object.\n- \u201cdifference between minimum g- and r-band corrected magnitudes larger than 3.5\u201d \u2192 object.g_r_max_corr > 3.5.\n  - Rationale: g_r_max_corr is the \u201cg\u2212r color at maximum.\u201d Maximum brightness corresponds to minimum magnitude, so this column represents g(min) \u2212 r(min) using corrected magnitudes.\n  - Note: If g_r_max_corr is NULL, it should be excluded naturally by the > 3.5 condition (no need for extra IS NOT NULL unless you want to be explicit).\n- \u201cdifference between last and first detection times larger than 20 days\u201d \u2192 object.deltajd > 20.\n  - Rationale: deltajd is defined as the time difference between last and first detection (days).\n\n3) Filtering logic\n- Apply a single WHERE clause combining:\n  - ndet >= 30\n  - g_r_max_corr > 3.5\n  - deltajd > 20\n\n4) Projection\n- Select all columns from object, as requested.\n\n5) Limiting and optional ordering\n- Limit the number of returned rows to at most 20 using LIMIT 20.\n- No specific ordering is requested; omit ORDER BY to allow the planner freedom. If deterministic results are desired, add an ORDER BY on a relevant column (e.g., ndet DESC), but this is not required by the user.\n\n6) Joins and additional tables\n- No joins are needed. Do not use detection or probability tables for this request.\n- Do not apply default probability conditions (probability.ranking, classifier_name) because the probability table is not involved.\n\n7) Performance considerations and indexes\n- The filter on object.ndet can leverage the existing index ix_object_ndet.\n- There is no listed index on object.g_r_max_corr; the filter will be evaluated after ndet filtering. This is acceptable for correctness. If performance becomes critical, consider adding an index on g_r_max_corr in the database, but it\u2019s not part of the current query.\n- deltajd has no explicit index; it will be filtered post-ndet constraint.\n\n8) Spatial constraints\n- None requested; do not use Q3C functions.\n\n9) Assumptions and edge cases\n- Interpreting \u201cdifference between minimum g- and r-band corrected magnitudes\u201d as g_r_max_corr is consistent with the schema note that \u201cmaximum\u201d brightness corresponds to minimum magnitude.\n- If the user intended absolute difference, they would need to specify it; we use g_r_max_corr > 3.5 exactly as stated.\n\n10) Final assembly\n- FROM object\n- WHERE ndet >= 30 AND g_r_max_corr > 3.5 AND deltajd > 20\n- SELECT *\n- LIMIT 20",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the SQL query\n\n1) Identify the base table and required output\n- Base table: object (contains per-object, band-independent summary statistics).\n- Output: all columns from object (SELECT *).\n\n2) Map the user\u2019s scientific conditions to concrete columns\n- \u201cminimum number of detections of 30\u201d \u2192 object.ndet >= 30.\n  - Rationale: ndet is the total number of detections for the object.\n- \u201cdifference between minimum g- and r-band corrected magnitudes larger than 3.5\u201d \u2192 object.g_r_max_corr > 3.5.\n  - Rationale: g_r_max_corr is the \u201cg\u2212r color at maximum.\u201d Maximum brightness corresponds to minimum magnitude, so this column represents g(min) \u2212 r(min) using corrected magnitudes.\n  - Note: If g_r_max_corr is NULL, it should be excluded naturally by the > 3.5 condition (no need for extra IS NOT NULL unless you want to be explicit).\n- \u201cdifference between last and first detection times larger than 20 days\u201d \u2192 object.deltajd > 20.\n  - Rationale: deltajd is defined as the time difference between last and first detection (days).\n\n3) Filtering logic\n- Apply a single WHERE clause combining:\n  - ndet >= 30\n  - g_r_max_corr > 3.5\n  - deltajd > 20\n\n4) Projection\n- Select all columns from object, as requested.\n\n5) Limiting and optional ordering\n- Limit the number of returned rows to at most 20 using LIMIT 20.\n- No specific ordering is requested; omit ORDER BY to allow the planner freedom. If deterministic results are desired, add an ORDER BY on a relevant column (e.g., ndet DESC), but this is not required by the user.\n\n6) Joins and additional tables\n- No joins are needed. Do not use detection or probability tables for this request.\n- Do not apply default probability conditions (probability.ranking, classifier_name) because the probability table is not involved.\n\n7) Performance considerations and indexes\n- The filter on object.ndet can leverage the existing index ix_object_ndet.\n- There is no listed index on object.g_r_max_corr; the filter will be evaluated after ndet filtering. This is acceptable for correctness. If performance becomes critical, consider adding an index on g_r_max_corr in the database, but it\u2019s not part of the current query.\n- deltajd has no explicit index; it will be filtered post-ndet constraint.\n\n8) Spatial constraints\n- None requested; do not use Q3C functions.\n\n9) Assumptions and edge cases\n- Interpreting \u201cdifference between minimum g- and r-band corrected magnitudes\u201d as g_r_max_corr is consistent with the schema note that \u201cmaximum\u201d brightness corresponds to minimum magnitude.\n- If the user intended absolute difference, they would need to specify it; we use g_r_max_corr > 3.5 exactly as stated.\n\n10) Final assembly\n- FROM object\n- WHERE ndet >= 30 AND g_r_max_corr > 3.5 AND deltajd > 20\n- SELECT *\n- LIMIT 20"
                },
                "in_toks": 3098,
                "out_toks": 2468,
                "id": "chatcmpl-CSqskEvz4Bx9Zp8aPqiqRrsBMDFLc",
                "created": 1760992498,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* Get at most 20 ZTF objects with:\n   - ndet >= 30 (minimum number of detections)\n   - g_r_max_corr > 3.5 (difference between minimum g- and r-band corrected magnitudes)\n   - deltajd > 20 (difference between last and first detection times in days)\n*/\nSELECT *\nFROM object\nWHERE ndet >= 30\n  AND g_r_max_corr > 3.5\n  AND deltajd > 20\nLIMIT 20;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* Get at most 20 ZTF objects with:\n   - ndet >= 30 (minimum number of detections)\n   - g_r_max_corr > 3.5 (difference between minimum g- and r-band corrected magnitudes)\n   - deltajd > 20 (difference between last and first detection times in days)\n*/\nSELECT *\nFROM object\nWHERE ndet >= 30\n  AND g_r_max_corr > 3.5\n  AND deltajd > 20\nLIMIT 20;\n```"
                },
                "in_toks": 2723,
                "out_toks": 311,
                "id": "chatcmpl-CSr6ZOjnkEwIEb0Ktvya4NiMWLwl7",
                "created": 1760993355,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "58",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 649,
                "out_toks": 528,
                "id": "chatcmpl-CSsvNMyw5RUwUSdKBgmOsMeYz4Ob9",
                "created": 1761000349,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1490,
                "out_toks": 719,
                "id": "chatcmpl-CSxeS5kThNmY0qYfnhtjcYO4HboYy",
                "created": 1761018520,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the target table and return columns\n- Use the object table as the sole source; it already contains per-object summary statistics that match the requested criteria.\n- Return all columns from object (the user explicitly wants all object columns).\n\n2) Map the user\u2019s conditions to exact columns in object\n- Minimum number of detections of 30 \u2192 object.ndet >= 30. Rationale: ndet is the total number of detections for the object.\n- Difference between minimum g- and r-band corrected magnitudes larger than 3.5 \u2192 object.g_r_max_corr > 3.5. Rationale: g_r_max_corr is defined as the g \u2212 r color at maximum brightness, which corresponds to the difference between the minimum corrected magnitudes in g and r (i.e., at peak/brightest; lower magnitude = brighter). This directly encodes the requested \u201cdifference between minimum g- and r-band corrected magnitudes.\u201d\n- Difference between last and first detection times larger than 20 days \u2192 object.deltajd > 20. Rationale: deltajd is time difference between last and first detection in days.\n\n3) Form the base selection\n- FROM object o\n- SELECT o.* to return all object columns.\n\n4) Apply filters (WHERE clause)\n- o.ndet >= 30\n- o.g_r_max_corr > 3.5\n- o.deltajd > 20\n- Note: No need to filter against NULL explicitly; the comparisons (> or >=) will naturally exclude NULLs.\n\n5) Limit the result size\n- Add LIMIT 20 to return at most 20 objects.\n\n6) Optional ordering (only if a deterministic order is desired)\n- The user did not specify sorting. If reproducible output is needed, add an ORDER BY clause, for example:\n  - ORDER BY o.g_r_max_corr DESC, o.ndet DESC, o.oid ASC\n  - or simply ORDER BY o.oid ASC for deterministic but arbitrary ordering.\n- If no ORDER BY is included, PostgreSQL may return rows in an arbitrary order.\n\n7) Performance considerations\n- The predicate on o.ndet can leverage the index ix_object_ndet.\n- There is no index on g_r_max_corr or deltajd per the provided schema; however, the combined filter with ndet may still reduce the scanned set effectively.\n- No joins are required; this avoids costly scans of detection and complies with the guidance to avoid filtering on detection fields.\n\n8) Avoid unnecessary tables/features\n- Do not use the probability table (no classification constraint was requested; default probability conditions are irrelevant here).\n- No spatial filtering is requested, so do not use Q3C functions.\n- Do not join the detection table; the required \u201cmin g/r corrected magnitudes difference\u201d is already summarized in object.g_r_max_corr.\n\n9) Result\n- The query returns up to 20 rows, each a unique object (object.oid is PRIMARY KEY), with all columns from object, satisfying:\n  - ndet >= 30\n  - g_r_max_corr > 3.5\n  - deltajd > 20",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Identify the target table and return columns\n- Use the object table as the sole source; it already contains per-object summary statistics that match the requested criteria.\n- Return all columns from object (the user explicitly wants all object columns).\n\n2) Map the user\u2019s conditions to exact columns in object\n- Minimum number of detections of 30 \u2192 object.ndet >= 30. Rationale: ndet is the total number of detections for the object.\n- Difference between minimum g- and r-band corrected magnitudes larger than 3.5 \u2192 object.g_r_max_corr > 3.5. Rationale: g_r_max_corr is defined as the g \u2212 r color at maximum brightness, which corresponds to the difference between the minimum corrected magnitudes in g and r (i.e., at peak/brightest; lower magnitude = brighter). This directly encodes the requested \u201cdifference between minimum g- and r-band corrected magnitudes.\u201d\n- Difference between last and first detection times larger than 20 days \u2192 object.deltajd > 20. Rationale: deltajd is time difference between last and first detection in days.\n\n3) Form the base selection\n- FROM object o\n- SELECT o.* to return all object columns.\n\n4) Apply filters (WHERE clause)\n- o.ndet >= 30\n- o.g_r_max_corr > 3.5\n- o.deltajd > 20\n- Note: No need to filter against NULL explicitly; the comparisons (> or >=) will naturally exclude NULLs.\n\n5) Limit the result size\n- Add LIMIT 20 to return at most 20 objects.\n\n6) Optional ordering (only if a deterministic order is desired)\n- The user did not specify sorting. If reproducible output is needed, add an ORDER BY clause, for example:\n  - ORDER BY o.g_r_max_corr DESC, o.ndet DESC, o.oid ASC\n  - or simply ORDER BY o.oid ASC for deterministic but arbitrary ordering.\n- If no ORDER BY is included, PostgreSQL may return rows in an arbitrary order.\n\n7) Performance considerations\n- The predicate on o.ndet can leverage the index ix_object_ndet.\n- There is no index on g_r_max_corr or deltajd per the provided schema; however, the combined filter with ndet may still reduce the scanned set effectively.\n- No joins are required; this avoids costly scans of detection and complies with the guidance to avoid filtering on detection fields.\n\n8) Avoid unnecessary tables/features\n- Do not use the probability table (no classification constraint was requested; default probability conditions are irrelevant here).\n- No spatial filtering is requested, so do not use Q3C functions.\n- Do not join the detection table; the required \u201cmin g/r corrected magnitudes difference\u201d is already summarized in object.g_r_max_corr.\n\n9) Result\n- The query returns up to 20 rows, each a unique object (object.oid is PRIMARY KEY), with all columns from object, satisfying:\n  - ndet >= 30\n  - g_r_max_corr > 3.5\n  - deltajd > 20"
                },
                "in_toks": 3098,
                "out_toks": 2901,
                "id": "chatcmpl-CSxmj1rLDeeXLudwFMOl5Km6mRBoo",
                "created": 1761019033,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Return up to 20 objects meeting the requested criteria from the ZTF object table\nSELECT\n  o.*\nFROM object AS o\nWHERE\n  o.ndet >= 30                  -- minimum number of detections\n  AND o.g_r_max_corr > 3.5      -- difference between minimum g- and r-band corrected magnitudes (g - r at max)\n  AND o.deltajd > 20            -- time difference between last and first detection in days\nLIMIT 20;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return up to 20 objects meeting the requested criteria from the ZTF object table\nSELECT\n  o.*\nFROM object AS o\nWHERE\n  o.ndet >= 30                  -- minimum number of detections\n  AND o.g_r_max_corr > 3.5      -- difference between minimum g- and r-band corrected magnitudes (g - r at max)\n  AND o.deltajd > 20            -- time difference between last and first detection in days\nLIMIT 20;\n```"
                },
                "in_toks": 2708,
                "out_toks": 564,
                "id": "chatcmpl-CSyPgFhzJPWVQZoKXSMeXcnEKarCi",
                "created": 1761021448,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "58",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 649,
                "out_toks": 784,
                "id": "chatcmpl-CSsvUkyZwtCIapjW1rVfeSqVxuzQO",
                "created": 1761000356,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1490,
                "out_toks": 911,
                "id": "chatcmpl-CSxedgF9iHWWHOGhaFv8BBGfErsxr",
                "created": 1761018531,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and scope\n- Objective: Retrieve at most 20 ZTF objects that meet three numeric conditions and return all columns from the object table.\n- Tables involved: Only object (no joins needed).\n- Output: All columns from object (i.e., select all fields in this table).\n\n2) Map user conditions to exact columns in the schema\n- Minimum number of detections of 30:\n  - Column: object.ndet (INTEGER, total number of detections for the object).\n  - Predicate: ndet >= 30.\n- Difference between minimum g- and r-band corrected magnitudes larger than 3.5:\n  - The object table provides color at maximum brightness based on corrected magnitudes via object.g_r_max_corr (DOUBLE PRECISION, g-r color at maximum).\n  - This corresponds to the difference between the minimum (brightest) corrected g and r magnitudes.\n  - Predicate: g_r_max_corr > 3.5.\n- Difference between last and first detection times larger than 20 days:\n  - Column: object.deltajd (DOUBLE PRECISION, time difference between last and first detection).\n  - Predicate: deltajd > 20.\n\n3) Define the selection (projection)\n- Return all columns from object.\n- No additional computed fields requested.\n\n4) Define filtering (WHERE clause) precisely\n- Apply all three predicates:\n  - object.ndet >= 30\n  - object.g_r_max_corr > 3.5\n  - object.deltajd > 20\n- Null-handling: Using > and >= automatically excludes NULLs; no extra IS NOT NULL checks required unless you want explicitness.\n\n5) Limit and optional ordering\n- Limit the result set to at most 20 rows:\n  - LIMIT 20.\n- No specific ordering requested by the user; omit ORDER BY for default planner choice. If deterministic ordering is desired, you could add ORDER BY (e.g., deltajd DESC or g_r_max_corr DESC), but it\u2019s not required.\n\n6) Performance and index considerations\n- Relevant indexes in object:\n  - ix_object_ndet on (ndet) may help filter ndet >= 30.\n  - There is no index on deltajd or g_r_max_corr; the planner may still use the ndet index to reduce the scan before evaluating other predicates.\n- No joins or subqueries are necessary, which keeps the query efficient.\n\n7) Final assembly steps (no SQL code, just structure)\n- FROM: object\n- SELECT: object.* (all columns)\n- WHERE:\n  - object.ndet >= 30\n  - AND object.g_r_max_corr > 3.5\n  - AND object.deltajd > 20\n- LIMIT: 20\n\n8) Notes on excluded elements\n- No need for detection table aggregation since the required metrics are already precomputed in object (ndet, deltajd, g_r_max_corr).\n- No use of probability table; therefore, the default probability constraints (ranking=1, classifier_name='lc_classifier') are not applicable.\n- No spatial filtering is requested; Q3C functions are not applicable here.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\n1) Clarify the goal and scope\n- Objective: Retrieve at most 20 ZTF objects that meet three numeric conditions and return all columns from the object table.\n- Tables involved: Only object (no joins needed).\n- Output: All columns from object (i.e., select all fields in this table).\n\n2) Map user conditions to exact columns in the schema\n- Minimum number of detections of 30:\n  - Column: object.ndet (INTEGER, total number of detections for the object).\n  - Predicate: ndet >= 30.\n- Difference between minimum g- and r-band corrected magnitudes larger than 3.5:\n  - The object table provides color at maximum brightness based on corrected magnitudes via object.g_r_max_corr (DOUBLE PRECISION, g-r color at maximum).\n  - This corresponds to the difference between the minimum (brightest) corrected g and r magnitudes.\n  - Predicate: g_r_max_corr > 3.5.\n- Difference between last and first detection times larger than 20 days:\n  - Column: object.deltajd (DOUBLE PRECISION, time difference between last and first detection).\n  - Predicate: deltajd > 20.\n\n3) Define the selection (projection)\n- Return all columns from object.\n- No additional computed fields requested.\n\n4) Define filtering (WHERE clause) precisely\n- Apply all three predicates:\n  - object.ndet >= 30\n  - object.g_r_max_corr > 3.5\n  - object.deltajd > 20\n- Null-handling: Using > and >= automatically excludes NULLs; no extra IS NOT NULL checks required unless you want explicitness.\n\n5) Limit and optional ordering\n- Limit the result set to at most 20 rows:\n  - LIMIT 20.\n- No specific ordering requested by the user; omit ORDER BY for default planner choice. If deterministic ordering is desired, you could add ORDER BY (e.g., deltajd DESC or g_r_max_corr DESC), but it\u2019s not required.\n\n6) Performance and index considerations\n- Relevant indexes in object:\n  - ix_object_ndet on (ndet) may help filter ndet >= 30.\n  - There is no index on deltajd or g_r_max_corr; the planner may still use the ndet index to reduce the scan before evaluating other predicates.\n- No joins or subqueries are necessary, which keeps the query efficient.\n\n7) Final assembly steps (no SQL code, just structure)\n- FROM: object\n- SELECT: object.* (all columns)\n- WHERE:\n  - object.ndet >= 30\n  - AND object.g_r_max_corr > 3.5\n  - AND object.deltajd > 20\n- LIMIT: 20\n\n8) Notes on excluded elements\n- No need for detection table aggregation since the required metrics are already precomputed in object (ndet, deltajd, g_r_max_corr).\n- No use of probability table; therefore, the default probability constraints (ranking=1, classifier_name='lc_classifier') are not applicable.\n- No spatial filtering is requested; Q3C functions are not applicable here."
                },
                "in_toks": 3098,
                "out_toks": 2400,
                "id": "chatcmpl-CSxnAmlu1XE7BxehiNcsOhBy483kl",
                "created": 1761019060,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get up to 20 objects with: ndet >= 30, g_r_max_corr > 3.5, and deltajd > 20\nSELECT\n    *\nFROM\n    object\nWHERE\n    ndet >= 30\n    AND g_r_max_corr > 3.5\n    AND deltajd > 20\nLIMIT 20;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get up to 20 objects with: ndet >= 30, g_r_max_corr > 3.5, and deltajd > 20\nSELECT\n    *\nFROM\n    object\nWHERE\n    ndet >= 30\n    AND g_r_max_corr > 3.5\n    AND deltajd > 20\nLIMIT 20;\n```"
                },
                "in_toks": 2718,
                "out_toks": 409,
                "id": "chatcmpl-CSyPngI3g7MwNxoPhRkbN55ABbhYC",
                "created": 1761021455,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "58",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 649,
                "out_toks": 464,
                "id": "chatcmpl-CSsvilKjVbS7caO236HAQBwMcdvRq",
                "created": 1761000370,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query using per-object LATERAL aggregation to enable early LIMIT and avoid full-table detection scans\n-- Conditions:\n--  - ndet >= 30\n--  - deltajd > 20\n--  - |min_g_corr - min_r_corr| > 3.5, where minima are computed from corrected detections\n-- Returns: all columns from object, at most 20 rows\n\nSELECT o.*\nFROM\n  (SELECT *\n   FROM OBJECT\n   WHERE ndet >= 30\n     AND deltajd > 20) AS o\nJOIN LATERAL\n  (SELECT MIN(CASE\n                  WHEN d.fid = 1\n                       AND d.corrected THEN d.magpsf_corr\n              END) AS g_min_corr,\n          MIN(CASE\n                  WHEN d.fid = 2\n                       AND d.corrected THEN d.magpsf_corr\n              END) AS r_min_corr\n   FROM detection d\n   WHERE d.oid = o.oid -- only filter on oid for performance\n) AS m ON TRUE\nWHERE m.g_min_corr IS NOT NULL\n  AND m.r_min_corr IS NOT NULL\n  AND ABS(m.g_min_corr - m.r_min_corr) > 3.5\nLIMIT 20;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query using per-object LATERAL aggregation to enable early LIMIT and avoid full-table detection scans\n-- Conditions:\n--  - ndet >= 30\n--  - deltajd > 20\n--  - |min_g_corr - min_r_corr| > 3.5, where minima are computed from corrected detections\n-- Returns: all columns from object, at most 20 rows\n\nSELECT o.*\nFROM\n  (SELECT *\n   FROM OBJECT\n   WHERE ndet >= 30\n     AND deltajd > 20) AS o\nJOIN LATERAL\n  (SELECT MIN(CASE\n                  WHEN d.fid = 1\n                       AND d.corrected THEN d.magpsf_corr\n              END) AS g_min_corr,\n          MIN(CASE\n                  WHEN d.fid = 2\n                       AND d.corrected THEN d.magpsf_corr\n              END) AS r_min_corr\n   FROM detection d\n   WHERE d.oid = o.oid -- only filter on oid for performance\n) AS m ON TRUE\nWHERE m.g_min_corr IS NOT NULL\n  AND m.r_min_corr IS NOT NULL\n  AND ABS(m.g_min_corr - m.r_min_corr) > 3.5\nLIMIT 20;"
                },
                "in_toks": 2248,
                "out_toks": 3718,
                "id": "chatcmpl-CbHWhefIffDrIIZcvFNmq9snvxIaL",
                "created": 1763001543,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1490,
                "out_toks": 1359,
                "id": "chatcmpl-CSxeo2BeeHBAfXjjf4FMrXWsiOK2n",
                "created": 1761018542,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Identify the target table and output\n- Primary table: object\n- Output: all columns from object (i.e., return o.*)\n\n2) Translate each user condition to schema columns\n- \u201cminimum number of detections of 30\u201d \u2192 object.ndet >= 30\n- \u201cdifference between last and first detection times larger than 20 days\u201d \u2192 object.deltajd > 20\n- \u201cdifference between minimum g- and r-band corrected magnitudes larger than 3.5\u201d\n  - Use detection.magpsf_corr (corrected magnitude) per object and per filter\n  - Filters: detection.fid = 1 for g band; detection.fid = 2 for r band\n  - Compute per-object minima: MIN(magpsf_corr) in fid=1 and fid=2\n  - Require both minima to exist (not null), and enforce magnitude-difference threshold\n  - Unless the user needs a signed difference specifically, use the absolute difference: ABS(g_min_corr - r_min_corr) > 3.5\n  - Optionally ensure we\u2019re using corrected measurements explicitly by requiring detection.corrected = TRUE (since the user requested \u201ccorrected magnitudes\u201d)\n\n3) Pre-filter objects (to minimize scanning detection)\n- Build a subquery/CTE that selects from object with:\n  - object.ndet >= 30\n  - object.deltajd > 20\n- This leverages object table indexes (ix_object_ndet). The deltajd column has no index listed; still filter here.\n- Select only object.oid (and optionally keep all columns for the final join); the aim is to reduce the set of oids sent to detection.\n\n4) Aggregate per-object minima in detection (only for candidate oids)\n- Join detection to the pre-filtered object oids on detection.oid = object.oid (use INNER JOIN so only candidate oids are considered).\n- Restrict to corrected magnitudes: detection.corrected = TRUE (to ensure magpsf_corr is valid for \u201ccorrected magnitudes\u201d).\n- Compute per-oid band minima via conditional aggregation:\n  - g_min_corr = MIN(CASE WHEN detection.fid = 1 THEN detection.magpsf_corr END)\n  - r_min_corr = MIN(CASE WHEN detection.fid = 2 THEN detection.magpsf_corr END)\n- GROUP BY detection.oid\n- Apply post-aggregation filters to ensure:\n  - g_min_corr IS NOT NULL AND r_min_corr IS NOT NULL (object must have at least one corrected detection in both g and r)\n  - ABS(g_min_corr - r_min_corr) > 3.5\n\n5) Join aggregated minima back to object and select requested columns\n- INNER JOIN the aggregated result (one row per oid) to the pre-filtered object rows on oid.\n- SELECT all columns from object only (o.*), as requested.\n\n6) Limit the number of results\n- Apply LIMIT 20 to the final result set.\n\n7) Notes and assumptions\n- No probability table is required for this request; hence the default probability conditions do not apply here.\n- Filter on detection only through detection.oid by joining to the pre-filtered object list to respect the performance guidance (\u201cAvoid doing filters on detection table in any parameter other than oid\u201d).\n- If the user intended a signed difference (e.g., g_min_corr - r_min_corr > 3.5) rather than absolute difference, replace ABS(g_min_corr - r_min_corr) with the signed form accordingly.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Identify the target table and output\n- Primary table: object\n- Output: all columns from object (i.e., return o.*)\n\n2) Translate each user condition to schema columns\n- \u201cminimum number of detections of 30\u201d \u2192 object.ndet >= 30\n- \u201cdifference between last and first detection times larger than 20 days\u201d \u2192 object.deltajd > 20\n- \u201cdifference between minimum g- and r-band corrected magnitudes larger than 3.5\u201d\n  - Use detection.magpsf_corr (corrected magnitude) per object and per filter\n  - Filters: detection.fid = 1 for g band; detection.fid = 2 for r band\n  - Compute per-object minima: MIN(magpsf_corr) in fid=1 and fid=2\n  - Require both minima to exist (not null), and enforce magnitude-difference threshold\n  - Unless the user needs a signed difference specifically, use the absolute difference: ABS(g_min_corr - r_min_corr) > 3.5\n  - Optionally ensure we\u2019re using corrected measurements explicitly by requiring detection.corrected = TRUE (since the user requested \u201ccorrected magnitudes\u201d)\n\n3) Pre-filter objects (to minimize scanning detection)\n- Build a subquery/CTE that selects from object with:\n  - object.ndet >= 30\n  - object.deltajd > 20\n- This leverages object table indexes (ix_object_ndet). The deltajd column has no index listed; still filter here.\n- Select only object.oid (and optionally keep all columns for the final join); the aim is to reduce the set of oids sent to detection.\n\n4) Aggregate per-object minima in detection (only for candidate oids)\n- Join detection to the pre-filtered object oids on detection.oid = object.oid (use INNER JOIN so only candidate oids are considered).\n- Restrict to corrected magnitudes: detection.corrected = TRUE (to ensure magpsf_corr is valid for \u201ccorrected magnitudes\u201d).\n- Compute per-oid band minima via conditional aggregation:\n  - g_min_corr = MIN(CASE WHEN detection.fid = 1 THEN detection.magpsf_corr END)\n  - r_min_corr = MIN(CASE WHEN detection.fid = 2 THEN detection.magpsf_corr END)\n- GROUP BY detection.oid\n- Apply post-aggregation filters to ensure:\n  - g_min_corr IS NOT NULL AND r_min_corr IS NOT NULL (object must have at least one corrected detection in both g and r)\n  - ABS(g_min_corr - r_min_corr) > 3.5\n\n5) Join aggregated minima back to object and select requested columns\n- INNER JOIN the aggregated result (one row per oid) to the pre-filtered object rows on oid.\n- SELECT all columns from object only (o.*), as requested.\n\n6) Limit the number of results\n- Apply LIMIT 20 to the final result set.\n\n7) Notes and assumptions\n- No probability table is required for this request; hence the default probability conditions do not apply here.\n- Filter on detection only through detection.oid by joining to the pre-filtered object list to respect the performance guidance (\u201cAvoid doing filters on detection table in any parameter other than oid\u201d).\n- If the user intended a signed difference (e.g., g_min_corr - r_min_corr > 3.5) rather than absolute difference, replace ABS(g_min_corr - r_min_corr) with the signed form accordingly."
                },
                "in_toks": 3098,
                "out_toks": 3115,
                "id": "chatcmpl-CSxnWWYQeKuVbjjNWS2idBUV8TKxk",
                "created": 1761019082,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* Get at most 20 ZTF objects with:\n   - ndet >= 30\n   - deltajd > 20\n   - absolute difference between minimum corrected g and r magnitudes > 3.5\n   Return all columns from object\n*/\nWITH obj_prefilter AS (\n  SELECT *\n  FROM object\n  WHERE ndet >= 30\n    AND deltajd > 20\n),\nband_minima AS (\n  SELECT\n    d.oid,\n    MIN(CASE WHEN d.fid = 1 AND d.corrected THEN d.magpsf_corr END) AS g_min_corr,\n    MIN(CASE WHEN d.fid = 2 AND d.corrected THEN d.magpsf_corr END) AS r_min_corr\n  FROM detection d\n  INNER JOIN obj_prefilter o USING (oid)  -- restrict detection scan to candidate oids\n  GROUP BY d.oid\n  HAVING\n    MIN(CASE WHEN d.fid = 1 AND d.corrected THEN d.magpsf_corr END) IS NOT NULL\n    AND MIN(CASE WHEN d.fid = 2 AND d.corrected THEN d.magpsf_corr END) IS NOT NULL\n    AND ABS(\n      MIN(CASE WHEN d.fid = 1 AND d.corrected THEN d.magpsf_corr END)\n      - MIN(CASE WHEN d.fid = 2 AND d.corrected THEN d.magpsf_corr END)\n    ) > 3.5\n)\nSELECT o.*\nFROM obj_prefilter o\nINNER JOIN band_minima bm ON bm.oid = o.oid\nLIMIT 20;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* Get at most 20 ZTF objects with:\n   - ndet >= 30\n   - deltajd > 20\n   - absolute difference between minimum corrected g and r magnitudes > 3.5\n   Return all columns from object\n*/\nWITH obj_prefilter AS (\n  SELECT *\n  FROM object\n  WHERE ndet >= 30\n    AND deltajd > 20\n),\nband_minima AS (\n  SELECT\n    d.oid,\n    MIN(CASE WHEN d.fid = 1 AND d.corrected THEN d.magpsf_corr END) AS g_min_corr,\n    MIN(CASE WHEN d.fid = 2 AND d.corrected THEN d.magpsf_corr END) AS r_min_corr\n  FROM detection d\n  INNER JOIN obj_prefilter o USING (oid)  -- restrict detection scan to candidate oids\n  GROUP BY d.oid\n  HAVING\n    MIN(CASE WHEN d.fid = 1 AND d.corrected THEN d.magpsf_corr END) IS NOT NULL\n    AND MIN(CASE WHEN d.fid = 2 AND d.corrected THEN d.magpsf_corr END) IS NOT NULL\n    AND ABS(\n      MIN(CASE WHEN d.fid = 1 AND d.corrected THEN d.magpsf_corr END)\n      - MIN(CASE WHEN d.fid = 2 AND d.corrected THEN d.magpsf_corr END)\n    ) > 3.5\n)\nSELECT o.*\nFROM obj_prefilter o\nINNER JOIN band_minima bm ON bm.oid = o.oid\nLIMIT 20;\n```"
                },
                "in_toks": 2793,
                "out_toks": 1691,
                "id": "chatcmpl-CSyPtzRKStUbNv8Ie6sMk6GBdsHDs",
                "created": 1761021461,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "5": {
            "req_id": "58",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 649,
                "out_toks": 336,
                "id": "chatcmpl-CZNTQ35s8eRyMlWBOycsWMstiZDTs",
                "created": 1762547748,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query: pre-filter objects, aggregate detections only for those oids, and limit to 20 results\nWITH candidate_objects AS\n  (-- Restrict to objects that meet the time span and detection count criteria\n SELECT oid\n   FROM OBJECT\n   WHERE ndet >= 30\n     AND deltajd > 20),\n     band_mins AS\n  (-- Compute per-oid minimum corrected magnitudes in g (fid=1) and r (fid=2)\n -- Only scan detections for candidate oids and relevant bands with non-null corrected magnitudes\n SELECT d.oid,\n        MIN(d.magpsf_corr) FILTER (\n                                   WHERE d.fid = 1) AS min_g,\n        MIN(d.magpsf_corr) FILTER (\n                                   WHERE d.fid = 2) AS min_r\n   FROM detection d\n   JOIN candidate_objects c ON c.oid = d.oid\n   WHERE d.fid IN (1,\n                   2)\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid\n   HAVING COUNT(DISTINCT d.fid) = 2 -- ensure both bands are present\n)\nSELECT o.*\nFROM OBJECT o\nJOIN band_mins bm ON bm.oid = o.oid\nWHERE o.ndet >= 30\n  AND o.deltajd > 20\n  AND (bm.min_g - bm.min_r) > 3.5\nLIMIT 20;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query: pre-filter objects, aggregate detections only for those oids, and limit to 20 results\nWITH candidate_objects AS\n  (-- Restrict to objects that meet the time span and detection count criteria\n SELECT oid\n   FROM OBJECT\n   WHERE ndet >= 30\n     AND deltajd > 20),\n     band_mins AS\n  (-- Compute per-oid minimum corrected magnitudes in g (fid=1) and r (fid=2)\n -- Only scan detections for candidate oids and relevant bands with non-null corrected magnitudes\n SELECT d.oid,\n        MIN(d.magpsf_corr) FILTER (\n                                   WHERE d.fid = 1) AS min_g,\n        MIN(d.magpsf_corr) FILTER (\n                                   WHERE d.fid = 2) AS min_r\n   FROM detection d\n   JOIN candidate_objects c ON c.oid = d.oid\n   WHERE d.fid IN (1,\n                   2)\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid\n   HAVING COUNT(DISTINCT d.fid) = 2 -- ensure both bands are present\n)\nSELECT o.*\nFROM OBJECT o\nJOIN band_mins bm ON bm.oid = o.oid\nWHERE o.ndet >= 30\n  AND o.deltajd > 20\n  AND (bm.min_g - bm.min_r) > 3.5\nLIMIT 20;"
                },
                "in_toks": 2157,
                "out_toks": 4091,
                "id": "chatcmpl-CbHXsd18vkZFZIH0XWd92rUWbTPz6",
                "created": 1763001616,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1490,
                "out_toks": 1487,
                "id": "chatcmpl-CZYpPw2Eeq6QD1Y97ENCzErIBefEy",
                "created": 1762591395,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve at most 20 ZTF objects (rows from table object) meeting:\n  - Minimum number of detections \u2265 30.\n  - Difference between minimum corrected magnitudes in g and r bands greater than 3.5 (interpreted as min_g - min_r > 3.5 using detection.magpsf_corr per band; both minima must exist).\n  - Time span between first and last detection > 20 days (use object.deltajd).\n- Return all columns from object.\n\nTables and columns to use\n- object:\n  - oid (PK)\n  - ndet (total number of detections) \u2014 apply ndet \u2265 30.\n  - deltajd (time difference between last and first detection) \u2014 apply deltajd > 20.\n  - All other columns will be selected (SELECT object.*).\n- detection:\n  - oid (FK to object.oid)\n  - fid (filter id: 1 = g, 2 = r)\n  - magpsf_corr (corrected magnitude; use for minima by band)\n\nNo probability or spatial query functionality is needed for this request.\n\nHigh-level strategy\n- Start from object to apply the coarse filters (ndet and deltajd) leveraging object indexes.\n- Derive, from detection, per-oid minima of magpsf_corr in g (fid = 1) and r (fid = 2).\n- Apply the color-difference condition using these minima.\n- Join the derived minima back to the filtered object set.\n- Select all columns from object and limit to 20 rows.\n\nStep-by-step plan\n\n1) Define constants/thresholds used in filters\n- min_ndet = 30\n- min_deltajd = 20\n- min_color_diff = 3.5\n- Bands: g has fid = 1; r has fid = 2.\n\n2) Build the base set of candidate objects (\u201cobjs\u201d)\n- Source table: object\n- Filter conditions:\n  - object.ndet >= 30\n  - object.deltajd > 20\n- Columns to keep: object.oid (for joining) and all object.* (for final output)\n\n3) Compute per-object minimum corrected magnitudes by band from detection (\u201cmins\u201d)\n- Source table: detection\n- Restrict detection rows to only those belonging to the base objects:\n  - detection.oid IN (SELECT oid FROM objs)\n  - This ensures filtering on detection only by oid, which is aligned with performance guidance (index ix_ndetection_oid).\n- Group by detection.oid.\n- Compute:\n  - min_g = MIN(CASE WHEN detection.fid = 1 AND detection.magpsf_corr IS NOT NULL THEN detection.magpsf_corr END)\n  - min_r = MIN(CASE WHEN detection.fid = 2 AND detection.magpsf_corr IS NOT NULL THEN detection.magpsf_corr END)\n- Keep columns: oid, min_g, min_r.\n\n4) Apply the g-r minimum corrected magnitude difference constraint on the aggregated results\n- Condition:\n  - min_g IS NOT NULL AND min_r IS NOT NULL\n  - (min_g - min_r) > 3.5\n- Note: If an absolute difference was intended, this condition would be ABS(min_g - min_r) > 3.5 instead. This plan interprets the request as signed g - r > 3.5.\n\n5) Join filtered objects to the detection-derived minima\n- INNER JOIN objs (from step 2) with mins (from step 3 with step 4\u2019s condition) using oid.\n- This returns only objects satisfying all three criteria.\n\n6) Select requested output columns\n- Select all columns from object (object.*).\n- Do not include derived min_g/min_r in the final SELECT since the user requested only object columns.\n\n7) Apply result size constraint\n- LIMIT 20 to return at most 20 objects.\n\n8) Optional ordering (not required but recommended for deterministic output)\n- If desired, add ORDER BY (min_g - min_r) DESC or object.deltajd DESC or object.oid to stabilize which 20 rows are returned. The user did not request a particular ordering, so this is optional.\n\n9) Index and performance considerations\n- The object table filters use ndet (indexed by ix_object_ndet) and deltajd (no dedicated index; the conjunction still benefits from ndet index).\n- The detection table is filtered only by oid via IN (SELECT oid FROM objs), leveraging ix_ndetection_oid.\n- Aggregation by oid on detection is limited to the subset of oids from objs, reducing cost.\n- Using CASE within MIN avoids WHERE filters on detection for non-oid columns and keeps a single grouped scan.\n\n10) Edge cases and assumptions\n- \u201cMinimum corrected magnitude\u201d interpreted as the numerically smallest magpsf_corr (brightest) per band.\n- Objects missing g or r detections are excluded by requiring both min_g and min_r to be non-null.\n- No additional filters (e.g., detection.corrected, detection.dubious) are applied, since not requested.\n- No probability-based classifier filters are used.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to build the PostgreSQL query\n\nGoal\n- Retrieve at most 20 ZTF objects (rows from table object) meeting:\n  - Minimum number of detections \u2265 30.\n  - Difference between minimum corrected magnitudes in g and r bands greater than 3.5 (interpreted as min_g - min_r > 3.5 using detection.magpsf_corr per band; both minima must exist).\n  - Time span between first and last detection > 20 days (use object.deltajd).\n- Return all columns from object.\n\nTables and columns to use\n- object:\n  - oid (PK)\n  - ndet (total number of detections) \u2014 apply ndet \u2265 30.\n  - deltajd (time difference between last and first detection) \u2014 apply deltajd > 20.\n  - All other columns will be selected (SELECT object.*).\n- detection:\n  - oid (FK to object.oid)\n  - fid (filter id: 1 = g, 2 = r)\n  - magpsf_corr (corrected magnitude; use for minima by band)\n\nNo probability or spatial query functionality is needed for this request.\n\nHigh-level strategy\n- Start from object to apply the coarse filters (ndet and deltajd) leveraging object indexes.\n- Derive, from detection, per-oid minima of magpsf_corr in g (fid = 1) and r (fid = 2).\n- Apply the color-difference condition using these minima.\n- Join the derived minima back to the filtered object set.\n- Select all columns from object and limit to 20 rows.\n\nStep-by-step plan\n\n1) Define constants/thresholds used in filters\n- min_ndet = 30\n- min_deltajd = 20\n- min_color_diff = 3.5\n- Bands: g has fid = 1; r has fid = 2.\n\n2) Build the base set of candidate objects (\u201cobjs\u201d)\n- Source table: object\n- Filter conditions:\n  - object.ndet >= 30\n  - object.deltajd > 20\n- Columns to keep: object.oid (for joining) and all object.* (for final output)\n\n3) Compute per-object minimum corrected magnitudes by band from detection (\u201cmins\u201d)\n- Source table: detection\n- Restrict detection rows to only those belonging to the base objects:\n  - detection.oid IN (SELECT oid FROM objs)\n  - This ensures filtering on detection only by oid, which is aligned with performance guidance (index ix_ndetection_oid).\n- Group by detection.oid.\n- Compute:\n  - min_g = MIN(CASE WHEN detection.fid = 1 AND detection.magpsf_corr IS NOT NULL THEN detection.magpsf_corr END)\n  - min_r = MIN(CASE WHEN detection.fid = 2 AND detection.magpsf_corr IS NOT NULL THEN detection.magpsf_corr END)\n- Keep columns: oid, min_g, min_r.\n\n4) Apply the g-r minimum corrected magnitude difference constraint on the aggregated results\n- Condition:\n  - min_g IS NOT NULL AND min_r IS NOT NULL\n  - (min_g - min_r) > 3.5\n- Note: If an absolute difference was intended, this condition would be ABS(min_g - min_r) > 3.5 instead. This plan interprets the request as signed g - r > 3.5.\n\n5) Join filtered objects to the detection-derived minima\n- INNER JOIN objs (from step 2) with mins (from step 3 with step 4\u2019s condition) using oid.\n- This returns only objects satisfying all three criteria.\n\n6) Select requested output columns\n- Select all columns from object (object.*).\n- Do not include derived min_g/min_r in the final SELECT since the user requested only object columns.\n\n7) Apply result size constraint\n- LIMIT 20 to return at most 20 objects.\n\n8) Optional ordering (not required but recommended for deterministic output)\n- If desired, add ORDER BY (min_g - min_r) DESC or object.deltajd DESC or object.oid to stabilize which 20 rows are returned. The user did not request a particular ordering, so this is optional.\n\n9) Index and performance considerations\n- The object table filters use ndet (indexed by ix_object_ndet) and deltajd (no dedicated index; the conjunction still benefits from ndet index).\n- The detection table is filtered only by oid via IN (SELECT oid FROM objs), leveraging ix_ndetection_oid.\n- Aggregation by oid on detection is limited to the subset of oids from objs, reducing cost.\n- Using CASE within MIN avoids WHERE filters on detection for non-oid columns and keeps a single grouped scan.\n\n10) Edge cases and assumptions\n- \u201cMinimum corrected magnitude\u201d interpreted as the numerically smallest magpsf_corr (brightest) per band.\n- Objects missing g or r detections are excluded by requiring both min_g and min_r to be non-null.\n- No additional filters (e.g., detection.corrected, detection.dubious) are applied, since not requested.\n- No probability-based classifier filters are used."
                },
                "in_toks": 3098,
                "out_toks": 3451,
                "id": "chatcmpl-CZa7Hlj4bqbQYLuJj868lQPXIomSy",
                "created": 1762596347,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get up to 20 ZTF objects with:\n-- - at least 30 detections (object.ndet >= 30)\n-- - time span between last and first detection > 20 days (object.deltajd > 20)\n-- - difference between minimum corrected magnitudes in g and r bands > 3.5 (min_g - min_r > 3.5)\nWITH objs AS (\n    SELECT *\n    FROM object\n    WHERE ndet >= 30\n      AND deltajd > 20\n),\nband_mins AS (\n    SELECT\n        d.oid,\n        MIN(CASE WHEN d.fid = 1 AND d.magpsf_corr IS NOT NULL THEN d.magpsf_corr END) AS min_g, -- g band\n        MIN(CASE WHEN d.fid = 2 AND d.magpsf_corr IS NOT NULL THEN d.magpsf_corr END) AS min_r  -- r band\n    FROM detection d\n    WHERE d.oid IN (SELECT oid FROM objs)\n    GROUP BY d.oid\n),\nfiltered AS (\n    SELECT bm.oid\n    FROM band_mins bm\n    WHERE bm.min_g IS NOT NULL\n      AND bm.min_r IS NOT NULL\n      AND (bm.min_g - bm.min_r) > 3.5\n)\nSELECT o.*\nFROM objs o\nINNER JOIN filtered f ON f.oid = o.oid\nLIMIT 20;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get up to 20 ZTF objects with:\n-- - at least 30 detections (object.ndet >= 30)\n-- - time span between last and first detection > 20 days (object.deltajd > 20)\n-- - difference between minimum corrected magnitudes in g and r bands > 3.5 (min_g - min_r > 3.5)\nWITH objs AS (\n    SELECT *\n    FROM object\n    WHERE ndet >= 30\n      AND deltajd > 20\n),\nband_mins AS (\n    SELECT\n        d.oid,\n        MIN(CASE WHEN d.fid = 1 AND d.magpsf_corr IS NOT NULL THEN d.magpsf_corr END) AS min_g, -- g band\n        MIN(CASE WHEN d.fid = 2 AND d.magpsf_corr IS NOT NULL THEN d.magpsf_corr END) AS min_r  -- r band\n    FROM detection d\n    WHERE d.oid IN (SELECT oid FROM objs)\n    GROUP BY d.oid\n),\nfiltered AS (\n    SELECT bm.oid\n    FROM band_mins bm\n    WHERE bm.min_g IS NOT NULL\n      AND bm.min_r IS NOT NULL\n      AND (bm.min_g - bm.min_r) > 3.5\n)\nSELECT o.*\nFROM objs o\nINNER JOIN filtered f ON f.oid = o.oid\nLIMIT 20;\n```"
                },
                "in_toks": 3129,
                "out_toks": 1460,
                "id": "chatcmpl-CZaz0RKDAOcDLqjISqFHEUCOADNzE",
                "created": 1762599678,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "6": {
            "req_id": "58",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 649,
                "out_toks": 336,
                "id": "chatcmpl-CZNTYWnVzdhXD4QEswYHvt9LfM218",
                "created": 1762547756,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1490,
                "out_toks": 1167,
                "id": "chatcmpl-CZYpjfHGsXRnvVprR5veWWUsAL25w",
                "created": 1762591415,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3098,
                "out_toks": 4000,
                "id": "chatcmpl-CZa8IsgtjR8nGe900ZhzfrhH2CtbY",
                "created": 1762596410,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get up to 20 ZTF objects with:\n-- - at least 30 detections (ndet >= 30)\n-- - absolute difference between minimum g- and r-band corrected magnitudes > 3.5 (|g_r_max_corr| > 3.5)\n-- - time between last and first detection > 20 days (deltajd > 20)\nSELECT\n    *\nFROM\n    object\nWHERE\n    ndet >= 30\n    AND ABS(g_r_max_corr) > 3.5\n    AND deltajd > 20\nLIMIT 20;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get up to 20 ZTF objects with:\n-- - at least 30 detections (ndet >= 30)\n-- - absolute difference between minimum g- and r-band corrected magnitudes > 3.5 (|g_r_max_corr| > 3.5)\n-- - time between last and first detection > 20 days (deltajd > 20)\nSELECT\n    *\nFROM\n    object\nWHERE\n    ndet >= 30\n    AND ABS(g_r_max_corr) > 3.5\n    AND deltajd > 20\nLIMIT 20;\n```"
                },
                "in_toks": 3037,
                "out_toks": 969,
                "id": "chatcmpl-CZawcMS5WIf4DqjdH557oHM3Cw2yF",
                "created": 1762599530,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "58",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 649,
                "out_toks": 400,
                "id": "chatcmpl-CZNTiWmXIrCx0Aons5PMUhDokYE2g",
                "created": 1762547766,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimize by first filtering the object table (smallest, indexed), then using LATERAL subqueries\n-- to compute per-object minimum corrected magnitudes in g (fid=1) and r (fid=2).\n-- This avoids a full-table aggregation on detection and leverages the oid key.\n\nSELECT o.*\nFROM\n  (SELECT *\n   FROM OBJECT\n   WHERE ndet >= 30 -- at least 30 detections\n\n     AND deltajd > 20 -- last - first detection > 20 days\n) AS o\nJOIN LATERAL\n  (SELECT MIN(d.magpsf_corr) AS min_g_corr\n   FROM detection AS d\n   WHERE d.oid = o.oid\n     AND d.fid = 1\n     AND d.corrected = TRUE) AS g ON TRUE\nJOIN LATERAL\n  (SELECT MIN(d.magpsf_corr) AS min_r_corr\n   FROM detection AS d\n   WHERE d.oid = o.oid\n     AND d.fid = 2\n     AND d.corrected = TRUE) AS r ON TRUE\nWHERE ABS(g.min_g_corr - r.min_r_corr) > 3.5 -- difference between min g and r corrected magnitudes > 3.5\nLIMIT 20;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimize by first filtering the object table (smallest, indexed), then using LATERAL subqueries\n-- to compute per-object minimum corrected magnitudes in g (fid=1) and r (fid=2).\n-- This avoids a full-table aggregation on detection and leverages the oid key.\n\nSELECT o.*\nFROM\n  (SELECT *\n   FROM OBJECT\n   WHERE ndet >= 30 -- at least 30 detections\n\n     AND deltajd > 20 -- last - first detection > 20 days\n) AS o\nJOIN LATERAL\n  (SELECT MIN(d.magpsf_corr) AS min_g_corr\n   FROM detection AS d\n   WHERE d.oid = o.oid\n     AND d.fid = 1\n     AND d.corrected = TRUE) AS g ON TRUE\nJOIN LATERAL\n  (SELECT MIN(d.magpsf_corr) AS min_r_corr\n   FROM detection AS d\n   WHERE d.oid = o.oid\n     AND d.fid = 2\n     AND d.corrected = TRUE) AS r ON TRUE\nWHERE ABS(g.min_g_corr - r.min_r_corr) > 3.5 -- difference between min g and r corrected magnitudes > 3.5\nLIMIT 20;"
                },
                "in_toks": 2181,
                "out_toks": 2773,
                "id": "chatcmpl-CbHZYek2bWU9b9F06Mc6D6aNG9yTS",
                "created": 1763001720,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1490,
                "out_toks": 1295,
                "id": "chatcmpl-CZYpxQlF0cCmjnf3JOaUjDfbMutgo",
                "created": 1762591429,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\n1) Restate the goal and constraints\n- Goal: Retrieve at most 20 ZTF objects, returning all columns from the object table.\n- Constraints to satisfy:\n  - Minimum number of detections: object.ndet >= 30.\n  - Time span between first and last detection greater than 20 days: object.deltajd > 20.\n  - Difference between the minimum corrected magnitudes in g and r bands larger than 3.5. We will compute, per object, the minimum magpsf_corr for fid=1 (g) and fid=2 (r), and then require the difference to be > 3.5. Unless directed otherwise, interpret \u201cdifference\u201d as absolute difference: ABS(min_g_corr - min_r_corr) > 3.5. If a signed difference is desired, use (min_g_corr - min_r_corr) > 3.5 instead.\n\n2) Identify the tables and columns to use\n- object (aliased as o): select o.* and apply constraints on:\n  - o.ndet (integer): total number of detections.\n  - o.deltajd (double precision): time difference between last and first detection.\n- detection (used only for per-object aggregation; aliased in a subquery):\n  - detection.oid (varchar): join key to object.oid.\n  - detection.fid (integer): band identifier (1 = g, 2 = r).\n  - detection.magpsf_corr (double precision): corrected apparent magnitude used to compute the minima.\n  - detection.corrected (boolean): whether the magnitude was corrected. Because we need \u201ccorrected magnitudes,\u201d compute minima from rows where corrected = TRUE and magpsf_corr is not null.\n\n3) Build an aggregated subquery over detection to compute per-object minima in g and r\n- Group by detection.oid.\n- Compute, via conditional aggregation, the minimum corrected magnitude per band:\n  - min_g_corr = MIN(CASE WHEN fid = 1 AND corrected = TRUE THEN magpsf_corr END)\n  - min_r_corr = MIN(CASE WHEN fid = 2 AND corrected = TRUE THEN magpsf_corr END)\n- Ensure both minima are present (i.e., not null), so that the difference is meaningful:\n  - HAVING MIN(CASE WHEN fid = 1 AND corrected = TRUE THEN magpsf_corr END) IS NOT NULL\n  - AND MIN(CASE WHEN fid = 2 AND corrected = TRUE THEN magpsf_corr END) IS NOT NULL\n- This subquery uses only detection.oid for grouping, aligning with the performance guidance (use the hash index ix_ndetection_oid).\n\n4) Join the aggregated minima back to object\n- Perform an INNER JOIN from object o to the aggregated subquery on o.oid = agg.oid.\n- This restricts to objects with valid corrected minima in both g and r bands.\n\n5) Apply filters on object-level properties\n- In the WHERE clause over object:\n  - o.ndet >= 30.\n  - o.deltajd > 20.\n\n6) Apply the magnitude-difference constraint\n- In the WHERE clause, apply the difference condition using the aggregated columns:\n  - If interpreting as absolute difference: ABS(agg.min_g_corr - agg.min_r_corr) > 3.5.\n  - If the user explicitly means g - r > 3.5 (signed color): (agg.min_g_corr - agg.min_r_corr) > 3.5.\n\n7) Select and limit results\n- SELECT o.* to return all columns from the object table as requested.\n- LIMIT 20 to cap the number of returned objects at 20.\n- No ORDER BY is required unless a specific ordering is desired; without it, any 20 matching objects may be returned.\n\n8) Performance and correctness notes\n- The detection table is used via a single grouped subquery keyed by oid, leveraging ix_ndetection_oid. No extra filters on detection columns (besides the corrected flag within conditional aggregation) are applied in the FROM/WHERE clauses, which aligns with the guidance to avoid filtering on detection by columns other than oid.\n- Ensure fid mapping is respected: fid=1 for g band, fid=2 for r band.\n- Use magpsf_corr for \u201ccorrected magnitudes.\u201d The corrected = TRUE condition inside the CASE ensures we only consider corrected photometry for minima.\n- Exclude objects lacking corrected photometry in either g or r by requiring non-null minima in the aggregated subquery.\n\n9) Summary of structural elements to include in the SQL (no code, just structure)\n- FROM object o\n- INNER JOIN (\n    SELECT\n      detection.oid,\n      MIN(CASE WHEN fid = 1 AND corrected = TRUE THEN magpsf_corr END) AS min_g_corr,\n      MIN(CASE WHEN fid = 2 AND corrected = TRUE THEN magpsf_corr END) AS min_r_corr\n    FROM detection\n    GROUP BY detection.oid\n    HAVING both minima are not null\n  ) AS agg ON o.oid = agg.oid\n- WHERE o.ndet >= 30 AND o.deltajd > 20 AND ABS(agg.min_g_corr - agg.min_r_corr) > 3.5  (or signed diff if specified)\n- SELECT o.*\n- LIMIT 20",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\n1) Restate the goal and constraints\n- Goal: Retrieve at most 20 ZTF objects, returning all columns from the object table.\n- Constraints to satisfy:\n  - Minimum number of detections: object.ndet >= 30.\n  - Time span between first and last detection greater than 20 days: object.deltajd > 20.\n  - Difference between the minimum corrected magnitudes in g and r bands larger than 3.5. We will compute, per object, the minimum magpsf_corr for fid=1 (g) and fid=2 (r), and then require the difference to be > 3.5. Unless directed otherwise, interpret \u201cdifference\u201d as absolute difference: ABS(min_g_corr - min_r_corr) > 3.5. If a signed difference is desired, use (min_g_corr - min_r_corr) > 3.5 instead.\n\n2) Identify the tables and columns to use\n- object (aliased as o): select o.* and apply constraints on:\n  - o.ndet (integer): total number of detections.\n  - o.deltajd (double precision): time difference between last and first detection.\n- detection (used only for per-object aggregation; aliased in a subquery):\n  - detection.oid (varchar): join key to object.oid.\n  - detection.fid (integer): band identifier (1 = g, 2 = r).\n  - detection.magpsf_corr (double precision): corrected apparent magnitude used to compute the minima.\n  - detection.corrected (boolean): whether the magnitude was corrected. Because we need \u201ccorrected magnitudes,\u201d compute minima from rows where corrected = TRUE and magpsf_corr is not null.\n\n3) Build an aggregated subquery over detection to compute per-object minima in g and r\n- Group by detection.oid.\n- Compute, via conditional aggregation, the minimum corrected magnitude per band:\n  - min_g_corr = MIN(CASE WHEN fid = 1 AND corrected = TRUE THEN magpsf_corr END)\n  - min_r_corr = MIN(CASE WHEN fid = 2 AND corrected = TRUE THEN magpsf_corr END)\n- Ensure both minima are present (i.e., not null), so that the difference is meaningful:\n  - HAVING MIN(CASE WHEN fid = 1 AND corrected = TRUE THEN magpsf_corr END) IS NOT NULL\n  - AND MIN(CASE WHEN fid = 2 AND corrected = TRUE THEN magpsf_corr END) IS NOT NULL\n- This subquery uses only detection.oid for grouping, aligning with the performance guidance (use the hash index ix_ndetection_oid).\n\n4) Join the aggregated minima back to object\n- Perform an INNER JOIN from object o to the aggregated subquery on o.oid = agg.oid.\n- This restricts to objects with valid corrected minima in both g and r bands.\n\n5) Apply filters on object-level properties\n- In the WHERE clause over object:\n  - o.ndet >= 30.\n  - o.deltajd > 20.\n\n6) Apply the magnitude-difference constraint\n- In the WHERE clause, apply the difference condition using the aggregated columns:\n  - If interpreting as absolute difference: ABS(agg.min_g_corr - agg.min_r_corr) > 3.5.\n  - If the user explicitly means g - r > 3.5 (signed color): (agg.min_g_corr - agg.min_r_corr) > 3.5.\n\n7) Select and limit results\n- SELECT o.* to return all columns from the object table as requested.\n- LIMIT 20 to cap the number of returned objects at 20.\n- No ORDER BY is required unless a specific ordering is desired; without it, any 20 matching objects may be returned.\n\n8) Performance and correctness notes\n- The detection table is used via a single grouped subquery keyed by oid, leveraging ix_ndetection_oid. No extra filters on detection columns (besides the corrected flag within conditional aggregation) are applied in the FROM/WHERE clauses, which aligns with the guidance to avoid filtering on detection by columns other than oid.\n- Ensure fid mapping is respected: fid=1 for g band, fid=2 for r band.\n- Use magpsf_corr for \u201ccorrected magnitudes.\u201d The corrected = TRUE condition inside the CASE ensures we only consider corrected photometry for minima.\n- Exclude objects lacking corrected photometry in either g or r by requiring non-null minima in the aggregated subquery.\n\n9) Summary of structural elements to include in the SQL (no code, just structure)\n- FROM object o\n- INNER JOIN (\n    SELECT\n      detection.oid,\n      MIN(CASE WHEN fid = 1 AND corrected = TRUE THEN magpsf_corr END) AS min_g_corr,\n      MIN(CASE WHEN fid = 2 AND corrected = TRUE THEN magpsf_corr END) AS min_r_corr\n    FROM detection\n    GROUP BY detection.oid\n    HAVING both minima are not null\n  ) AS agg ON o.oid = agg.oid\n- WHERE o.ndet >= 30 AND o.deltajd > 20 AND ABS(agg.min_g_corr - agg.min_r_corr) > 3.5  (or signed diff if specified)\n- SELECT o.*\n- LIMIT 20"
                },
                "in_toks": 3098,
                "out_toks": 3802,
                "id": "chatcmpl-CZa9VVV6hf26fuLKhcjxWYbvC1GPT",
                "created": 1762596485,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get up to 20 objects with:\n-- - at least 30 detections (object.ndet >= 30)\n-- - time span between first and last detection > 20 days (object.deltajd > 20)\n-- - absolute difference between minimum corrected g and r magnitudes > 3.5\n--   g band fid=1, r band fid=2; use detection.magpsf_corr with corrected=TRUE\nSELECT\n  o.*\nFROM object AS o\nINNER JOIN (\n  SELECT\n    d.oid,\n    MIN(CASE WHEN d.fid = 1 AND d.corrected = TRUE THEN d.magpsf_corr END) AS min_g_corr,\n    MIN(CASE WHEN d.fid = 2 AND d.corrected = TRUE THEN d.magpsf_corr END) AS min_r_corr\n  FROM detection AS d\n  GROUP BY d.oid\n  HAVING\n    MIN(CASE WHEN d.fid = 1 AND d.corrected = TRUE THEN d.magpsf_corr END) IS NOT NULL\n    AND MIN(CASE WHEN d.fid = 2 AND d.corrected = TRUE THEN d.magpsf_corr END) IS NOT NULL\n) AS agg\n  ON o.oid = agg.oid\nWHERE\n  o.ndet >= 30\n  AND o.deltajd > 20\n  AND ABS(agg.min_g_corr - agg.min_r_corr) > 3.5\nLIMIT 20;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get up to 20 objects with:\n-- - at least 30 detections (object.ndet >= 30)\n-- - time span between first and last detection > 20 days (object.deltajd > 20)\n-- - absolute difference between minimum corrected g and r magnitudes > 3.5\n--   g band fid=1, r band fid=2; use detection.magpsf_corr with corrected=TRUE\nSELECT\n  o.*\nFROM object AS o\nINNER JOIN (\n  SELECT\n    d.oid,\n    MIN(CASE WHEN d.fid = 1 AND d.corrected = TRUE THEN d.magpsf_corr END) AS min_g_corr,\n    MIN(CASE WHEN d.fid = 2 AND d.corrected = TRUE THEN d.magpsf_corr END) AS min_r_corr\n  FROM detection AS d\n  GROUP BY d.oid\n  HAVING\n    MIN(CASE WHEN d.fid = 1 AND d.corrected = TRUE THEN d.magpsf_corr END) IS NOT NULL\n    AND MIN(CASE WHEN d.fid = 2 AND d.corrected = TRUE THEN d.magpsf_corr END) IS NOT NULL\n) AS agg\n  ON o.oid = agg.oid\nWHERE\n  o.ndet >= 30\n  AND o.deltajd > 20\n  AND ABS(agg.min_g_corr - agg.min_r_corr) > 3.5\nLIMIT 20;\n```"
                },
                "in_toks": 3161,
                "out_toks": 1216,
                "id": "chatcmpl-CZawuFDZ4uIoYXSFyGcLEW3ktHaNp",
                "created": 1762599548,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "8": {
            "req_id": "58",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 649,
                "out_toks": 592,
                "id": "chatcmpl-CZNTr9quQBYXcXGhRQuIskDqhQbs3",
                "created": 1762547775,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query using LATERAL subqueries to get per-object minima per band\n-- This avoids aggregating the entire detection table and allows early LIMIT\n\nSELECT o.*\nFROM OBJECT o -- Pre-filter objects by required conditions\n\nWHERE o.ndet >= 30\n  AND o.deltajd > 20 -- Get minimum corrected g-band magnitude for this oid\nJOIN LATERAL\n    (SELECT d.magpsf_corr AS min_g\n     FROM detection d\n     WHERE d.oid = o.oid\n       AND d.fid = 1 -- g band\n\n       AND d.corrected = TRUE\n       AND d.magpsf_corr IS NOT NULL\n     ORDER BY d.magpsf_corr ASC\n     LIMIT 1) g ON TRUE -- Get minimum corrected r-band magnitude for this oid\nJOIN LATERAL\n    (SELECT d.magpsf_corr AS min_r\n     FROM detection d\n     WHERE d.oid = o.oid\n       AND d.fid = 2 -- r band\n\n       AND d.corrected = TRUE\n       AND d.magpsf_corr IS NOT NULL\n     ORDER BY d.magpsf_corr ASC\n     LIMIT 1) r ON TRUE -- Require the absolute difference between minima to be > 3.5\nWHERE ABS(g.min_g - r.min_r) > 3.5\nLIMIT 20;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query using LATERAL subqueries to get per-object minima per band\n-- This avoids aggregating the entire detection table and allows early LIMIT\n\nSELECT o.*\nFROM OBJECT o -- Pre-filter objects by required conditions\n\nWHERE o.ndet >= 30\n  AND o.deltajd > 20 -- Get minimum corrected g-band magnitude for this oid\nJOIN LATERAL\n    (SELECT d.magpsf_corr AS min_g\n     FROM detection d\n     WHERE d.oid = o.oid\n       AND d.fid = 1 -- g band\n\n       AND d.corrected = TRUE\n       AND d.magpsf_corr IS NOT NULL\n     ORDER BY d.magpsf_corr ASC\n     LIMIT 1) g ON TRUE -- Get minimum corrected r-band magnitude for this oid\nJOIN LATERAL\n    (SELECT d.magpsf_corr AS min_r\n     FROM detection d\n     WHERE d.oid = o.oid\n       AND d.fid = 2 -- r band\n\n       AND d.corrected = TRUE\n       AND d.magpsf_corr IS NOT NULL\n     ORDER BY d.magpsf_corr ASC\n     LIMIT 1) r ON TRUE -- Require the absolute difference between minima to be > 3.5\nWHERE ABS(g.min_g - r.min_r) > 3.5\nLIMIT 20;"
                },
                "in_toks": 2084,
                "out_toks": 1962,
                "id": "chatcmpl-CbHb4qyDdj17gxWYjmRhy2swbA5kC",
                "created": 1763001814,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1490,
                "out_toks": 1231,
                "id": "chatcmpl-CZYqDflB09EA5QZtIWRIBlnUZ6PBa",
                "created": 1762591445,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "Decomposition plan to generate the PostgreSQL query\n\nGoal\n- Return at most 20 objects (rows) from the object table (all columns) that satisfy:\n  - Minimum number of detections: ndet >= 30\n  - Time span between last and first detection: deltajd > 20 days\n  - Difference between the minimum corrected magnitudes in g and r bands greater than 3.5:\n    - Use detection.magpsf_corr\n    - Compute per-object minima for fid = 1 (g) and fid = 2 (r), using only corrected detections (detection.corrected = true)\n    - Require both minima to exist (not NULL)\n    - Use absolute difference: abs(min_g - min_r) > 3.5 (conservative interpretation of \u201cdifference larger than 3.5\u201d)\n- Do not use the probability table (not requested).\n- Return all columns from object (SELECT o.*).\n- Limit to 20 results.\n\nTables and key columns involved\n- object\n  - oid (PK), ndet, deltajd, firstmjd, lastmjd, and all other columns that will be returned via SELECT *\n- detection\n  - oid (FK to object.oid), fid (1 = g, 2 = r), magpsf_corr, corrected (boolean)\n  - Note: Avoid filtering on detection columns other than oid; implement band and corrected selection via conditional aggregation.\n\nStep-by-step plan\n\n1) Pre-filter candidate objects (reduce detection scan)\n- Base table: object o\n- Apply object-level filters:\n  - o.ndet >= 30\n  - o.deltajd > 20\n- This creates a reduced set of candidate oids using object indexes (ix_object_ndet helps; deltajd filter still applied but keeps logic correct).\n- Represent this as a CTE or subquery (e.g., candidate_objects) selecting o.oid plus optionally all columns to be returned later.\n\n2) Aggregate per-object band minima from detection using conditional aggregation\n- From detection d, restrict rows to only those oids in the candidate set from Step 1 by joining on d.oid = candidate_objects.oid (critical for performance due to ix_ndetection_oid).\n- Group by d.oid.\n- Compute per-group (per-object) minima for corrected magnitudes:\n  - min_g = MIN(CASE WHEN d.fid = 1 AND d.corrected = true THEN d.magpsf_corr END)\n  - min_r = MIN(CASE WHEN d.fid = 2 AND d.corrected = true THEN d.magpsf_corr END)\n- Do not place WHERE filters on detection.fid or detection.corrected; keep these inside CASE to respect the guideline about detection filters.\n- Ensure both minima exist by requiring min_g IS NOT NULL and min_r IS NOT NULL.\n\n3) Enforce the magnitude-difference condition on the aggregated minima\n- Still within the aggregated result of Step 2, require:\n  - abs(min_g - min_r) > 3.5\n- This can be placed in a HAVING clause (if done in the same aggregation) or in a WHERE clause if using an outer select over the aggregated subquery.\n\n4) Join qualifying objects back to full object rows\n- INNER JOIN object o to the aggregated minima result from Step 2 (only the oids that satisfy the magnitude condition).\n- Select o.* to return all columns from the object table, as requested.\n\n5) Limit the number of results\n- Apply LIMIT 20 to the final result set.\n- No ORDER BY is specified by the user; omit ordering unless a specific sort is needed.\n\n6) Edge cases and correctness notes\n- Using object.deltajd > 20 directly matches \u201cdifference between last and first detection times larger than 20 days.\u201d\n- The use of detection.corrected = true is necessary because the requirement explicitly mentions \u201ccorrected magnitudes\u201d; magpsf_corr is the corrected magnitude column.\n- If an object lacks at least one corrected detection in either g or r, it will be excluded (min_g or min_r would be NULL).\n- The use of abs(min_g - min_r) > 3.5 interprets \u201cdifference larger than 3.5\u201d in a magnitude-agnostic way. If a signed difference (min_g - min_r > 3.5) is intended instead, drop abs() and compare directly.\n\n7) Performance considerations\n- Filtering objects first (Step 1) minimizes the detection rows scanned thanks to the hash index on detection.oid (ix_ndetection_oid).\n- Conditional aggregation avoids non-oid filtering on detection while still computing band-specific minima.\n- Selecting only the necessary aggregated values (min_g, min_r) keeps the intermediate dataset small before joining back to object.\n\nSummary of components to include in the SQL (do not write SQL here)\n- A CTE or subquery selecting from object o with conditions:\n  - o.ndet >= 30\n  - o.deltajd > 20\n- An aggregate subquery over detection d joined to that candidate set, grouped by d.oid, computing:\n  - MIN(CASE WHEN d.fid = 1 AND d.corrected = true THEN d.magpsf_corr END) AS min_g\n  - MIN(CASE WHEN d.fid = 2 AND d.corrected = true THEN d.magpsf_corr END) AS min_r\n- A filter requiring:\n  - min_g IS NOT NULL AND min_r IS NOT NULL AND abs(min_g - min_r) > 3.5\n- A final join back to object o, selecting o.*, with LIMIT 20.",
            "sql_query_plan_response": {
                "responses": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\nGoal\n- Return at most 20 objects (rows) from the object table (all columns) that satisfy:\n  - Minimum number of detections: ndet >= 30\n  - Time span between last and first detection: deltajd > 20 days\n  - Difference between the minimum corrected magnitudes in g and r bands greater than 3.5:\n    - Use detection.magpsf_corr\n    - Compute per-object minima for fid = 1 (g) and fid = 2 (r), using only corrected detections (detection.corrected = true)\n    - Require both minima to exist (not NULL)\n    - Use absolute difference: abs(min_g - min_r) > 3.5 (conservative interpretation of \u201cdifference larger than 3.5\u201d)\n- Do not use the probability table (not requested).\n- Return all columns from object (SELECT o.*).\n- Limit to 20 results.\n\nTables and key columns involved\n- object\n  - oid (PK), ndet, deltajd, firstmjd, lastmjd, and all other columns that will be returned via SELECT *\n- detection\n  - oid (FK to object.oid), fid (1 = g, 2 = r), magpsf_corr, corrected (boolean)\n  - Note: Avoid filtering on detection columns other than oid; implement band and corrected selection via conditional aggregation.\n\nStep-by-step plan\n\n1) Pre-filter candidate objects (reduce detection scan)\n- Base table: object o\n- Apply object-level filters:\n  - o.ndet >= 30\n  - o.deltajd > 20\n- This creates a reduced set of candidate oids using object indexes (ix_object_ndet helps; deltajd filter still applied but keeps logic correct).\n- Represent this as a CTE or subquery (e.g., candidate_objects) selecting o.oid plus optionally all columns to be returned later.\n\n2) Aggregate per-object band minima from detection using conditional aggregation\n- From detection d, restrict rows to only those oids in the candidate set from Step 1 by joining on d.oid = candidate_objects.oid (critical for performance due to ix_ndetection_oid).\n- Group by d.oid.\n- Compute per-group (per-object) minima for corrected magnitudes:\n  - min_g = MIN(CASE WHEN d.fid = 1 AND d.corrected = true THEN d.magpsf_corr END)\n  - min_r = MIN(CASE WHEN d.fid = 2 AND d.corrected = true THEN d.magpsf_corr END)\n- Do not place WHERE filters on detection.fid or detection.corrected; keep these inside CASE to respect the guideline about detection filters.\n- Ensure both minima exist by requiring min_g IS NOT NULL and min_r IS NOT NULL.\n\n3) Enforce the magnitude-difference condition on the aggregated minima\n- Still within the aggregated result of Step 2, require:\n  - abs(min_g - min_r) > 3.5\n- This can be placed in a HAVING clause (if done in the same aggregation) or in a WHERE clause if using an outer select over the aggregated subquery.\n\n4) Join qualifying objects back to full object rows\n- INNER JOIN object o to the aggregated minima result from Step 2 (only the oids that satisfy the magnitude condition).\n- Select o.* to return all columns from the object table, as requested.\n\n5) Limit the number of results\n- Apply LIMIT 20 to the final result set.\n- No ORDER BY is specified by the user; omit ordering unless a specific sort is needed.\n\n6) Edge cases and correctness notes\n- Using object.deltajd > 20 directly matches \u201cdifference between last and first detection times larger than 20 days.\u201d\n- The use of detection.corrected = true is necessary because the requirement explicitly mentions \u201ccorrected magnitudes\u201d; magpsf_corr is the corrected magnitude column.\n- If an object lacks at least one corrected detection in either g or r, it will be excluded (min_g or min_r would be NULL).\n- The use of abs(min_g - min_r) > 3.5 interprets \u201cdifference larger than 3.5\u201d in a magnitude-agnostic way. If a signed difference (min_g - min_r > 3.5) is intended instead, drop abs() and compare directly.\n\n7) Performance considerations\n- Filtering objects first (Step 1) minimizes the detection rows scanned thanks to the hash index on detection.oid (ix_ndetection_oid).\n- Conditional aggregation avoids non-oid filtering on detection while still computing band-specific minima.\n- Selecting only the necessary aggregated values (min_g, min_r) keeps the intermediate dataset small before joining back to object.\n\nSummary of components to include in the SQL (do not write SQL here)\n- A CTE or subquery selecting from object o with conditions:\n  - o.ndet >= 30\n  - o.deltajd > 20\n- An aggregate subquery over detection d joined to that candidate set, grouped by d.oid, computing:\n  - MIN(CASE WHEN d.fid = 1 AND d.corrected = true THEN d.magpsf_corr END) AS min_g\n  - MIN(CASE WHEN d.fid = 2 AND d.corrected = true THEN d.magpsf_corr END) AS min_r\n- A filter requiring:\n  - min_g IS NOT NULL AND min_r IS NOT NULL AND abs(min_g - min_r) > 3.5\n- A final join back to object o, selecting o.*, with LIMIT 20."
                },
                "in_toks": 3098,
                "out_toks": 3674,
                "id": "chatcmpl-CZaAnDujVdABBJbhV53nzNB5WwZ3u",
                "created": 1762596565,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Get up to 20 ZTF objects with:\n-- - ndet >= 30\n-- - deltajd > 20 days\n-- - Absolute difference between minimum corrected g- and r-band magnitudes > 3.5\n-- Uses conditional aggregation on detection to compute per-band minima for corrected magnitudes\nWITH candidate_objects AS (\n    SELECT *\n    FROM object o\n    WHERE o.ndet >= 30\n      AND o.deltajd > 20\n),\nband_minima AS (\n    SELECT\n        d.oid,\n        MIN(CASE WHEN d.fid = 1 AND d.corrected = true THEN d.magpsf_corr END) AS min_g,\n        MIN(CASE WHEN d.fid = 2 AND d.corrected = true THEN d.magpsf_corr END) AS min_r\n    FROM detection d\n    INNER JOIN candidate_objects co ON co.oid = d.oid\n    GROUP BY d.oid\n)\nSELECT co.*\nFROM candidate_objects co\nINNER JOIN band_minima bm ON bm.oid = co.oid\nWHERE bm.min_g IS NOT NULL\n  AND bm.min_r IS NOT NULL\n  AND ABS(bm.min_g - bm.min_r) > 3.5\nLIMIT 20;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get up to 20 ZTF objects with:\n-- - ndet >= 30\n-- - deltajd > 20 days\n-- - Absolute difference between minimum corrected g- and r-band magnitudes > 3.5\n-- Uses conditional aggregation on detection to compute per-band minima for corrected magnitudes\nWITH candidate_objects AS (\n    SELECT *\n    FROM object o\n    WHERE o.ndet >= 30\n      AND o.deltajd > 20\n),\nband_minima AS (\n    SELECT\n        d.oid,\n        MIN(CASE WHEN d.fid = 1 AND d.corrected = true THEN d.magpsf_corr END) AS min_g,\n        MIN(CASE WHEN d.fid = 2 AND d.corrected = true THEN d.magpsf_corr END) AS min_r\n    FROM detection d\n    INNER JOIN candidate_objects co ON co.oid = d.oid\n    GROUP BY d.oid\n)\nSELECT co.*\nFROM candidate_objects co\nINNER JOIN band_minima bm ON bm.oid = co.oid\nWHERE bm.min_g IS NOT NULL\n  AND bm.min_r IS NOT NULL\n  AND ABS(bm.min_g - bm.min_r) > 3.5\nLIMIT 20;\n```"
                },
                "in_toks": 3224,
                "out_toks": 2065,
                "id": "chatcmpl-CZayLKo9bcyjgg8LmJf1KGilE27Vo",
                "created": 1762599637,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        },
        "9": {
            "req_id": "58",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection']"
                },
                "in_toks": 649,
                "out_toks": 848,
                "id": "chatcmpl-CZNU7poh8ulFQpIlNDvlJmwtClAuN",
                "created": 1762547791,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Pre-filter objects to drastically reduce the number of detections to scan\nWITH candidates AS\n  (SELECT oid\n   FROM OBJECT\n   WHERE ndet >= 30 -- at least 30 detections\n\n     AND deltajd > 20 -- time span > 20 days\n), -- Compute per-oid minimum corrected magnitudes in g and r only for candidate oids\nmin_mags AS\n  (SELECT d.oid,\n          MIN(CASE\n                  WHEN d.fid = 1\n                       AND d.corrected\n                       AND d.magpsf_corr IS NOT NULL THEN d.magpsf_corr\n              END) AS min_g_corr,\n          MIN(CASE\n                  WHEN d.fid = 2\n                       AND d.corrected\n                       AND d.magpsf_corr IS NOT NULL THEN d.magpsf_corr\n              END) AS min_r_corr\n   FROM detection d\n   JOIN candidates c ON c.oid = d.oid -- only aggregate detections for candidate objects\n\n   GROUP BY d.oid), -- Keep only those oids whose absolute difference between minima exceeds 3.5\nfiltered AS\n  (SELECT oid\n   FROM min_mags\n   WHERE ABS(min_g_corr - min_r_corr) > 3.5) -- Return all columns from object for up to 20 matching objects\n\nSELECT o.*\nFROM OBJECT o\nJOIN filtered f ON f.oid = o.oid\nLIMIT 20;",
            "sql_response": {
                "responses": {
                    "0": "-- Pre-filter objects to drastically reduce the number of detections to scan\nWITH candidates AS\n  (SELECT oid\n   FROM OBJECT\n   WHERE ndet >= 30 -- at least 30 detections\n\n     AND deltajd > 20 -- time span > 20 days\n), -- Compute per-oid minimum corrected magnitudes in g and r only for candidate oids\nmin_mags AS\n  (SELECT d.oid,\n          MIN(CASE\n                  WHEN d.fid = 1\n                       AND d.corrected\n                       AND d.magpsf_corr IS NOT NULL THEN d.magpsf_corr\n              END) AS min_g_corr,\n          MIN(CASE\n                  WHEN d.fid = 2\n                       AND d.corrected\n                       AND d.magpsf_corr IS NOT NULL THEN d.magpsf_corr\n              END) AS min_r_corr\n   FROM detection d\n   JOIN candidates c ON c.oid = d.oid -- only aggregate detections for candidate objects\n\n   GROUP BY d.oid), -- Keep only those oids whose absolute difference between minima exceeds 3.5\nfiltered AS\n  (SELECT oid\n   FROM min_mags\n   WHERE ABS(min_g_corr - min_r_corr) > 3.5) -- Return all columns from object for up to 20 matching objects\n\nSELECT o.*\nFROM OBJECT o\nJOIN filtered f ON f.oid = o.oid\nLIMIT 20;"
                },
                "in_toks": 2027,
                "out_toks": 1896,
                "id": "chatcmpl-CbHbtbNzSs9k6x0NXuuQaJFGloaWD",
                "created": 1763001865,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 1490,
                "out_toks": 847,
                "id": "chatcmpl-CZYqal0jYGN0TDaSUHESt98KkxXVG",
                "created": 1762591468,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Get up to 20 objects with:\n-- - at least 30 detections (ndet >= 30)\n-- - time span between last and first detection > 20 days (deltajd > 20)\n-- - absolute difference between minimum corrected magnitudes in g (fid=1) and r (fid=2) > 3.5\nWITH min_mags AS (\n    SELECT\n        d.oid,\n        MIN(CASE WHEN d.fid = 1 AND d.magpsf_corr IS NOT NULL THEN d.magpsf_corr END) AS min_g_corr,\n        MIN(CASE WHEN d.fid = 2 AND d.magpsf_corr IS NOT NULL THEN d.magpsf_corr END) AS min_r_corr\n    FROM detection d\n    GROUP BY d.oid\n)\nSELECT o.*\nFROM object o\nINNER JOIN min_mags m ON m.oid = o.oid\nWHERE o.ndet >= 30\n  AND o.deltajd > 20\n  AND ABS(m.min_g_corr - m.min_r_corr) > 3.5\nLIMIT 20;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Get up to 20 objects with:\n-- - at least 30 detections (ndet >= 30)\n-- - time span between last and first detection > 20 days (deltajd > 20)\n-- - absolute difference between minimum corrected magnitudes in g (fid=1) and r (fid=2) > 3.5\nWITH min_mags AS (\n    SELECT\n        d.oid,\n        MIN(CASE WHEN d.fid = 1 AND d.magpsf_corr IS NOT NULL THEN d.magpsf_corr END) AS min_g_corr,\n        MIN(CASE WHEN d.fid = 2 AND d.magpsf_corr IS NOT NULL THEN d.magpsf_corr END) AS min_r_corr\n    FROM detection d\n    GROUP BY d.oid\n)\nSELECT o.*\nFROM object o\nINNER JOIN min_mags m ON m.oid = o.oid\nWHERE o.ndet >= 30\n  AND o.deltajd > 20\n  AND ABS(m.min_g_corr - m.min_r_corr) > 3.5\nLIMIT 20;\n```"
                },
                "in_toks": 2808,
                "out_toks": 1845,
                "id": "chatcmpl-CZZwwZsoVbKszTwhgOoR7HL5YU4Vr",
                "created": 1762595706,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": true
        }
    },
    "78": {
        "0": {
            "req_id": "78",
            "experiment_id": "run_0",
            "pred_tables": [
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['taxonomy']",
                    "1": "['taxonomy']"
                },
                "in_toks": 612,
                "out_toks": 280,
                "id": "chatcmpl-CSncmJEtkzWigIoJXBoTvkZj0gS9T",
                "created": 1760979976,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 468,
                "out_toks": 143,
                "id": "chatcmpl-CSntBZZUCQ87istjMJitfHozw8jOe",
                "created": 1760980993,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return name, version, and classes for the light curve classifier from the taxonomy table\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return name, version, and classes for the light curve classifier from the taxonomy table\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```"
                },
                "in_toks": 1786,
                "out_toks": 375,
                "id": "chatcmpl-CSqsFLU6adFbLU2Ngn3h2Jbcmx1Ep",
                "created": 1760992467,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "1": {
            "req_id": "78",
            "experiment_id": "run_1",
            "pred_tables": [
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['taxonomy']",
                    "1": "['taxonomy']"
                },
                "in_toks": 612,
                "out_toks": 280,
                "id": "chatcmpl-CSncmJEtkzWigIoJXBoTvkZj0gS9T",
                "created": 1760979976,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 468,
                "out_toks": 143,
                "id": "chatcmpl-CSntHcO3RR2wSLqYxKwaeqths8v28",
                "created": 1760980999,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return name, version, and classes for the light curve classifier from taxonomy\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return name, version, and classes for the light curve classifier from taxonomy\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```"
                },
                "in_toks": 1786,
                "out_toks": 373,
                "id": "chatcmpl-CSqsmA940aGCCg1kl2j5u8cwRUhRq",
                "created": 1760992500,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "78",
            "experiment_id": "run_2",
            "pred_tables": [
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['taxonomy']"
                },
                "in_toks": 612,
                "out_toks": 140,
                "id": "chatcmpl-CSsvqnsEcuKSFfA90L9yPW8k9KOTf",
                "created": 1761000378,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 468,
                "out_toks": 79,
                "id": "chatcmpl-CSxf2iWazU7T0nUHgYtm3ievji7Q8",
                "created": 1761018556,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Light curve classifier ('lc_classifier') taxonomy: name, version, and included classes\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Light curve classifier ('lc_classifier') taxonomy: name, version, and included classes\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```"
                },
                "in_toks": 1786,
                "out_toks": 375,
                "id": "chatcmpl-CSxoB1Rw7QAWx71tDHyuXr4YVkHit",
                "created": 1761019123,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "3": {
            "req_id": "78",
            "experiment_id": "run_3",
            "pred_tables": [
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['taxonomy']"
                },
                "in_toks": 612,
                "out_toks": 204,
                "id": "chatcmpl-CSsvtC2sZs2WwqmFWveGOKueZDnx3",
                "created": 1761000381,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 468,
                "out_toks": 143,
                "id": "chatcmpl-CSxf4JTtgIiLsAWX7vQoiuf0WFdbF",
                "created": 1761018558,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return name, version, and classes for the light curve classifier from taxonomy\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return name, version, and classes for the light curve classifier from taxonomy\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```"
                },
                "in_toks": 1786,
                "out_toks": 181,
                "id": "chatcmpl-CSxoL7PFD0FJgKOle3ScY6d9GBAYn",
                "created": 1761019133,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "4": {
            "req_id": "78",
            "experiment_id": "run_4",
            "pred_tables": [
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['taxonomy']"
                },
                "in_toks": 612,
                "out_toks": 140,
                "id": "chatcmpl-CSsvxvYob8VKDpdRCUf47SLvQYMKN",
                "created": 1761000385,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 468,
                "out_toks": 143,
                "id": "chatcmpl-CSxf8qWgY0H0xHAjNxX0sUFRgjOh5",
                "created": 1761018562,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return name, version, and classes for the light curve classifier\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return name, version, and classes for the light curve classifier\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```"
                },
                "in_toks": 1786,
                "out_toks": 243,
                "id": "chatcmpl-CSxoTtpcd95Zu5mwKXDiw8pevC1Zk",
                "created": 1761019141,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "78",
            "experiment_id": "run_5",
            "pred_tables": [
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['taxonomy']"
                },
                "in_toks": 612,
                "out_toks": 140,
                "id": "chatcmpl-CZNUQj485WpvYOxL75zLisuyttCbj",
                "created": 1762547810,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 468,
                "out_toks": 207,
                "id": "chatcmpl-CZYqoJ5O2B9Imu53pW1JyVEOKIgDM",
                "created": 1762591482,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return classifier name, version, and classes for the light curve classifier\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return classifier name, version, and classes for the light curve classifier\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```"
                },
                "in_toks": 1786,
                "out_toks": 372,
                "id": "chatcmpl-CZaKu9o7uFaAgUtOATN6RVXObu0BE",
                "created": 1762597192,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "78",
            "experiment_id": "run_6",
            "pred_tables": [
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['taxonomy']"
                },
                "in_toks": 612,
                "out_toks": 76,
                "id": "chatcmpl-CZNUV3cCfO6daJQ0PmiyfrMIZYMkR",
                "created": 1762547815,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 468,
                "out_toks": 143,
                "id": "chatcmpl-CZYqtSH2QNIe2JrfAyrBIGrxaPsgk",
                "created": 1762591487,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return classifier name, version, and classes for the light curve classifier\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return classifier name, version, and classes for the light curve classifier\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```"
                },
                "in_toks": 1786,
                "out_toks": 244,
                "id": "chatcmpl-CZa5cTuE2wZZnwr1ylZQrwzgRg0mo",
                "created": 1762596244,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "7": {
            "req_id": "78",
            "experiment_id": "run_7",
            "pred_tables": [
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['taxonomy']"
                },
                "in_toks": 612,
                "out_toks": 140,
                "id": "chatcmpl-CZNUZ8qqQEZMG9kRtZy828KiFX6X9",
                "created": 1762547819,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 468,
                "out_toks": 143,
                "id": "chatcmpl-CZYqxnqSD9ao4Qne4XBhqI3J4gxs8",
                "created": 1762591491,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Taxonomy info for the light curve classifier\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Taxonomy info for the light curve classifier\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```"
                },
                "in_toks": 1786,
                "out_toks": 303,
                "id": "chatcmpl-CZaT9bbhMwgFonab7AF96hx5mxMRd",
                "created": 1762597703,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "78",
            "experiment_id": "run_8",
            "pred_tables": [
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['taxonomy']"
                },
                "in_toks": 612,
                "out_toks": 140,
                "id": "chatcmpl-CZNUd6lILMrWVqfbGHKr7D2C6NeLB",
                "created": 1762547823,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 468,
                "out_toks": 143,
                "id": "chatcmpl-CZYr1RslGbw9h22lEgIWGxTGBbe0E",
                "created": 1762591495,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Return name, version, and classes for the light curve classifier from taxonomy\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Return name, version, and classes for the light curve classifier from taxonomy\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```"
                },
                "in_toks": 1786,
                "out_toks": 373,
                "id": "chatcmpl-CZa8pmfBrAmzRqQ0yzVQErXum0Uu7",
                "created": 1762596443,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "78",
            "experiment_id": "run_9",
            "pred_tables": [
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['taxonomy']"
                },
                "in_toks": 612,
                "out_toks": 140,
                "id": "chatcmpl-CZNUi75yy4GssltW8nHTmsHRAe2jV",
                "created": 1762547828,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "simple",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'simple'}"
                },
                "in_toks": 468,
                "out_toks": 143,
                "id": "chatcmpl-CZYr3l4Ub1a0wLJiGy2BoXClJAJvM",
                "created": 1762591497,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": null,
            "sql_query_plan_response": null,
            "original_sql_query": "```sql\n-- Light curve classifier taxonomy info\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Light curve classifier taxonomy info\nSELECT\n    classifier_name,\n    classifier_version,\n    classes\nFROM taxonomy\nWHERE classifier_name = 'lc_classifier';\n```"
                },
                "in_toks": 1786,
                "out_toks": 428,
                "id": "chatcmpl-CZaTHep75qZgh0KgV9E1pukGms1Ac",
                "created": 1762597711,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    },
    "39": {
        "0": {
            "req_id": "39",
            "experiment_id": "run_0",
            "pred_tables": [
                "object",
                "probability",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'detection']",
                    "1": "['object', 'probability', 'taxonomy', 'detection']"
                },
                "in_toks": 705,
                "out_toks": 2603,
                "id": "chatcmpl-CSncqSm4oMNIlcuJuu5hpmByygdvW",
                "created": 1760979980,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Per-detection rows for CV/Nova (top-ranked by stochastic classifier), objects with <=50 detections,\n-- r-band only, returning corrected PSF magnitude and its error, plus per-object (r-band) max rise from min.\nWITH eligible_oids AS\n  (SELECT DISTINCT o.oid\n   FROM OBJECT o\n   JOIN probability p ON p.oid = o.oid\n   WHERE o.ndet <= 50\n     AND p.classifier_name = 'lc_classifier_stochastic' -- classifier filter\n\n     AND p.class_name = 'CV/Nova' -- class filter\n\n     AND p.ranking = 1 -- highest-probability class\n),\n     det_r AS\n  (SELECT d.oid,\n          d.candid,\n          d.fid AS f_id,\n          d.ra,\n          d.dec,\n          d.magpsf_corr,\n          d.sigmapsf_corr\n   FROM detection d\n   JOIN eligible_oids e ON e.oid = d.oid -- first narrow by oid to avoid wide scans on detection\n\n   WHERE d.fid = 2 -- r-band\n\n     AND d.corrected = TRUE -- ensure corrected magnitudes\n\n     AND d.magpsf_corr IS NOT NULL -- require corrected magnitude\n)\nSELECT d.oid,\n       d.candid,\n       d.f_id,\n       d.ra,\n       d.dec,\n       d.magpsf_corr,\n       d.sigmapsf_corr, -- per-object amplitude in r-band: max - min of corrected PSF magnitude\n (MAX(d.magpsf_corr) OVER (PARTITION BY d.oid) - MIN(d.magpsf_corr) OVER (PARTITION BY d.oid)) AS max_rise_from_min_r\nFROM det_r d\nORDER BY d.oid\nLIMIT 1000;",
            "sql_response": {
                "responses": {
                    "0": "-- Per-detection rows for CV/Nova (top-ranked by stochastic classifier), objects with <=50 detections,\n-- r-band only, returning corrected PSF magnitude and its error, plus per-object (r-band) max rise from min.\nWITH eligible_oids AS\n  (SELECT DISTINCT o.oid\n   FROM OBJECT o\n   JOIN probability p ON p.oid = o.oid\n   WHERE o.ndet <= 50\n     AND p.classifier_name = 'lc_classifier_stochastic' -- classifier filter\n\n     AND p.class_name = 'CV/Nova' -- class filter\n\n     AND p.ranking = 1 -- highest-probability class\n),\n     det_r AS\n  (SELECT d.oid,\n          d.candid,\n          d.fid AS f_id,\n          d.ra,\n          d.dec,\n          d.magpsf_corr,\n          d.sigmapsf_corr\n   FROM detection d\n   JOIN eligible_oids e ON e.oid = d.oid -- first narrow by oid to avoid wide scans on detection\n\n   WHERE d.fid = 2 -- r-band\n\n     AND d.corrected = TRUE -- ensure corrected magnitudes\n\n     AND d.magpsf_corr IS NOT NULL -- require corrected magnitude\n)\nSELECT d.oid,\n       d.candid,\n       d.f_id,\n       d.ra,\n       d.dec,\n       d.magpsf_corr,\n       d.sigmapsf_corr, -- per-object amplitude in r-band: max - min of corrected PSF magnitude\n (MAX(d.magpsf_corr) OVER (PARTITION BY d.oid) - MIN(d.magpsf_corr) OVER (PARTITION BY d.oid)) AS max_rise_from_min_r\nFROM det_r d\nORDER BY d.oid\nLIMIT 1000;"
                },
                "in_toks": 2470,
                "out_toks": 2435,
                "id": "chatcmpl-CbHcmXoucMem9lWnQ5inNRHdfCBFP",
                "created": 1763001920,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1730,
                "out_toks": 1615,
                "id": "chatcmpl-CSntL7Q75MfgH6WbhuFXV2ACy8p93",
                "created": 1760981003,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Get per-detection rows for CV/Nova (top-ranked) under the stochastic light curve classifier,\n-- restricted to objects with ndet <= 50, only r-band detections,\n-- including corrected PSF magnitude and its error, plus per-object max rise from min (r-band)\nWITH cls_cvstoch AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier_stochastic'\n     AND p.ranking = 1\n     AND p.class_name = 'CV/Nova'),\n     small_det_objs AS\n  (SELECT o.oid\n   FROM OBJECT o\n   WHERE o.ndet <= 50),\n     eligible_oids AS\n  (SELECT oid\n   FROM cls_cvstoch INTERSECT SELECT oid\n   FROM small_det_objs),\n     det_r AS\n  (SELECT d.oid,\n          d.candid,\n          d.fid AS f_id,\n          d.ra,\n          d.dec,\n          d.magpsf_corr,\n          d.sigmapsf_corr\n   FROM detection d\n   INNER JOIN eligible_oids e ON d.oid = e.oid\n   WHERE d.fid = 2 -- r-band\n),\n     amp_r AS\n  (SELECT d.oid,\n          MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS max_rise_from_min_r\n   FROM det_r d\n   GROUP BY d.oid)\nSELECT d.oid,\n       d.candid,\n       d.f_id,\n       d.ra,\n       d.dec,\n       d.magpsf_corr,\n       d.sigmapsf_corr,\n       a.max_rise_from_min_r\nFROM det_r d\nINNER JOIN amp_r a ON a.oid = d.oid\nORDER BY d.oid ASC\nLIMIT 1000;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\n- Return per-detection rows containing:\n  - object identifier (object.oid)\n  - candidate identifier (detection.candid)\n  - filter id as f_id (detection.fid AS f_id)\n  - coordinates (detection.ra, detection.dec)\n  - magnitude and magnitude errors (use corrected PSF magnitude and its error in r-band: detection.magpsf_corr, detection.sigmapsf_corr)\n  - Additionally compute, per object, the maximum rise from minimum (amplitude) using corrected PSF magnitudes in r-band: max(magpsf_corr) \u2212 min(magpsf_corr), joined back to each detection row\n- Filters:\n  - Only objects whose top-ranked class under the stochastic light curve classifier is 'CV/Nova' (probability.classifier_name = 'lc_classifier_stochastic', probability.ranking = 1, probability.class_name = 'CV/Nova')\n  - Objects with ndet \u2264 50 (object.ndet)\n  - Only r-band detections (detection.fid = 2)\n- Output:\n  - First 1000 rows, ordered by object identifier (oid ASC)\n\nTables involved\n- probability (filter objects by classifier, class, and ranking)\n- object (filter by ndet \u2264 50; optionally provide time boundaries)\n- detection (extract per-detection data and compute per-object r-band amplitude)\n\nStep-by-step plan\n\n1) Build a classification subquery (CTE) returning oids for CV/Nova under the stochastic classifier, top rank\n- Source: probability p\n- Columns: p.oid\n- Filters (explicitly overriding the general default classifier per the user request):\n  - p.classifier_name = 'lc_classifier_stochastic'\n  - p.ranking = 1\n  - p.class_name = 'CV/Nova'\n- Output CTE name: cls_cvstoch(oid)\n\n2) Build an ndet-limited objects subquery (CTE) for objects with at most 50 detections\n- Source: object o\n- Columns: o.oid, optionally include o.firstmjd, o.lastmjd if you want to later constrain detection times (not strictly necessary)\n- Filter: o.ndet <= 50\n- Output CTE name: small_det_objs(oid [, firstmjd, lastmjd])\n\n3) Determine eligible objects by intersecting classification and ndet filters\n- Operation: INTERSECT (set intersection) between:\n  - SELECT oid FROM cls_cvstoch\n  - SELECT oid FROM small_det_objs\n- Output CTE name: eligible_oids(oid)\n\n4) Build an r-band detection subquery restricted to eligible objects\n- Source: detection d\n- Join: INNER JOIN eligible_oids e ON d.oid = e.oid\n- Filters:\n  - d.fid = 2  (r-band)\n  - Optionally constrain detection times to the object\u2019s detection span by joining object if desired:\n    - INNER JOIN object o ON o.oid = d.oid\n    - AND d.mjd BETWEEN o.firstmjd AND o.lastmjd\n  - Note: the main filter must be on d.oid via the join to comply with the recommendation to avoid filtering detection on non-oid fields; apply fid = 2 after restricting by oid.\n- Columns to select for downstream use:\n  - d.oid\n  - d.candid\n  - d.fid AS f_id\n  - d.ra, d.dec\n  - d.magpsf_corr (corrected PSF magnitude; the requested \u201ccorrected difference magnitude in the r-band\u201d and also the \u201cPSF corrected magnitude in the r-filter\u201d)\n  - d.sigmapsf_corr (error for corrected PSF magnitude)\n  - Optionally, if you also want to expose non-corrected PSF magnitude and its error for reference:\n    - d.magpsf, d.sigmapsf (not required by the user, only include if desired)\n- Output CTE name: det_r(oid, candid, f_id, ra, dec, magpsf_corr, sigmapsf_corr [, magpsf, sigmapsf])\n\n5) Compute per-object maximum rise from minimum in r-band using corrected PSF magnitudes\n- Source: det_r d\n- Aggregation:\n  - For each d.oid, compute max_rise_mag_r = MAX(d.magpsf_corr) \u2212 MIN(d.magpsf_corr)\n- Group by: d.oid\n- Output CTE name: amp_r(oid, max_rise_mag_r)\n\n6) Produce the final result by joining detections to the per-object amplitude\n- Source: det_r d\n- Join: INNER JOIN amp_r a ON a.oid = d.oid\n- Columns to output (map to the user\u2019s requested fields):\n  - object identifier: d.oid\n  - candidate identifier: d.candid\n  - filter id as f_id: d.f_id\n  - coordinates: d.ra, d.dec\n  - magnitude: d.magpsf_corr (PSF corrected difference magnitude in r-band)\n  - magnitude errors: d.sigmapsf_corr\n  - include the derived per-object amplitude: a.max_rise_mag_r\n- Ordering: ORDER BY d.oid ASC\n- Limit: LIMIT 1000\n\nNotes and rationale\n- The classifier filter is explicitly set to 'lc_classifier_stochastic' and ranking = 1 with class_name = 'CV/Nova', as requested; this overrides the general default of 'lc_classifier'.\n- The ndet \u2264 50 constraint uses object.ndet, which counts total detections from discovery to last detection, matching the requirement.\n- Detections are restricted to fid = 2 (r-band) and are joined only after limiting by eligible oids to keep the detection scan efficient.\n- The per-object \u201cmaximum rise from minimum\u201d is computed as the range of corrected PSF magnitudes in r-band: MAX(magpsf_corr) \u2212 MIN(magpsf_corr), then joined back to each detection row for that object.\n- No Q3C spatial functions are needed since the query is not spatial.\n- Return the first 1000 rows, ordered by object identifier, as requested."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\n- Return per-detection rows containing:\n  - object identifier (object.oid)\n  - candidate identifier (detection.candid)\n  - filter id as f_id (detection.fid AS f_id)\n  - coordinates (detection.ra, detection.dec)\n  - magnitude and magnitude errors (use corrected PSF magnitude and its error in r-band: detection.magpsf_corr, detection.sigmapsf_corr)\n  - Additionally compute, per object, the maximum rise from minimum (amplitude) using corrected PSF magnitudes in r-band: max(magpsf_corr) \u2212 min(magpsf_corr), joined back to each detection row\n- Filters:\n  - Only objects whose top-ranked class under the stochastic light curve classifier is 'CV/Nova' (probability.classifier_name = 'lc_classifier_stochastic', probability.ranking = 1, probability.class_name = 'CV/Nova')\n  - Objects with ndet \u2264 50 (object.ndet)\n  - Only r-band detections (detection.fid = 2)\n- Output:\n  - First 1000 rows, ordered by object identifier (oid ASC)\n\nTables involved\n- probability (filter objects by classifier, class, and ranking)\n- object (filter by ndet \u2264 50; optionally provide time boundaries)\n- detection (extract per-detection data and compute per-object r-band amplitude)\n\nStep-by-step plan\n\n1) Build a classification subquery (CTE) returning oids for CV/Nova under the stochastic classifier, top rank\n- Source: probability p\n- Columns: p.oid\n- Filters (explicitly overriding the general default classifier per the user request):\n  - p.classifier_name = 'lc_classifier_stochastic'\n  - p.ranking = 1\n  - p.class_name = 'CV/Nova'\n- Output CTE name: cls_cvstoch(oid)\n\n2) Build an ndet-limited objects subquery (CTE) for objects with at most 50 detections\n- Source: object o\n- Columns: o.oid, optionally include o.firstmjd, o.lastmjd if you want to later constrain detection times (not strictly necessary)\n- Filter: o.ndet <= 50\n- Output CTE name: small_det_objs(oid [, firstmjd, lastmjd])\n\n3) Determine eligible objects by intersecting classification and ndet filters\n- Operation: INTERSECT (set intersection) between:\n  - SELECT oid FROM cls_cvstoch\n  - SELECT oid FROM small_det_objs\n- Output CTE name: eligible_oids(oid)\n\n4) Build an r-band detection subquery restricted to eligible objects\n- Source: detection d\n- Join: INNER JOIN eligible_oids e ON d.oid = e.oid\n- Filters:\n  - d.fid = 2  (r-band)\n  - Optionally constrain detection times to the object\u2019s detection span by joining object if desired:\n    - INNER JOIN object o ON o.oid = d.oid\n    - AND d.mjd BETWEEN o.firstmjd AND o.lastmjd\n  - Note: the main filter must be on d.oid via the join to comply with the recommendation to avoid filtering detection on non-oid fields; apply fid = 2 after restricting by oid.\n- Columns to select for downstream use:\n  - d.oid\n  - d.candid\n  - d.fid AS f_id\n  - d.ra, d.dec\n  - d.magpsf_corr (corrected PSF magnitude; the requested \u201ccorrected difference magnitude in the r-band\u201d and also the \u201cPSF corrected magnitude in the r-filter\u201d)\n  - d.sigmapsf_corr (error for corrected PSF magnitude)\n  - Optionally, if you also want to expose non-corrected PSF magnitude and its error for reference:\n    - d.magpsf, d.sigmapsf (not required by the user, only include if desired)\n- Output CTE name: det_r(oid, candid, f_id, ra, dec, magpsf_corr, sigmapsf_corr [, magpsf, sigmapsf])\n\n5) Compute per-object maximum rise from minimum in r-band using corrected PSF magnitudes\n- Source: det_r d\n- Aggregation:\n  - For each d.oid, compute max_rise_mag_r = MAX(d.magpsf_corr) \u2212 MIN(d.magpsf_corr)\n- Group by: d.oid\n- Output CTE name: amp_r(oid, max_rise_mag_r)\n\n6) Produce the final result by joining detections to the per-object amplitude\n- Source: det_r d\n- Join: INNER JOIN amp_r a ON a.oid = d.oid\n- Columns to output (map to the user\u2019s requested fields):\n  - object identifier: d.oid\n  - candidate identifier: d.candid\n  - filter id as f_id: d.f_id\n  - coordinates: d.ra, d.dec\n  - magnitude: d.magpsf_corr (PSF corrected difference magnitude in r-band)\n  - magnitude errors: d.sigmapsf_corr\n  - include the derived per-object amplitude: a.max_rise_mag_r\n- Ordering: ORDER BY d.oid ASC\n- Limit: LIMIT 1000\n\nNotes and rationale\n- The classifier filter is explicitly set to 'lc_classifier_stochastic' and ranking = 1 with class_name = 'CV/Nova', as requested; this overrides the general default of 'lc_classifier'.\n- The ndet \u2264 50 constraint uses object.ndet, which counts total detections from discovery to last detection, matching the requirement.\n- Detections are restricted to fid = 2 (r-band) and are joined only after limiting by eligible oids to keep the detection scan efficient.\n- The per-object \u201cmaximum rise from minimum\u201d is computed as the range of corrected PSF magnitudes in r-band: MAX(magpsf_corr) \u2212 MIN(magpsf_corr), then joined back to each detection row for that object.\n- No Q3C spatial functions are needed since the query is not spatial.\n- Return the first 1000 rows, ordered by object identifier, as requested."
                    },
                    "in_toks": 3608,
                    "out_toks": 5093,
                    "id": "chatcmpl-Cb6vMSR1NiMrfBqbmqdqXuzMdHE1f",
                    "created": 1762960788,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Get per-detection rows for CV/Nova (top-ranked) under the stochastic light curve classifier,\n-- restricted to objects with ndet <= 50, only r-band detections,\n-- including corrected PSF magnitude and its error, plus per-object max rise from min (r-band)\nWITH cls_cvstoch AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier_stochastic'\n     AND p.ranking = 1\n     AND p.class_name = 'CV/Nova'),\n     small_det_objs AS\n  (SELECT o.oid\n   FROM OBJECT o\n   WHERE o.ndet <= 50),\n     eligible_oids AS\n  (SELECT oid\n   FROM cls_cvstoch INTERSECT SELECT oid\n   FROM small_det_objs),\n     det_r AS\n  (SELECT d.oid,\n          d.candid,\n          d.fid AS f_id,\n          d.ra,\n          d.dec,\n          d.magpsf_corr,\n          d.sigmapsf_corr\n   FROM detection d\n   INNER JOIN eligible_oids e ON d.oid = e.oid\n   WHERE d.fid = 2 -- r-band\n),\n     amp_r AS\n  (SELECT d.oid,\n          MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS max_rise_from_min_r\n   FROM det_r d\n   GROUP BY d.oid)\nSELECT d.oid,\n       d.candid,\n       d.f_id,\n       d.ra,\n       d.dec,\n       d.magpsf_corr,\n       d.sigmapsf_corr,\n       a.max_rise_from_min_r\nFROM det_r d\nINNER JOIN amp_r a ON a.oid = d.oid\nORDER BY d.oid ASC\nLIMIT 1000;"
                        },
                        "in_toks": 3577,
                        "out_toks": 2116,
                        "id": "chatcmpl-Cb6x6oqfrSL2etHRldCJmOAqsXBeZ",
                        "created": 1762960896,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "1": {
            "req_id": "39",
            "experiment_id": "run_1",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'detection']",
                    "1": "['object', 'probability', 'taxonomy', 'detection']"
                },
                "in_toks": 705,
                "out_toks": 2603,
                "id": "chatcmpl-CSncqSm4oMNIlcuJuu5hpmByygdvW",
                "created": 1760979980,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1775,
                "out_toks": 1231,
                "id": "chatcmpl-CSntxq4N7nGCeSf3yDrTHkilpRsEO",
                "created": 1760981041,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3653,
                "out_toks": 4000,
                "id": "chatcmpl-CSqsOcXDVEctvPhrHSan1VuUSH1Zc",
                "created": 1760992476,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- CV/Nova objects according to the stochastic light curve classifier (rank 1)\n-- r-band detections (fid=2), using corrected PSF magnitudes\n-- Only objects with at most 50 detections (object.ndet <= 50)\n-- Returns object identifier, candidate identifier, filter id (as f_id), coordinates, magnitudes, magnitude errors,\n-- and per-object maximum rise from minimum (based on r-band magpsf_corr)\nSELECT\n    d.oid,\n    d.candid,\n    d.fid AS f_id,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf,\n    d.magpsf_corr,\n    d.sigmapsf_corr,\n    d.sigmapsf_corr_ext,\n    MAX(d.magpsf_corr) OVER (PARTITION BY d.oid) - MIN(d.magpsf_corr) OVER (PARTITION BY d.oid) AS max_rise_from_min_r\nFROM detection d\nINNER JOIN object o ON o.oid = d.oid\nWHERE\n    o.ndet <= 50\n    AND d.fid = 2\n    AND d.corrected = TRUE\n    AND EXISTS (\n        SELECT 1\n        FROM probability p\n        WHERE\n            p.oid = d.oid\n            AND p.classifier_name = 'lc_classifier_stochastic'\n            AND p.class_name = 'CV/Nova'\n            AND p.ranking = 1\n    )\nORDER BY d.oid\nLIMIT 1000;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- CV/Nova objects according to the stochastic light curve classifier (rank 1)\n-- r-band detections (fid=2), using corrected PSF magnitudes\n-- Only objects with at most 50 detections (object.ndet <= 50)\n-- Returns object identifier, candidate identifier, filter id (as f_id), coordinates, magnitudes, magnitude errors,\n-- and per-object maximum rise from minimum (based on r-band magpsf_corr)\nSELECT\n    d.oid,\n    d.candid,\n    d.fid AS f_id,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf,\n    d.magpsf_corr,\n    d.sigmapsf_corr,\n    d.sigmapsf_corr_ext,\n    MAX(d.magpsf_corr) OVER (PARTITION BY d.oid) - MIN(d.magpsf_corr) OVER (PARTITION BY d.oid) AS max_rise_from_min_r\nFROM detection d\nINNER JOIN object o ON o.oid = d.oid\nWHERE\n    o.ndet <= 50\n    AND d.fid = 2\n    AND d.corrected = TRUE\n    AND EXISTS (\n        SELECT 1\n        FROM probability p\n        WHERE\n            p.oid = d.oid\n            AND p.classifier_name = 'lc_classifier_stochastic'\n            AND p.class_name = 'CV/Nova'\n            AND p.ranking = 1\n    )\nORDER BY d.oid\nLIMIT 1000;\n```"
                },
                "in_toks": 3092,
                "out_toks": 3270,
                "id": "chatcmpl-CSr6hXk3iXEQsRgaZooB8mHKM1XoV",
                "created": 1760993363,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "2": {
            "req_id": "39",
            "experiment_id": "run_2",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'detection']"
                },
                "in_toks": 705,
                "out_toks": 1751,
                "id": "chatcmpl-CSsw1fcpCVocXQJSfPDaLcAx0jndC",
                "created": 1761000389,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Get r-band detections (with corrected PSF magnitude) for objects with:\n-- - Top-1 CV/Nova class under the stochastic light curve classifier\n-- - Total detections <= 50\n-- Also compute per-object (r-band) max rise from minimum in magpsf_corr\nWITH eligible AS\n  (SELECT o.oid\n   FROM OBJECT o\n   WHERE o.ndet <= 50\n     AND EXISTS\n       (SELECT 1\n        FROM probability p\n        WHERE p.oid = o.oid\n          AND p.classifier_name = 'lc_classifier_stochastic'\n          AND p.class_name = 'CV/Nova'\n          AND p.ranking = 1))\nSELECT d.oid,\n       d.candid,\n       d.fid AS f_id,\n       d.ra,\n       d.dec,\n       d.magpsf,\n       d.sigmapsf,\n       d.magpsf_corr,\n       d.sigmapsf_corr, -- per-object range in corrected r-band magnitude\n MAX(d.magpsf_corr) OVER (PARTITION BY d.oid) - MIN(d.magpsf_corr) OVER (PARTITION BY d.oid) AS max_rise_from_min\nFROM detection d\nJOIN eligible e ON e.oid = d.oid\nWHERE d.fid = 2 -- r-band\n\n  AND d.magpsf_corr IS NOT NULL\nORDER BY d.oid\nLIMIT 1000;",
            "sql_response": {
                "responses": {
                    "0": "-- Get r-band detections (with corrected PSF magnitude) for objects with:\n-- - Top-1 CV/Nova class under the stochastic light curve classifier\n-- - Total detections <= 50\n-- Also compute per-object (r-band) max rise from minimum in magpsf_corr\nWITH eligible AS\n  (SELECT o.oid\n   FROM OBJECT o\n   WHERE o.ndet <= 50\n     AND EXISTS\n       (SELECT 1\n        FROM probability p\n        WHERE p.oid = o.oid\n          AND p.classifier_name = 'lc_classifier_stochastic'\n          AND p.class_name = 'CV/Nova'\n          AND p.ranking = 1))\nSELECT d.oid,\n       d.candid,\n       d.fid AS f_id,\n       d.ra,\n       d.dec,\n       d.magpsf,\n       d.sigmapsf,\n       d.magpsf_corr,\n       d.sigmapsf_corr, -- per-object range in corrected r-band magnitude\n MAX(d.magpsf_corr) OVER (PARTITION BY d.oid) - MIN(d.magpsf_corr) OVER (PARTITION BY d.oid) AS max_rise_from_min\nFROM detection d\nJOIN eligible e ON e.oid = d.oid\nWHERE d.fid = 2 -- r-band\n\n  AND d.magpsf_corr IS NOT NULL\nORDER BY d.oid\nLIMIT 1000;"
                },
                "in_toks": 2703,
                "out_toks": 3383,
                "id": "chatcmpl-CbHducEqhH9DQvstDzW9MiSXAX8lV",
                "created": 1763001990,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1775,
                "out_toks": 1423,
                "id": "chatcmpl-CSxfBL9uyfTcUdT0wgcu4N5ixSbHb",
                "created": 1761018565,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- CV/Nova (top-1 under stochastic LC classifier), ndet <= 50\n-- r-band detections with corrected PSF magnitude; attach per-object max rise from minimum (range) in magpsf_corr (r-band)\nWITH P_CV AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier_stochastic'\n     AND p.class_name = 'CV/Nova'\n     AND p.ranking = 1),\n     O_DET AS\n  (SELECT o.oid,\n          o.firstmjd,\n          o.lastmjd,\n          o.ndet\n   FROM OBJECT o\n   WHERE o.ndet <= 50),\n     ELIGIBLE_OIDS AS\n  (SELECT oid\n   FROM P_CV INTERSECT SELECT oid\n   FROM O_DET),\n     D_R AS\n  (SELECT d.oid,\n          d.candid,\n          d.fid,\n          d.ra,\n          d.dec,\n          d.mjd,\n          d.magpsf,\n          d.sigmapsf,\n          d.magpsf_corr,\n          d.sigmapsf_corr\n   FROM detection d\n   INNER JOIN ELIGIBLE_OIDS eo ON d.oid = eo.oid\n   WHERE d.fid = 2\n     AND d.magpsf_corr IS NOT NULL),\n     D_R_IN_WINDOW AS\n  (SELECT dr.*\n   FROM D_R dr\n   INNER JOIN O_DET o ON dr.oid = o.oid\n   WHERE dr.mjd BETWEEN o.firstmjd AND o.lastmjd),\n     MAX_RISE AS\n  (SELECT oid,\n          MAX(magpsf_corr) - MIN(magpsf_corr) AS max_rise_from_min\n   FROM D_R_IN_WINDOW\n   GROUP BY oid)\nSELECT dr.oid,\n       dr.candid,\n       dr.fid AS f_id,\n       dr.ra,\n       dr.dec,\n       dr.magpsf,\n       dr.sigmapsf,\n       dr.magpsf_corr,\n       dr.sigmapsf_corr,\n       mr.max_rise_from_min\nFROM D_R_IN_WINDOW dr\nINNER JOIN MAX_RISE mr ON dr.oid = mr.oid\nORDER BY dr.oid\nLIMIT 1000;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query on the ALeRCE database\n\nGoal\n- Return, for CV/Nova objects (top-1 class under the stochastic LC classifier) with at most 50 detections, the per-detection fields:\n  - object identifier (object.oid)\n  - candidate identifier (detection.candid)\n  - filter id as f_id (detection.fid AS f_id)\n  - coordinates (detection.ra, detection.dec)\n  - magnitude and magnitude errors (use both PSF difference magnitude and its error, and their corrected counterparts)\n- Restrict detections to the r-band (fid = 2) and use the corrected difference magnitude (detection.magpsf_corr) in r-band.\n- Also compute the \u201cmaximum rise from minimum\u201d (range) in PSF corrected magnitude in r-band per object, and attach that value to each detection row for that object.\n- Return the first 1000 rows, ordered by object identifier.\n\nTables and columns to use\n- object(o): oid, ndet, firstmjd, lastmjd\n- probability(p): oid, class_name, classifier_name, classifier_version, probability, ranking\n- detection(d): oid, candid, mjd, fid, ra, dec, magpsf, sigmapsf, magpsf_corr, sigmapsf_corr, corrected\n- Note: r-band is fid = 2.\n\nDefault probability conditions and explicit override\n- Use ranking = 1.\n- Because the user explicitly requested the stochastic light curve classifier, set classifier_name = 'lc_classifier_stochastic'.\n- Select only class_name = 'CV/Nova'.\n\nStep-by-step plan\n\n1) Build a probability filter subquery (P_CV)\n- Purpose: select CV/Nova objects (top-1) under the stochastic light curve classifier.\n- From probability p\n- Conditions:\n  - p.classifier_name = 'lc_classifier_stochastic'\n  - p.class_name = 'CV/Nova'\n  - p.ranking = 1\n- Output columns: p.oid (distinct), and optionally p.probability if you want to keep the class probability (not required in final output).\n\n2) Build an object filter subquery (O_DET)\n- Purpose: enforce the detection-count constraint \u201cat most 50 from discovery to last detection.\u201d\n- From object o\n- Condition: o.ndet <= 50\n- Output columns: o.oid, o.firstmjd, o.lastmjd, o.ndet\n\n3) Compute eligible object set via INTERSECT (ELIGIBLE_OIDS)\n- Purpose: obtain objects that satisfy both subqueries above.\n- Subquery A: SELECT oid FROM P_CV\n- Subquery B: SELECT oid FROM O_DET\n- ELIGIBLE_OIDS = (Subquery A) INTERSECT (Subquery B)\n- Output column: oid\n\n4) Build two r-band corrected detection subqueries and UNION them (D_R)\n- Purpose: collect r-band detections that have corrected magnitudes available, robustly combining complementary conditions; this also demonstrates UNION as requested.\n- D_R1:\n  - From detection d\n  - Join ELIGIBLE_OIDS eo ON d.oid = eo.oid\n  - Conditions:\n    - d.fid = 2  (r-band)\n    - d.corrected = true\n    - d.magpsf_corr IS NOT NULL  (ensure corrected magnitude is available)\n  - Output columns: d.oid, d.candid, d.fid, d.ra, d.dec, d.mjd, d.magpsf, d.sigmapsf, d.magpsf_corr, d.sigmapsf_corr\n- D_R2:\n  - From detection d\n  - Join ELIGIBLE_OIDS eo ON d.oid = eo.oid\n  - Conditions:\n    - d.fid = 2\n    - d.magpsf_corr IS NOT NULL  (covers cases where corrected is present even if d.corrected flag isn\u2019t set)\n  - Output columns: same as D_R1\n- D_R = (D_R1 UNION SELECT ... FROM D_R2)  (UNION removes duplicates)\n- Note: Keep mjd in D_R for optional temporal filters and clarity, even if not selected in the final output.\n\n5) Optional temporal sanity filter with object time bounds (D_R_IN_WINDOW)\n- Purpose: ensure detections lie between discovery and last detection timestamps.\n- From D_R dr\n- Inner join object o ON dr.oid = o.oid\n- Condition: dr.mjd BETWEEN o.firstmjd AND o.lastmjd\n- Output columns: dr.oid, dr.candid, dr.fid, dr.ra, dr.dec, dr.mjd, dr.magpsf, dr.sigmapsf, dr.magpsf_corr, dr.sigmapsf_corr\n- Note: If you trust detections are already within [firstmjd, lastmjd], you can omit this step. Otherwise, include it.\n\n6) Compute per-object r-band corrected magnitude range (MAX_RISE)\n- Purpose: determine \u201cmaximum rise from minimum\u201d in PSF corrected magnitude in r-band per object. Implement as range = MAX(magpsf_corr) - MIN(magpsf_corr).\n- From D_R_IN_WINDOW (or D_R if Step 5 omitted)\n- Group by oid\n- Aggregates:\n  - min_mag_r = MIN(magpsf_corr)\n  - max_mag_r = MAX(magpsf_corr)\n  - max_rise_from_min = max_mag_r - min_mag_r\n- Output columns: oid, max_rise_from_min\n\n7) Assemble the final result set (FINAL_ROWS)\n- From D_R_IN_WINDOW dr\n- Inner join MAX_RISE r ON dr.oid = r.oid\n- Inner join object o ON dr.oid = o.oid  (if Step 5 omitted; otherwise o already used)\n- Inner join P_CV p ON dr.oid = p.oid  (to strictly enforce CV/Nova top-1 stochastic classifier membership from Step 1)\n- Columns to SELECT:\n  - dr.oid AS oid  (object identifier)\n  - dr.candid  (candidate identifier)\n  - dr.fid AS f_id  (filter id, will be 2)\n  - dr.ra, dr.dec  (coordinates)\n  - dr.magpsf AS mag  (PSF difference magnitude)\n  - dr.sigmapsf AS mag_err  (PSF difference magnitude error)\n  - dr.magpsf_corr AS mag_corr_r  (PSF corrected magnitude in r-band; \u201ccorrected difference magnitude in r-band\u201d)\n  - dr.sigmapsf_corr AS mag_corr_err_r  (error of PSF corrected magnitude)\n  - r.max_rise_from_min  (per-object range in PSF corrected r-band magnitude)\n- Where conditions to keep/enforce:\n  - Ensure fid = 2 via the r-band subqueries above\n  - Implicitly restricted to CV/Nova and ndet <= 50 via earlier steps\n\n8) Order and limit\n- ORDER BY oid ASC\n- LIMIT 1000\n\nNotes on performance and correctness\n- The highest selectivity filters (probability and ndet) are applied first, then intersected, to minimize detections scanned.\n- The detection table is only indexed on oid; hence early restriction to ELIGIBLE_OIDS substantially reduces I/O.\n- UNION in Step 4 avoids duplicates while ensuring robustness in how \u201ccorrected\u201d detections are captured.\n- If desired, you can add p.probability to the final select for inspection of classification confidence (not requested).\n- No Q3C spatial filtering is needed, since the request doesn\u2019t specify sky regions; coordinates are returned directly from detection.ra/dec.\n\nFinal output semantics recap\n- Each row corresponds to a single r-band detection (candid) belonging to a CV/Nova object (top-1 under lc_classifier_stochastic) with object.ndet <= 50.\n- Returned fields: oid, candid, f_id, ra, dec, PSF difference magnitude and error (magpsf, sigmapsf), PSF corrected magnitude and error in r-band (magpsf_corr, sigmapsf_corr), plus the object-level maximum rise from minimum in the PSF corrected r-band magnitude (max_rise_from_min).\n- Sorted by oid; first 1000 rows returned."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query on the ALeRCE database\n\nGoal\n- Return, for CV/Nova objects (top-1 class under the stochastic LC classifier) with at most 50 detections, the per-detection fields:\n  - object identifier (object.oid)\n  - candidate identifier (detection.candid)\n  - filter id as f_id (detection.fid AS f_id)\n  - coordinates (detection.ra, detection.dec)\n  - magnitude and magnitude errors (use both PSF difference magnitude and its error, and their corrected counterparts)\n- Restrict detections to the r-band (fid = 2) and use the corrected difference magnitude (detection.magpsf_corr) in r-band.\n- Also compute the \u201cmaximum rise from minimum\u201d (range) in PSF corrected magnitude in r-band per object, and attach that value to each detection row for that object.\n- Return the first 1000 rows, ordered by object identifier.\n\nTables and columns to use\n- object(o): oid, ndet, firstmjd, lastmjd\n- probability(p): oid, class_name, classifier_name, classifier_version, probability, ranking\n- detection(d): oid, candid, mjd, fid, ra, dec, magpsf, sigmapsf, magpsf_corr, sigmapsf_corr, corrected\n- Note: r-band is fid = 2.\n\nDefault probability conditions and explicit override\n- Use ranking = 1.\n- Because the user explicitly requested the stochastic light curve classifier, set classifier_name = 'lc_classifier_stochastic'.\n- Select only class_name = 'CV/Nova'.\n\nStep-by-step plan\n\n1) Build a probability filter subquery (P_CV)\n- Purpose: select CV/Nova objects (top-1) under the stochastic light curve classifier.\n- From probability p\n- Conditions:\n  - p.classifier_name = 'lc_classifier_stochastic'\n  - p.class_name = 'CV/Nova'\n  - p.ranking = 1\n- Output columns: p.oid (distinct), and optionally p.probability if you want to keep the class probability (not required in final output).\n\n2) Build an object filter subquery (O_DET)\n- Purpose: enforce the detection-count constraint \u201cat most 50 from discovery to last detection.\u201d\n- From object o\n- Condition: o.ndet <= 50\n- Output columns: o.oid, o.firstmjd, o.lastmjd, o.ndet\n\n3) Compute eligible object set via INTERSECT (ELIGIBLE_OIDS)\n- Purpose: obtain objects that satisfy both subqueries above.\n- Subquery A: SELECT oid FROM P_CV\n- Subquery B: SELECT oid FROM O_DET\n- ELIGIBLE_OIDS = (Subquery A) INTERSECT (Subquery B)\n- Output column: oid\n\n4) Build two r-band corrected detection subqueries and UNION them (D_R)\n- Purpose: collect r-band detections that have corrected magnitudes available, robustly combining complementary conditions; this also demonstrates UNION as requested.\n- D_R1:\n  - From detection d\n  - Join ELIGIBLE_OIDS eo ON d.oid = eo.oid\n  - Conditions:\n    - d.fid = 2  (r-band)\n    - d.corrected = true\n    - d.magpsf_corr IS NOT NULL  (ensure corrected magnitude is available)\n  - Output columns: d.oid, d.candid, d.fid, d.ra, d.dec, d.mjd, d.magpsf, d.sigmapsf, d.magpsf_corr, d.sigmapsf_corr\n- D_R2:\n  - From detection d\n  - Join ELIGIBLE_OIDS eo ON d.oid = eo.oid\n  - Conditions:\n    - d.fid = 2\n    - d.magpsf_corr IS NOT NULL  (covers cases where corrected is present even if d.corrected flag isn\u2019t set)\n  - Output columns: same as D_R1\n- D_R = (D_R1 UNION SELECT ... FROM D_R2)  (UNION removes duplicates)\n- Note: Keep mjd in D_R for optional temporal filters and clarity, even if not selected in the final output.\n\n5) Optional temporal sanity filter with object time bounds (D_R_IN_WINDOW)\n- Purpose: ensure detections lie between discovery and last detection timestamps.\n- From D_R dr\n- Inner join object o ON dr.oid = o.oid\n- Condition: dr.mjd BETWEEN o.firstmjd AND o.lastmjd\n- Output columns: dr.oid, dr.candid, dr.fid, dr.ra, dr.dec, dr.mjd, dr.magpsf, dr.sigmapsf, dr.magpsf_corr, dr.sigmapsf_corr\n- Note: If you trust detections are already within [firstmjd, lastmjd], you can omit this step. Otherwise, include it.\n\n6) Compute per-object r-band corrected magnitude range (MAX_RISE)\n- Purpose: determine \u201cmaximum rise from minimum\u201d in PSF corrected magnitude in r-band per object. Implement as range = MAX(magpsf_corr) - MIN(magpsf_corr).\n- From D_R_IN_WINDOW (or D_R if Step 5 omitted)\n- Group by oid\n- Aggregates:\n  - min_mag_r = MIN(magpsf_corr)\n  - max_mag_r = MAX(magpsf_corr)\n  - max_rise_from_min = max_mag_r - min_mag_r\n- Output columns: oid, max_rise_from_min\n\n7) Assemble the final result set (FINAL_ROWS)\n- From D_R_IN_WINDOW dr\n- Inner join MAX_RISE r ON dr.oid = r.oid\n- Inner join object o ON dr.oid = o.oid  (if Step 5 omitted; otherwise o already used)\n- Inner join P_CV p ON dr.oid = p.oid  (to strictly enforce CV/Nova top-1 stochastic classifier membership from Step 1)\n- Columns to SELECT:\n  - dr.oid AS oid  (object identifier)\n  - dr.candid  (candidate identifier)\n  - dr.fid AS f_id  (filter id, will be 2)\n  - dr.ra, dr.dec  (coordinates)\n  - dr.magpsf AS mag  (PSF difference magnitude)\n  - dr.sigmapsf AS mag_err  (PSF difference magnitude error)\n  - dr.magpsf_corr AS mag_corr_r  (PSF corrected magnitude in r-band; \u201ccorrected difference magnitude in r-band\u201d)\n  - dr.sigmapsf_corr AS mag_corr_err_r  (error of PSF corrected magnitude)\n  - r.max_rise_from_min  (per-object range in PSF corrected r-band magnitude)\n- Where conditions to keep/enforce:\n  - Ensure fid = 2 via the r-band subqueries above\n  - Implicitly restricted to CV/Nova and ndet <= 50 via earlier steps\n\n8) Order and limit\n- ORDER BY oid ASC\n- LIMIT 1000\n\nNotes on performance and correctness\n- The highest selectivity filters (probability and ndet) are applied first, then intersected, to minimize detections scanned.\n- The detection table is only indexed on oid; hence early restriction to ELIGIBLE_OIDS substantially reduces I/O.\n- UNION in Step 4 avoids duplicates while ensuring robustness in how \u201ccorrected\u201d detections are captured.\n- If desired, you can add p.probability to the final select for inspection of classification confidence (not requested).\n- No Q3C spatial filtering is needed, since the request doesn\u2019t specify sky regions; coordinates are returned directly from detection.ra/dec.\n\nFinal output semantics recap\n- Each row corresponds to a single r-band detection (candid) belonging to a CV/Nova object (top-1 under lc_classifier_stochastic) with object.ndet <= 50.\n- Returned fields: oid, candid, f_id, ra, dec, PSF difference magnitude and error (magpsf, sigmapsf), PSF corrected magnitude and error in r-band (magpsf_corr, sigmapsf_corr), plus the object-level maximum rise from minimum in the PSF corrected r-band magnitude (max_rise_from_min).\n- Sorted by oid; first 1000 rows returned."
                    },
                    "in_toks": 3653,
                    "out_toks": 6304,
                    "id": "chatcmpl-Cb6xaEp8qCGkJWHctefArjRXXmenY",
                    "created": 1762960926,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- CV/Nova (top-1 under stochastic LC classifier), ndet <= 50\n-- r-band detections with corrected PSF magnitude; attach per-object max rise from minimum (range) in magpsf_corr (r-band)\nWITH P_CV AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier_stochastic'\n     AND p.class_name = 'CV/Nova'\n     AND p.ranking = 1),\n     O_DET AS\n  (SELECT o.oid,\n          o.firstmjd,\n          o.lastmjd,\n          o.ndet\n   FROM OBJECT o\n   WHERE o.ndet <= 50),\n     ELIGIBLE_OIDS AS\n  (SELECT oid\n   FROM P_CV INTERSECT SELECT oid\n   FROM O_DET),\n     D_R AS\n  (SELECT d.oid,\n          d.candid,\n          d.fid,\n          d.ra,\n          d.dec,\n          d.mjd,\n          d.magpsf,\n          d.sigmapsf,\n          d.magpsf_corr,\n          d.sigmapsf_corr\n   FROM detection d\n   INNER JOIN ELIGIBLE_OIDS eo ON d.oid = eo.oid\n   WHERE d.fid = 2\n     AND d.magpsf_corr IS NOT NULL),\n     D_R_IN_WINDOW AS\n  (SELECT dr.*\n   FROM D_R dr\n   INNER JOIN O_DET o ON dr.oid = o.oid\n   WHERE dr.mjd BETWEEN o.firstmjd AND o.lastmjd),\n     MAX_RISE AS\n  (SELECT oid,\n          MAX(magpsf_corr) - MIN(magpsf_corr) AS max_rise_from_min\n   FROM D_R_IN_WINDOW\n   GROUP BY oid)\nSELECT dr.oid,\n       dr.candid,\n       dr.fid AS f_id,\n       dr.ra,\n       dr.dec,\n       dr.magpsf,\n       dr.sigmapsf,\n       dr.magpsf_corr,\n       dr.sigmapsf_corr,\n       mr.max_rise_from_min\nFROM D_R_IN_WINDOW dr\nINNER JOIN MAX_RISE mr ON dr.oid = mr.oid\nORDER BY dr.oid\nLIMIT 1000;"
                        },
                        "in_toks": 4065,
                        "out_toks": 2651,
                        "id": "chatcmpl-Cb6zhXURLpk5p7oQGs40F8agVTbT7",
                        "created": 1762961057,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "3": {
            "req_id": "39",
            "experiment_id": "run_3",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'detection']"
                },
                "in_toks": 705,
                "out_toks": 1751,
                "id": "chatcmpl-CSswNecBrY36xhmCwl2L8oj4Ly3b1",
                "created": 1761000411,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query: limit detection scans by precomputing eligible oids, prefilter r-band detections,\n-- and aggregate amplitude from that reduced set. Uses required probability conditions with ranking=1.\nWITH eligible_oids AS\n  (-- Objects whose top stochastic class is CV/Nova and with at most 50 detections\n SELECT o.oid\n   FROM OBJECT o\n   JOIN probability p ON p.oid = o.oid\n   AND p.classifier_name = 'lc_classifier_stochastic'\n   AND p.class_name = 'CV/Nova'\n   AND p.ranking = 1\n   WHERE o.ndet <= 50 -- Ensure at least one valid r-band corrected detection exists\n\n     AND EXISTS\n       (SELECT 1\n        FROM detection d\n        WHERE d.oid = o.oid\n          AND d.fid = 2\n          AND d.corrected = TRUE\n          AND d.magpsf_corr IS NOT NULL)),\n     det_r AS\n  (-- Only r-band, corrected detections for eligible objects\n SELECT d.oid,\n        d.candid,\n        d.fid,\n        d.ra,\n        d.dec,\n        d.magpsf,\n        d.sigmapsf,\n        d.magpsf_corr,\n        d.sigmapsf_corr\n   FROM detection d\n   JOIN eligible_oids e ON e.oid = d.oid\n   WHERE d.fid = 2\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL),\n     amp_r AS\n  (-- Per-object amplitude in r-band (max rise from min using corrected PSF mag)\n SELECT dr.oid,\n        MAX(dr.magpsf_corr) - MIN(dr.magpsf_corr) AS max_rise_r\n   FROM det_r dr\n   GROUP BY dr.oid)\nSELECT dr.oid,\n       dr.candid,\n       dr.fid AS f_id,\n       dr.ra,\n       dr.dec,\n       dr.magpsf,\n       dr.sigmapsf,\n       dr.magpsf_corr,\n       dr.sigmapsf_corr,\n       ar.max_rise_r\nFROM det_r dr\nLEFT JOIN amp_r ar ON dr.oid = ar.oid\nORDER BY dr.oid\nLIMIT 1000;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query: limit detection scans by precomputing eligible oids, prefilter r-band detections,\n-- and aggregate amplitude from that reduced set. Uses required probability conditions with ranking=1.\nWITH eligible_oids AS\n  (-- Objects whose top stochastic class is CV/Nova and with at most 50 detections\n SELECT o.oid\n   FROM OBJECT o\n   JOIN probability p ON p.oid = o.oid\n   AND p.classifier_name = 'lc_classifier_stochastic'\n   AND p.class_name = 'CV/Nova'\n   AND p.ranking = 1\n   WHERE o.ndet <= 50 -- Ensure at least one valid r-band corrected detection exists\n\n     AND EXISTS\n       (SELECT 1\n        FROM detection d\n        WHERE d.oid = o.oid\n          AND d.fid = 2\n          AND d.corrected = TRUE\n          AND d.magpsf_corr IS NOT NULL)),\n     det_r AS\n  (-- Only r-band, corrected detections for eligible objects\n SELECT d.oid,\n        d.candid,\n        d.fid,\n        d.ra,\n        d.dec,\n        d.magpsf,\n        d.sigmapsf,\n        d.magpsf_corr,\n        d.sigmapsf_corr\n   FROM detection d\n   JOIN eligible_oids e ON e.oid = d.oid\n   WHERE d.fid = 2\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL),\n     amp_r AS\n  (-- Per-object amplitude in r-band (max rise from min using corrected PSF mag)\n SELECT dr.oid,\n        MAX(dr.magpsf_corr) - MIN(dr.magpsf_corr) AS max_rise_r\n   FROM det_r dr\n   GROUP BY dr.oid)\nSELECT dr.oid,\n       dr.candid,\n       dr.fid AS f_id,\n       dr.ra,\n       dr.dec,\n       dr.magpsf,\n       dr.sigmapsf,\n       dr.magpsf_corr,\n       dr.sigmapsf_corr,\n       ar.max_rise_r\nFROM det_r dr\nLEFT JOIN amp_r ar ON dr.oid = ar.oid\nORDER BY dr.oid\nLIMIT 1000;"
                },
                "in_toks": 2625,
                "out_toks": 2274,
                "id": "chatcmpl-CbHfJrq1SnPVccsjAPIVt8beQHHkg",
                "created": 1763002077,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1775,
                "out_toks": 1615,
                "id": "chatcmpl-CSxfPHLT3ptHrH2cGx0BRDo24Wukn",
                "created": 1761018579,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Get r-band detections for objects whose top stochastic class is 'CV/Nova',\n-- with ndet <= 50, include corrected PSF magnitude and per-object r-band amplitude.\nWITH prob_cvstoch AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier_stochastic'\n     AND p.class_name = 'CV/Nova'\n     AND p.ranking = 1),\n     obj_le50 AS\n  (SELECT o.oid\n   FROM OBJECT o\n   WHERE o.ndet <= 50),\n     det_r_oids AS\n  (SELECT DISTINCT d.oid\n   FROM detection d\n   WHERE d.fid = 2\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL),\n     eligible_oids AS\n  (SELECT oid\n   FROM prob_cvstoch INTERSECT SELECT oid\n   FROM obj_le50 INTERSECT SELECT oid\n   FROM det_r_oids),\n     amp_r AS\n  (SELECT d.oid,\n          MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS max_rise_r\n   FROM detection d\n   WHERE d.oid IN\n       (SELECT oid\n        FROM eligible_oids)\n     AND d.fid = 2\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid)\nSELECT d.oid,\n       d.candid,\n       d.fid AS f_id,\n       d.ra,\n       d.dec,\n       d.magpsf,\n       d.sigmapsf,\n       d.magpsf_corr,\n       d.sigmapsf_corr,\n       a.max_rise_r\nFROM detection d\nINNER JOIN eligible_oids e ON d.oid = e.oid\nLEFT JOIN amp_r a ON d.oid = a.oid\nWHERE d.fid = 2\n  AND d.corrected = TRUE\n  AND d.magpsf_corr IS NOT NULL\nORDER BY d.oid\nLIMIT 1000;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to generate the PostgreSQL query\n\nGoal\nReturn detection-level rows containing: object identifier (oid), candidate identifier (candid), filter id as f_id, coordinates, magnitude and magnitude errors, restricted to:\n- Objects whose highest-probability class in the stochastic light curve classifier (classifier_name='lc_classifier_stochastic') is 'CV/Nova' (ranking=1).\n- Objects with at most 50 detections (object.ndet <= 50).\n- Only r-band detections (fid=2) with corrected magnitudes, including the PSF corrected magnitude (magpsf_corr).\n- Also compute per-object the maximum rise from minimum (amplitude) in r-band using corrected PSF magnitudes: max(magpsf_corr) - min(magpsf_corr).\n- Return the first 1000 rows ordered by object identifier.\n\nTables and columns to use\n- object: oid (PK), ndet, firstmjd, lastmjd (only ndet is used as constraint).\n- probability: oid (FK), class_name, classifier_name, classifier_version, probability, ranking.\n- detection: candid (PK), oid (FK), mjd, fid, ra, dec, magpsf, sigmapsf, magpsf_corr, sigmapsf_corr, corrected, dubious, isdiffpos, rb, drb, etc.\n\nDefault probability conditions and overrides\n- Use probability.ranking = 1 (default).\n- Override default classifier_name to classifier_name = 'lc_classifier_stochastic' (user explicitly requested the stochastic light curve classifier).\n- Use class_name = 'CV/Nova'.\n\nHigh-level structure\nUse CTEs/subqueries to:\n1) Select OIDs with the desired classification (probability).\n2) Select OIDs with ndet <= 50 (object).\n3) Select OIDs that have at least one r-band corrected detection (detection).\n4) INTERSECT those OID sets to get the eligible OIDs.\n5) On eligible OIDs, compute per-oid amplitude in r-band as max(magpsf_corr) - min(magpsf_corr).\n6) Join the amplitude back to the detection rows filtered to r-band corrected detections, and select/alias the required columns.\n7) Order by oid and limit to 1000 rows.\n\nDetailed steps and nested subqueries\n\nStep 1: CTE to get OIDs with top-ranked CV/Nova by the stochastic classifier\n- Name: prob_cvstoch\n- From: probability p\n- Columns: p.oid\n- Filters:\n  - p.classifier_name = 'lc_classifier_stochastic'\n  - p.class_name = 'CV/Nova'\n  - p.ranking = 1\n- DISTINCT to avoid duplicates across versions if present (PRIMARY KEY includes classifier_version, but we only need oids).\n- Indexes used: ix_probabilities_ranking (ranking), ix_probabilities_oid (hash), ix_probabilities_probability (potentially), and implicit filtering by classifier_name/class_name.\n\nStep 2: CTE to get OIDs with <= 50 detections\n- Name: obj_le50\n- From: object o\n- Columns: o.oid\n- Filter: o.ndet <= 50\n- Index used: ix_object_ndet\n\nStep 3: CTE to get OIDs that have at least one r-band corrected detection\n- Name: det_r_oids\n- From: detection d\n- Columns: d.oid\n- Filters:\n  - d.fid = 2  (r-band)\n  - d.corrected = true  (to ensure corrected magnitudes are valid)\n  - d.magpsf_corr IS NOT NULL (guard against null corrected mags)\n- Use DISTINCT to reduce to OID-level.\n- Index used: ix_ndetection_oid (hash on oid); filter by fid will be a scan within OID groups.\n\nStep 4: CTE to combine constraints via INTERSECT to derive the eligible OIDs\n- Name: eligible_oids\n- Logic: INTERSECT the OID columns from:\n  - prob_cvstoch\n  - obj_le50\n  - det_r_oids\n- Result: only OIDs satisfying all three conditions.\n\nStep 5: CTE to compute per-object r-band corrected PSF amplitude (maximum rise from minimum)\n- Name: amp_r\n- From: detection d\n- Join/filter: restrict to OIDs in eligible_oids (WHERE d.oid IN (SELECT oid FROM eligible_oids)) to reduce workload.\n- Filters:\n  - d.fid = 2\n  - d.corrected = true\n  - d.magpsf_corr IS NOT NULL\n- Group by: d.oid\n- Select:\n  - d.oid\n  - max_rise_r = MAX(d.magpsf_corr) - MIN(d.magpsf_corr)\n    Note: magnitudes are logarithmic; this yields the amplitude in magnitudes using corrected PSF mags; \u201cmaximum rise from minimum\u201d is interpreted as (max - min) over r-band corrected magnitudes.\n- No need for window functions here; aggregation reduces data early.\n\nStep 6: Final SELECT: join detection rows to eligible OIDs and amplitudes, include required columns, aliasing, ordering, limiting\n- Base table: detection d\n- Joins:\n  - INNER JOIN eligible_oids e ON d.oid = e.oid\n  - LEFT JOIN amp_r a ON d.oid = a.oid\n- Filters on detection rows to satisfy the r-band corrected requirement and quality:\n  - d.fid = 2\n  - d.corrected = true\n  - d.magpsf_corr IS NOT NULL\n- Selected/aliased columns:\n  - d.oid AS oid  (object identifier)\n  - d.candid AS candid  (candidate identifier)\n  - d.fid AS f_id  (filter id alias)\n  - d.ra, d.dec  (per-detection coordinates)\n  - d.magpsf AS mag  (PSF difference magnitude)\n  - d.sigmapsf AS mag_err  (PSF difference magnitude error)\n  - d.magpsf_corr AS mag_corr_r  (PSF corrected magnitude in r-filter)\n  - d.sigmapsf_corr AS mag_corr_err_r  (error of PSF corrected magnitude in r)\n  - a.max_rise_r  (per-object maximum rise from minimum in r using corrected PSF mags)\n- Ordering: ORDER BY d.oid ASC\n- Limiting: LIMIT 1000\n\nOptional performance notes\n- Ensure the planner uses ix_object_ndet for Step 2 and the hash index ix_ndetection_oid for joining/filtering detection on OID in Steps 5 and 6.\n- Keeping the amplitude computation (Step 5) restricted to eligible_oids avoids scanning the full detection table.\n- DISTINCT in Steps 1 and 3 prevents unnecessary duplicate OID rows during INTERSECT.\n- If duplicate classifier versions exist, Step 1\u2019s DISTINCT ensures a single OID instance flows downstream.\n\nOutput semantics\n- Each result row corresponds to a single r-band detection (fid=2, corrected=true) of an eligible object.\n- The max_rise_r column is the same for all detections of a given oid (computed per object in r-band).\n- The coordinates are per-detection (d.ra, d.dec), as requested alongside candid; if mean coordinates are preferred, swap to object.meanra, object.meandec via an additional JOIN to object and selecting o.meanra/o.meandec instead.\n\nFinal result constraints\n- Only OIDs whose top-ranked class by lc_classifier_stochastic is 'CV/Nova' (ranking=1).\n- Only OIDs with ndet <= 50.\n- Only r-band corrected detections are included in the output.\n- First 1000 rows, ordered by oid."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to generate the PostgreSQL query\n\nGoal\nReturn detection-level rows containing: object identifier (oid), candidate identifier (candid), filter id as f_id, coordinates, magnitude and magnitude errors, restricted to:\n- Objects whose highest-probability class in the stochastic light curve classifier (classifier_name='lc_classifier_stochastic') is 'CV/Nova' (ranking=1).\n- Objects with at most 50 detections (object.ndet <= 50).\n- Only r-band detections (fid=2) with corrected magnitudes, including the PSF corrected magnitude (magpsf_corr).\n- Also compute per-object the maximum rise from minimum (amplitude) in r-band using corrected PSF magnitudes: max(magpsf_corr) - min(magpsf_corr).\n- Return the first 1000 rows ordered by object identifier.\n\nTables and columns to use\n- object: oid (PK), ndet, firstmjd, lastmjd (only ndet is used as constraint).\n- probability: oid (FK), class_name, classifier_name, classifier_version, probability, ranking.\n- detection: candid (PK), oid (FK), mjd, fid, ra, dec, magpsf, sigmapsf, magpsf_corr, sigmapsf_corr, corrected, dubious, isdiffpos, rb, drb, etc.\n\nDefault probability conditions and overrides\n- Use probability.ranking = 1 (default).\n- Override default classifier_name to classifier_name = 'lc_classifier_stochastic' (user explicitly requested the stochastic light curve classifier).\n- Use class_name = 'CV/Nova'.\n\nHigh-level structure\nUse CTEs/subqueries to:\n1) Select OIDs with the desired classification (probability).\n2) Select OIDs with ndet <= 50 (object).\n3) Select OIDs that have at least one r-band corrected detection (detection).\n4) INTERSECT those OID sets to get the eligible OIDs.\n5) On eligible OIDs, compute per-oid amplitude in r-band as max(magpsf_corr) - min(magpsf_corr).\n6) Join the amplitude back to the detection rows filtered to r-band corrected detections, and select/alias the required columns.\n7) Order by oid and limit to 1000 rows.\n\nDetailed steps and nested subqueries\n\nStep 1: CTE to get OIDs with top-ranked CV/Nova by the stochastic classifier\n- Name: prob_cvstoch\n- From: probability p\n- Columns: p.oid\n- Filters:\n  - p.classifier_name = 'lc_classifier_stochastic'\n  - p.class_name = 'CV/Nova'\n  - p.ranking = 1\n- DISTINCT to avoid duplicates across versions if present (PRIMARY KEY includes classifier_version, but we only need oids).\n- Indexes used: ix_probabilities_ranking (ranking), ix_probabilities_oid (hash), ix_probabilities_probability (potentially), and implicit filtering by classifier_name/class_name.\n\nStep 2: CTE to get OIDs with <= 50 detections\n- Name: obj_le50\n- From: object o\n- Columns: o.oid\n- Filter: o.ndet <= 50\n- Index used: ix_object_ndet\n\nStep 3: CTE to get OIDs that have at least one r-band corrected detection\n- Name: det_r_oids\n- From: detection d\n- Columns: d.oid\n- Filters:\n  - d.fid = 2  (r-band)\n  - d.corrected = true  (to ensure corrected magnitudes are valid)\n  - d.magpsf_corr IS NOT NULL (guard against null corrected mags)\n- Use DISTINCT to reduce to OID-level.\n- Index used: ix_ndetection_oid (hash on oid); filter by fid will be a scan within OID groups.\n\nStep 4: CTE to combine constraints via INTERSECT to derive the eligible OIDs\n- Name: eligible_oids\n- Logic: INTERSECT the OID columns from:\n  - prob_cvstoch\n  - obj_le50\n  - det_r_oids\n- Result: only OIDs satisfying all three conditions.\n\nStep 5: CTE to compute per-object r-band corrected PSF amplitude (maximum rise from minimum)\n- Name: amp_r\n- From: detection d\n- Join/filter: restrict to OIDs in eligible_oids (WHERE d.oid IN (SELECT oid FROM eligible_oids)) to reduce workload.\n- Filters:\n  - d.fid = 2\n  - d.corrected = true\n  - d.magpsf_corr IS NOT NULL\n- Group by: d.oid\n- Select:\n  - d.oid\n  - max_rise_r = MAX(d.magpsf_corr) - MIN(d.magpsf_corr)\n    Note: magnitudes are logarithmic; this yields the amplitude in magnitudes using corrected PSF mags; \u201cmaximum rise from minimum\u201d is interpreted as (max - min) over r-band corrected magnitudes.\n- No need for window functions here; aggregation reduces data early.\n\nStep 6: Final SELECT: join detection rows to eligible OIDs and amplitudes, include required columns, aliasing, ordering, limiting\n- Base table: detection d\n- Joins:\n  - INNER JOIN eligible_oids e ON d.oid = e.oid\n  - LEFT JOIN amp_r a ON d.oid = a.oid\n- Filters on detection rows to satisfy the r-band corrected requirement and quality:\n  - d.fid = 2\n  - d.corrected = true\n  - d.magpsf_corr IS NOT NULL\n- Selected/aliased columns:\n  - d.oid AS oid  (object identifier)\n  - d.candid AS candid  (candidate identifier)\n  - d.fid AS f_id  (filter id alias)\n  - d.ra, d.dec  (per-detection coordinates)\n  - d.magpsf AS mag  (PSF difference magnitude)\n  - d.sigmapsf AS mag_err  (PSF difference magnitude error)\n  - d.magpsf_corr AS mag_corr_r  (PSF corrected magnitude in r-filter)\n  - d.sigmapsf_corr AS mag_corr_err_r  (error of PSF corrected magnitude in r)\n  - a.max_rise_r  (per-object maximum rise from minimum in r using corrected PSF mags)\n- Ordering: ORDER BY d.oid ASC\n- Limiting: LIMIT 1000\n\nOptional performance notes\n- Ensure the planner uses ix_object_ndet for Step 2 and the hash index ix_ndetection_oid for joining/filtering detection on OID in Steps 5 and 6.\n- Keeping the amplitude computation (Step 5) restricted to eligible_oids avoids scanning the full detection table.\n- DISTINCT in Steps 1 and 3 prevents unnecessary duplicate OID rows during INTERSECT.\n- If duplicate classifier versions exist, Step 1\u2019s DISTINCT ensures a single OID instance flows downstream.\n\nOutput semantics\n- Each result row corresponds to a single r-band detection (fid=2, corrected=true) of an eligible object.\n- The max_rise_r column is the same for all detections of a given oid (computed per object in r-band).\n- The coordinates are per-detection (d.ra, d.dec), as requested alongside candid; if mean coordinates are preferred, swap to object.meanra, object.meandec via an additional JOIN to object and selecting o.meanra/o.meandec instead.\n\nFinal result constraints\n- Only OIDs whose top-ranked class by lc_classifier_stochastic is 'CV/Nova' (ranking=1).\n- Only OIDs with ndet <= 50.\n- Only r-band corrected detections are included in the output.\n- First 1000 rows, ordered by oid."
                    },
                    "in_toks": 3653,
                    "out_toks": 6117,
                    "id": "chatcmpl-Cb70bW8tsIA760MzJNNFSTIZL66Kx",
                    "created": 1762961113,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Get r-band detections for objects whose top stochastic class is 'CV/Nova',\n-- with ndet <= 50, include corrected PSF magnitude and per-object r-band amplitude.\nWITH prob_cvstoch AS\n  (SELECT DISTINCT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier_stochastic'\n     AND p.class_name = 'CV/Nova'\n     AND p.ranking = 1),\n     obj_le50 AS\n  (SELECT o.oid\n   FROM OBJECT o\n   WHERE o.ndet <= 50),\n     det_r_oids AS\n  (SELECT DISTINCT d.oid\n   FROM detection d\n   WHERE d.fid = 2\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL),\n     eligible_oids AS\n  (SELECT oid\n   FROM prob_cvstoch INTERSECT SELECT oid\n   FROM obj_le50 INTERSECT SELECT oid\n   FROM det_r_oids),\n     amp_r AS\n  (SELECT d.oid,\n          MAX(d.magpsf_corr) - MIN(d.magpsf_corr) AS max_rise_r\n   FROM detection d\n   WHERE d.oid IN\n       (SELECT oid\n        FROM eligible_oids)\n     AND d.fid = 2\n     AND d.corrected = TRUE\n     AND d.magpsf_corr IS NOT NULL\n   GROUP BY d.oid)\nSELECT d.oid,\n       d.candid,\n       d.fid AS f_id,\n       d.ra,\n       d.dec,\n       d.magpsf,\n       d.sigmapsf,\n       d.magpsf_corr,\n       d.sigmapsf_corr,\n       a.max_rise_r\nFROM detection d\nINNER JOIN eligible_oids e ON d.oid = e.oid\nLEFT JOIN amp_r a ON d.oid = a.oid\nWHERE d.fid = 2\n  AND d.corrected = TRUE\n  AND d.magpsf_corr IS NOT NULL\nORDER BY d.oid\nLIMIT 1000;"
                        },
                        "in_toks": 3942,
                        "out_toks": 2168,
                        "id": "chatcmpl-Cb72uX93JJPsqssrbeHv8gfVD2461",
                        "created": 1762961256,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "4": {
            "req_id": "39",
            "experiment_id": "run_4",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'detection']"
                },
                "in_toks": 705,
                "out_toks": 1879,
                "id": "chatcmpl-CSswjfoUqVQCflUMkzeBblu8Z0a4j",
                "created": 1761000433,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1775,
                "out_toks": 975,
                "id": "chatcmpl-CSxfiGkl4hZqpeSiZXqMrtO8k0K2C",
                "created": 1761018598,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3653,
                "out_toks": 4000,
                "id": "chatcmpl-CSxiGYFg4rkX5DOELMzxTGNOatCDJ",
                "created": 1761018756,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- Select r-band detections for objects classified as 'CV/Nova' by the stochastic LC classifier (top-ranked),\n-- with at most 50 detections, and include corrected PSF magnitudes and their errors.\n-- Compute per-object maximum rise from minimum (max(magpsf_corr) - min(magpsf_corr)).\nSELECT\n    o.oid,\n    d.candid,\n    d.fid AS f_id,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.magpsf_corr,\n    d.sigmapsf,\n    d.sigmapsf_corr,\n    MIN(d.magpsf_corr) OVER (PARTITION BY o.oid) AS min_magpsf_corr,\n    MAX(d.magpsf_corr) OVER (PARTITION BY o.oid) AS max_magpsf_corr,\n    (MAX(d.magpsf_corr) OVER (PARTITION BY o.oid) - MIN(d.magpsf_corr) OVER (PARTITION BY o.oid)) AS max_rise_from_min\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\n   AND p.classifier_name = 'lc_classifier_stochastic' -- user requested the stochastic LC classifier\n   AND p.class_name = 'CV/Nova'\n   AND p.ranking = 1                                  -- highest probability class\nINNER JOIN detection d\n    ON d.oid = o.oid\nWHERE\n    o.ndet <= 50              -- at most 50 detections from discovery to last detection\n    AND d.fid = 2             -- r-band\n    AND d.corrected = TRUE    -- use corrected measurements (magpsf_corr and its errors)\nORDER BY o.oid\nLIMIT 1000;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- Select r-band detections for objects classified as 'CV/Nova' by the stochastic LC classifier (top-ranked),\n-- with at most 50 detections, and include corrected PSF magnitudes and their errors.\n-- Compute per-object maximum rise from minimum (max(magpsf_corr) - min(magpsf_corr)).\nSELECT\n    o.oid,\n    d.candid,\n    d.fid AS f_id,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.magpsf_corr,\n    d.sigmapsf,\n    d.sigmapsf_corr,\n    MIN(d.magpsf_corr) OVER (PARTITION BY o.oid) AS min_magpsf_corr,\n    MAX(d.magpsf_corr) OVER (PARTITION BY o.oid) AS max_magpsf_corr,\n    (MAX(d.magpsf_corr) OVER (PARTITION BY o.oid) - MIN(d.magpsf_corr) OVER (PARTITION BY o.oid)) AS max_rise_from_min\nFROM object o\nINNER JOIN probability p\n    ON p.oid = o.oid\n   AND p.classifier_name = 'lc_classifier_stochastic' -- user requested the stochastic LC classifier\n   AND p.class_name = 'CV/Nova'\n   AND p.ranking = 1                                  -- highest probability class\nINNER JOIN detection d\n    ON d.oid = o.oid\nWHERE\n    o.ndet <= 50              -- at most 50 detections from discovery to last detection\n    AND d.fid = 2             -- r-band\n    AND d.corrected = TRUE    -- use corrected measurements (magpsf_corr and its errors)\nORDER BY o.oid\nLIMIT 1000;\n```"
                },
                "in_toks": 3092,
                "out_toks": 3317,
                "id": "chatcmpl-CSyRa4pzmwztHSTvu6hE4pm5cNLIT",
                "created": 1761021566,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "5": {
            "req_id": "39",
            "experiment_id": "run_5",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'detection']"
                },
                "in_toks": 705,
                "out_toks": 1495,
                "id": "chatcmpl-CZNUmn5IrpPYnwSk51LpV2iPGq9jC",
                "created": 1762547832,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1775,
                "out_toks": 1167,
                "id": "chatcmpl-CZYr6Ahhtmvonvv8SOiCnrz8M2XJ7",
                "created": 1762591500,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3653,
                "out_toks": 4000,
                "id": "chatcmpl-CZaFYl2kZB1UaiNzXAENheZJipLf5",
                "created": 1762596860,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* CV/Nova objects (highest-probability class from the stochastic light curve classifier),\n   with at most 50 detections, and their r-band detections with corrected magnitudes.\n   Also computes the maximum rise from minimum (amplitude) in magpsf_corr per object (r-band only). */\nWITH cvnova_oids AS (\n    SELECT DISTINCT p.oid\n    FROM probability p\n    INNER JOIN object o ON o.oid = p.oid\n    WHERE p.classifier_name = 'lc_classifier_stochastic'  -- user requested stochastic LC classifier\n      AND p.ranking = 1                                    -- highest-probability class\n      AND p.class_name = 'CV/Nova'\n      AND o.ndet <= 50                                     -- at most 50 detections\n)\nSELECT\n    d.oid,                 -- object identifier\n    d.candid,              -- candidate identifier\n    d.fid AS f_id,         -- filter id (aliased as requested)\n    d.ra,                  -- coordinates: RA\n    d.dec,                 -- coordinates: Dec\n    d.magpsf,              -- magnitude (difference PSF)\n    d.sigmapsf,            -- magnitude error (difference PSF)\n    d.magpsf_corr,         -- corrected difference magnitude (PSF corrected magnitude in r-band)\n    d.sigmapsf_corr,       -- corrected magnitude error\n    -- maximum rise from minimum (amplitude) in corrected PSF magnitude within r-band per object\n    (MAX(d.magpsf_corr) OVER (PARTITION BY d.oid)\n     - MIN(d.magpsf_corr) OVER (PARTITION BY d.oid)) AS max_rise_from_min_corr\nFROM detection d\nINNER JOIN cvnova_oids co ON co.oid = d.oid\nWHERE d.fid = 2  -- r-band\nORDER BY d.oid\nLIMIT 1000;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* CV/Nova objects (highest-probability class from the stochastic light curve classifier),\n   with at most 50 detections, and their r-band detections with corrected magnitudes.\n   Also computes the maximum rise from minimum (amplitude) in magpsf_corr per object (r-band only). */\nWITH cvnova_oids AS (\n    SELECT DISTINCT p.oid\n    FROM probability p\n    INNER JOIN object o ON o.oid = p.oid\n    WHERE p.classifier_name = 'lc_classifier_stochastic'  -- user requested stochastic LC classifier\n      AND p.ranking = 1                                    -- highest-probability class\n      AND p.class_name = 'CV/Nova'\n      AND o.ndet <= 50                                     -- at most 50 detections\n)\nSELECT\n    d.oid,                 -- object identifier\n    d.candid,              -- candidate identifier\n    d.fid AS f_id,         -- filter id (aliased as requested)\n    d.ra,                  -- coordinates: RA\n    d.dec,                 -- coordinates: Dec\n    d.magpsf,              -- magnitude (difference PSF)\n    d.sigmapsf,            -- magnitude error (difference PSF)\n    d.magpsf_corr,         -- corrected difference magnitude (PSF corrected magnitude in r-band)\n    d.sigmapsf_corr,       -- corrected magnitude error\n    -- maximum rise from minimum (amplitude) in corrected PSF magnitude within r-band per object\n    (MAX(d.magpsf_corr) OVER (PARTITION BY d.oid)\n     - MIN(d.magpsf_corr) OVER (PARTITION BY d.oid)) AS max_rise_from_min_corr\nFROM detection d\nINNER JOIN cvnova_oids co ON co.oid = d.oid\nWHERE d.fid = 2  -- r-band\nORDER BY d.oid\nLIMIT 1000;\n```"
                },
                "in_toks": 3092,
                "out_toks": 3542,
                "id": "chatcmpl-CZaxHIUbe1FHTsPpvjYSsAIxtPNa9",
                "created": 1762599571,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "6": {
            "req_id": "39",
            "experiment_id": "run_6",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'detection']"
                },
                "in_toks": 705,
                "out_toks": 1111,
                "id": "chatcmpl-CZNVME363DO36Y8YRK1HKlpDBlESP",
                "created": 1762547868,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": "-- Optimized query: first restrict to CV/Nova (stochastic, rank=1) objects with <= 50 detections,\n-- then fetch only their r-band corrected detections and compute per-object amplitude.\nWITH eligible_oids AS\n  (SELECT DISTINCT o.oid\n   FROM probability p\n   JOIN OBJECT o USING (oid)\n   WHERE p.classifier_name = 'lc_classifier_stochastic' -- stochastic light curve classifier\n\n     AND p.class_name = 'CV/Nova' -- target class\n\n     AND p.ranking = 1 -- highest-probability class\n\n     AND o.ndet <= 50 -- at most 50 detections\n),\n     r_dets AS\n  (SELECT d.oid,\n          d.candid,\n          d.fid AS f_id,\n          d.ra,\n          d.dec,\n          d.magpsf,\n          d.sigmapsf,\n          d.magpsf_corr,\n          d.sigmapsf_corr\n   FROM detection d\n   JOIN eligible_oids e ON e.oid = d.oid\n   WHERE d.fid = 2 -- r-band\n\n     AND d.corrected = TRUE -- use corrected detections\n),\n     r_amp AS\n  (SELECT oid,\n          MAX(magpsf_corr) - MIN(magpsf_corr) AS max_rise_from_min_r\n   FROM r_dets\n   GROUP BY oid)\nSELECT r.oid,\n       r.candid,\n       r.f_id,\n       r.ra,\n       r.dec,\n       r.magpsf,\n       r.sigmapsf,\n       r.magpsf_corr,\n       r.sigmapsf_corr,\n       a.max_rise_from_min_r\nFROM r_dets r\nJOIN r_amp a USING (oid)\nORDER BY r.oid\nLIMIT 1000;",
            "sql_response": {
                "responses": {
                    "0": "-- Optimized query: first restrict to CV/Nova (stochastic, rank=1) objects with <= 50 detections,\n-- then fetch only their r-band corrected detections and compute per-object amplitude.\nWITH eligible_oids AS\n  (SELECT DISTINCT o.oid\n   FROM probability p\n   JOIN OBJECT o USING (oid)\n   WHERE p.classifier_name = 'lc_classifier_stochastic' -- stochastic light curve classifier\n\n     AND p.class_name = 'CV/Nova' -- target class\n\n     AND p.ranking = 1 -- highest-probability class\n\n     AND o.ndet <= 50 -- at most 50 detections\n),\n     r_dets AS\n  (SELECT d.oid,\n          d.candid,\n          d.fid AS f_id,\n          d.ra,\n          d.dec,\n          d.magpsf,\n          d.sigmapsf,\n          d.magpsf_corr,\n          d.sigmapsf_corr\n   FROM detection d\n   JOIN eligible_oids e ON e.oid = d.oid\n   WHERE d.fid = 2 -- r-band\n\n     AND d.corrected = TRUE -- use corrected detections\n),\n     r_amp AS\n  (SELECT oid,\n          MAX(magpsf_corr) - MIN(magpsf_corr) AS max_rise_from_min_r\n   FROM r_dets\n   GROUP BY oid)\nSELECT r.oid,\n       r.candid,\n       r.f_id,\n       r.ra,\n       r.dec,\n       r.magpsf,\n       r.sigmapsf,\n       r.magpsf_corr,\n       r.sigmapsf_corr,\n       a.max_rise_from_min_r\nFROM r_dets r\nJOIN r_amp a USING (oid)\nORDER BY r.oid\nLIMIT 1000;"
                },
                "in_toks": 2715,
                "out_toks": 2429,
                "id": "chatcmpl-CbHgAdKJ23nK6E9hYWgviOfmP8w57",
                "created": 1763002130,
                "model": "gpt-5-2025-08-07"
            },
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1775,
                "out_toks": 1167,
                "id": "chatcmpl-CZYrVCiI1CwHxhNdmTnrgYRrFa0Wb",
                "created": 1762591525,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "-- Return per-detection info for CV/Nova (stochastic classifier, rank=1),\n-- with <= 50 detections, using only r-band corrected detections.\n-- Also compute per-object max rise from minimum (in corrected r-band mag).\nWITH cvnova_stoch_rank1_oids AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier_stochastic'\n     AND p.class_name = 'CV/Nova'\n     AND p.ranking = 1),\n     object_le_50 AS\n  (SELECT o.oid\n   FROM OBJECT o\n   WHERE o.ndet <= 50),\n     detcount_le_50 AS\n  (SELECT d.oid\n   FROM detection d\n   GROUP BY d.oid\n   HAVING COUNT(*) <= 50),\n     low_ndet_oids AS\n  (SELECT oid\n   FROM object_le_50\n   UNION SELECT oid\n   FROM detcount_le_50),\n     eligible_oids AS\n  (SELECT oid\n   FROM cvnova_stoch_rank1_oids INTERSECT SELECT oid\n   FROM low_ndet_oids),\n     r_dets AS\n  (SELECT d.oid,\n          d.candid,\n          d.fid AS f_id,\n          d.ra,\n          d.dec,\n          d.magpsf,\n          d.sigmapsf,\n          d.magpsf_corr,\n          d.sigmapsf_corr\n   FROM detection d\n   WHERE d.oid IN\n       (SELECT oid\n        FROM eligible_oids)\n     AND d.fid = 2\n     AND d.corrected = TRUE),\n     r_amp AS\n  (SELECT r.oid,\n          MAX(r.magpsf_corr) - MIN(r.magpsf_corr) AS max_rise_from_min_r\n   FROM r_dets r\n   GROUP BY r.oid)\nSELECT r.oid,\n       r.candid,\n       r.f_id,\n       r.ra,\n       r.dec,\n       r.magpsf,\n       r.sigmapsf,\n       r.magpsf_corr,\n       r.sigmapsf_corr,\n       a.max_rise_from_min_r\nFROM r_dets r\nINNER JOIN r_amp a USING (oid)\nORDER BY r.oid ASC\nLIMIT 1000;",
            "original_sql_response": {
                "difficulty_class": "advanced",
                "plan": {
                    "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\n- Return, per detection, the columns:\n  - object identifier (object.oid / detection.oid),\n  - candidate identifier (detection.candid),\n  - filter id as f_id (detection.fid AS f_id),\n  - coordinates (detection.ra, detection.dec),\n  - magnitude (detection.magpsf),\n  - magnitude error (detection.sigmapsf),\n  - corrected difference magnitude in r band (detection.magpsf_corr),\n  - corrected magnitude error in r band (detection.sigmapsf_corr),\n  - the maximum rise from minimum (amplitude in r-band corrected mag) per object.\n- Restrict to objects whose most probable class (ranking = 1) under the stochastic light curve classifier is 'CV/Nova'.\n- Restrict to objects with at most 50 detections (from discovery to last detection).\n- Only use r-band detections (fid = 2), and use corrected magnitudes.\n- Order by object identifier; return the first 1000 rows.\n\nTables and columns to use\n- probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n- object(oid, ndet, firstmjd, lastmjd, meanra, meandec, \u2026)\n- detection(candid, oid, mjd, fid, ra, dec, magpsf, sigmapsf, magpsf_corr, sigmapsf_corr, corrected, \u2026)\n- r-band is fid = 2.\n\nDefault and explicit conditions\n- Probability constraints (explicitly given by user, overriding defaults):\n  - probability.classifier_name = 'lc_classifier_stochastic'\n  - probability.class_name = 'CV/Nova'\n  - probability.ranking = 1\n- Detection constraints (derived from request):\n  - detection.fid = 2 (r band)\n  - detection.corrected = true (to \u201ccollect the corrected difference magnitude\u201d properly)\n- Detections count constraint:\n  - At most 50 detections per object; use object.ndet <= 50 and cross-check with detection grouping to satisfy the \u201cdiscovery to last detection\u201d phrasing.\n- Sorting/limit:\n  - ORDER BY oid ASC\n  - LIMIT 1000\n\nStep-by-step construction with CTEs, JOINs, INTERSECTs, UNIONs, and nested queries\n\n1) Identify candidate objects by classification (probability filter)\n- Create a CTE that selects oids from probability where:\n  - classifier_name = 'lc_classifier_stochastic'\n  - class_name = 'CV/Nova'\n  - ranking = 1\n- Columns: oid\n- This yields the set of objects whose highest-probability class under the stochastic classifier is CV/Nova.\n\n2) Identify objects with \u2264 50 detections using the object table\n- Create a CTE that selects oids from object where ndet <= 50.\n- Columns: oid\n- Uses index ix_object_ndet.\n\n3) Independently verify \u2264 50 detections via the detection table\n- Create a CTE that groups detection by oid and retains only oids with count(*) <= 50.\n- Columns: oid\n- Note: do not add additional filters here (e.g., fid, mjd) to avoid degrading performance; this gives the total detections per object.\n\n4) Combine the two \u201c\u2264 50 detections\u201d sources (UNION)\n- Create a CTE that unions the oids from steps (2) and (3) using UNION (not UNION ALL) to deduplicate.\n- Columns: oid\n- Purpose: meets the requirement to use UNION while being logically safe; includes oids that satisfy either method of counting detections.\n\n5) Intersect classification with detection-count constraint (INTERSECT)\n- Create a CTE that INTERSECTS the oids from:\n  - Step (1) CV/Nova classification (stochastic, rank=1)\n  - Step (4) \u2264 50 detections by union of object/detection derived sets\n- Columns: oid\n- This yields the final eligible set of objects meeting both conditions.\n\n6) Extract r-band, corrected detections for the eligible objects\n- Create a CTE that selects from detection where:\n  - detection.oid is IN the CTE from step (5),\n  - detection.fid = 2 (r-band),\n  - detection.corrected = true.\n- Project the columns required by the user and those needed later:\n  - detection.oid AS oid,\n  - detection.candid,\n  - detection.fid AS f_id,\n  - detection.ra,\n  - detection.dec,\n  - detection.magpsf AS magnitude,\n  - detection.sigmapsf AS magnitude_error,\n  - detection.magpsf_corr AS corrected_mag_r,\n  - detection.sigmapsf_corr AS corrected_mag_error_r,\n  - detection.mjd (kept for potential auditing/ordering, not strictly required for the final output).\n- This CTE will be the per-detection base (\u201cr_dets\u201d).\n\n7) Compute the maximum rise from minimum per object in r band (using corrected magnitudes)\n- Create a CTE that groups the r_dets CTE by oid and computes:\n  - max(corrected_mag_r) - min(corrected_mag_r) AS max_rise_from_min_r\n- Columns: oid, max_rise_from_min_r\n- This gives the amplitude (maximum \u2013 minimum) in corrected difference magnitude across r-band detections per object.\n- Note: Using magnitudes implies larger values are fainter; the request\u2019s \u201cmaximum rise from minimum\u201d is implemented as max \u2212 min in magnitudes.\n\n8) Assemble the final result\n- INNER JOIN the r_dets CTE (step 6) with the amplitude CTE (step 7) on oid to add the per-object amplitude to every detection row.\n- Select and alias the final columns exactly as requested:\n  - oid AS object_identifier,\n  - candid AS candidate_identifier,\n  - f_id,\n  - ra,\n  - dec,\n  - magnitude (magpsf),\n  - magnitude_error (sigmapsf),\n  - corrected_mag_r (magpsf_corr; satisfies \u201ccollect the corrected difference magnitude in the r-band filter\u201d),\n  - corrected_mag_error_r (sigmapsf_corr; included to provide magnitude errors for the corrected magnitude),\n  - max_rise_from_min_r\n- Apply ORDER BY oid ASC.\n- Apply LIMIT 1000.\n\n9) Optional validations/notes (not additional filters)\n- You may optionally join object to r_dets if you need to expose firstmjd/lastmjd, but do not filter detection by mjd to keep performance optimal per the guidance to avoid filtering detection by parameters other than oid.\n- If you want to display \u201cPSF corrected magnitude in the r-filter\u201d explicitly, alias corrected_mag_r also as psf_corr_mag_r in the projection (it is detection.magpsf_corr with fid = 2).\n\nSummary of logical flow (CTEs)\n- cvnova_stoch_rank1_oids: probability filter (classifier_name = 'lc_classifier_stochastic', class_name = 'CV/Nova', ranking = 1).\n- object_le_50: object.ndet <= 50.\n- detcount_le_50: detection grouped by oid with count(*) <= 50.\n- low_ndet_oids: object_le_50 UNION detcount_le_50.\n- eligible_oids: cvnova_stoch_rank1_oids INTERSECT low_ndet_oids.\n- r_dets: r-band corrected detections (fid = 2, corrected = true) for eligible_oids with required columns.\n- r_amp: per-oid amplitude in r-band corrected magnitude: max(corrected_mag_r) - min(corrected_mag_r).\n- final: r_dets JOIN r_amp; ORDER BY oid ASC; LIMIT 1000."
                },
                "plan_response": {
                    "responses": {
                        "0": "Decomposition plan to build the PostgreSQL query for ALeRCE\n\nGoal\n- Return, per detection, the columns:\n  - object identifier (object.oid / detection.oid),\n  - candidate identifier (detection.candid),\n  - filter id as f_id (detection.fid AS f_id),\n  - coordinates (detection.ra, detection.dec),\n  - magnitude (detection.magpsf),\n  - magnitude error (detection.sigmapsf),\n  - corrected difference magnitude in r band (detection.magpsf_corr),\n  - corrected magnitude error in r band (detection.sigmapsf_corr),\n  - the maximum rise from minimum (amplitude in r-band corrected mag) per object.\n- Restrict to objects whose most probable class (ranking = 1) under the stochastic light curve classifier is 'CV/Nova'.\n- Restrict to objects with at most 50 detections (from discovery to last detection).\n- Only use r-band detections (fid = 2), and use corrected magnitudes.\n- Order by object identifier; return the first 1000 rows.\n\nTables and columns to use\n- probability(oid, class_name, classifier_name, classifier_version, probability, ranking)\n- object(oid, ndet, firstmjd, lastmjd, meanra, meandec, \u2026)\n- detection(candid, oid, mjd, fid, ra, dec, magpsf, sigmapsf, magpsf_corr, sigmapsf_corr, corrected, \u2026)\n- r-band is fid = 2.\n\nDefault and explicit conditions\n- Probability constraints (explicitly given by user, overriding defaults):\n  - probability.classifier_name = 'lc_classifier_stochastic'\n  - probability.class_name = 'CV/Nova'\n  - probability.ranking = 1\n- Detection constraints (derived from request):\n  - detection.fid = 2 (r band)\n  - detection.corrected = true (to \u201ccollect the corrected difference magnitude\u201d properly)\n- Detections count constraint:\n  - At most 50 detections per object; use object.ndet <= 50 and cross-check with detection grouping to satisfy the \u201cdiscovery to last detection\u201d phrasing.\n- Sorting/limit:\n  - ORDER BY oid ASC\n  - LIMIT 1000\n\nStep-by-step construction with CTEs, JOINs, INTERSECTs, UNIONs, and nested queries\n\n1) Identify candidate objects by classification (probability filter)\n- Create a CTE that selects oids from probability where:\n  - classifier_name = 'lc_classifier_stochastic'\n  - class_name = 'CV/Nova'\n  - ranking = 1\n- Columns: oid\n- This yields the set of objects whose highest-probability class under the stochastic classifier is CV/Nova.\n\n2) Identify objects with \u2264 50 detections using the object table\n- Create a CTE that selects oids from object where ndet <= 50.\n- Columns: oid\n- Uses index ix_object_ndet.\n\n3) Independently verify \u2264 50 detections via the detection table\n- Create a CTE that groups detection by oid and retains only oids with count(*) <= 50.\n- Columns: oid\n- Note: do not add additional filters here (e.g., fid, mjd) to avoid degrading performance; this gives the total detections per object.\n\n4) Combine the two \u201c\u2264 50 detections\u201d sources (UNION)\n- Create a CTE that unions the oids from steps (2) and (3) using UNION (not UNION ALL) to deduplicate.\n- Columns: oid\n- Purpose: meets the requirement to use UNION while being logically safe; includes oids that satisfy either method of counting detections.\n\n5) Intersect classification with detection-count constraint (INTERSECT)\n- Create a CTE that INTERSECTS the oids from:\n  - Step (1) CV/Nova classification (stochastic, rank=1)\n  - Step (4) \u2264 50 detections by union of object/detection derived sets\n- Columns: oid\n- This yields the final eligible set of objects meeting both conditions.\n\n6) Extract r-band, corrected detections for the eligible objects\n- Create a CTE that selects from detection where:\n  - detection.oid is IN the CTE from step (5),\n  - detection.fid = 2 (r-band),\n  - detection.corrected = true.\n- Project the columns required by the user and those needed later:\n  - detection.oid AS oid,\n  - detection.candid,\n  - detection.fid AS f_id,\n  - detection.ra,\n  - detection.dec,\n  - detection.magpsf AS magnitude,\n  - detection.sigmapsf AS magnitude_error,\n  - detection.magpsf_corr AS corrected_mag_r,\n  - detection.sigmapsf_corr AS corrected_mag_error_r,\n  - detection.mjd (kept for potential auditing/ordering, not strictly required for the final output).\n- This CTE will be the per-detection base (\u201cr_dets\u201d).\n\n7) Compute the maximum rise from minimum per object in r band (using corrected magnitudes)\n- Create a CTE that groups the r_dets CTE by oid and computes:\n  - max(corrected_mag_r) - min(corrected_mag_r) AS max_rise_from_min_r\n- Columns: oid, max_rise_from_min_r\n- This gives the amplitude (maximum \u2013 minimum) in corrected difference magnitude across r-band detections per object.\n- Note: Using magnitudes implies larger values are fainter; the request\u2019s \u201cmaximum rise from minimum\u201d is implemented as max \u2212 min in magnitudes.\n\n8) Assemble the final result\n- INNER JOIN the r_dets CTE (step 6) with the amplitude CTE (step 7) on oid to add the per-object amplitude to every detection row.\n- Select and alias the final columns exactly as requested:\n  - oid AS object_identifier,\n  - candid AS candidate_identifier,\n  - f_id,\n  - ra,\n  - dec,\n  - magnitude (magpsf),\n  - magnitude_error (sigmapsf),\n  - corrected_mag_r (magpsf_corr; satisfies \u201ccollect the corrected difference magnitude in the r-band filter\u201d),\n  - corrected_mag_error_r (sigmapsf_corr; included to provide magnitude errors for the corrected magnitude),\n  - max_rise_from_min_r\n- Apply ORDER BY oid ASC.\n- Apply LIMIT 1000.\n\n9) Optional validations/notes (not additional filters)\n- You may optionally join object to r_dets if you need to expose firstmjd/lastmjd, but do not filter detection by mjd to keep performance optimal per the guidance to avoid filtering detection by parameters other than oid.\n- If you want to display \u201cPSF corrected magnitude in the r-filter\u201d explicitly, alias corrected_mag_r also as psf_corr_mag_r in the projection (it is detection.magpsf_corr with fid = 2).\n\nSummary of logical flow (CTEs)\n- cvnova_stoch_rank1_oids: probability filter (classifier_name = 'lc_classifier_stochastic', class_name = 'CV/Nova', ranking = 1).\n- object_le_50: object.ndet <= 50.\n- detcount_le_50: detection grouped by oid with count(*) <= 50.\n- low_ndet_oids: object_le_50 UNION detcount_le_50.\n- eligible_oids: cvnova_stoch_rank1_oids INTERSECT low_ndet_oids.\n- r_dets: r-band corrected detections (fid = 2, corrected = true) for eligible_oids with required columns.\n- r_amp: per-oid amplitude in r-band corrected magnitude: max(corrected_mag_r) - min(corrected_mag_r).\n- final: r_dets JOIN r_amp; ORDER BY oid ASC; LIMIT 1000."
                    },
                    "in_toks": 3653,
                    "out_toks": 6639,
                    "id": "chatcmpl-Cb73aRZsKfACL9k109ud0UxQtKyQX",
                    "created": 1762961298,
                    "model": "gpt-5-2025-08-07"
                },
                "sql_response": {
                    "0": {
                        "responses": {
                            "0": "-- Return per-detection info for CV/Nova (stochastic classifier, rank=1),\n-- with <= 50 detections, using only r-band corrected detections.\n-- Also compute per-object max rise from minimum (in corrected r-band mag).\nWITH cvnova_stoch_rank1_oids AS\n  (SELECT p.oid\n   FROM probability p\n   WHERE p.classifier_name = 'lc_classifier_stochastic'\n     AND p.class_name = 'CV/Nova'\n     AND p.ranking = 1),\n     object_le_50 AS\n  (SELECT o.oid\n   FROM OBJECT o\n   WHERE o.ndet <= 50),\n     detcount_le_50 AS\n  (SELECT d.oid\n   FROM detection d\n   GROUP BY d.oid\n   HAVING COUNT(*) <= 50),\n     low_ndet_oids AS\n  (SELECT oid\n   FROM object_le_50\n   UNION SELECT oid\n   FROM detcount_le_50),\n     eligible_oids AS\n  (SELECT oid\n   FROM cvnova_stoch_rank1_oids INTERSECT SELECT oid\n   FROM low_ndet_oids),\n     r_dets AS\n  (SELECT d.oid,\n          d.candid,\n          d.fid AS f_id,\n          d.ra,\n          d.dec,\n          d.magpsf,\n          d.sigmapsf,\n          d.magpsf_corr,\n          d.sigmapsf_corr\n   FROM detection d\n   WHERE d.oid IN\n       (SELECT oid\n        FROM eligible_oids)\n     AND d.fid = 2\n     AND d.corrected = TRUE),\n     r_amp AS\n  (SELECT r.oid,\n          MAX(r.magpsf_corr) - MIN(r.magpsf_corr) AS max_rise_from_min_r\n   FROM r_dets r\n   GROUP BY r.oid)\nSELECT r.oid,\n       r.candid,\n       r.f_id,\n       r.ra,\n       r.dec,\n       r.magpsf,\n       r.sigmapsf,\n       r.magpsf_corr,\n       r.sigmapsf_corr,\n       a.max_rise_from_min_r\nFROM r_dets r\nINNER JOIN r_amp a USING (oid)\nORDER BY r.oid ASC\nLIMIT 1000;"
                        },
                        "in_toks": 3952,
                        "out_toks": 2849,
                        "id": "chatcmpl-Cb75yvP5jqSqE7LVePUtClXTpZR1c",
                        "created": 1762961446,
                        "model": "gpt-5-2025-08-07"
                    }
                }
            },
            "correction_applied": true
        },
        "7": {
            "req_id": "39",
            "experiment_id": "run_7",
            "pred_tables": [
                "object",
                "detection",
                "probability",
                "taxonomy"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'detection', 'probability', 'taxonomy']"
                },
                "in_toks": 705,
                "out_toks": 2263,
                "id": "chatcmpl-CZNVnwuzQ5isVs5fAVmmUO9cewRFb",
                "created": 1762547895,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1775,
                "out_toks": 1679,
                "id": "chatcmpl-CZYrvDmaS6xKctZWY0rooV5KKYgDk",
                "created": 1762591551,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3653,
                "out_toks": 4000,
                "id": "chatcmpl-CZaMqs5U8GPcA0ElS9PWaVRVai6aW",
                "created": 1762597312,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* CV/Nova objects by the stochastic light curve classifier (top-ranked), with <= 50 detections.\n   Return r-band detections with corrected PSF magnitude and its error, plus rise-from-min stats.\n*/\nWITH cvnova AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.classifier_name = 'lc_classifier_stochastic'\n      AND p.class_name = 'CV/Nova'\n      AND p.ranking = 1\n),\nsel_obj AS (\n    SELECT o.oid\n    FROM object o\n    INNER JOIN cvnova c ON c.oid = o.oid\n    WHERE o.ndet <= 50\n),\nr_dets AS (\n    SELECT d.oid,\n           d.candid,\n           d.fid,\n           d.ra,\n           d.dec,\n           d.magpsf_corr,\n           d.sigmapsf_corr,\n           d.mjd\n    FROM detection d\n    INNER JOIN sel_obj so ON so.oid = d.oid\n    WHERE d.fid = 2\n      AND d.magpsf_corr IS NOT NULL\n)\nSELECT\n    r.oid,\n    r.candid,\n    r.fid AS f_id,\n    r.ra,\n    r.dec,\n    r.magpsf_corr,\n    r.sigmapsf_corr,\n    (r.magpsf_corr - MIN(r.magpsf_corr) OVER (PARTITION BY r.oid)) AS rise_from_min,\n    (MAX(r.magpsf_corr) OVER (PARTITION BY r.oid) - MIN(r.magpsf_corr) OVER (PARTITION BY r.oid)) AS max_rise_from_min\nFROM r_dets r\nORDER BY r.oid\nLIMIT 1000;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* CV/Nova objects by the stochastic light curve classifier (top-ranked), with <= 50 detections.\n   Return r-band detections with corrected PSF magnitude and its error, plus rise-from-min stats.\n*/\nWITH cvnova AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.classifier_name = 'lc_classifier_stochastic'\n      AND p.class_name = 'CV/Nova'\n      AND p.ranking = 1\n),\nsel_obj AS (\n    SELECT o.oid\n    FROM object o\n    INNER JOIN cvnova c ON c.oid = o.oid\n    WHERE o.ndet <= 50\n),\nr_dets AS (\n    SELECT d.oid,\n           d.candid,\n           d.fid,\n           d.ra,\n           d.dec,\n           d.magpsf_corr,\n           d.sigmapsf_corr,\n           d.mjd\n    FROM detection d\n    INNER JOIN sel_obj so ON so.oid = d.oid\n    WHERE d.fid = 2\n      AND d.magpsf_corr IS NOT NULL\n)\nSELECT\n    r.oid,\n    r.candid,\n    r.fid AS f_id,\n    r.ra,\n    r.dec,\n    r.magpsf_corr,\n    r.sigmapsf_corr,\n    (r.magpsf_corr - MIN(r.magpsf_corr) OVER (PARTITION BY r.oid)) AS rise_from_min,\n    (MAX(r.magpsf_corr) OVER (PARTITION BY r.oid) - MIN(r.magpsf_corr) OVER (PARTITION BY r.oid)) AS max_rise_from_min\nFROM r_dets r\nORDER BY r.oid\nLIMIT 1000;\n```"
                },
                "in_toks": 3092,
                "out_toks": 3950,
                "id": "chatcmpl-CZaxsFAZmVTdY8FJnhuGIxdXhixHQ",
                "created": 1762599608,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "8": {
            "req_id": "39",
            "experiment_id": "run_8",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'detection']"
                },
                "in_toks": 705,
                "out_toks": 1751,
                "id": "chatcmpl-CZNX69enCA5XQM3K4tlTXzHKs0QUz",
                "created": 1762547976,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "advanced",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'advanced'}"
                },
                "in_toks": 1775,
                "out_toks": 2191,
                "id": "chatcmpl-CZYsfEdRXhtTMCLcJQQuWDtS6OgHy",
                "created": 1762591597,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3653,
                "out_toks": 4000,
                "id": "chatcmpl-CZaNz0D3WnVdAgSn75l2G6dH9WvVp",
                "created": 1762597383,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n/* CV/Nova objects (highest-probability in the stochastic LC classifier), with <= 50 detections.\n   Return r-band detections only, including corrected PSF magnitudes and rise metrics. */\nWITH selected_objects AS (\n    SELECT o.oid\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE p.classifier_name = 'lc_classifier_stochastic'\n      AND p.class_name = 'CV/Nova'\n      AND p.ranking = 1\n      AND o.ndet <= 50\n),\nr_detections AS (\n    SELECT d.*\n    FROM detection d\n    INNER JOIN selected_objects so\n        ON so.oid = d.oid\n    WHERE d.fid = 2  -- r-band only\n)\nSELECT\n    rd.oid,                              -- object identifier\n    rd.candid,                           -- candidate identifier\n    rd.fid AS f_id,                      -- filter id (r-band = 2)\n    rd.ra,                               -- right ascension (per detection)\n    rd.dec,                              -- declination (per detection)\n    rd.magpsf,                           -- magnitude (PSF difference magnitude)\n    rd.sigmapsf,                         -- magnitude error\n    rd.magpsf_corr,                      -- corrected difference magnitude in r-band (PSF corrected magnitude)\n    rd.sigmapsf_corr,                    -- error of PSF corrected magnitude in r-band\n    MIN(rd.magpsf_corr) OVER (PARTITION BY rd.oid) AS min_r_magpsf_corr,  -- per-object minimum corrected magnitude (r)\n    rd.magpsf_corr - MIN(rd.magpsf_corr) OVER (PARTITION BY rd.oid) AS rise_from_min_r, -- per-detection rise from object minimum (r)\n    MAX(rd.magpsf_corr) OVER (PARTITION BY rd.oid) - MIN(rd.magpsf_corr) OVER (PARTITION BY rd.oid) AS max_rise_from_min_r -- per-object max rise (r)\nFROM r_detections rd\nORDER BY rd.oid\nLIMIT 1000;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n/* CV/Nova objects (highest-probability in the stochastic LC classifier), with <= 50 detections.\n   Return r-band detections only, including corrected PSF magnitudes and rise metrics. */\nWITH selected_objects AS (\n    SELECT o.oid\n    FROM object o\n    INNER JOIN probability p\n        ON p.oid = o.oid\n    WHERE p.classifier_name = 'lc_classifier_stochastic'\n      AND p.class_name = 'CV/Nova'\n      AND p.ranking = 1\n      AND o.ndet <= 50\n),\nr_detections AS (\n    SELECT d.*\n    FROM detection d\n    INNER JOIN selected_objects so\n        ON so.oid = d.oid\n    WHERE d.fid = 2  -- r-band only\n)\nSELECT\n    rd.oid,                              -- object identifier\n    rd.candid,                           -- candidate identifier\n    rd.fid AS f_id,                      -- filter id (r-band = 2)\n    rd.ra,                               -- right ascension (per detection)\n    rd.dec,                              -- declination (per detection)\n    rd.magpsf,                           -- magnitude (PSF difference magnitude)\n    rd.sigmapsf,                         -- magnitude error\n    rd.magpsf_corr,                      -- corrected difference magnitude in r-band (PSF corrected magnitude)\n    rd.sigmapsf_corr,                    -- error of PSF corrected magnitude in r-band\n    MIN(rd.magpsf_corr) OVER (PARTITION BY rd.oid) AS min_r_magpsf_corr,  -- per-object minimum corrected magnitude (r)\n    rd.magpsf_corr - MIN(rd.magpsf_corr) OVER (PARTITION BY rd.oid) AS rise_from_min_r, -- per-detection rise from object minimum (r)\n    MAX(rd.magpsf_corr) OVER (PARTITION BY rd.oid) - MIN(rd.magpsf_corr) OVER (PARTITION BY rd.oid) AS max_rise_from_min_r -- per-object max rise (r)\nFROM r_detections rd\nORDER BY rd.oid\nLIMIT 1000;\n```"
                },
                "in_toks": 3092,
                "out_toks": 3907,
                "id": "chatcmpl-CZaySxosqQ7kVsH4ByOUkSiOj1nEY",
                "created": 1762599644,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        },
        "9": {
            "req_id": "39",
            "experiment_id": "run_9",
            "pred_tables": [
                "object",
                "probability",
                "taxonomy",
                "detection"
            ],
            "schema_linking_response": {
                "responses": {
                    "0": "['object', 'probability', 'taxonomy', 'detection']"
                },
                "in_toks": 705,
                "out_toks": 1559,
                "id": "chatcmpl-CZNXsjqrtpqRrHzrcZldpzuSieTdZ",
                "created": 1762548024,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query": null,
            "sql_response": null,
            "pred_diff": "medium",
            "diff_response": {
                "responses": {
                    "0": "{'class': 'medium'}"
                },
                "in_toks": 1775,
                "out_toks": 2831,
                "id": "chatcmpl-CZYuKFI05bum3FU3jQMgMkJCQqgmZ",
                "created": 1762591700,
                "model": "gpt-5-2025-08-07"
            },
            "sql_query_plan": "",
            "sql_query_plan_response": {
                "responses": {
                    "0": ""
                },
                "in_toks": 3382,
                "out_toks": 4000,
                "id": "chatcmpl-CZaPDnBWo5LDZnq5054rsDQQmF4qV",
                "created": 1762597459,
                "model": "gpt-5-2025-08-07"
            },
            "original_sql_query": "```sql\n-- CV/Nova objects (highest-probability class) from the stochastic light curve classifier,\n-- with at most 50 detections, r-band (fid=2) corrected detections only.\n-- Return object identifier, candidate identifier, filter id as f_id, coordinates,\n-- magnitudes and magnitude errors, plus rise-from-min and max-rise-from-min (magpsf_corr, r-band).\nSELECT\n    o.oid,\n    d.candid,\n    d.fid AS f_id,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf,\n    d.magpsf_corr,\n    d.sigmapsf_corr,\n    -- Rise from the minimum corrected PSF magnitude (r-band) for this object\n    d.magpsf_corr - MIN(d.magpsf_corr) OVER (PARTITION BY d.oid) AS rise_from_min_magpsf_corr,\n    -- Maximum rise from minimum (amplitude) across all r-band corrected detections for this object\n    (MAX(d.magpsf_corr) OVER (PARTITION BY d.oid) - MIN(d.magpsf_corr) OVER (PARTITION BY d.oid)) AS max_rise_from_min_magpsf_corr\nFROM detection d\nINNER JOIN object o\n    ON o.oid = d.oid\nINNER JOIN probability p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'lc_classifier_stochastic'  -- stochastic light curve classifier\n    AND p.ranking = 1                               -- highest probability class\n    AND p.class_name = 'CV/Nova'                    -- desired class\n    AND o.ndet <= 50                                -- at most 50 detections from discovery to last detection\n    AND d.fid = 2                                   -- r-band detections\n    AND d.corrected = TRUE                          -- use corrected detections (for magpsf_corr)\nORDER BY o.oid\nLIMIT 1000;\n```",
            "original_sql_response": {
                "responses": {
                    "0": "```sql\n-- CV/Nova objects (highest-probability class) from the stochastic light curve classifier,\n-- with at most 50 detections, r-band (fid=2) corrected detections only.\n-- Return object identifier, candidate identifier, filter id as f_id, coordinates,\n-- magnitudes and magnitude errors, plus rise-from-min and max-rise-from-min (magpsf_corr, r-band).\nSELECT\n    o.oid,\n    d.candid,\n    d.fid AS f_id,\n    d.ra,\n    d.dec,\n    d.magpsf,\n    d.sigmapsf,\n    d.magpsf_corr,\n    d.sigmapsf_corr,\n    -- Rise from the minimum corrected PSF magnitude (r-band) for this object\n    d.magpsf_corr - MIN(d.magpsf_corr) OVER (PARTITION BY d.oid) AS rise_from_min_magpsf_corr,\n    -- Maximum rise from minimum (amplitude) across all r-band corrected detections for this object\n    (MAX(d.magpsf_corr) OVER (PARTITION BY d.oid) - MIN(d.magpsf_corr) OVER (PARTITION BY d.oid)) AS max_rise_from_min_magpsf_corr\nFROM detection d\nINNER JOIN object o\n    ON o.oid = d.oid\nINNER JOIN probability p\n    ON p.oid = o.oid\nWHERE\n    p.classifier_name = 'lc_classifier_stochastic'  -- stochastic light curve classifier\n    AND p.ranking = 1                               -- highest probability class\n    AND p.class_name = 'CV/Nova'                    -- desired class\n    AND o.ndet <= 50                                -- at most 50 detections from discovery to last detection\n    AND d.fid = 2                                   -- r-band detections\n    AND d.corrected = TRUE                          -- use corrected detections (for magpsf_corr)\nORDER BY o.oid\nLIMIT 1000;\n```"
                },
                "in_toks": 3092,
                "out_toks": 3682,
                "id": "chatcmpl-CZayyLSZA9gyyvqrzBXe3AHqGj3kR",
                "created": 1762599676,
                "model": "gpt-5-2025-08-07"
            },
            "correction_applied": false
        }
    }
}