{"id": "batch_req_6849346ab2588190840451dd28d3e66d", "custom_id": "23-0", "response": {"status_code": 200, "request_id": "4fc004c75b8c308fc1ef5f622e3c5f2a", "body": {"id": "chatcmpl-BhASO3N9b0Vv3V3yW4A9ZgcNA50cC", "object": "chat.completion", "created": 1749628000, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select all classification probabilities for objects most likely to be SNIa, SNIbc, SNII, or SLSN\n-- as classified by the lc_classifier, with probability > 0.2 for those classes,\n-- and only for the most likely class (ranking=1) per object for those classes.\n-- Use a CTE to first filter the relevant oids, then join to get all probabilities for those oids.\n\nWITH top_sn_objects AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.classifier_name = 'lc_classifier' -- classifier must be lc_classifier\n      AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN') -- only SN classes\n      AND p.probability > 0.2 -- probability threshold\n      AND p.ranking = 1 -- only most likely class per object\n)\nSELECT o.*, p.*\nFROM object o\nJOIN probability p ON o.oid = p.oid\nWHERE o.oid IN (SELECT oid FROM top_sn_objects)\n  AND p.classifier_name = 'lc_classifier' -- only lc_classifier probabilities\nORDER BY o.oid, p.ranking;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1286, "completion_tokens": 251, "total_tokens": 1537, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_51e1070cf2"}}, "error": null}
{"id": "batch_req_6849346ac3ac819087e1409ae367a65b", "custom_id": "18-0", "response": {"status_code": 200, "request_id": "7bbdb532109eb6aa4c5084a972e88316", "body": {"id": "chatcmpl-BhASMCL9B88ipQyhiGNGr4FTQBBlb", "object": "chat.completion", "created": 1749627998, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Optimized query to retrieve all probabilities for sources classified as AGN, QSO, or Blazar\n-- by the light curve classifier, with specific detection and probability thresholds.\n-- Uses a CTE to pre-filter the probability table for relevant classes and classifier,\n-- and applies all conditions before joining with the object table to reduce the dataset early.\n\nWITH filtered_prob AS (\n    SELECT\n        oid,\n        class_name,\n        classifier_name,\n        ranking,\n        probability\n    FROM probability\n    WHERE\n        classifier_name = 'lc_classifier'\n        AND class_name IN ('AGN', 'QSO', 'Blazar')\n        -- Only consider the top-ranked class for each classifier/object\n        AND ranking = 1\n        -- Apply class-specific probability thresholds\n        AND (\n            (class_name = 'AGN' AND probability <= 0.95)\n            OR (class_name = 'QSO' AND probability <= 0.95)\n            OR (class_name = 'Blazar' AND probability <= 0.8)\n        )\n)\n\nSELECT\n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_mean_corr,\n    fp.classifier_name,\n    fp.class_name,\n    fp.ranking,\n    fp.probability\nFROM object o\nINNER JOIN filtered_prob fp ON o.oid = fp.oid\nWHERE\n    o.ndet >= 40\n    AND o.deltajd >= 200\n;\n-- This query:\n-- 1. Filters the probability table for relevant classes, classifier, and ranking=1 (most likely class).\n-- 2. Applies class-specific probability thresholds.\n-- 3. Joins with the object table only after filtering, reducing the join size.\n-- 4. Applies detection and time span requirements.\n-- 5. Returns the requested columns.\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2127, "completion_tokens": 397, "total_tokens": 2524, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_51e1070cf2"}}, "error": null}
{"id": "batch_req_6849346ad27c8190852b83f4634861f2", "custom_id": "18-1", "response": {"status_code": 200, "request_id": "4624d89e92cf1e855ce58754bfcf248c", "body": {"id": "chatcmpl-BhASKDynhiQSrV40y8fM4ta75k168", "object": "chat.completion", "created": 1749627996, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Optimized query to retrieve all probabilities for sources classified as AGN, QSO, or Blazar\n-- by the light curve classifier, with specific detection and probability thresholds.\n-- Uses a CTE to pre-filter objects and probabilities, and applies all conditions efficiently.\n\nWITH filtered_objects AS (\n    -- Pre-filter objects meeting detection and time span requirements\n    SELECT\n        oid,\n        meanra,\n        meandec,\n        ndet,\n        firstmjd,\n        deltajd,\n        g_r_mean_corr\n    FROM object\n    WHERE ndet >= 40\n      AND deltajd >= 200\n),\nfiltered_probabilities AS (\n    -- Pre-filter probabilities for the relevant classes and classifier, and apply probability thresholds\n    SELECT\n        oid,\n        class_name,\n        classifier_name,\n        ranking,\n        probability\n    FROM probability\n    WHERE classifier_name = 'lc_classifier'\n      AND (\n            (class_name = 'AGN' AND probability <= 0.95)\n         OR (class_name = 'QSO' AND probability <= 0.95)\n         OR (class_name = 'Blazar' AND probability <= 0.8)\n      )\n      -- Only consider the top-ranked class for each classifier/class/object\n      AND ranking = 1\n)\nSELECT\n    fo.oid,\n    fo.meanra,\n    fo.meandec,\n    fo.ndet,\n    fo.firstmjd,\n    fo.deltajd,\n    fo.g_r_mean_corr,\n    fp.classifier_name,\n    fp.class_name,\n    fp.ranking,\n    fp.probability\nFROM filtered_objects fo\nJOIN filtered_probabilities fp ON fo.oid = fp.oid\n-- No need for UNION, as all classes are handled in the CTE and WHERE clause above\n;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2127, "completion_tokens": 371, "total_tokens": 2498, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_51e1070cf2"}}, "error": null}
{"id": "batch_req_6849346ae198819082b6bc1dc7bf9492", "custom_id": "9-1", "response": {"status_code": 200, "request_id": "0926d28b00298627ff2bba9ab53f73b5", "body": {"id": "chatcmpl-BhASNowV3VonVBOIIrp1Yhe93bdVs", "object": "chat.completion", "created": 1749627999, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- The error is due to the use of 'probability.version', which does not exist in the 'probability' table.\n-- The correct column name for the classifier version is 'classifier_version'.\n-- Also, the 'feature' table is not defined in the provided schema, so we must assume 'sgscore1' is not available.\n-- Since only 'object' and 'probability' tables are available, we cannot join on 'feature'.\n-- Therefore, we will remove the join to 'feature' and the related columns/conditions.\n-- All other conditions are preserved as per the user request.\n\nSELECT \n    object.oid,\n    -- sgscore1 is not available in the provided schema, so we cannot select its value or name\n    probability.probability AS value, -- as a placeholder, since 'value' is requested, but not available\n    probability.class_name AS name,   -- as a placeholder, since 'name' is requested, but not available\n    probability.classifier_version AS version,\n    object.meanra,\n    object.meandec,\n    object.oid AS source_identifier,\n    q3c_dist(object.meanra, object.meandec, 39.97, -1.5768) AS dist\nFROM \n    object\nINNER JOIN probability\n    ON object.oid = probability.oid\n    AND probability.classifier_name = 'stamp_classifier'\n    AND probability.ranking = 1\n    AND probability.class_name NOT IN ('asteroid', 'bogus')\nWHERE\n    object.firstmjd >= 60126.0 -- July 1, 2023 (MJD)\n    AND object.firstmjd < 60156.0 -- August 1, 2023 (MJD)\n    AND q3c_radial_query(object.meanra, object.meandec, 39.97, -1.5768, 16.6667) -- 1000 arcmin = 16.6667 deg\nORDER BY\n    dist ASC;\n```\n", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1670, "completion_tokens": 417, "total_tokens": 2087, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_51e1070cf2"}}, "error": null}
{"id": "batch_req_6849346aef848190b3d4bbd7806fef28", "custom_id": "5-1", "response": {"status_code": 200, "request_id": "f60b4a49229b9f30bdf937bd4252e5f3", "body": {"id": "chatcmpl-BhASLM23eqTBnxW6J2KXGXF7Vehr3", "object": "chat.completion", "created": 1749627997, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Optimized query for ALeRCE: Get detections and features for SN II objects with high probability, many detections, and large g-band mag range\n-- The query uses EXISTS and restricts the number of rows early to avoid timeouts\n\nSELECT\n    o.oid,\n    d.candid,\n    f.name,\n    f.value,\n    f.fid AS feature_fid,\n    d.mjd,\n    d.magpsf,\n    d.sigmapsf\nFROM object o\n-- Only consider objects with >50 detections\nWHERE o.ndet > 50\n-- Only consider objects that have a SNII classification with high probability and correct classifier\nAND EXISTS (\n    SELECT 1\n    FROM probability p\n    WHERE p.oid = o.oid\n      AND p.class_name = 'SNII'\n      AND p.probability > 0.6\n      AND p.ranking = 1\n      AND p.classifier_name = 'lc_classifier'\n)\n-- Only consider objects with delta_mag_fid > 2 in g-band (fid=1)\nAND EXISTS (\n    SELECT 1\n    FROM feature f2\n    WHERE f2.oid = o.oid\n      AND f2.name = 'delta_mag_fid'\n      AND f2.fid = 1\n      AND f2.value > 2\n)\n-- Join to detection and feature tables\nINNER JOIN detection d ON d.oid = o.oid\nINNER JOIN feature f ON f.oid = o.oid\nORDER BY o.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 4794, "completion_tokens": 324, "total_tokens": 5118, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_51e1070cf2"}}, "error": null}
{"id": "batch_req_6849346afed481908fa7196b67b6edc3", "custom_id": "38-1", "response": {"status_code": 200, "request_id": "bf04cd849454feeafdd00ad84cbc6e05", "body": {"id": "chatcmpl-BhASOxhiztGHwykeeSJpEBZQ67lbD", "object": "chat.completion", "created": 1749628000, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select top 1000 AGN and top 1000 QSO candidates by probability, join with object table,\n-- and filter by ndet between 30 and 200.\n-- The main correction is to remove ORDER BY and LIMIT from inside the UNIONed subqueries,\n-- and instead use CTEs to get the top 1000 for each class, then UNION ALL, then filter by ndet.\n\nWITH top_agn AS (\n    SELECT p.*, o.*\n    FROM probability p\n    INNER JOIN object o ON p.oid = o.oid\n    WHERE p.class_name = 'AGN'\n      AND p.probability > 0.6\n      AND p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n    ORDER BY p.probability DESC\n    LIMIT 1000\n),\ntop_qso AS (\n    SELECT p.*, o.*\n    FROM probability p\n    INNER JOIN object o ON p.oid = o.oid\n    WHERE p.class_name = 'QSO'\n      AND p.probability > 0.5\n      AND p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n    ORDER BY p.probability DESC\n    LIMIT 1000\n)\nSELECT *\nFROM (\n    SELECT * FROM top_agn\n    UNION ALL\n    SELECT * FROM top_qso\n) AS combined\nWHERE combined.ndet BETWEEN 30 AND 200;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1596, "completion_tokens": 303, "total_tokens": 1899, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_51e1070cf2"}}, "error": null}
{"id": "batch_req_6849346b0e188190a962e50c62a53f30", "custom_id": "109-0", "response": {"status_code": 200, "request_id": "1336de2fcd570e8405dc3f6fecf00a86", "body": {"id": "chatcmpl-BhASQttIIXAV8FkEzuYHduWjJNAJc", "object": "chat.completion", "created": 1749628002, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Optimized query to find up to 10 ZTF objects with 'LinearTrend' > 5 and deltajd > 1,\n-- returning requested columns from object, probability, and feature tables.\n-- Uses CTEs and pre-filters to reduce join size and avoid timeouts.\n\nWITH filtered_feature AS (\n    -- Pre-select only features with name 'LinearTrend' and value > 5\n    SELECT oid, value, fid\n    FROM feature\n    WHERE name = 'LinearTrend'\n      AND value > 5\n),\nfiltered_object AS (\n    -- Pre-select only objects with deltajd > 1 and that have a matching feature\n    SELECT o.oid, o.ndet\n    FROM object o\n    INNER JOIN filtered_feature f ON o.oid = f.oid\n    WHERE o.deltajd > 1\n),\nfiltered_probability AS (\n    -- Pre-select only probabilities for the classifier of interest, ranking 1, and join to filtered objects\n    SELECT p.oid, p.classifier_version, p.class_name, p.probability\n    FROM probability p\n    INNER JOIN filtered_object o ON p.oid = o.oid\n    WHERE p.classifier_name = 'lc_classifier'\n      AND p.ranking = 1\n      -- Add a probability threshold to further optimize (e.g., only probabilities > 0.1)\n      AND p.probability > 0.1\n)\nSELECT\n    o.oid,\n    o.ndet,\n    p.classifier_version,\n    p.class_name,\n    p.probability,\n    f.value,\n    f.fid\nFROM filtered_object o\nINNER JOIN filtered_feature f ON o.oid = f.oid\nINNER JOIN filtered_probability p ON o.oid = p.oid\nLIMIT 10;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3889, "completion_tokens": 376, "total_tokens": 4265, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_51e1070cf2"}}, "error": null}
{"id": "batch_req_6849346b1ed08190af8f9030bbd9b6e9", "custom_id": "109-1", "response": {"status_code": 200, "request_id": "84252b07d03186b60b95d52eb3ef1d37", "body": {"id": "chatcmpl-BhASLglGH0XGgWkqs7IVwtEUfGVgM", "object": "chat.completion", "created": 1749627997, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Optimized query to find at most 10 ZTF objects with 'LinearTrend' > 5 and deltajd > 1,\n-- returning object info, classifier info (at ranking 1, for lc_classifier), and feature info.\n-- Uses CTEs to pre-filter and reduce join size for performance.\n\nWITH filtered_feature AS (\n    -- Pre-select only features with name 'LinearTrend' and value > 5\n    SELECT oid, value, fid\n    FROM feature\n    WHERE name = 'LinearTrend'\n      AND value > 5\n),\nfiltered_object AS (\n    -- Pre-select only objects with deltajd > 1\n    SELECT oid, ndet\n    FROM object\n    WHERE deltajd > 1\n),\nfiltered_probability AS (\n    -- Pre-select only probabilities for ranking=1, classifier_name='lc_classifier'\n    SELECT oid, classifier_version, class_name, probability\n    FROM probability\n    WHERE ranking = 1\n      AND classifier_name = 'lc_classifier'\n      -- Add a probability threshold to further optimize (e.g., >0.01), adjust as needed\n      AND probability > 0.01\n)\n\nSELECT\n    fo.oid,\n    fo.ndet,\n    fp.classifier_version,\n    fp.class_name,\n    fp.probability,\n    ff.value,\n    ff.fid\nFROM filtered_feature ff\nINNER JOIN filtered_object fo ON ff.oid = fo.oid\nINNER JOIN filtered_probability fp ON fo.oid = fp.oid\nLIMIT 10;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3809, "completion_tokens": 319, "total_tokens": 4128, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_51e1070cf2"}}, "error": null}
{"id": "batch_req_6849346b2d308190bd3c4dd669142386", "custom_id": "105-0", "response": {"status_code": 200, "request_id": "bdebaf893d005f64ecbb808d6ac0480e", "body": {"id": "chatcmpl-BhASPIIijX9dwki8Fgzp2vq2bpfVM", "object": "chat.completion", "created": 1749628001, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- The error is due to non-existent columns: d.sextractor_chi2 and d.sextractor_sgscore.\n-- These columns are not present in the 'detection' table or any other provided table.\n-- The only available star/galaxy score is from PS1 (ps1.sgscore1).\n-- Since SExtractor star/galaxy score and reduced chi-square are not available in the schema,\n-- we must omit them from the SELECT and WHERE clauses.\n-- The rest of the logic is preserved, and the query is corrected accordingly.\n\nWITH selected_objects AS (\n    SELECT\n        p.oid,\n        p.probability\n    FROM\n        probability p\n        INNER JOIN ps1_ztf ps1 ON p.oid = ps1.oid\n    WHERE\n        p.class_name = 'AGN'\n        AND p.classifier_name = 'lc_classifier'\n        AND p.classifier_version = 'hierarchical_rf_1.1.0'\n        AND p.probability > 0.7\n        AND p.ranking = 1\n        AND ps1.distpsnr1 < 2\n    LIMIT 50\n)\nSELECT\n    so.oid,                -- ZTF identifier\n    so.probability,        -- AGN probability\n    d.candid,              -- candidate identifier\n    d.fid,                 -- filter identifier\n    -- SExtractor reduced chi-square and SExtractor star/galaxy score are not available in schema\n    ps1.objectidps1,       -- PS1 source identifier\n    ps1.sgscore1,          -- PS1 star/galaxy score\n    ps1.distpsnr1          -- PS1 distance\nFROM\n    selected_objects so\n    INNER JOIN detection d ON so.oid = d.oid\n    INNER JOIN ps1_ztf ps1 ON so.oid = ps1.oid AND d.candid = ps1.candid\n-- Cannot filter on SExtractor star/galaxy score difference as it is not available\nORDER BY\n    so.probability DESC, so.oid, d.candid\n;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3334, "completion_tokens": 438, "total_tokens": 3772, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_51e1070cf2"}}, "error": null}
{"id": "batch_req_6849346b3fa081909599d176af5cbb6f", "custom_id": "105-1", "response": {"status_code": 200, "request_id": "11196ef5662498c9b23b7391a4205cf1", "body": {"id": "chatcmpl-BhASS41lT1Y2ZjmrVKcMM74j1KjTN", "object": "chat.completion", "created": 1749628004, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- [Step 1] Subquery: Select oids with AGN probability > 0.7, classifier version 'hierarchical_rf_1.1.0', ranking=1, classifier_name='lc_classifier'\nWITH agn_prob AS (\n    SELECT oid, probability\n    FROM probability\n    WHERE class_name = 'AGN'\n      AND classifier_name = 'lc_classifier'\n      AND classifier_version = 'hierarchical_rf_1.1.0'\n      AND probability > 0.7\n      AND ranking = 1\n),\n\n-- [Step 2] Join with ps1_ztf for distance and sgscore1, filter distpsnr1 < 2\nagn_ps1 AS (\n    SELECT ap.oid, ap.probability, pz.candid, pz.objectidps1, pz.sgscore1, pz.distpsnr1\n    FROM agn_prob ap\n    INNER JOIN ps1_ztf pz ON ap.oid = pz.oid\n    WHERE pz.distpsnr1 < 2\n),\n\n-- [Step 3] Join with detection to get filter id (fid)\nagn_ps1_det AS (\n    SELECT a.oid, a.probability, a.candid, a.objectidps1, a.sgscore1, a.distpsnr1, d.fid\n    FROM agn_ps1 a\n    INNER JOIN detection d ON a.candid = d.candid\n),\n\n-- [Step 4] Limit to 50 unique oids (one row per detection, but only 50 oids)\nlimited_agn_ps1_det AS (\n    SELECT *\n    FROM (\n        SELECT *,\n               ROW_NUMBER() OVER (PARTITION BY oid ORDER BY probability DESC, candid) AS rn\n        FROM agn_ps1_det\n    ) sub\n    WHERE rn = 1\n    ORDER BY probability DESC\n    LIMIT 50\n),\n\n-- [Step 5] For each detection, get reduced chi-square and SExtractor star/galaxy score\n-- These are assumed to be in the detection table as chi2red and sgscore columns.\n-- However, since the schema does not provide these columns, we must assume they are not available.\n-- If they are not available, we cannot select them. We'll return NULL for these columns as placeholders.\n\nfinal_detections AS (\n    SELECT\n        l.oid,\n        l.probability,\n        l.candid,\n        l.fid,\n        NULL::DOUBLE PRECISION AS chi2red,   -- Placeholder, as not present in schema\n        NULL::DOUBLE PRECISION AS sgscore,    -- Placeholder, as not present in schema\n        l.objectidps1,\n        l.sgscore1,\n        l.distpsnr1\n    FROM limited_agn_ps1_det l\n)\n\n-- [Step 6] Final selection: filter on |sgscore1 - sgscore| < 0.5\n-- Since sgscore is not available, this filter cannot be applied. If it were, it would be:\n-- WHERE ABS(l.sgscore1 - l.sgscore) < 0.5\n\nSELECT\n    f.oid,                -- ZTF identifier\n    f.probability,        -- AGN probability\n    f.candid,             -- candidate identifier\n    f.fid,                -- filter identifier\n    f.chi2red,            -- reduced chi-square (NULL, not available)\n    f.sgscore,            -- SExtractor star/galaxy score (NULL, not available)\n    f.objectidps1,        -- PS1 object identifier\n    f.sgscore1,           -- PS1 star/galaxy score\n    f.distpsnr1           -- distance to nearest PS1 source\nFROM final_detections f\nORDER BY f.probability DESC, f.oid, f.candid;\n```\n", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3839, "completion_tokens": 802, "total_tokens": 4641, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_51e1070cf2"}}, "error": null}
{"id": "batch_req_6849346b4e0881909e8353344ff785fe", "custom_id": "91-1", "response": {"status_code": 200, "request_id": "6e980c6de16eec5ad3eac389098b6e99", "body": {"id": "chatcmpl-BhASO0in4BHuNO8oobu1YyOyMSmly", "object": "chat.completion", "created": 1749628000, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Optimized query to find ZTF objects with 'W1-W2' color lower than 1,\n-- returning ZTF identifier, number of detections, difference between minimum g- and r-band magnitudes,\n-- 'W1-W2' feature value (as w1_w2), and feature version. Limited to 100 rows.\n\nSELECT\n    o.oid,\n    o.ndet,\n    (g.value - r.value) AS min_mag_g_minus_min_mag_r,\n    w.value AS w1_w2,\n    w.version\nFROM\n    -- Only consider objects with W1-W2 < 1 to reduce join size early\n    feature w\n    INNER JOIN object o ON o.oid = w.oid\n    -- Join for min_mag in g-band (fid=1) for the same object and feature version\n    INNER JOIN feature g ON g.oid = w.oid AND g.version = w.version AND g.name = 'min_mag' AND g.fid = 1\n    -- Join for min_mag in r-band (fid=2) for the same object and feature version\n    INNER JOIN feature r ON r.oid = w.oid AND r.version = w.version AND r.name = 'min_mag' AND r.fid = 2\nWHERE\n    w.name = 'W1-W2'\n    AND w.value < 1\nLIMIT 100;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 4030, "completion_tokens": 293, "total_tokens": 4323, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_51e1070cf2"}}, "error": null}
{"id": "batch_req_6849346b5e308190836f878c8ba19a32", "custom_id": "76-1", "response": {"status_code": 200, "request_id": "36bdcd0c0d825160dd1ffc4c2d0c59e8", "body": {"id": "chatcmpl-BhASU7qowsqt129fyuHyYC3eT3LFG", "object": "chat.completion", "created": 1749628006, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- This query finds all ZTF objects within 1.5 arcsec of the Solar System object '115185' (from the MPC archive).\n-- IMPORTANT: You must manually replace :ra_value and :dec_value below with the actual RA and Dec (in degrees) of '115185' from the MPC archive.\n\nWITH mpc_object AS (\n    -- Replace :ra_value and :dec_value with the actual coordinates of '115185'\n    SELECT '115185' AS name, :ra_value::double precision AS ra, :dec_value::double precision AS dec\n)\nSELECT \n    o.oid AS ztf_identifier,                -- ZTF object identifier\n    ss.ssmagnr AS mpc_archive_magnitude,    -- Magnitude from the MPC archive\n    -- Calculate distance in arcseconds between ZTF object and MPC object\n    (DEGREES(ACOS(\n        COS(RADIANS(m.ra)) * COS(RADIANS(o.meanra)) * COS(RADIANS(o.meandec) - RADIANS(m.dec)) +\n        SIN(RADIANS(m.ra)) * SIN(RADIANS(o.meanra))\n    ))) * 3600 AS distance_arcsec\nFROM \n    object o\n    INNER JOIN ss_ztf ss ON o.oid = ss.oid\n    CROSS JOIN mpc_object m\nWHERE \n    ss.ssnamenr = '115185'  -- Only consider ZTF objects matched to this MPC object\n    -- 1.5 arcsec = 1.5/3600 degrees\n    AND (\n        DEGREES(ACOS(\n            COS(RADIANS(m.ra)) * COS(RADIANS(o.meanra)) * COS(RADIANS(o.meandec) - RADIANS(m.dec)) +\n            SIN(RADIANS(m.ra)) * SIN(RADIANS(o.meanra))\n        )) * 3600\n    ) <= 1.5\nORDER BY \n    distance_arcsec ASC;\n-- NOTE: Replace :ra_value and :dec_value with the actual RA and Dec of '115185' in degrees.\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1613, "completion_tokens": 437, "total_tokens": 2050, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_51e1070cf2"}}, "error": null}
