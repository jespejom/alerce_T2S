{"id": "batch_req_6848b59a9a9c81908fe3e56b26241b62", "custom_id": "13-0", "response": {"status_code": 200, "request_id": "eff33bf57c8060d6ca43d578b893ac7a", "body": {"id": "chatcmpl-Bh20SB1fkPvqG1vcbI1RwLvOwK66P", "object": "chat.completion", "created": 1749595516, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select all Supernovae (SNe) objects (SNIa, SNIbc, SNII, SLSN) first detected between December 1, 2022 (MJD 59914.0) and September 1, 2023 (MJD 60217.0)\n-- Return the class_name (probability class), lastmjd, firstmjd, and oid\n\nSELECT\n    -- Get the most probable class_name for each object (SNe only)\n    (\n        SELECT p.class_name\n        FROM probability p\n        WHERE\n            p.oid = o.oid\n            AND p.classifier_name = 'lc_classifier'\n            AND p.ranking = 1\n        LIMIT 1\n    ) AS class_name,\n    o.lastmjd,\n    o.firstmjd,\n    o.oid\nFROM\n    object o\nWHERE\n    -- Restrict to objects first detected in the given date range\n    o.firstmjd BETWEEN 59914.0 AND 60217.0\n    -- Only include objects whose most probable class is a SNe class\n    AND (\n        SELECT p2.class_name\n        FROM probability p2\n        WHERE\n            p2.oid = o.oid\n            AND p2.classifier_name = 'lc_classifier'\n            AND p2.ranking = 1\n        LIMIT 1\n    ) IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\nORDER BY\n    o.firstmjd;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1915, "completion_tokens": 321, "total_tokens": 2236, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b59aac388190bcc77f5755b9c4e4", "custom_id": "13-1", "response": {"status_code": 200, "request_id": "656bb96f0c0d62b92e528ae31cf1aeaa", "body": {"id": "chatcmpl-Bh20SwWcpog5FahVdlJDGkqrWz5hH", "object": "chat.completion", "created": 1749595516, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select all Supernovae (SNe) objects (SNIa, SNIbc, SNII, SLSN) first detected between December 1, 2022 (MJD 59914.0) and September 1, 2023 (MJD 60217.0)\n-- Return the class_name (probability class), lastmjd (last detection date), firstmjd (first detection date), and oid (object id)\n\nSELECT\n    p.class_name,         -- Probability class (e.g., SNIa, SNIbc, SNII, SLSN)\n    o.lastmjd,            -- Last detection date (MJD)\n    o.firstmjd,           -- First detection date (MJD)\n    o.oid                 -- Object ID\nFROM\n    object o\n    INNER JOIN probability p\n        ON o.oid = p.oid  -- Join to get the probability class for each object\nWHERE\n    o.firstmjd >= 59914.0                     -- First detection after or on Dec 1, 2022\n    AND o.firstmjd <= 60217.0                 -- First detection before or on Sep 1, 2023\n    AND p.classifier_name = 'lc_classifier'   -- Use the correct classifier\n    AND p.ranking = 1                         -- Only the top-ranked class\n    AND p.class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN');  -- Only SNe classes\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1508, "completion_tokens": 322, "total_tokens": 1830, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b59ac2f8819092e677a8df221b91", "custom_id": "15-0", "response": {"status_code": 200, "request_id": "8db04331f103ab324902c6668a25738e", "body": {"id": "chatcmpl-Bh20UNuwUFR6KHFlJAkUesft8nfO8", "object": "chat.completion", "created": 1749595518, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Get oids of objects that are fast risers (dmdt_first >= 0.25 in any filter)\n-- whose first detection (magstat.firstmjd) is in the first 2 days of September (60188.0 <= firstmjd < 60190.0)\n-- and whose highest probability (ranking=1) in the stamp_classifier is for class_name='SN'\n-- For these objects, return:\n--   oid, probability in stamp_classifier (for SN, ranking=1), probability in lc_classifier (for ranking=1),\n--   all detections (candid, fid), magstat fid as magstat_fid, dmdt_first (initial rise estimate)\n-- Order by oid\n\nWITH fast_risers AS (\n    SELECT\n        oid,\n        fid AS magstat_fid,\n        dmdt_first,\n        firstmjd\n    FROM magstat\n    WHERE dmdt_first >= 0.25\n      AND firstmjd >= 60188.0\n      AND firstmjd < 60190.0\n),\nsn_stamp_oids AS (\n    SELECT p.oid\n    FROM probability p\n    WHERE p.classifier_name = 'stamp_classifier'\n      AND p.class_name = 'SN'\n      AND p.ranking = 1\n      AND p.oid IN (SELECT oid FROM fast_risers)\n)\nSELECT\n    fr.oid,\n    -- Probability in stamp_classifier for SN, ranking=1\n    (SELECT probability FROM probability \n        WHERE oid = fr.oid AND classifier_name = 'stamp_classifier' AND class_name = 'SN' AND ranking = 1\n        LIMIT 1) AS stamp_classifier_probability,\n    -- Probability in lc_classifier for the most likely class (ranking=1)\n    (SELECT probability FROM probability \n        WHERE oid = fr.oid AND classifier_name = 'lc_classifier' AND ranking = 1\n        LIMIT 1) AS lc_classifier_probability,\n    d.candid,\n    d.fid,\n    fr.magstat_fid,\n    fr.dmdt_first AS initial_rise_estimate\nFROM fast_risers fr\n-- Only keep oids that are SN in stamp_classifier (ranking=1)\nJOIN sn_stamp_oids sso ON fr.oid = sso.oid\n-- Join to detection to get all detections for these objects\nJOIN detection d ON d.oid = fr.oid\nORDER BY fr.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3191, "completion_tokens": 506, "total_tokens": 3697, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b59ad4a88190bfc3a037f86b5815", "custom_id": "4-0", "response": {"status_code": 200, "request_id": "681cbeb1c08982e4461a209463955c4a", "body": {"id": "chatcmpl-Bh20UVdNipvqpfajTWSi6HgMGeq8g", "object": "chat.completion", "created": 1749595518, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Get the object identifier, candidate identifier, magnitudes, magnitude errors, initial rise estimate, and band identifiers as a function of time\n-- for objects classified as SN II in 2019-2022, with probability > 0.6, initial rise rate > 0.5 mag/day in ZTF g and r-band, and number of detections > 50\n\nSELECT\n    d.oid,                -- object identifier\n    d.candid,             -- candidate identifier\n    d.magpsf,             -- PSF magnitude\n    d.sigmapsf,           -- PSF magnitude error\n    d.magap,              -- aperture magnitude\n    d.sigmagap,           -- aperture magnitude error\n    ms.dmdt_first,        -- initial rise estimate (mag/day)\n    d.fid,                -- band identifier (1=g, 2=r, 3=i)\n    d.mjd                 -- time of detection (MJD)\nFROM\n    detection d\n    -- Join magstat to get dmdt_first for the correct band and object\n    INNER JOIN magstat ms\n        ON d.oid = ms.oid AND d.fid = ms.fid\n    -- Join object to apply time and ndet filters\n    INNER JOIN object o\n        ON d.oid = o.oid\n    -- Join probability to apply class and probability filters\n    INNER JOIN probability p\n        ON d.oid = p.oid\nWHERE\n    -- Only g and r bands\n    d.fid IN (1, 2)\n    -- Only objects with > 50 detections\n    AND o.ndet > 50\n    -- Only objects with first detection in 2019-2022\n    AND o.firstmjd >= 58484      -- 2019-01-01 in MJD\n    AND o.firstmjd < 59580       -- 2023-01-01 in MJD\n    -- Only SNII with lc_classifier, ranking 1, probability > 0.6\n    AND p.class_name = 'SNII'\n    AND p.classifier_name = 'lc_classifier'\n    AND p.ranking = 1\n    AND p.probability > 0.6\n    -- Only objects with initial rise rate > 0.5 mag/day in both g and r bands\n    AND d.oid IN (\n        SELECT ms1.oid\n        FROM magstat ms1\n        WHERE ms1.fid IN (1, 2)\n          AND ms1.dmdt_first > 0.5\n        GROUP BY ms1.oid\n        HAVING COUNT(DISTINCT ms1.fid) = 2  -- must satisfy in both g and r\n    )\n;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3227, "completion_tokens": 575, "total_tokens": 3802, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b59ae3448190a81b12095b26348e", "custom_id": "4-1", "response": {"status_code": 200, "request_id": "9822ee33153d96bc70467145a026b055", "body": {"id": "chatcmpl-Bh20XGdoS8OjM5D4sABvVud6h4AEi", "object": "chat.completion", "created": 1749595521, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Get object and detection information for objects classified as SNII (SN II) by the lc_classifier\n-- in 2019-2022 (MJD 58484.0 to 59580.0), with probability > 0.6, initial rise rate (dmdt_first) > 0.5 mag/day\n-- in g (fid=1) and r (fid=2) bands, and number of detections > 50\n\nSELECT\n    d.oid,                -- object identifier\n    d.candid,             -- candidate identifier\n    d.magpsf,             -- PSF magnitude\n    d.sigmapsf,           -- PSF magnitude error\n    d.magap,              -- aperture magnitude\n    d.sigmagap,           -- aperture magnitude error\n    ms.dmdt_first,        -- initial rise estimate (mag/day) for the detection's band\n    d.fid,                -- band identifier (1=g, 2=r, 3=i)\n    d.mjd                 -- time of detection (MJD)\nFROM\n    detection d\n    -- Join magstat to get dmdt_first for the corresponding band and object\n    JOIN magstat ms\n        ON d.oid = ms.oid AND d.fid = ms.fid\n    -- Join object to apply object-level filters\n    JOIN object o\n        ON d.oid = o.oid\nWHERE\n    -- Only detections in g and r bands\n    d.fid IN (1, 2)\n    -- Object-level filters\n    AND o.ndet > 50\n    AND o.firstmjd >= 58484.0   -- 2019-01-01\n    AND o.firstmjd < 59580.0    -- 2022-12-31\n    -- Only objects classified as SNII by lc_classifier with probability > 0.6 and ranking=1\n    AND EXISTS (\n        SELECT 1\n        FROM probability p\n        WHERE\n            p.oid = o.oid\n            AND p.classifier_name = 'lc_classifier'\n            AND p.class_name = 'SNII'\n            AND p.probability > 0.6\n            AND p.ranking = 1\n    )\n    -- Only objects with dmdt_first > 0.5 in BOTH g and r bands\n    AND EXISTS (\n        SELECT 1\n        FROM magstat ms1\n        JOIN magstat ms2 ON ms1.oid = ms2.oid\n        WHERE\n            ms1.oid = o.oid\n            AND ms1.fid = 1 AND ms1.dmdt_first > 0.5\n            AND ms2.fid = 2 AND ms2.dmdt_first > 0.5\n    )\n;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3246, "completion_tokens": 587, "total_tokens": 3833, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b59af27c8190b7c63524efdcfa22", "custom_id": "23-0", "response": {"status_code": 200, "request_id": "22a48118c72e2d82d145718b852b43df", "body": {"id": "chatcmpl-Bh20Tkgk7Ab8eZ3eG5T2QbRpF3pT4", "object": "chat.completion", "created": 1749595517, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Optimized query to retrieve all classification probabilities for objects\n-- whose most likely class (ranking=1) is one of the specified transient types\n-- classified by the 'lc_classifier' with probability > 0.2.\n-- Uses a CTE to avoid inefficient IN subquery and ensures at least 3 conditions on probability.\n\nWITH selected_oids AS (\n    SELECT oid\n    FROM probability\n    WHERE classifier_name = 'lc_classifier'  -- classifier must be 'lc_classifier'\n      AND ranking = 1                        -- only the most likely class per object\n      AND class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')  -- only the specified classes\n      AND probability > 0.2                  -- probability threshold\n)\nSELECT p.*\nFROM probability p\nJOIN selected_oids so ON p.oid = so.oid\nORDER BY p.oid, p.classifier_name, p.ranking;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1353, "completion_tokens": 200, "total_tokens": 1553, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b59b02748190b1bdc3bc5efb3ca1", "custom_id": "23-1", "response": {"status_code": 200, "request_id": "9429b1292be4a7f334669fce48dee1f2", "body": {"id": "chatcmpl-Bh20U1fSTJ4B2Z6ntPeLTHVTbGm2S", "object": "chat.completion", "created": 1749595518, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select all classification probabilities for objects whose most likely class (ranking=1) is one of the specified supernova types,\n-- classified by the lc_classifier, and with probability > 0.2 for that top class.\n-- This version uses an INNER JOIN to avoid a slow IN subquery and ensures all required conditions are applied.\n\nSELECT p.*\nFROM probability p\nINNER JOIN (\n    -- Subquery: Find oids where the top-ranked class is one of the supernova types, classified by lc_classifier, and prob > 0.2\n    SELECT oid\n    FROM probability\n    WHERE classifier_name = 'lc_classifier'\n      AND ranking = 1\n      AND class_name IN ('SNIa', 'SNIbc', 'SNII', 'SLSN')\n      AND probability > 0.2\n) top_sn\nON p.oid = top_sn.oid\n-- Add the same classifier_name condition to further optimize the query\nWHERE p.classifier_name = 'lc_classifier'\nORDER BY p.oid, p.classifier_name, p.ranking;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1363, "completion_tokens": 224, "total_tokens": 1587, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b5aedaf88190a3103bbf7affa287", "custom_id": "18-0", "response": {"status_code": 200, "request_id": "1378e761435d4775fa9a01e53584ec3e", "body": {"id": "chatcmpl-Bh20hODWiHm8rEf0ReyZ4JpjhsWNl", "object": "chat.completion", "created": 1749595531, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Query to retrieve all probabilities for sources classified as AGN, QSO, or Blazar by the light curve classifier,\n-- with at least 40 detections, a time span of at least 200 days, and class-specific probability thresholds.\n-- Each class is collected in a separate subquery and combined using UNION to ensure similar numbers for each class.\n\n-- For each subquery, we JOIN the object and probability tables to access both sets of columns.\n-- We filter by class_name, classifier_name, ranking, and the appropriate probability threshold for each class.\n\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_mean_corr,\n    p.classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON o.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.class_name = 'Blazar'\n  AND p.ranking = 1\n  AND p.probability <= 0.8\n  AND o.ndet >= 40\n  AND o.deltajd >= 200\n\nUNION\n\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_mean_corr,\n    p.classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON o.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.class_name = 'AGN'\n  AND p.ranking = 1\n  AND p.probability <= 0.95\n  AND o.ndet >= 40\n  AND o.deltajd >= 200\n\nUNION\n\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_mean_corr,\n    p.classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON o.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.class_name = 'QSO'\n  AND p.ranking = 1\n  AND p.probability <= 0.95\n  AND o.ndet >= 40\n  AND o.deltajd >= 200;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2286, "completion_tokens": 548, "total_tokens": 2834, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b5aeead08190aee905d23f9b704b", "custom_id": "18-1", "response": {"status_code": 200, "request_id": "4e0d90f293b2fc3948b695971745b784", "body": {"id": "chatcmpl-Bh20TqIICPT2RA5am8s9eV5FLY9KA", "object": "chat.completion", "created": 1749595517, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Query to retrieve all probabilities for sources classified as AGN, QSO, or Blazar by the light curve classifier,\n-- with at least 40 detections, a time span of at least 200 days, and class-specific probability thresholds.\n-- Each class is collected in a separate subquery and combined using UNION to ensure similar numbers for each class.\n\n-- For each subquery, we JOIN the object and probability tables to access both object and classification information.\n-- We filter by class_name, classifier_name, ranking, and the appropriate probability threshold for each class.\n\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_mean_corr,\n    p.classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON o.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.class_name = 'Blazar'\n  AND p.ranking = 1\n  AND p.probability <= 0.8\n  AND o.ndet >= 40\n  AND o.deltajd >= 200\n\nUNION\n\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_mean_corr,\n    p.classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON o.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.class_name = 'AGN'\n  AND p.ranking = 1\n  AND p.probability <= 0.95\n  AND o.ndet >= 40\n  AND o.deltajd >= 200\n\nUNION\n\nSELECT \n    o.oid,\n    o.meanra,\n    o.meandec,\n    o.ndet,\n    o.firstmjd,\n    o.deltajd,\n    o.g_r_mean_corr,\n    p.classifier_name,\n    p.class_name,\n    p.ranking,\n    p.probability\nFROM object o\nJOIN probability p ON o.oid = p.oid\nWHERE p.classifier_name = 'lc_classifier'\n  AND p.class_name = 'QSO'\n  AND p.ranking = 1\n  AND p.probability <= 0.95\n  AND o.ndet >= 40\n  AND o.deltajd >= 200;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2280, "completion_tokens": 549, "total_tokens": 2829, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b5af02ec81908587eefdfe8ef2c3", "custom_id": "11-0", "response": {"status_code": 200, "request_id": "7dcb78b3a3f2b655ed8f575b9cf3f0b2", "body": {"id": "chatcmpl-Bh20U095GgMUIsuft6RZBFHQBnjxk", "object": "chat.completion", "created": 1749595518, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Obtain all Type Ia SNe (SNIa) whose first detection happened in September (MJD 60188.0 to 60217.0),\n-- whose peak magnitude (magmax) is above 19, and whose g-r color at maximum (g_r_max) is below 1.\n-- Return the object identifier (oid), the maximum g-r difference (g_r_max), the maximum magnitude (magmax), and the filter id (fid).\n\nSELECT\n    o.oid,\n    o.g_r_max,\n    m.magmax,\n    m.fid\nFROM\n    object o\n    -- Join to magstat to get magmax and fid for each object\n    INNER JOIN LATERAL (\n        SELECT magmax, fid\n        FROM magstat\n        WHERE magstat.oid = o.oid AND magstat.magmax > 19\n        ORDER BY magmax DESC\n        LIMIT 1\n    ) m ON TRUE\nWHERE\n    -- Only consider objects classified as SNIa with highest probability by lc_classifier\n    EXISTS (\n        SELECT 1\n        FROM probability p\n        WHERE\n            p.oid = o.oid\n            AND p.classifier_name = 'lc_classifier'\n            AND p.class_name = 'SNIa'\n            AND p.ranking = 1\n    )\n    -- First detection in September (MJD 60188.0 to 60217.0)\n    AND o.firstmjd >= 60188.0\n    AND o.firstmjd < 60217.0\n    -- g-r color at maximum is below 1\n    AND o.g_r_max < 1\n;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2410, "completion_tokens": 347, "total_tokens": 2757, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b5bc604881909658b4090393299e", "custom_id": "11-1", "response": {"status_code": 200, "request_id": "4292419a1a33a6e672410dd866a2a245", "body": {"id": "chatcmpl-Bh20Xy9fMnmOY2YBkllnM3tpkdys5", "object": "chat.completion", "created": 1749595521, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Obtain all Type Ia SNe (SNIa) whose first detection happened in September (MJD 60188.0 to 60217.0),\n-- whose peak magnitude (magmax) is above 19, and whose g-r color at maximum (g_r_max) is below 1.\n-- Return the object identifier (oid), the maximum g-r difference (g_r_max), the maximum magnitude (magmax), and the filter id (fid).\n\nSELECT\n    o.oid,\n    o.g_r_max,\n    m.magmax,\n    m.fid\nFROM\n    object o\n    -- Join to magstat to get magmax and fid for each object\n    INNER JOIN LATERAL (\n        SELECT magmax, fid\n        FROM magstat\n        WHERE magstat.oid = o.oid AND magmax > 19\n        ORDER BY magmax DESC\n        LIMIT 1\n    ) m ON TRUE\nWHERE\n    -- Only consider objects classified as SNIa with highest probability by lc_classifier\n    EXISTS (\n        SELECT 1\n        FROM probability p\n        WHERE\n            p.oid = o.oid\n            AND p.classifier_name = 'lc_classifier'\n            AND p.class_name = 'SNIa'\n            AND p.ranking = 1\n    )\n    -- First detection in September (MJD 60188.0 to 60217.0)\n    AND o.firstmjd >= 60188.0\n    AND o.firstmjd < 60217.0\n    -- g-r color at maximum is below 1\n    AND o.g_r_max < 1\n;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2414, "completion_tokens": 345, "total_tokens": 2759, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b5bc731881908a4aae5ab5702339", "custom_id": "9-0", "response": {"status_code": 200, "request_id": "3d2a1b3bdfc970002616efde5113ed8d", "body": {"id": "chatcmpl-Bh20UGilLlFpHtAw6OsTeLrkU3lbM", "object": "chat.completion", "created": 1749595518, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select object identifiers and related information for objects:\n-- - with first detection in July 2023 (firstmjd between 60126.0 and 60156.0)\n-- - within 1000 arcmin (16.16667 degrees) of Abell 370 (RA=39.97, Dec=-1.5768)\n-- - whose highest probability in the stamp classifier is NOT for class 'asteroid' or 'bogus'\n-- Note: 'sgscore1' and 'source identifier' are not present in the provided schema, so they are omitted.\n\nSELECT\n    o.oid,\n    p.probability AS value,           -- Probability value for the top-ranked class in stamp_classifier\n    p.class_name AS name,             -- Name of the top-ranked class in stamp_classifier\n    p.classifier_version AS version,  -- Version of the stamp_classifier\n    o.meanra,\n    o.meandec,\n    q3c_dist(o.meanra, o.meandec, 39.97, -1.5768) AS dist -- Angular distance from Abell 370 center\nFROM\n    object o\n    -- Join to probability table to get the highest probability class for each object in the stamp_classifier\n    JOIN probability p\n        ON o.oid = p.oid\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.ranking = 1\n        AND p.class_name NOT IN ('asteroid', 'bogus')\nWHERE\n    o.firstmjd >= 60126.0\n    AND o.firstmjd < 60156.0\n    AND q3c_dist(o.meanra, o.meandec, 39.97, -1.5768) <= 16.16667\n;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2478, "completion_tokens": 371, "total_tokens": 2849, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b5bc86d48190a58b2fad5fa1f02a", "custom_id": "9-1", "response": {"status_code": 200, "request_id": "f7f303117d8c1eaf0ff98299965dde2c", "body": {"id": "chatcmpl-Bh20UDXMjapmt8j8ITfU7wsiVeoi6", "object": "chat.completion", "created": 1749595518, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Get object identifiers with first detection in July 2023, within 1000 arcmin (16.16667 deg) of Abell 370,\n-- sgscore1 < 0.3, and highest stamp_classifier probability not for 'asteroid' or 'bogus'.\n-- Return: oid, probability.value, probability.class_name, probability.classifier_version, meanra, meandec, oid as source_id, and q3c_dist as dist.\n\nSELECT\n    o.oid,\n    p.probability AS value,\n    p.class_name AS name,\n    p.classifier_version AS version,\n    o.meanra,\n    o.meandec,\n    o.oid AS source_id,\n    q3c_dist(o.meanra, o.meandec, 39.97, -1.5768) AS dist\nFROM\n    object o\n    -- Use LATERAL JOIN to get the highest probability (ranking=1) for stamp_classifier, not asteroid or bogus\n    JOIN LATERAL (\n        SELECT probability, class_name, classifier_version\n        FROM probability\n        WHERE\n            oid = o.oid\n            AND classifier_name = 'stamp_classifier'\n            AND ranking = 1\n            AND class_name NOT IN ('asteroid', 'bogus')\n        LIMIT 1\n    ) p ON TRUE\nWHERE\n    -- July 2023 in MJD: 60126.0 <= firstmjd < 60156.0\n    o.firstmjd >= 60126.0\n    AND o.firstmjd < 60156.0\n    -- Within 1000 arcmin (16.16667 deg) of Abell 370\n    AND q3c_radial_query(o.meanra, o.meandec, 39.97, -1.5768, 16.16667)\n    -- sgscore1 < 0.3 (assuming sgscore1 is a column in object table)\n    AND o.sgscore1 < 0.3\n;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2651, "completion_tokens": 422, "total_tokens": 3073, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b5bdc0488190a36ab441a8db621d", "custom_id": "5-1", "response": {"status_code": 200, "request_id": "660e3220d8684152b6ac055a42ebd192", "body": {"id": "chatcmpl-Bh20Xi2XOzSNLSGeuawQ7NWBLKkOm", "object": "chat.completion", "created": 1749595521, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Get object identifier, candidate identifier, feature name and value, psf magnitudes, magnitude errors, and band identifiers (renaming feature.fid as feature_fid)\n-- for objects classified as SN II with probability > 0.6, ndet > 50, and delta_mag_fid (g-band) > 2\n-- Order results by oid\n\nSELECT\n    d.oid,\n    d.candid,\n    f.name,\n    f.value,\n    d.magpsf,\n    d.sigmapsf,\n    d.fid,\n    f.fid AS feature_fid,\n    d.mjd\nFROM\n    detection d\n    -- Join with feature table for all features of the object\n    INNER JOIN feature f ON d.oid = f.oid\nWHERE\n    -- Filter objects with ndet > 50\n    d.oid IN (\n        SELECT o.oid\n        FROM object o\n        WHERE o.ndet > 50\n          -- Only objects classified as SN II with probability > 0.6 and ranking = 1\n          AND o.oid IN (\n              SELECT p.oid\n              FROM probability p\n              WHERE p.class_name = 'SNII'\n                AND p.classifier_name = 'lc_classifier'\n                AND p.probability > 0.6\n                AND p.ranking = 1\n          )\n          -- Only objects with delta_mag_fid (g-band) > 2\n          AND o.oid IN (\n              SELECT ff.oid\n              FROM feature ff\n              WHERE ff.name = 'delta_mag_fid'\n                AND ff.fid = 1  -- g-band\n                AND ff.value > 2\n          )\n    )\nORDER BY\n    d.oid;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 4709, "completion_tokens": 364, "total_tokens": 5073, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b5bdd2208190b9e140cc5f1750af", "custom_id": "93-0", "response": {"status_code": 200, "request_id": "0ce30bd0628013984342956bdd157413", "body": {"id": "chatcmpl-Bh20ZmST03odBdeNFuE2q81zaiVpp", "object": "chat.completion", "created": 1749595523, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Optimized query to get all columns from 'probability' and 'magstat' for ZTF objects where:\n-- 1. The 'asteroid' class is ranked 1 in the 'stamp_classifier' (probability table)\n-- 2. The object has a corrected light curve (magstat.corrected = TRUE)\n-- 3. The join is performed on oid, and only objects present in both tables are returned\n-- 4. At most 10 rows, ordered by probability.oid\n\nSELECT\n    p.*,\n    m.*\nFROM\n    -- Subquery to filter only the relevant oids from probability (with all required conditions)\n    (SELECT *\n     FROM probability\n     WHERE class_name = 'asteroid'\n       AND classifier_name = 'stamp_classifier'\n       AND ranking = 1\n     ) p\n    -- INNER JOIN to magstat, only for corrected light curves\n    INNER JOIN magstat m\n        ON p.oid = m.oid\n        AND m.corrected = TRUE\nORDER BY\n    p.oid\nLIMIT 10;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2127, "completion_tokens": 227, "total_tokens": 2354, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b5bde0f481908188f975ceb5fcca", "custom_id": "93-1", "response": {"status_code": 200, "request_id": "d3370fdc80be6f2dcf18a850f1ebd910", "body": {"id": "chatcmpl-Bh20aGaFbLnzALEozO23uz2aELS8p", "object": "chat.completion", "created": 1749595524, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Get all columns from 'probability' and 'magstat' for ZTF objects where:\n-- 1. The 'asteroid' class is ranked 1 in the 'stamp_classifier'\n-- 2. The object has a corrected light curve (magstat.corrected = true)\n-- Limit to 10 results, ordered by probability.oid\n-- \n-- Since you want all columns from both tables side by side for each object,\n-- and the schemas are different, you must use a JOIN (which is the only way to get columns from both tables in one row).\n-- The original UNION ALL approach fails because the column counts/types differ.\n-- \n-- This query returns, for each object (oid) that matches the criteria, all columns from probability and magstat.\n-- If there are multiple magstat rows per oid (e.g., different bands), you will get one row per (probability, magstat) pair.\n\nSELECT\n    p.*,\n    m.*\nFROM\n    probability p\n    -- Only keep probability rows for 'asteroid' class, 'stamp_classifier', and ranking 1\n    INNER JOIN (\n        SELECT oid\n        FROM probability\n        WHERE class_name = 'asteroid'\n          AND classifier_name = 'stamp_classifier'\n          AND ranking = 1\n    ) po ON p.oid = po.oid\n    -- Join to magstat for corrected light curves\n    INNER JOIN magstat m ON p.oid = m.oid AND m.corrected = TRUE\nWHERE\n    p.class_name = 'asteroid'\n    AND p.classifier_name = 'stamp_classifier'\n    AND p.ranking = 1\nORDER BY\n    p.oid\nLIMIT 10;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2706, "completion_tokens": 355, "total_tokens": 3061, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b5bdf1448190a3d5255718457165", "custom_id": "101-1", "response": {"status_code": 200, "request_id": "caa043637042108b6cb15ea8769deb1c", "body": {"id": "chatcmpl-Bh20VMGCuY5plfH9kqHTf41K6L6j2", "object": "chat.completion", "created": 1749595519, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Find ZTF objects with probability > 0.5 of being a long period variable (LPV) in the light curve classifier,\n-- and with a WISE W1 magnitude between 7 and 8.\n-- Return all columns from 'probability', 'xmatch', and 'allwise' for such objects, limit to 100 rows.\n\nSELECT \n    p.*,      -- All columns from probability\n    x.*,      -- All columns from xmatch\n    a.*       -- All columns from allwise\nFROM \n    probability p\n    -- Join xmatch on oid, and require that the match is to the ALLWISE catalog\n    JOIN xmatch x ON p.oid = x.oid AND x.catid = 'ALLWISE'\n    -- Join allwise on oid_catalog (from xmatch and allwise)\n    JOIN allwise a ON x.oid_catalog = a.oid_catalog\nWHERE\n    p.class_name = 'LPV'\n    AND p.classifier_name = 'lc_classifier'\n    AND p.probability > 0.5\n    AND a.w1mpro BETWEEN 7 AND 8\nLIMIT 100;  -- Limit to 100 rows\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2498, "completion_tokens": 250, "total_tokens": 2748, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b5be00d08190905b2bd32d6ee572", "custom_id": "88-0", "response": {"status_code": 200, "request_id": "7e4ab373f766e0cc641282ec45d26696", "body": {"id": "chatcmpl-Bh20jGR6T9elN2SAbZtPf4Zy6jbpV", "object": "chat.completion", "created": 1749595533, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select ZTF objects with 'bogus' class ranked 1 in the stamp classifier and at least 20 detections\nSELECT \n    o.oid AS ztf_identifier,           -- ZTF object identifier\n    o.ndet AS number_of_detections,    -- number of detections\n    o.meanra,                          -- mean right ascension\n    o.meandec,                         -- mean declination\n    p.classifier_version,              -- classifier version\n    p.probability                      -- probability of 'bogus' class\nFROM \n    object o\n    -- Join with probability table to access classifier information\n    INNER JOIN probability p\n        ON o.oid = p.oid\n        AND p.class_name = 'bogus'\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.ranking = 1\nWHERE \n    o.ndet >= 20                       -- at least 20 detections\nLIMIT 50;                              -- return at most 50 rows\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1405, "completion_tokens": 210, "total_tokens": 1615, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_51e1070cf2"}}, "error": null}
{"id": "batch_req_6848b5be1314819088e16b7d77140125", "custom_id": "88-1", "response": {"status_code": 200, "request_id": "df40cd2b0f6a79fffa046ed01dabb85e", "body": {"id": "chatcmpl-Bh20jq1IyNsThHDhs6MyzsigYyk4q", "object": "chat.completion", "created": 1749595533, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select ZTF objects with 'bogus' class ranked 1 in the stamp classifier and at least 20 detections\nSELECT \n    o.oid AS ztf_identifier,         -- ZTF object identifier\n    o.ndet AS number_of_detections,  -- Number of detections\n    o.meanra,                        -- Mean right ascension\n    o.meandec,                       -- Mean declination\n    p.classifier_version,            -- Classifier version\n    p.probability                    -- Probability of 'bogus' class\nFROM \n    object o\n    -- Join with probability table to access classifier info\n    INNER JOIN probability p\n        ON o.oid = p.oid\n        AND p.class_name = 'bogus'\n        AND p.classifier_name = 'stamp_classifier'\n        AND p.ranking = 1\nWHERE \n    o.ndet >= 20                     -- At least 20 detections\nLIMIT 50;                            -- Return at most 50 rows\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1409, "completion_tokens": 211, "total_tokens": 1620, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b5be24a0819096d4f2262fc9e3e0", "custom_id": "105-0", "response": {"status_code": 200, "request_id": "442b02b1853cc865eca452af4e2397d6", "body": {"id": "chatcmpl-Bh20mZfpH5JV71P9STdGtydECS823", "object": "chat.completion", "created": 1749595536, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Find at most 50 ZTF objects with:\n-- - probability > 0.7 of being AGN in lc_classifier, version 'hierarchical_rf_1.1.0'\n-- - distance to nearest PS1 source < 2 arcsec\n-- - |PS1 sgscore1 - SExtractor sgscore| < 0.5\n-- Return: ZTF identifier, probability, candidate, filter id, reduced chi-square, SExtractor sgscore,\n--         PS1 source id, PS1 sgscore, PS1 distance\n\nSELECT\n    d.oid AS ztf_oid,\n    p.probability,\n    d.candid,\n    d.fid,\n    d.rb AS reduced_chi2,         -- No explicit reduced chi-square, using rb as proxy\n    d.drb AS sextractor_sgscore,  -- No explicit SExtractor sgscore, using drb as proxy\n    ps.objectidps1,\n    ps.sgscore1 AS ps1_sgscore,\n    ps.distpsnr1 AS ps1_distance\nFROM\n    detection d\n    -- Join to probability table for AGN probability\n    INNER JOIN probability p\n        ON d.oid = p.oid\n        AND p.class_name = 'AGN'\n        AND p.classifier_name = 'lc_classifier'\n        AND p.classifier_version = 'hierarchical_rf_1.1.0'\n        AND p.probability > 0.7\n    -- Join to ps1_ztf for PS1 info\n    INNER JOIN ps1_ztf ps\n        ON d.oid = ps.oid\n        AND ps.distpsnr1 < 2\n        AND ABS(ps.sgscore1 - d.drb) < 0.5  -- Difference between PS1 and SExtractor sgscore\n-- Limit to 50 objects (may return more rows due to multiple detections per object)\nWHERE d.oid IN (\n    SELECT oid\n    FROM probability\n    WHERE class_name = 'AGN'\n      AND classifier_name = 'lc_classifier'\n      AND classifier_version = 'hierarchical_rf_1.1.0'\n      AND probability > 0.7\n    LIMIT 50\n)\n;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 3574, "completion_tokens": 460, "total_tokens": 4034, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b5be34a881908b3ec5fce49fdbe3", "custom_id": "86-0", "response": {"status_code": 200, "request_id": "e971f3c8aa48e8264820a9528c0ce7de", "body": {"id": "chatcmpl-Bh20YZmRfg4q5FEbj9YaYcY5DQ92I", "object": "chat.completion", "created": 1749595522, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Find ZTF objects with probability > 0.6 of being 'CEP', 'DSCT', or 'RRL' in 'lc_classifier'\n-- with version 'hierarchical_rf_1.1.0' and whose closest PS1 object (sgscore1) > 0.8.\n-- Return all columns from 'probability' and 'ps1_ztf', limit to 100 rows.\n\nSELECT\n    p.*,         -- all columns from probability\n    ps.*         -- all columns from ps1_ztf\nFROM\n    probability p\n    INNER JOIN ps1_ztf ps ON p.oid = ps.oid\nWHERE\n    p.classifier_name = 'lc_classifier'\n    AND p.classifier_version = 'hierarchical_rf_1.1.0'\n    AND p.class_name IN ('CEP', 'DSCT', 'RRL')\n    AND p.probability > 0.6\n    AND ps.sgscore1 > 0.8\nLIMIT 100;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 2649, "completion_tokens": 214, "total_tokens": 2863, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b5be45d88190a104f53783dd8ae5", "custom_id": "97-0", "response": {"status_code": 200, "request_id": "abf54c72d21026429654b31c08354925", "body": {"id": "chatcmpl-Bh20Y8LiSdO11ZE2z7RC71zJFBIni", "object": "chat.completion", "created": 1749595522, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- The original query failed because the scalar subqueries in the SELECT clause can return more than one row.\n-- To fix this, we JOIN the probability table twice (once for each classifier/class), ensuring only one row per oid.\n-- We also filter the probabilities in the JOIN conditions to meet the user's requirements.\n\nSELECT \n    o.oid AS \"ZTF identifier\",\n    p_stamp.probability AS prob_stamp_agn,\n    p_lc.probability AS prob_lc_lpv\nFROM object o\n-- Join for AGN probability from the stamp classifier, version 1.0.4\nJOIN probability p_stamp\n    ON p_stamp.oid = o.oid\n    AND p_stamp.class_name = 'AGN'\n    AND p_stamp.classifier_name = 'stamp_classifier'\n    AND p_stamp.classifier_version = 'stamp_classifier_1.0.4'\n    AND p_stamp.probability > 0.6\n-- Join for LPV probability from the light curve classifier\nJOIN probability p_lc\n    ON p_lc.oid = o.oid\n    AND p_lc.class_name = 'LPV'\n    AND p_lc.classifier_name = 'lc_classifier'\n    AND p_lc.probability > 0.7\nLIMIT 50;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1689, "completion_tokens": 269, "total_tokens": 1958, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
{"id": "batch_req_6848b5d8fafc819089e04d4343715df6", "custom_id": "97-1", "response": {"status_code": 200, "request_id": "904a832ac1028242864c05dbe85eb2c6", "body": {"id": "chatcmpl-Bh20ZVaL71olFdNAuWPmJM28zBeZ8", "object": "chat.completion", "created": 1749595523, "model": "gpt-4.1-2025-04-14", "choices": [{"index": 0, "message": {"role": "assistant", "content": "```sql\n-- Select up to 50 ZTF objects with:\n-- 1. Probability > 0.6 of being AGN in stamp_classifier_1.0.4\n-- 2. Probability > 0.7 of being LPV in lc_classifier\n-- Return: ZTF identifier, AGN probability (as prob_stamp_agn), LPV probability (as prob_lc_lpv)\n\nSELECT\n    o.oid AS \"ZTF identifier\",\n    p_stamp.probability AS prob_stamp_agn,\n    p_lc.probability AS prob_lc_lpv\nFROM\n    object o\n    -- Join for AGN probability in stamp_classifier_1.0.4\n    INNER JOIN probability p_stamp\n        ON o.oid = p_stamp.oid\n        AND p_stamp.class_name = 'AGN'\n        AND p_stamp.classifier_name = 'stamp_classifier'\n        AND p_stamp.classifier_version = 'stamp_classifier_1.0.4'\n    -- Join for LPV probability in lc_classifier\n    INNER JOIN probability p_lc\n        ON o.oid = p_lc.oid\n        AND p_lc.class_name = 'LPV'\n        AND p_lc.classifier_name = 'lc_classifier'\nWHERE\n    p_stamp.probability > 0.6\n    AND p_lc.probability > 0.7\nLIMIT 50;\n```", "refusal": null, "annotations": []}, "logprobs": null, "finish_reason": "stop"}], "usage": {"prompt_tokens": 1762, "completion_tokens": 292, "total_tokens": 2054, "prompt_tokens_details": {"cached_tokens": 0, "audio_tokens": 0}, "completion_tokens_details": {"reasoning_tokens": 0, "audio_tokens": 0, "accepted_prediction_tokens": 0, "rejected_prediction_tokens": 0}}, "service_tier": "default", "system_fingerprint": "fp_799e4ca3f1"}}, "error": null}
